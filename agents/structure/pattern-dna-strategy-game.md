# パターンDNA解析: Strategy × ゲーム開発

> 生成日: 2026-02-02
> ワークフロー: `/planning-v3`（パターンDNA解析アプローチ）
> 形式: **統合版**

---

## 概要

「動けばいいコード」から卒業したいゲームプログラマー向けに、**ゲーム開発独自の「仕様変更の多さ」と「複雑な分岐」** をStrategyパターンで治療する構造案。

**ターゲット**: 初級〜中級ゲームプログラマー

---

## Step 1: 症状カタログ

### 問診票（ユーザー提供）

| # | 症状名 | 説明 | 重症度 |
|---|--------|------|--------|
| 1 | **条件分岐過多症候群** | ダメージ計算や敵AIの行動選択で`if-else`/`switch`が巨大化・複雑化し、可読性が著しく低下 | 重症 |
| 2 | **拡張不能症** | 新しい攻撃スキルやアイテム効果追加のたびに既存God Classを修正 | 中症 |
| 3 | **コピペ依存症** | 異なる敵の移動ロジックなど類似アルゴリズムが複数クラスに散在 | 中症 |

### 症状の深掘り

| 症状 | 具体的なコード臭 | 放置した場合のリスク |
|------|------------------|---------------------|
| 条件分岐過多症候群 | 「攻撃タイプが10種類以上」「敵AIに30分岐」 | バグ混入率増大、テスト不能 |
| 拡張不能症 | 「新スキルのたびにダメージ計算クラスに行追加」 | OCP違反、デグレ発生 |
| コピペ依存症 | 「敵Aの移動と敵Bの移動が90%同じ」 | 修正漏れ、メンテナンス地獄 |

---

## Step 2: DNA解析マップ

### 処方候補（ユーザー提供）

| 順序 | パターン名 | 適応症状 |
|------|-----------|----------|
| 1 | **Strategy** | アルゴリズムをクラスとしてカプセル化し、実行時に動的に切り替え可能にすることで条件分岐を排除 |
| 2 | (Factory Method) | Strategyの具象クラス生成を専門化し、生成ロジックの散乱を防ぐ（※必要に応じて追加） |

### パターン詳細解析

#### Strategy パターン

```markdown
**一言でいうと**: 処理のやり方を交換可能にするパターン

- **適応症状**: 条件分岐過多症候群、拡張不能症、コピペ依存症
- **禁忌**:
  - 分岐が2〜3個程度の軽症例（過剰投薬）
  - 処理が今後増える予定がない固定仕様
- **副作用**:
  - クラス数の増加（1アルゴリズム = 1クラス）
  - 初学者には「なぜクラスに分けるのか」が伝わりにくい

**ゲーム開発での適用例**:
- ダメージ計算（物理/魔法/固定/割合）
- 敵AIの行動選択（突撃型/慎重型/ランダム型）
- 移動ロジック（追跡/逃走/パトロール/待機）
```

#### Factory Method パターン（補助）

```markdown
**一言でいうと**: オブジェクトの生成を専門クラスに任せるパターン

- **適応症状**: 生成ロジック散乱症、Strategyの具象クラスが増えすぎた場合
- **禁忌**:
  - Strategyクラスが3個以下の軽症例
  - 生成ロジックが1箇所に集約されている場合
- **副作用**:
  - ファクトリクラスという「一段階の抽象化」追加

**本シリーズでの使用**: オプション。Strategyクラスが増えた場合の追加処方として提示
```

### 遺伝子型診断

| 遺伝子型 | 構成症状 | 複合処方 | 本シリーズでの対応 |
|----------|----------|----------|-------------------|
| **Type-SG** | 条件分岐過多 + 拡張困難 | Strategy単体 | メイン治療 |
| **Type-SGF** | 上記 + 生成ロジック散乱 | Strategy + Factory | オプション追加治療 |

---

## Step 3: 競合・差別化分析

### 既存シリーズとの比較

| 既存シリーズ | Strategy使用 | テーマ | 本シリーズとの差別化 |
|-------------|-------------|--------|---------------------|
| データエクスポーター | ◎（単独） | CSV/JSON/XML出力 | ゲーム開発特化ではない |
| ダンジョンマスター | ○（3パターン複合） | 敵生成 | 複合パターン、Strategy単体深掘りなし |
| テキストRPG戦闘エンジン | ○（4パターン複合） | 戦闘 | 複合パターン、Strategy単体深掘りなし |

**差別化ポイント**:
- **Strategyパターン単体に集中**した深掘り
- **ゲーム開発特有の「仕様変更」**への適用
- **医療メタファー**（コードドクター視点）で診断・処方

---

## Step 4: 処方箋設計（3案）

### 案A: 標準治療プラン「敵AIリファクタリング」

**治療方針**: 敵AIの**行動選択**ロジックを題材に、Strategyパターンを段階導入

**テーマ・題材**: 2Dアクションゲームの敵AI

**USP**: 「敵の行動が20種類あっても、switch文0個」を実現

| 章 | 症状/診断 | 処方/投薬 | Before/After |
|----|----------|----------|--------------|
| 1 | 初診: switch地獄の敵AI | 症状確認のみ | - |
| 2 | 条件分岐過多症候群 | Strategy導入（突撃/慎重/ランダム） | 行数-40%, 複雑度-60% |
| 3 | 拡張不能症 | 新行動追加の容易化 | 追加工数: 30行→5行 |
| 4 | コピペ依存症 | 共通インターフェース抽出 | 重複コード: 90%→0% |
| 5 | （オプション）生成ロジック散乱 | Factory Method追加 | 生成箇所: 5→1 |
| 6 | 退院: 健康な敵AI | 総括・ベストプラクティス | 全体メトリクス |

**推奨タグ**: `Perl`, `デザインパターン`, `Strategy`, `ゲーム開発`, `リファクタリング`

**meta description**: Perlで敵AIのswitch地獄を解消！Strategyパターンでゲームコードを健康にするコードドクター診察記

**想定される批判と回答**:
| 批判 | 回答 |
|------|------|
| 「敵AIはゲームエンジンに任せる」 | 本質はアルゴリズム切り替えの設計。ゲームエンジン内部でも同じ原則が使われている |
| 「シンプルな敵なら不要」 | 禁忌事項として2-3分岐の軽症例は経過観察と明記 |

---

### 案B: 集中治療プラン「ダメージ計算式リファクタリング」

**治療方針**: バトルシステムの**ダメージ計算**を題材に、重症例から着手

**テーマ・題材**: RPGのダメージ計算式（物理/魔法/固定/割合/属性相性）

**USP**: 「新しい攻撃タイプを追加するのに1ファイルだけ」を実現

| 章 | 症状/診断 | 処方/投薬 | Before/After |
|----|----------|----------|--------------|
| 1 | 緊急入院: 500行のダメージ計算関数 | 症状確認、死亡リスク説明 | - |
| 2 | 重症: 条件分岐過多症候群 | Strategy導入（物理/魔法/固定） | 行数-50%, 複雑度-70% |
| 3 | 中症: 拡張不能症 | 割合ダメージ追加で検証 | 追加工数: 50行→5行 |
| 4 | 軽症: コピペ依存症 | 属性相性計算の共通化 | 重複コード: 80%→0% |
| 5 | 経過観察: テスト追加 | ユニットテストで回帰防止 | テストカバレッジ: 0%→90% |
| 6 | 退院: 健康なバトルシステム | 総括・設計指針 | 全体メトリクス |

**推奨タグ**: `Perl`, `デザインパターン`, `Strategy`, `RPG`, `バトルシステム`

**meta description**: 500行のダメージ計算関数を手術！PerlとStrategyパターンでRPGのバトルシステムを蘇生するコードドクター奮闘記

**想定される批判と回答**:
| 批判 | 回答 |
|------|------|
| 「ダメージ計算は単純な数式で十分」 | 属性相性、バフ/デバフ、クリティカル計算が絡むと複雑化は必然 |
| 「実際のゲームはもっと複雑」 | サンプルは教育目的。現実のゲームへの適用指針を退院時に提示 |

---

### 案C: 予防医学プラン「移動アルゴリズム設計」

**治療方針**: 軽症→重症の順で「予防的設計」を体験学習

**テーマ・題材**: 2Dゲームのキャラクター移動ロジック（追跡/逃走/パトロール/待機）

**USP**: 「最初から健康なコードを書く」ための予防医学的アプローチ

| 章 | 症状/診断 | 処方/投薬 | Before/After |
|----|----------|----------|--------------|
| 1 | 健康診断: まだ発症していないコード | 予防処方の説明 | - |
| 2 | 予防接種: Strategy設計 | 最初からパターン適用 | 初期設計: 健康 |
| 3 | 軽症予防: 移動ロジック2種追加 | パターン維持の確認 | 追加工数: 5行/種 |
| 4 | 中症予防: 移動ロジック5種追加 | スケーラビリティ確認 | 複雑度: 変化なし |
| 5 | 重症予防: 合成移動（追跡+逃走） | Compositeとの比較 | 設計選択肢の提示 |
| 6 | 卒業: 予防医学のススメ | 総括・設計指針 | 全体メトリクス |

**推奨タグ**: `Perl`, `デザインパターン`, `Strategy`, `ゲーム開発`, `設計`

**meta description**: ゲームコードを最初から健康に！Perlで学ぶStrategyパターン予防医学講座

**想定される批判と回答**:
| 批判 | 回答 |
|------|------|
| 「Before/Afterがないと効果がわからない」 | 各章末に「もしパターンなしで書いたら」の仮想Before比較を追加 |
| 「予防医学は地味」 | 重症例（案B）へのリンクを提供し、「リファクタリングの苦労」を対比 |

---

## Step 5: 推薦と理由

### 推薦案: **案B（集中治療プラン「ダメージ計算式リファクタリング」）**

**選定理由**:

1. **インパクト最大**: 「500行の関数」からの劇的改善はBefore/Afterが明確
2. **共感しやすい**: RPGのダメージ計算は多くのゲームプログラマーが経験
3. **知見ベースと整合**: 「ゲーム系題材は高い選好度」（`planning-insights.md`より）
4. **差別化成功**: 既存シリーズ（敵AI系）と題材レベルで差別化

**代替候補**:
- 案A: 敵AIは既存シリーズ（ダンジョンマスター、テキストRPG戦闘エンジン）と題材が近い
- 案C: 教育的だが「Before/After」のインパクトが弱い

---

## メトリクス設計

### Before/After比較項目

| 指標 | 測定方法 | Before目安 | After目安 |
|------|----------|-----------|----------|
| **行数** | `wc -l` | 500行 | 250行(-50%) |
| **複雑度** | McCabe指標（手動計算） | 25以上 | 5以下(-80%) |
| **if/else/switch数** | `grep -c` | 20個以上 | 0個 |
| **クラス数** | ファイル数 | 1（God Class） | 6+（Strategy群） |
| **追加工数** | 新ダメージタイプ追加時 | 50行追加 | 5行1ファイル |
| **テストカバレッジ** | 手動確認 | 0% | 90%以上 |

---

## ステータス登録

```markdown
| [pattern-dna-strategy-game.md](agents/structure/pattern-dna-strategy-game.md) | コードドクター〜ダメージ計算式緊急手術（Strategy） | 📝 計画中 | - | 2026-02-02 | 2026-02-02 |
```

---

## 次のステップ

1. ユーザーレビュー → 案の選定
2. `/series-unified-prepare` → 準備（詳細日時決定）
3. `/series-unified-code` → コード実装
4. `/series-unified-write` → 原稿作成
5. `/series-unified-visual` → 挿絵生成（オプション）
6. `/series-unified-review` → 最終レビュー
