---
date: 2026-01-07T23:00:00+09:00
description: シリーズ記事「Commandパターンで学ぶオブジェクト指向設計」の連載構造案3つ（案A/B/C）。テキストエディタ、タスクスケジューラ、REPLを題材とした構成案。
draft: true
epoch: 
image: /favicon.png
iso8601: 2026-01-07T23:00:00+09:00
title: '連載構造案 - Commandパターンで学ぶオブジェクト指向設計（全10回）'
---

# 連載構造案：Commandパターンで学ぶオブジェクト指向設計

調査結果: `content/warehouse/command-pattern.md` に基づく

## 前提情報

- **技術スタック**: Perl v5.36以降（signatures対応）、Moo
- **想定読者**: Perl入学式卒業程度、「Mooで覚えるオブジェクト指向プログラミング」シリーズ（全12回）を読了している
- **想定ペルソナ**: オブジェクト指向の基礎は理解しているが、デザインパターンの実践経験が少ない
- **学習目標**: 「操作」をオブジェクトとして扱う設計思想の習得、Undo/Redo機能の実装
- **位置づけ**: 「Mooで覚えるオブジェクト指向プログラミング」シリーズの続編・応用編
- **ストーリー**: 具体的なアプリケーションを作りながら、自然とCommandパターンに到達する
- **制約**: 1記事1概念、コード例2つまで、完成コードは原則1つのスクリプトファイル

### シリーズ名の制約

- **シリーズ名にはデザインパターンの名前（Command、コマンド）を含めない**
- 実際に作成するプログラム（テキストエディタ、タスクスケジューラなど）の名前を使用する
- 最終回でパターン名を明かす構成にする

### 既存シリーズとの差別化

以下のテーマは既存シリーズで使用済みのため、選択しない：

| シリーズ名 | 使用テーマ | 主なデザインパターン |
|-----------|----------|-------------------|
| シンプルなTodo CLIアプリ | Todo CLI | Command, Repository |
| パスワード生成・管理ツール | パスワードツール | Command, Factory |
| Mooを使ってディスパッチャーを作ってみよう | ディスパッチャー | Strategy |

### 前提知識（前シリーズで習得済み）

| 前シリーズで学んだこと | 本シリーズでの活用 |
|----------------------|-------------------|
| `has`によるプロパティ定義 | Commandクラスの属性（receiver, 状態保存など） |
| `is => 'ro'` / `is => 'rw'` | コマンドの不変性、履歴管理の状態変更 |
| `required`と`default` | コマンドの必須パラメータ設定 |
| カプセル化 | 操作の内部実装の隠蔽 |
| 継承（`extends`） | コマンドクラスの基底クラス（必要に応じて） |
| ロール（`Moo::Role`） | **Command::Role**でインターフェース定義 |
| 委譲（`handles`） | CommandからReceiverへの処理委譲 |
| 型制約（`isa`） | パラメータの型チェック |

---

## 案A: 「テキストエディタでUndo/Redo」アプローチ

### 特徴・アプローチ

テキストエディタの「元に戻す」「やり直す」機能を題材に、操作を履歴として保存する必要性から自然とCommandパターンに到達するアプローチ。Commandパターンの最も代表的なユースケースであるUndo/Redo機能を正面から扱います。

### メリット

- Commandパターンの**真価を最大限に発揮**するテーマ（Undo/Redoの必然性）
- 「操作を記録する」必要性が**直感的に理解**できる
- テキストエディタは身近なアプリケーションで**イメージしやすい**
- execute/undoの**対称性**が明確で、パターンの構造理解が深まる

### デメリット

- Undo/Redoの実装がやや複雑になる可能性
- 文字列操作の細かい処理が増える
- 初心者には「エディタを作る」ハードルがやや高く感じるかも

### 連載構造

| 回 | タイトル | 新しい概念 | ストーリー | コード例1 | コード例2 | 推奨タグ |
|---|---------|-----------|-----------|----------|----------|---------|
| 第1回 | 簡易エディタを作ろう - テキストを編集する | 素朴な実装 | テキストを追加・削除できる最小限のエディタを作成。まずは動くものを作る | Editorクラス（insert, deleteメソッド） | 実行して文字を編集するデモ | perl, moo, text-editor |
| 第2回 | 元に戻したい！ - 履歴の必要性 | 操作履歴の必要性 | 誤って削除した文字を戻したい。単純な方法では難しいことに気づく | 直前の状態を保存する試み | 複数回の操作で破綻するケース | perl, text-editor, undo |
| 第3回 | 操作を記録しよう - 操作オブジェクト | 操作のオブジェクト化 | 「何をしたか」を記録するために、操作自体をオブジェクトにするアイデア | InsertCommandクラス（execute） | 操作を配列に保存 | perl, moo, object |
| 第4回 | 元に戻せるようにする - undoメソッド | undoメソッド | 各操作に「逆操作」を定義することでUndoを実現する | InsertCommand.undo（挿入の逆=削除） | DeleteCommand.undo（削除の逆=挿入） | perl, moo, undo |
| 第5回 | 共通の約束を決める - ロールの活用 | Command::Role | 全ての操作クラスに共通のインターフェースをMoo::Roleで定義 | Command::Role（requires execute, undo） | 各コマンドでwith適用 | perl, moo-role, interface |
| 第6回 | 履歴を管理しよう - Historyクラス | 履歴管理（Invoker） | 操作履歴を管理するHistoryクラスを作成し、Undo/Redoのスタック管理 | Historyクラス（undo_stack, redo_stack） | execute_command, undo, redoメソッド | perl, moo, history |
| 第7回 | やり直しもできる！ - Redo機能 | Redo機能 | Undoした操作をやり直すRedo機能を実装。スタック間の移動を理解 | Historyのredoメソッド実装 | Undo/Redoの連続操作デモ | perl, text-editor, redo |
| 第8回 | 複数操作をまとめる - マクロ機能 | マクロ（Composite） | 複数の操作を1つにまとめて実行・Undoするマクロ機能を実装 | MacroCommandクラス | 複数操作の一括Undo | perl, moo, macro |
| 第9回 | 完成！簡易エディタ - 統合と仕上げ | 統合 | 全機能を統合し、対話的に操作できる簡易エディタを完成 | 完成したエディタスクリプト | 実行例とデモ | perl, text-editor, cli |
| 第10回 | これがデザインパターンだ！ | Commandパターン | 作ったものがGoFの「Commandパターン」だったと明かす。構造と応用を解説 | Commandパターンの構造図 | 他の応用例（CLIツール、ジョブキュー）紹介 | perl, design-patterns, command-pattern |

### 差別化ポイント

- **Undo/Redo特化**: Commandパターンの本質的な価値を最も体感できる題材
- **対称的な操作**: execute/undoの対になる設計が理解しやすい
- **身近なアプリ**: テキストエディタは日常的に使うツールでイメージしやすい

---

## 案B: 「タスクスケジューラを作ろう」アプローチ

### 特徴・アプローチ

タスクを登録して後で実行する「タスクスケジューラ」を題材に、「操作を保存して後で実行する」必要性からCommandパターンに到達するアプローチ。ジョブキューやバッチ処理の基礎を学びながら、コマンドのキューイングと遅延実行を体験します。

### メリット

- 「後で実行」というCommandパターンの**遅延実行の側面**を強調
- ジョブキューやバックグラウンド処理の**基礎概念**を習得
- Undo/Redoより**シンプル**な実装で始められる
- 実務で使われる**バッチ処理の考え方**に通じる

### デメリット

- Undo/Redoほど劇的な「なるほど！」感が少ない
- 時間管理（スケジューリング）の複雑さが入る可能性
- Todo CLIと若干似て見える（ただしタスク≠コマンドで差別化）

### 連載構造

| 回 | タイトル | 新しい概念 | ストーリー | コード例1 | コード例2 | 推奨タグ |
|---|---------|-----------|-----------|----------|----------|---------|
| 第1回 | タスクを登録しよう - スケジューラの始まり | 素朴な実装 | 「後でやること」を登録して実行する最小限のスケジューラを作成 | タスクを配列に登録 | 順番に実行する単純なループ | perl, scheduler, task |
| 第2回 | いろんな種類のタスク - 処理の多様化 | 処理の多様性 | ファイル削除、メール送信など異なる種類のタスクを扱いたい。if分岐が増える問題 | if-elseで処理を分岐 | 分岐が肥大化して困るケース | perl, scheduler, problem |
| 第3回 | タスクをオブジェクトに - クラス化 | タスクのオブジェクト化 | 各タスクを独立したクラスにして、処理内容をカプセル化 | FileDeleteTaskクラス（run） | EmailSendTaskクラス（run） | perl, moo, task-object |
| 第4回 | 共通ルールを決める - ロールの活用 | Task::Role | 全タスククラスに共通のインターフェースをMoo::Roleで定義 | Task::Role（requires run） | 各タスクでwith適用 | perl, moo-role, interface |
| 第5回 | キューで管理しよう - TaskQueueクラス | キュー管理（Invoker） | タスクをキューに登録し、順番に実行するTaskQueueクラスを作成 | TaskQueueクラス（enqueue, process） | タスクの登録と実行デモ | perl, moo, queue |
| 第6回 | 実行結果を記録する - ログ機能 | ログ記録 | 各タスクの実行結果をログとして記録する機能を追加 | 実行履歴の配列管理 | 成功/失敗の記録 | perl, logging, history |
| 第7回 | 失敗したら元に戻す - ロールバック | undo機能 | タスク失敗時に前のタスクを元に戻すロールバック機能を実装 | FileDeleteTask.undo | 連鎖的なロールバック処理 | perl, moo, rollback |
| 第8回 | 優先度をつけよう - 優先度キュー | 優先度管理 | タスクに優先度をつけて、重要なものから実行する機能を追加 | priorityプロパティの追加 | 優先度順の実行ロジック | perl, scheduler, priority |
| 第9回 | 完成！タスクスケジューラ - 統合と仕上げ | 統合 | 全機能を統合し、CLIから操作できるタスクスケジューラを完成 | 完成したスケジューラスクリプト | 実行例とデモ | perl, scheduler, cli |
| 第10回 | これがデザインパターンだ！ | Commandパターン | 作ったものがGoFの「Commandパターン」だったと明かす。構造と応用を解説 | Commandパターンの構造図 | 他の応用例（Undo/Redo、マクロ）紹介 | perl, design-patterns, command-pattern |

### 差別化ポイント

- **遅延実行・キューイング重視**: Commandパターンの「後で実行」側面を強調
- **実務寄り**: ジョブキュー、バッチ処理の基礎として応用が利く
- **シンプルな導入**: Undo/Redoより段階的に機能追加しやすい

---

## 案C: 「対話型シェルを作ろう」アプローチ

### 特徴・アプローチ

REPL（Read-Eval-Print Loop）形式の対話型シェルを題材に、ユーザー入力をコマンドオブジェクトに変換して実行する仕組みを構築。コマンド履歴機能やヘルプ表示など、シェルらしい機能を通じてCommandパターンを学びます。

### メリット

- **対話的な体験**: 実際に入力しながら動作を確認できる
- **コマンド履歴**: 「history」コマンドでCommandパターンの履歴管理を自然に導入
- **拡張性の実感**: 新しいコマンドを追加する際のOCP（開放閉鎖原則）を体験
- **CLIツール制作の基礎**: 将来的なCLIツール開発に役立つ

### デメリット

- REPLの仕組み自体の説明が必要（readline、入力処理など）
- Undo/RedoよりCommandパターンの必然性がやや薄い
- シェルの実装としては簡易的になる

### 連載構造

| 回 | タイトル | 新しい概念 | ストーリー | コード例1 | コード例2 | 推奨タグ |
|---|---------|-----------|-----------|----------|----------|---------|
| 第1回 | 対話型シェルを作ろう - REPLの基本 | REPLループ | ユーザー入力を受け付けて応答する最小限のREPLを作成 | whileループでの入力受付 | 入力に応じた応答 | perl, repl, shell |
| 第2回 | いろんなコマンドを追加 - if分岐の問題 | if分岐の問題 | help, echo, exitなど複数コマンドを追加。if分岐が増えて管理が大変に | if-elseでコマンド分岐 | コマンド追加で分岐が肥大化 | perl, repl, problem |
| 第3回 | コマンドをクラスに - オブジェクト化 | コマンドのオブジェクト化 | 各コマンドを独立したクラスにして処理をカプセル化 | HelpCommandクラス（execute） | EchoCommandクラス（execute） | perl, moo, command |
| 第4回 | 共通の約束を決める - ロールの活用 | Command::Role | 全コマンドクラスに共通のインターフェースをMoo::Roleで定義 | Command::Role（requires execute, name） | 各コマンドでwith適用 | perl, moo-role, interface |
| 第5回 | コマンドを振り分ける - Dispatcherクラス | ディスパッチャー（Invoker） | 入力からコマンド名を解析し、適切なコマンドオブジェクトを実行 | Dispatcherクラス（register, dispatch） | コマンド登録と実行 | perl, moo, dispatcher |
| 第6回 | 実行履歴を記録する - historyコマンド | 履歴記録 | 実行したコマンドを記録し、historyコマンドで一覧表示 | 履歴配列への記録 | HistoryCommandの実装 | perl, repl, history |
| 第7回 | 履歴から再実行 - repeatコマンド | 履歴からの再実行 | 履歴番号を指定して過去のコマンドを再実行する機能 | RepeatCommandの実装 | 履歴参照と再実行デモ | perl, repl, history |
| 第8回 | コマンドの説明を表示 - description活用 | メタ情報の活用 | 各コマンドにdescriptionを持たせ、helpで一覧表示 | descriptionプロパティの追加 | 動的なヘルプ生成 | perl, moo, help |
| 第9回 | 完成！対話型シェル - 統合と仕上げ | 統合 | 全機能を統合し、使いやすい対話型シェルを完成 | 完成したシェルスクリプト | 実行例とデモ | perl, repl, cli |
| 第10回 | これがデザインパターンだ！ | Commandパターン | 作ったものがGoFの「Commandパターン」だったと明かす。構造と応用を解説 | Commandパターンの構造図 | 他の応用例（Undo/Redo、ジョブキュー）紹介 | perl, design-patterns, command-pattern |

### 差別化ポイント

- **対話的体験**: 入力→実行→結果の流れを実際に体験しながら学べる
- **履歴機能**: シェルのhistoryコマンドでCommandパターンの履歴管理を自然に導入
- **拡張性の体験**: 新しいコマンドを追加する際、既存コードを変更せずに済むことを実感

---

## 推薦案とその理由

### 推薦：案A「テキストエディタでUndo/Redo」アプローチ

### 推薦理由

1. **ペルソナとの適合性**
   - 想定読者は「Mooで覚えるオブジェクト指向プログラミング」を読了した中級者
   - Commandパターンの**真価（Undo/Redo）**を体験することで、パターンの必要性を深く理解できる
   - テキストエディタは日常的に使うアプリケーションで、「元に戻す」機能の必要性は直感的に理解できる

2. **検索意図との適合性**
   - 「Perl Undo 実装」「テキストエディタ 作り方」「操作履歴 保存」などの検索に対応
   - Undo/Redo機能は多くのアプリケーションで必要とされる汎用的な機能
   - Commandパターンの**最も代表的なユースケース**であり、パターン学習の王道

3. **学習効果**
   - execute/undoの**対称的な設計**がCommandパターンの構造理解を深める
   - 「操作を記録する」必要性が自然に発生し、パターンの動機付けが強い
   - 最終回で「これがCommandパターンだった！」という**気づきの演出**が効果的

4. **既存シリーズとの連続性**
   - Todo CLI（Commandパターン使用済み）やパスワードツール（Commandパターン使用済み）とは異なるテーマ
   - ディスパッチャーシリーズ（Strategyパターン）との比較も可能（第10回で言及）
   - 「Mooで覚えるオブジェクト指向プログラミング」で学んだMoo::Roleを実践的に活用

5. **内部リンクの活用**
   - [第10回-継承しないで振る舞いを共有](/2025/12/30/163818/)（Moo::Role）
   - [第7回-関連するデータを別のクラスに](/2025/12/30/163815/)（オブジェクトの関連）
   - [第12回-これがデザインパターンだ！](/2026/01/03/001541/)（ディスパッチャーシリーズ、Strategyパターン）

### 代替案の選択指針

- **案B（タスクスケジューラ）が適しているケース**: 
  - Undo/Redoより「遅延実行」「キューイング」を重視したい場合
  - ジョブキューやバッチ処理の基礎を学ばせたい場合
  - よりシンプルな導入を望む場合

- **案C（対話型シェル）が適しているケース**: 
  - 対話的な学習体験を重視する場合
  - CLIツール制作の基礎を広く学ばせたい場合
  - 履歴機能やヘルプ表示など、シェルらしい機能を体験させたい場合

---

## 付記

### シリーズ名の最終決定

各案のシリーズ名候補（Commandパターンの名前を含めない）：

| 案 | シリーズ名候補 |
|---|--------------|
| 案A | 「Mooで作る簡易テキストエディタ」「Undo機能付きエディタを作ろう」 |
| 案B | 「Mooで作るタスクスケジューラ」「後で実行！タスクキューを作ろう」 |
| 案C | 「Mooで作る対話型シェル」「自分だけのREPLを作ろう」 |

### 各タイトル形式

各回のタイトルは「第N回-メインタイトル - サブタイトル」形式を推奨（既存シリーズとの統一）

### 推奨タグの統一

- **シリーズ共通タグ**: `perl`（必須）、アプリ名タグ（例: `text-editor`, `scheduler`, `repl`）
- **パターン関連タグ**: 最終回のみ`design-patterns`, `command-pattern`

### 必要なCPANモジュール

- `Moo` - オブジェクト指向フレームワーク（必須）
- `Types::Standard` - 型制約（オプション）
- 標準モジュールのみで完結することを推奨

### Command::Roleのインターフェース

本シリーズのCommand::Roleで定義するメソッド一覧：

| メソッド | 説明 | 案A | 案B | 案C |
|---------|------|-----|-----|-----|
| `execute()` | コマンドを実行 | ✅ | ✅ | ✅ |
| `undo()` | 操作を元に戻す | ✅ | ✅（オプション） | - |
| `description()` | コマンドの説明 | オプション | オプション | ✅ |
| `name()` | コマンド名 | - | - | ✅ |

### 関連する既存記事への内部リンク

| 関連記事 | 内部リンク | 使用箇所 |
|---------|-----------|---------|
| Mooで覚えるオブジェクト指向プログラミング 第10回（Moo::Role） | `/2025/12/30/163818/` | Command::Role定義時 |
| Mooで覚えるオブジェクト指向プログラミング 第7回（オブジェクトの関連） | `/2025/12/30/163815/` | CommandがReceiverを持つ関係 |
| Mooで覚えるオブジェクト指向プログラミング 第4回・第5回（ro/rw、required） | `/2025/12/30/163812/`, `/2025/12/30/163813/` | Commandクラスの属性定義 |
| ディスパッチャーシリーズ 第12回（Strategyパターン） | `/2026/01/03/001541/` | 第10回でのパターン比較 |

### Strategyパターンとの比較（第10回で言及）

| 項目 | Commandパターン | Strategyパターン |
|-----|----------------|-----------------|
| **目的** | 操作（何をするか）をオブジェクト化 | アルゴリズム（どう処理するか）を差し替え可能に |
| **履歴管理** | 実行履歴を残せる・Undo/Redo可能 | 履歴は不要（処理方式の切替のみ） |
| **使い所** | Undo/Redo、履歴保存、ジョブキュー | アルゴリズム切替、ルーティング |
| **本サイトのシリーズ** | 本シリーズ | ディスパッチャーシリーズ |

---

**作成日**: 2026年1月7日  
**担当エージェント**: perl-monger エージェント  
**調査ドキュメント参照元**: `/content/warehouse/command-pattern.md`

---

## レビュー履歴

### 第1版レビュー（YYYY-MM-DD）

- レビュー担当: 
- 評価結果: 
- 主な改善点: 

### 第2版レビュー（YYYY-MM-DD）

- レビュー担当: 
- 評価結果: 
- 主な改善点: 

### 最終版（第N版）確定（YYYY-MM-DD）

- 最終確認: reviewerエージェント
- 評価: 
