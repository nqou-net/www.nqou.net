# パターンDNA解析: Adapter

> **生成日**: 2026-02-03
> **対象ワークフロー**: `/planning-v3`
> **ステータス**: 提案中

---

## 1. 症状カタログ（問診票）

患者（ユーザーコード）から検出された症状リストです。

| # | 症状名 | 説明 | 深刻度 | 処方候補 |
|---|--------|------|--------|---------|
| 1 | **インターフェース不適合症** | 「使いたいクラス」と「必要なインターフェース」が一致せず、コンパイラや実行環境に拒絶される状態。 | 重症 | Adapter |
| 2 | **API変換散乱症** | データの形式変換（単位変換、フィールド名変更など）を行うコードが、ビジネスロジックの隙間にコピペで散らばっている。 | 中症 | Adapter (Object) |
| 3 | **レガシー統合困難症** | 古いシステム（レガシーコード）を新しいシステムに組み込もうとすると、新しい側のコードを汚染（修正）せざるを得ない。 | 中症 | Adapter (Class) |

---

## 2. DNA解析マップ

処方（デザインパターン）の効果とリスクの分析。

### パターン: Adapter

- **適応症状**:
    - **インターフェースの不一致**: 既存クラスを修正せずに再利用したい。
    - **レガシー移行**: 旧仕様を新仕様に適合させる（またはその逆）。
- **禁忌（処方してはいけないケース）**:
    - **設計段階での不整合**: まだコードがないなら、設計自体を直すべき（インターフェースを合わせる努力をする）。安易なAdapterは設計の不備を隠蔽するだけ。
    - **機能追加のついで**: 単なるインターフェース変換以上の処理（複雑なロジック）をAdapterに詰め込むと、それはもうAdapterではない（DecoratorやProxyに近い）。
- **副作用**:
    - クラス数の増加（変換のためだけのクラスが増える）。
    - 複雑性: 委譲（Object Adapter）の場合、転送処理を書く手間がある。

---

## 3. 治療計画（統合版構造案）

統合版（1記事完結）としての構成案です。

| 案 | 治療方針 | テーマ（題材） | 特徴 |
|---|----------|---------------|------|
| **案A** | **標準治療** | **レトロゲーム入力アダプタ** | 「現行システム」に「古いコントローラ」を繋ぐ。Adapterの最も直感的なメタファーである「変換プラグ」を体感できる。 |
| **案B** | **集中治療** | **決済API統合レイヤー** | 「Stripe」と「PayPay」など異なるAPIを統一インターフェースで扱う。実用的だが、少しコードが複雑になりがち。 |
| **案C** | **予防医学** | **新旧ログフォーマット変換** | テキストログを構造化ログ（JSON）に変換して出力する。シンプルだが、Decoratorとの境界が少し曖昧。 |

### 案A: レトロゲーム入力アダプタ（標準治療プラン）

時代遅れの入力デバイス（古いジョイパッド）を、最新のゲームエンジンで使えるように変換するアダプタを作成します。

**ストーリー構成**:
1. **緊急搬送**: 「先生！実家の押し入れから出てきた『伝説のコントローラ』が、今のSwitch...じゃなかった、最新PCで動きません！」
2. **診断**: 最新ゲームエンジンは `InputEvent` オブジェクトを期待しているが、コントローラは生の `0xAF` 等のビット列を吐き出している。
3. **手術 (Before)**: ゲームループの中に `if (device == LEGACY) { ... >> 4 }` のような変換ロジックが直書きされ、激しい「API変換散乱症」を起こしている。
4. **手術 (After)**: `LegacyController` を包み込む `LegacyAdapter` を作成。変換ロジックをそこに封じ込め、ゲーム側からは「普通の最新コントローラ」として扱えるようにする。
5. **退院**: どんな古いコントローラでも、アダプタさえあれば最新ゲームで遊べる！「排他制御？いや、これは『変換』だ感謝しろ」

**技術的ポイント**:
- **委譲 (Delegation)**: Object Adapterパターンを採用（Perlでは多重継承によるClass Adapterより一般的で安全）。
- **インターフェース**: Perlでのダックタイピング的なインターフェース適合の解説。

**メトリクス目標**:
- **結合度**: ゲームエンジンが具体的コントローラを知らなくて済む。
- **凝集度**: 変換ロジックがアダプタ内に集約される。

---

## 4. 推薦案と理由

### 推薦: **案A (レトロゲーム入力アダプタ)**

**理由**:
1. **メタファーの明確さ**: Adapterは「変換プラグ」「変換コネクタ」のパターンであり、ハードウェア（コントローラ）の接続はそのイメージに合致します。
2. **シリーズの一貫性**: 前回の「Abstract Factory（敵生成）」「Prototype（敵量産）」に続き、ゲーム開発テーマで統一感が出せます。
3. **コードの分かりやすさ**: ビット演算などの「変換」処理が明確で、Adapterの役割（インターフェース合わせ）に集中できます。
