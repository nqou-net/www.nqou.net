# 構造案: Code Doctor Facade Pattern (Smart Home)

> ステータス: 📝 計画中
> 生成日: 2026-02-03
> ターゲット: 統合版（全1回）

## 1. 診断レポート (DNA解析)

### 患者プロファイル
- **氏名**: IoTアプリ開発者 (A氏)
- **主訴**: 「スマートホームアプリの機能追加が辛い。新しいデバイスを追加するたびに、あちこちの画面のコードを修正しています…」
- **性格**: 真面目だが、とりあえず動くコードを書いてしまう癖がある。API仕様書を読むのが苦手。

### 症状カタログ (Symptoms)

| # | 症状名 | 学術名 | 重症度 | 詳細 |
|---|--------|--------|--------|------|
| 1 | **サブシステム露出過多症** | *Subsystem Hyper-Exposure Syndrome* | 重症 | クライアントコード（UI層）が、照明・エアコン・鍵などの各デバイスAPIクラスを直接newしてメソッドを呼んでいる。 |
| 2 | **複雑性隠蔽不能症** | *Complexity Usage Disorder* | 中症 | 「外出モード」を実行するために、照明OFF→エアコンOFF→施錠という10ステップの手順を、UIのボタンクリックイベントハンドラごとかいている。 |
| 3 | **エントリポイント分散症** | *Distributed Entry Point Infection* | 中症 | デバイスの操作ロジックが、メイン画面、設定画面、ウィジェットなど複数の場所に散らばっており、変更時の修正漏れが頻発。 |

### 処方箋 (Prescription)

- **採用パターン**: Facade (窓口)
- **効能**: 複雑なサブシステムへのシンプルなインターフェース（窓口）を提供し、結合度を下げる。
- **用法**: `SmartHomeFacade` クラスを作成し、そこに「外出モード」「帰宅モード」などの高レベルな操作を集約する。

---

## 2. 記事構成案 (統合版)

### タイトル案
コードドクター〜スマートホームAPI地獄緊急手術（Facade）

### 構成プロット

#### Phase 1: 緊急搬送 (Introduction)
- **シーン**: 深夜のコード診療所。
- **患者の訴え**: 「『おやすみモード』を追加したいだけなのに、全画面のコード修正が必要だと言われました…もう限界です」
- **ドクターの診断**: 患者のコードを覗き込む。「これはひどい。UI層がデバイスのドライバ層と直接血管で繋がっているようなものだ。**サブシステム露出過多症**による多臓器不全（変更不能）を起こしている」

#### Phase 2: 精密検査 (Diagnosis)
- **Beforeコード提示**:
  - `LightManager`, `AirConditioner`, `SmartLock` などのクラスが、UIのクリックイベント内で直接呼び出されている。
  - 「外出」ボタンの処理が30行にも及ぶ（各デバイスのエラーハンドリング含む）。
- **助手の解説**: 「これだと、デバイスの仕様が変わったら、画面の数だけ修正が必要になっちゃいますね…」
- **病理診断**:
  1. **密結合**: UIとデバイスがベッタリくっついている。
  2. **ロジック重複**: 同じ「外出」の手順がコピペされている。
  3. **可読性低下**: UIコードがデバイス制御ロジックで埋め尽くされている。

#### Phase 3: 手術執刀 (Surgery)
- **Step 1: 窓口の設置 (The Facade)**
  - `SmartHomeFacade` クラスを導入。
  - ドクター「まずは『執事』を一人雇うのだ。客（UI）は彼に命じるだけでいい」
- **Step 2: 複雑性のカプセル化**
  - `leaveHome()` (外出), `arriveHome()` (帰宅) などのメソッドをFacadeに実装。
  - 複雑なデバイス制御順序やエラー処理をFacade内に移動。
- **Step 3: 血管の繋ぎ変え (Refactoring)**
  - UIコードの30行の処理を `facade.leaveHome()` の1行に置き換え。
  - 助手「わあ、UIのコードがスッキリして、本来の『画面表示』の仕事に集中できるようになりました！」

#### Phase 4: 術後経過 (Prognosis)
- **Afterコード解説**:
  - UIはFacadeのことだけを知っていればいい。
  - 新しいデバイス（例: ロボット掃除機）が増えても、Facadeの中身を書き換えるだけで、UIには影響しない。
- **メトリクス改善**:
  - クライアントコード行数: 70%削減
  - クラス結合度: UIクラスからの依存先がN個→1個に激減
  - 変更容易性: デバイス変更時の修正箇所が1箇所に集約

#### Phase 5: 退院指導 (Conclusion)
- **ドクターの忠告**:
  - 「ただし、Facadeを『神クラス』にしてはいけない。機能が増えすぎたら、Facade自体を分割することを検討するように」
  - 「Facadeはサブシステムを隠蔽するが、アクセスを禁止するわけではない。高度な操作が必要な場合は直接アクセスしても良い（が、推奨はしない）」
- **エピローグ**:
  - 患者「これで安心して眠れます…」
  - 助手「お大事に〜（ドクター、また患者さんに『神クラス』なんて専門用語を使って…でも、優しさですね）」
  - ドクター「…次だ」

---

## 3. 実裝計画

### サンプルコード (Perl)

#### Subsystems (デバイス群)
- `Device::Light`: 照明
- `Device::AirConditioner`: エアコン
- `Device::SmartLock`: 鍵

#### Before (Client)
- UIコード内でこれらを直接インスタンス化し、手続き的に操作。

#### Facade
- `SmartHomeFacade`: サブシステムを保持し、`night_mode()`, `go_out()` 等を提供。

#### After (Client)
- `SmartHomeFacade` をインスタンス化し、メソッドを1つ呼ぶだけ。

### SEO設定
- **Slug**: `code-doctor-facade`
- **Keywords**: デザインパターン, Facade, Perl, リファクタリング, 疎結合
- **Description**: バラバラのサブシステム呼び出しをスッキリ整理！Code DoctorがFacadeパターンを使って、複雑なAPI連携に疲弊したコードを「窓口一つ」で解決する緊急手術を行います。

