# コード検証レポート

- 記事: [Perlで作るダンジョンマスター〜3つのデザインパターンで生成・実行・調整を手で覚える](/2026/02/01/093248/)
- 検証日時: 2026-01-31 22:12:00
- 検証環境: Perl v5.34.1 (darwin-thread-multi-2level)

## サマリー

| 結果 | 件数 |
|------|------|
| ✅ PASS | 0 |
| ⚠️ WARN | 6 |
| ❌ FAIL | 0 |
| ⏭️ SKIP | 4 |

> [!NOTE]
> 全ての警告は `use v5.36` を `use v5.34` + `use feature 'signatures'` に変更したことによる「signatures feature is experimental」警告です。Perl v5.36以上の環境では警告は発生しません。

---

## 第1章: ダンジョンに部屋を追加しよう

### コードブロック 1 (BattleRoom基本実装)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# 戦闘部屋クラス
package BattleRoom {
    use Moo;
    
    has name => (is => 'ro', default => '戦闘の間');
    
    sub enter($self) {
        say "【" . $self->name . "】に入った！";
        $self->_battle();
        say "部屋をクリアした！\n";
    }
    
    sub _battle($self) {
        my @monsters = ('ゴブリン', 'スライム', 'コウモリ');
        my $monster = $monsters[int(rand(@monsters))];
        say "  $monster が現れた！";
        say "  $monster を倒した！";
    }
}

# メイン処理
package main {
    say "=== ダンジョン探索開始 ===\n";
    
    my $room = BattleRoom->new;
    $room->enter;
    
    say "=== 探索終了 ===";
}
```

</details>

<details>
<summary>実行結果</summary>

```
=== ダンジョン探索開始 ===

【戦闘の間】に入った！
  コウモリ が現れた！
  コウモリ を倒した！
部屋をクリアした！

=== 探索終了 ===
```

</details>

**備考**: signatures feature is experimental 警告（v5.34環境）

---

## 第2章: 部屋の種類を増やしたい！

### コードブロック 1 (if/else版create_room)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# 部屋タイプごとの処理（if/else版）
sub create_room($type) {
    if ($type eq 'battle') { ... }
    elsif ($type eq 'treasure') { ... }
    elsif ($type eq 'trap') { ... }
    else { die "Unknown room type: $type"; }
}
# ... (省略)
```

</details>

<details>
<summary>実行結果</summary>

```
=== ダンジョン探索開始 ===

【戦闘の間】に入った！
  コウモリ が現れた！
  コウモリ を倒した！
部屋をクリアした！

【宝物庫】に入った！
  宝箱を発見！
  古びた剣 を手に入れた！
部屋をクリアした！

【罠の間】に入った！
  罠だ！ 閃光！
  ダメージを受けた...
部屋をクリアした！

... (計5部屋を順次処理)

=== 探索終了 ===
```

</details>

**備考**: 正常動作確認

---

## 第3章: 部屋を工場で生産しよう

### コードブロック 1 (Factory Method導入)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# 部屋クラス群 (BattleRoom, TreasureRoom, TrapRoom)
# RoomFactory (registry + create_room)
# ... (Factory Methodパターン実装)
```

</details>

<details>
<summary>実行結果</summary>

```
=== ダンジョン探索開始 ===

【戦闘の間】に入った！
  コウモリ が現れた！
  コウモリ を倒した！
部屋をクリアした！

【宝物庫】に入った！
  宝箱を発見！
  回復薬 を手に入れた！
部屋をクリアした！

... (計5部屋)

=== 探索終了 ===
```

</details>

**備考**: Factory Methodパターンが正常動作

---

## 第4章: 部屋イベントの流れを決めよう

### コードブロック 1 (Template Method導入)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# BaseRoom (Template Method: enter -> _on_enter, _run_event, _give_reward, _on_exit)
# BattleRoom, TreasureRoom, TrapRoom (extends BaseRoom)
# RoomFactory
```

</details>

<details>
<summary>実行結果</summary>

```
=== ダンジョン探索開始 ===

【戦闘の間】に入った！
  スライム が現れた！
  スライム を倒した！
  経験値 47 を獲得！
部屋をクリアした！

【宝物庫】に入った！
  宝箱を発見！
  回復薬 を手に入れた！
部屋をクリアした！

【罠の間】に入った！
  罠だ！ 落とし穴！
  ダメージを受けた...
部屋をクリアした！

=== 探索終了 ===
```

</details>

**備考**: Template Methodパターンが正常動作（報酬システム追加）

---

## 第5章: 難易度を切り替えよう

### コードブロック 1 (Strategy導入)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# DifficultyRole (Strategy Interface)
# EasyDifficulty, NormalDifficulty, HardDifficulty
# BaseRoom (difficulty属性追加)
# 各部屋クラス (difficulty連携)
# RoomFactory (difficulty対応)
```

</details>

<details>
<summary>実行結果</summary>

```
=== ダンジョン探索開始（ハード）===

【戦闘の間】に入った！（ハードモード）
  ゴブリン (強さ: 20) が現れた！
  ゴブリン を倒した！
  経験値 43 を獲得！
部屋をクリアした！

【宝物庫】に入った！（ハードモード）
  宝箱を発見！
  金貨 46 枚を手に入れた！
部屋をクリアした！

【罠の間】に入った！（ハードモード）
  罠だ！ 毒矢！
  29 ダメージを受けた...
部屋をクリアした！

=== 探索終了 ===
```

</details>

**備考**: Strategyパターンが正常動作（難易度による調整が反映）

---

## 第6章: 全パターンでダンジョン生成

### コードブロック 1 (DungeonMaster完成版)

**ステータス**: ⚠️ WARN

<details>
<summary>コード</summary>

```perl
#!/usr/bin/env perl
use v5.36;

# 3パターン統合: Factory Method + Template Method + Strategy
# DungeonMaster統合クラス
```

</details>

<details>
<summary>実行結果</summary>

```
╔══════════════════════════════════════╗
║     ダンジョンマスター               ║
║     難易度: ノーマル                    ║
╚══════════════════════════════════════╝

--- 第1層 ---
【戦闘の間】に入った！
  🗡️ ゴブリン (強さ: 10) が現れた！
  ⚔️ ゴブリン を倒した！
  ✨ 経験値 14 を獲得！
部屋をクリアした！

--- 第2層 ---
【罠の間】に入った！
  ⚠️ 罠だ！ 凍結！
  💥 10 ダメージを受けた...
部屋をクリアした！

... (計5層)

╔══════════════════════════════════════╗
║     🎉 ダンジョン踏破おめでとう！    ║
╚══════════════════════════════════════╝
```

</details>

**備考**: 3パターン統合版が正常動作（絵文字も正しく表示）

---

## 第7章: 新しい部屋と難易度を追加

### コードブロック 1 (ShopRoom追加)

**ステータス**: ⏭️ SKIP

**備考**: 断片コード（既存コード無修正で追加する例示）

### コードブロック 2 (NightmareDifficulty追加)

**ステータス**: ⏭️ SKIP

**備考**: 断片コード（既存コード無修正で追加する例示）

### コードブロック 3 (register呼び出し)

**ステータス**: ⏭️ SKIP

**備考**: 1行のみの例示コード

### コードブロック 4 (悪夢モード実行例)

**ステータス**: ⏭️ SKIP

**備考**: 断片コード（前のコードと組み合わせて実行する例）

---

## 第8章: 振り返り〜3つのデザインパターン

コードブロックなし（まとめ章）

---

## 総評

すべての実行可能なコード例（6件）が正常に動作することを確認しました。

### 注意点

- 記事では `use v5.36` を使用していますが、検証環境は Perl v5.34.1 のため、`signatures` 機能に関する警告が発生しています
- Perl v5.36以上の環境では警告は発生しません
- 記事の想定環境（Perl v5.36以降）では問題なく動作します

### 検証された機能

| パターン | 検証内容 | 結果 |
|---------|---------|------|
| Factory Method | RoomFactory.create_room() によるオブジェクト生成 | ✅ |
| Template Method | BaseRoom.enter() による処理骨格 | ✅ |
| Strategy | DifficultyRole による難易度調整 | ✅ |
| 3パターン統合 | DungeonMaster による完全統合 | ✅ |
