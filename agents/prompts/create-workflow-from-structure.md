# ワークフロー作成プロンプト

連載構造案を元にしたブログ記事作成のためのワークフローを作成してください。

## 入力

- 連載構造案ファイル: `agents/structure/<slug>.md`
- 構造案には以下が含まれる:
  - 連載の全体構成（全N回）
  - 各回のタイトル、新概念、ストーリー、コード例
  - 推薦案（案A/B/Cなど）
  - 技術スタック、対象読者

## 要件

1. **フェーズ分解**: ワークフローをフェーズごとに別のワークフローファイルに分解する
2. **出力形式の選択**: 連載版（複数記事）と統合版（1記事）を選べる構造にする
3. **共通フェーズと固有フェーズ**: 共通処理は共有し、形式ごとの処理は別ワークフローにする

## ワークフロー構造

### エントリポイント

| ワークフロー | 説明 |
|------------|------|
| `/<slug>` | メインエントリポイント（連載版/統合版を選択） |
| `/<slug>-series` | 連載版の全フェーズを順次実行 |
| `/<slug>-unified` | 統合版の全フェーズを順次実行 |

### フェーズ別ワークフロー

| Phase | ワークフロー | 内容 | 共通/固有 |
|-------|------------|------|----------|
| 1 | `/<slug>-prepare` | 準備・公開日時決定 | 共通 |
| 2 | `/<slug>-code` | コード実装・テスト | 共通 |
| 3a | `/<slug>-series-write` | 連載原稿作成（N回） | 連載版 |
| 3b | `/<slug>-unified-write` | 統合原稿作成（1記事） | 統合版 |
| 4a | `/<slug>-series-nav` | ナビゲーション・目次 | 連載版 |
| 5 | `/<slug>-visual` | Mermaid図・挿絵 | 共通 |
| 6 | `/<slug>-review` | レビュー・最終確認 | 共通 |

## 各フェーズの内容

### Phase 1: 準備（共通）

- 構造案ファイルを読み込み
- 推薦案を確認
- 公開日時をユーザーに確認
- 公開スケジュールを生成

### Phase 2: コード実装（共通）

- テストディレクトリ `agents/tests/<slug>/` を作成
- 全コード例を先に実装
- `prove -l t/` でテスト実行・警告なし確認
- 原稿作成前に全コードの動作を保証

### Phase 3a: 連載原稿作成（連載版固有）

- N回分の原稿を作成
- SEO最適化版タイトル・メタディスクリプション使用
- Phase 2のコード例を埋め込み
- ストーリー構成を維持

### Phase 3b: 統合原稿作成（統合版固有）

- N回分をN章構成の1記事に統合
- 章間の接続を滑らかに
- 導入部・まとめを追加

### Phase 4a: ナビゲーション（連載版固有）

- 各記事に連載ナビゲーションを追加
- 前回振り返り・次回予告を追加
- 目次記事を作成

### Phase 5: 図・挿絵（共通）

- 構造案に指定されたMermaid図を追加
- `generate_image` で挿絵を生成
- アイキャッチ画像を生成

### Phase 6: レビュー（共通）

- テスト再実行、記事内コードとの一致確認
- 構造確認、文体チェック、誤字脱字チェック
- frontmatter確認
- 最終確認（連載版: リンク確認、統合版: 章間接続確認）

## 出力ファイル

- ワークフローファイル: `.agent/workflows/<slug>*.md`
- 形式: YAML frontmatter（description）+ markdown

## ワークフローファイル形式

```markdown
---
description: ワークフローの説明（1行）
---

# ワークフロータイトル

> 前: `/前のワークフロー` | 次: `/次のワークフロー`

---

## Step 1: ステップ名

具体的な手順

---

## Step 2: ステップ名

...

---

## 完了後

→ `/次のワークフロー` へ進む
```

## 注意事項

- `// turbo` アノテーションを使用して自動実行可能なコマンドを明示
- 各フェーズの前後関係を明確にする（前: / 次:）
- 共通フェーズは連載版・統合版で共有
- 連載版のみのフェーズは `*-series-*`、統合版のみは `*-unified-*` とする
