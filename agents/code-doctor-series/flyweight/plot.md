# Plot Outline: Flyweight — クローン増殖症候群

## 舞台設定

- **形式**: 往診（患者の居酒屋「炭火 だいき」本店バックヤード）
- **時間帯**: 平日午後（仕込み前の静かな時間）
- **場所の特徴**: バックヤードに業務用PC1台（サーバー兼発注端末）。壁には仕入れ価格表。冷蔵庫から業務用ビールケースが見える。焼き鳥の仕込み途中の串が並んでいる。

---

## I. 往診（Admission）

### シーン概要
河野がシステム相談サイトに「金曜夜にシステムが落ちる」と投稿 → なぜか翌日、仕込み中の店に見知らぬ男女が訪ねてくる。

### 展開
1. **到着**: ドクターとナナコが店の裏口から入ってくる。河野は仕込みの手を止めて「どちら様？」
2. **ナナコの導入**: 「大丈夫ですよ、ここはコード診療所です……あ、いえ、往診ですね」
3. **河野の反応**: 怪訝な顔。「コード？ うちはPerlだけど……まさか営業か？ うちは外注は使わない主義だ」
4. **ドクターの行動**: 河野を無視して勝手にバックヤードのPCの前に座る。画面を見るなり眉をひそめる。
5. **河野の第一印象**: 不審者認定。「おい、勝手に触るな！ うちのシステムだぞ！」

### キー感情
河野: 警戒→困惑。自作システムへのプライド。「俺が作ったんだから問題あるわけない」

---

## II. 触診（Examination）

### シーン概要
ドクターがコードを診て「クローン」と一言。河野は料理の話かと勘違い。ナナコが経営メタファーで通訳。

### 展開

1. **ドクターの診断**: コードを2分ほどスクロール。「……増殖しすぎだ」と呟く
2. **河野の勘違い**: 「増殖？ まさか、うちのデータが漏れて……！」（セキュリティ問題だと思う）
3. **ナナコの通訳（第一段階）**: 「いえ、データ漏洩ではないんです。メニューの情報……たとえば"生ビール 550円"という情報が、テーブルごとに丸ごとコピーされているんです」
4. **河野**: 「当たり前だろ？ テーブル1の注文とテーブル2の注文は**別モノ**だ。客が違うんだから」
5. **ドクター**: 画面を指さして「ビールは……一種類だ」
6. **ナナコの通訳（経営メタファー）**: 「河野さん、食材の仕入れで考えてみてください。生ビールを50テーブル分仕入れるとき、仕入れ先の情報……メーカー名、仕入れ価格、ロット番号って、テーブルごとに別々に管理しますか？」
7. **河野**: 「……するわけねえだろ。仕入れ台帳は1つだ。テーブルごとに必要なのは"何杯頼まれたか"だけだ」
8. **ドクター**: 頷く。「それだ」
9. **河野の理解**: 顔色が変わる。「……待てよ。もしかして俺のコード、テーブルごとにビールの仕入れ台帳まるごと作ってんのか？」

### キーポイント
- 河野が自分の経営知識で自力で問題に気づく瞬間を作る
- ドクターの一言がトリガー、ナナコの経営メタファーがブースター

---

## III. 外科手術（Surgery）

### シーン概要
ドクターがリファクタリング。河野は経営者目線で「コスト削減」として理解していく。

### 展開

1. **Before コード提示**: ドクターが「患部」として注文処理コードを表示。`MenuItem->new(...)` がループ内で毎回呼ばれている
2. **河野の反応**: 「これ、全部newしてんのか……。仕入れで言ったら、ビール1杯売るたびにメーカーに電話してるようなもんじゃねえか」
3. **ドクターの手術開始**: 無言でコードを書き始める。`MenuItemPool`（Flyweightファクトリ）を作成
4. **ナナコの実況**: 「今先生がやっているのは、メニューの"マスター台帳"を作っているところです。仕入れ台帳と同じで、品目ごとに1枚だけ」
5. **After コード提示**: `MenuItemPool->get('生ビール')` で共有オブジェクトを返す。注文は `Order->new(menu_item => $pool->get('生ビール'), table => 5, quantity => 2)` のように
6. **河野の腑に落ちる瞬間**: 「原価管理と同じだ……。"モノの情報"と"取引の情報"を分ける。仕入れ台帳とPOS伝票。俺、店ではちゃんとやってたのに、コードだと全部ごちゃ混ぜにしてたのか」

### 勘違いコメディシーン
- 手術中、河野が気を利かせて仕込み中の焼き鳥を温めてドクターとナナコに出す
- ドクターが焼き鳥を受け取る際にナナコの手を見て、ナナコが取り皿を用意してくれたのを「好意」と受け取り、満足げに頷きながら焼き鳥をほおばる
- ナナコは完全にスルーして河野に「すみません、先生は集中してると周りが見えなくなるんです」
- 河野: 内心（こいつら……何なんだ？）

---

## IV. 退院指導（Prognosis）

### シーン概要
リファクタリング後のメモリ使用量を確認。河野が経営者として「投資効果」を計算し始める。

### 展開

1. **術後確認**: ドクターがメモリ使用量のbefore/afterを表示。3,000オブジェクト→約50オブジェクト（メニュー品目数分のみ）
2. **河野**: 「98%削減か……。食材のロス率をここまで下げたら表彰もんだぞ」
3. **ドクターの報酬要求**: 「対価は……テストだ」
4. **ナナコの補足**: 「先生は金銭ではなく、コードの品質を対価にされるんです。今回でしたら、メニュー変更時にプールが正しく更新されるかのテストを書いていただければ」
5. **河野の決意**: 「テストか……。まあ、仕入れ先変えた時は在庫棚卸しするもんな。それと同じことだろ？」
6. **退場**: ドクターとナナコが去る。河野は一人でPCに向かい、テストコードを書き始める。壁の仕入れ価格表を見ながら「共有……共有か」と呟く。

### キー感情
河野: 感謝→理解→新たな決意。「経営とコードは同じだった」

---

## 舞台設定の整合性チェック

### 往診チェックリスト

- [x] ドクターとナナコが「来て」「帰る」側 → 退場シーンはドクター側
- [x] 河野は自分の場所にいる → バックヤードのPC、仕入れ表、焼き鳥が自然に使える
- [x] クリニック固有の小物は不使用 → O'Reilly本やトリプルディスプレイは登場しない
- [x] 退場シーンの主語 → ドクターとナナコが去り、河野が残る
- [x] 扉の開閉 → 居酒屋バックヤードのドア（特に描写不要）

### 勘違いシーンチェック

- [x] ドクターの行動は論理的か → ナナコが取り皿を用意する動作は自然
- [x] ドクターの受け取り方は自然か → 黙々と食べながら満足げに頷くだけ（言語化しない）
- [x] ナナコの反応 → スルー＋患者への謝罪という定番パターン
- [x] 患者の心理描写 → 外部観察のみ（「何なんだ？」という困惑）
