# Patient Profile: Flyweight

## 患者プロファイル

- **Name**: 河野 大輝（かわの だいき）
- **Age**: 38歳
- **Role**: 居酒屋チェーン「炭火 だいき」3店舗オーナー兼社内システム担当
- **Engineer History**: 独学プログラマー歴5年（Perlメイン。開業前にSIerで3年ほどCOBOLを触った経験あり）
- **Personality**: 豪快で声がでかい。経営者としてのコスト意識は鋭く、食材の原価率は小数点以下まで把握しているが、ITに関しては「動けばOK」のスタンス。人情家で面倒見がいい。
- **Background**: 居酒屋の注文管理を外注すると月額利用料が高いため「自分で作ったほうが安い」と独学でPerlを習得。見よう見まねでオブジェクト指向を取り入れたが、設計パターンの知識はほぼゼロ。3店舗分の注文データを1つのシステムで管理している。
- **First Person**: 「俺」
- **主訴**: 「金曜の夜になると注文システムが重くなって、レジが固まるんだよ。週末が書き入れ時なのに、システムが足を引っ張るって最悪だろ？」
- **来院/往診**: 往診（店舗のバックヤードにあるサーバーPC）

## 診断カルテ（Medical Chart）

### 症状（Symptoms）

| Technical | Medical |
|-----------|---------|
| 各テーブルの注文ごとにメニューオブジェクト（名前、価格、カロリー、画像パス、カテゴリ）をnewで生成。50テーブル×平均20品×3店舗＝最大3,000個の同一内容オブジェクトがメモリ上に存在 | **クローン増殖症候群** — 同一DNAの細胞が際限なく分裂し、体内リソースを圧迫する。臓器（システム）の機能自体は正常だが、増殖した細胞が血管（メモリ）を詰まらせている |
| メニュー価格改定時に全注文オブジェクトを走査して書き換える二次症状 | 転移性データ不整合 — クローン細胞の一部だけ変異し、臓器間で不整合が発生 |
| 週末のピーク時にメモリ使用量がスパイクしプロセスが落ちる | 負荷性ショック — 平時は無症状だが、ストレステスト（繁忙期）で心停止 |

### 病名（Diagnosis）

**クローン増殖症候群（Clone Proliferation Syndrome）**
— Intrinsic State（メニュー品名・価格・属性）とExtrinsic State（テーブル番号・数量・注文時刻）が癒着し、分離不能な状態。

### 処方（Prescription）

**Flyweightパターンによるクローン統合手術**
1. メニューマスターをFlyweightオブジェクトとしてプール化（Intrinsic State分離）
2. 注文データはExtrinsic State（テーブル番号、数量、注文時刻）のみ保持
3. FlyweightFactoryでメニューオブジェクトの生成・キャッシュを一元管理
4. メニュー価格変更はマスター1箇所のみで即時反映

### コメディ要素メモ

- 原価率28%を自慢 → メモリ使用率280%を指摘される
- 「仕入れは一元管理してるのに、なんでコードでは同じものを何百個も仕入れてんだ？」とドクターに言われて固まる
- ナナコの通訳: 「メニューの"仕入れ先"を1つにまとめるようなものですよ。お店でやってらっしゃることと同じです」
- ドクターの勘違いシーン: ナナコが差し入れの焼き鳥を温め直してくれたのを「好意」と受け取り、満足げに頷く
