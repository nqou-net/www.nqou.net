# Input Design: Chain of Responsibility

## 技術制約

- **言語**: Perl v5.36以降（signatures・postfix dereferenceサポート必須）
- **公開日時**: 2026-02-26T07:07:05+09:00

---

## Step 1: テーマ3案

### 案A（王道）: ログ出力レベルのフィルタリング

- **テーマ名**: ログレベル別フィルタリングシステム
- **一行説明**: DEBUG/INFO/WARN/ERRORの各レベルに応じて、適切なハンドラが処理するロギング機構
- **パターンとの接点**: ログレベルに応じて「自分が処理するか、次に回すか」を判断する典型的なChain of Responsibility
- **読者像**: アプリケーション開発でログ管理に悩んだ経験のある中堅エンジニア

### 案B（革新）: バグレポート自動トリアージ

- **テーマ名**: バグレポート自動トリアージシステム
- **一行説明**: 受理されたバグレポートを「重要度判定→担当チーム振り分け→SLA設定→通知」と段階的に処理する
- **パターンとの接点**: 各トリアージステップが「自分の責務を果たしたら次に渡す」連鎖を形成。条件によるスキップも自然に発生する
- **読者像**: チーム開発でバグ管理・チケットワークフローに課題を感じている開発者

### 案C（逆転）: 料理の味付け工程

- **テーマ名**: レシピの味付けパイプライン
- **一行説明**: 料理の「下味→メイン調味→仕上げ→盛り付け」の工程を、各ステップが「自分の出番か判断して実行or次へ」とする
- **パターンとの接点**: 一見順序固定に見えるが、食材によって「この工程はスキップ」「追加工程を挿入」が発生し、動的な連鎖が生まれる
- **読者像**: 技術記事を日常の比喩で理解したい初学者～中級者

---

## Step 2: 患者3案

### 案A（王道・共感型）: 入社3年目のWebエンジニア

- **属性**: 26歳、Webアプリケーション開発者、エンジニア歴3年
- **性格キーワード**: 真面目、几帳面、自己肯定感低め
- **背景**: 社内バグ管理ツールのバックエンドを一人で担当。先輩が退職して引き継いだコードが肥大化し、機能追加のたびにif文が増殖している
- **主訴**: 「新しい条件を追加するたびに全部壊れる気がして、怖くて触れません」
- **コメディポテンシャル**: 変更が怖すぎて、本番コードに触れずに別ファイルにコピーを作り続けた結果、同じ処理が5つも存在する

### 案B（革新・意外型）: ベテランインフラエンジニア

- **属性**: 42歳、インフラ/SRE、エンジニア歴18年
- **性格キーワード**: 豪快、自信家、「動けば正義」
- **背景**: サーバー監視スクリプトを長年育ててきたが、アラート判定の条件分岐が700行を超えた。「Perlなら俺に任せろ」と豪語するが、アプリケーション設計パターンには疎い
- **主訴**: 「最近、俺のスクリプトが俺の言うことを聞かなくなった」
- **コメディポテンシャル**: Perl歴は長いのに`bless`以外のOOP要素をほぼ使ったことがなく、「クラス？ハッシュの名前だろ？」と真顔で言う

### 案C（逆転・ギャップ型）: フリーランスのデザイナー兼コーダー

- **属性**: 33歳、Webデザイナー兼フロントエンド、コーディング歴5年
- **性格キーワード**: お洒落、直感的、完璧主義
- **背景**: 趣味でPerlを始めたが、自分のポートフォリオサイトのフォーム処理（バリデーション→サニタイズ→メール送信→ログ記録）がスパゲッティ化。見た目はこだわるのにコードは無秩序
- **主訴**: 「コードが……美しくないんです。デザインと同じで、整理されていないと気持ち悪くて」
- **コメディポテンシャル**: コードの構造よりインデントの幅やコメントのフォーマットにこだわり、ドクターに「そこじゃない」と一蹴される

---

## Step 3: 症状3案

### 案A（王道・典型症状）: 巨大if-elsif連鎖

- **技術的症状**: バリデーション/判定処理がひとつの関数内に`if-elsif`で30分岐以上。新規条件追加時に全体のテストが必要
- **医療メタファー**: 「**多段塞栓症候群**」— 血管（処理フロー）のあちこちに血栓（条件分岐）が詰まり、どこを通っているか不明
- **重症度**: 重症
- **Before/Afterの見込み**: 巨大分岐 → 各ハンドラクラスに分離、連鎖で処理委譲
- **読者の「あっ」ポイント**: 「このif-elsif、うちのコードにもある……」

### 案B（革新・複合症状）: 責務混在の神メソッド

- **技術的症状**: バリデーション・変換・ログ出力・エラーハンドリングが一つのメソッドに混在。条件分岐だけでなく、副作用も散在している
- **医療メタファー**: 「**多臓器癒着症候群**」— 本来独立すべき臓器（責務）が癒着し、一つを動かすと他も引きずられる
- **重症度**: 重症
- **Before/Afterの見込み**: 神メソッド → 責務ごとのハンドラに分離、必要に応じてチェイン構成を変更可能に
- **読者の「あっ」ポイント**: 「一つの関数で全部やってるの、まさにうちの……」

### 案C（逆転・潜伏症状）: ハードコードされた処理順序

- **技術的症状**: 処理ステップの順序が呼び出しコードに直書きされ、順序変更・ステップ追加に大規模改修が必要。見た目は綺麗に動いているが拡張性がゼロ
- **医療メタファー**: 「**骨化性硬直症**」— 関節（拡張点）が骨化して動かなくなった状態。見た目は問題ないが、姿勢を変えられない
- **重症度**: 中症（現時点では動作するが、変更時に破綻）
- **Before/Afterの見込み**: ハードコード順序 → ハンドラの動的組み立てで順序・構成を柔軟に変更可能
- **読者の「あっ」ポイント**: 「動いてるから大丈夫と思ってたけど、確かに何も足せない……」

---

## Step 4: 多角的評価

### Step-Back思考

> **この記事で読者に持ち帰ってもらいたいこと**:
> 「条件分岐の連鎖を、独立したハンドラの連鎖に変換することで、各ステップの追加・削除・順序変更が自由になる」という設計の転換点を体感してもらう。

### テーマ評価

| 評価軸 | 案A（王道）ログフィルタ | 案B（革新）バグトリアージ | 案C（逆転）料理味付け |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 4 | 3 |
| ② メタファー適合度 | 3 | 4 | 3 |
| ③ コメディ発展性 | 2 | 4 | 4 |
| ④ 教育価値 | 4 | 5 | 3 |
| ⑤ 差別化 | 2 | 4 | 4 |
| **合計** | **15** | **21** | **17** |
| **推奨理由** | 定番だが既視感 | 実務的かつ新鮮 | 意外性高いがCoRの本質が薄れるリスク |

### 患者評価

| 評価軸 | 案A（王道）3年目Web | 案B（革新）ベテランSRE | 案C（逆転）デザイナー |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 3 | 3 |
| ② メタファー適合度 | 3 | 5 | 3 |
| ③ コメディ発展性 | 3 | 5 | 4 |
| ④ 教育価値 | 4 | 4 | 3 |
| ⑤ 差別化 | 3 | 5 | 4 |
| **合計** | **18** | **22** | **17** |
| **推奨理由** | 安定だが新規性不足 | Perl職人×パターン無知のギャップが最高 | 美的感覚のギャグは面白いが深みが出にくい |

### 症状評価

| 評価軸 | 案A（王道）if-elsif連鎖 | 案B（革新）神メソッド | 案C（逆転）ハードコード順序 |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 4 | 4 |
| ② メタファー適合度 | 5 | 4 | 3 |
| ③ コメディ発展性 | 3 | 3 | 3 |
| ④ 教育価値 | 5 | 4 | 4 |
| ⑤ 差別化 | 3 | 4 | 4 |
| **合計** | **21** | **19** | **18** |
| **推奨理由** | CoRの本質を直撃 | 複合的で現実的 | 面白いが中症なので診察のドラマ性が薄い |

---

### 4.3 相乗効果の検討

**最高スコア組合せ: テーマB × 患者B × 症状A**

- **テーマB（バグトリアージ） × 患者B（ベテランSRE）**: ✅ SREがバグトリアージスクリプトを書いているのは極めて自然。サーバー監視のアラート判定をバグ管理にも応用しようとした結果、if-elsifが爆発したシナリオが描ける
- **テーマB（バグトリアージ） × 症状A（if-elsif連鎖）**: ✅ バグの重要度判定・担当振り分けがif-elsifで30分岐以上になるのはリアルそのもの
- **患者B（ベテランSRE） × 症状A（if-elsif連鎖）**: ✅ 「Perl歴18年だがOOPパターンを知らない」→「if-elsifで全部書く」は完璧な説得力。「動けば正義」の信条が症状の原因

**結論**: 3要素の整合性は完璧。組合せ変更の必要なし。

ただし、テーマをより具体化する必要がある。「バグトリアージ」は抽象的すぎるため、患者Bの背景に合わせて **「サーバー監視アラートの段階的エスカレーション」** に絞る。

---

## Step 5: 選定結果

### 採用案

| 要素 | 採用案 | スコア |
|------|--------|--------|
| テーマ | サーバー監視アラートのエスカレーション処理（革新） | 21/25 |
| 患者 | 42歳ベテランインフラエンジニア（革新） | 22/25 |
| 症状 | 巨大if-elsif連鎖（王道） | 21/25 |

- **総合スコア**: 64/75

### 選定理由

テーマの実務性（革新）と患者のギャップ（Perl職人なのにOOPパターンを知らないベテラン）の組合せが、コメディと教育価値の両立を最大化する。症状は王道のif-elsif連鎖を選択し、読者が最も共感しやすく、かつChain of Responsibilityの本質を直撃するケースとした。

### 3要素の整合性

- テーマ × 患者: ✅ SRE歴18年のベテランが、自作の監視スクリプトのアラート判定に苦しむシナリオは完全に自然
- テーマ × 症状: ✅ アラートの重要度判定・エスカレーション先決定がif-elsifで肥大化するのは現実的
- 患者 × 症状: ✅ 「Perlは書けるがクラス設計を知らない」→「全部if-elsifで書く」は説得力抜群

---

## テーマ詳細

- **テーマ名**: サーバー監視アラートのエスカレーション処理
- **一行説明**: 監視システムが検知した異常を「重要度判定→担当者通知→エスカレーション→インシデント記録」と段階的に処理する
- **パターンとの接点**: 各エスカレーションステップが「自分が処理するか、次のレベルに回すか」を判断する典型的なChain of Responsibility
- **読者像**: インフラやバックエンドでアラート処理の実装経験がある開発者
- **差別化**: 既存CoR記事（決済審査、タイムトラベルゲーム）とは異なるインフラ運用ドメイン

## 患者詳細

- **属性**: 42歳、インフラ/SRE、エンジニア歴18年
- **性格キーワード**: 豪快、自信家、「動けば正義」
- **背景**: サーバー監視スクリプトを長年育ててきたが、アラート判定の条件分岐が制御不能に。「Perlなら俺に任せろ」と豪語するが、GoFパターンには「知らん、動くコード書けりゃいいだろ」と無関心
- **主訴**: 「最近、俺のスクリプトが俺の言うことを聞かなくなった」
- **コメディポテンシャル**: Perl歴は長いのに`bless`以外のOOP要素をほぼ使ったことがなく、「クラス？ ハッシュの名前だろ？」と真顔で言い放つ。ドクターの短い技術用語には「お前、俺の後輩か？」と対抗意識。ナナコの丁寧な説明には「嬢ちゃん、わかりやすいな」と素直に感心。

## 症状詳細

- **技術的症状**: アラート判定メソッドが1つの巨大サブルーチンに`if-elsif`で30分岐以上。新しいアラート種別を追加するたびに既存の分岐も壊れる恐れ
- **医療メタファー**: 「**多段塞栓症候群**」— 血管（処理フロー）のあちこちに血栓（条件分岐）が詰まり、血流（データ）がどこを通っているか追跡不能
- **重症度**: 重症
- **Before/Afterの見込み**: 巨大if-elsif分岐 → 各アラートレベルのハンドラクラスに分離し、連鎖で処理を委譲。新規レベル追加はハンドラ追加のみ
- **読者の「あっ」ポイント**: 「このif-elsif地獄、まさにうちのあのスクリプト……」

---

## 不採用案（参考）

### テーマ

| 案 | テーマ名 | スコア | 不採用理由 |
|----|---------|--------|-----------|
| A（王道） | ログレベルフィルタリング | 15/25 | CoRの定番すぎて差別化困難 |
| C（逆転） | 料理の味付けパイプライン | 17/25 | CoRの本質が薄れるリスク |

### 患者

| 案 | 患者像 | スコア | 不採用理由 |
|----|--------|--------|-----------|
| A（王道） | 入社3年目Webエンジニア | 18/25 | 過去記事と類似する若手キャラ |
| C（逆転） | フリーランスデザイナー | 17/25 | Perlとの接点が弱く不自然 |

### 症状

| 案 | 症状名 | スコア | 不採用理由 |
|----|--------|--------|-----------|
| B（革新） | 神メソッド（多臓器癒着） | 19/25 | CoR以外のパターンでも解決可能 |
| C（逆転） | ハードコード順序（骨化性硬直） | 18/25 | 中症のため診察のドラマ性が薄い |
