# Patient Profile

- **Name**: 熱血キッチンエンジニア・タケル (32)
- **Role**: 元料理人 → プログラミングスクール経由で転職1年目。個人でレシピ管理アプリを開発中
- **Engineer History**: 1年（プログラミングスクール6ヶ月 + 実務6ヶ月）
- **Personality**: 情熱的で負けず嫌い。料理に関しては超一流の段取り力を持つが、抽象的な概念の理解がやや遅い。ただし一度「腹落ち」すると驚異的な吸収力を発揮するタイプ。料理の比喩を多用する。
- **First Person**: 「俺」
- **Background**: 10年間フレンチレストランで腕を振るった元シェフ。コロナ禍をきっかけにIT業界へ転職を決意。プログラミングスクールで基礎を学び、現在はWeb系企業に勤務しつつ、副業で「料理人のためのレシピ管理アプリ」を個人開発している。料理の世界では「仕込み→ソース作り→メイン調理→盛り付け」という階層的な段取りを完璧にこなしていたが、それをコードの構造として表現する方法がわからない。
- **Chief Complaint**: 「料理なら10品でも同時に段取り組めるのに、コードだとレシピが3階層になった途端にぐちゃぐちゃになるんです。材料の合計もバグるし、サブレシピを追加するたびに全部書き直しで……料理ならありえない非効率さなんですよ」
- **appearance**: がっしりした体格、短髪。料理人時代の名残でバンダナを巻いている。Tシャツの上にチェックシャツを羽織り、エンジニア風にしているが、腕まくりの仕方が料理人のそれ。

---

# Medical Chart

## 症状 (Symptoms)

- **Technical**: レシピデータをフラットな配列（`@recipes`）に格納し、`$parent_id` フィールドで親子関係を表現。材料の集計は毎回ループでツリーを再構築してから計算。サブレシピの追加・変更のたびに集計ロジックが壊れる。`ref()` チェックでLeafかCompositeかを判定し、処理が分岐。
- **Medical**: 「**骨格溶解型フラット化症候群**」— 本来の骨格（ツリー構造）が溶解し、臓器（データ）が平面上に散乱。毎回外科的に骨を組み立て直してから診察する異常な状態。自然治癒力（=再帰的自己操作）が完全に失われている。

## 病名 (Diagnosis)

**骨格溶解型フラット化症候群**（Skeletal Dissolution Flat-Structure Syndrome）

ツリー構造を保持する骨格が溶解し、全ノードがフラットに散乱。外部からの手動再構築でのみ機能するが、構造変更のたびに再骨折を起こす慢性疾患。

## 処方 (Prescription)

**Composite パターンの移植手術** — 骨格再建術

1. 共通インターフェース（`RecipeComponent`）の定義：Leaf（単一材料）とComposite（サブレシピ）を同一視
2. ツリー構造のオブジェクト化：`$parent_id` による外部管理から、ノード自身が子を持つ内部構造へ
3. 再帰的操作の実装：`calculate_total()` が Leaf では自身の値を返し、Composite では子の合計を再帰的に集計
4. 型チェックの排除：`ref()` 分岐を撤廃し、ポリモーフィズムによる統一呼び出しへ

## タイトル案

**コードドクター【Composite】骨格溶解型フラット化症候群〜レシピツリーの再建術〜**
