# Input Design: Abstract Factory

> **差別化ポイント**: 前日のFactory Method記事（データ連携、1種類のプロダクト生成）と明確に区別。
> Abstract Factoryの核心＝「**関連するプロダクト群（ファミリー）の一貫生成**」を前面に。
> また、ウイスキーテイスティングカード記事（Flyweight×Prototype×Abstract Factory）とはテーマで差別化。

---

## テーマ3案

### 案A（王道）: 社内レポート生成システム
- **一行説明**: PDF・HTML・Markdownの3形式でレポートを出力するシステム
- **パターンとの接点**: 各フォーマットでタイトル部・データテーブル・グラフ記述・フッターが一貫した「ファミリー」を構成。フォーマット間のコンポーネント混在を防ぐ必要がある
- **読者像**: バックエンドエンジニア、社内ツール開発者。テキスト処理はPerlの王道

### 案B（革新）: マルチ環境プロビジョニングツール
- **一行説明**: 開発・ステージング・本番環境でDB接続・API設定・ログ設定・認証方式を一括生成
- **パターンとの接点**: 各環境が「ファミリー」。本番DBに開発用ログレベル(DEBUG)が混入→機密漏洩という致命的事故を防ぐ
- **読者像**: DevOps/SREエンジニア、インフラ担当者

### 案C（逆転）: CLIツールの出力スタイルシステム
- **一行説明**: リッチ（色付き・絵文字）/ シンプル（モノクロ）/ マシン（JSON）の3スタイルで統一出力
- **パターンとの接点**: プログレスバー・テーブル・ヘッダー・エラー表示が各スタイルで一貫必要。CI環境でリッチスタイルの絵文字がログを破壊する
- **読者像**: CLI/ツール開発者、自動化スクリプト作成者。Perlのワンライナー・CLIツール文化と親和性が高い

---

## 患者3案

### 案A（共感型）: 28歳、社内ツール担当、3年目
- **属性**: Webバックエンドエンジニア、エンジニア歴3年
- **性格キーワード**: 真面目、几帳面、全体設計の俯瞰力が不足
- **背景**: 営業部から「レポートをPDFだけじゃなくHTMLでも出して」と言われ対応中。最初はPDFだけだったので問題なかった
- **主訴**: 「HTMLを追加したら、なぜかPDFの出力まで壊れて…触ってないのに」
- **コメディポテンシャル**: 几帳面に条件分岐を書くあまり、人間が読めないネスト地獄に。真面目さが仇になるパターン

### 案B（意外型）: 38歳、DevOps専任、12年目の職人気質
- **属性**: インフラエンジニア→DevOps、エンジニア歴12年
- **性格キーワード**: 職人気質、自信過剰、「俺のコードは壊れない」
- **背景**: シェルスクリプトの限界を感じてPerlでインフラツールを書き直し中。OOPは独学
- **主訴**: 「3つ目の環境を追加しただけで全部死んだ。俺のコードじゃなくてPerlが悪い」
- **コメディポテンシャル**: エラーを直視せず「環境のせい」「言語のせい」にする。コードの問題を指摘されると「運用でカバー」。一人称「俺」

### 案C（ギャップ型）: 32歳、元Webデザイナー転身エンジニア、コード歴2年
- **属性**: デザイナー→フロントエンド→バックエンド挑戦中、コード歴2年
- **性格キーワード**: 美意識が高い、出力の見た目に妥協なし、コード構造は無頓着
- **背景**: 自社CLIツールの「出力が汚い」ことに耐えられず、出力整形システムを自作。出力は美しいがコードはカオス
- **主訴**: 「出力は完璧に美しいのに、CI環境で動かすとログが文字化けして…」
- **コメディポテンシャル**: 「美しいコードより美しい出力」が口癖。UIの整合性は完璧なのにコードのファミリー整合性は無視するダブルスタンダード。一人称「私」

---

## 症状3案

### 案A（典型症状）: 臓器型不適合症候群
- **技術的症状**: 各出力関数内でコンポーネント（タイトル、テーブル、フッター）を直接生成。あるフォーマットのコンポーネント生成コードが別フォーマットの処理に侵食
- **医療メタファー**: 「臓器型不適合症候群」— A型の心臓にB型の血液を送り込んでいる状態
- **重症度**: 中症
- **Before/Afterの見込み**: 関数内にフォーマット判定散在 → AbstractFactory でファミリー単位の一括生成
- **読者の「あっ」ポイント**: 「自分もif文で出力形式を分岐させてた…」

### 案B（複合症状）: 免疫拒絶連鎖反応
- **技術的症状**: 新フォーマット追加のたびに既存の全生成関数に条件分岐追加が必要。既存フォーマットの変更が他に波及。テスト時にフォーマット×コンポーネントの組み合わせ網羅が不可能
- **医療メタファー**: 「免疫拒絶連鎖反応」— 新臓器を移植するたびに全身で拒絶反応が連鎖
- **重症度**: 重症
- **Before/Afterの見込み**: N×Mの条件分岐地獄 → Factoryクラス1つ追加で完了
- **読者の「あっ」ポイント**: 「新機能追加のたびに他のテストが壊れるの、これが原因？」

### 案C（潜伏症状）: 潜伏性クロスマッチ不全
- **技術的症状**: 2ファミリーまでは偶然動作。3つ目追加時にコンポーネント生成順序の暗黙の依存が表面化し、ランダムに誤ったファミリーのコンポーネントが出力に混入
- **医療メタファー**: 「潜伏性クロスマッチ不全」— 少量の輸血なら問題ないが、3人目のドナーで免疫暴走
- **重症度**: 重症（潜伏期間が長く発見が遅れるため最も危険）
- **Before/Afterの見込み**: 2種で問題なし → Factoryで型レベルのファミリー整合性保証
- **読者の「あっ」ポイント**: 「2つまでは動いてたから安心してたのに、3つ目で全部壊れた…これ経験ある」

---

## 多角的評価

### Step-Back思考

**この記事で読者に持ち帰ってもらいたいもの**:
1. Abstract Factoryは「**関連するオブジェクト群の一貫性を保証する**」パターン
2. Factory Method（前日記事）との違い: 1製品の生成委譲 vs **ファミリー全体の一括生成**
3. 「2つまでは動いてた」から「3つ目で爆発」の恐怖を体感→パターン適用の動機

### テーマ評価

| 評価軸 | 案A（レポート生成） | 案B（マルチ環境） | 案C（CLI出力） |
|--------|:---:|:---:|:---:|
| ① 読者共感度 | 4 | 4 | 3 |
| ② メタファー適合度 | 5 | 4 | 3 |
| ③ コメディ発展性 | 3 | 3 | 4 |
| ④ 教育価値 | 5 | 4 | 4 |
| ⑤ 差別化 | 3 | 4 | 5 |
| **合計** | **20** | **19** | **19** |
| **推奨理由** | ファミリー概念を最も明確に示せる | 実務的な恐怖感 | Perl文化との親和性 |

### 患者評価

| 評価軸 | 案A（28歳・新人） | 案B（38歳・DevOps） | 案C（32歳・元デザイナー） |
|--------|:---:|:---:|:---:|
| ① 読者共感度 | 5 | 3 | 4 |
| ② メタファー適合度 | 4 | 4 | 3 |
| ③ コメディ発展性 | 3 | 4 | 5 |
| ④ 教育価値 | 4 | 3 | 4 |
| ⑤ 差別化 | 3 | 4 | 5 |
| **合計** | **19** | **18** | **21** |
| **推奨理由** | 安定の共感キャラ | 職人気質の面白さ | ギャップの破壊力 |

### 症状評価

| 評価軸 | 案A（臓器型不適合） | 案B（免疫拒絶連鎖） | 案C（潜伏性クロスマッチ） |
|--------|:---:|:---:|:---:|
| ① 読者共感度 | 4 | 4 | 5 |
| ② メタファー適合度 | 5 | 4 | 4 |
| ③ コメディ発展性 | 3 | 3 | 4 |
| ④ 教育価値 | 5 | 4 | 4 |
| ⑤ 差別化 | 3 | 3 | 5 |
| **合計** | **20** | **18** | **22** |
| **推奨理由** | 教科書的な明快さ | 変更波及のリアルさ | 潜伏→爆発のドラマ性 |

---

## 相乗効果の検討

### 推奨組合せ: テーマA × 患者C × 症状C（総合スコア: 63/75）

| 組合せ | 整合性 | 理由 |
|--------|:---:|------|
| テーマA × 患者C | ✅ | 元デザイナーが社内レポートの「見た目を美しくしたい」と自発的にシステム構築→超自然 |
| テーマA × 症状C | ✅ | PDF/HTMLの2フォーマットまでは問題なし、Markdown追加で爆発→リアルな展開 |
| 患者C × 症状C | ✅ | 見た目重視でコード構造を軽視→潜伏的問題を見逃す性格と完璧にマッチ |

**ストーリーライン**:
元デザイナーの32歳エンジニアが、社内レポートの「見た目の統一感」にこだわってPDF/HTML出力システムを構築。出力は美しいがコードは混沌。2フォーマットまでは奇跡的に動作していたが、3つ目のMarkdown対応でPDFフッターにMarkdown記法が混入し、全フォーマットが崩壊。「美の整合性」を追求する患者が「コードの整合性」を学ぶ——デザイナー思考とAbstract Factoryの「ファミリーの一貫性」が共鳴する物語。

### 代替組合せ: テーマC × 患者C × 症状C（総合スコア: 62/75）

CLI出力テーマ × 元デザイナーも高い相性。ただしAbstract Factoryの「ファミリー」概念の教育的明快さではテーマAに軍配。

---

## 選定結果

### 採用案
- **テーマ**: 案A「社内レポート生成システム」（20/25・王道）
- **患者**: 案C「32歳・元デザイナー転身エンジニア」（21/25・ギャップ型）
- **症状**: 案C「潜伏性クロスマッチ不全」（22/25・潜伏型）
- **総合スコア**: 63/75

### 選定理由
テーマの教育的明快さ（王道）と患者・症状の意外性（ギャップ × 潜伏）を組み合わせ、「わかりやすいのに記憶に残る」バランスを追求。前日のFactory Method記事（技術責任者 × データ連携 × 癒着）とは患者タイプ・テーマ・メタファーすべてが異なり、連続で読んでも新鮮。

### 3要素の整合性
- テーマ × 患者: ✅ 元デザイナーがレポートの見た目を追求→動機が自然
- テーマ × 症状: ✅ 2フォーマットまで動作→3つ目で崩壊→リアル
- 患者 × 症状: ✅ 見た目重視 × コード構造軽視→潜伏型問題を見逃す性格にマッチ

---

## 不採用案（参考）

| 要素 | 不採用案 | スコア | 不採用理由 |
|------|---------|:------:|-----------|
| テーマ | 案B（マルチ環境） | 19/25 | DevOps寄りで読者層が狭い |
| テーマ | 案C（CLI出力） | 19/25 | ファミリー概念の明快さでAに劣る |
| 患者 | 案A（28歳・新人） | 19/25 | Factory Method記事の患者と類似（年齢・立場） |
| 患者 | 案B（38歳・DevOps） | 18/25 | Singleton記事のインフラリーダーと類似 |
| 症状 | 案A（臓器型不適合） | 20/25 | Factory Methodの「癒着」と近いメタファー |
| 症状 | 案B（免疫拒絶連鎖） | 18/25 | 複合的すぎて1記事で伝えきれないリスク |
