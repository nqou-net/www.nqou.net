# Input Design: Command

## 選定結果

| 要素 | 採用案 | スコア |
|------|--------|--------|
| テーマ | 案B: デプロイ＆ロールバックジョブ（革新） | 21/25 |
| 患者 | 案B: 歴10年のインフラエンジニア（革新） | 21/25 |
| 症状 | 案B: 不可逆の破壊的変更・Undo不在（革新） | 22/25 |

**総合スコア**: 64/75

### 選定理由
「コマンド（命令）」と「取り消し（Undo）」というCommandパターンの真価を最も発揮できるのが「インフラ操作のロールバック」というテーマです。シェルスクリプト感覚でPerlを書くインフラエンジニアが、途中で失敗した際に「元に戻せない」という恐怖（症状）に直面し、Commandパターンによって「操作をオブジェクト（カプセル）化し、履歴に積んでUndoする」というパラダイムシフトを体験する構成が、技術的教育価値とドラマ性の両方で優れています。

### 3要素の整合性
- **テーマ × 患者**: ✅ インフラエンジニアがデプロイツールを自作するのは極めて自然なシナリオ。
- **テーマ × 症状**: ✅ デプロイ中のエラー時に途中まで反映された設定を「安全にロールバックできない」という切実な問題に直結する。
- **患者 × 症状**: ✅ 手続き型のシェルスクリプト的発想では「状態に応じた巻き戻し」が自力実装困難であり、オブジェクト指向の恩恵を最も感じやすい組み合わせ。

---

## テーマ詳細

### 案A（王道）：スマートホームデバイスの集中操作盤
- **一行説明**: エアコン、照明、テレビなどの異なる家電を統一インターフェースで操作するアプリ
- **パターンとの接点**: 各家電（Receiver）に対する「電源ON/OFF」などの操作をCommand化し、リモコンのボタン（Invoker）と紐づける教科書通りの構成。
- **読者像**: デザインパターン初心者、Webアプリケーション開発者

### 案B（革新）：段階的デプロイ＆安全ロールバックツール
- **一行説明**: 複数サーバーへの設定反映やミドルウェア再起動を順に行い、エラー時に巻き戻すジョブツール
- **パターンとの接点**: ひとつひとつのデプロイ工程をCommand化し、成功したCommandを履歴（スタック）に積むことで、失敗時に逆順で `undo()` を呼び出し安全に復旧（ロールバック）させる。
- **読者像**: SRE、インフラエンジニア、バックエンドエンジニア

### 案C（逆転）：飲食店のお散歩オーダー管理ボット
- **一行説明**: 客席からの注文を受け付け、調理場へ伝達し、注文キャンセルにも対応するシステム
- **パターンとの接点**: 「注文伝票」自体をCommandオブジェクトと見立て、ウェイター（Invoker）がシェフ（Receiver）に渡す。現実世界の比喩そのもの。
- **読者像**: 初学者、比喩を用いた概念理解を好む層

---

## 患者詳細

### 案A（王道）：入社2年目の若手「コピペと分岐の量産者」
- **属性**: 24歳、Webアプリ開発、歴2年
- **性格キーワード**: 真面目、力技、その場しのぎ
- **背景**: 次々と増える家電の種類に対応するため、ボタンのクリックイベントの中に直接 `if (type eq 'tv') { ... } elsif (type eq 'light') { ... }` をコピペで書き連ねてしまった。
- **主訴**: 「新しい家電を追加するたびに、巨大なif文を触らなきゃいけなくて、時々テレビを消すつもりが暖房が全開になったりします……」
- **コメディポテンシャル**: コピペの修正漏れによる予測不能なピタゴラスイッチ的動作（例：「おやすみ」ボタンを押すと何故かルンバが暴走する）。

### 案B（革新）：歴10年のインフラ職人「全部オレのシェルスクリプトでやる」
- **属性**: 35歳、インフラ/SRE、歴10年
- **性格キーワード**: 職人気質、手続き型偏重、保守的
- **背景**: サーバー管理の手順をPerlで書き直したが、本質が巨大なサブルーチンの羅列（手続き型）であり、途中でコケた時の復旧手順まで網羅しきれていない。
- **主訴**: 「途中でデプロイが落ちた時に、どのサーバーまで設定を入れたか分からず、手作業で戻してたら本番DBを飛ばしかけました……」
- **コメディポテンシャル**: オブジェクト指向を「回りくどい黒魔術」と毛嫌いしていたのに、Undoの実装を見せられた瞬間に「この黒魔術、ワシにも教えろ！」と手のひらを返す。

### 案C（逆転）：UI/UX至上主義の元フロントエンド
- **属性**: 28歳、フロントエンド出身のフルスタック、歴5年
- **性格キーワード**: 見た目重視、流行りモノ好き、状態管理が苦手
- **背景**: 画面上の「戻る（Undo）」ボタンのアニメーションは完璧だが、裏側のデータをどう戻せばいいか分からず、実は毎回ページごとリロードさせて誤魔化している。
- **主訴**: 「UI的には完璧な『取り消し』ボタンなんです！ でも裏側の処理の戻し方が分からなくて……」
- **コメディポテンシャル**: 見た目は超絶リッチなのに、内部実装がハリボテという巨大なギャップ。

---

## 症状詳細

### 案A（王道）：switch/if-elsif 100連発の渋滞
- **技術的症状**: アクションの種類に応じた巨大な条件分岐が存在し、実行時の手続きと操作対象の知識が密結合している。
- **医療メタファー**: 「神経伝達の多重渋滞異常」
- **重症度**: 中症
- **Before/Afterの見込み**: 巨大な分岐がなくなり、各コマンドが独立したクラスに分割され、呼び出し側は `execute()` を呼ぶだけになる。
- **読者の「あっ」ポイント**: 「処理を追加する時に、元のクラスを1行も書き換えなくていいの！？」というOCP（開放閉鎖の原則）の実感。

### 案B（革新）：不可逆な破壊的変更の垂れ流しとUndoの不在
- **技術的症状**: 状態を変更する処理が直接実行されてしまうため、変更前の状態が失われ、エラー発生時のロールバック（取り消し）手段が存在しない。
- **医療メタファー**: 「不可逆性細胞無秩序書き換え症候群」
- **重症度**: 重症
- **Before/Afterの見込み**: 処理自体をCommandオブジェクトに「カプセル化」し、履歴スタックに積む。失敗時はスタックからPopして順次 `undo()` を呼ぶ堅牢な設計になる。
- **読者の「あっ」ポイント**: 「『操作』そのものをモノ（オブジェクト）として配列に入れておけば、過去に遡って取り消せるのか！」というパラダイムシフト。

### 案C（逆転）：実行パラメータのグローバル引き回し
- **技術的症状**: 操作の発生タイミングと実際の実行タイミングが離れているため、実行に必要な引数をグローバル変数や巨大なハッシュに詰めて、あちこちのサブルーチンをバケツリレーしている。
- **医療メタファー**: 「メタボリック引数不全症」
- **重症度**: 軽症〜中症
- **Before/Afterの見込み**: Commandオブジェクトの生成時（コンストラクタ）にReceiverと必要な引数を渡して保持させ、実行時は引数なしの `execute()` だけで済むようになる。
- **読者の「あっ」ポイント**: 「あらかじめ中身を詰めたカプセルを作って渡せば、後で実行する側は引数の詳細を知らなくていいんだ」という遅延実行の便利さ。

---

## 評価サマリー

### テーマ評価
| 評価軸 | 案A（王道） | 案B（革新） | 案C（逆転） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 4 | 4 |
| ② メタファー適合度 | 3 | 5 | 5 |
| ③ コメディ発展性 | 3 | 4 | 4 |
| ④ 教育価値 | 4 | 5 | 3 |
| ⑤ 差別化 | 2 | 4 | 4 |
| **合計** | **17** | **22** | **20** |

### 患者評価
| 評価軸 | 案A（王道） | 案B（革新） | 案C（逆転） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 4 | 3 |
| ② メタファー適合度 | 3 | 4 | 3 |
| ③ コメディ発展性 | 4 | 5 | 5 |
| ④ 教育価値 | 3 | 5 | 3 |
| ⑤ 差別化 | 2 | 4 | 4 |
| **合計** | **17** | **22** | **18** |

### 症状評価
| 評価軸 | 案A（王道） | 案B（革新） | 案C（逆転） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 4 | 4 |
| ② メタファー適合度 | 4 | 5 | 3 |
| ③ コメディ発展性 | 3 | 4 | 4 |
| ④ 教育価値 | 4 | 5 | 4 |
| ⑤ 差別化 | 2 | 5 | 3 |
| **合計** | **18** | **23** | **18** |
