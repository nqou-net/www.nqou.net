# Patient Profile: Template Method

## 基本情報

- **Name**: 瀬川 律子（せがわ りつこ）
- **Age**: 40歳
- **Role**: 元事務職 → 社内システム開発PM兼プログラマー（コーディング歴3年）
- **First Person**: 「私」
- **Personality**: 手順書マニア、整理整頓の鬼、完璧主義。「まず手順書を作りましょう」が口癖。ExcelとWordで業務を完璧に回してきた自負がある。

## 背景

大手メーカーの総務部で15年間、あらゆる社内申請（経費精算・有給申請・備品購入・出張申請）の手順書を作成・管理してきた「手順書の女王」。紙とExcelで運用していた申請フローをデジタル化するプロジェクトのPMに抜擢され、「どうせなら自分で作ろう」とプログラミングを独学で開始。Perl を選んだ理由は「テキスト処理に強いって聞いたので。申請書もテキストですし」。

3年間コツコツと学び、きっちりサブルーチンに分けたコードを書く。命名規則も丁寧で、コメントも豊富。しかし「複数の処理フローに共通する骨格を抽出する」というオブジェクト指向の発想がなく、経費申請・有給申請・備品購入・出張申請のそれぞれに専用モジュールを作成。中身の85%は同一フローのコピペで、申請種別ごとに微妙に変数名やサブルーチン名が違う「クローン兄弟」が10本並んでいる。

先月「慶弔見舞金申請」を追加した際、既存の経費申請モジュールをコピペして修正したが、承認ルートの書き換え漏れで部長承認が2回走るバグが発生。これを機に「何かがおかしい」と感じ始めた。

## 主訴

「ちゃんとサブルーチンに分けて、コメントもつけて、手順書通りに作ってるんです。なのにコードがどんどん増えていって、1ヶ所直すと他のモジュールも全部直さないといけなくて……私のやり方、何か間違ってるんでしょうか」

## コメディポテンシャル

- 手順書を持参して「これがシステムの仕様書です」と差し出す → A4クリアファイル50枚綴り → ドクターが一瞬だけ目を見開く
- コードの説明をするとき、ホワイトボードに「フローチャート」ではなく「手順書」を書こうとする
- ドクターが「テンプレートメソッド」と言った瞬間、「テンプレート？ 私、テンプレート作るの得意なんです！」と目が輝く → ナナコが「……そのテンプレートとはちょっと違うんですけど、でも近いんですよ！」
- 手順書の経験があるため「共通手順」の概念は直感で理解 → 理解が早すぎてドクターが少し寂しそう（いつもは患者が苦しむのに）

---

# Medical Chart

## 症状 (Symptoms)

### Technical
- 申請種別ごとに独立したモジュールが10本（`ExpenseRequest.pm`, `LeaveRequest.pm`, `EquipmentRequest.pm`, `TravelRequest.pm` ...）
- 各モジュールの処理フローがほぼ同一: `validate_input()` → `check_budget()` → `route_approval()` → `send_notification()` → `archive_record()`
- フローの85%がコピペで、差異は `validate_input()` の検証ルールと `route_approval()` の承認ルートのみ
- 新しい申請種別の追加は既存モジュールのコピペ → 修正漏れが常態化
- 慶弔見舞金申請 追加時に承認ルート修正を漏らし、部長承認が二重実行される重大バグが発生

### Medical Metaphor
「**クローン増殖症候群**」——同一の遺伝子（処理フロー）を持つクローン細胞（モジュール）が無秩序に増殖。各クローンは独自に微小変異（申請種別固有の差異）を起こしているが、本来の「原型細胞（テンプレート）」が存在しないため、治療（修正）はすべてのクローンに個別に施す必要がある。一体を治療し忘れると、変異が悪性化（バグ）して全身に転移する。

## 病名 (Diagnosis)

**クローン増殖症候群（テンプレート原型欠損型）** —— 別名: Template Method 欠乏症

## 処方 (Prescription)

**Template Method パターンによるクローン統合手術**
1. クローン群の遺伝子解析（共通フローの抽出）
2. 原型細胞の培養（基底クラス `AbstractRequest` の作成。共通フローを `process()` テンプレートメソッドとして定義）
3. 変異箇所の特定と分離（`validate_input()`, `route_approval()` を抽象メソッド／フックメソッドとして定義）
4. 各クローンの分化誘導（`ExpenseRequest`, `LeaveRequest` 等をサブクラスとして再構成）
5. 統合後の組織検査（共通テスト＋申請種別ごとの個別テスト）

## タイトル案

**コードドクター【Template Method】クローン増殖症候群〜手順書の女王と共通カルテの処方〜**
