# Plot Outline

## I. 導入 (Admission)

### 状況設定
社内の画像管理システムを担当する僕は、「一覧画面が重い」というクレームに追われていた。画像を表示するだけなのに、サーバーのメモリ使用量が天井知らずに跳ね上がる。深夜、モニターに映るメモリグラフを睨みながら、僕は頭を抱えていた。

### ドクター登場
「呼ばれた気がした」
振り向くと、白衣の人物が無表情で立っていた。隣には穏やかな笑みを浮かべた女性—助手のナナコさんがいる。

ドクターはモニターを一瞥し、呟いた。
「…全身CT、毎回」
初対面の挨拶もなしに何を言っているのか分からず、僕は警戒心を隠せなかった。

ナナコさんが微笑みながら訳してくれる。
「サムネイルを見たいだけなのに、毎回フルサイズの画像を読み込んでいる……そういうことですね、先生」

---

## II. 検査 (Examination)

### 問題特定
ドクターは僕のコードをスクロールし始めた。画像クラスが呼ばれるたびに、コンストラクタで即座にファイルを読み込んでいる箇所で指が止まる。

「直接参照。受付がない」

ナナコさんが続ける。
「患者さんが診察室を通らず、直接CTスキャン室に駆け込んでいるような状態ですね。検査技師さんが過労で倒れそうになっています」

僕は思わず声を上げた。
「で、でも、画像が必要だから読み込んでるだけで…」

ドクターは無言で別の箇所を指差す。アクセスログを取るためのコードが、3つのファイルにコピペされていた。

「権限確認も散在。受付不在の弊害」

---

## III. 処置 (Surgery)

### Before/After構成

ドクターは静かにキーボードに手を伸ばした。

「代理人を立てる」

ナナコさんが解説する。
「本物の画像クラスの前に『受付窓口』を置くんです。受付が必要なときだけ本物を呼び出す。これがProxy Patternですね」

**Beforeコードのポイント:**
- `Image`クラスのコンストラクタで即座にファイル読み込み
- 一覧表示で100枚のサムネイルを出すと、100回のフルサイズ読み込みが発生
- アクセスログが各所にコピペ

**Afterコードのポイント:**
- `ImageProxy`クラスを導入
- サムネイルは軽量なプレースホルダーを返す
- 実際のファイル読み込みは`display_full()`呼び出し時まで遅延
- アクセスログは`ImageProxy`に一元化

ドクターがEnterキーを押すと、メモリグラフが劇的に下がった。

「…術後良好」

---

## IV. 予後 (Prognosis)

### 改善確認
テスト環境で一覧画面を開く。以前は数秒かかっていた表示が、一瞬で完了した。クリックして初めて、フル画像が読み込まれる。

「すごい…こんなに変わるんですね」

ドクターは黙って頷いた。

### 勘違いシーン
ドクターが僕のデスクに紙コップを置いた。中には温かいコーヒーが入っている。

「（え…もしかして、深夜まで頑張った僕を労ってくれてるのか…？）」

ナナコさんがそっと耳打ちする。
「先生、廊下の自販機が故障していてボタンが戻らなくて。2杯出てきたんです」

…なるほど。ただの偶然だった。

### 別れ
「代理人を活用しろ。本物に会う必要がないときは、代理人で済ませる」

ナナコさんが微笑む。
「直接会わなくても済む用件は、窓口で処理する。それだけで負担が軽くなりますよ」

ドクターは静かに白衣を翻し、診療所の闇に消えていった。

僕はコーヒーを一口飲みながら、明日から「受付窓口」を意識した設計を心がけようと決意した。
