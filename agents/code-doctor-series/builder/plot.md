# Plot Outline: Builder Pattern

## I. 導入 (来院)

### 状況設定
平日の昼下がり。患者（42歳テックリード）が、マスクとサングラスで変装してコード診療所を訪れる。匿名で来院したかった——社内では「パターンの先生」として知られているため。

### 患者の心理
- 先週、後輩のPRに「テストデータはBuilderパターンを使うべきだ」とコメント
- 今週、大規模スキーマ変更で自分のテスト50箇所が壊死
- 修正漏れで偽グリーン → 本番障害を見逃す
- 「知っているのにやっていない」矛盾に打ちのめされている

### Key Scene
ドアを開けると、ナナコが「ご予約のテックリードの方ですね？」と呼ぶ。患者は「匿名でお願いしたんですが…」と焦る。ナナコ「大丈夫ですよ、ここはコード診療所です。患者さんのお名前より、コードの症状が大事ですから」。

ドクターは振り返りもせず、画面に向かっている。打鍵が止まる。

「……テスト。何件？」

「ご、50件くらいでしょうか……」

ドクターの肩が微かに揺れた——嘲笑ではなく、何か別の感情に見えた。

---

## II. 検査 (触診・診断)

### 展開
患者がノートPCを開き、テストコードを見せる。

**Before Code提示**: ハッシュリファレンスのコピペが50箇所に散在するテストフィクスチャー。ほぼ同じデータ構造が微妙に異なる値で繰り返されている。

ドクターがスクロールする。どのテストファイルも同じ構造のハッシュリファレンスが冒頭にある。

ドクター：「……コピペ」

ナナコ：「先生がおっしゃっているのは、同じ『組織』が全身にコピーされている状態ですね。50箇所すべてが写し身のような構造です」

患者：「でも、テストデータって毎回少しだけ違う値が必要で……」

ドクター：「壊疽（Gangrene）」

ナナコ：「壊死性筋膜炎ですね。1箇所のスキーマ変更が全身に連鎖する。しかも……」

ドクターが黙ってテスト結果の画面を開く。全テストがグリーン。

ナナコ：「壊死した組織が健康に見える——偽グリーン。本当に恐ろしいのはここですよ」

患者が青ざめる。まさに先週の本番障害の原因がこれだった。

### 核心のシーン
ドクターが無言でブラウザを開く。GitLabの画面。

患者のPRコメントが映し出される。

> 「テストデータはBuilderパターンを使うべきだ。ハードコードされたハッシュはメンテナンス性を著しく損なう。」
> —— 投稿者: 患者本人

沈黙。

患者：「……先生、それは僕のコメントです」

ドクター：（無言で画面をスクロールし、患者自身のテストコードとコメントを並べて表示する）

ナナコ：「先生は、ご自身の診断が正しかったとおっしゃりたいんだと思いますよ。処方箋もご存知なわけですし」

患者：「知っていたのに……自分のコードだけは、特別だと思ってたんです。テストコードは『本番コード』じゃないから、って」

---

## III. 処置 (外科手術)

### 展開
ドクターが黙々とリファクタリングを開始。

**ステップ1: Builder クラスの定義**
ナナコ：「先生は今、テストデータの『レシピ帳』を作っています。デフォルトの材料が入っていて、必要な部分だけ差し替えられるんですよ」

**ステップ2: デフォルト値の設定**
ナナコ：「基本のテストデータが1箇所に集約されました。50箇所のコピペが、たった1つの設計図になりますよ」

**ステップ3: テストコードの書き換え**
50行のハッシュリファレンスが、Builderのメソッドチェインに置き換わる。

患者：「……50行が3行に？」

ナナコ：「テストごとに違う部分だけ指定すればいいんです。デフォルト値は設計図が保証しますから」

**ステップ4: バリデーション**
ドクター：「build() で検証」

ナナコ：「`build()` メソッドが呼ばれた時に、必須項目の漏れや不正な組み合わせを検査します。ハッシュのタイポが黙って通り抜ける恐怖、もうないですよ」

### カタルシスポイント
スキーマ変更のシミュレーション。Builderのデフォルト値を1箇所変更するだけで、全50テストが正しい値に更新される。

患者：「修正したの……1箇所だけ？」

ドクター：「DRY」

ナナコ：「Don't Repeat Yourself。同じことを繰り返さない原則ですね。患者さんが後輩に教えていたことですよ」

---

## IV. 予後 (術後経過)

### 改善確認
テストを実行。全テストグリーン——今度は「本物の」グリーン。偽グリーンが2件検出され、実際のバグを発見・修正。

患者：「偽グリーンが……見つかった。これが本番で障害になるところだったのか」

ナナコ：「Builderで構築すると、データの整合性がbuild時に保証されますから。壊疽の再発防止ですね」

### 勘違いシーン
ドクターが帰り支度をしながら、鞄から1冊の本を取り出した。GoFの「Design Patterns」——かなり年季が入っている。

ドクターはそれを患者の前に置いた。

患者：（もしかして……先生が僕に、自分の愛読書を贈ってくれるのか？ 同じ道を歩む後輩への餞として？）

ドクターがページを開いた。Builderパターンのページに付箋が貼ってある。

ドクター：「ここ。読み返せ」

ナナコ：「……先生、それは貸し出しではなく、ご自分で読み返せという意味ですよね？」

ドクター：（無言で本を鞄に戻す）

ナナコ：「すみません、先生は『知識は十分だから、あとは実践するだけだ』とおっしゃりたかったんだと思います。……先生、本は人に見せびらかすものじゃないですよ」

### クロージング
ドクター：「感謝は、このコードに」

ナナコ：「先生が求めるのはお金ではなく、コード品質へのコミットメントです。テストコードのリファクタリングを続けてくださいね」

患者は一礼して去る。廊下で立ち止まり、スマホを開く。GitLabの自分のコメント「テストデータはBuilderパターンを使うべきだ」を見つめる。

患者の独白：「僕は正しいことを知っていた。ただ、知っているだけでは、何も治せない。処方箋を書ける医者が、自分の薬を飲まなかったのだ」

ドアの向こうで、HHKBの打鍵音だけが小さく聞こえていた。
