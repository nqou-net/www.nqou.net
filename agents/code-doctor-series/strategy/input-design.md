# Input Design: Strategy

## 入力情報

| 項目 | 値 |
|------|-----|
| デザインパターン | Strategy |
| Slug | `strategy` |
| 技術的制約 | Perl v5.36以降、signatures・postfix dereferenceサポート必須 |
| 公開日時 | 2026-02-21T07:07:05+09:00 |
| 既存連載 | 「データエクスポーター」（全10回、2026-01-09） |

---

## Step 1: テーマ3案

### 案A（王道）: EC サイトの送料計算

- **テーマ名**: EC サイトの送料計算ロジック
- **一行説明**: 配送方法（通常/速達/コンビニ受取/冷蔵便）ごとに異なる送料計算を、条件分岐なしで切り替える
- **パターンとの接点**: 配送方法が増えるたびに if-elsif が肥大化する典型的な Strategy 適用ケース
- **読者像**: Web バックエンド開発者、EC サイト運用担当

### 案B（革新）: 音声合成パイプラインのエフェクト切り替え

- **テーマ名**: 音声合成パイプラインのエフェクト戦略
- **一行説明**: ポッドキャスト用の音声後処理（ノイズ除去/リバーブ/ピッチ補正/無加工）を戦略的に切り替える
- **パターンとの接点**: 処理チェインの各ステップで「どのアルゴリズムを使うか」を動的に差し替える必要がある
- **読者像**: DevOps・メディア系エンジニア、音声/映像処理に関わる開発者

### 案C（逆転）: 競馬予想アルゴリズムの切り替え

- **テーマ名**: 競馬予想エンジンのアルゴリズム戦略
- **一行説明**: 過去データ重視/馬場状態重視/オッズ変動重視の予想ロジックを、レース条件に応じて動的に切り替える
- **パターンとの接点**: 「予想する」という行為は同じだが、分析手法がまったく異なる——まさに Strategy の本質「アルゴリズムの交換可能性」
- **読者像**: ギャンブル/データ分析に興味のある読者、趣味プログラマー

---

## Step 2: 患者3案

### 案A（王道・共感型）: 独学3年目の Web エンジニア

- **属性**: 26歳、男性、社内 SE、エンジニア歴3年
- **性格キーワード**: 真面目、完璧主義、融通が利かない
- **背景**: 中小企業の社内ツールを一人で保守。Perl を独学で覚えたが、師匠がいないため「動けばOK」で突き進んできた
- **主訴**: 「新しい機能を追加するたびに、なぜか全然関係ない処理まで壊れるんです……」
- **コメディポテンシャル**: 真面目すぎて「if-elsif は読みやすいから正義」と信じ込んでおり、ドクターの「分離」という一言に「え、今の構造を否定するんですか？」と動揺する

### 案B（革新・意外型）: データサイエンティスト転向組

- **属性**: 34歳、男性、元統計アナリスト → IT企業のバックエンド担当、エンジニア歴2年（前職での Excel VBA 歴は10年）
- **性格キーワード**: 分析好き、理論派、実装が追いつかない
- **背景**: 統計の理論は完璧だが、「コードで設計する」経験が浅い。数式を直接コードに書き下す癖がある
- **主訴**: 「アルゴリズムは5種類あるんですが、どれも同じファイルに全部入っていて、もう自分でも何がどこにあるかわからなくて……」
- **コメディポテンシャル**: 数式やグラフで説明しようとするたびに、ドクターが一言で切り捨てる。「数式は知らん。コードを見せろ」

### 案C（逆転・ギャップ型）: 老舗印刷会社の DX 推進担当

- **属性**: 45歳、女性、印刷会社の DX 推進室長、エンジニア歴0年（完全な非エンジニア・管理職）
- **性格キーワード**: 豪快、行動力抜群、技術は「気合で何とかなる」
- **背景**: 社長から「DX やれ」と一言で任命され、独学で Perl スクリプトを書き始めた。見積書の計算ロジックを自動化したが、割引パターンが増えるたびにスクリプトが崩壊
- **主訴**: 「動いてたスクリプトが、先月の割引キャンペーン追加で完全に死にまして」
- **コメディポテンシャル**: 技術用語を独自解釈し、ドクターが一瞬フリーズする。「リファクタリング？ あぁ、工場のレイアウト変更みたいなもんでしょ？」——しかしその直感が的を射ていて、ナナコが「……合ってますね」と驚く

---

## Step 3: 症状3案

### 案A（王道・典型症状）: if-elsif チェーン肥大化

- **技術的症状**: 1つのサブルーチンに15以上の if-elsif 分岐が詰め込まれ、新しい条件追加のたびにすべての分岐をテストし直す必要がある
- **医療メタファー**: 「条件分岐肥大症」——一本の血管にすべての血液が流れ込み、詰まりかけている状態
- **重症度**: 中症
- **Before/After の見込み**: Before: 1サブルーチン200行の if-elsif → After: 各戦略クラス30行 × N + コンテキスト20行
- **読者の「あっ」ポイント**: 「あ、自分も似たような if-elsif 書いてる……」

### 案B（革新・複合症状）: ハードコードされたアルゴリズム + テスト不能

- **技術的症状**: 複数のアルゴリズムが1つのモジュール内にハードコードされ、個別テストが不可能。さらに、アルゴリズム選択ロジックが呼び出し元に散在している
- **医療メタファー**: 「多臓器癒着症候群」——本来独立すべき臓器（アルゴリズム）が互いに癒着し、一つを触ると全体が連鎖反応を起こす
- **重症度**: 重症
- **Before/After の見込み**: Before: 1モジュール400行、テスト0件 → After: Strategy インターフェース + 具象クラス × N、各クラスに単体テスト
- **読者の「あっ」ポイント**: 「テストが書けないのは自分のコードの問題だったのか……」

### 案C（逆転・潜伏症状）: 見た目は整理されているがオープン・クローズド原則違反

- **技術的症状**: hash のディスパッチテーブルで一見スッキリ整理されているように見えるが、新しい戦略を追加するたびにメインモジュールを修正する必要がある。テストも通っているが、拡張のたびにリグレッションが発生
- **医療メタファー**: 「潜伏性自己免疫疾患」——表面上は健康だが、外部刺激（新機能追加）のたびに免疫系（既存コード）が自分自身を攻撃する
- **重症度**: 軽症（見た目は）→ 実質中症
- **Before/After の見込み**: Before: ディスパッチテーブル + 匿名サブルーチン → After: ロールベースの Strategy パターン、プラグイン的な戦略追加
- **読者の「あっ」ポイント**: 「ディスパッチテーブルで十分だと思ってた……」(中級者に刺さる)

---

## Step 4: 多角的評価

### Step-Back: この記事で読者に何を持ち帰ってもらいたいか

「**条件分岐やディスパッチテーブルで済ませていたアルゴリズムの切り替えを、独立したクラス（ロール）に分離することで、拡張が怖くなくなる**」という体験。Strategy の本質は「アルゴリズムの交換可能性」であり、それを Perl v5.36 の signatures + Moo のロールで実装する具体的な手法を学んでもらいたい。

### テーマ評価

| 評価軸 | 案A（王道: EC送料） | 案B（革新: 音声合成） | 案C（逆転: 競馬予想） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 2 | 4 |
| ② メタファー適合度 | 3 | 3 | 4 |
| ③ コメディ発展性 | 3 | 2 | 5 |
| ④ 教育価値 | 4 | 4 | 4 |
| ⑤ 差別化 | 2 | 4 | 5 |
| **合計** | **16** | **15** | **22** |
| **推奨理由** | 安定だが既視感 | 技術的に面白いが共感弱い | 意外性と娯楽性が高い |

### 患者評価

| 評価軸 | 案A（王道: 独学SE） | 案B（革新: DS転向） | 案C（逆転: DX推進） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 4 | 3 |
| ② メタファー適合度 | 3 | 3 | 4 |
| ③ コメディ発展性 | 3 | 4 | 5 |
| ④ 教育価値 | 4 | 4 | 3 |
| ⑤ 差別化 | 2 | 4 | 5 |
| **合計** | **16** | **19** | **20** |
| **推奨理由** | 共感強いが既視感 | 理論と実践のギャップが面白い | 非エンジニアの直感が光る |

### 症状評価

| 評価軸 | 案A（王道: if-elsif） | 案B（革新: 多臓器癒着） | 案C（逆転: 潜伏性） |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 5 | 3 | 4 |
| ② メタファー適合度 | 4 | 5 | 4 |
| ③ コメディ発展性 | 3 | 3 | 4 |
| ④ 教育価値 | 4 | 5 | 5 |
| ⑤ 差別化 | 2 | 4 | 5 |
| **合計** | **18** | **20** | **22** |
| **推奨理由** | 鉄板だが既視感 | 重症感で医療ドラマ感◎ | 中級者に刺さる意外性 |

---

## Step 5: 最適組合せの選定

### 採用案

- **テーマ**: 案C「競馬予想エンジンのアルゴリズム戦略」（22点）
- **患者**: 案C「老舗印刷会社の DX 推進担当」（20点）
- **症状**: 案C「潜伏性自己免疫疾患」（22点）
- **総合スコア**: 64/75

### 3要素の整合性

- テーマ × 患者: ❌ 印刷会社 DX 推進担当が競馬予想エンジンを作るのは不自然
- テーマ × 症状: ✅ 予想アルゴリズムの切り替えで潜伏的にリグレッションが起きるのは自然
- 患者 × 症状: ✅ 非エンジニアが「動いてるから大丈夫」と思い込み、潜伏症状を見逃すのは説得力がある

> **整合性に問題あり** → 次点の組合せを検討

### 代替組合せ1: テーマC × 患者B × 症状C

- テーマ × 患者: ✅ 元統計アナリストが競馬予想（データ分析）を作るのは極めて自然
- テーマ × 症状: ✅ ディスパッチテーブルで管理していた予想アルゴリズムが、新手法追加で壊れるのはリアル
- 患者 × 症状: ✅ 理論派の DS が「整理したつもり」だが OCP 違反に気づいていない、というギャップが効く
- **総合スコア**: 63/75
- **整合性**: ✅✅✅ 完全に噛み合う

### 代替組合せ2: テーマC × 患者B × 症状B

- テーマ × 患者: ✅ 同上
- テーマ × 症状: ✅ 多臓器癒着（全アルゴリズム1モジュール）も自然
- 患者 × 症状: ✅ 数式をそのままコードに書き下す癖 → 1ファイルに全アルゴリズム → 重症
- **総合スコア**: 61/75
- **整合性**: ✅✅✅ 整合するが、症状が重すぎて記事が長くなるリスク

---

## 最終選定

### 採用: 代替組合せ1（テーマC × 患者B × 症状C）

| 要素 | 採用案 | スコア |
|------|--------|--------|
| テーマ | 競馬予想エンジンのアルゴリズム戦略（逆転） | 22/25 |
| 患者 | 元統計アナリスト → バックエンド担当（革新） | 19/25 |
| 症状 | 潜伏性自己免疫疾患（逆転） | 22/25 |

### 選定理由

テーマの意外性（競馬予想×Strategy）と患者の知的背景（統計のプロがコード設計では素人）の組合せが、「知識はあるのに設計ができない」という多くのエンジニアが経験するギャップを浮き彫りにする。症状はディスパッチテーブルという「中級者の罠」を突くことで、既存の if-elsif 型 Strategy 解説記事との差別化を図る。

### テーマ詳細

- **テーマ名**: 競馬予想エンジンのアルゴリズム戦略
- **一行説明**: 過去データ重視/馬場状態重視/オッズ変動重視の予想ロジックを、レース条件に応じて動的に切り替える
- **パターンとの接点**: 「予想する」という行為は同じだが、分析手法がまったく異なる——Strategy の本質「アルゴリズムの交換可能性」の完璧な適用例
- **読者像**: データ分析・趣味プログラミングに興味のある読者

### 患者詳細

- **名前**: （Phase 1 で決定）
- **属性**: 34歳、男性、元統計アナリスト → IT企業のバックエンド担当、エンジニア歴2年
- **性格キーワード**: 分析好き、理論派、実装が追いつかない
- **背景**: 統計の理論は完璧だが、「コードで設計する」経験が浅い。趣味の競馬予想を Perl で自動化しようとして、5種類の予想アルゴリズムを1つのスクリプトに全部書いた
- **主訴**: 「新しい予想ロジックを追加するたびに、なぜか全然違うロジックの結果まで変わるんです……」
- **コメディポテンシャル**: 数式やグラフで説明しようとするたびに、ドクターが一言で切り捨てる。「数式は知らん。コードを見せろ」。また、競馬予想の的中率を自慢するが、コードの品質は壊滅的

### 症状詳細

- **技術的症状**: hash のディスパッチテーブルで一見スッキリ整理されているように見えるが、新しい予想アルゴリズムを追加するたびにメインモジュールを修正する必要がある。匿名サブルーチンがクロージャとして共有変数を参照しており、追加時に既存ロジックが汚染される
- **医療メタファー**: 「潜伏性自己免疫疾患」——表面上は健康（テストは通る）だが、外部刺激（新アルゴリズム追加）のたびに免疫系（既存コード）が自分自身を攻撃する
- **重症度**: 軽症（見た目）→ 実質中症
- **Before/After の見込み**: Before: ディスパッチテーブル + 匿名サブルーチン（クロージャ共有変数あり） → After: Moo ロールベースの Strategy パターン、各予想アルゴリズムが独立したクラス
- **読者の「あっ」ポイント**: 「ディスパッチテーブルで十分だと思ってたけど、クロージャの変数共有は潜在的なバグの温床だった……」

---

## 評価サマリー

3要素すべてが「逆転」または「革新」アプローチで構成され、既存のコードドクターシリーズ（特に過去の Strategy 連載記事「データエクスポーター」）との明確な差別化を実現。

- **テーマの差別化**: 業務システムではなく趣味の競馬予想という意外な題材
- **患者の差別化**: プログラミング初心者ではなく、統計のプロという「知識はあるが設計経験ゼロ」の独特なポジション
- **症状の差別化**: 典型的な if-elsif ではなく、ディスパッチテーブルという「中級者が陥る罠」

## 不採用案（参考）

### テーマ
- 案A「EC サイトの送料計算」（16点）: 安定だが差別化が弱い
- 案B「音声合成パイプライン」（15点）: 技術的に面白いが読者共感度が低い

### 患者
- 案A「独学3年目の Web エンジニア」（16点）: 共感度は高いが、過去記事の患者像と類似
- 案C「DX 推進担当」（20点）: スコアは高いがテーマとの整合性が取れなかった

### 症状
- 案A「if-elsif チェーン肥大化」（18点）: Strategy の典型例だが、他記事でも扱われがちな題材
- 案B「多臓器癒着症候群」（20点）: 医療ドラマ感は強いが、重症すぎて記事が長くなるリスク
