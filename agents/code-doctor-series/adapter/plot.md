# Plot Architecture

## Story Arc
1.  **Introduction**:
    -   堅実守（45歳）は、長年運用してきた基幹システムの改修プロジェクトリーダー。
    -   トップダウンで「ログ基盤のモダナイゼーション（JSON構造化ログ導入）」が決定。
    -   しかし、既存コード (`Client`) は単純なテキストログ (`LegacyLogger`) に依存しており、その呼び出し箇所は数千行に及ぶ。
    -   守は「全箇所の書き換えはリスクが高すぎる」と絶望している。デグレの悪夢にうなされる日々。

2.  **Diagnosis (The Encounter)**:
    -   コードドクターと助手が現れ、守の苦悩を聞く。
    -   ドクターは、守が「新しいライブラリを使うには、呼び出し元をすべて変えなければならない」と思い込んでいると指摘。「適合不全だ」と呟く。
    -   **診断**: インターフェース不適合症候群。
    -   **助手**: 「無理に呼び出し元を変えようとすると、システム全体が出血（機能不全）を起こします」と穏やかに補足し、守を落ち着かせる。

3.  **Treatment (The Surgery)**:
    -   **処方箋**: Adapter Pattern。
    -   `LegacyLogger` (Target) と `ModernLogger` (Adaptee) の間を取り持つ `LoggerAdapter` を作成する。
    -   `LoggerAdapter` は `LegacyLogger` と同じインターフェース (`log($msg)`) を持ちながら、内部で `ModernLogger` の複雑な形式 (`log(level => 'info', message => $msg)`) に変換して委譲する。
    -   クライアントコードは `LegacyLogger` の代わりに `LoggerAdapter` を注入されるだけで、1行も変更せずに済む。

4.  **Post-Op (Resolution)**:
    -   守は震える手で `LoggerAdapter` を実装し、DIコンテナ（あるいは初期化部分）の設定だけを変更する。
    -   システムを起動すると、既存のログ出力処理がそのまま動き、標準出力には美しいJSONログが流れる。
    -   「コードを書き換えずに、振る舞いを変えた...！」守はAdapterの威力に感動し、安眠を取り戻す。

## Comedy/Metaphor Items
-   **比喩**:
    -   海外旅行での電源プラグ変換アダプター。「コンセントの形状が違うからといって、壁を壊して配線工事をしたりはしないだろう？」
    -   レガシーコードを「古いが頑丈な石造りの建物」、新しいライブラリを「最新の家電」に例える。建物はそのままに、家電を使えるようにする。

-   **キャラクター挙動 (The Misunderstanding)**:
    -   守は変更に対して過剰に防衛的。「if文を一つ足すだけで、バタフライエフェクトでサーバーが爆発するかもしれない」と真顔で心配する。
    -   ドクターが守の肩に手を置く。守は「（私の慎重さを評価してくれている...！）」と感激する。
    -   **オチ**: 実はドクターは守の肩についた糸くずを取っただけ。助手は無言でドクターにコロコロ（粘着クリーナー）を渡す。
