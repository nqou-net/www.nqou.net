# Patient Profile: Memento パターン

## 患者プロファイル

- **Name**: 深川 陽菜（ふかがわ ひな）(28)
- **Role**: フリーランスWeb開発者（エンジニア歴1年半）。元スペシャルティコーヒー専門店バリスタ。
- **Personality**: 感覚派で完璧主義。コーヒーの味は0.1g単位で語れるが、コードの設計は「動けばOK」。アナロジーで物事を理解するタイプで、抽象概念を身近な例に置き換えないと納得できない。明るく人懐っこいが、自分の失敗には落ち込みやすい。
- **Background**: 勤めていたカフェが閉店し、独学でプログラミングを学んでフリーランスに転身。最初の個人プロジェクトとして「焙煎プロファイル管理ツール」をPerlで開発中。焙煎の温度曲線・時間・回転数を記録し、最高の一杯を再現するためのツール。試作のたびにパラメータを微調整するが、「3日前のあの味」に戻せないことに気づいた。
- **First Person**: 「私」
- **Coming Pattern**: 来院（ネット検索で「コード診療所」を見つけてやってきた）

## 診断カルテ

### 症状（Symptoms）

| 区分 | 内容 |
|------|------|
| **Technical** | 焙煎プロファイル（ハッシュリファレンス）を直接上書きし、以前の状態を保持していない。バックアップとして `cp roast_profile.yaml roast_profile_backup.yaml`、`cp roast_profile.yaml roast_profile_v2.yaml`、`cp roast_profile.yaml roast_profile_final.yaml` が大量増殖。どれが「あの日の味」なのか判別不能 |
| **Medical** | **多重記憶喪失症候群**——過去の記憶（状態）が無秩序にコピーされた偽の記憶カプセルとして散乱し、真の記憶を特定できない。記憶の保護膜（カプセル化）が欠損しており、外部から直接書き換え可能な状態 |

### 病名（Diagnosis）

**多重記憶喪失症候群（Multiple Amnesia Syndrome）**

状態の保存と復元の仕組みが欠如し、手動コピーによる偽の記憶カプセルが無秩序に増殖している。本来、記憶（状態）は保護膜（Memento）で包んで外部に預け、必要な時に正確に取り出せなければならない。

### 処方（Prescription）

**Memento パターンの適用**——焙煎プロファイルの状態を Memento オブジェクトとしてカプセル化し、Caretaker が履歴スタックで管理する。任意の時点のスナップショットに正確に復元可能にする。

### 技術的制約

- Perl v5.36以降
- `use feature 'signatures'` による関数シグネチャ
- Postfix dereference（`->@*`, `->%*`）の積極的使用
