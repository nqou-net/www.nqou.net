# Input Design: Memento

## Step-Back: この記事で読者に何を持ち帰ってもらいたいか

「**状態のスナップショットを外部に保存し、いつでも復元できる**」というMementoパターンの本質を、実務的で共感度の高い題材で伝える。既存のMemento記事（ゲームセーブ、Webページ変更、タイムトラベル、Pixelアート）とは**完全に異なる切り口**を採用する。

---

## テーマ3案

### 案A（王道）：テキストエディタの Undo/Redo

- **テーマ名**: テキストエディタの編集履歴管理
- **一行説明**: 自作テキストエディタに Undo/Redo 機能を追加する
- **パターンとの接点**: 編集操作ごとに文書の状態をスナップショットとして保存し、任意の時点へ復元する——Mementoの教科書的ユースケース
- **読者像**: エディタやIDEの内部実装に興味がある中級エンジニア

### 案B（革新）：インフラ構成のスナップショットとロールバック

- **テーマ名**: サーバー構成のスナップショット管理
- **一行説明**: インフラ構成の状態を丸ごと保存し、障害時に安全にロールバックする
- **パターンとの接点**: 複雑なサーバー設定（パッケージ、設定ファイル、ネットワーク構成）の状態を Memento として外部に退避し、問題が起きたら任意の時点に巻き戻す
- **読者像**: DevOps/SREエンジニア、インフラ自動化に関心のある中堅層

### 案C（逆転）：料理レシピの試作履歴管理

- **テーマ名**: レシピ試作の履歴管理ツール
- **一行説明**: 調味料の分量調整を何度も試行錯誤する料理人のために、各試作バージョンを保存・復元するツール
- **パターンとの接点**: レシピの状態（材料・分量・手順）を丸ごとスナップショットとして保存し、「あの時の味に戻したい」を実現する——一見コードと無関係だが、Mementoの「カプセル化された状態の保存と復元」の本質を突く
- **読者像**: 趣味でプログラミングする料理好き、身近な例で設計パターンを学びたい初心者〜中級者

---

## 患者3案

### 案A（王道・共感型）：入社2年目のバックエンドエンジニア

- **属性**: 25歳、Webアプリ開発者、エンジニア歴2年
- **性格キーワード**: 素直、がんばり屋、やや自信過剰
- **背景**: 社内ツールの管理画面を開発中。フォームに入力した設定値を間違えて保存してしまい、「元に戻したい」機能がないことに気づいた
- **主訴**: 「設定を間違えて上書きしちゃって、前の値が何だったか思い出せないんです……」
- **コメディポテンシャル**: 「僕、Ctrl+Z が効かない世界なんて考えたことなかったです」という世代ギャップ系ボケ

### 案B（革新・意外型）：10年選手のPerlハッカー

- **属性**: 35歳、社内ツール開発者、エンジニア歴10年
- **性格キーワード**: 職人気質、頑固、grep芸人
- **背景**: 自作のCLIツールで設定ファイルのマイグレーション処理を書いているが、途中で失敗した時に元に戻す手段がない。「ファイルを先にcpしておけばいい」で10年やってきた
- **主訴**: 「バックアップは取ってるよ。cpで。何が悪いんだ？」
- **コメディポテンシャル**: 「cp before.txt before_before.txt」「before_before_really_final.txt」が増殖するカオス。ドクターの寡黙さと職人気質が共鳴し、無言で通じ合う場面

### 案C（逆転・ギャップ型）：元バリスタのフリーランスエンジニア

- **属性**: 28歳、フリーランスWeb開発者、エンジニア歴1年半
- **性格キーワード**: 感覚派、アナロジー好き、完璧主義
- **背景**: カフェの在庫管理Webアプリを個人開発中。豆の焙煎プロファイル（温度・時間・回転数）を何度も微調整するが、「3日前の設定に戻したい」ができない
- **主訴**: 「あの日のベストな焙煎プロファイルに戻したいのに、上書きしちゃったんです……」
- **コメディポテンシャル**: コーヒーの比喩が止まらず、ドクターの専門用語とコーヒー用語が噛み合わない。ナナコが「豆で例えると」と翻訳するたびに患者が「それ！」と食いつく

---

## 症状3案

### 案A（王道・典型症状）：状態の直接上書き（履歴なし）

- **技術的症状**: ハッシュの値を直接上書きしており、以前の状態を保持する仕組みがない。`$config->{key} = $new_value` で旧値が消失する
- **医療メタファー**: 「記憶喪失症候群」——過去の記憶（状態）が完全に失われ、現在の一瞬しか知覚できない
- **重症度**: 中症
- **Before/Afterの見込み**: Before: ハッシュ直接書き換え → After: Mementoオブジェクトに状態を保存し、スタックで履歴管理、任意の時点に復元可能
- **読者の「あっ」ポイント**: 「自分も設定変更時に前の値を保存してないな……」

### 案B（革新・複合症状）：cp地獄とファイル名カオス

- **技術的症状**: 状態保存を `cp` コマンドやファイルコピーで代替しており、`_backup`, `_old`, `_v2`, `_final` が増殖。復元時にどれが正しいか不明
- **医療メタファー**: 「多臓器クローン暴走」——本体のコピーが無秩序に増殖し、どれがオリジナルか判別不能
- **重症度**: 重症
- **Before/Afterの見込み**: Before: ファイルコピーによる手動バックアップ → After: Memento パターンで構造化された履歴スタック、タイムスタンプ付きスナップショット
- **読者の「あっ」ポイント**: 「final_final_v2.txt あるわ……」

### 案C（逆転・潜伏症状）：浅いコピーによる偽スナップショット

- **技術的症状**: 履歴保存を試みているが浅いコピー（参照コピー）のため、保存した「過去の状態」が現在の変更に引きずられて壊れる
- **医療メタファー**: 「偽記憶移植症候群」——記憶を保存したつもりが、実は現在の記憶に書き換えられている。復元すると「思っていた過去」と違う
- **重症度**: 重症（本人は「保存している」と思い込んでいるため発見が遅れる）
- **Before/Afterの見込み**: Before: 浅いコピーで履歴配列に push → After: Memento パターンで深いコピーによる真のスナップショットを保証
- **読者の「あっ」ポイント**: 「配列に push して履歴管理してるつもりだったのに、全部同じ値になってる……！」

---

## 評価

### テーマ評価

| 評価軸 | 案A（王道）エディタ | 案B（革新）インフラ | 案C（逆転）レシピ |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 3 | 5 |
| ② メタファー適合度 | 3 | 4 | 5 |
| ③ コメディ発展性 | 2 | 3 | 5 |
| ④ 教育価値 | 5 | 4 | 4 |
| ⑤ 差別化 | 2 | 4 | 5 |
| **合計** | **16** | **18** | **24** |

### 患者評価

| 評価軸 | 案A（王道）若手 | 案B（革新）ベテラン | 案C（逆転）元バリスタ |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 4 | 4 |
| ② メタファー適合度 | 3 | 4 | 5 |
| ③ コメディ発展性 | 3 | 5 | 5 |
| ④ 教育価値 | 4 | 3 | 4 |
| ⑤ 差別化 | 2 | 4 | 5 |
| **合計** | **16** | **20** | **23** |

### 症状評価

| 評価軸 | 案A（王道）直接上書き | 案B（革新）cp地獄 | 案C（逆転）浅いコピー |
|--------|:-----------:|:-----------:|:-----------:|
| ① 読者共感度 | 4 | 5 | 4 |
| ② メタファー適合度 | 4 | 5 | 5 |
| ③ コメディ発展性 | 2 | 5 | 4 |
| ④ 教育価値 | 4 | 3 | 5 |
| ⑤ 差別化 | 3 | 5 | 4 |
| **合計** | **17** | **23** | **22** |

---

## 相乗効果の検討

### 最高スコア組合せ: テーマC（レシピ）× 患者C（元バリスタ）× 症状B（cp地獄）

- テーマ × 患者: ✅ 元バリスタが焙煎プロファイルの管理ツールを作る——カフェ経験を活かした個人開発として自然
- テーマ × 症状: ✅ レシピの試作データを `cp profile_v3_final.yaml profile_v3_final_really.yaml` でバックアップ——非エンジニア出身者がやりがちなパターンとしてリアル
- 患者 × 症状: ✅ プログラミング歴1年半の元バリスタが `cp` で乗り切ろうとするのは説得力がある

> **不整合なし**。最高スコア組合せがそのまま最適。

### 次点検討: テーマC × 患者B（ベテラン）× 症状B

- 患者 × テーマ: ⚠️ 10年選手のPerlハッカーが焙煎プロファイルを管理？ やや不自然
- → 却下。組合せとしての整合性で最高スコア案が優位

---

## 選定結果

| 要素 | 採用案 | スコア |
|------|--------|--------|
| テーマ | レシピ試作の履歴管理ツール（逆転） | 24/25 |
| 患者 | 元バリスタのフリーランスエンジニア（逆転） | 23/25 |
| 症状 | cp地獄とファイル名カオス（革新） | 23/25 |
| **総合** | | **70/75** |

### 選定理由

テーマの意外性（料理×プログラミング）と患者の独特な背景（バリスタ→エンジニア転身）が組み合わさることで、既存のMemento記事群（ゲーム・Web・Pixel系）とは完全に差別化できる。症状は「cp地獄」を採用し、エンジニアなら誰しも経験のある `final_final_v2` 問題で強い共感を得つつ、コメディ発展性も高い。コーヒー用語と技術用語の翻訳ギャップで、ナナコの通訳役が活きる。

### 3要素の整合性

- テーマ × 患者: ✅ 元バリスタが焙煎管理ツールを個人開発——自然な動機
- テーマ × 症状: ✅ 試作データの手動バックアップが増殖——あるある
- 患者 × 症状: ✅ エンジニア歴浅い元バリスタが cp で凌ごうとする——リアル

---

## 不採用案（参考）

| 要素 | 案 | スコア | 不採用理由 |
|------|-----|--------|-----------|
| テーマ | 案A エディタ Undo/Redo | 16/25 | 教科書的すぎて差別化困難 |
| テーマ | 案B インフラスナップショット | 18/25 | Commandパターン記事（2/25公開）とテーマが近い |
| 患者 | 案A 入社2年目 | 16/25 | 個性が弱い |
| 患者 | 案B 10年選手 | 20/25 | 高スコアだが「レシピ」テーマとの相性で次点 |
| 症状 | 案A 直接上書き | 17/25 | 単純すぎてコメディ展開が乏しい |
| 症状 | 案C 浅いコピー | 22/25 | 僅差だがcp地獄の方がビジュアル的に面白い |
