# Plot Outline: Prototype

## I. 導入 (Admission) — 来院

### 状況設定
患者・三橋彩香（34）はSIerのサブリーダー。10年間育てた「ドキュメント生成ツール」に新フィールド追加の要望が入り、17種類のテンプレートすべてのコンストラクタを手修正する羽目に。3箇所修正漏れで障害報告書が壊れた翌日、同僚の勧めでコード診療所を訪れる。

### 感情
自負と焦り。「設計は正しいはずなのに」という困惑。マスクはせず堂々と来院（自分のコードに問題はないと思っている。本当は環境の問題ではないかと疑っている）。

### ドクター登場
診療所のドアを開けると、O'Reilly本の壁。トリプルディスプレイの前に座る男の背中。HHKBの打鍵音が止まる。
ドクターは振り返らず一言：「……何種類？」
患者は一瞬面食らう。ナナコが「テンプレートの種類数をお聞きしていますよ」とフォロー。
「17……種類、です」
ドクターの肩が微かに揺れた。

---

## II. 検査 (Examination) — 触診

### 展開
ドクターが椅子を回転。患者のノートPCを見る。コードをスクロール。17個のクラスに、ほぼ同じ構成のコンストラクタが並んでいる。

### ドクターの反応
指がピタリと止まる。
「……17回。毎回 `new`」（眉をしかめる）

### ナナコの通訳
「先生がおっしゃっているのは、17の臓器を毎回ゼロから培養している状態ですね。共通の遺伝子——つまり共通フィールドが、すべての臓器にハードコーディングされています。1つの遺伝子変異——フィールド追加が、17臓器すべてに転移するんです」

### 患者の反応
「でも、これは設計書通りなんです。各テンプレートは独立しているべきで——」
ドクターが無言でコードの一部をハイライト。shared_fields のハッシュリファレンス。全テンプレートで同一の値。

「……全部おなじ」

患者は赤面する。

### shallow copy の発見（副症状）
ドクターがさらにスクロール。あるテンプレートで `metadata` フィールドをハッシュリファレンスとして format サブルーチンに渡している箇所。
「……癒着」
ナナコ：「shallow copy ですね。ハッシュリファレンスの浅いコピーで、ネストされたデータ構造が参照を共有しています。一方を変更すると、もう一方も壊れます——臓器の癒着です」
患者：「え……そこ、バグ出てませんけど……」
ドクター：「……まだ」
ナナコ：「時限爆弾ですね」

---

## III. 処置 (Surgery) — 処方箋

### 展開
ドクターが黙々とコードを書き始める。

### Before Code の提示
患者のコード（17個のnew + 全フィールドハードコード）を画面に表示。

### 手術の流れ
1. **プロトタイプの定義**: 共通フィールドを持つ「原型（Prototype）」オブジェクトの作成
2. **Registryの構築**: プロトタイプレジストリに「議事録」「日報」「週報」「障害報告書」等の原型を登録
3. **clone メソッド**: deep clone でネスト構造も含めた完全複製
4. **カスタマイズ**: clone 後に案件固有の情報だけ差し替え

### ナナコの解説
各ステップごとにナナコが患者に解説。
「今、先生が作っているのは "原型の保管庫" ——プロトタイプレジストリですね。17種類の設計図を毎回引き直すのではなく、完成品を1つ保管して、必要な時にクローンするんです」

### After Code の提示
リファクタリング後のコード。17個のnewが消え、Registry からの clone + customize に置き換わる。

### カタルシスポイント
患者：「……17個の `new` が消えた？」
ナナコ：「フィールド追加はプロトタイプを1箇所変えるだけ。17臓器が自動的に最新の遺伝子を持つようになりますよ」

### shallow copy の治療
ドクターが clone メソッド内の deep copy 処理を指差す。
「……深層まで」
ナナコ：「clone の際にネスト構造も再帰的にコピーしています。癒着——参照共有の時限爆弾も、これで除去されましたよ」

---

## IV. 予後 (Prognosis) — 術後経過

### 改善確認
テスト実行。全パス。フィールド追加テスト：プロトタイプに1フィールド追加 → 全テンプレートに反映。修正箇所：1箇所のみ。

### 勘違いシーン（テーマ連動：Prototype = 複製）
患者がノートPCを閉じ、帰り支度を始める。PCを鞄にしまう際、天板に貼っていた付箋メモが滑り落ちる。ドクターがそれを拾い、一瞬眺めてから天板に貼り直す。

患者の心の声：（先生が……私のメモを読んだ？ まさか、私のアイデアを記憶した（clone した）のでは……！？ いや、先生ほどの人が私のメモに興味を……でも、あの一瞬の眼差し……）

ナナコ（苦笑）：「先生は単にメモを拾っただけですよ。風で飛ばないように戻しただけかと……」

ドクター（既にディスプレイに向き直っている。視線が一瞬泳ぐ）。

### 別れ
ドクターが背を向けたまま一言：「感謝は、このコードに」

ナナコ：「先生が求めるのはお金ではなく、コード品質へのコミットメントです。17個の new を、もう増やさないでくださいね。お大事に」

### 患者の決意
重厚な鉄の扉を押して廊下に出ると、打鍵音が遮断される。

患者は廊下で立ち止まり、スマホを開く。10年間育てた「最高傑作」。その設計図は——たった1つの原型と、clone と、差分だけのカスタマイズに集約された。

「完璧な設計図」を信じていた。でも本当に完璧だったのは、「完成品を複製して、違うところだけ変える」というシンプルな原則のほうだった。

17種類の子供たちは、もう独立して生きていく。原型の遺伝子を受け継ぎながら、それぞれの個性だけを纏って。
