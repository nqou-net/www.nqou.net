<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ASCIIアートの巨大文字を表示しながら、Singleton・Flyweight・Proxyの3パターンを実践。Mooで書くPerlデザインパターン入門。"><title>Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）</title><link rel=canonical href=https://www.nqou.net/2026/02/02/004531/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）"><meta property='og:description' content="ASCIIアートの巨大文字を表示しながら、Singleton・Flyweight・Proxyの3パターンを実践。Mooで書くPerlデザインパターン入門。"><meta property='og:url' content='https://www.nqou.net/2026/02/02/004531/'><meta property='og:site_name' content='設計パターンを疑え'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='perl'><meta property='article:tag' content='moo'><meta property='article:tag' content='perl-design-patterns'><meta property='article:tag' content='singleton-pattern'><meta property='article:tag' content='flyweight-pattern'><meta property='article:tag' content='proxy-pattern'><meta property='article:tag' content='object-oriented'><meta property='article:tag' content='ascii-art'><meta property='article:tag' content='hands-on'><meta property='article:tag' content='tutorial'><meta property='article:published_time' content='2026-02-02T00:45:31+09:00'><meta property='article:modified_time' content='2026-02-02T00:45:31+09:00'><meta property='og:image' content='https://www.nqou.net/public_images/2026/singleton-flyweight-proxy-series-image.jpg'><meta name=twitter:title content="Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）"><meta name=twitter:description content="ASCIIアートの巨大文字を表示しながら、Singleton・Flyweight・Proxyの3パターンを実践。Mooで書くPerlデザインパターン入門。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nqou.net/public_images/2026/singleton-flyweight-proxy-series-image.jpg'><link rel="shortcut icon" href=/favicon.png><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap';:root{--base-font-family:Arial, "Noto Sans JP", sans-serif}</style><link rel=stylesheet href=/css/linkcard.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3923446804785015" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js defer></script><script defer>document.addEventListener("DOMContentLoaded",function(){try{typeof mermaid!="undefined"&&document.querySelector(".mermaid")&&mermaid.initialize({startOnLoad:!0,securityLevel:"strict"})}catch(e){console.warn("Mermaid failed to initialize:",e)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-E50H9ESN7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E50H9ESN7E")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/public_images/blog-nqounet-square.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>設計パターンを疑え</a></h1><h2 class=site-description>名前の嘘を暴き、意図で設計を語る</h2></div></header><ol class=menu-social><li><a href=https://github.com/nqounet target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/nqounet target=_blank title=X rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/advent-calendar-2025/><svg class="icon icon-tabler icon-tabler-calendar" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><path d="M8 15h.01"/><path d="M12 15h.01"/><path d="M16 15h.01"/><path d="M8 19h.01"/><path d="M12 19h.01"/><path d="M16 19h.01"/></svg>
<span>Perl Advent Calendar 2025 - AI Edition</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/warehouse/><svg class="icon icon-tabler icon-tabler-warehouse" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l9-6 9 6"/><rect x="5" y="10" width="14" height="10" rx="2"/><rect x="10" y="14" width="4" height="6" rx="1"/><path d="M7 20v-4h2v4"/><path d="M15 20v-4h2v4"/></svg>
<span>Warehouse</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目次</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#この記事で学べること>この記事で学べること</a></li><li><a href=#対象読者>対象読者</a></li><li><a href=#技術スタック>技術スタック</a></li><li><a href=#第1章-巨大な文字を表示してみよう>第1章: 巨大な文字を表示してみよう</a><ol><li><a href=#今回の目標>今回の目標</a></li><li><a href=#最初の実装>最初の実装</a></li><li><a href=#実行結果>実行結果</a></li><li><a href=#今回のポイント>今回のポイント</a></li></ol></li><li><a href=#第2章-文字が増えるとメモリが爆発する>第2章: 文字が増えるとメモリが爆発する</a><ol><li><a href=#前章の振り返り>前章の振り返り</a></li><li><a href=#今回の目標-1>今回の目標</a></li><li><a href=#動くmooでクラス化>動く：Mooでクラス化</a></li><li><a href=#破綻同じ文字なのに別オブジェクト>破綻：同じ文字なのに別オブジェクト</a></li><li><a href=#今回のポイント-1>今回のポイント</a></li></ol></li><li><a href=#第3章-文字グリフを共有しよう>第3章: 文字グリフを共有しよう</a><ol><li><a href=#前章の振り返り-1>前章の振り返り</a></li><li><a href=#今回の目標-2>今回の目標</a></li><li><a href=#完成flyweightパターン>完成：Flyweightパターン</a></li><li><a href=#flyweightの効果>Flyweightの効果</a></li><li><a href=#今回のポイント-2>今回のポイント</a></li></ol></li><li><a href=#第4章-フォントの設定が散らばる問題>第4章: フォントの設定が散らばる問題</a><ol><li><a href=#前章の振り返り-2>前章の振り返り</a></li><li><a href=#今回の目標-3>今回の目標</a></li><li><a href=#破綻設定が5箇所に散らばる>破綻：設定が5箇所に散らばる</a></li><li><a href=#今回のポイント-3>今回のポイント</a></li></ol></li><li><a href=#第5章-設定を一元管理しよう>第5章: 設定を一元管理しよう</a><ol><li><a href=#前章の振り返り-3>前章の振り返り</a></li><li><a href=#今回の目標-4>今回の目標</a></li><li><a href=#完成singletonパターン>完成：Singletonパターン</a></li><li><a href=#singletonの使い方>Singletonの使い方</a></li><li><a href=#今回のポイント-4>今回のポイント</a></li></ol></li><li><a href=#第6章-使わない文字もロードしてしまう>第6章: 使わない文字もロードしてしまう</a><ol><li><a href=#前章の振り返り-4>前章の振り返り</a></li><li><a href=#今回の目標-5>今回の目標</a></li><li><a href=#破綻起動時に全部ロード>破綻：起動時に全部ロード</a></li><li><a href=#今回のポイント-5>今回のポイント</a></li></ol></li><li><a href=#第7章-使う文字だけロードしよう>第7章: 使う文字だけロードしよう</a><ol><li><a href=#前章の振り返り-5>前章の振り返り</a></li><li><a href=#今回の目標-6>今回の目標</a></li><li><a href=#完成proxyパターン>完成：Proxyパターン</a></li><li><a href=#proxyの効果>Proxyの効果</a></li><li><a href=#今回のポイント-6>今回のポイント</a></li></ol></li><li><a href=#第8章-3つのパターンで完成>第8章: 3つのパターンで完成！</a><ol><li><a href=#全体の振り返り>全体の振り返り</a></li><li><a href=#3パターンの連携>3パターンの連携</a></li><li><a href=#最終版コードのハイライト>最終版コードのハイライト</a></li><li><a href=#実行結果-1>実行結果</a></li></ol></li><li><a href=#まとめ>まとめ</a><ol><li><a href=#学んだ3つのパターン>学んだ3つのパターン</a></li><li><a href=#3パターンが協力する場面>3パターンが協力する場面</a></li><li><a href=#次のステップ>次のステップ</a></li></ol></li><li><a href=#動作環境コード>動作環境・コード</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/2026/02/02/004531/><img src=/public_images/2026/singleton-flyweight-proxy-series-image.jpg loading=lazy alt="Featured image of post Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/2026/02/02/004531/>Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）</a></h2><h3 class=article-subtitle>ASCIIアートの巨大文字を表示しながら、Singleton・Flyweight・Proxyの3パターンを実践。Mooで書くPerlデザインパターン入門。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2月 02, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>読了時間: 11分</time></div></footer></div></header><section class=article-content><p><img src=/public_images/2026/004531/header.png loading=lazy alt="Perlで作るASCIIアート・フォントレンダラー（Singleton × Flyweight × Proxy）"></p><p>プログラミング学習でデザインパターンを学んだものの、「結局どう使えばいいの？」と迷っていませんか？本記事では、<strong>ASCIIアートで巨大文字を表示する</strong>ツールを作りながら、<strong>Singleton・Flyweight・Proxy</strong>の3パターンを体験します。</p><blockquote><p>「動く → 破綻 → パターン導入 → 完成」というストーリーで、<strong>なぜそのパターンが必要なのか</strong>を実感しながら学べます。</p></blockquote><h2 id=この記事で学べること>この記事で学べること</h2><div class=table-wrapper><table><thead><tr><th>パターン</th><th>解決する問題</th><th>本記事での役割</th></tr></thead><tbody><tr><td><strong>Singleton</strong></td><td>設定が複数箇所に散らばる</td><td>フォント設定の一元管理</td></tr><tr><td><strong>Flyweight</strong></td><td>同じオブジェクトの大量生成</td><td>文字グリフの共有</td></tr><tr><td><strong>Proxy</strong></td><td>重いリソースの先読み</td><td>フォントデータの遅延ロード</td></tr></tbody></table></div><h2 id=対象読者>対象読者</h2><ul><li>デザインパターンの名前は知っているが、使いどころがわからない方</li><li>Perl入学式を卒業し、次のステップに進みたい方</li><li>オブジェクト指向の実践的な使い方を学びたい方</li></ul><h2 id=技術スタック>技術スタック</h2><ul><li><strong>Perl</strong> v5.34以降（signatures使用）</li><li><strong>Moo</strong> によるオブジェクト指向</li><li>CLI（コマンドライン）環境</li></ul><hr><h2 id=第1章-巨大な文字を表示してみよう>第1章: 巨大な文字を表示してみよう</h2><h3 id=今回の目標>今回の目標</h3><ul><li>ASCIIアートで「HELLO」を表示する</li><li>最もシンプルな実装からスタート</li></ul><h3 id=最初の実装>最初の実装</h3><p>まずは、各文字のASCIIアートをハードコードで定義してみましょう。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=ch>#!/usr/bin/env perl</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render_H</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&lt;&lt;&#34;</span><span class=dl>END_ART</span><span class=s>&#34;;
</span></span></span><span class=line><span class=cl><span class=s> H   H
</span></span></span><span class=line><span class=cl><span class=s> H   H
</span></span></span><span class=line><span class=cl><span class=s> HHHHH
</span></span></span><span class=line><span class=cl><span class=s> H   H
</span></span></span><span class=line><span class=cl><span class=s> H   H
</span></span></span><span class=line><span class=cl><span class=dl>END_ART</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render_E</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&lt;&lt;&#34;</span><span class=dl>END_ART</span><span class=s>&#34;;
</span></span></span><span class=line><span class=cl><span class=s> EEEEE
</span></span></span><span class=line><span class=cl><span class=s> E
</span></span></span><span class=line><span class=cl><span class=s> EEE
</span></span></span><span class=line><span class=cl><span class=s> E
</span></span></span><span class=line><span class=cl><span class=s> EEEEE
</span></span></span><span class=line><span class=cl><span class=dl>END_ART</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render_L</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&lt;&lt;&#34;</span><span class=dl>END_ART</span><span class=s>&#34;;
</span></span></span><span class=line><span class=cl><span class=s> L
</span></span></span><span class=line><span class=cl><span class=s> L
</span></span></span><span class=line><span class=cl><span class=s> L
</span></span></span><span class=line><span class=cl><span class=s> L
</span></span></span><span class=line><span class=cl><span class=s> LLLLL
</span></span></span><span class=line><span class=cl><span class=dl>END_ART</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render_O</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&lt;&lt;&#34;</span><span class=dl>END_ART</span><span class=s>&#34;;
</span></span></span><span class=line><span class=cl><span class=s>  OOO
</span></span></span><span class=line><span class=cl><span class=s> O   O
</span></span></span><span class=line><span class=cl><span class=s> O   O
</span></span></span><span class=line><span class=cl><span class=s> O   O
</span></span></span><span class=line><span class=cl><span class=s>  OOO
</span></span></span><span class=line><span class=cl><span class=dl>END_ART</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># メイン処理</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;=== ASCIIアート・フォントレンダラー v0.1 ===&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;「HELLO」を表示します:&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 各文字を順番に表示</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@lines_H</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>/\n/</span><span class=p>,</span> <span class=n>render_H</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@lines_E</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>/\n/</span><span class=p>,</span> <span class=n>render_E</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@lines_L</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>/\n/</span><span class=p>,</span> <span class=n>render_L</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@lines_O</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>/\n/</span><span class=p>,</span> <span class=n>render_O</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 横に並べて表示</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>my</span> <span class=nv>$i</span> <span class=p>(</span><span class=mi>0</span><span class=o>..</span><span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=nb>join</span><span class=p>(</span><span class=s>&#34;  &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$lines_H</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$lines_E</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$lines_L</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$lines_L</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span><span class=p>,</span>  <span class=c1># 2つ目のL</span>
</span></span><span class=line><span class=cl>        <span class=nv>$lines_O</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;完成！巨大な文字が表示できました。&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=実行結果>実行結果</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>=== ASCIIアート・フォントレンダラー v0.1 ===
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>「HELLO」を表示します:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> H   H   EEEEE   L        L         OOO
</span></span><span class=line><span class=cl> H   H   E       L        L        O   O
</span></span><span class=line><span class=cl> HHHHH   EEE     L        L        O   O
</span></span><span class=line><span class=cl> H   H   E       L        L        O   O
</span></span><span class=line><span class=cl> H   H   EEEEE   LLLLL    LLLLL     OOO
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>完成！巨大な文字が表示できました。
</span></span></code></pre></td></tr></table></div></div><h3 id=今回のポイント>今回のポイント</h3><ul><li>✅ とりあえず動くものができた</li><li>⚠️ 文字数が増えると関数が爆発する</li><li>⚠️ 拡張性がまったくない</li></ul><hr><h2 id=第2章-文字が増えるとメモリが爆発する>第2章: 文字が増えるとメモリが爆発する</h2><h3 id=前章の振り返り>前章の振り返り</h3><p>第1章では、ハードコードで「HELLO」を表示できました。でも、A〜Z全部に対応したら？</p><h3 id=今回の目標-1>今回の目標</h3><ul><li>A〜Z全文字に対応する</li><li>オブジェクト指向で書き直す</li><li>でも&mldr;問題が発生する</li></ul><h3 id=動くmooでクラス化>動く：Mooでクラス化</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=ch>#!/usr/bin/env perl</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Glyph</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>has</span> <span class=n>name</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>has</span> <span class=n>art</span>  <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>sub</span> <span class=nf>render</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>art</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>main</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># フォントデータ（A-Zまで全部定義）</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>%FONT_DATA</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=&gt;</span> <span class=s>&#34; AAA\nA   A\nAAAAA\nA   A\nA   A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>B</span> <span class=o>=&gt;</span> <span class=s>&#34;BBBB\nB   B\nBBBB\nB   B\nBBBB&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1># ... 中略 ...</span>
</span></span><span class=line><span class=cl>    <span class=n>H</span> <span class=o>=&gt;</span> <span class=s>&#34;H   H\nH   H\nHHHHH\nH   H\nH   H&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span> <span class=o>=&gt;</span> <span class=s>&#34;L\nL\nL\nL\nLLLLL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>O</span> <span class=o>=&gt;</span> <span class=s>&#34; OOO\nO   O\nO   O\nO   O\n OOO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1># ... 中略 ...</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 問題のあるコード: 文字を使うたびに新しいオブジェクトを生成</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_glyph</span><span class=p>($char) {</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$art</span> <span class=o>=</span> <span class=nv>$FONT_DATA</span><span class=p>{</span><span class=nb>uc</span> <span class=nv>$char</span><span class=p>}</span> <span class=sr>//</span> <span class=s>&#34;  ?\n  ?\n  ?\n  ?\n  ?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nn>Glyph</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>name</span> <span class=o>=&gt;</span> <span class=nv>$char</span><span class=p>,</span> <span class=n>art</span> <span class=o>=&gt;</span> <span class=nv>$art</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># テスト</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@text</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>//</span><span class=p>,</span> <span class=s>&#34;LOLLOL&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@glyphs</span> <span class=o>=</span> <span class=nb>map</span> <span class=p>{</span> <span class=n>get_glyph</span><span class=p>(</span><span class=nv>$_</span><span class=p>)</span> <span class=p>}</span> <span class=nv>@text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;文字数: &#34;</span> <span class=o>.</span> <span class=nb>scalar</span> <span class=nv>@text</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;作成されたGlyphオブジェクト数: &#34;</span> <span class=o>.</span> <span class=nb>scalar</span> <span class=nv>@glyphs</span> <span class=o>.</span> <span class=s>&#34; （全部別々！）&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=破綻同じ文字なのに別オブジェクト>破綻：同じ文字なのに別オブジェクト</h3><p>「LOLLOL」という6文字を表示するだけなのに&mldr;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>文字数: 6
</span></span><span class=line><span class=cl>作成されたGlyphオブジェクト数: 6 （全部別々！）
</span></span></code></pre></td></tr></table></div></div><p>問題点を整理すると：</p><ul><li>「L」が3回登場 → 3つの別々のGlyphオブジェクト</li><li>「O」が2回登場 → 2つの別々のGlyphオブジェクト</li><li>100万文字のテキストを表示したら、100万個のオブジェクト！</li></ul><h3 id=今回のポイント-1>今回のポイント</h3><ul><li>⚠️ 同じデータなのに毎回新規作成はムダ</li><li>⚠️ メモリ使用量が文字数に比例して増大</li><li>→ <strong>同じ文字は1つのオブジェクトを共有</strong>すればよいのでは？</li></ul><hr><h2 id=第3章-文字グリフを共有しよう>第3章: 文字グリフを共有しよう</h2><p><img src=/public_images/2026/004531/flyweight.png loading=lazy alt="Flyweight Pattern: Sharing Glyphs"></p><h3 id=前章の振り返り-1>前章の振り返り</h3><p>同じ「L」なのに毎回新しいオブジェクトを作っていました。これを解決します。</p><h3 id=今回の目標-2>今回の目標</h3><ul><li>同じ文字は1つのオブジェクトを共有する</li><li><strong>Flyweight</strong>パターンの導入</li></ul><h3 id=完成flyweightパターン>完成：Flyweightパターン</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>Glyph</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Flyweightパターン: 共有される内部状態(intrinsic state)</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>char</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>art</span>  <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>art</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_lines</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>split</span> <span class=sr>/\n/</span><span class=p>,</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>art</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>GlyphFactory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Glyph</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 既に作成したGlyphオブジェクトを保持するプール</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_pool</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=p>{}</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_font_data</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=&gt;</span> <span class=s>&#34; AAA\nA   A\nAAAAA\nA   A\nA   A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1># ... 省略 ...</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Glyphを取得（既に存在すれば再利用、なければ新規作成）</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_glyph</span><span class=p>($self, $char) {</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$key</span> <span class=o>=</span> <span class=nb>uc</span> <span class=nv>$char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># プールに既にあれば再利用</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>exists</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_pool</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_pool</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 新規作成してプールに保存</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$art</span> <span class=o>=</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_font_data</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=sr>//</span> <span class=s>&#34;  ?\n  ?\n  ?\n  ?\n  ?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$glyph</span> <span class=o>=</span> <span class=nn>Glyph</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>char</span> <span class=o>=&gt;</span> <span class=nv>$key</span><span class=p>,</span> <span class=n>art</span> <span class=o>=&gt;</span> <span class=nv>$art</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_pool</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=o>=</span> <span class=nv>$glyph</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$glyph</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>pool_size</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>scalar</span> <span class=nb>keys</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_pool</span><span class=o>-&gt;</span><span class=nv>%</span><span class=err>*;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=flyweightの効果>Flyweightの効果</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>my</span> <span class=nv>$factory</span> <span class=o>=</span> <span class=nn>GlyphFactory</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@text</span> <span class=o>=</span> <span class=nb>split</span> <span class=sr>//</span><span class=p>,</span> <span class=s>&#34;LOLLOL&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@glyphs</span> <span class=o>=</span> <span class=nb>map</span> <span class=p>{</span> <span class=nv>$factory</span><span class=o>-&gt;</span><span class=n>get_glyph</span><span class=p>(</span><span class=nv>$_</span><span class=p>)</span> <span class=p>}</span> <span class=nv>@text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;文字数: &#34;</span> <span class=o>.</span> <span class=nb>scalar</span> <span class=nv>@text</span><span class=p>;</span>                        <span class=c1># → 6</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;プールサイズ: &#34;</span> <span class=o>.</span> <span class=nv>$factory</span><span class=o>-&gt;</span><span class=n>pool_size</span> <span class=o>.</span> <span class=s>&#34;種類&#34;</span><span class=p>;</span>  <span class=c1># → 2（L と O だけ）</span>
</span></span></code></pre></td></tr></table></div></div><pre class=mermaid>
	classDiagram
    class GlyphFactory {
        -_pool: Hash
        -_font_data: Hash
        +get_glyph(char): Glyph
        +pool_size(): Int
    }

    class Glyph {
        +char: Str
        +art: Str
        +render(): Str
        +get_lines(): Array
    }

    GlyphFactory &#34;1&#34; --&gt; &#34;*&#34; Glyph : creates/caches
    note for GlyphFactory &#34;同じ文字は同じオブジェクトを返す&#34;
</pre><h3 id=今回のポイント-2>今回のポイント</h3><ul><li>✅ <strong>Flyweight</strong>パターン = オブジェクトの共有</li><li>✅ 100万文字のテキストでも、使用する<strong>文字種類数</strong>分のメモリで済む</li><li>✅ プールで既存オブジェクトを管理</li></ul><hr><h2 id=第4章-フォントの設定が散らばる問題>第4章: フォントの設定が散らばる問題</h2><h3 id=前章の振り返り-2>前章の振り返り</h3><p>Flyweightでメモリ問題を解決しました。でも、コードを見返すと別の問題が&mldr;</p><h3 id=今回の目標-3>今回の目標</h3><ul><li>設定がハードコードされている問題を認識</li><li>DRY原則（Don&rsquo;t Repeat Yourself）違反を発見</li></ul><h3 id=破綻設定が5箇所に散らばる>破綻：設定が5箇所に散らばる</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>my</span> <span class=nv>$FONT_PATH</span> <span class=o>=</span> <span class=s>&#34;/usr/share/fonts/ascii/standard.fnt&#34;</span><span class=p>;</span>  <span class=c1># 設定1箇所目</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$DEFAULT_STYLE</span> <span class=o>=</span> <span class=s>&#34;bold&#34;</span><span class=p>;</span>                              <span class=c1># 設定2箇所目</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>initialize_renderer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$font_path</span> <span class=o>=</span> <span class=s>&#34;/usr/share/fonts/ascii/standard.fnt&#34;</span><span class=p>;</span>  <span class=c1># 設定3箇所目（重複！）</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=s>&#34;フォントを$font_pathから読み込んでいます...&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_font_style</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;bold&#34;</span><span class=p>;</span>  <span class=c1># 設定4箇所目（重複！）</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>render_with_style</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$style</span> <span class=o>=</span> <span class=s>&#34;bold&#34;</span><span class=p>;</span>  <span class=c1># 設定5箇所目（またもや重複！）</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>問題点：</p><ul><li>同じ値が<strong>5箇所</strong>にハードコード</li><li>フォントパスを変更したい → 5箇所を修正</li><li>修正漏れがあるとバグの原因に</li></ul><h3 id=今回のポイント-3>今回のポイント</h3><ul><li>⚠️ <strong>DRY原則</strong>（Don&rsquo;t Repeat Yourself）に違反</li><li>⚠️ 設定変更時に修正漏れリスク</li><li>→ <strong>設定を1箇所で一元管理</strong>すればよいのでは？</li></ul><hr><h2 id=第5章-設定を一元管理しよう>第5章: 設定を一元管理しよう</h2><p><img src=/public_images/2026/004531/singleton.png loading=lazy alt="Singleton Pattern: Centralized Configuration"></p><h3 id=前章の振り返り-3>前章の振り返り</h3><p>設定が5箇所に散らばっていました。これを1箇所にまとめます。</p><h3 id=今回の目標-4>今回の目標</h3><ul><li>設定を一元管理するクラスを作る</li><li><strong>Singleton</strong>パターンの導入</li></ul><h3 id=完成singletonパターン>完成：Singletonパターン</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>FontManager</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># クラス変数としてインスタンスを保持</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 設定項目</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>font_path</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=s>&#39;/usr/share/fonts/ascii/standard.fnt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>default_style</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=s>&#39;bold&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>char_spacing</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Singletonアクセサ: インスタンスを取得</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>instance</span><span class=p>($class = __PACKAGE__) {</span>
</span></span><span class=line><span class=cl>    <span class=nv>$_instance</span> <span class=sr>//</span><span class=o>=</span> <span class=nv>$class</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># テスト用: インスタンスをリセット</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>reset_instance</span><span class=p>($class = __PACKAGE__) {</span>
</span></span><span class=line><span class=cl>    <span class=nv>$_instance</span> <span class=o>=</span> <span class=nb>undef</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>show_config</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=s>&#34;=== FontManager 設定 ===&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=s>&#34;  フォントパス: &#34;</span> <span class=o>.</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>font_path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=s>&#34;  デフォルトスタイル: &#34;</span> <span class=o>.</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>default_style</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=singletonの使い方>Singletonの使い方</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>use</span> <span class=nn>FontManager</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># どこからでも同じインスタンスにアクセス</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$manager</span> <span class=o>=</span> <span class=nn>FontManager</span><span class=o>-&gt;</span><span class=n>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=nv>$manager</span><span class=o>-&gt;</span><span class=n>font_path</span><span class=p>;</span>  <span class=c1># → /usr/share/fonts/ascii/standard.fnt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 設定を変更</span>
</span></span><span class=line><span class=cl><span class=nv>$manager</span><span class=o>-&gt;</span><span class=n>font_path</span><span class=p>(</span><span class=s>&#39;/home/user/fonts/fancy.fnt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 別の場所でも同じ設定が見える</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>another_function</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$m</span> <span class=o>=</span> <span class=nn>FontManager</span><span class=o>-&gt;</span><span class=n>instance</span><span class=p>;</span>  <span class=c1># 同じインスタンス</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=nv>$m</span><span class=o>-&gt;</span><span class=n>font_path</span><span class=p>;</span>  <span class=c1># → /home/user/fonts/fancy.fnt</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre class=mermaid>
	classDiagram
    class FontManager {
        -$_instance: FontManager
        +font_path: Str
        +default_style: Str
        +char_spacing: Int
        +instance(): FontManager
        +reset_instance(): void
        +show_config(): void
    }

    note for FontManager &#34;アプリ全体で唯一のインスタンス&#34;
</pre><h3 id=今回のポイント-4>今回のポイント</h3><ul><li>✅ <strong>Singleton</strong>パターン = 唯一のインスタンスを保証</li><li>✅ <code>FontManager->instance</code> で常に同じオブジェクト</li><li>✅ 設定変更は1箇所でOK、どこからでも反映</li></ul><hr><h2 id=第6章-使わない文字もロードしてしまう>第6章: 使わない文字もロードしてしまう</h2><h3 id=前章の振り返り-4>前章の振り返り</h3><p>Singletonで設定を一元管理できました。でも、起動が遅いことに気づきました&mldr;</p><h3 id=今回の目標-5>今回の目標</h3><ul><li>全フォントを先読みする問題を認識</li><li>起動時間の無駄を発見</li></ul><h3 id=破綻起動時に全部ロード>破綻：起動時に全部ロード</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>EagerFontLoader</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>has</span> <span class=n>fonts</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=p>{}</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 起動時にすべてのフォントをロード（問題のある設計）</span>
</span></span><span class=line><span class=cl>    <span class=k>sub</span> <span class=nf>BUILD</span><span class=p>($self, $args) {</span>
</span></span><span class=line><span class=cl>        <span class=n>say</span> <span class=s>&#34;フォントを読み込み中...&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=k>my</span> <span class=nv>$char</span> <span class=p>(</span><span class=s>&#39;A&#39;</span><span class=o>..</span><span class=s>&#39;Z&#39;</span><span class=p>,</span> <span class=s>&#39;0&#39;</span><span class=o>..</span><span class=s>&#39;9&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>my</span> <span class=nv>$font</span> <span class=o>=</span> <span class=nn>HeavyFont</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=o>=&gt;</span> <span class=nv>$char</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=&gt;</span> <span class=s>&#34;DUMMY_DATA_FOR_$char&#34;</span> <span class=n>x</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>fonts</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$char</span><span class=p>}</span> <span class=o>=</span> <span class=nv>$font</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>print</span> <span class=s>&#34;.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>say</span> <span class=s>&#34; 完了！&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 起動時間を計測</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$start</span> <span class=o>=</span> <span class=nb>time</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$loader</span> <span class=o>=</span> <span class=nn>EagerFontLoader</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>  <span class=c1># ← ここで全部ロード</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$elapsed</span> <span class=o>=</span> <span class=nb>time</span><span class=p>()</span> <span class=o>-</span> <span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;起動時間: ${elapsed}秒&#34;</span><span class=p>;</span>  <span class=c1># → 0.36秒（36文字 × 10ms）</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;ロードしたフォント数: 36種類&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;実際に使うのは: HELLO の 4種類だけ...&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>問題点：</p><ul><li>「HELLO」を表示するだけなのに36種類全部ロード</li><li>起動が遅い</li><li>使わない文字のデータまでメモリに保持</li></ul><h3 id=今回のポイント-5>今回のポイント</h3><ul><li>⚠️ <strong>Eager Loading</strong>（先読み）の弊害</li><li>⚠️ 使わないデータまでロードして無駄</li><li>→ <strong>必要なときに必要な分だけロード</strong>すればよいのでは？</li></ul><hr><h2 id=第7章-使う文字だけロードしよう>第7章: 使う文字だけロードしよう</h2><p><img src=/public_images/2026/004531/proxy.png loading=lazy alt="Proxy Pattern: Lazy Loading"></p><h3 id=前章の振り返り-5>前章の振り返り</h3><p>起動時に全フォントをロードしていました。これを効率化します。</p><h3 id=今回の目標-6>今回の目標</h3><ul><li>使う文字だけオンデマンドでロード</li><li><strong>Proxy</strong>パターンの導入</li></ul><h3 id=完成proxyパターン>完成：Proxyパターン</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>RealFont</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>char</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_data</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_loaded</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span> <span class=n>default</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遅延ロード: 実際に必要になったときにロード</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>_load</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>if</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_loaded</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 重いロード処理をシミュレート</span>
</span></span><span class=line><span class=cl>    <span class=nb>select</span><span class=p>(</span><span class=nb>undef</span><span class=p>,</span> <span class=nb>undef</span><span class=p>,</span> <span class=nb>undef</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>);</span>  <span class=c1># 10ms</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$FONT_DATA</span><span class=p>{</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=n>char</span><span class=p>}</span> <span class=sr>//</span> <span class=s>&#34;?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_data</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_loaded</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_art</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_load</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>is_loaded</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_loaded</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>FontProxy</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.34</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=sx>qw(signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=sx>qw(experimental::signatures)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>RealFont</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>char</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_real_font</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RealFontへの参照を遅延生成</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>_get_real_font</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>unless</span> <span class=p>(</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_real_font</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_real_font</span><span class=p>(</span><span class=nn>RealFont</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>char</span> <span class=o>=&gt;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_real_font</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RealFontの操作を委譲</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_art</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_get_real_font</span><span class=o>-&gt;</span><span class=n>get_art</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>is_loaded</span><span class=p>($self) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_real_font</span> <span class=o>&amp;&amp;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_real_font</span><span class=o>-&gt;</span><span class=n>is_loaded</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=proxyの効果>Proxyの効果</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 起動時間を計測</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$start</span> <span class=o>=</span> <span class=nb>time</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$loader</span> <span class=o>=</span> <span class=nn>LazyFontLoader</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>  <span class=c1># Proxyだけ作成（0.0001秒）</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$elapsed</span> <span class=o>=</span> <span class=nb>time</span><span class=p>()</span> <span class=o>-</span> <span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;起動時間: ${elapsed}秒&#34;</span><span class=p>;</span>  <span class=c1># → ほぼ瞬時！</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;ロード済みフォント数: 0&#34;</span><span class=p>;</span>  <span class=c1># まだ何もロードしていない</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HELLOを表示（この時点で H, E, L, O だけロード）</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=n>render</span><span class=p>(</span><span class=s>&#34;HELLO&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=s>&#34;ロード済みフォント数: 4&#34;</span><span class=p>;</span>  <span class=c1># 使った4種類だけ</span>
</span></span></code></pre></td></tr></table></div></div><pre class=mermaid>
	classDiagram
    class FontProxy {
        +char: Str
        -_real_font: RealFont
        +get_art(): Str
        +is_loaded(): Bool
    }

    class RealFont {
        +char: Str
        -_data: Str
        -_loaded: Bool
        +get_art(): Str
        +is_loaded(): Bool
    }

    FontProxy &#34;1&#34; --&gt; &#34;0..1&#34; RealFont : lazy creates
    note for FontProxy &#34;軽量なプロキシ\nアクセス時にRealFontを生成&#34;
    note for RealFont &#34;重いフォントデータ\n必要になるまで生成しない&#34;
</pre><h3 id=今回のポイント-6>今回のポイント</h3><ul><li>✅ <strong>Proxy</strong>パターン = 代理オブジェクトで遅延ロード</li><li>✅ 起動は瞬時（Proxyだけ作成）</li><li>✅ 使う文字だけオンデマンドでロード</li><li>✅ <strong>Virtual Proxy</strong>（仮想プロキシ）とも呼ばれる</li></ul><hr><h2 id=第8章-3つのパターンで完成>第8章: 3つのパターンで完成！</h2><h3 id=全体の振り返り>全体の振り返り</h3><p>ここまでの成長を振り返りましょう。</p><div class=table-wrapper><table><thead><tr><th>回</th><th>問題</th><th>解決策</th><th>パターン</th></tr></thead><tbody><tr><td>1-2</td><td>同じ文字でも毎回新規作成</td><td>オブジェクトを共有</td><td><strong>Flyweight</strong></td></tr><tr><td>3-4</td><td>設定が複数箇所に散らばる</td><td>一元管理クラス</td><td><strong>Singleton</strong></td></tr><tr><td>5-6</td><td>使わない文字も先読み</td><td>遅延ロード</td><td><strong>Proxy</strong></td></tr></tbody></table></div><h3 id=3パターンの連携>3パターンの連携</h3><pre class=mermaid>
	graph TD
    subgraph Singleton
        FM[FontManager] --&gt; C[設定: パス, スタイル]
    end

    subgraph Flyweight
        FF[GlyphFactory] --&gt; G1[Glyph: A]
        FF --&gt; G2[Glyph: B]
        FF --&gt; G3[Glyph: ...]
    end

    subgraph Proxy
        P[FontProxy] --&gt; RF[RealFont: 重いデータ]
    end

    FM -.-&gt;|設定を参照| FF
    FF -.-&gt;|データが必要なとき| P
</pre><h3 id=最終版コードのハイライト>最終版コードのハイライト</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>ASCIIArtRenderer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>FontManager</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>GlyphFactory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nn>FontProxy</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>has</span> <span class=n>glyph_factory</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=nn>GlyphFactory</span><span class=o>-&gt;</span><span class=k>new</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>sub</span> <span class=nf>render</span><span class=p>($self, $text) {</span>
</span></span><span class=line><span class=cl>        <span class=k>my</span> <span class=nv>$manager</span> <span class=o>=</span> <span class=nn>FontManager</span><span class=o>-&gt;</span><span class=n>instance</span><span class=p>;</span>  <span class=c1># Singleton</span>
</span></span><span class=line><span class=cl>        <span class=k>my</span> <span class=nv>$spacing</span> <span class=o>=</span> <span class=nv>$manager</span><span class=o>-&gt;</span><span class=n>char_spacing</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Flyweightから共有Glyphを取得</span>
</span></span><span class=line><span class=cl>        <span class=k>my</span> <span class=nv>@glyphs</span> <span class=o>=</span> <span class=nb>map</span> <span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>glyph_factory</span><span class=o>-&gt;</span><span class=n>get_glyph</span><span class=p>(</span><span class=nv>$_</span><span class=p>)</span> <span class=p>}</span> <span class=nb>split</span> <span class=sr>//</span><span class=p>,</span> <span class=nv>$text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 各行を横に結合して表示</span>
</span></span><span class=line><span class=cl>        <span class=k>my</span> <span class=nv>@result_lines</span> <span class=o>=</span> <span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>)</span> <span class=n>x</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=k>my</span> <span class=nv>$glyph</span> <span class=p>(</span><span class=nv>@glyphs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>my</span> <span class=nv>@art_lines</span> <span class=o>=</span> <span class=nv>$glyph</span><span class=o>-&gt;</span><span class=n>get_lines</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=k>my</span> <span class=nv>$i</span> <span class=p>(</span><span class=mi>0</span><span class=o>..</span><span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$result_lines</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=o>.=</span> <span class=nb>sprintf</span><span class=p>(</span><span class=s>&#34;%-&#34;</span> <span class=o>.</span> <span class=p>(</span><span class=mi>5</span> <span class=o>+</span> <span class=nv>$spacing</span><span class=p>)</span> <span class=o>.</span> <span class=s>&#34;s&#34;</span><span class=p>,</span> <span class=nv>$art_lines</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span> <span class=sr>//</span> <span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>join</span><span class=p>(</span><span class=s>&#34;\n&#34;</span><span class=p>,</span> <span class=nv>@result_lines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=実行結果-1>実行結果</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>============================================================
</span></span><span class=line><span class=cl> ASCIIアート・フォントレンダラー v1.0 (完成版)
</span></span><span class=line><span class=cl> Singleton × Flyweight × Proxy
</span></span><span class=line><span class=cl>============================================================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>初期化時間: 0.0001秒（瞬時！）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>【 HELLO WORLD を表示 】
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> H   H  EEEEE  L      L       OOO
</span></span><span class=line><span class=cl> H   H  E      L      L      O   O
</span></span><span class=line><span class=cl> HHHHH  EEE    L      L      O   O
</span></span><span class=line><span class=cl> H   H  E      L      L      O   O
</span></span><span class=line><span class=cl> H   H  EEEEE  LLLLL  LLLLL   OOO
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> W   W   OOO   RRRR   L      DDD
</span></span><span class=line><span class=cl> W   W  O   O  R   R  L      D  D
</span></span><span class=line><span class=cl> W W W  O   O  RRRR   L      D  D
</span></span><span class=line><span class=cl> WW WW  O   O  R R    L      D  D
</span></span><span class=line><span class=cl> W   W   OOO   R  R   LLLLL  DDD
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== レンダラー統計情報 ===
</span></span><span class=line><span class=cl>Glyphプールサイズ: 8種類
</span></span><span class=line><span class=cl>プール内容: D, E, H, L, O, R, W
</span></span><span class=line><span class=cl>遅延ロード済み: 8種類
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=まとめ>まとめ</h2><h3 id=学んだ3つのパターン>学んだ3つのパターン</h3><div class=table-wrapper><table><thead><tr><th>パターン</th><th>一言で</th><th>使うタイミング</th></tr></thead><tbody><tr><td><strong>Singleton</strong></td><td>唯一のインスタンスを保証</td><td>設定、ロガー、接続プール</td></tr><tr><td><strong>Flyweight</strong></td><td>オブジェクトを共有してメモリ節約</td><td>大量の同種オブジェクト</td></tr><tr><td><strong>Proxy</strong></td><td>代理で遅延ロード・アクセス制御</td><td>重いリソース、リモートアクセス</td></tr></tbody></table></div><h3 id=3パターンが協力する場面>3パターンが協力する場面</h3><p>この3パターンは「リソース効率化」という共通テーマで連携しやすい組み合わせです：</p><ul><li><strong>Singleton</strong> → グローバルな設定・状態管理</li><li><strong>Flyweight</strong> → 共有可能なオブジェクトの一元管理</li><li><strong>Proxy</strong> → 重いオブジェクトへのアクセス制御</li></ul><h3 id=次のステップ>次のステップ</h3><ul><li>実際の開発で「同じデータを何度も生成している」と思ったら → <strong>Flyweight</strong></li><li>「設定が散らばっている」と思ったら → <strong>Singleton</strong></li><li>「起動が遅い・先読みが無駄」と思ったら → <strong>Proxy</strong></li></ul><p>パターンの名前を覚えるより、**「この問題にはこの解決策」**という感覚を身につけることが大切です。</p><hr><h2 id=動作環境コード>動作環境・コード</h2><p>本記事のコードは以下の環境で動作確認しています：</p><ul><li>Perl v5.34以降（<code>signatures</code>機能を使用）</li><li>cpanm経由で <code>Moo</code> をインストール</li></ul><p>完全なコードはGitHubリポジトリで公開しています。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/perl/>Perl</a>
<a href=/tags/moo/>Moo</a>
<a href=/tags/perl-design-patterns/>Perl-Design-Patterns</a>
<a href=/tags/singleton-pattern/>Singleton-Pattern</a>
<a href=/tags/flyweight-pattern/>Flyweight-Pattern</a>
<a href=/tags/proxy-pattern/>Proxy-Pattern</a>
<a href=/tags/object-oriented/>Object-Oriented</a>
<a href=/tags/ascii-art/>Ascii-Art</a>
<a href=/tags/hands-on/>Hands-On</a>
<a href=/tags/tutorial/>Tutorial</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/2026/02/07/000257/><div class=article-image><img src=/public_images/2026/flyweight-prototype-abstract-factory-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/flyweight-prototype-abstract-factory-series-image.jpg></div><div class=article-details><h2 class=article-title>Perlで作るウイスキーテイスティングカード生成器（Abstract Factory × Flyweight × Prototype）</h2></div></a></article><article class=has-image><a href=/2026/02/08/000550/><div class=article-image><img src=/public_images/2026/interpreter-visitor-composite-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/interpreter-visitor-composite-series-image.jpg></div><div class=article-details><h2 class=article-title>Perlで作る正規表現リファインリー（Interpreter × Visitor × Composite）</h2></div></a></article><article class=has-image><a href=/2025/12/10/214754/><div class=article-image><img src=/public_images/2025/1765370874-image.jpg loading=lazy data-key data-hash=/public_images/2025/1765370874-image.jpg></div><div class=article-details><h2 class=article-title>MooによるTDD講座 #3 - テストに守られながらリファクタリング</h2></div></a></article><article class=has-image><a href=/2026/02/06/000740/><div class=article-image><img src=/public_images/2026/whisky-profile-generator-image.jpg loading=lazy data-key data-hash=/public_images/2026/whisky-profile-generator-image.jpg></div><div class=article-details><h2 class=article-title>PerlとMooでウイスキーのテイスティングノート自動生成システムを作ってみよう</h2></div></a></article><article class=has-image><a href=/2026/02/05/000937/><div class=article-image><img src=/public_images/2026/chain-state-memento-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/chain-state-memento-series-image.jpg></div><div class=article-details><h2 class=article-title>Perlで作るタイムトラベル冒険ゲーム - 3つのデザインパターンで学ぶ実践的設計</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//nqounet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2000 -
2026 設計パターンを疑え</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>