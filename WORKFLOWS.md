# WORKFLOWS.md — 記事作成ワークフローガイド

このファイルは [AGENTS.md](AGENTS.md) の補助文書で、記事作成の具体的なワークフロー、プロンプトテンプレート、品質基準をまとめたものです。

## 前提知識

このワークフローを使用する前に、以下を確認してください：

- [プロジェクト概要](AGENTS.md#プロジェクト概要)
- [コンテンツ作成ルール](AGENTS.md#コンテンツ作成ルール)
- [エージェントトピックマッピング](AGENTS.md#エージェントトピックマッピング)
- [調査ドキュメントの運用](AGENTS.md#調査ドキュメントの運用)

# 目次
- ワークフロー
  - 基本方針
  - シリーズ記事（連載記事）のプランニング
  - シリーズ記事（連載記事）のライティング
  - シリーズ記事（連載記事）のレビュー
  - 単体記事のプランニング
  - 単体記事のライティング
  - 単体記事のレビュー
- プロンプトテンプレート
  - 調査・情報収集依頼
  - 連載構造案作成依頼
    - 各案に必要な項目
    - 出力
  - 連載構造案レビュー依頼
    - レビュー観点
    - 出力
  - アウトライン依頼
    - 各案に必要な項目
  - 原稿作成依頼
    - 出力
- 検証と品質ゲート
  - 単体記事の品質基準
  - 連載構造案の品質基準

# ワークフロー

## 基本方針

- エージェントへの依頼は明確なプロンプトテンプレートに従う
- 最後は、 **必ず公開前の最終チェック（reviewer）に依頼すること**

## シリーズ記事（連載記事）のプランニング

1. 調査・情報収集（investigative-researchエージェント）
  - キーワード、テーマに関する情報収集
  - 競合記事の分析、内部リンク候補の調査
  - ドラフト記事は内部リンクの対象外
  - **既存シリーズとの重複チェック**: 同じデザインパターンやテーマを扱う既存シリーズがある場合、異なる切り口・題材で差別化
  - 調査ドキュメントを `content/warehouse/<slug>.md` に保存

2. 連載構造案の作成（該当する専門家エージェント）
  - 調査結果に基づき、連載の全体像を設計
  - 異なる視点/アプローチの構造案を3つ（案A/B/C）作成
  - 生成後、レビュー、改善を3回繰り返すこと
  - 各記事の主要テーマ、新しい概念、ストーリー、推奨タグを定義
  - 連載構造案を `agents/structure/<slug>.md` に保存
   
3. 連載構造案のSEO視点レビューと改善（search-engine-optimizationエージェント）
  - SEO視点（キーワード配置、検索意図適合）でレビュー
  - レビュー、改善を3回繰り返すこと

4. 連載構造案の品質視点レビューと改善（reviewerエージェント）
  - 品質視点（構造の一貫性、段階的難易度）でレビュー
  - レビュー、改善を3回繰り返すこと

5. 最終案の決定（ユーザーまたはreviewerエージェント）
  - 3案の中から最適な案を選定
  - 選定理由を文書化

## シリーズ記事（連載記事）のライティング

1. 各記事の原稿作成（各専門家エージェント）
  - 初回は、前提知識と対象読者を明示
  - **連載の一貫性確保**: 文体・トーンの統一、登場するコード例やストーリーなど
  - 最終回は、次のステップへの展望を提示
  - 出典や、関連記事へのリンク集

2. 各記事の挿絵を追加する（illustration-craftspersonエージェント）
  - 記事の内容を理解し、読者の理解を深めるための視覚的な要素を提案する
  - 技術記事に適した図表、ダイアグラム、フローチャートなどを作成する
  - Mermaid記法を活用して、システム構成図やシーケンス図などを作成する

## シリーズ記事（連載記事）のレビュー

1. シリーズ記事の公開日時を決定する
  - フロントマターの`iso8601`を日本時間で指定する
  - 第1回は、レビュー実施時間の24時間後とする
  - 第2回以降は、前回（第2回の場合は第1回）の**123秒後**とする
  - 各記事を公開日時に合わせてファイルをリネームする。新しい名前は`content/post/%Y/%m/%d/%H%M%S.md`とする（`iso8601: 2026-01-04T21:04:53+09:00`の場合は、`content/post/2026/01/04/210453.md`）
  - シリーズ記事内でリンクを作成していた場合は、書き換えを行うこと

2. シリーズ記事間のリンクを追加する
  - 前回の振り返りや、次回予告などでリンクを作成すること

3. シリーズ記事の目次記事を作成する
  - 公開日時は、最終回の**123秒後**とする
  - タイトルは「【目次】シリーズ名（全N回）」形式を推奨
  - シリーズ全体の概要と対象読者を記載
  - 各回へのリンクは`{{< linkcard "https://www.nqou.net/YYYY/MM/DD/HHMMSS/" >}}`形式で記載

4. 各記事の校正（proofreaderエージェント）

5. 各記事の公開前の最終チェック（reviewerエージェント）

6. シリーズ記事を公開する
  - 公開できる状態である場合は、シリーズ記事（目次記事含む）のフロントマターの`draft`を`false`に変更する

## 単体記事のプランニング

1. 調査・情報収集（investigative-researchエージェント）
   - キーワード、テーマに関する情報収集
   - 競合記事の分析、内部リンク候補の調査
   - 調査ドキュメントを `content/warehouse/<slug>.md` に保存

2. アウトライン作成（search-engine-optimizationエージェント）
  - タイトルの最適化：主要キーワードを含め、クリックされやすい表現にする
  - meta description：検索結果でのCTRを高める要約する
  - 見出し構造の整理：H1はページの主題、H2/H3で論理的に分割する
  - 構造化データの導入：リッチリザルト促進（FAQ、レビュー、イベントなど）

## 単体記事のライティング

1. 原稿作成（各専門家エージェント）
  - アウトラインに基づいて、技術的に正確で最新の情報を盛り込んだ原稿を作成する
  - ユーザーが求める回答を分かりやすく、独自の視点やデータで提供
  - コード例、引用を適切に配置する
  - 引用元のURLや内部リンクを明記する

2. 挿絵を追加する（illustration-craftspersonエージェント）
  - 記事の内容を理解し、読者の理解を深めるための視覚的な要素を提案する
  - 技術記事に適した図表、ダイアグラム、フローチャートなどを作成する
  - Mermaid記法を活用して、システム構成図やシーケンス図などを作成する

## 単体記事のレビュー

1. 校正（proofreaderエージェント）

2. 公開前の最終チェック（reviewerエージェント）

# プロンプトテンプレート

## 調査・情報収集依頼

- キーワード、および関連トピックについて、最新かつ信頼性の高い情報を調査・情報収集し、ドキュメントにまとめること。調査結果と共に**要点**、**根拠**、**仮定**、**出典（URL、書籍名（ASIN、ISBN）など）**、**信頼度**を示すこと
- 競合記事の分析を行うこと
- 内部リンク（関連記事など）の調査。`/content/post`配下に存在するファイルを`grep`で調査すること。リンクへの変換はファイル名から変換して使用すること（例: ファイル名`/content/post/2025/12/24/000000.md`=>内部リンク`/2025/12/24/000000/`）
- 調査結果は、調査ドキュメントとして保存する。調査ドキュメントは `content/warehouse/<slug>.md` に作成する（例: `content/warehouse/test2.md`）

## 連載構造案作成依頼

- 調査結果（`content/warehouse/<slug>.md`）に基づいて、シリーズ記事の連載構造案を3つ（案A/B/C）作成すること
- 各案は、異なる視点やアプローチを持つこと
- 生成後、レビューと改善を3回繰り返すこと

### 各案に必要な項目
- 特徴・アプローチ: メリット・デメリットを明記
- 連載構造表: 以下の列を持つ表形式
  - 回数（第N回）
  - タイトル
  - 新しい概念（1記事1概念の原則）
  - ストーリー（具体的なシナリオ）
  - コード例1/2（技術記事の場合）
  - 推奨タグ（5個まで、英語小文字・ハイフン形式）
- 差別化ポイント: 各案の独自性を明示
- 推薦案とその理由: ペルソナや検索意図への適合性

### 出力

- 連載構造案は `agents/structure/<slug>.md` に保存する
- フロントマター（YAML形式）をつける
- 調査結果の参照元を明記する

## 連載構造案レビュー依頼

- 連載構造案（`agents/structure/<slug>.md`）をレビューすること
- SEO視点と品質視点の両面から評価する
- 改善提案を具体的に提示する
- レビューサイクル（最大3回）の各目的：
  - 第1版→第2版: 構造の一貫性と段階的難易度の確認、1記事1概念の原則の遵守確認
  - 第2版→第3版（最終版）: SEO最適化と品質基準全項目の確認
  - 条件: 第1版または第2版で全品質基準を満たした場合、それを最終版とすることができる

### レビュー観点

SEO視点（search-engine-optimizationエージェント）:
- 各回のタイトルにキーワードが適切に配置されているか
- 検索意図に合致した構成か
- 推奨タグが適切か
- メタ情報の最適化（各回の description など）

品質視点（reviewerエージェント）:
- 構造の一貫性（ストーリーの流れ、難易度の段階性）
- 1記事1概念の原則が守られているか
- 各案が明確に差別化されているか
- ペルソナへの適合性
- 技術的正確性の担保

### 出力

- レビューコメントを連載構造案に追記する
- 改善が必要な場合は、改善版を作成する（第2版、第3版として同一ファイルに追記）
- 最終版では推薦案を明確に選定し、理由を文書化する
- **レビュー履歴セクションを追加**（以下のテンプレートを使用）：

~~~markdown
## レビュー履歴

### 第1版レビュー（YYYY-MM-DD）

- レビュー担当: ○○エージェント
- 評価結果: [合格/要改善]
- 主な改善点: ...

### 第2版レビュー（YYYY-MM-DD）

- レビュー担当: ○○エージェント
- 評価結果: [合格/要改善]
- 主な改善点: ...

### 最終版（第N版）確定（YYYY-MM-DD）

- 最終確認: reviewerエージェント
- 評価: 全品質基準を満たす
~~~

## アウトライン依頼

- 調査結果に基づいて、技術記事のアウトライン案を3つ（案A/B/C）作成すること
- 各案は、異なる視点やアプローチを持つこと
- 生成後、レビューと改善を3回繰り返すこと

### 各案に必要な項目
- 要約(1行)
- H2/H3 見出しの階層
- 推奨タグ(5つまで)

## 原稿作成依頼

- 調査結果とアウトラインに基づいて、記事を作成すること
- 技術的に正確で最新の情報を盛り込むこと
- コード例を適切に配置する
- 引用する場合はURLを単独のリンクとし、ショートコードを使用して記載する（例: `{{< linkcard "https://www.example.com" >}}`）
- 生成後、レビューと改善を3回繰り返すこと

### 出力
- 記事作成は、必ず新たなファイルとして作成する
- フロントマター（YAML形式）をつける
- H2/H3 見出しの階層に従って本文を作成する
- **「話し言葉（例:なんです）」ではなく「書き言葉（例:なのです）」で書く**
- **本文の文体は「です・ます調」にする**
- **箇条書きの文体は「だ・である調」にする**
- **箇条書きの最後の句点（。）はつけない**
- 各コード例に言語タグ、バージョン、外部依存を明記する
- 書籍については、ショートコード（amazon）を使用して記載する（例: `{{< amazon asin="<ASIN>" title="<書籍のタイトル>" >}}`）

# 検証と品質ゲート

## 単体記事の品質基準

- H2/H3 の見出しが適切に分割されていること
- 各セクションの説明が具体的であること（曖昧な語句は再要求）
- コード例の言語・バージョン・外部依存が明記されていること
- 推奨タグがリポジトリのタグ規約に合致していること（英語小文字、ハイフン）

## 連載構造案の品質基準

- 構造の一貫性: 連載全体でストーリーの流れが論理的に繋がっていること
- 段階的難易度上昇: 初回から最終回にかけて段階的に難易度が上がっていること
- 1記事1概念の原則: 各回で1つの新しい概念に焦点を当てていること（複数の概念を詰め込まない）
- 各案の差別化: 3つの構造案（案A/B/C）が明確に異なる視点・アプローチを持っていること
- 連載構造表の完全性: 全回分の「回数、タイトル、新概念、ストーリー、コード例、タグ」が記載されていること
