## Mojoliciousã¨ã¯

Mojoliciousã¯ã€Perlã§æ›¸ã‹ã‚ŒãŸãƒ¢ãƒ€ãƒ³ãªWebãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã€ŒThe Web in a Box!ã€ã¨ã„ã†ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºã®é€šã‚Šã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«å¿…è¦ãªã™ã¹ã¦ãŒã“ã‚Œã²ã¨ã¤ã«è©°ã¾ã£ã¦ã„ã¾ã™ã€‚

### Mojoliciousã®ç‰¹å¾´

1. **ä¾å­˜é–¢ä¿‚ã‚¼ãƒ­**: ã‚³ã‚¢Perlä»¥å¤–ã®ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚CPANã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã ã‘ã§ã€ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã¾ã™ã€‚
2. **ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯**: HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€WebSocketã‚µãƒãƒ¼ãƒˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã€JSONãƒ‘ãƒ¼ã‚µãƒ¼ãªã©ã€Webé–‹ç™ºã«å¿…è¦ãªã™ã¹ã¦ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
3. **éåŒæœŸI/O**: ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã‚’å†…è”µã—ã€é«˜æ€§èƒ½ãªéåŒæœŸå‡¦ç†ãŒå¯èƒ½ã§ã™ã€‚
4. **é–‹ç™ºãŒæ¥½ã—ã„**: ç¾ã—ã„APIã¨å„ªã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€å……å®Ÿã—ãŸãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã«ã‚ˆã‚Šã€é–‹ç™ºä½“é¨“ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚
5. **RESTful**: RESTful APIã®é–‹ç™ºã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

### Mojolicious::Liteã¨ã¯

Mojoliciousã«ã¯2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ï¼š

- **Mojolicious::Lite**: å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµã™ã‚‹è»½é‡ç‰ˆã€‚ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚„å°è¦æ¨¡ã‚¢ãƒ—ãƒªã«æœ€é©ã€‚
- **Mojolicious**: å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã®ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç‰ˆã€‚MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ§‹æˆã€‚

ä»Šå›ã¯åˆå¿ƒè€…å‘ã‘ã«ã€Mojolicious::Liteã‚’ä¸­å¿ƒã«è§£èª¬ã—ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

CPANã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã ã‘ã§ã™ï¼š

```bash
cpanm Mojolicious
```

ã¾ãŸã¯ã€cpanmã‚’ä½¿ã‚ãªã„å ´åˆï¼š

```bash
curl -L https://cpanmin.us | perl - -M https://cpan.metacpan.org -n Mojolicious
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªï¼š

```bash
mojo version
```

æœ€æ–°ç‰ˆã¯9.xç³»ã§ã™ï¼ˆ2025å¹´12æœˆç¾åœ¨ï¼‰ã€‚

## Hello World - æœ€å°ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

ã¾ãšã¯æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚`hello.pl`ã¨ã„ã†åå‰ã§ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ï¼š

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;

get '/' => sub ($c) {
  $c->render(text => 'Hello, Mojolicious!');
};

app->start;
```

å®Ÿè¡Œæ–¹æ³•ï¼š

```bash
perl hello.pl daemon
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§`http://localhost:3000`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã€ŒHello, Mojolicious!ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

- `use Mojolicious::Lite -signatures;`: Mojolicious::Liteã‚’èª­ã¿è¾¼ã¿ã€ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚·ã‚°ãƒãƒãƒ£ã‚’æœ‰åŠ¹åŒ–
- `get '/' => sub ($c) { ... };`: GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®šç¾©ã€‚`$c`ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `$c->render(text => 'Hello, Mojolicious!');`: ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
- `app->start;`: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

ãŸã£ãŸã“ã‚Œã ã‘ã§ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œæˆã§ã™ï¼

## ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - URLã¨å‡¦ç†ã®å¯¾å¿œ

Mojoliciousã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯éå¸¸ã«æŸ”è»Ÿã§ã™ã€‚æ§˜ã€…ãªHTTPãƒ¡ã‚½ãƒƒãƒ‰ã¨URLãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œã§ãã¾ã™ã€‚

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;

# GETãƒªã‚¯ã‚¨ã‚¹ãƒˆ
get '/' => sub ($c) {
  $c->render(text => 'Home Page');
};

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ããƒ«ãƒ¼ãƒˆ
get '/hello/:name' => sub ($c) {
  my $name = $c->param('name');
  $c->render(text => "Hello, $name!");
};

# ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰
get '/files/*filepath' => sub ($c) {
  my $path = $c->param('filepath');
  $c->render(text => "File path: $path");
};

# æ­£è¦è¡¨ç¾
get '/article/:id' => [id => qr/\d+/] => sub ($c) {
  my $id = $c->param('id');
  $c->render(text => "Article ID: $id");
};

# POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
post '/submit' => sub ($c) {
  my $data = $c->param('data');
  $c->render(text => "Received: $data");
};

app->start;
```

### ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ç¨®é¡

- `:name` - æ¨™æº–ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆ`/`ä»¥å¤–ã®ä»»æ„ã®æ–‡å­—åˆ—ï¼‰
- `*filepath` - ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆ`/`ã‚’å«ã‚€ä»»æ„ã®æ–‡å­—åˆ—ï¼‰
- `[name => qr/.../]` - æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹åˆ¶ç´„

è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
curl http://localhost:3000/hello/Perl
# => Hello, Perl!

curl http://localhost:3000/files/path/to/file.txt
# => File path: path/to/file.txt

curl http://localhost:3000/article/123
# => Article ID: 123
```

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - HTMLã‚’è¿”ã™

ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ãˆã°ã€HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ç°¡å˜ã§ã™ï¼š

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;

get '/' => sub ($c) {
  $c->render(template => 'index');
};

get '/user/:name' => sub ($c) {
  my $name = $c->param('name');
  $c->render(template => 'user', name => $name);
};

app->start;

__DATA__

@@ index.html.ep
<!DOCTYPE html>
<html>
<head>
  <title>Mojolicious App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { color: #8B4513; }
  </style>
</head>
<body>
  <h1>Welcome to Mojolicious!</h1>
  <p>Visit <a href="/user/YourName">/user/YourName</a></p>
</body>
</html>

@@ user.html.ep
<!DOCTYPE html>
<html>
<head>
  <title>User: <%= $name %></title>
</head>
<body>
  <h1>Hello, <%= $name %>!</h1>
  <p>Current time: <%= localtime %></p>
  
  % if ($name eq 'Perl') {
    <p>You have excellent taste in programming languages!</p>
  % }
  
  <a href="/">Back to home</a>
</body>
</html>
```

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¨˜æ³•

- `<%= ... %>`: Perlã‚³ãƒ¼ãƒ‰ã®è©•ä¾¡çµæœã‚’å‡ºåŠ›ï¼ˆHTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚ã‚Šï¼‰
- `<%== ... %>`: HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãªã—ã§å‡ºåŠ›
- `% ...`: è¡Œé ­ã®`%`ã§Perlã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°
- `%% ...`: å®Ÿéš›ã®`%`ã‚’å‡ºåŠ›ã—ãŸã„å ´åˆ

## JSON API - RESTful APIã‚’ä½œã‚‹

RESTful APIã®ä½œæˆã‚‚Mojoliciousã®å¾—æ„åˆ†é‡ã§ã™ï¼š

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;
use Mojo::JSON qw(decode_json encode_json);

# ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ï¼‰
my $todos = [
  {id => 1, title => 'Learn Mojolicious', done => 0},
  {id => 2, title => 'Build an app', done => 0},
];
my $next_id = 3;

# å…¨ä»¶å–å¾—
get '/api/todos' => sub ($c) {
  $c->render(json => $todos);
};

# 1ä»¶å–å¾—
get '/api/todos/:id' => sub ($c) {
  my $id = $c->param('id');
  my ($todo) = grep { $_->{id} == $id } @$todos;
  
  return $c->render(json => {error => 'Not found'}, status => 404)
    unless $todo;
  
  $c->render(json => $todo);
};

# æ–°è¦ä½œæˆ
post '/api/todos' => sub ($c) {
  my $json = $c->req->json;
  
  return $c->render(json => {error => 'Invalid data'}, status => 400)
    unless $json && $json->{title};
  
  my $todo = {
    id => $next_id++,
    title => $json->{title},
    done => $json->{done} // 0,
  };
  
  push @$todos, $todo;
  $c->render(json => $todo, status => 201);
};

# æ›´æ–°
put '/api/todos/:id' => sub ($c) {
  my $id = $c->param('id');
  my $json = $c->req->json;
  my ($todo) = grep { $_->{id} == $id } @$todos;
  
  return $c->render(json => {error => 'Not found'}, status => 404)
    unless $todo;
  
  $todo->{title} = $json->{title} if defined $json->{title};
  $todo->{done} = $json->{done} if defined $json->{done};
  
  $c->render(json => $todo);
};

# å‰Šé™¤
del '/api/todos/:id' => sub ($c) {
  my $id = $c->param('id');
  my $count = @$todos;
  
  @$todos = grep { $_->{id} != $id } @$todos;
  
  return $c->render(json => {error => 'Not found'}, status => 404)
    if @$todos == $count;
  
  $c->render(json => {message => 'Deleted'});
};

app->start;
```

### APIã®ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ä»¶å–å¾—
curl http://localhost:3000/api/todos

# 1ä»¶å–å¾—
curl http://localhost:3000/api/todos/1

# æ–°è¦ä½œæˆ
curl -X POST http://localhost:3000/api/todos \
  -H 'Content-Type: application/json' \
  -d '{"title":"Write article","done":false}'

# æ›´æ–°
curl -X PUT http://localhost:3000/api/todos/1 \
  -H 'Content-Type: application/json' \
  -d '{"done":true}'

# å‰Šé™¤
curl -X DELETE http://localhost:3000/api/todos/1
```

## WebSocket - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡

Mojoliciousã¯WebSocketã‚’æ¨™æº–ã§ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;

# æ¥ç¶šä¸­ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä¿å­˜
my $clients = {};

get '/' => sub ($c) {
  $c->render(template => 'chat');
};

websocket '/ws' => sub ($c) {
  # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ç”Ÿæˆ
  my $id = sprintf '%s', $c->tx;
  $clients->{$id} = $c->tx;
  
  $c->app->log->info("Client $id connected");
  
  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æ™‚ã®å‡¦ç†
  $c->on(message => sub ($c, $msg) {
    $c->app->log->info("Received: $msg");
    
    # å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
    for my $client (values %$clients) {
      $client->send($msg);
    }
  });
  
  # åˆ‡æ–­æ™‚ã®å‡¦ç†
  $c->on(finish => sub ($c, $code, $reason) {
    delete $clients->{$id};
    $c->app->log->info("Client $id disconnected");
  });
};

app->start;

__DATA__

@@ chat.html.ep
<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #messages { 
      border: 1px solid #ccc; 
      height: 300px; 
      overflow-y: auto; 
      padding: 10px; 
      margin-bottom: 10px;
    }
    #input { width: 300px; }
  </style>
</head>
<body>
  <h1>WebSocket Chat</h1>
  <div id="messages"></div>
  <input type="text" id="input" placeholder="Type a message...">
  <button id="send">Send</button>

  <script>
    const ws = new WebSocket('ws://localhost:3000/ws');
    const messages = document.getElementById('messages');
    const input = document.getElementById('input');
    const send = document.getElementById('send');

    ws.onmessage = function(event) {
      const p = document.createElement('p');
      p.textContent = event.data;
      messages.appendChild(p);
      messages.scrollTop = messages.scrollHeight;
    };

    function sendMessage() {
      if (input.value) {
        ws.send(input.value);
        input.value = '';
      }
    }

    send.onclick = sendMessage;
    input.onkeypress = function(e) {
      if (e.key === 'Enter') sendMessage();
    };
  </script>
</body>
</html>
```

è¤‡æ•°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§`http://localhost:3000`ã‚’é–‹ã„ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

## ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

Mojoliciousã«ã¯ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚‚çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚`test.t`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```perl
use Test::More;
use Test::Mojo;

# ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
use Mojolicious::Lite -signatures;

get '/' => sub ($c) {
  $c->render(text => 'Hello Test!');
};

get '/json' => sub ($c) {
  $c->render(json => {message => 'Hello', status => 'ok'});
};

# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
my $t = Test::Mojo->new;

# GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ
$t->get_ok('/')
  ->status_is(200)
  ->content_is('Hello Test!');

# JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ†ã‚¹ãƒˆ
$t->get_ok('/json')
  ->status_is(200)
  ->json_is('/message' => 'Hello')
  ->json_is('/status' => 'ok');

# å­˜åœ¨ã—ãªã„ãƒ‘ã‚¹
$t->get_ok('/notfound')
  ->status_is(404);

done_testing();
```

ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œï¼š

```bash
perl test.t
```

### ã‚ˆã‚Šé«˜åº¦ãªãƒ†ã‚¹ãƒˆä¾‹

POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„JSONãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆï¼š

```perl
use Test::More;
use Test::Mojo;

use Mojolicious::Lite -signatures;

post '/api/user' => sub ($c) {
  my $json = $c->req->json;
  return $c->render(json => {error => 'Name required'}, status => 400)
    unless $json->{name};
  
  $c->render(json => {
    id => 1,
    name => $json->{name},
    created => 1
  });
};

my $t = Test::Mojo->new;

# æ­£å¸¸ç³»
$t->post_ok('/api/user' => json => {name => 'Taro'})
  ->status_is(200)
  ->json_is('/id' => 1)
  ->json_is('/name' => 'Taro')
  ->json_is('/created' => 1);

# ç•°å¸¸ç³»
$t->post_ok('/api/user' => json => {})
  ->status_is(400)
  ->json_is('/error' => 'Name required');

done_testing();
```

## å®Ÿç”¨çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹ - URLã‚·ãƒ§ãƒ¼ãƒˆãƒŠãƒ¼

ã“ã‚Œã¾ã§å­¦ã‚“ã ã“ã¨ã‚’æ´»ã‹ã—ã¦ã€å®Ÿç”¨çš„ãªURLã‚·ãƒ§ãƒ¼ãƒˆãƒŠãƒ¼ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```perl
#!/usr/bin/env perl
use Mojolicious::Lite -signatures;
use Mojo::Util qw(b64_encode b64_decode);

# ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ï¼ˆç°¡æ˜“ç‰ˆï¼‰
my $urls = {};
my $counter = 1000;

# ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
get '/' => sub ($c) {
  $c->render(template => 'index');
};

# URLçŸ­ç¸®API
post '/api/shorten' => sub ($c) {
  my $url = $c->param('url');
  
  return $c->render(json => {error => 'URL required'}, status => 400)
    unless $url;
  
  # ç°¡æ˜“çš„ãªIDç”Ÿæˆï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ã‚ˆã‚Šå …ç‰¢ãªæ–¹æ³•ã‚’ä½¿ç”¨ï¼‰
  my $id = sprintf '%x', $counter++;
  $urls->{$id} = $url;
  
  my $short_url = $c->url_for("/s/$id")->to_abs;
  
  $c->render(json => {
    original => $url,
    short => $short_url,
    id => $id
  });
};

# ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
get '/s/:id' => sub ($c) {
  my $id = $c->param('id');
  my $url = $urls->{$id};
  
  return $c->render(text => 'Not found', status => 404)
    unless $url;
  
  $c->redirect_to($url);
};

# çµ±è¨ˆæƒ…å ±
get '/api/stats' => sub ($c) {
  $c->render(json => {
    total_urls => scalar keys %$urls,
    urls => [map { {id => $_, url => $urls->{$_}} } keys %$urls]
  });
};

app->start;

__DATA__

@@ index.html.ep
<!DOCTYPE html>
<html>
<head>
  <title>URL Shortener</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      background: #8B4513;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #654321; }
    #result {
      margin-top: 20px;
      padding: 15px;
      background: #f0f0f0;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ”— URL Shortener</h1>
  <p>Enter a long URL to shorten it:</p>
  
  <input type="text" id="url" placeholder="https://example.com/very/long/url">
  <button onclick="shortenUrl()">Shorten URL</button>
  
  <div id="result"></div>

  <script>
    async function shortenUrl() {
      const url = document.getElementById('url').value;
      if (!url) {
        alert('Please enter a URL');
        return;
      }

      const response = await fetch('/api/shorten', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'url=' + encodeURIComponent(url)
      });

      const data = await response.json();
      
      if (data.error) {
        alert(data.error);
        return;
      }

      const result = document.getElementById('result');
      result.innerHTML = `
        <h3>âœ… URL Shortened!</h3>
        <p><strong>Original:</strong> ${data.original}</p>
        <p><strong>Short URL:</strong> <a href="${data.short}" target="_blank">${data.short}</a></p>
      `;
      result.style.display = 'block';
    }
  </script>
</body>
</html>
```

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ï¼š

1. **URLçŸ­ç¸®**: é•·ã„URLã‚’çŸ­ç¸®URLã«å¤‰æ›
2. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**: çŸ­ç¸®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨å…ƒã®URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. **çµ±è¨ˆæƒ…å ±**: `/api/stats`ã§å…¨URLã®ä¸€è¦§ã‚’å–å¾—
4. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UI**: ã‚·ãƒ³ãƒ—ãƒ«ã§ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ´»ç”¨

Mojoliciousã«ã¯è±Šå¯Œãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ï¼š

### Mojolicious::Plugin::OpenAPI

OpenAPIï¼ˆSwaggerï¼‰ä»•æ§˜ã«åŸºã¥ã„ãŸAPIé–‹ç™ºï¼š

```perl
use Mojolicious::Lite -signatures;

plugin OpenAPI => {url => 'api.yaml'};

app->start;
```

### Mojolicious::Plugin::Authentication

ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ã®è¿½åŠ ï¼š

```perl
use Mojolicious::Lite -signatures;

plugin 'Authentication' => {
  load_user => sub ($app, $uid) {
    return {username => 'user', uid => $uid};
  },
  validate_user => sub ($c, $username, $password) {
    return $username eq 'admin' && $password eq 'secret' ? 1 : undef;
  },
};

get '/protected' => sub ($c) {
  return $c->redirect_to('/login') unless $c->is_user_authenticated;
  $c->render(text => 'Secret area');
};

app->start;
```

## ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

### é–‹ç™ºç’°å¢ƒ

é–‹ç™ºæ™‚ã¯çµ„ã¿è¾¼ã¿ã‚µãƒ¼ãƒãƒ¼ã§ååˆ†ã§ã™ï¼š

```bash
# ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ä»˜ãï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’è‡ªå‹•æ¤œçŸ¥ï¼‰
morbo myapp.pl

# æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰
perl myapp.pl daemon -l http://*:8080
```

### æœ¬ç•ªç’°å¢ƒ

æœ¬ç•ªç’°å¢ƒã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªé¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ï¼š

#### 1. Hypnotoadï¼ˆæ¨å¥¨ï¼‰

Mojoliciousçµ„ã¿è¾¼ã¿ã®é«˜æ€§èƒ½ãƒ—ãƒªãƒ•ã‚©ãƒ¼ã‚¯ã‚µãƒ¼ãƒãƒ¼ï¼š

```bash
hypnotoad myapp.pl
```

ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ï¼š

```bash
# æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆè‡ªå‹•çš„ã«å¤ã„ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç½®ãæ›ãˆï¼‰
hypnotoad myapp.pl
```

#### 2. ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·æ§‹æˆ

Nginx + Hypnotoadã®çµ„ã¿åˆã‚ã›ï¼š

```nginx
upstream myapp {
  server 127.0.0.1:8080;
}

server {
  listen 80;
  server_name example.com;

  location / {
    proxy_pass http://myapp;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
```

#### 3. Plack/PSGI

PSGIäº’æ›ã‚µãƒ¼ãƒãƒ¼ã§ã‚‚å‹•ä½œã—ã¾ã™ï¼š

```bash
plackup myapp.psgi
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨éåŒæœŸå‡¦ç†

Mojoliciousã®çœŸä¾¡ã¯éåŒæœŸå‡¦ç†ã«ã‚ã‚Šã¾ã™ã€‚è¤‡æ•°ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä¸¦åˆ—ã«å‡¦ç†ã™ã‚‹ä¾‹ï¼š

```perl
use Mojolicious::Lite -signatures;

get '/parallel' => sub ($c) {
  my $delay = Mojo::IOLoop->delay(sub ($delay, @results) {
    my ($user, $posts, $comments) = @results;
    $c->render(json => {
      user => $user,
      posts => $posts,
      comments => $comments
    });
  });

  # 3ã¤ã®APIã‚’ä¸¦åˆ—ã«å‘¼ã³å‡ºã—
  my $ua = $c->ua;
  $ua->get('https://api.example.com/user/1' => $delay->begin);
  $ua->get('https://api.example.com/posts' => $delay->begin);
  $ua->get('https://api.example.com/comments' => $delay->begin);
};

app->start;
```

## è¨­å®šç®¡ç†

ç’°å¢ƒã”ã¨ã«è¨­å®šã‚’å¤‰ãˆã‚‹æ–¹æ³•ï¼š

```perl
use Mojolicious::Lite -signatures;

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
plugin Config => {file => 'myapp.conf'};

get '/' => sub ($c) {
  my $db_host = $c->config('database')->{host};
  $c->render(text => "DB Host: $db_host");
};

app->start;
```

`myapp.conf`ã®ä¾‹ï¼š

```perl
{
  database => {
    host => 'localhost',
    port => 5432,
    name => 'myapp'
  },
  secrets => ['my-secret-key']
}
```

## ãƒ‡ãƒãƒƒã‚°æŠ€æ³•

Mojoliciousã«ã¯å¼·åŠ›ãªãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š

```perl
# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®è¨­å®š
app->log->level('debug');

# ãƒ­ã‚°å‡ºåŠ›
app->log->debug('Debug message');
app->log->info('Info message');
app->log->warn('Warning message');
app->log->error('Error message');

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ€ãƒ³ãƒ—
get '/debug' => sub ($c) {
  $c->app->log->debug($c->req->headers->to_string);
  $c->app->log->debug($c->req->body);
  $c->render(text => 'Check logs');
};
```

é–‹ç™ºæ™‚ã¯`MOJO_LOG_LEVEL`ç’°å¢ƒå¤‰æ•°ã§ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’åˆ¶å¾¡ï¼š

```bash
MOJO_LOG_LEVEL=debug perl myapp.pl daemon
```

## ã¾ã¨ã‚

Mojoliciousã¯ã€Œæ¥½ã—ãã€ã€Œãƒ¢ãƒ€ãƒ³ã€ãªPerlã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸå†…å®¹ã‚’ã¾ã¨ã‚ã¾ã™ï¼š

### å­¦ã‚“ã ã“ã¨

1. **åŸºæœ¬**: Mojolicious::Liteã§ã®æœ€å°æ§‹æˆã‹ã‚‰é–‹å§‹
2. **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: æŸ”è»ŸãªURLãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
3. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: EPãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§HTMLç”Ÿæˆ
4. **JSON API**: RESTful APIã®å®Ÿè£…
5. **WebSocket**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡
6. **ãƒ†ã‚¹ãƒˆ**: Test::Mojoã«ã‚ˆã‚‹è‡ªå‹•ãƒ†ã‚¹ãƒˆ
7. **å®Ÿç”¨ä¾‹**: URLã‚·ãƒ§ãƒ¼ãƒˆãƒŠãƒ¼ã®å®Ÿè£…
8. **ãƒ‡ãƒ—ãƒ­ã‚¤**: æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹æ–¹æ³•

### Mojoliciousã®é­…åŠ›

- **å­¦ç¿’æ›²ç·šãŒç·©ã‚„ã‹**: ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹ã‹ã‚‰å§‹ã‚ã¦ã€æ®µéšçš„ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã‚‹
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå……å®Ÿ**: `perldoc Mojolicious::Guides`ã§è©³ç´°ãªã‚¬ã‚¤ãƒ‰ãŒèª­ã‚ã‚‹
- **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒæ´»ç™º**: IRCãƒãƒ£ãƒ³ãƒãƒ«ã€ãƒ¡ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¹ãƒˆã€GitHub
- **å®Ÿæˆ¦æŠ•å…¥ã§ãã‚‹**: å°è¦æ¨¡ã‹ã‚‰å¤§è¦æ¨¡ã¾ã§å¯¾å¿œå¯èƒ½
- **æ¥½ã—ã„**: é–‹ç™ºä½“é¨“ãŒç´ æ™´ã‚‰ã—ãã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã®ãŒæ¥½ã—ããªã‚‹

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

Mojoliciousã‚’ã•ã‚‰ã«æ·±ãå­¦ã¶ã«ã¯ï¼š

1. **å…¬å¼ã‚¬ã‚¤ãƒ‰**: `perldoc Mojolicious::Guides::Tutorial`
2. **ã‚¯ãƒƒã‚¯ãƒ–ãƒƒã‚¯**: `perldoc Mojolicious::Guides::Cookbook`
3. **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**: CPAN ã§ `Mojolicious::Plugin::*` ã‚’æ¤œç´¢
4. **å®Ÿä¾‹**: GitHubã§å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã¦ã¿ã‚‹
5. **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**: #mojo on irc.libera.chat ã«å‚åŠ 

### å‚è€ƒãƒªãƒ³ã‚¯

- å…¬å¼ã‚µã‚¤ãƒˆ: https://mojolicious.org/
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.mojolicious.org/
- GitHub: https://github.com/mojolicious/mojo
- CPANãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: https://metacpan.org/pod/Mojolicious

Mojoliciousã§ã€æ¥½ã—ã„Perl Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

ã“ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œç¢ºèªã—ã¦ã„ã¾ã™ï¼š

- Perl: 5.30ä»¥ä¸Šï¼ˆã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚·ã‚°ãƒãƒãƒ£å¯¾å¿œç‰ˆï¼‰
- Mojolicious: 9.0ä»¥ä¸Š

å¤ã„Perlãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚·ã‚°ãƒãƒãƒ£ï¼ˆ`-signatures`ï¼‰ã®éƒ¨åˆ†ã‚’å¾“æ¥ã®`my ($c) = @_;`å½¢å¼ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚
