---
title: "コミットメッセージを直したい！git commit --amend の正しい使い方と注意点"
draft: true
tags:
  - git
  - git-commit
  - git-amend
  - best-practices
  - code-review
description: "タイプミスや情報不足のコミットメッセージを修正する方法を徹底解説。amendの基本から、複数コミット前のメッセージ修正、push済みコミットの扱い方まで、安全な修正手順とチーム開発での注意点を実例で学びます。"
---

コミットした直後に「あっ、メッセージにタイプミスが…」「肝心な情報を書き忘れた…」と気づいた経験はありませんか？本記事では、コミットメッセージを安全に修正する方法を、基本から応用まで実例を交えて解説します。

## git commit --amend の基本

`git commit --amend` は、直前のコミットを修正するための基本コマンドです。メッセージの修正だけでなく、ファイルの追加や削除も同時に行えます。

### メッセージだけを修正する

最もシンプルな使い方は、コミットメッセージだけを修正するケースです。

```bash
# 直前のコミットメッセージをエディタで修正
git commit --amend

# ワンライナーで修正
git commit --amend -m "fix: 正しいコミットメッセージ"
```

### ファイルも一緒に修正する

コミットに含めるファイルを追加したり、変更内容を修正したりすることも可能です。

```bash
# ファイルを修正してステージング
git add forgotten-file.txt

# 直前のコミットに含める
git commit --amend --no-edit
```

`--no-edit` オプションを使うと、メッセージを変更せずにコミット内容だけを更新できます。

## 複数前のコミットメッセージを修正する

直前以外のコミットメッセージを修正したい場合は、`git rebase -i`（インタラクティブリベース）を使います。

### rewordを使った修正

メッセージだけを変更する場合は `reword` を使います。

```bash
# 過去3つのコミットを対象にリベース開始
git rebase -i HEAD~3
```

エディタが開いたら、修正したいコミットの `pick` を `reword`（または短縮形の `r`）に変更します。

```
reword a1b2c3d feat: ユーザー認証機能を追加
pick e4f5g6h docs: READMEを更新
pick i7j8k9l fix: バリデーションエラーを修正
```

保存すると、対象コミットごとにエディタが開き、メッセージを編集できます。

### editを使った高度な修正

コミット内容そのものを変更したい場合は `edit` を使います。

```bash
git rebase -i HEAD~3
```

エディタで `pick` を `edit` に変更して保存すると、そのコミット時点で作業が一時停止します。

```bash
# ファイルを修正
vim src/auth.js

# 変更をステージング
git add src/auth.js

# コミットを修正
git commit --amend

# リベースを続行
git rebase --continue
```

## push済みコミットの修正リスク

リモートに既にpushしたコミットを修正する際は、慎重な対応が必要です。

### force pushの危険性

`--amend` や `rebase` でコミット履歴を書き換えた後は、通常の `git push` ではエラーになります。

```bash
# これはエラーになる
git push origin main
# ! [rejected]        main -> main (non-fast-forward)
```

強制的にpushするには `--force` が必要ですが、これは他の開発者の作業を破壊する可能性があります。

### --force-with-leaseで安全に

`--force-with-lease` を使うと、リモートブランチが想定外に更新されていないかチェックしてからpushできます。

```bash
# より安全な強制push
git push --force-with-lease origin main
```

他の開発者がpushしていた場合はエラーになり、意図しない上書きを防げます。

### チーム開発での運用ルール

実際のプロジェクトでは、以下のようなルールを設けることを推奨します。

- **mainブランチへのforce pushは原則禁止**（ブランチ保護設定を有効化）
- **push前の修正は自由**（ローカルでの`--amend`は積極的に使う）
- **push後の修正は慎重に**（チームメンバーへの事前通知と、影響範囲の確認）
- **共有ブランチでは新規コミットで修正**（履歴の書き換えではなく追加コミット）

## コミットメッセージのベストプラクティス

修正の手間を減らすには、最初から良いコミットメッセージを書くことが重要です。

### Conventional Commitsの活用

型を統一することで、後から見返しやすくなります。

```bash
# 良い例
git commit -m "feat: ユーザープロフィール編集機能を追加"
git commit -m "fix: ログイン時の認証エラーを修正"
git commit -m "docs: APIドキュメントを更新"

# 避けるべき例
git commit -m "修正"
git commit -m "WIP"
git commit -m "あとで直す"
```

### 必要な情報を含める

- **何を変更したか**（what）
- **なぜ変更したか**（why）
- **関連するissue番号**（ref）

```bash
git commit -m "fix: 商品検索で特殊文字が使えない問題を修正

Closes #123
原因: SQLクエリでエスケープ処理が不足
対策: PreparedStatementを使用"
```

## トラブルシューティング

### amendを間違えた時の復旧

間違えて `--amend` してしまった場合、`git reflog` で元に戻せます。

```bash
# 操作履歴を確認
git reflog

# 出力例
a1b2c3d HEAD@{0}: commit (amend): fix: 誤った修正
e4f5g6h HEAD@{1}: commit: fix: 元のコミット

# 元のコミットに戻す
git reset --hard HEAD@{1}
```

### リベース中にトラブルが発生した場合

コンフリクトや問題が発生したら、安全に中断できます。

```bash
# リベースを中止して元の状態に戻す
git rebase --abort
```

## まとめ

コミットメッセージの修正は、状況に応じて適切な方法を選択することが重要です。

- **未pushなら自由に修正**：`--amend` や `rebase -i` を活用
- **push済みなら慎重に**：`--force-with-lease` とチームへの配慮
- **最初から丁寧に書く**：Conventional Commitsで統一

これらのテクニックを使いこなせば、Git履歴を美しく保ちながら、チーム開発を円滑に進められます。まずはローカルブランチで練習して、操作に慣れていきましょう。
