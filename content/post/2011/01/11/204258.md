---
date: 2011-01-11T20:42:58+09:00
draft: false
iso8601: 2011-01-11T20:42:58+09:00
tags:
  - perl
title: Data::Modelで$row->get_columnsを覚えた

---
[JSONを返すスクリプトの記事](http://weblog.nqou.net/archives/20110110014314.html)で、リストを作るときに以下のようにしていたのですが。



```perl
my @json;
for my $msg (@{$messages}) {
    push @json,
      {
        id  => $msg->id,
        msg => $msg->msg,
        ts  => $msg->ts,
      };
}
$self->render(json => [@json]);
```




レコードの情報は、get\_columnsで取得できることがわかった。 それをふまえて書くと、上の処理に相当するコードは以下のようになります。



```perl
my @json;
for my $msg (@{$messages}) {
    push @json, $msg->get_columns;
}
$self->render(json => [@json]);
```




ここまで来たら、mapを使って書いてみたいですよね。



```perl
my @json = map { $_->get_columns } @{$messages};
$self->render(json => [@json]);
```




で、これだけだったら、直接書いても良さそうです。



```perl
$self->render(json => [map { $_->get_columns } @{$messages}]);
```




ただ、本当なら、$messagesから直に変換出来れば便利ですけどね。
