---
comments: true
description: GitHub Copilotカスタムエージェントのセットアップ方法を解説。.github/agents/ディレクトリの構成とYAMLフロントマターの設定項目を詳しく説明します。
draft: true
hidden: false
tags:
  - ai
  - copilot
  - programming
title: 【連載第2回】GitHub Copilotカスタムエージェント ― セットアップと基本設定

---

[@nqounet](https://x.com/nqounet)です。

カスタムエージェント連載の第2回です。前回は概要とできることを解説しましたが、今回は実際にカスタムエージェントをセットアップする手順を詳しく見ていきます。

## 前提条件

カスタムエージェントを利用するには、以下の条件が必要です。

1. **GitHub Copilotのサブスクリプション**
   - Copilot Individual、Copilot Business、またはCopilot Enterpriseのいずれか
2. **対応するエディタまたはGitHub.com**
   - VS Code、JetBrains IDE、Eclipse、Xcode、またはGitHub.com
3. **リポジトリへの書き込み権限**
   - `.github/agents/` ディレクトリを作成・編集するため

## ディレクトリ構成

カスタムエージェントは、`.github/agents/` ディレクトリに配置します。

```
your-repository/
├── .github/
│   ├── agents/
│   │   ├── readme-specialist.agent.md
│   │   ├── bugfix-engineer.agent.md
│   │   └── code-reviewer.agent.md
│   ├── workflows/
│   └── CODEOWNERS
├── src/
└── README.md
```

### ファイル名のルール

エージェントファイルは、以下の形式で命名します。

```
{agent-name}.agent.md
```

- `{agent-name}` には、エージェントを識別する名前を入れます
- 拡張子は必ず `.agent.md` とします
- 名前には英数字、ハイフン、アンダースコアを使用できます

例:
- `readme-specialist.agent.md`
- `code_reviewer.agent.md`
- `security-analyzer.agent.md`

## エージェントファイルの構造

エージェントファイルは、**YAMLフロントマター**と**Markdownによる指示**の2つの部分で構成されます。

```markdown
---
name: readme-specialist
description: プロジェクトのREADMEファイルを作成・改善します。
tools: ["read", "edit", "search"]
metadata:
  category: documentation
  owner: tech-writing-team
---

# READMEスペシャリスト

あなたはREADMEの専門家です。以下のガイドラインに従ってください。

## 主な責務

1. READMEファイルの作成と改善
2. プロジェクト構造の説明
3. セットアップ手順の整備

## 守るべきルール

- 簡潔でわかりやすい表現を使う
- コード例を必ず含める
- 英語と日本語の両方に対応する
```

## YAMLフロントマターの設定項目

### 必須項目

#### `description`（必須）

エージェントの目的と役割を記述します。ユーザーがエージェントを選択する際に表示されるため、**簡潔かつ明確に**記述することが重要です。

```yaml
description: プロジェクトのREADMEファイルを作成・改善します。
```

### オプション項目

#### `name`

エージェントの識別名を指定します。省略した場合、ファイル名から自動生成されます。

```yaml
name: readme-specialist
```

#### `tools`

エージェントが使用できるツールを制限します。省略した場合、すべてのツールが利用可能になります。

```yaml
tools: ["read", "edit", "search"]
```

使用可能なツール例:
- `read`: ファイルの読み取り
- `edit`: ファイルの編集
- `search`: コード検索
- `*`: すべてのツール（デフォルト）

#### `target`

エージェントを実行する環境を指定します。

```yaml
target: vscode
```

設定可能な値:
- `vscode`: VS Codeでのみ利用可能
- `github-copilot`: GitHub.comでのみ利用可能
- 省略時: 両方で利用可能

#### `mcp-servers`

MCP（Model Context Protocol）サーバーを定義します。外部ツールとの連携に使用します。

```yaml
mcp-servers:
  terraform:
    type: local
    command: docker
    args: ["run", "hashicorp/terraform-mcp-server"]
    tools: ["apply", "plan"]
```

この設定については、第5回で詳しく解説します。

#### `metadata`

任意のメタデータを追加できます。チーム管理やカテゴリ分類に便利です。

```yaml
metadata:
  category: documentation
  owner: tech-writing-team
  version: "1.0"
```

## 実践：READMEスペシャリストの作成

実際にREADMEスペシャリストを作成してみましょう。

### ステップ1: ディレクトリの作成

```bash
mkdir -p .github/agents
```

### ステップ2: エージェントファイルの作成

`.github/agents/readme-specialist.agent.md` を作成します。

```markdown
---
name: readme-specialist
description: >-
  プロジェクトのREADMEファイルを作成・改善します。
  バッジの追加、セクション構成、コード例の整備を行います。
tools: ["read", "edit", "search"]
metadata:
  category: documentation
  owner: docs-team
---

# READMEスペシャリスト

あなたはプロジェクトドキュメントの専門家です。

## 主な責務

- プロジェクトの構造を理解し、わかりやすいREADMEを作成する
- 必要なセクション（概要、インストール、使い方、貢献方法など）を整備する
- 適切なバッジ（CI状態、ライセンス、バージョンなど）を追加する
- コード例を含め、すぐに使い始められる形にする

## 守るべきルール

1. **簡潔さを優先**: 長すぎる説明は避け、要点を押さえる
2. **コード例を必ず含める**: 実際の使用方法を示す
3. **セクション構成を統一**: 見出しの階層を揃える
4. **最新情報を維持**: 古い情報がないか確認する

## 対象ファイル

- README.md
- docs/README.md
- 各ディレクトリのREADME.md

## 禁止事項

- ソースコードファイルの編集
- 設定ファイルの変更
- テストファイルの修正
```

### ステップ3: コミットとプッシュ

```bash
git add .github/agents/readme-specialist.agent.md
git commit -m "Add README specialist custom agent"
git push origin main
```

### ステップ4: エージェントの確認

GitHub.comまたはVS Codeで、Copilot Chatを開くとエージェントセレクターに「readme-specialist」が表示されます。

## 複数のエージェントを定義する

実際のプロジェクトでは、複数のエージェントを用意することが多いでしょう。

```
.github/agents/
├── readme-specialist.agent.md   # ドキュメント作成
├── bugfix-engineer.agent.md     # バグ修正
├── code-reviewer.agent.md       # コードレビュー
├── test-writer.agent.md         # テスト作成
└── security-analyst.agent.md    # セキュリティ分析
```

### バグ修正エンジニアの例

```markdown
---
name: bugfix-engineer
description: コードベースのバグを特定し、修正します。
tools: ["read", "edit", "search"]
---

# バグ修正エンジニア

あなたは経験豊富なデバッグの専門家です。

## アプローチ

1. エラーメッセージやスタックトレースを分析する
2. 関連するコードを検索する
3. 原因を特定する
4. 最小限の変更で修正する
5. 既存のテストが通ることを確認する

## 守るべきルール

- 修正は最小限にする
- 副作用を避ける
- 修正理由をコメントで残す
- 新しいバグを導入しない
```

### テストライターの例

```markdown
---
name: test-writer
description: ユニットテストと統合テストを作成します。
tools: ["read", "edit", "search"]
---

# テストライター

あなたはテスト自動化の専門家です。

## 責務

- ユニットテストの作成
- 統合テストの作成
- エッジケースのカバー
- テストカバレッジの向上

## 使用するテストフレームワーク

プロジェクトで使用されているフレームワークに従ってください：
- JavaScript: Jest, Vitest, Mocha
- Python: pytest, unittest
- Go: testing package
- Rust: cargo test
```

## 組織レベルでの設定

チーム全体で共通のエージェントを使用したい場合は、組織の `.github` リポジトリに配置します。

```
{organization}/.github/
└── agents/
    ├── company-standard.agent.md
    └── security-policy.agent.md
```

または、プライベートな設定が必要な場合は `.github-private` リポジトリを使用します。

```
{organization}/.github-private/
└── agents/
    └── internal-tools.agent.md
```

## 優先順位

複数のレベルで同名のエージェントが定義されている場合、以下の優先順位が適用されます。

1. **リポジトリレベル** (`.github/agents/`) - 最優先
2. **組織レベル** (`{org}/.github/agents/`)
3. **ユーザーレベル** (`~/.copilot/agents/`) - 最低優先

これにより、組織の標準エージェントを維持しつつ、特定のリポジトリでカスタマイズすることが可能です。

## トラブルシューティング

### エージェントが表示されない

1. ファイル名が `.agent.md` で終わっているか確認
2. YAMLフロントマターの構文が正しいか確認
3. `description` が設定されているか確認
4. ファイルがメインブランチにマージされているか確認

### YAMLエラーが発生する

YAMLは空白に敏感です。以下を確認してください。

```yaml
# NG: コロンの後に空白がない
description:説明文

# OK: コロンの後に空白がある
description: 説明文
```

複数行の値を書く場合は `>-` を使用します。

```yaml
description: >-
  これは複数行にわたる
  説明文です。
```

## まとめ

カスタムエージェントのセットアップは、以下の手順で行います。

1. `.github/agents/` ディレクトリを作成
2. `{name}.agent.md` ファイルを作成
3. YAMLフロントマターで設定を記述
4. Markdownで詳細な指示を記述
5. メインブランチにマージ

次回は、具体的なユースケースを通じて、カスタムエージェントの実践的な活用方法を解説します。

## 参考資料

- [Custom agents configuration - GitHub Docs](https://docs.github.com/en/copilot/reference/custom-agents-configuration)
- [Creating custom agents - GitHub Docs](https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/create-custom-agents)
- [Custom agents - GitHub Docs (Customization Library)](https://docs.github.com/en/copilot/tutorials/customization-library/custom-agents)
