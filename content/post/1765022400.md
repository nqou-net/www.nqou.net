---
comments: true
date: 2025-12-06T12:00:00+09:00
description: AGENTS.md ファイルを使ってエージェントの振る舞いを定義し、チーム固有のワークフローを構築する方法を実践的に学びます
draft: true
hidden: false
image: /favicon.png
iso8601: 2025-12-06T12:00:00+09:00
license: ~
math: ~
tags:
  - github
  - copilot
  - ai
  - agent
  - configuration
  - hands-on
series: "GitHub エージェントパネル実践ガイド"
title: 【第3回】最初のエージェント設定 - AGENTS.md による振る舞い定義

---

[@nqounet](https://x.com/nqounet)です。

GitHub エージェントパネル実践ガイド第3回です。今回は、`AGENTS.md` ファイルを使ってエージェントの振る舞いをカスタマイズし、チーム固有のワークフローを構築する方法を学びます。

## この記事で学べること

- AGENTS.md ファイルの基本構造
- エージェントの役割と振る舞いの定義方法
- プロンプトテンプレートの作成
- チーム固有の規約やルールの設定
- 実践的な AGENTS.md の作成

## AGENTS.md とは

`AGENTS.md` は、エージェントの振る舞いを定義する設定ファイルです。リポジトリのルートに配置することで、そのプロジェクト専用のエージェント設定を適用できます。

### なぜ AGENTS.md が必要なのか

**設定なしの場合：**
```
エージェント → デフォルトの振る舞い
  - 一般的なコーディング規約
  - 標準的なドキュメント形式
  - 汎用的な判断基準
```

**AGENTS.md がある場合：**
```
エージェント → カスタマイズされた振る舞い
  - プロジェクト固有のコーディング規約
  - チーム独自のドキュメント形式
  - プロジェクトに最適化された判断基準
```

### AGENTS.md の標準規格

`AGENTS.md` は [agents.md](https://agents.md/) で定義された標準規格に基づいています。この規格により、異なるツールやプラットフォーム間での互換性が保たれます。

## AGENTS.md の基本構造

最小限の AGENTS.md ファイルの例：

```markdown
# Project Agents

このファイルは、GitHub Copilot エージェントの振る舞いを定義します。

## 目的

- プロジェクト固有のコーディング規約を適用
- 一貫性のあるドキュメント生成
- チームのワークフローに最適化

## エージェント設定

### code-writer

役割: コード実装を担当

制約:
- ES6+ のモジュール構文を使用
- async/await でエラーハンドリング
- JSDoc コメントを必ず記載

### code-reviewer

役割: コードレビューを担当

確認項目:
- コーディング規約の遵守
- セキュリティの脆弱性
- パフォーマンスの問題
```

## 実践：最初の AGENTS.md を作成する

### ステップ1: プロジェクトの分析

まず、プロジェクトの特性を分析します：

```
プロジェクト情報:
  - 言語: Node.js (JavaScript/TypeScript)
  - フレームワーク: Express
  - テスト: Jest
  - リンター: ESLint
  - フォーマッター: Prettier

チーム規約:
  - 関数はアロー関数を優先
  - エラーは必ずログに記録
  - 環境変数は .env で管理
```

### ステップ2: 基本的な AGENTS.md の作成

プロジェクトルートに `AGENTS.md` を作成：

```markdown
# Express API Project - Agent Configuration

## プロジェクト概要

REST API サーバーの開発プロジェクト。Node.js + Express で構築し、
PostgreSQL をデータベースとして使用します。

## 技術スタック

- Node.js 18.x LTS
- Express 4.x
- PostgreSQL 15
- Jest (テスト)
- ESLint + Prettier (コード品質)

## 共通規約

### コーディングスタイル

- **インデント**: スペース2つ
- **引用符**: シングルクォート
- **セミコロン**: 使用する
- **関数**: アロー関数を優先
- **非同期処理**: async/await を使用（Promise チェーンは避ける）

### エラーハンドリング

すべてのエラーは適切にキャッチし、ログに記録すること：

```javascript
try {
  await someAsyncOperation();
} catch (error) {
  logger.error('Operation failed', { error: error.message, stack: error.stack });
  throw error;
}
```

### 環境変数

環境依存の設定は `.env` ファイルで管理：

```javascript
const config = {
  port: process.env.PORT || 3000,
  database: {
    host: process.env.DB_HOST,
    port: process.env.DB_PORT,
    name: process.env.DB_NAME
  }
};
```

## エージェント定義

### implementation-agent

**役割**: 新機能の実装とリファクタリング

**責務**:
- 要件に基づいたコードの実装
- 既存コードとの整合性確保
- ユニットテストの作成

**制約**:
- ファイル構造は以下に従う
  ```
  src/
    ├─ controllers/  # ビジネスロジック
    ├─ routes/       # ルーティング定義
    ├─ models/       # データモデル
    ├─ middleware/   # ミドルウェア
    └─ utils/        # ユーティリティ
  ```
- 各ファイルは200行以下に保つ
- 循環依存は避ける

**出力形式**:
- JSDoc コメント必須
- 型定義（JSDoc または TypeScript）
- エラーハンドリング実装済み
- ユニットテスト付き

### code-reviewer

**役割**: コード品質の検証とレビュー

**確認項目**:
1. **機能性**
   - 要件を満たしているか
   - エッジケースに対応しているか

2. **コード品質**
   - コーディング規約に準拠しているか
   - 重複コードがないか
   - 適切な抽象化がされているか

3. **セキュリティ**
   - SQL インジェクション対策
   - XSS 対策
   - 認証・認可の実装

4. **パフォーマンス**
   - N+1 クエリ問題
   - 不要なループ処理
   - メモリリーク

**レビュー基準**:
- Critical: 必ず修正が必要
- Warning: 修正を推奨
- Info: 参考情報

### documentation-agent

**役割**: ドキュメントの生成と更新

**生成するドキュメント**:
- API エンドポイントの説明（OpenAPI/Swagger 形式）
- README.md（セットアップ手順、使用方法）
- CHANGELOG.md（変更履歴）

**ドキュメント形式**:
- Markdown を使用
- コードブロックは言語指定付き
- 実行可能なサンプルコードを含める

**API ドキュメントテンプレート**:
```markdown
### POST /api/users

ユーザーを新規作成します。

**リクエスト**:
```json
{
  "email": "user@example.com",
  "password": "securePassword123"
}
```

**レスポンス**:
- 201 Created: ユーザー作成成功
- 400 Bad Request: バリデーションエラー
- 409 Conflict: メールアドレス重複
```

### testing-agent

**役割**: テストコードの生成

**テスト方針**:
- ユニットテスト: Jest を使用
- カバレッジ目標: 80% 以上
- テストケース: 正常系 + 異常系 + エッジケース

**テストファイル命名規則**:
```
src/controllers/user.js
  → tests/controllers/user.test.js
```

**テストテンプレート**:
```javascript
describe('UserController', () => {
  describe('createUser', () => {
    it('should create user successfully', async () => {
      // Arrange
      const userData = { email: 'test@example.com', password: 'pass123' };
      
      // Act
      const result = await userController.createUser(userData);
      
      // Assert
      expect(result).toHaveProperty('id');
      expect(result.email).toBe(userData.email);
    });
    
    it('should throw error for invalid email', async () => {
      // Arrange
      const userData = { email: 'invalid-email', password: 'pass123' };
      
      // Act & Assert
      await expect(userController.createUser(userData))
        .rejects.toThrow('Invalid email format');
    });
  });
});
```

## ワークフロー定義

### 新機能開発ワークフロー

```
1. 要件分析 (task-planner)
   → タスクの分解と優先順位付け

2. 実装 (implementation-agent)
   → コード作成 + ユニットテスト

3. レビュー (code-reviewer)
   → 品質確認と改善提案

4. ドキュメント (documentation-agent)
   → API ドキュメント更新

5. 最終確認
   → 統合テスト実行
```

### バグ修正ワークフロー

```
1. 問題分析 (code-reviewer)
   → 原因特定と影響範囲調査

2. 修正実装 (implementation-agent)
   → バグ修正 + リグレッションテスト追加

3. レビュー (code-reviewer)
   → 修正内容の妥当性確認

4. ドキュメント (documentation-agent)
   → CHANGELOG 更新
```

## 参考リンク

- [agents.md 公式サイト](https://agents.md/)
- [ESLint 設定ガイド](https://eslint.org/docs/user-guide/configuring/)
- [Jest テストガイド](https://jestjs.io/docs/getting-started)
```

### ステップ3: AGENTS.md の検証

作成した AGENTS.md が正しく機能するか確認します：

```bash
# エージェントパネルでタスクを実行
# AGENTS.md の設定が適用されているか確認
```

**確認するタスク例：**
```
タスク: "ユーザー登録APIエンドポイントを実装してください"

期待される動作:
  - AGENTS.md で定義したファイル構造に従う
  - JSDoc コメントが自動的に追加される
  - async/await パターンが使用される
  - ユニットテストが自動生成される
```

## 高度な AGENTS.md のカスタマイズ

### 条件分岐の使用

特定の条件下で異なる振る舞いを定義：

```markdown
### implementation-agent

#### フロントエンド実装の場合

制約:
- React Hooks を使用
- Functional Component で実装
- PropTypes または TypeScript で型定義

#### バックエンド実装の場合

制約:
- Express Router を使用
- ミドルウェアで共通処理
- Joi でバリデーション
```

### プロンプトテンプレートの定義

よく使うタスクのテンプレート：

```markdown
## プロンプトテンプレート

### REST API エンドポイント追加

以下の情報を埋めて使用してください：

```
{エンティティ名}の{操作}APIエンドポイントを実装してください。

エンドポイント: {メソッド} /api/{パス}
リクエスト: {リクエストボディの例}
レスポンス: {レスポンスボディの例}
バリデーション: {バリデーションルール}
```

例:
```
ユーザーの作成APIエンドポイントを実装してください。

エンドポイント: POST /api/users
リクエスト: {"email": "user@example.com", "password": "pass123"}
レスポンス: {"id": 1, "email": "user@example.com", "createdAt": "2025-12-06T12:00:00Z"}
バリデーション: email は有効な形式、password は8文字以上
```
```

### チーム固有のパターン集

よく使う実装パターンを定義：

```markdown
## 実装パターン集

### データベースアクセスパターン

```javascript
// モデル定義
class UserModel {
  static async findById(id) {
    const query = 'SELECT * FROM users WHERE id = $1';
    const result = await db.query(query, [id]);
    return result.rows[0];
  }
  
  static async create(userData) {
    const query = `
      INSERT INTO users (email, password_hash, created_at)
      VALUES ($1, $2, NOW())
      RETURNING *
    `;
    const result = await db.query(query, [userData.email, userData.passwordHash]);
    return result.rows[0];
  }
}
```

### エラーレスポンスパターン

```javascript
// エラーハンドリングミドルウェア
app.use((err, req, res, next) => {
  logger.error('Error occurred', {
    error: err.message,
    stack: err.stack,
    path: req.path,
    method: req.method
  });
  
  res.status(err.statusCode || 500).json({
    error: {
      message: err.message,
      code: err.code,
      details: err.details
    }
  });
});
```
```

## 実践演習：ブログシステム用 AGENTS.md

Hugo ブログシステム用の AGENTS.md を作成してみましょう。

```markdown
# Hugo Blog - Agent Configuration

## プロジェクト概要

Hugo を使用した技術ブログサイト。記事の執筆から公開までを
エージェントで自動化します。

## ディレクトリ構造

```
content/
  └─ post/
       ├─ 2025/
       │   └─ 12/
       │       └─ 06/
       │           └─ article.md
       └─ {timestamp}.md
static/
  └─ images/
layouts/
config/
```

## エージェント定義

### blog-writer

**役割**: ブログ記事の執筆

**記事テンプレート**:
```markdown
---
title: "記事タイトル"
date: 2025-12-06T12:00:00+09:00
draft: true
tags:
  - tag1
  - tag2
categories:
  - category1
description: "120文字以内の要約"
---

[@nqounet](https://x.com/nqounet)です。

(記事本文)

## まとめ

(結論)

質問や感想は [@nqounet](https://x.com/nqounet) までお気軽にどうぞ！
```

**執筆ガイドライン**:
- タイトルは60文字以内
- description は120文字以内
- 見出しは H2 から使用（H1 はタイトル）
- コードブロックは言語指定必須
- 専門用語には初出時に説明を付ける

### blog-reviewer

**役割**: 記事の品質確認

**確認項目**:
- Front matter の必須項目（title, date, tags, description）
- Markdown 文法の正確性
- リンク切れチェック
- 画像の alt テキスト
- 誤字脱字

**品質基準**:
- 文字数: 800-3000字
- 見出し数: 3-8個
- コードブロック: 0個以上（技術記事の場合は1個以上推奨）

### seo-optimizer

**役割**: SEO 最適化

**最適化項目**:
- タイトルの最適化（クリック率向上）
- メタディスクリプション
- タグの選定（5個以内推奨）
- 内部リンク提案

**タイトル提案例**:
```
元: "Gitの使い方"
↓
改善: "【初心者向け】Gitの基本コマンドと実践的な使い方"
```
```

## AGENTS.md のベストプラクティス

### 1. 段階的に拡張する

最初は最小限の設定から始め、必要に応じて追加：

```
フェーズ1: 基本設定
  - プロジェクト概要
  - コーディング規約
  - 1-2個のエージェント定義

フェーズ2: 拡張
  - ワークフロー定義
  - プロンプトテンプレート
  - より詳細な制約

フェーズ3: 最適化
  - チーム固有のパターン
  - パフォーマンス調整
  - エラーケースの対応
```

### 2. 実例を含める

抽象的な説明だけでなく、具体的なコード例を記載：

```markdown
❌ 悪い例:
「適切なエラーハンドリングを実装すること」

✅ 良い例:
「以下のパターンでエラーハンドリングを実装すること」
```javascript
try {
  await operation();
} catch (error) {
  logger.error('Operation failed', { error });
  throw new AppError('User-friendly message', 500);
}
```
```

### 3. メンテナンスしやすく

定期的に見直し、実際の運用に合わせて更新：

```markdown
## 更新履歴

- 2025-12-06: 初版作成
- 2025-12-10: テストパターンを追加
- 2025-12-15: エラーハンドリングガイドラインを明確化
```

## トラブルシューティング

### AGENTS.md が認識されない

**症状**: エージェントがデフォルトの振る舞いのまま

**原因と対策**:
```
1. ファイル名が間違っている
   → 正確に "AGENTS.md" にする（大文字）

2. ファイルの配置場所が間違っている
   → リポジトリルートに配置

3. Markdown 構文エラー
   → 構文チェッカーで検証
```

### エージェントが設定を無視する

**症状**: AGENTS.md の制約が適用されない

**対策**:
```
1. 制約を明確に記述
   ❌ 「きれいに書く」
   ✅ 「インデントはスペース2つ」

2. 例を含める
   文章だけでなく、コード例を追加

3. 優先度を明示
   複数の制約がある場合は優先順位を記載
```

## 次回予告

第4回「タスクプランニングエージェントの活用」では、複雑な開発タスクを効率的に分解・管理する方法を学びます。

具体的には：
- タスク分解の理論と実践
- 依存関係の管理
- 優先順位付けのテクニック
- 大規模機能開発の計画立案

## チェックリスト

この記事を読んだら、以下を確認してみましょう：

- [ ] AGENTS.md の基本構造を理解した
- [ ] プロジェクトに合わせた AGENTS.md を作成した
- [ ] エージェントの振る舞いをカスタマイズできた
- [ ] プロンプトテンプレートを定義した
- [ ] AGENTS.md が正しく機能することを確認した

## 演習課題

以下の AGENTS.md を作成してみましょう：

1. **自分のプロジェクト用**: 実際に取り組んでいるプロジェクトの AGENTS.md
2. **Python Flask プロジェクト用**: Web API 開発のための設定
3. **React アプリ用**: フロントエンド開発のための設定

## 参考リソース

- [AGENTS.md 規格仕様](https://agents.md/)
- [サンプル AGENTS.md 集](https://github.com/agents-md/examples)
- 本リポジトリの [AGENTS.md](/AGENTS.md)

---

**シリーズ目次**
1. [エージェントパネル入門](../1764676800/)
2. [エージェントパネルの基本操作](../1764849600/)
3. **最初のエージェント設定**（本記事）
4. タスクプランニングエージェントの活用
5. コード生成エージェントの実践
6. レビューエージェントの構築
7. ドキュメント生成エージェントの設定
8. マルチエージェント連携
9. カスタムツール統合
10. セキュリティとベストプラクティス
11. トラブルシューティング
12. 実践プロジェクト

質問や感想は [@nqounet](https://x.com/nqounet) までお気軽にどうぞ！
