---
title: "GitHub Copilot エージェントパネル入門 - 第8回: デバッグとトラブルシューティング"
description: "エージェントの問題を効率的に解決する方法を解説。ログ分析、デバッグモード、パフォーマンスチューニングのテクニックを習得"
date: 2025-12-09T15:00:00+09:00
draft: true
tags:
  - GitHub
  - Copilot
  - Agent Panel
  - デバッグ
  - トラブルシューティング
image: /favicon.png
---

## はじめに

[@nqounet](https://x.com/nqounet)です。

第8回では、エージェントのデバッグとトラブルシューティングを学びます。問題の特定から解決まで、効率的なデバッグ手法を身につけましょう。

## ログの活用

### ログレベルの設定

```yaml
---
name: debuggable-agent
version: 1.0.0

logging:
  level: "debug"  # trace, debug, info, warn, error
  outputs:
    - type: console
      format: "pretty"
    - type: file
      path: ".agent-logs/debug.log"
      format: "json"
      maxSize: "10MB"
      maxFiles: 5
---
```

### ログの読み方

```
[2025-12-09 15:30:45.123] DEBUG [workflow:code-review] Starting workflow
[2025-12-09 15:30:45.234] INFO  [agent:syntax-checker] Processing 15 files
[2025-12-09 15:30:46.345] DEBUG [agent:syntax-checker] File 1/15: src/app.ts
[2025-12-09 15:30:46.456] WARN  [agent:syntax-checker] Deprecated syntax detected at line 42
[2025-12-09 15:30:47.567] ERROR [agent:eslint] Failed to parse file: Unexpected token
[2025-12-09 15:30:47.678] DEBUG [agent:eslint] Stack trace: ...
```

重要なポイント：
- **ERROR**: 即座に対処が必要
- **WARN**: 注意が必要だが処理は継続
- **INFO**: 通常の処理フロー
- **DEBUG**: 詳細な内部動作

## デバッグモードの使い方

### デバッグモードの有効化

```yaml
---
name: agent-with-debug
version: 1.0.0

debug:
  enabled: true
  breakpoints:
    - step: "code-analyzer"
      condition: "${files.length} > 10"
    - step: "security-scanner"
      always: true
  
  inspect:
    variables: true
    callStack: true
    performance: true
---
```

### ステップ実行

```markdown
## デバッグ実行

### ブレークポイントで停止
\`\`\`
[DEBUG] Breakpoint hit at step 'code-analyzer'
[DEBUG] Variables:
  - files: Array(15)
  - config: Object {...}
  - previousResult: Object {...}

Commands:
  c - Continue
  s - Step over
  i - Inspect variable
  q - Quit
> 
\`\`\`

### 変数の検査
\`\`\`
> i files[0]
{
  path: "src/app.ts",
  size: 1234,
  modified: "2025-12-09T10:30:00Z"
}

> i config.strictness
"high"
\`\`\`
```

## よくあるエラーと対処法

### 1. パラメータエラー

```
Error: Invalid parameter 'language': expected one of [javascript, typescript, python], got 'jsx'
```

**原因**: パラメータの値が定義された選択肢にない

**解決**:
```yaml
parameters:
  - name: language
    type: string
    options:
      - "javascript"
      - "typescript"
      - "python"
      - "jsx"  # ← 追加
```

### 2. 依存関係エラー

```
Error: Required agent 'eslint-checker' (version ^2.0.0) not found. 
Found version 1.5.0 which does not satisfy requirements.
```

**原因**: 依存エージェントのバージョンが要件を満たしていない

**解決**:
```bash
# エージェントを更新
copilot-agent update eslint-checker

# または、要件を緩和
dependencies:
  agents:
    - name: eslint-checker
      version: ">=1.5.0"  # ← バージョン要件を変更
```

### 3. タイムアウトエラー

```
Error: Agent 'security-scanner' timed out after 60000ms
```

**原因**: 処理時間が制限を超えた

**解決策**:
```yaml
execution:
  timeout: 120000  # 60秒 → 120秒に延長

# または、処理を分割
workflow:
  steps:
    - agent: security-scanner
      parameters:
        batchSize: 5  # 一度に5ファイルずつ処理
```

### 4. メモリ不足エラー

```
Error: Out of memory. Agent exceeded 512MB limit.
```

**原因**: メモリ使用量が上限を超えた

**解決**:
```yaml
execution:
  maxMemoryMB: 1024  # 制限を拡大

# または、メモリ効率を改善
workflow:
  steps:
    - agent: file-processor
      parameters:
        streaming: true  # ストリーミング処理
        cacheSize: "100MB"  # キャッシュサイズ削減
```

### 5. API エラー

```
Error: GitHub API rate limit exceeded. Reset at 2025-12-09T16:00:00Z
```

**原因**: APIレート制限に達した

**解決**:
```yaml
apis:
  - name: github-api
    rateLimit:
      strategy: "exponential-backoff"
      retryAfter: true
      maxRetries: 3

# または、キャッシュを活用
cache:
  enabled: true
  ttl: 3600  # 1時間キャッシュ
```

## パフォーマンスチューニング

### プロファイリング

```yaml
---
name: profiling-agent
version: 1.0.0

profiling:
  enabled: true
  measures:
    - executionTime
    - memoryUsage
    - apiCalls
    - cacheHitRate
  
  output:
    format: "json"
    file: ".agent-logs/profile.json"
---
```

プロファイル結果:
```json
{
  "workflow": "code-review",
  "totalTime": 45230,
  "steps": [
    {
      "name": "syntax-checker",
      "time": 2340,
      "memory": "45MB",
      "percentage": 5.2
    },
    {
      "name": "eslint",
      "time": 18950,
      "memory": "128MB",
      "percentage": 41.9
    },
    {
      "name": "security-scanner",
      "time": 23940,
      "memory": "256MB",
      "percentage": 52.9
    }
  ],
  "bottleneck": "security-scanner"
}
```

### 最適化のポイント

```markdown
## パフォーマンス改善策

### 1. 並列化
❌ Before (45秒):
\`\`\`yaml
workflow:
  type: sequential
  steps:
    - agent: eslint        # 19s
    - agent: prettier      # 8s
    - agent: type-checker  # 18s
\`\`\`

✅ After (18秒):
\`\`\`yaml
workflow:
  type: parallel
  steps:
    - agent: eslint        # 19s
    - agent: prettier      # 8s
    - agent: type-checker  # 18s
  # 最長の19秒で完了（60%高速化）
\`\`\`

### 2. キャッシング
\`\`\`yaml
cache:
  enabled: true
  strategy: "content-hash"
  ttl: 3600

# 2回目以降の実行が大幅に高速化
# 初回: 45秒 → 2回目以降: 5秒
\`\`\`

### 3. 処理の絞り込み
\`\`\`yaml
triggers:
  filePatterns:
    - "src/**/*.ts"
  excludePatterns:
    - "**/*.test.ts"      # テストファイルを除外
    - "**/*.spec.ts"
    - "node_modules/**"
  maxFileSize: 500  # 500KB以上のファイルはスキップ
\`\`\`
```

## トレーシングとデバッグツール

### 分散トレーシング

```yaml
---
name: traced-agent
version: 1.0.0

tracing:
  enabled: true
  sampler: "always"  # or "probability:0.1"
  exporter:
    type: "jaeger"
    endpoint: "http://localhost:14268/api/traces"
  
  attributes:
    service.name: "copilot-agent"
    service.version: "1.0.0"
---
```

トレース表示:
```
Workflow: code-review (45.2s)
├── syntax-checker (2.3s)
│   ├── file-loader (0.5s)
│   ├── parser (1.2s)
│   └── validator (0.6s)
├── eslint (18.9s) [PARALLEL]
│   ├── config-loader (0.3s)
│   ├── linting (17.8s)
│   └── report-generator (0.8s)
├── prettier (8.1s) [PARALLEL]
└── security-scanner (23.9s) ← BOTTLENECK
    ├── vulnerability-db-fetch (5.2s)
    ├── pattern-matching (16.4s)
    └── report-generation (2.3s)
```

### ビジュアルデバッガー

```yaml
debug:
  visualizer:
    enabled: true
    port: 9229
    ui: "vscode"  # or "chrome-devtools"

  features:
    - breakpoints
    - variable-inspection
    - call-stack
    - network-monitor
    - timeline-view
```

VS Code でのデバッグ:
```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "copilot-agent",
      "request": "launch",
      "name": "Debug Agent",
      "workflow": "code-review",
      "parameters": {
        "strictness": "high"
      },
      "stopOnEntry": true
    }
  ]
}
```

## エラーリカバリー

### 自動リカバリー

```yaml
---
name: resilient-agent
version: 1.0.0

recovery:
  strategies:
    - type: "retry"
      maxAttempts: 3
      backoff: "exponential"
      conditions:
        - "timeout"
        - "network-error"
    
    - type: "fallback"
      conditions:
        - "dependency-missing"
      fallbackAgent: "alternative-checker"
    
    - type: "skip"
      conditions:
        - "file-too-large"
      logWarning: true
    
    - type: "abort"
      conditions:
        - "critical-error"
      notify: true
---
```

### チェックポイントとロールバック

```yaml
workflow:
  checkpoints:
    enabled: true
    frequency: "per-step"
    storage: ".agent-checkpoints"
  
  rollback:
    enabled: true
    conditions:
      - "error-rate > 50%"
      - "critical-error"
    
    onRollback:
      - action: "restore-checkpoint"
        checkpoint: "last-successful"
      
      - action: "notify"
        channels: ["slack"]
        message: "Workflow rolled back to ${checkpoint.name}"
```

## 実践的なデバッグワークフロー

### ステップ1: 問題の特定

```bash
# ログを確認
tail -f .agent-logs/debug.log

# 特定のエラーを検索
grep "ERROR" .agent-logs/debug.log

# パフォーマンス情報を確認
copilot-agent profile show --workflow code-review
```

### ステップ2: 再現

```yaml
---
name: debug-reproduction
version: 1.0.0

debug:
  enabled: true
  captureInput: true  # 入力データを保存
  
test:
  fixtures:
    - name: "error-case-1"
      input: "fixtures/error-case-1.json"
      expectedError: "timeout"
---
```

### ステップ3: 修正

```yaml
# 修正前
timeout: 30000  # 30秒

# 修正後  
timeout: 60000  # 60秒
retryOnError: true
maxRetries: 3
```

### ステップ4: 検証

```bash
# テストモードで実行
copilot-agent run --workflow code-review --test --dry-run

# 本番と同じ条件で検証
copilot-agent run --workflow code-review --input fixtures/error-case-1.json
```

## 動作確認チェックリスト

- [ ] ログレベルを設定してログを確認した
- [ ] デバッグモードで実行した
- [ ] よくあるエラーの対処法を理解した
- [ ] パフォーマンスプロファイリングを実施した
- [ ] トレーシングを設定した
- [ ] エラーリカバリーを実装した
- [ ] デバッグワークフローを実践した

## 次回予告

第9回では、実践パターン集として、コードレビュー自動化の具体的な実装を学びます：

- 完全なコードレビューエージェントの実装
- プルリクエストへの自動コメント
- レビュー品質の向上
- チーム運用のベストプラクティス

## まとめ

この記事では、デバッグとトラブルシューティングについて学びました：

1. **ログの活用**
   - ログレベルの設定
   - ログの読み方と分析

2. **デバッグ手法**
   - デバッグモードの使用
   - ステップ実行と変数検査

3. **パフォーマンスチューニング**
   - プロファイリング
   - 並列化とキャッシング

4. **エラーリカバリー**
   - 自動リカバリー戦略
   - チェックポイントとロールバック

次回からは、実践的なパターンを使って、実際の開発現場で使えるエージェントを構築していきます！
