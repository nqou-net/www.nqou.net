---
title: "GitHub Copilot エージェントパネル入門 - 第2回: 最初のカスタムエージェント作成"
description: "カスタムエージェントの作成方法を実践的に解説。エージェント定義ファイル、プロンプトエンジニアリングの基礎、実際に動作するエージェントの実装まで"
date: 2025-12-03T15:00:00+09:00
draft: true
tags:
  - GitHub
  - Copilot
  - Agent Panel
  - カスタムエージェント
  - プロンプト
image: /favicon.png
---

## はじめに

[@nqounet](https://x.com/nqounet)です。

第2回では、実際にカスタムエージェントを作成します。エージェント定義ファイルの書き方から、プロンプトの設計、実行までを一通り体験していきましょう。

前回のおさらい：エージェントパネルの基本セットアップと、デフォルトエージェントの実行方法を学びました。

## カスタムエージェントとは

デフォルトで提供されるエージェント以外に、プロジェクト固有のニーズに合わせた独自のエージェントを作成できます。

### カスタムエージェントのユースケース

- **プロジェクト固有のコーディング規約チェック**
- **特定のフレームワークに特化したコード生成**
- **社内ドキュメントフォーマットへの準拠**
- **特殊なテストパターンの生成**

## エージェント定義ファイルの構造

カスタムエージェントは、`.github/agents/` ディレクトリに配置します。

### ディレクトリ構成

```
your-project/
├── .github/
│   └── agents/
│       ├── my-agent.agent.md
│       ├── code-reviewer.agent.md
│       └── doc-generator.agent.md
└── ... (その他のプロジェクトファイル)
```

### エージェント定義ファイルの基本形式

エージェント定義は Markdown ファイル（`.agent.md`）で記述します：

```markdown
---
name: my-first-agent
description: 私の最初のカスタムエージェント
version: 1.0.0
author: Your Name
---

# エージェントの役割

このエージェントは、JavaScriptコードの品質チェックを行います。

## 実行時の指示

与えられたコードに対して、以下をチェックしてください：

1. 変数宣言に `var` が使われていないか
2. 関数にJSDocコメントがあるか
3. console.log が残っていないか

結果は以下の形式で出力してください：

- 問題点のリスト
- 重要度（High/Medium/Low）
- 修正提案
```

### Front Matter の必須項目

```yaml
---
name: エージェントの一意な識別子（英数字とハイフン）
description: エージェントの簡潔な説明
version: バージョン番号（セマンティックバージョニング推奨）
author: 作成者名（省略可）
---
```

## 実践: JavaScriptチェックエージェントを作る

それでは、実際にJavaScriptのコード品質をチェックするエージェントを作成してみましょう。

### ステップ1: エージェントファイルの作成

`.github/agents/js-quality-checker.agent.md` を作成：

```markdown
---
name: js-quality-checker
description: JavaScript コード品質チェッカー
version: 1.0.0
author: nqounet
---

# JavaScript 品質チェッカー

モダンなJavaScriptのベストプラクティスに基づいてコードをレビューします。

## あなたの役割

あなたは経験豊富なJavaScript開発者です。与えられたコードを分析し、
改善点を具体的に指摘してください。

## チェック項目

### 必須チェック
1. **変数宣言**: `var` の代わりに `const` または `let` を使用
2. **アロー関数**: 可能な場所ではアロー関数を使用
3. **テンプレートリテラル**: 文字列結合の代わりにテンプレートリテラルを使用

### 推奨チェック
1. **JSDocコメント**: すべての関数にJSDocを付ける
2. **エラーハンドリング**: try-catchの適切な使用
3. **デバッグコード**: console.log の削除

## 出力形式

以下の形式でMarkdownで出力してください：

### チェック結果

**ファイル**: [ファイル名]

#### 🔴 Critical Issues
- [問題の説明]
  - **場所**: 行番号
  - **推奨**: 具体的な修正案

#### 🟡 Warnings
- [問題の説明]
  - **場所**: 行番号
  - **推奨**: 具体的な修正案

#### ✅ Good Practices Found
- [良い点の説明]

**総合評価**: [スコア]/100
```

### ステップ2: テスト用のコードを準備

`sample.js` を作成：

```javascript
// sample.js
var userName = "John";

function greetUser(name) {
  var greeting = "Hello, " + name + "!";
  console.log(greeting);
  return greeting;
}

function calculateTotal(items) {
  var total = 0;
  for (var i = 0; i < items.length; i++) {
    total += items[i].price;
  }
  return total;
}

greetUser(userName);
```

### ステップ3: エージェントを実行

1. **エージェントパネルを開く**
   ```
   Ctrl+Shift+P → "Copilot: Open Agent Panel"
   ```

2. **エージェントを更新/リロード**
   ```
   エージェントパネル → 設定アイコン → "Reload Agents"
   ```

3. **`sample.js` を開いた状態で実行**
   ```
   Available Agents → "js-quality-checker" → "Run on Current File"
   ```

### ステップ4: 結果の確認

エージェントが以下のような分析結果を出力します：

```markdown
### チェック結果

**ファイル**: sample.js

#### 🔴 Critical Issues
- `var` を使用しています（ES6+ では `const` または `let` を推奨）
  - **場所**: 1行目, 4行目, 9行目, 10行目
  - **推奨**: 
    ```javascript
    const userName = "John";
    const greeting = `Hello, ${name}!`;
    let total = 0;
    let i = 0;
    ```

#### 🟡 Warnings
- 文字列結合の代わりにテンプレートリテラルを使用してください
  - **場所**: 4行目
  - **推奨**: `const greeting = \`Hello, ${name}!\`;`

- JSDocコメントがありません
  - **場所**: greetUser関数, calculateTotal関数
  - **推奨**:
    ```javascript
    /**
     * ユーザーに挨拶メッセージを表示
     * @param {string} name - ユーザー名
     * @returns {string} 挨拶メッセージ
     */
    function greetUser(name) { ... }
    ```

- `console.log` が残っています
  - **場所**: 5行目
  - **推奨**: 本番コードでは削除するか、適切なロギングライブラリを使用

#### ✅ Good Practices Found
- 関数名が明確で理解しやすい
- 適切な関数分割がされている

**総合評価**: 45/100

改善により、より保守性の高いコードになります。
```

## エージェントのカスタマイズ

### チェック項目を追加する

エージェント定義に新しいチェック項目を追加できます：

```markdown
## チェック項目

### セキュリティチェック（追加）
1. **eval の使用禁止**: `eval()` が使われていないか
2. **innerHTML**: XSSのリスクがないか
3. **機密情報のハードコード**: APIキーやパスワードが含まれていないか
```

エージェントファイルを更新したら：
```
エージェントパネル → 設定 → "Reload Agents"
```

### 出力形式をカスタマイズする

プロジェクトのドキュメント形式に合わせて出力をカスタマイズ：

```markdown
## 出力形式

以下のJSON形式で出力してください：

\`\`\`json
{
  "file": "ファイル名",
  "score": 0-100,
  "issues": [
    {
      "severity": "critical|warning|info",
      "line": 行番号,
      "message": "問題の説明",
      "suggestion": "修正案"
    }
  ]
}
\`\`\`
```

## エージェントのパラメータ化

実行時にパラメータを渡すこともできます：

```markdown
---
name: configurable-checker
description: 設定可能なコードチェッカー
version: 1.0.0
parameters:
  - name: strictness
    type: string
    default: "medium"
    options: ["low", "medium", "high"]
  - name: checkConsoleLog
    type: boolean
    default: true
---

# 設定可能なチェッカー

## パラメータの使用

- `strictness` が "high" の場合は、すべてのwarningをerrorとして扱う
- `checkConsoleLog` が true の場合のみ、console.logをチェック
```

エージェントパネルでパラメータを指定して実行：

```
エージェント選択 → Parameters →
  strictness: "high"
  checkConsoleLog: true
→ Run
```

## 複数ファイルの一括チェック

エージェントは、ワークスペース全体やディレクトリ単位でも実行できます：

```markdown
## 実行スコープ

このエージェントは以下のスコープで実行可能です：

- **単一ファイル**: 開いているファイルのみチェック
- **ディレクトリ**: 指定ディレクトリ内の全JSファイル
- **ワークスペース**: プロジェクト全体の全JSファイル

各ファイルごとに結果を出力し、最後に全体のサマリーを表示してください。
```

実行方法：
```
エージェントパネル → js-quality-checker → Run on:
  - Current File（現在のファイル）
  - Directory（ディレクトリ選択）
  - Workspace（全体）
```

## 動作確認チェックリスト

- [ ] `.github/agents/` ディレクトリを作成した
- [ ] `js-quality-checker.agent.md` ファイルを作成した
- [ ] Front Matter に必須項目を記述した
- [ ] エージェントの役割と指示を明確に記述した
- [ ] エージェントをリロードして一覧に表示された
- [ ] テストファイルでエージェントを実行できた
- [ ] 期待通りの分析結果が得られた
- [ ] パラメータを変更して動作が変わることを確認した

## トラブルシューティング

### エージェントが一覧に表示されない

**原因**: ファイル名が `.agent.md` で終わっていない、またはFront Matterの記述ミス

**確認**:
```bash
# ファイル名を確認
ls -la .github/agents/

# Front Matter の YAML 形式が正しいか確認
# - コロンの後にスペースが必要
# - インデントは半角スペース
```

### エージェントがエラーを返す

**原因**: プロンプトの指示が曖昧、または矛盾している

**対処**:
1. 指示を具体的に書き直す
2. 出力形式の例を明示する
3. チェック項目を減らして段階的にテスト

### 期待した結果が得られない

**原因**: プロンプトの書き方が不十分

**改善ポイント**:
```markdown
❌ 悪い例:
コードをチェックしてください

✅ 良い例:
以下の3点をチェックしてください：
1. var 宣言 → const/let に修正提案
2. 文字列結合 → テンプレートリテラルに修正提案
3. console.log → 削除を提案

各項目について、該当する行番号と具体的な修正コードを提示してください。
```

## 実践課題

理解を深めるために、以下のエージェントを自分で作成してみましょう：

### 課題1: TypeScript型チェッカー
```
- any 型の使用を検出
- 型アノテーションの欠落を指摘
- インターフェースの命名規則チェック
```

### 課題2: React コンポーネントチェッカー
```
- Hooksの使用ルールチェック
- propsの型定義確認
- useEffect の依存配列チェック
```

### 課題3: アクセシビリティチェッカー
```
- img タグの alt 属性チェック
- ボタンのaria-label確認
- セマンティックHTMLの推奨
```

## 次回予告

第3回では、プロンプトエンジニアリングをさらに深堀りします：

- 効果的なプロンプトの書き方
- Few-shot learning の活用
- Chain of Thought プロンプティング
- エージェントの精度を上げるテクニック

## まとめ

この記事では、カスタムエージェントの作成方法を学びました：

1. **エージェント定義ファイルの作成**
   - `.github/agents/` に配置
   - Markdown + Front Matter 形式
   - 明確な役割と指示の記述

2. **実践的なエージェントの実装**
   - JavaScript品質チェッカーの作成
   - チェック項目の定義
   - 出力形式の指定

3. **カスタマイズとパラメータ化**
   - チェック項目の追加
   - パラメータによる動作制御
   - スコープの指定（ファイル/ディレクトリ/ワークスペース）

次回は、プロンプトエンジニアリングのテクニックを学び、エージェントの精度と実用性をさらに高めていきます！

## 参考リンク

- [Markdown 記法リファレンス](https://www.markdownguide.org/)
- [YAML 入門](https://yaml.org/spec/1.2.2/)
- [プロンプトエンジニアリング ガイド](https://platform.openai.com/docs/guides/prompt-engineering)
