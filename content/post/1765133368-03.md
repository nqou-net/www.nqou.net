---
title: "ブランチを間違えた！git cherry-pick で必要なコミットだけを移動する"
draft: true
tags:
- "git"
- "git-cherry-pick"
- "branch-management"
- "version-control"
- "troubleshooting"
description: "違うブランチにコミットしてしまった、特定のコミットだけ別ブランチに適用したい、そんな場面で活躍するcherry-pickを詳解。コンフリクト解決から複数コミットの連続適用まで、実務で使える技を網羅します。"
---

## cherry-pick が解決する問題

「あれ、いまmainブランチにいたの!?」「このコミットだけfeatureブランチに移したい…」。Gitを使っていると、こんな場面に遭遇します。`git cherry-pick` は、特定のコミットだけを別のブランチに適用できる強力なコマンドです。

### よくあるユースケース

- **ブランチを間違えてコミット**：本来はfeatureブランチにコミットすべきだった
- **ホットフィックスの部分適用**：developの複数コミットから修正だけをmainに反映
- **実験的変更の選択的マージ**：試行錯誤の中から有用な変更だけを取り込む

## git cherry-pick の基本操作

cherry-pickは「桜の実を摘む」という意味で、コミットツリーから特定のコミットだけを選んで適用します。

### 単一コミットの適用

最もシンプルな使い方は、1つのコミットを現在のブランチに適用することです。

```bash
# 適用先のブランチに移動
git checkout main

# 特定のコミットを適用
git cherry-pick abc1234

# コミットハッシュはgit logで確認
git log --oneline --graph --all
```

このコマンドを実行すると、`abc1234` のコミットが示す変更が現在のブランチに新しいコミットとして追加されます。

### 複数コミットの連続適用

範囲を指定して、連続した複数のコミットを一度に適用できます。

```bash
# 範囲指定で複数適用（abc1234からdef5678まで）
git cherry-pick abc1234^..def5678

# または個別に指定
git cherry-pick abc1234 bcd2345 cde3456
```

`^` は「その1つ前から」を意味し、abc1234自体も含めて適用されます。

## コンフリクトが発生した場合の対処

cherry-pickでもマージと同様にコンフリクトが発生することがあります。

### コンフリクト解決の基本フロー

```bash
# cherry-pickでコンフリクト発生
git cherry-pick abc1234
# CONFLICT (content): Merge conflict in src/app.js

# コンフリクトを手動で解決
vim src/app.js

# 解決したファイルをステージング
git add src/app.js

# cherry-pickを続行
git cherry-pick --continue
```

### --continue, --abort, --skipの使い分け

```bash
# コンフリクト解決後、cherry-pickを続行
git cherry-pick --continue

# cherry-pickを中止して元の状態に戻す
git cherry-pick --abort

# 現在のコミットをスキップして次へ
git cherry-pick --skip
```

- `--continue`: 解決後に進める
- `--abort`: 全てキャンセル（安全策）
- `--skip`: 問題のあるコミットを飛ばす

## 高度な使い方

### マージコミットのcherry-pick

マージコミットには複数の親があるため、`-m`オプションで親を指定する必要があります。

```bash
# マージコミットの情報を確認
git show abc1234

# 1番目の親（通常はメインライン）を基準に適用
git cherry-pick -m 1 abc1234
```

### コミットメッセージを編集

デフォルトでは元のメッセージがそのまま使われますが、`-e`で編集できます。

```bash
# メッセージをエディタで編集
git cherry-pick -e abc1234

# または直接指定（ただし元のメッセージは失われる）
git cherry-pick abc1234 --no-commit
git commit -m "新しいメッセージ"
```

### コミット作者の保持

cherry-pickは自動的に元のコミット作者を保持しますが、明示的に確認もできます。

```bash
# 作者情報を含めて確認
git log --format="%h %an %s" HEAD~1..HEAD

# 元のコミット
# abc1234 Original Author feat: 新機能

# cherry-pickしたコミット  
# def5678 Original Author feat: 新機能
```

## 実践シナリオ

### ケース1: 間違えたブランチへのコミット修正

```bash
# 現状確認
git log --oneline
# abc1234 間違えてmainにコミットした内容

# 正しいブランチ（feature）に移動
git checkout feature

# コミットを持ってくる
git cherry-pick abc1234

# mainブランチに戻って不要なコミットを削除
git checkout main
git reset --hard HEAD~1
```

### ケース2: リリースブランチへの部分的な適用

```bash
# developブランチの特定の修正だけをリリースに適用
git checkout release/v1.2.0

# 必要な修正だけをcherry-pick
git cherry-pick e4f5g6h  # セキュリティ修正
git cherry-pick i7j8k9l  # クリティカルバグ修正
```

## cherry-pick vs rebase の使い分け

| 操作 | cherry-pick | rebase |
|------|-------------|--------|
| 目的 | 特定コミットの選択的適用 | ブランチ全体の移動・統合 |
| 適用範囲 | 個別のコミット | 連続したコミット全体 |
| 履歴 | 新しいコミットを作成 | 既存コミットを再配置 |
| 使用場面 | 部分的な変更の取り込み | ブランチのベース変更 |

基本的に、「全体を移動」ならrebase、「一部だけ取り込み」ならcherry-pickを選びます。

## トラブルシューティング

### 同じコミットを複数回適用してしまった

```bash
# 最後のcherry-pickを取り消す
git reset --hard HEAD~1

# またはrevert
git revert HEAD
```

### cherry-pickしたコミットを元ブランチから削除したい

```bash
# 元のブランチに移動
git checkout original-branch

# 不要なコミットを削除
git rebase -i HEAD~3  # 対象を含む範囲を指定
# エディタで該当行を削除
```

## まとめ

`git cherry-pick`は、特定のコミットだけを柔軟に扱える便利なツールです。

- **単一コミット適用**: `git cherry-pick <hash>`
- **範囲指定適用**: `git cherry-pick <start>^..<end>`
- **コンフリクト時**: `--continue`, `--abort`, `--skip`で対応
- **マージコミット**: `-m 1`で親を指定

ブランチ間違いのリカバリーやホットフィックスの部分適用など、実務で頻繁に使う場面があります。まずは個人のfeatureブランチで練習して、操作に慣れていきましょう。
