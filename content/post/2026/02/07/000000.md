---
date: 2026-02-07T00:00:00+09:00
description: ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ãªãŒã‚‰ã€Abstract Factoryãƒ»Flyweightãƒ»Prototypeã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè·µã€‚Mooã§æ›¸ãPerlãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥é–€ã€‚
draft: true
image: /favicon.png
tags:
  - perl
  - moo
  - perl-design-patterns
  - abstract-factory
  - flyweight-pattern
  - prototype-pattern
  - object-oriented
  - whisky
  - hands-on
  - tutorial
title: Perlã§ä½œã‚‹ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ç”Ÿæˆå™¨ï¼ˆAbstract Factory Ã— Flyweight Ã— Prototypeï¼‰
toc: true
---

ã€Œãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å‹‰å¼·ã—ãŸã‘ã©ã€ã„ã¤ä½¿ãˆã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„ã€â€”â€”ãã‚“ãªæ‚©ã¿ã‚’æŠ±ãˆã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚ŠãªãŒã‚‰ã€**Abstract Factoryãƒ»Flyweightãƒ»Prototype**ã®3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè·µã—ã¾ã™ã€‚ç”£åœ°ã”ã¨ã«ç•°ãªã‚‹ã‚«ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€å¤§é‡ã®é¦™å‘³èªå½™ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ´¾ç”Ÿâ€”â€”ãã‚Œãã‚Œã®å•é¡Œã«å¯¾ã—ã¦ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã©ã†è§£æ±ºç­–ã‚’æä¾›ã™ã‚‹ã‹ã‚’ä½“é¨“ã—ã¾ã—ã‚‡ã†ã€‚

> å®Œæˆã—ãŸã‚‰ã€æ¬¡ã®ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ä¼šã§ã€Œä¿ºãŒä½œã£ãŸã‚«ãƒ¼ãƒ‰ç”Ÿæˆå™¨ã§å‡ºåŠ›ã—ãŸã‚„ã¤ã€ã¨è‡ªæ…¢ã§ãã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | è§£æ±ºã™ã‚‹å•é¡Œ | æœ¬è¨˜äº‹ã§ã®å½¹å‰² |
|---------|-------------|--------------|
| **Abstract Factory** | é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çµ„ã¿åˆã‚ã›ãƒŸã‚¹ | ç”£åœ°åˆ¥ã‚­ãƒƒãƒˆã®ä¸€æ‹¬ç”Ÿæˆ |
| **Flyweight** | åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤§é‡ç”Ÿæˆ | é¦™å‘³èªå½™ã®å…±æœ‰ãƒ—ãƒ¼ãƒ« |
| **Prototype** | é¡ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ‰‹å‹•ä½œæˆ | ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒ­ãƒ¼ãƒ³ |

## å¯¾è±¡èª­è€…

- ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åå‰ã¯çŸ¥ã£ã¦ã„ã‚‹ãŒã€ä½¿ã„ã©ã“ã‚ãŒã‚ã‹ã‚‰ãªã„æ–¹
- Perlå…¥å­¦å¼ã‚’å’æ¥­ã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ãŸã„æ–¹
- ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ãŒå¥½ãã§ã€è¶£å‘³ã¨å­¦ç¿’ã‚’ä¸¡ç«‹ã•ã›ãŸã„æ–¹

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Perl** v5.36ä»¥é™ï¼ˆsignaturesä½¿ç”¨ï¼‰
- **Moo** ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘
- CLIï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰ç’°å¢ƒ

---

## ç¬¬1ç« : ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚’ä½œã£ã¦ã¿ã‚ˆã†

### ä»Šå›ã®ç›®æ¨™

- ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚’1æšå‡ºåŠ›ã™ã‚‹
- æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ

### æœ€åˆã®å®Ÿè£…

ã¾ãšã¯ã€1ã¤ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼æƒ…å ±ã‚’ã‚«ãƒ¼ãƒ‰ã¨ã—ã¦å‡ºåŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```perl
#!/usr/bin/env perl
use v5.36;

# ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰
say "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—";
say "â•‘     WHISKY TASTING CARD                â•‘";
say "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£";
say "â•‘ Name: Ardbeg 10 Years                  â•‘";
say "â•‘ Region: Islay, Scotland                â•‘";
say "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£";
say "â•‘ NOSE:                                  â•‘";
say "â•‘   smoky, peaty, citrus, vanilla        â•‘";
say "â•‘ PALATE:                                â•‘";
say "â•‘   intense smoke, sea salt, pepper      â•‘";
say "â•‘ FINISH:                                â•‘";
say "â•‘   long, peaty, warming                 â•‘";
say "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£";
say "â•‘ PAIRING:                               â•‘";
say "â•‘   Blue cheese, smoked salmon           â•‘";
say "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•";
```

### å®Ÿè¡Œçµæœ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     WHISKY TASTING CARD                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Name: Ardbeg 10 Years                  â•‘
â•‘ Region: Islay, Scotland                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ NOSE:                                  â•‘
â•‘   smoky, peaty, citrus, vanilla        â•‘
â•‘ PALATE:                                â•‘
â•‘   intense smoke, sea salt, pepper      â•‘
â•‘ FINISH:                                â•‘
â•‘   long, peaty, warming                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ PAIRING:                               â•‘
â•‘   Blue cheese, smoked salmon           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âœ… ã¨ã‚Šã‚ãˆãšå‹•ãã‚‚ã®ãŒã§ããŸ
- âš ï¸ ã™ã¹ã¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰â€”â€”æ‹¡å¼µæ€§ã‚¼ãƒ­
- âš ï¸ ç”£åœ°ãŒå¢—ãˆãŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ

---

## ç¬¬2ç« : ç”£åœ°ãŒå¢—ãˆã‚‹ã¨åˆ†å²åœ°ç„

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã§ã‚«ãƒ¼ãƒ‰ã‚’1æšå‡ºåŠ›ã§ãã¾ã—ãŸã€‚ã§ã‚‚ã€ã‚¹ã‚³ãƒƒãƒã ã‘ã§ãªãã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ã€ã‚¸ãƒ£ãƒ‘ãƒ‹ãƒ¼ã‚ºã«ã‚‚å¯¾å¿œã—ãŸã‚‰ï¼Ÿ

### ä»Šå›ã®ç›®æ¨™

- è¤‡æ•°ç”£åœ°ã«å¯¾å¿œã™ã‚‹
- if/elseã§åˆ†å²ã‚’å®Ÿè£…
- å•é¡Œã‚’ä½“é¨“ã™ã‚‹

### å‹•ãï¼šMooã§ã‚¯ãƒ©ã‚¹åŒ–

```perl
#!/usr/bin/env perl
use v5.36;

package TastingCard {
    use Moo;

    has name   => (is => 'ro', required => 1);
    has region => (is => 'ro', required => 1);
    has nose   => (is => 'ro', required => 1);
    has palate => (is => 'ro', required => 1);
    has finish => (is => 'ro', required => 1);

    sub render($self) {
        my $output = "";
        $output .= "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
        $output .= "â•‘     WHISKY TASTING CARD                â•‘\n";
        $output .= "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n";
        $output .= sprintf("â•‘ Name: %-33sâ•‘\n", $self->name);
        $output .= sprintf("â•‘ Region: %-31sâ•‘\n", $self->region);
        $output .= "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n";
        $output .= "â•‘ NOSE:                                  â•‘\n";
        $output .= sprintf("â•‘   %-37sâ•‘\n", $self->nose);
        $output .= "â•‘ PALATE:                                â•‘\n";
        $output .= sprintf("â•‘   %-37sâ•‘\n", $self->palate);
        $output .= "â•‘ FINISH:                                â•‘\n";
        $output .= sprintf("â•‘   %-37sâ•‘\n", $self->finish);
        $output .= "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
        return $output;
    }
}

package main {
    # ç”£åœ°ã”ã¨ã«ç•°ãªã‚‹ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
    sub create_card($region_type) {
        if ($region_type eq 'scotch') {
            return TastingCard->new(
                name   => 'Ardbeg 10',
                region => 'Islay, Scotland',
                nose   => 'smoky, peaty, citrus',
                palate => 'intense smoke, sea salt',
                finish => 'long, peaty',
            );
        }
        elsif ($region_type eq 'irish') {
            return TastingCard->new(
                name   => 'Redbreast 12',
                region => 'Ireland',
                nose   => 'fruity, sherry, spice',
                palate => 'smooth, honey, nuts',
                finish => 'warm, lingering',
            );
        }
        elsif ($region_type eq 'japanese') {
            return TastingCard->new(
                name   => 'Yamazaki 12',
                region => 'Japan',
                nose   => 'floral, peach, vanilla',
                palate => 'delicate, mizunara oak',
                finish => 'elegant, long',
            );
        }
        else {
            die "Unknown region: $region_type";
        }
    }

    my $card = create_card('scotch');
    print $card->render;
}
```

### ç ´ç¶»ï¼šif/elseãŒå¢—æ®–ã™ã‚‹

ç”£åœ°ãŒ3ã¤ã«ãªã£ãŸã ã‘ã§ã€ã™ã§ã«if/elseãŒ3æ®µéšã€‚ã•ã‚‰ã«...

- ãƒšã‚¢ãƒªãƒ³ã‚°æƒ…å ±ã‚‚ç”£åœ°ã”ã¨ã«å¤‰ãˆãŸã„ â†’ åˆ¥ã®if/elseè¿½åŠ 
- ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ç”£åœ°ã”ã¨ã« â†’ ã¾ãŸåˆ¥ã®if/elseè¿½åŠ 
- ã‚«ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚‚ç”£åœ°ã”ã¨ã« â†’ ã•ã‚‰ã«if/elseè¿½åŠ 

```perl
# ç ´ç¶»ã™ã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
sub create_card($region) {
    my ($card, $profile, $pairing);
    
    if ($region eq 'scotch') {
        $card = ScotchCard->new(...);
        $profile = ScotchProfile->new(...);
        $pairing = ScotchPairing->new(...);
    }
    elsif ($region eq 'irish') {
        $card = IrishCard->new(...);
        $profile = IrishProfile->new(...);
        $pairing = IrishPairing->new(...);  # é–“é•ãˆã¦ScotchPairingä½¿ã£ãŸã‚‰ãƒã‚°ï¼
    }
    # ... ç”£åœ°ãŒå¢—ãˆã‚‹ãŸã³ã«åˆ†å²ãŒå¢—ãˆã‚‹
}
```

å•é¡Œç‚¹ã‚’æ•´ç†ã™ã‚‹ã¨ï¼š

- **çµ„ã¿åˆã‚ã›ãƒŸã‚¹ã®ãƒªã‚¹ã‚¯**: ScotchCardã«IrishPairingã‚’ç´ä»˜ã‘ã‚‹ãƒŸã‚¹
- **if/elseã®è‚¥å¤§åŒ–**: ç”£åœ°Ã—è£½å“ç¨®é¡ã®çµ„ã¿åˆã‚ã›çˆ†ç™º
- **å¤‰æ›´ãŒå›°é›£**: æ–°ç”£åœ°è¿½åŠ æ™‚ã«è¤‡æ•°ç®‡æ‰€ã‚’ä¿®æ­£

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âš ï¸ é–¢é€£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¾¤ã‚’if/elseã§ç”Ÿæˆã™ã‚‹ã¨çµ„ã¿åˆã‚ã›ãƒŸã‚¹ãŒèµ·ãã‚‹
- âš ï¸ ç”£åœ°ã¨ã„ã†ã€Œãƒ•ã‚¡ãƒŸãƒªã€ã”ã¨ã«ä¸€è²«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¾¤ãŒå¿…è¦
- â†’ **ç”£åœ°åˆ¥ã®ã€Œã‚­ãƒƒãƒˆã€ã‚’ä¸€æ‹¬ç”Ÿæˆ**ã™ã‚Œã°ã‚ˆã„ã®ã§ã¯ï¼Ÿ

---

## ç¬¬3ç« : ç”£åœ°åˆ¥ã‚­ãƒƒãƒˆã‚’å·¥å ´ã§ç”Ÿç”£

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

if/elseã§ç”£åœ°ã”ã¨ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã—ãŸãŒã€çµ„ã¿åˆã‚ã›ãƒŸã‚¹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã—ãŸã€‚

### ä»Šå›ã®ç›®æ¨™

- ç”£åœ°åˆ¥ã«é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€æ‹¬ç”Ÿæˆ
- **Abstract Factory**ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥

### å®Œæˆï¼šAbstract Factoryãƒ‘ã‚¿ãƒ¼ãƒ³

```perl
#!/usr/bin/env perl
use v5.36;

# === è£½å“ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆRoleï¼‰ ===
package FlavorProfile::Role {
    use Moo::Role;
    requires 'get_nose';
    requires 'get_palate';
    requires 'get_finish';
}

package TastingCard::Role {
    use Moo::Role;
    requires 'render';
}

package Pairing::Role {
    use Moo::Role;
    requires 'suggest';
}

# === ã‚¹ã‚³ãƒƒãƒè£½å“ ===
package ScotchProfile {
    use Moo;
    with 'FlavorProfile::Role';
    
    sub get_nose($self)   { return 'smoky, peaty, maritime' }
    sub get_palate($self) { return 'intense smoke, brine, pepper' }
    sub get_finish($self) { return 'long, warming, peaty' }
}

package ScotchCard {
    use Moo;
    with 'TastingCard::Role';
    
    has profile => (is => 'ro', required => 1);
    has name    => (is => 'ro', required => 1);
    
    sub render($self) {
        my $p = $self->profile;
        return join("\n",
            "â”â”â”â” SCOTCH TASTING CARD â”â”â”â”“",
            "â”ƒ " . $self->name,
            "â”ƒ Nose: " . $p->get_nose,
            "â”ƒ Palate: " . $p->get_palate,
            "â”ƒ Finish: " . $p->get_finish,
            "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›",
        );
    }
}

package ScotchPairing {
    use Moo;
    with 'Pairing::Role';
    
    sub suggest($self) {
        return ['Blue cheese', 'Smoked salmon', 'Dark chocolate'];
    }
}

# === ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥è£½å“ ===
package IrishProfile {
    use Moo;
    with 'FlavorProfile::Role';
    
    sub get_nose($self)   { return 'fruity, honey, vanilla' }
    sub get_palate($self) { return 'smooth, creamy, spice' }
    sub get_finish($self) { return 'warm, gentle, sweet' }
}

package IrishCard {
    use Moo;
    with 'TastingCard::Role';
    
    has profile => (is => 'ro', required => 1);
    has name    => (is => 'ro', required => 1);
    
    sub render($self) {
        my $p = $self->profile;
        return join("\n",
            "â•­â”€â”€â”€â”€ IRISH TASTING CARD â”€â”€â”€â”€â•®",
            "â”‚ " . $self->name,
            "â”‚ Nose: " . $p->get_nose,
            "â”‚ Palate: " . $p->get_palate,
            "â”‚ Finish: " . $p->get_finish,
            "â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯",
        );
    }
}

package IrishPairing {
    use Moo;
    with 'Pairing::Role';
    
    sub suggest($self) {
        return ['Irish stew', 'Soda bread', 'Apple pie'];
    }
}

# === Abstract Factory ===
package TastingKitFactory::Role {
    use Moo::Role;
    requires 'create_profile';
    requires 'create_card';
    requires 'create_pairing';
}

package ScotchFactory {
    use Moo;
    with 'TastingKitFactory::Role';
    
    sub create_profile($self) { return ScotchProfile->new }
    
    sub create_card($self, $name) {
        return ScotchCard->new(
            name    => $name,
            profile => $self->create_profile,
        );
    }
    
    sub create_pairing($self) { return ScotchPairing->new }
}

package IrishFactory {
    use Moo;
    with 'TastingKitFactory::Role';
    
    sub create_profile($self) { return IrishProfile->new }
    
    sub create_card($self, $name) {
        return IrishCard->new(
            name    => $name,
            profile => $self->create_profile,
        );
    }
    
    sub create_pairing($self) { return IrishPairing->new }
}

# === ãƒ¡ã‚¤ãƒ³å‡¦ç† ===
package main {
    sub create_tasting_kit($factory, $whisky_name) {
        my $card    = $factory->create_card($whisky_name);
        my $pairing = $factory->create_pairing;
        return ($card, $pairing);
    }
    
    # ã‚¹ã‚³ãƒƒãƒã®ã‚­ãƒƒãƒˆã‚’ä½œæˆ
    my $scotch_factory = ScotchFactory->new;
    my ($card, $pairing) = create_tasting_kit($scotch_factory, 'Laphroaig 10');
    
    say $card->render;
    say "Pairing: " . join(", ", $pairing->suggest->@*);
    say "";
    
    # ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ã®ã‚­ãƒƒãƒˆã‚’ä½œæˆ
    my $irish_factory = IrishFactory->new;
    ($card, $pairing) = create_tasting_kit($irish_factory, 'Redbreast 12');
    
    say $card->render;
    say "Pairing: " . join(", ", $pairing->suggest->@*);
}
```

### å®Ÿè¡Œçµæœ

```
â”â”â”â” SCOTCH TASTING CARD â”â”â”â”“
â”ƒ Laphroaig 10
â”ƒ Nose: smoky, peaty, maritime
â”ƒ Palate: intense smoke, brine, pepper
â”ƒ Finish: long, warming, peaty
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
Pairing: Blue cheese, Smoked salmon, Dark chocolate

â•­â”€â”€â”€â”€ IRISH TASTING CARD â”€â”€â”€â”€â•®
â”‚ Redbreast 12
â”‚ Nose: fruity, honey, vanilla
â”‚ Palate: smooth, creamy, spice
â”‚ Finish: warm, gentle, sweet
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
Pairing: Irish stew, Soda bread, Apple pie
```

### Abstract Factoryã®åŠ¹æœ

```mermaid
classDiagram
    class `TastingKitFactory::Role` {
        <<interface>>
        +create_profile()
        +create_card(name)
        +create_pairing()
    }
    
    class ScotchFactory {
        +create_profile() ScotchProfile
        +create_card(name) ScotchCard
        +create_pairing() ScotchPairing
    }
    
    class IrishFactory {
        +create_profile() IrishProfile
        +create_card(name) IrishCard
        +create_pairing() IrishPairing
    }
    
    `TastingKitFactory::Role` <|.. ScotchFactory
    `TastingKitFactory::Role` <|.. IrishFactory
    
    note for ScotchFactory "ã‚¹ã‚³ãƒƒãƒè£½å“ç¾¤ã‚’ä¸€æ‹¬ç”Ÿæˆ\nçµ„ã¿åˆã‚ã›ãƒŸã‚¹ãŒèµ·ããªã„"
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âœ… **Abstract Factory**ãƒ‘ã‚¿ãƒ¼ãƒ³ = é–¢é€£è£½å“ç¾¤ã®ä¸€æ‹¬ç”Ÿæˆ
- âœ… ScotchFactoryã¯å¿…ãšã‚¹ã‚³ãƒƒãƒè£½å“ã‚’è¿”ã™â€”â€”çµ„ã¿åˆã‚ã›ãƒŸã‚¹ãŒæ§‹é€ çš„ã«é˜²æ­¢
- âœ… æ–°ç”£åœ°è¿½åŠ ã¯æ–°Factoryã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã ã‘ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ç„¡ä¿®æ­£ï¼‰
- âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã¯Factoryã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã ã‘ä¾å­˜

---

## ç¬¬4ç« : åŒã˜é¦™å‘³ãŒä½•åº¦ã‚‚ä½œã‚‰ã‚Œã‚‹

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Abstract Factoryã§ç”£åœ°åˆ¥ã‚­ãƒƒãƒˆã‚’ä¸€æ‹¬ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã§ã‚‚ã€å¤§é‡ã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã¨...

### ä»Šå›ã®ç›®æ¨™

- å¤§é‡ã‚«ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã®ãƒ¡ãƒ¢ãƒªå•é¡Œã‚’èªè­˜
- é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é‡è¤‡ã‚’ç™ºè¦‹

### ç ´ç¶»ï¼šé¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒçˆ†ç™º

ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆã§100æšã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹å ´åˆã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```perl
#!/usr/bin/env perl
use v5.36;

package FlavorDescriptor {
    use Moo;
    
    has name        => (is => 'ro', required => 1);
    has category    => (is => 'ro', required => 1);  # nose/palate/finish
    has intensity   => (is => 'ro', default => 5);   # 1-10
    has description => (is => 'ro', default => '');
    
    our $INSTANCE_COUNT = 0;
    
    sub BUILD($self, $args) {
        $INSTANCE_COUNT++;
    }
}

package TastingCard {
    use Moo;
    
    has name    => (is => 'ro', required => 1);
    has flavors => (is => 'ro', default => sub { [] });
    
    sub add_flavor($self, $name, $category) {
        # æ¯å›æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆå•é¡Œï¼ï¼‰
        my $flavor = FlavorDescriptor->new(
            name     => $name,
            category => $category,
        );
        push $self->flavors->@*, $flavor;
    }
}

package main {
    # 100æšã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
    my @cards;
    for my $i (1..100) {
        my $card = TastingCard->new(name => "Whisky #$i");
        
        # å…¨ã‚«ãƒ¼ãƒ‰ã«åŒã˜é¦™å‘³ã‚’è¿½åŠ 
        $card->add_flavor('smoky', 'nose');
        $card->add_flavor('peaty', 'nose');
        $card->add_flavor('vanilla', 'palate');
        $card->add_flavor('honey', 'palate');
        $card->add_flavor('long', 'finish');
        
        push @cards, $card;
    }
    
    say "ã‚«ãƒ¼ãƒ‰æ•°: " . scalar(@cards);
    say "FlavorDescriptorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: $FlavorDescriptor::INSTANCE_COUNT";
    say "";
    say "å•é¡Œ: 100æšã®ã‚«ãƒ¼ãƒ‰ã§500å€‹ã®é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼";
    say "      ã§ã‚‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‹é¦™å‘³ã¯5ç¨®é¡ã ã‘...";
}
```

### å®Ÿè¡Œçµæœ

```
ã‚«ãƒ¼ãƒ‰æ•°: 100
FlavorDescriptorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: 500

å•é¡Œ: 100æšã®ã‚«ãƒ¼ãƒ‰ã§500å€‹ã®é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼
      ã§ã‚‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‹é¦™å‘³ã¯5ç¨®é¡ã ã‘...
```

### å•é¡Œåˆ†æ

| é …ç›® | å€¤ |
|------|-----|
| ã‚«ãƒ¼ãƒ‰æ•° | 100æš |
| ã‚«ãƒ¼ãƒ‰ã‚ãŸã‚Šã®é¦™å‘³æ•° | 5å€‹ |
| ç”Ÿæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | 500å€‹ |
| **å®Ÿéš›ã«å¿…è¦ãªç¨®é¡** | **5ç¨®é¡** |
| ç„¡é§„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | 495å€‹ï¼ˆ99%ãŒç„¡é§„ï¼ï¼‰ |

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âš ï¸ åŒã˜ã€Œsmokyã€ãªã®ã«100å€‹ã®åˆ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- âš ï¸ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒã‚«ãƒ¼ãƒ‰æ•°ã«æ¯”ä¾‹ã—ã¦å¢—å¤§
- â†’ **åŒã˜é¦™å‘³ã¯1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…±æœ‰**ã™ã‚Œã°ã‚ˆã„ã®ã§ã¯ï¼Ÿ

---

## ç¬¬5ç« : é¦™å‘³èªå½™ã‚’å…±æœ‰ã—ã‚ˆã†

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

åŒã˜ã€Œsmokyã€ãªã®ã«æ¯å›æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã‚’è§£æ±ºã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…±æœ‰ã™ã‚‹
- **Flyweight**ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥

### å®Œæˆï¼šFlyweightãƒ‘ã‚¿ãƒ¼ãƒ³

```perl
#!/usr/bin/env perl
use v5.36;

# Flyweight: å…±æœ‰ã•ã‚Œã‚‹é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
package FlavorDescriptor {
    use Moo;
    
    # å†…éƒ¨çŠ¶æ…‹ï¼ˆintrinsic stateï¼‰: å…±æœ‰ã•ã‚Œã‚‹
    has name     => (is => 'ro', required => 1);
    has category => (is => 'ro', required => 1);
    
    our $INSTANCE_COUNT = 0;
    
    sub BUILD($self, $args) {
        $INSTANCE_COUNT++;
    }
    
    sub describe($self, $intensity) {
        # å¤–éƒ¨çŠ¶æ…‹ï¼ˆextrinsic stateï¼‰: å‘¼ã³å‡ºã—æ™‚ã«æ¸¡ã•ã‚Œã‚‹
        my $level = $intensity >= 7 ? 'strong' : $intensity >= 4 ? 'medium' : 'subtle';
        return sprintf("%s %s", $level, $self->name);
    }
}

# Flyweight Factory: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«
package FlavorPool {
    use Moo;
    
    has _pool => (
        is      => 'ro',
        default => sub { {} },
    );
    
    sub get_flavor($self, $name, $category) {
        my $key = "$category:$name";
        
        # ãƒ—ãƒ¼ãƒ«ã«æ—¢ã«ã‚ã‚Œã°å†åˆ©ç”¨
        if (exists $self->_pool->{$key}) {
            return $self->_pool->{$key};
        }
        
        # æ–°è¦ä½œæˆã—ã¦ãƒ—ãƒ¼ãƒ«ã«ä¿å­˜
        my $flavor = FlavorDescriptor->new(
            name     => $name,
            category => $category,
        );
        $self->_pool->{$key} = $flavor;
        
        return $flavor;
    }
    
    sub pool_size($self) {
        return scalar keys $self->_pool->%*;
    }
    
    sub list_flavors($self) {
        return [sort keys $self->_pool->%*];
    }
}

# ã‚«ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ï¼ˆFlyweightã‚’åˆ©ç”¨ï¼‰
package TastingCard {
    use Moo;
    
    has name         => (is => 'ro', required => 1);
    has flavor_pool  => (is => 'ro', required => 1);
    has flavor_refs  => (is => 'ro', default => sub { [] });
    
    sub add_flavor($self, $name, $category, $intensity = 5) {
        my $flavor = $self->flavor_pool->get_flavor($name, $category);
        push $self->flavor_refs->@*, { flavor => $flavor, intensity => $intensity };
    }
    
    sub render_flavors($self) {
        my @lines;
        for my $ref ($self->flavor_refs->@*) {
            push @lines, $ref->{flavor}->describe($ref->{intensity});
        }
        return join(", ", @lines);
    }
}

package main {
    my $pool = FlavorPool->new;
    
    # 100æšã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
    my @cards;
    for my $i (1..100) {
        my $card = TastingCard->new(
            name        => "Whisky #$i",
            flavor_pool => $pool,
        );
        
        # å…¨ã‚«ãƒ¼ãƒ‰ã«åŒã˜é¦™å‘³ã‚’è¿½åŠ ï¼ˆãƒ—ãƒ¼ãƒ«ã‹ã‚‰å–å¾—ï¼‰
        $card->add_flavor('smoky', 'nose', 8);
        $card->add_flavor('peaty', 'nose', 7);
        $card->add_flavor('vanilla', 'palate', 5);
        $card->add_flavor('honey', 'palate', 6);
        $card->add_flavor('long', 'finish', 9);
        
        push @cards, $card;
    }
    
    say "=== Flyweightãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŠ¹æœ ===";
    say "ã‚«ãƒ¼ãƒ‰æ•°: " . scalar(@cards);
    say "FlavorDescriptorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: $FlavorDescriptor::INSTANCE_COUNT";
    say "ãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º: " . $pool->pool_size . "ç¨®é¡";
    say "";
    say "ãƒ—ãƒ¼ãƒ«å†…å®¹: " . join(", ", $pool->list_flavors->@*);
    say "";
    say "--- ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ ---";
    say "ã‚«ãƒ¼ãƒ‰å: " . $cards[0]->name;
    say "é¦™å‘³: " . $cards[0]->render_flavors;
}
```

### å®Ÿè¡Œçµæœ

```
=== Flyweightãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŠ¹æœ ===
ã‚«ãƒ¼ãƒ‰æ•°: 100
FlavorDescriptorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: 5
ãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º: 5ç¨®é¡

ãƒ—ãƒ¼ãƒ«å†…å®¹: finish:long, nose:peaty, nose:smoky, palate:honey, palate:vanilla

--- ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ ---
ã‚«ãƒ¼ãƒ‰å: Whisky #1
é¦™å‘³: strong smoky, strong peaty, medium vanilla, medium honey, strong long
```

### Flyweightã®åŠ¹æœ

| é …ç›® | Before | After |
|------|--------|-------|
| FlavorDescriptorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•° | 500å€‹ | **5å€‹** |
| ãƒ¡ãƒ¢ãƒªå‰Šæ¸›ç‡ | - | **99%å‰Šæ¸›** |

```mermaid
classDiagram
    class FlavorPool {
        -_pool: Hash
        +get_flavor(name, category): FlavorDescriptor
        +pool_size(): Int
    }
    
    class FlavorDescriptor {
        +name: Str
        +category: Str
        +describe(intensity): Str
    }
    
    class TastingCard {
        +name: Str
        +flavor_pool: FlavorPool
        +flavor_refs: Array
        +add_flavor(name, category, intensity)
    }
    
    FlavorPool "1" --> "*" FlavorDescriptor : caches
    TastingCard "*" --> "1" FlavorPool : uses
    TastingCard "*" ..> "*" FlavorDescriptor : references
    
    note for FlavorPool "åŒã˜é¦™å‘³ã¯åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™"
    note for TastingCard "intensityï¼ˆå¼·åº¦ï¼‰ã¯å¤–éƒ¨çŠ¶æ…‹ã¨ã—ã¦ä¿æŒ"
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âœ… **Flyweight**ãƒ‘ã‚¿ãƒ¼ãƒ³ = ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…±æœ‰
- âœ… å†…éƒ¨çŠ¶æ…‹ï¼ˆname, categoryï¼‰ã¯å…±æœ‰ã€å¤–éƒ¨çŠ¶æ…‹ï¼ˆintensityï¼‰ã¯ã‚«ãƒ¼ãƒ‰ã”ã¨
- âœ… 100æšã®ã‚«ãƒ¼ãƒ‰ã§ã‚‚5ç¨®é¡åˆ†ã®ãƒ¡ãƒ¢ãƒªã§æ¸ˆã‚€
- âœ… FlavorPoolãŒFlyweight Factoryã¨ã—ã¦æ©Ÿèƒ½

---

## ç¬¬6ç« : Islayãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ´¾ç”Ÿã‚’ä½œã‚ŠãŸã„

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Flyweightã§é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã§ã‚‚ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´°ã‹ãã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã„å ´åˆã¯...

### ä»Šå›ã®ç›®æ¨™

- ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ´¾ç”Ÿã‚’ä½œã‚‹å•é¡Œã‚’èªè­˜
- new()ã®é™ç•Œã‚’ä½“é¨“

### ç ´ç¶»ï¼šæ´¾ç”Ÿãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹ä½œæ¥­ã§ä½œæˆ

Islayã®åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ã€Ardbegé¢¨ã‚„Laphroaigé¢¨ã‚’ä½œã‚ŠãŸã„å ´åˆï¼š

```perl
#!/usr/bin/env perl
use v5.36;

package WhiskyProfile {
    use Moo;
    
    has region       => (is => 'ro', required => 1);
    has sub_region   => (is => 'ro', default => '');
    has nose_notes   => (is => 'ro', default => sub { [] });
    has palate_notes => (is => 'ro', default => sub { [] });
    has finish_notes => (is => 'ro', default => sub { [] });
    has peat_level   => (is => 'rw', default => 5);
    has smoke_level  => (is => 'rw', default => 5);
    has sweetness    => (is => 'rw', default => 5);
    
    sub describe($self) {
        return sprintf(
            "Region: %s (%s)\nPeat: %d, Smoke: %d, Sweet: %d",
            $self->region,
            $self->sub_region || 'general',
            $self->peat_level,
            $self->smoke_level,
            $self->sweetness,
        );
    }
}

package main {
    # Islayã®åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
    my $islay_base = WhiskyProfile->new(
        region       => 'Scotland',
        sub_region   => 'Islay',
        nose_notes   => ['smoky', 'peaty', 'maritime'],
        palate_notes => ['intense smoke', 'brine', 'pepper'],
        finish_notes => ['long', 'warming'],
        peat_level   => 8,
        smoke_level  => 9,
        sweetness    => 3,
    );
    
    say "=== Islay Base Profile ===";
    say $islay_base->describe;
    say "";
    
    # Ardbegé¢¨ï¼ˆã‚ˆã‚Šã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ï¼‰ã‚’ä½œã‚ŠãŸã„
    # å•é¡Œ: å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼
    my $ardbeg_style = WhiskyProfile->new(
        region       => 'Scotland',           # åŒã˜
        sub_region   => 'Islay',              # åŒã˜
        nose_notes   => ['smoky', 'peaty', 'maritime'],  # åŒã˜
        palate_notes => ['intense smoke', 'brine', 'pepper'],  # åŒã˜
        finish_notes => ['long', 'warming'],  # åŒã˜
        peat_level   => 9,                    # é•ã†ã®ã¯ã“ã“ã ã‘ï¼
        smoke_level  => 10,                   # é•ã†ã®ã¯ã“ã“ã ã‘ï¼
        sweetness    => 2,                    # é•ã†ã®ã¯ã“ã“ã ã‘ï¼
    );
    
    say "=== Ardbeg Style (ä½œã‚‹ã®ãŒå¤§å¤‰...) ===";
    say $ardbeg_style->describe;
}
```

### å•é¡Œåˆ†æ

```perl
# Laphroaigé¢¨ã‚‚ä½œã‚ŠãŸã„... ã¾ãŸå…¨éƒ¨æ›¸ãã®ï¼Ÿ
my $laphroaig_style = WhiskyProfile->new(
    region       => 'Scotland',           # ã‚³ãƒ”ãƒš
    sub_region   => 'Islay',              # ã‚³ãƒ”ãƒš
    nose_notes   => ['smoky', 'peaty', 'maritime', 'medicinal'],  # 1ã¤è¿½åŠ 
    palate_notes => ['intense smoke', 'brine', 'pepper'],  # ã‚³ãƒ”ãƒš
    # ... ç¶šã
);

# Lagavuliné¢¨ã‚‚... Bowmoreé¢¨ã‚‚... Bruichladdiché¢¨ã‚‚...
# å…¨éƒ¨ã‚³ãƒ”ãƒšåœ°ç„ï¼ï¼
```

å•é¡Œç‚¹ï¼š

- **DRYåŸå‰‡é•å**: åŒã˜å€¤ã‚’ä½•åº¦ã‚‚æ›¸ã„ã¦ã„ã‚‹
- **å¤‰æ›´ã«å¼±ã„**: Islayå…¨ä½“ã®ãƒ™ãƒ¼ã‚¹ã‚’å¤‰ãˆãŸã‚‰å…¨æ´¾ç”Ÿã‚’ä¿®æ­£
- **ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ãƒªã‚¹ã‚¯**: ã‚³ãƒ”ãƒšã§å€¤ã‚’æ›¸ãé–“é•ãˆã‚‹å¯èƒ½æ€§

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âš ï¸ ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å°‘ã—ã ã‘å¤‰ãˆãŸæ´¾ç”Ÿã‚’ä½œã‚ŠãŸã„ã®ã«ã€å…¨éƒ¨æŒ‡å®šã—ç›´ã—
- âš ï¸ å±æ€§ãŒå¢—ãˆã‚‹ã»ã©ã€æ´¾ç”Ÿä½œæˆã®ã‚³ã‚¹ãƒˆãŒå¢—å¤§
- â†’ **ãƒ™ãƒ¼ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ä¸€éƒ¨ã ã‘å¤‰æ›´**ã§ãã‚Œã°ã‚ˆã„ã®ã§ã¯ï¼Ÿ

---

## ç¬¬7ç« : ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦æ´¾ç”Ÿ

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ´¾ç”Ÿã‚’ä½œã‚‹ã®ã«ã€å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã€‚

### ä»Šå›ã®ç›®æ¨™

- ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ä¸€éƒ¨å¤‰æ›´
- **Prototype**ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥

### å®Œæˆï¼šPrototypeãƒ‘ã‚¿ãƒ¼ãƒ³

```perl
#!/usr/bin/env perl
use v5.36;

# Cloneable Role: ã‚¯ãƒ­ãƒ¼ãƒ³æ©Ÿèƒ½ã‚’æä¾›
package Cloneable {
    use Moo::Role;
    use Storable qw(dclone);
    
    sub clone($self) {
        # æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
        return dclone($self);
    }
    
    sub clone_with($self, %overrides) {
        my $cloned = $self->clone;
        
        # æŒ‡å®šã•ã‚ŒãŸå±æ€§ã ã‘ä¸Šæ›¸ã
        for my $key (keys %overrides) {
            if ($cloned->can($key)) {
                $cloned->$key($overrides{$key});
            }
        }
        
        return $cloned;
    }
}

package WhiskyProfile {
    use Moo;
    with 'Cloneable';
    
    has region       => (is => 'ro', required => 1);
    has sub_region   => (is => 'ro', default => '');
    has distillery   => (is => 'rw', default => 'Generic');
    has nose_notes   => (is => 'rw', default => sub { [] });
    has palate_notes => (is => 'rw', default => sub { [] });
    has finish_notes => (is => 'rw', default => sub { [] });
    has peat_level   => (is => 'rw', default => 5);
    has smoke_level  => (is => 'rw', default => 5);
    has sweetness    => (is => 'rw', default => 5);
    
    sub describe($self) {
        return sprintf(
            "Distillery: %s\nRegion: %s (%s)\nPeat: %d, Smoke: %d, Sweet: %d\nNose: %s",
            $self->distillery,
            $self->region,
            $self->sub_region || 'general',
            $self->peat_level,
            $self->smoke_level,
            $self->sweetness,
            join(', ', $self->nose_notes->@*),
        );
    }
}

package main {
    say "=== Prototypeãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ´¾ç”Ÿä½œæˆ ===\n";
    
    # Islayã®åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼‰
    my $islay_base = WhiskyProfile->new(
        region       => 'Scotland',
        sub_region   => 'Islay',
        distillery   => 'Islay Base',
        nose_notes   => ['smoky', 'peaty', 'maritime'],
        palate_notes => ['intense smoke', 'brine', 'pepper'],
        finish_notes => ['long', 'warming'],
        peat_level   => 8,
        smoke_level  => 8,
        sweetness    => 3,
    );
    
    say "--- Islay Base Profile ---";
    say $islay_base->describe;
    say "";
    
    # Ardbegé¢¨: ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ä¸€éƒ¨ã ã‘å¤‰æ›´
    my $ardbeg = $islay_base->clone_with(
        distillery  => 'Ardbeg',
        peat_level  => 10,
        smoke_level => 10,
        sweetness   => 2,
    );
    
    say "--- Ardbeg Style (cloned from base) ---";
    say $ardbeg->describe;
    say "";
    
    # Laphroaigé¢¨: ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦åˆ¥ã®å¤‰æ›´
    my $laphroaig = $islay_base->clone_with(
        distillery => 'Laphroaig',
        peat_level => 9,
    );
    $laphroaig->nose_notes(['smoky', 'peaty', 'maritime', 'medicinal', 'seaweed']);
    
    say "--- Laphroaig Style (cloned from base) ---";
    say $laphroaig->describe;
    say "";
    
    # Bowmoreé¢¨: Ardbegã‹ã‚‰ã•ã‚‰ã«æ´¾ç”Ÿ
    my $bowmore = $ardbeg->clone_with(
        distillery  => 'Bowmore',
        peat_level  => 6,
        smoke_level => 5,
        sweetness   => 5,
    );
    
    say "--- Bowmore Style (cloned from Ardbeg) ---";
    say $bowmore->describe;
}
```

### å®Ÿè¡Œçµæœ

```
=== Prototypeãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ´¾ç”Ÿä½œæˆ ===

--- Islay Base Profile ---
Distillery: Islay Base
Region: Scotland (Islay)
Peat: 8, Smoke: 8, Sweet: 3
Nose: smoky, peaty, maritime

--- Ardbeg Style (cloned from base) ---
Distillery: Ardbeg
Region: Scotland (Islay)
Peat: 10, Smoke: 10, Sweet: 2
Nose: smoky, peaty, maritime

--- Laphroaig Style (cloned from base) ---
Distillery: Laphroaig
Region: Scotland (Islay)
Peat: 9, Smoke: 8, Sweet: 3
Nose: smoky, peaty, maritime, medicinal, seaweed

--- Bowmore Style (cloned from Ardbeg) ---
Distillery: Bowmore
Region: Scotland (Islay)
Peat: 6, Smoke: 5, Sweet: 5
Nose: smoky, peaty, maritime
```

### Prototypeã®åŠ¹æœ

```mermaid
classDiagram
    class Cloneable {
        <<role>>
        +clone(): Object
        +clone_with(%overrides): Object
    }
    
    class WhiskyProfile {
        +region: Str
        +sub_region: Str
        +distillery: Str
        +peat_level: Int
        +smoke_level: Int
        +sweetness: Int
        +clone(): WhiskyProfile
        +clone_with(%overrides): WhiskyProfile
    }
    
    Cloneable <|.. WhiskyProfile
    
    WhiskyProfile <.. WhiskyProfile : clones
    
    note for WhiskyProfile "clone()ã§ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ´¾ç”Ÿã‚’ç°¡å˜ã«ä½œæˆ\nclone_with()ã§ä¸€éƒ¨ã ã‘å¤‰æ›´"
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- âœ… **Prototype**ãƒ‘ã‚¿ãƒ¼ãƒ³ = ã‚¯ãƒ­ãƒ¼ãƒ³ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
- âœ… `clone()`ã§å®Œå…¨ã‚³ãƒ”ãƒ¼ã€`clone_with()`ã§ä¸€éƒ¨å¤‰æ›´
- âœ… Storable::dclone()ã§æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’å®Ÿç¾
- âœ… æ´¾ç”Ÿã®æ´¾ç”Ÿï¼ˆArdbeg â†’ Bowmoreï¼‰ã‚‚ç°¡å˜

---

## ç¬¬8ç« : 3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Œæˆï¼

### å…¨ä½“ã®æŒ¯ã‚Šè¿”ã‚Š

ã“ã“ã¾ã§ã®æˆé•·ã‚’æŒ¯ã‚Šè¿”ã‚Šã¾ã—ã‚‡ã†ã€‚

| ç«  | å•é¡Œ | è§£æ±ºç­– | ãƒ‘ã‚¿ãƒ¼ãƒ³ |
|----|------|--------|----------|
| 2-3 | ç”£åœ°åˆ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çµ„ã¿åˆã‚ã›ãƒŸã‚¹ | ãƒ•ã‚¡ãƒŸãƒªä¸€æ‹¬ç”Ÿæˆ | **Abstract Factory** |
| 4-5 | é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤§é‡ç”Ÿæˆ | å…±æœ‰ãƒ—ãƒ¼ãƒ« | **Flyweight** |
| 6-7 | æ´¾ç”Ÿãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‰‹å‹•ä½œæˆ | ã‚¯ãƒ­ãƒ¼ãƒ³ | **Prototype** |

### 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é€£æº

```mermaid
graph TD
    subgraph "Abstract Factory"
        AF[TastingKitFactory]
        SF[ScotchFactory]
        IF[IrishFactory]
        AF --> SF
        AF --> IF
    end
    
    subgraph "Flyweight"
        FP[FlavorPool]
        F1[smoky]
        F2[peaty]
        F3[vanilla]
        FP --> F1
        FP --> F2
        FP --> F3
    end
    
    subgraph "Prototype"
        BASE[Islay Base Profile]
        ARD[Ardbeg Variant]
        LAP[Laphroaig Variant]
        BASE -.->|clone| ARD
        BASE -.->|clone| LAP
    end
    
    SF --> BASE
    SF --> FP
    
    style AF fill:#e1f5fe
    style FP fill:#f3e5f5
    style BASE fill:#e8f5e9
```

### æœ€çµ‚ç‰ˆã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

```perl
#!/usr/bin/env perl
use v5.36;

# === Flyweight: é¦™å‘³ãƒ—ãƒ¼ãƒ« ===
package FlavorPool {
    use Moo;
    
    my $_instance;
    has _pool => (is => 'ro', default => sub { {} });
    
    sub instance { $_instance //= __PACKAGE__->new }
    
    sub get($self, $name, $category) {
        my $key = "$category:$name";
        $self->_pool->{$key} //= FlavorDescriptor->new(
            name => $name, category => $category
        );
        return $self->_pool->{$key};
    }
}

package FlavorDescriptor {
    use Moo;
    has name     => (is => 'ro', required => 1);
    has category => (is => 'ro', required => 1);
}

# === Prototype: ã‚¯ãƒ­ãƒ¼ãƒ³å¯èƒ½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ===
package Cloneable {
    use Moo::Role;
    use Storable qw(dclone);
    
    sub clone($self) { dclone($self) }
    
    sub clone_with($self, %overrides) {
        my $c = $self->clone;
        $c->$_($overrides{$_}) for grep { $c->can($_) } keys %overrides;
        return $c;
    }
}

package WhiskyProfile {
    use Moo;
    with 'Cloneable';
    
    has distillery => (is => 'rw', required => 1);
    has peat_level => (is => 'rw', default => 5);
    has flavors    => (is => 'rw', default => sub { [] });
    
    sub add_flavor($self, $name, $category) {
        push $self->flavors->@*, FlavorPool->instance->get($name, $category);
    }
}

# === Abstract Factory: ç”£åœ°åˆ¥ã‚­ãƒƒãƒˆç”Ÿæˆ ===
package TastingKitFactory::Role {
    use Moo::Role;
    requires 'create_base_profile';
    requires 'create_card';
}

package ScotchFactory {
    use Moo;
    with 'TastingKitFactory::Role';
    
    sub create_base_profile($self) {
        my $profile = WhiskyProfile->new(distillery => 'Islay Base', peat_level => 8);
        $profile->add_flavor('smoky', 'nose');
        $profile->add_flavor('peaty', 'nose');
        return $profile;
    }
    
    sub create_card($self, $profile) {
        return TastingCard->new(profile => $profile);
    }
}

package TastingCard {
    use Moo;
    has profile => (is => 'ro', required => 1);
    
    sub render($self) {
        my $p = $self->profile;
        my $flavors = join(', ', map { $_->name } $p->flavors->@*);
        return sprintf(
            "â”â”â”â” TASTING CARD â”â”â”â”“\nâ”ƒ %s (Peat: %d)\nâ”ƒ Flavors: %s\nâ”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›",
            $p->distillery, $p->peat_level, $flavors
        );
    }
}

# === ãƒ¡ã‚¤ãƒ³å‡¦ç†: 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ±åˆ ===
package main {
    say "=== ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ç”Ÿæˆå™¨ v1.0 ===";
    say "=== Abstract Factory Ã— Flyweight Ã— Prototype ===\n";
    
    # Abstract Factory: ç”£åœ°åˆ¥ãƒ•ã‚¡ã‚¯ãƒˆãƒªã§ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    my $scotch_factory = ScotchFactory->new;
    my $base = $scotch_factory->create_base_profile;
    
    say "--- Base Profile ---";
    say $scotch_factory->create_card($base)->render;
    say "";
    
    # Prototype: ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦æ´¾ç”Ÿã‚’ä½œæˆ
    my $ardbeg = $base->clone_with(distillery => 'Ardbeg', peat_level => 10);
    my $bowmore = $base->clone_with(distillery => 'Bowmore', peat_level => 5);
    
    say "--- Ardbeg (cloned) ---";
    say $scotch_factory->create_card($ardbeg)->render;
    say "";
    
    say "--- Bowmore (cloned) ---";
    say $scotch_factory->create_card($bowmore)->render;
    say "";
    
    # Flyweight: é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…±æœ‰çŠ¶æ³
    my $pool = FlavorPool->instance;
    say "=== Flyweight Pool Status ===";
    say "å…±æœ‰é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°: " . scalar(keys $pool->_pool->%*);
    say "ãƒ—ãƒ¼ãƒ«å†…å®¹: " . join(', ', sort keys $pool->_pool->%*);
}
```

### å®Ÿè¡Œçµæœ

```
=== ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ç”Ÿæˆå™¨ v1.0 ===
=== Abstract Factory Ã— Flyweight Ã— Prototype ===

--- Base Profile ---
â”â”â”â” TASTING CARD â”â”â”â”“
â”ƒ Islay Base (Peat: 8)
â”ƒ Flavors: smoky, peaty
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

--- Ardbeg (cloned) ---
â”â”â”â” TASTING CARD â”â”â”â”“
â”ƒ Ardbeg (Peat: 10)
â”ƒ Flavors: smoky, peaty
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

--- Bowmore (cloned) ---
â”â”â”â” TASTING CARD â”â”â”â”“
â”ƒ Bowmore (Peat: 5)
â”ƒ Flavors: smoky, peaty
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

=== Flyweight Pool Status ===
å…±æœ‰é¦™å‘³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°: 2
ãƒ—ãƒ¼ãƒ«å†…å®¹: nose:peaty, nose:smoky
```

---

## ã¾ã¨ã‚

### å­¦ã‚“ã 3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ä¸€è¨€ã§ | ä½¿ã†ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---------|-------|---------------|
| **Abstract Factory** | é–¢é€£è£½å“ç¾¤ã®ä¸€æ‹¬ç”Ÿæˆ | çµ„ã¿åˆã‚ã›ãƒŸã‚¹ã‚’æ§‹é€ çš„ã«é˜²ããŸã„ |
| **Flyweight** | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰ã§ãƒ¡ãƒ¢ãƒªç¯€ç´„ | åŒã˜å†…å®¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¤§é‡ã«ã‚ã‚‹ |
| **Prototype** | ã‚¯ãƒ­ãƒ¼ãƒ³ã§æ´¾ç”Ÿä½œæˆ | ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å°‘ã—å¤‰ãˆãŸæ´¾ç”ŸãŒæ¬²ã—ã„ |

### 3ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå”åŠ›ã™ã‚‹å ´é¢

ã“ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®åŠ¹ç‡åŒ–ã€ã¨ã„ã†å…±é€šãƒ†ãƒ¼ãƒã§é€£æºã—ã‚„ã™ã„çµ„ã¿åˆã‚ã›ã§ã™ï¼š

- **Abstract Factory** â†’ ç”£åœ°ã¨ã„ã†ã€Œãƒ•ã‚¡ãƒŸãƒªã€ã§ä¸€è²«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¾¤ã‚’ç”Ÿæˆ
- **Flyweight** â†’ é¦™å‘³èªå½™ã¨ã„ã†ã€Œå…±æœ‰ã™ã¹ããƒ‡ãƒ¼ã‚¿ã€ã‚’åŠ¹ç‡ç®¡ç†
- **Prototype** â†’ è’¸æºœæ‰€ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ã†ã€Œæ´¾ç”Ÿã€ã‚’ç°¡å˜ã«ä½œæˆ

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- ã€Œé–¢é€£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€ç·’ã«ä½œã‚ŠãŸã„ã€ã¨æ€ã£ãŸã‚‰ â†’ **Abstract Factory**
- ã€ŒåŒã˜ãƒ‡ãƒ¼ã‚¿ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¤§é‡ã«ã‚ã‚‹ã€ã¨æ€ã£ãŸã‚‰ â†’ **Flyweight**
- ã€Œãƒ™ãƒ¼ã‚¹ã‹ã‚‰å°‘ã—ã ã‘å¤‰ãˆãŸæ´¾ç”Ÿã‚’ä½œã‚ŠãŸã„ã€ã¨æ€ã£ãŸã‚‰ â†’ **Prototype**

ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åå‰ã‚’è¦šãˆã‚‹ã‚ˆã‚Šã€**ã€Œã“ã®å•é¡Œã«ã¯ã“ã®è§£æ±ºç­–ã€**ã¨ã„ã†æ„Ÿè¦šã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚

---

## å‹•ä½œç’°å¢ƒãƒ»ã‚³ãƒ¼ãƒ‰

æœ¬è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œç¢ºèªã—ã¦ã„ã¾ã™ï¼š

- Perl v5.36ä»¥é™ï¼ˆ`signatures`æ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼‰
- cpanmçµŒç”±ã§ `Moo` ã¨ `Storable` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cpanm Moo Storable
```

SlÃ¡inte! ğŸ¥ƒ
