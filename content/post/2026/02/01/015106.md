---
date: 2026-02-01T01:51:06+09:00
description: Perlã§Discord/Slack Botã‚’ä½œã‚ŠãªãŒã‚‰Commandã€Factoryã€Strategyã€Observerãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè·µã§ç¿’å¾—ã€‚å…¨10ç« ã§å®Ÿç”¨ãƒ¬ãƒ™ãƒ«ã®Botãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå®Œæˆã—ã¾ã™ã€‚
draft: false
epoch: 1769878266
image: /favicon.png
iso8601: 2026-02-01T01:51:06+09:00
tags:
  - perl
  - perl-design-patterns
  - perl-discord-bot
  - hands-on-learning
  - command-pattern
  - factory-pattern
  - strategy-pattern
  - observer-pattern
title: Perlã§åŸ·äº‹Botã€œ4ã¤ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ä½œã‚‹ã‚³ãƒãƒ³ãƒ‰å¸å›½
toc: true
---

![åŸ·äº‹Bot - Butler Bot](/public_images/2026/hands-on-design-patterns/butler-bot-header.png)

## ã¯ã˜ã‚ã«

ã€Œãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç†è«–ã¯å­¦ã‚“ã ã€‚ã§ã‚‚ã€ã„ã–ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã“ã†ã¨ã™ã‚‹ã¨æ‰‹ãŒæ­¢ã¾ã‚‹...ã€

ãã‚“ãªçµŒé¨“ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

ã“ã®ã‚·ãƒªãƒ¼ã‚ºã§ã¯ã€**Discord/Slack Bot**ã‚’é¡Œæã«ã€4ã¤ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’**æ‰‹ã‚’å‹•ã‹ã—ã¦**èº«ã«ã¤ã‘ã¾ã™ã€‚å®Œæˆã™ã‚‹ã®ã¯ã€å‹äººã«è‡ªæ…¢ã§ãã‚‹ã€ŒåŸ·äº‹Botã€ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¦ã°å¿œç­”ã—ã€æ€§æ ¼ã‚’å¤‰ãˆã‚Œã°è©±ã—æ–¹ãŒå¤‰ã‚ã‚‹ã€å®Ÿç”¨çš„ãªBotãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

### ç¿’å¾—ã§ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | å½¹å‰² | ç™»å ´ç«  |
|---------|------|-------|
| **Command** | ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚«ãƒ—ã‚»ãƒ«åŒ– | ç¬¬2-3ç«  |
| **Factory** | ã‚³ãƒãƒ³ãƒ‰åã‹ã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆ | ç¬¬4-5ç«  |
| **Strategy** | å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆ | ç¬¬6-7ç«  |
| **Observer** | ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚’è¤‡æ•°ã‚·ã‚¹ãƒ†ãƒ ã«é€šçŸ¥ | ç¬¬8ç«  |

### å¯¾è±¡èª­è€…

- ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç†è«–ã¯å­¦ã‚“ã ãŒå®Ÿè·µçµŒé¨“ãŒå°‘ãªã„
- Perlã®åŸºæœ¬æ–‡æ³•ã¯ç†è§£ã—ã¦ã„ã‚‹
- ã€Œå‹äººã«è‡ªæ…¢ã§ãã‚‹ä½•ã‹ã€ã‚’ä½œã‚ŠãŸã„
- å®Ÿå‹™ã§ä½¿ãˆã‚‹ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ãŸã„

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Perl v5.36ä»¥é™
- Mooï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼‰
- signaturesã€postfix dereferenceç­‰ã®ãƒ¢ãƒ€ãƒ³Perlæ©Ÿèƒ½

ãã‚Œã§ã¯ã€åŸ·äº‹Botã‚’ä½œã‚Šå§‹ã‚ã¾ã—ã‚‡ã†ï¼

---

## ç¬¬1ç« : åŸ·äº‹Botã®èª•ç”Ÿã€œæœ€åˆã®æŒ¨æ‹¶

### ä»Šå›ã®ç›®æ¨™

- Botã®åŸºæœ¬æ§‹é€ ã‚’ä½œã‚‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œç­”ã™ã‚‹ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹
- ã‚³ãƒãƒ³ãƒ‰è§£æã®å¿…è¦æ€§ã«æ°—ã¥ã

### å‹•ãï¼šæœ€åˆã®å®Ÿè£…

ã¾ãšã¯ã€ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€ŒHello!ã€ã¨è¿”ã™ã€ã‚·ãƒ³ãƒ—ãƒ«ãªBotã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```perl
#!/usr/bin/env perl
use v5.36;
use warnings;

package SimpleBot {
    use Moo;

    sub handle_message ($self, $message) {
        # ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€ŒHello!ã€ã¨è¿”ã™
        return "Hello! I received: $message";
    }
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
my $bot = SimpleBot->new;

my @messages = (
    "ã“ã‚“ã«ã¡ã¯",
    "/help",
    "/status",
    "ä»Šæ—¥ã®å¤©æ°—ã¯ï¼Ÿ",
);

for my $msg (@messages) {
    my $response = $bot->handle_message($msg);
    say "User: $msg";
    say "Bot: $response";
    say "---";
}
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¿œç­”ã—ã¾ã™ã€‚

### ç ´ç¶»ï¼šå•é¡ŒãŒç™ºç”Ÿ

ã“ã®å®Ÿè£…ã«ã¯å•é¡ŒãŒã‚ã‚Šã¾ã™ï¼š

1. **ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åŒã˜å¿œç­”** - `/help`ã‚‚`ã“ã‚“ã«ã¡ã¯`ã‚‚åŒºåˆ¥ã§ããªã„
2. **ã‚³ãƒãƒ³ãƒ‰ã‚’è­˜åˆ¥ã§ããªã„** - `/status`ã®ã‚ˆã†ãªç‰¹åˆ¥ãªã‚³ãƒãƒ³ãƒ‰ã‚’å‡¦ç†ã§ããªã„
3. **æ©Ÿèƒ½è¿½åŠ ãŒå›°é›£** - æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã¨handle_messageãŒè‚¥å¤§åŒ–ã™ã‚‹

### å®Œæˆï¼šã‚³ãƒãƒ³ãƒ‰ã‚’è­˜åˆ¥ã™ã‚‹

`/hello`ã‚³ãƒãƒ³ãƒ‰ã«å¿œç­”ã§ãã‚‹ã‚ˆã†ã«æ”¹å–„ã—ã¾ã—ã‚‡ã†ã€‚

```perl
#!/usr/bin/env perl
use v5.36;
use warnings;

package HelloBot {
    use Moo;

    sub handle_message ($self, $message) {
        # ã‚³ãƒãƒ³ãƒ‰ã‹ã©ã†ã‹ã‚’åˆ¤å®š
        if ($message =~ m{^/hello\s*(.*)$}) {
            my $name = $1 || 'Guest';
            return "Hello, $name! Welcome to Butler Bot!";
        }
        
        # ã‚³ãƒãƒ³ãƒ‰ä»¥å¤–ã¯ç„¡è¦–ï¼ˆã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¿œç­”ï¼‰
        return undef;
    }
}

my $bot = HelloBot->new;

my @messages = (
    "/hello",
    "/hello World",
    "/hello Perl Developer",
    "ã“ã‚“ã«ã¡ã¯",      # ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªã„ã®ã§ç„¡è¦–
    "/help",           # æœªå®Ÿè£…ã‚³ãƒãƒ³ãƒ‰ãªã®ã§ç„¡è¦–
);

for my $msg (@messages) {
    my $response = $bot->handle_message($msg);
    say "User: $msg";
    if (defined $response) {
        say "Bot: $response";
    } else {
        say "Bot: (no response)";
    }
    say "---";
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- ã‚³ãƒãƒ³ãƒ‰ã‚’æ­£è¦è¡¨ç¾ã§è­˜åˆ¥ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
- å¼•æ•°ã‚‚å—ã‘å–ã‚Œã‚‹ï¼ˆ`/hello World`ï¼‰
- ãŸã ã—ã€ã‚³ãƒãƒ³ãƒ‰ãŒå¢—ãˆã‚‹ã¨æ–°ãŸãªå•é¡ŒãŒ...

æ¬¡ã®ç« ã§ã¯ã€è¤‡æ•°ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã¨ãã«ç›´é¢ã™ã‚‹ã€Œif-elseåœ°ç„ã€ã‚’ä½“é¨“ã—ã€Commandãƒ‘ã‚¿ãƒ¼ãƒ³ã§è§£æ±ºã—ã¾ã™ã€‚

---

![Commandãƒ‘ã‚¿ãƒ¼ãƒ³ - ã‚³ãƒãƒ³ãƒ‰ã‚«ãƒ¼ãƒ‰](/public_images/2026/hands-on-design-patterns/command-pattern.png)

## ç¬¬2ç« : ã‚³ãƒãƒ³ãƒ‰ã‚’å¢—ã‚„ã™ã€œif-elseåœ°ç„ã‹ã‚‰ã®è„±å‡º

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

å‰ç« ã§ã¯`/hello`ã‚³ãƒãƒ³ãƒ‰ã«å¿œç­”ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä»Šå›ã¯`/help`ã€`/status`ã€`/joke`ãªã©ã€è¤‡æ•°ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- è¤‡æ•°ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹
- if-elseåœ°ç„ã‚’ä½“é¨“ã™ã‚‹
- Commandãƒ‘ã‚¿ãƒ¼ãƒ³ã§è§£æ±ºã™ã‚‹

### å‹•ãï¼šif-elseã§åˆ†å²

ç´ ç›´ã«å®Ÿè£…ã™ã‚‹ã¨ã€ã“ã†ãªã‚Šã¾ã™ã€‚

```perl
package IfElseBot {
    use Moo;
    
    has 'jokes' => (is => 'ro', default => sub {
        [
            "Why do programmers prefer dark mode? Because light attracts bugs!",
            "There are only 10 types of people: those who understand binary and those who don't.",
        ]
    });

    sub handle_message ($self, $message) {
        if ($message =~ m{^/hello\s*(.*)$}) {
            my $name = $1 || 'Guest';
            return "Hello, $name!";
        }
        elsif ($message =~ m{^/help$}) {
            return "Available commands: /hello, /help, /status, /joke";
        }
        elsif ($message =~ m{^/status$}) {
            return "Bot status: online";
        }
        elsif ($message =~ m{^/joke$}) {
            my $jokes = $self->jokes;
            return $jokes->[rand @$jokes];
        }
        # æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«elsifã‚’è¿½åŠ ...
        
        return undef;
    }
}
```

### ç ´ç¶»ï¼šif-elseåœ°ç„

ã‚³ãƒãƒ³ãƒ‰ãŒ10å€‹ã€20å€‹ã¨å¢—ãˆã¦ã„ãã¨...

```perl
if ($cmd eq 'hello') { ... }
elsif ($cmd eq 'help') { ... }
elsif ($cmd eq 'status') { ... }
elsif ($cmd eq 'joke') { ... }
elsif ($cmd eq 'weather') { ... }
elsif ($cmd eq 'remind') { ... }
elsif ($cmd eq 'translate') { ... }
elsif ($cmd eq 'meme') { ... }
elsif ($cmd eq 'quote') { ... }
# ã¾ã ã¾ã ç¶šã...
```

å•é¡Œç‚¹ï¼š
1. **handle_messageãŒå·¨å¤§åŒ–** - 100å€‹ã®ã‚³ãƒãƒ³ãƒ‰ = 100å€‹ã®elsif
2. **å¤‰æ›´ãŒå›°é›£** - æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£
3. **ãƒ†ã‚¹ãƒˆãŒå›°é›£** - å…¨ä½“ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„ã¨ã„ã‘ãªã„

### å®Œæˆï¼šCommandãƒ‘ã‚¿ãƒ¼ãƒ³

ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã—ã‚‡ã†ã€‚

```perl
# ===== ã‚³ãƒãƒ³ãƒ‰åŸºåº•ã‚¯ãƒ©ã‚¹ =====
package Command {
    use Moo::Role;
    
    requires 'execute';
    
    sub name ($self) {
        my $class = ref($self) || $self;
        $class =~ s/.*:://;
        $class =~ s/Command$//;
        return lc($class);
    }
}

# ===== å„ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… =====
package HelloCommand {
    use Moo;
    with 'Command';
    
    sub execute ($self, $args, $context) {
        my $name = $args || 'Guest';
        return "Hello, $name!";
    }
}

package HelpCommand {
    use Moo;
    with 'Command';
    
    sub execute ($self, $args, $context) {
        my @commands = sort keys %{$context->{commands}};
        return "Available commands: " . join(", ", map { "/$_" } @commands);
    }
}

package StatusCommand {
    use Moo;
    with 'Command';
    sub execute ($self, $args, $context) { "Bot status: online" }
}

package JokeCommand {
    use Moo;
    with 'Command';
    
    has 'jokes' => (is => 'ro', default => sub {
        [
            "Why do programmers prefer dark mode? Because light attracts bugs!",
            "There are only 10 types of people: those who understand binary and those who don't.",
        ]
    });
    
    sub execute ($self, $args, $context) {
        my $jokes = $self->jokes;
        return $jokes->[rand @$jokes];
    }
}

# ===== Botæœ¬ä½“ =====
package CommandBot {
    use Moo;
    
    has 'commands' => (is => 'ro', default => sub { {} });
    
    sub register ($self, $command) {
        my $name = $command->name;
        $self->commands->{$name} = $command;
        return $self;
    }
    
    sub handle_message ($self, $message) {
        if ($message =~ m{^/(\w+)\s*(.*)$}) {
            my ($cmd_name, $args) = ($1, $2);
            
            if (my $command = $self->commands->{$cmd_name}) {
                my $context = { commands => $self->commands };
                return $command->execute($args, $context);
            }
            return "Unknown command: /$cmd_name";
        }
        return undef;
    }
}

# ä½¿ç”¨ä¾‹
my $bot = CommandBot->new;
$bot->register(HelloCommand->new)
    ->register(HelpCommand->new)
    ->register(StatusCommand->new)
    ->register(JokeCommand->new);

say $bot->handle_message("/hello World");  # Hello, World!
say $bot->handle_message("/help");         # Available commands: /hello, /help, ...
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- **ã‚³ãƒãƒ³ãƒ‰ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚¯ãƒ©ã‚¹** - è²¬ä»»ãŒæ˜ç¢º
- **æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã¯ç™»éŒ²ã™ã‚‹ã ã‘** - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ãªã„ï¼ˆOpen-ClosedåŸå‰‡ï¼‰
- **å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆå¯èƒ½** - å„ã‚³ãƒãƒ³ãƒ‰ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹

```mermaid
classDiagram
    class Command {
        <<interface>>
        +execute(args, context)
        +name()
    }
    class HelloCommand {
        +execute(args, context)
    }
    class HelpCommand {
        +execute(args, context)
    }
    class StatusCommand {
        +execute(args, context)
    }
    class CommandBot {
        -commands: Hash
        +register(command)
        +handle_message(message)
    }
    Command <|.. HelloCommand
    Command <|.. HelpCommand
    Command <|.. StatusCommand
    CommandBot --> Command
```

---

## ç¬¬3ç« : ã‚³ãƒãƒ³ãƒ‰ã«å¼•æ•°ã‚’æ¸¡ã™ã€œ/weather Tokyo

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Commandãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€å¼•æ•°ã‚’å—ã‘å–ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- å¼•æ•°ä»˜ãã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹
- å¼•æ•°è§£æã®é‡è¤‡ã‚’ä½“é¨“ã™ã‚‹
- åŸºåº•ã‚¯ãƒ©ã‚¹ã«å¼•æ•°è§£æã‚’é›†ç´„ã™ã‚‹

### å‹•ãï¼šå¼•æ•°ã‚’å—ã‘å–ã‚‹

`/weather Tokyo`ã®ã‚ˆã†ã«å¼•æ•°ã‚’å—ã‘å–ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã‚Šã¾ã™ã€‚

```perl
package WeatherCommand {
    use Moo;
    with 'Command';
    
    has 'weather_data' => (is => 'ro', default => sub {{
        tokyo  => { temp => 15, condition => 'Sunny' },
        osaka  => { temp => 14, condition => 'Cloudy' },
        kyoto  => { temp => 13, condition => 'Rainy' },
    }});
    
    sub execute ($self, $args, $context) {
        my @parts = split /\s+/, ($args // '');
        my $city = $parts[0] // '';
        
        if (!$city) {
            return "Usage: /weather <city>";
        }
        
        my $data = $self->weather_data->{lc $city};
        return "Unknown city: $city" unless $data;
        
        return "$city: $data->{temp}Â°C, $data->{condition}";
    }
}
```

### ç ´ç¶»ï¼šå¼•æ•°è§£æã®é‡è¤‡

`/remind 10:00 Meeting`ã‚„`/translate en ja Hello`ãªã©ã€å¼•æ•°ã‚’å–ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒå¢—ãˆã‚‹ã¨...

```perl
# WeatherCommand
my @parts = split /\s+/, ($args // '');
my $city = $parts[0] // '';

# RemindCommand
my @parts = split /\s+/, ($args // ''), 2;
my $time = $parts[0] // '';
my $message = $parts[1] // '';

# TranslateCommand
my @parts = split /\s+/, ($args // ''), 3;
my $from = $parts[0] // '';
my $to = $parts[1] // '';
my $text = $parts[2] // '';
```

åŒã˜ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå„ã‚³ãƒãƒ³ãƒ‰ã«æ•£åœ¨ã—ã¦ã„ã¾ã™ã€‚

### å®Œæˆï¼šå¼•æ•°è§£æã‚’é›†ç´„

å¼•æ•°è§£æã‚’åŸºåº•Roleã«é›†ç´„ã—ã¾ã—ã‚‡ã†ã€‚

```perl
# ===== å¼•æ•°è§£æç”¨ã®Role =====
package ArgumentParser {
    use Moo::Role;
    
    sub argument_spec ($self) { [] }  # ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
    
    sub parse_args ($self, $args_string) {
        my $spec = $self->argument_spec;
        my @parts = split /\s+/, ($args_string // '');
        
        my %parsed;
        my @errors;
        
        for my $i (0 .. $#$spec) {
            my $arg_def = $spec->[$i];
            my $value = $parts[$i];
            
            if ($arg_def->{required} && !defined $value) {
                push @errors, "Missing: $arg_def->{name}";
            }
            
            $parsed{$arg_def->{name}} = $value // $arg_def->{default};
        }
        
        return (\%parsed, \@errors);
    }
    
    sub usage ($self) {
        my $spec = $self->argument_spec;
        my @args = map {
            $_->{required} ? "<$_->{name}>" : "[$_->{name}]"
        } @$spec;
        return "Usage: /" . $self->name . " " . join(" ", @args);
    }
}

# ===== ã‚³ãƒãƒ³ãƒ‰ï¼ˆå¼•æ•°specä»˜ãï¼‰=====
package WeatherCommand {
    use Moo;
    with 'Command', 'ArgumentParser';
    
    sub argument_spec ($self) {
        [{ name => 'city', required => 1 }]
    }
    
    sub execute ($self, $args, $context) {
        my ($parsed, $errors) = $self->parse_args($args);
        return join("\n", @$errors, $self->usage) if @$errors;
        
        # æœ¬æ¥ã®å‡¦ç†
        return "Weather in $parsed->{city}: 15Â°C, Sunny";
    }
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- å¼•æ•°è§£æãƒ­ã‚¸ãƒƒã‚¯ã¯åŸºåº•Roleã«é›†ç´„
- å„ã‚³ãƒãƒ³ãƒ‰ã¯`argument_spec`ã‚’å®šç¾©ã™ã‚‹ã ã‘
- Usageãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è‡ªå‹•ç”Ÿæˆ

---

![Factoryãƒ‘ã‚¿ãƒ¼ãƒ³ - ã‚³ãƒãƒ³ãƒ‰å·¥å ´](/public_images/2026/hands-on-design-patterns/factory-pattern.png)

## ç¬¬4ç« : ã‚³ãƒãƒ³ãƒ‰å·¥å ´ã‚’ä½œã‚‹ã€œåå‰ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆ

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

å¼•æ•°è§£æã‚’åŸºåº•ã‚¯ãƒ©ã‚¹ã«é›†ç´„ã—ã€ã‚³ãƒãƒ³ãƒ‰ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²ãƒ»ç”Ÿæˆã‚’Factoryãƒ‘ã‚¿ãƒ¼ãƒ³ã§è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- ã‚³ãƒãƒ³ãƒ‰ã®æ‰‹å‹•ç™»éŒ²ã®å•é¡Œã‚’ä½“é¨“
- Factoryãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚³ãƒãƒ³ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ
- å‹•çš„ãªã‚³ãƒãƒ³ãƒ‰ç™»éŒ²ã‚’å®Ÿç¾

### å‹•ãï¼šæ‰‹å‹•ã§ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²

ç¾çŠ¶ã€ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```perl
sub get_command ($self, $name) {
    if ($name eq 'hello') { return HelloCommand->new }
    elsif ($name eq 'help') { return HelpCommand->new }
    elsif ($name eq 'status') { return StatusCommand->new }
    elsif ($name eq 'joke') { return JokeCommand->new }
    elsif ($name eq 'weather') { return WeatherCommand->new }
    # æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«elsifã‚’è¿½åŠ ...
    return undef;
}
```

### ç ´ç¶»ï¼šOpen-ClosedåŸå‰‡é•å

æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«ï¼š
1. ã‚³ãƒãƒ³ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
2. `get_command`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£

ã“ã‚Œã¯**Open-ClosedåŸå‰‡**ã«é•åã—ã¦ã„ã¾ã™ã€‚

### å®Œæˆï¼šFactoryãƒ‘ã‚¿ãƒ¼ãƒ³

ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²ã¨ç”Ÿæˆã‚’Factoryã«å§”è­²ã—ã¾ã™ã€‚

```perl
package CommandFactory {
    use Moo;
    
    has 'registry' => (is => 'ro', default => sub { {} });
    
    sub register ($self, $name, $class) {
        $self->registry->{$name} = $class;
        return $self;
    }
    
    sub create ($self, $name) {
        my $class = $self->registry->{$name};
        return undef unless $class;
        return $class->new;
    }
    
    sub list ($self) {
        return sort keys %{$self->registry};
    }
}

# ä½¿ç”¨ä¾‹
my $factory = CommandFactory->new;
$factory->register('hello', 'HelloCommand')
        ->register('help', 'HelpCommand')
        ->register('status', 'StatusCommand');

my $bot = FactoryBot->new(factory => $factory);
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

```mermaid
classDiagram
    class CommandFactory {
        -registry: Hash
        +register(name, class)
        +create(name): Command
        +list(): Array
    }
    class Command {
        <<interface>>
    }
    CommandFactory ..> Command : creates
```

- **Factoryã«ç™»éŒ²ã™ã‚‹ã ã‘** - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ãªã„
- **ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è‡ªå‹•å–å¾—** - `/help`ãŒFactoryçµŒç”±ã§ä¸€è¦§ã‚’å–å¾—
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ç™»éŒ²ã‚‚å¯èƒ½** - å‹•çš„ãªæ‹¡å¼µãŒå®¹æ˜“

---

## ç¬¬5ç« : ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã€œã‚³ãƒãƒ³ãƒ‰ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§è¿½åŠ 

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Factoryãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²ãƒ»ç”Ÿæˆã‚’è‡ªå‹•åŒ–ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã•ã‚‰ã«é€²ã‚“ã§ã€å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã€ã‚’ä½œã‚Šã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‹•çš„ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè£…
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å¿…è¦æ€§ã‚’ç†è§£
- ä¾å­˜é–¢ä¿‚ç®¡ç†ã‚’å®Ÿè£…

### å‹•ãï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®`.pm`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

```perl
package SimplePluginLoader {
    use Moo;
    use File::Spec;
    
    has 'plugin_dir' => (is => 'ro', required => 1);
    
    sub load_plugins ($self) {
        opendir(my $dh, $self->plugin_dir) or die;
        my @files = grep { /\.pm$/ } readdir($dh);
        closedir($dh);
        
        for my $file (@files) {
            require File::Spec->catfile($self->plugin_dir, $file);
            # ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰åã‚’æ¨æ¸¬...
        }
    }
}
```

### ç ´ç¶»ï¼šãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒãªã„

å•é¡Œç‚¹ï¼š
- ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰åã‚’æ¨æ¸¬ï¼ˆä¸ç¢ºå®Ÿï¼‰
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‹ã‚‰ãªã„
- ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç†ã§ããªã„

### å®Œæˆï¼šãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŒãŸã›ã¾ã—ã‚‡ã†ã€‚

```perl
package Plugin {
    use Moo::Role;
    
    sub meta_info ($self) {
        return {
            name        => 'unknown',
            version     => '0.0.1',
            description => 'No description',
            command     => 'unknown',
            requires    => [],  # ä¾å­˜ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
        };
    }
}

package GreetCommand {
    use Moo;
    with 'Command', 'Plugin';
    
    sub meta_info ($self) {
        return {
            name        => 'GreetCommand',
            version     => '1.0.0',
            description => 'Greet users with customizable messages',
            command     => 'greet',
            requires    => [],
        };
    }
    
    sub execute ($self, $args, $ctx) {
        return "Greetings, " . ($args || 'Guest') . "!";
    }
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€èª¬æ˜ã€ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¸€è¦§ã‚’å‹•çš„ã«å–å¾—å¯èƒ½

---

![Strategyãƒ‘ã‚¿ãƒ¼ãƒ³ - æ€§æ ¼ã‚¹ã‚¤ãƒƒãƒ](/public_images/2026/hands-on-design-patterns/strategy-pattern.png)

## ç¬¬6ç« : Botã®æ€§æ ¼ã‚’å¤‰ãˆã‚‹ã€œãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼/ãƒ•ã‚©ãƒ¼ãƒãƒ«

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã§ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä»Šå›ã¯ã€Botã®ã€Œæ€§æ ¼ã€ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã®å›ºå®šå•é¡Œã‚’ä½“é¨“
- Strategyãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„åˆ‡ã‚Šæ›¿ãˆ
- æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç°¡å˜ã«è¿½åŠ ã§ãã‚‹è¨­è¨ˆ

### å‹•ãï¼šå›ºå®šã®å¿œç­”

ç¾çŠ¶ã€å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

```perl
package HelloCommand {
    sub execute ($self, $args, $ctx) {
        return "Hello, " . ($args || 'Guest') . "!";
    }
}
```

### ç ´ç¶»ï¼šã‚¹ã‚¿ã‚¤ãƒ«ãŒå¤‰ãˆã‚‰ã‚Œãªã„

- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã«ã€ŒHey! ğŸ‘‹ã€ã¨è¨€ã„ãŸã„
- ãƒ•ã‚©ãƒ¼ãƒãƒ«ã«ã€ŒGood day, Sir.ã€ã¨è¨€ã„ãŸã„
- ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã«ã€Œ[INFO] Connection establishedã€ã¨è¨€ã„ãŸã„

å…¨ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### å®Œæˆï¼šStrategyãƒ‘ã‚¿ãƒ¼ãƒ³

å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’Strategyã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã™ã€‚

```perl
# ===== å¿œç­”æˆ¦ç•¥Role =====
package ResponseStrategy {
    use Moo::Role;
    
    requires 'format_greeting';
    requires 'format_info';
    requires 'format_error';
    requires 'format_success';
}

# ===== ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼æˆ¦ç•¥ =====
package FriendlyStrategy {
    use Moo;
    with 'ResponseStrategy';
    
    sub format_greeting ($self, $name) { "Hey $name! ğŸ‘‹ Great to see you!" }
    sub format_info ($self, $message)  { "â„¹ï¸ $message" }
    sub format_error ($self, $message) { "ğŸ˜… Oops! $message" }
    sub format_success ($self, $msg)   { "ğŸ‰ Awesome! $msg" }
}

# ===== ãƒ•ã‚©ãƒ¼ãƒãƒ«æˆ¦ç•¥ =====
package FormalStrategy {
    use Moo;
    with 'ResponseStrategy';
    
    sub format_greeting ($self, $name) { "Good day, $name. Welcome to Butler Bot." }
    sub format_info ($self, $message)  { "Information: $message" }
    sub format_error ($self, $message) { "Error: $message" }
    sub format_success ($self, $msg)   { "Success: $msg" }
}

# ===== ã‚³ãƒãƒ³ãƒ‰ãŒæˆ¦ç•¥ã‚’ä½¿ç”¨ =====
package HelloCommand {
    use Moo;
    with 'Command';
    
    sub execute ($self, $args, $ctx) {
        my $name = $args || 'Guest';
        return $ctx->{strategy}->format_greeting($name);
    }
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

```mermaid
classDiagram
    class ResponseStrategy {
        <<interface>>
        +format_greeting(name)
        +format_info(message)
        +format_error(message)
        +format_success(message)
    }
    class FriendlyStrategy {
        +format_greeting(name)
        +format_info(message)
    }
    class FormalStrategy {
        +format_greeting(name)
        +format_info(message)
    }
    class Bot {
        -strategy: ResponseStrategy
        +setStrategy(strategy)
    }
    ResponseStrategy <|.. FriendlyStrategy
    ResponseStrategy <|.. FormalStrategy
    Bot --> ResponseStrategy
```

- å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ã¯æ–°ã—ã„Strategyã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã ã‘
- ã‚³ãƒãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦

---

## ç¬¬7ç« : ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¦‹åˆ†ã‘ã‚‹ã€œæˆ¦ç•¥ã®è‡ªå‹•é¸æŠ

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Strategyãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä»Šå›ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦è‡ªå‹•çš„ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¤å®šã®é‡è¤‡ã‚’ä½“é¨“
- Strategyã®è‡ªå‹•é¸æŠã‚’å®Ÿè£…
- ãƒ¦ãƒ¼ã‚¶ãƒ¼é©å¿œå‹å¿œç­”ã‚’å®Ÿç¾

### å‹•ãï¼šå„ã‚³ãƒãƒ³ãƒ‰ã§ãƒ¬ãƒ™ãƒ«åˆ¤å®š

```perl
package HelpCommand {
    sub execute ($self, $args, $ctx) {
        my $level = $ctx->{user}{level} // 'beginner';
        
        if ($level eq 'expert') {
            return "Commands: /hello, /help, /status, /config, /debug, /admin";
        }
        elsif ($level eq 'intermediate') {
            return "Commands: /hello, /help, /status, /config";
        }
        else {
            return "Commands: /hello, /help, /status\n(Tip: Type /hello to greet!)";
        }
    }
}
```

### ç ´ç¶»ï¼šãƒ¬ãƒ™ãƒ«åˆ¤å®šã®é‡è¤‡

ã™ã¹ã¦ã®ã‚³ãƒãƒ³ãƒ‰ã§åŒã˜if-elseåˆ¤å®šã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### å®Œæˆï¼šStrategyã®è‡ªå‹•é¸æŠ

```perl
package StrategySelector {
    use Moo;
    
    has 'strategies' => (is => 'ro', default => sub {
        {
            beginner     => BeginnerStrategy->new,
            intermediate => IntermediateStrategy->new,
            expert       => ExpertStrategy->new,
        }
    });
    
    sub select_for_user ($self, $user) {
        my $level = $user->{level} // 'beginner';
        return $self->strategies->{$level};
    }
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«ã‹ã‚‰æˆ¦ç•¥ã‚’è‡ªå‹•é¸æŠ
- ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ¬ãƒ™ãƒ«åˆ¤å®šã‚’è¡Œã‚ãªã„
- æ–°ã—ã„ãƒ¬ãƒ™ãƒ«ã¯æ–°ã—ã„Strategyã‚’è¿½åŠ ã™ã‚‹ã ã‘

---

![Observerãƒ‘ã‚¿ãƒ¼ãƒ³ - ç›£è¦–ãƒ¢ãƒ‹ã‚¿ãƒ¼](/public_images/2026/hands-on-design-patterns/observer-pattern.png)

## ç¬¬8ç« : åŸ·äº‹ã®æ¥­å‹™æ—¥å ±ã€œã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œãƒ­ã‚°

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸæˆ¦ç•¥ã®è‡ªå‹•é¸æŠã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- ãƒ­ã‚°å‡ºåŠ›ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å•é¡Œã‚’ä½“é¨“
- Observerãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¤‡æ•°é€šçŸ¥å…ˆã«å¯¾å¿œ
- ç›£æŸ»ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…

### å‹•ãï¼šãƒ­ã‚°ã‚’å‡ºåŠ›

```perl
package SimpleLogBot {
    sub handle_message ($self, $user_id, $message) {
        # ... ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ ...
        
        # ãƒ­ã‚°å‡ºåŠ›
        $self->_log_command($user_id, $cmd_name, $args);
        
        return $result;
    }
    
    sub _log_command ($self, $user_id, $cmd_name, $args) {
        say "[LOG] User: $user_id, Command: /$cmd_name";
    }
}
```

### ç ´ç¶»ï¼šé€šçŸ¥å…ˆã‚’è¿½åŠ ã§ããªã„

- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚‚æ¬²ã—ã„
- Slacké€šçŸ¥ã‚‚æ¬²ã—ã„
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚‚æ¬²ã—ã„

ã™ã¹ã¦ã‚’handle_messageã«è¿½åŠ ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ãŒè‚¥å¤§åŒ–ã—ã¾ã™ã€‚

### å®Œæˆï¼šObserverãƒ‘ã‚¿ãƒ¼ãƒ³

```perl
# ===== Observer Role =====
package Observer {
    use Moo::Role;
    requires 'update';
}

# ===== å„ç¨®Observer =====
package LogObserver {
    use Moo;
    with 'Observer';
    
    sub update ($self, $event) {
        say "[LOG] $event->{user_id}: /$event->{command}";
    }
}

package MetricsObserver {
    use Moo;
    with 'Observer';
    
    has 'counters' => (is => 'ro', default => sub { {} });
    
    sub update ($self, $event) {
        $self->counters->{$event->{command}}++;
    }
}

package SlackObserver {
    use Moo;
    with 'Observer';
    
    sub update ($self, $event) {
        # Slack Webhookã§é€šçŸ¥
        say "[SLACK] $event->{user_id} executed /$event->{command}";
    }
}

# ===== Subjectï¼ˆé€šçŸ¥å…ƒï¼‰=====
package Subject {
    use Moo::Role;
    
    has 'observers' => (is => 'ro', default => sub { [] });
    
    sub attach ($self, $observer) {
        push @{$self->observers}, $observer;
        return $self;
    }
    
    sub notify ($self, $event) {
        $_->update($event) for @{$self->observers};
    }
}
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

```mermaid
classDiagram
    class Subject {
        -observers: List
        +attach(observer)
        +detach(observer)
        +notify(event)
    }
    class Observer {
        <<interface>>
        +update(event)
    }
    class LogObserver {
        +update(event)
    }
    class MetricsObserver {
        -counters: Hash
        +update(event)
    }
    class SlackObserver {
        +update(event)
    }
    Subject --> Observer
    Observer <|.. LogObserver
    Observer <|.. MetricsObserver
    Observer <|.. SlackObserver
```

- é€šçŸ¥å…ˆã¯Observerã¨ã—ã¦ç™»éŒ²ã™ã‚‹ã ã‘
- æ–°ã—ã„é€šçŸ¥å…ˆã¯Observerã‚’è¿½åŠ 
- Botæœ¬ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦

---

## ç¬¬9ç« : åŸ·äº‹Botã‚’å®Œæˆã•ã›ã‚‹ã€œã‚³ãƒãƒ³ãƒ‰å¸å›½ã®æ”¯é…è€…ã«

### å‰ç« ã®æŒ¯ã‚Šè¿”ã‚Š

Observerãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»é€šçŸ¥ã‚’çµ±åˆã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã“ã‚Œã¾ã§ã®4ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã™ã¹ã¦çµ±åˆã—ã€å®Œæˆç‰ˆã®Butler Botã‚’ä½œã‚Šã¾ã™ã€‚

### ä»Šå›ã®ç›®æ¨™

- Command + Factory + Strategy + Observer ã‚’çµ±åˆ
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆã®è¦‹ç›´ã—
- å®Ÿç”¨ãƒ¬ãƒ™ãƒ«ã®Botã‚’å®Œæˆ

### å‹•ãï¼šçµ±åˆã«æŒ‘æˆ¦

å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä¸æ•´åˆã§ãƒã‚°ãŒç™ºç”Ÿã—ã¾ã™ã€‚

```perl
sub handle_message ($self, $user_id, $message) {
    my $command = $self->factory->create($cmd_name);
    
    # ãƒã‚°: strategyã‚’contextã«æ¸¡ã—å¿˜ã‚Œ
    my $result = $command->execute($args, {});
    
    # ãƒã‚°: å‡ºåŠ›ã‚’strategyã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—å¿˜ã‚Œ
    
    $self->notify($event);
    return $result;
}
```

### å®Œæˆï¼šæ­£ã—ãçµ±åˆ

```perl
package ButlerBot {
    use Moo;
    with 'Subject';
    
    has 'factory'  => (is => 'ro', required => 1);
    has 'selector' => (is => 'ro', default => sub { StrategySelector->new });
    has 'users'    => (is => 'ro', default => sub { {} });
    
    sub handle_message ($self, $user_id, $message) {
        if ($message =~ m{^/(\w+)\s*(.*)$}) {
            my ($cmd_name, $args) = ($1, $2);
            
            if (my $command = $self->factory->get($cmd_name)) {
                # Strategy: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠ
                my $style = $self->get_user_style($user_id);
                my $strategy = $self->selector->get($style);
                
                # Context: å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¸¡ã™
                my $context = {
                    factory  => $self->factory,
                    strategy => $strategy,
                    selector => $self->selector,
                    user_id  => $user_id,
                };
                
                # Command: å®Ÿè¡Œ
                my $result = $command->execute($args, $context);
                
                # Observer: é€šçŸ¥
                my $event = CommandEvent->new(
                    user_id => $user_id,
                    command => $cmd_name,
                    args    => $args,
                    result  => $result,
                );
                $self->notify($event);
                
                return $result;
            }
        }
        return undef;
    }
}
```

### å®Œæˆç‰ˆã®å®Ÿè¡Œä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       ğŸ© Butler Bot - Command Empire ğŸ°        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Alice: /hello
Bot: Hey Alice! ğŸ‘‹ Welcome!

Bob: /style formal
Bot: Success: Style changed to: formal

Bob: /hello
Bot: Good day, Bob. Welcome to Butler Bot.

Admin: /metrics
Bot: Command usage:
  â€¢ hello: 2
  â€¢ style: 1
```

### ä»Šå›ã®ãƒã‚¤ãƒ³ãƒˆ

- 4ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå”èª¿ã—ã¦å‹•ä½œ
- å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç–çµåˆ
- æ‹¡å¼µãŒå®¹æ˜“ãªè¨­è¨ˆ

---

## ç¬¬10ç« : ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ¯ã‚Šè¿”ã‚‹ã€œåŸ·äº‹ãŒä½¿ã£ãŸæŠ€è¡“

### ã“ã‚Œã¾ã§ã®æ—…

10ç« ã«ã‚ãŸã£ã¦ã€åŸ·äº‹Botã‚’ä½œã‚ŠãªãŒã‚‰4ã¤ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã³ã¾ã—ãŸã€‚æœ€å¾Œã«ã€å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å½¹å‰²ã¨é¸æŠç†ç”±ã‚’æŒ¯ã‚Šè¿”ã‚Šã¾ã™ã€‚

### ä½¿ç”¨ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | å½¹å‰² | è§£æ±ºã—ãŸå•é¡Œ |
|---------|------|-------------|
| **Command** | ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ– | if-elseåœ°ç„ |
| **Factory** | ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²ãƒ»ç”Ÿæˆ | Open-ClosedåŸå‰‡é•å |
| **Strategy** | å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ | ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å•é¡Œ |
| **Observer** | ç›£æŸ»ã‚·ã‚¹ãƒ†ãƒ ã¸ã®é€šçŸ¥ | é€šçŸ¥å…ˆè¿½åŠ ã®å›°é›£ã• |

### ãƒ‘ã‚¿ãƒ¼ãƒ³é–“ã®å”èª¿

```mermaid
flowchart TD
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›] --> B[Bot.handle_message]
    B --> C{Factory}
    C -->|create| D[Command]
    B --> E{StrategySelector}
    E -->|select| F[Strategy]
    D -->|execute with| F
    D --> G[Result]
    B --> H[Observer]
    H --> I[Log]
    H --> J[Metrics]
    H --> K[Slack]
```

### ãªãœã“ã‚Œã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸ã‚“ã ã®ã‹

1. **Command** - ã‚³ãƒãƒ³ãƒ‰ãŒå¢—ãˆã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã‚‹ â†’ æ‹¡å¼µæ€§ãŒå¿…è¦
2. **Factory** - ã‚³ãƒãƒ³ãƒ‰ã®ç™»éŒ²ã‚’å¤–éƒ¨åŒ–ã—ãŸã„ â†’ å‹•çš„ãªç”ŸæˆãŒå¿…è¦
3. **Strategy** - å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰ãˆãŸã„ â†’ æŒ¯ã‚‹èˆã„ã®åˆ‡ã‚Šæ›¿ãˆãŒå¿…è¦
4. **Observer** - è¤‡æ•°ã®ç›£æŸ»ã‚·ã‚¹ãƒ†ãƒ ã«é€šçŸ¥ã—ãŸã„ â†’ 1å¯¾å¤šã®é€šçŸ¥ãŒå¿…è¦

### ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã‚ãªã„ç†ç”±ãŒãªã„

ã“ã®ã‚·ãƒªãƒ¼ã‚ºã‚’é€šã˜ã¦ã€ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã‚ãªã„ã€é¸æŠã‚’ã—ãŸå ´åˆã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’ä½“é¨“ã—ã¾ã—ãŸï¼š

- **if-elseåœ°ç„** â†’ ä¿å®ˆä¸èƒ½ãªã‚³ãƒ¼ãƒ‰
- **æ‰‹å‹•ç™»éŒ²** â†’ Open-ClosedåŸå‰‡é•å
- **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰** â†’ æŸ”è»Ÿæ€§ã®ãªã„ã‚·ã‚¹ãƒ†ãƒ 
- **å¯†çµåˆ** â†’ ãƒ†ã‚¹ãƒˆå›°é›£ãªã‚³ãƒ¼ãƒ‰

ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Œä½¿ã†ã¹ãã‚‚ã®ã€ã§ã¯ãªãã€ã€Œè‡ªç„¶ã«ãã†ãªã‚‹ã‚‚ã®ã€ã§ã™ã€‚å•é¡Œã«ç›´é¢ã—ã€è§£æ±ºç­–ã‚’æ¢ã™ã¨ã€è‡ªç„¶ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è¡Œãç€ãã¾ã™ã€‚

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®åŸ·äº‹Botã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ã•ã‚‰ã«æ‹¡å¼µã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **æœ¬ç‰©ã®Discord APIã«æ¥ç¶š** - `WebService::Discord`ã‚’ä½¿ç”¨
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº** - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®æ°¸ç¶šåŒ–
3. **Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** - ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ–
4. **AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½** - LLM APIã¨ã®é€£æº

### ãŠã‚ã‚Šã«

ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯é­”æ³•ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ã€Œå…ˆäººã®çŸ¥æµã€ã§ã™ã€‚

ã“ã®ã‚·ãƒªãƒ¼ã‚ºã§ä½œã£ãŸåŸ·äº‹Botã¯ã€ã‚ãªãŸã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã«è¿½åŠ ã§ãã‚‹å®Ÿç¸¾ã§ã™ã€‚ã€Œè‡ªä½œBotã§ãƒãƒ¼ãƒ ä½œæ¥­ã‚’è‡ªå‹•åŒ–ã—ã¦ã‚‹ã€ã¨è¨€ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‰

---

## å‚è€ƒè³‡æ–™

- [GoFãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³](https://ja.wikipedia.org/wiki/%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3_(%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2))
- [Moo ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://metacpan.org/pod/Moo)
- [Perl v5.36 æ–°æ©Ÿèƒ½](https://metacpan.org/release/RJBS/perl-5.36.0/view/pod/perldelta.pod)
