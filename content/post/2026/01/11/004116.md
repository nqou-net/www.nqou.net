---
date: 2026-01-11T00:41:16+09:00
description: LinguaBridge翻訳CLIの心臓部を、翻訳エンジンに依存しない抽象メソッドに置き換えます。まずはTranslatorRoleを決めて、CLIが「翻訳役」を注入で受け取る形を作ります。
draft: false
epoch: 1768059676
image: /public_images/2026/adapter-pattern-series-image.jpg
iso8601: 2026-01-11T00:41:16+09:00
tags:
  - perl
  - moo
  - cli
  - translation
title: '第1回-翻訳役を差し替えられるCLIの土台 - LinguaBridge翻訳CLIで学ぶ設計入門'
---

[@nqounet](https://x.com/nqounet)です。

新シリーズ「LinguaBridge翻訳CLIで学ぶ設計入門」を始めます。  
今回は「翻訳エンジンに縛られないCLI」を作るための第一歩、翻訳役の抽象化に挑戦します。

## 次回予告

{{< linkcard "/2026/01/11/004319/" >}}

## 翻訳役を固定しないための一歩

- CLIが直接翻訳APIを叩くと、別のAPIに変えたい時に全改修が必要になります。
- 先に「翻訳役の契約(インターフェース)」を決め、CLIはその契約を呼ぶだけにします。
- Mooの`does`とPerl v5.36の署名で、型と引数をすっきり書きます。

```perl
sub run ($self, $text, $to = 'en', $from = 'ja') {
    return $self->translator->translate($text, $to, $from);
}
```

## 完成したコード

```perl
#!/usr/bin/env perl
use v5.36;

# ==========================
# TranslatorRole
# ==========================
package TranslatorRole {
    use Moo::Role;
    requires 'translate';
}

# ==========================
# サンプル翻訳エンジン（仮）
# ==========================
package LinguaBridge::Translator::Echo {
    use Moo;
    use v5.36;
    with 'TranslatorRole';

    sub translate ($self, $text, $to, $from = 'ja') {
        return "[${from}→${to}] $text";
    }
}

# ==========================
# CLI本体
# ==========================
package LinguaBridge::CLI {
    use Moo;
    use v5.36;

    has translator => (
        is       => 'ro',
        required => 1,
        does     => 'TranslatorRole',
    );

    sub run ($self, $text, $to = 'en', $from = 'ja') {
        return $self->translator->translate($text, $to, $from);
    }
}

# ==========================
# 実行例
# ==========================
package main;

my $cli = LinguaBridge::CLI->new(
    translator => LinguaBridge::Translator::Echo->new,
);

say $cli->run('こんにちは', 'en');      # => [ja→en] こんにちは
say $cli->run('good morning', 'ja');  # => [en→ja] good morning
```

次回は「API仕様が違う翻訳サービスをどう扱うか」に進みます。CLIを壊さずに差し替えられる仕組みを育てましょう。
