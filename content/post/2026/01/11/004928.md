---
date: 2026-01-11T00:49:28+09:00
description: ここまで積み上げた「翻訳役の契約」「ラッパー」「レジストリ」は、まさにAdapterパターンそのもの。LinguaBridge翻訳CLIで、異なる翻訳APIを同じ呼び方で扱える理由を振り返ります。
draft: false
epoch: 1768060168
image: /public_images/2026/adapter-pattern-series-image.jpg
iso8601: 2026-01-11T00:49:28+09:00
tags:
  - perl
  - moo
  - cli
  - translation
  - design-patterns
  - adapter-pattern
title: '第5回-これはAdapterパターンだった！LinguaBridge翻訳CLIのまとめ'
---

[@nqounet](https://x.com/nqounet)です。

ラッパーを重ねてきた理由を明かします。実はここまで作ってきた構造は「Adapterパターン」でした。異なる翻訳APIを共通インターフェースで扱う仕組みを図とコードでまとめます。

## 前回のおさらい / 目次

{{< linkcard "/2026/01/11/004725/" >}}

{{< linkcard "/2026/01/11/005131/" >}}

## AdapterパターンとしてのLinguaBridge

```mermaid
flowchart LR
    CLI[LinguaBridge::CLI] -->|TranslatorRole| AdapterEcho[EchoAdapter]
    CLI -->|TranslatorRole| AdapterLegacy[LegacyAdapter]
    AdapterEcho --> ModernAPI[Modern SDK\ntranslate(text, to, from)]
    AdapterLegacy --> LegacyAPI[Legacy API\nconvert({text,target,source})]
```

## 完成したコード

```perl
#!/usr/bin/env perl
use v5.36;

# ==========================
# Role
# ==========================
package TranslatorRole {
    use Moo::Role;
    requires 'translate';
}

# ==========================
# 外部サービス（仮）
# ==========================
package ModernTranslationSDK {
    use Moo;
    use v5.36;
    sub translate ($self, $text, $to, $from) { "MODERN[$from→$to]: $text" }
}

package LegacyTranslationAPI {
    use Moo;
    use v5.36;
    sub convert ($self, $args) { { result => "LEGACY[$args->{source}→$args->{target}]: $args->{text}" } }
}

# ==========================
# Adapterたち
# ==========================
package LinguaBridge::Translator::ModernAdapter {
    use Moo;
    use v5.36;
    with 'TranslatorRole';
    has client => ( is => 'ro', required => 1 );
    sub translate ($self, $text, $to, $from = 'ja') {
        return $self->client->translate($text, $to, $from);
    }
}

package LinguaBridge::Translator::LegacyAdapter {
    use Moo;
    use v5.36;
    with 'TranslatorRole';
    has client => ( is => 'ro', required => 1 );
    sub translate ($self, $text, $to, $from = 'ja') {
        my $res = $self->client->convert({ text => $text, target => $to, source => $from });
        return $res->{result};
    }
}

# ==========================
# CLI（レジストリ付き）
# ==========================
package LinguaBridge::CLI {
    use Moo;
    use v5.36;

    has registry => (
        is      => 'ro',
        default => sub { {} },
    );

    has translator => (
        is       => 'rw',
        required => 1,
        does     => 'TranslatorRole',
    );

    sub switch_engine ($self, $name) {
        my $builder = $self->registry->{$name}
            or die "unknown engine: $name";
        $self->translator( $builder->() );
    }

    sub run ($self, $text, $to = 'en', $from = 'ja') {
        return $self->translator->translate($text, $to, $from);
    }
}

# ==========================
# 実行例
# ==========================
package main;

my $cli = LinguaBridge::CLI->new(
    registry => {
        modern => sub {
            LinguaBridge::Translator::ModernAdapter->new(
                client => ModernTranslationSDK->new,
            )
        },
        legacy => sub {
            LinguaBridge::Translator::LegacyAdapter->new(
                client => LegacyTranslationAPI->new,
            )
        },
    },
    translator => LinguaBridge::Translator::ModernAdapter->new(
        client => ModernTranslationSDK->new,
    ),
);

say $cli->run('設計パターンは便利', 'en');  # MODERN[ja→en]: ...
$cli->switch_engine('legacy');
say $cli->run('設計パターンは便利', 'en');  # LEGACY[ja→en]: ...
```

これでLinguaBridge翻訳CLIの全体像が完成しました。翻訳APIが増えても、アダプターを1つ足すだけでCLIの呼び出しは変わりません。まさにAdapterパターンの威力です。
