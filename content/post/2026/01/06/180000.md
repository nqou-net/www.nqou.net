---
date: 2026-01-06T18:00:00+09:00
description: CSVファイルからデータを読み込むDataReaderクラスをMooで実装。Perlのファイル操作とオブジェクト指向の基礎を学びます。
draft: false
epoch: 1767690000
image: /public_images/2026/facade-pattern-series-image.jpg
iso8601: 2026-01-06T18:00:00+09:00
tags:
  - perl
  - moo
  - csv-parsing
  - file-io
  - oop-class
title: '第2回-データを読み込もう - レポート生成ツールを作ってみよう'
---

[@nqounet](https://x.com/nqounet)です。

「レポート生成ツールを作ってみよう」シリーズの第2回です。

前回は、固定データを画面に表示するシンプルなスクリプトを作成しました。まだ読んでいない方は、先にこちらをご覧ください。

{{< linkcard "/2026/01/06/170000/" >}}

今回は、CSVファイルからデータを読み込む `DataReader` クラスを作成します。

## 今回のゴール

今回は、ファイルからデータを読み込む仕組みを作ります。これにより、スクリプトを変更せずにデータを差し替えられるようになります。

新しい概念は「ファイル読み込み」です。Perlの `open` 関数を使ってファイルを読み込み、データを配列で返すクラスを作成します。

## サンプルのCSVファイル

まずは、読み込むCSVファイルを用意しましょう。

ファイル名: `data.csv`

```csv
name,score
田中太郎,85
鈴木花子,92
佐藤一郎,78
```

1行目はヘッダー行で、2行目以降が実際のデータです。

## DataReaderクラスの作成

CSVファイルを読み込む `DataReader` クラスを作成します。

言語・バージョン: Perl v5.36以降  
外部依存: Moo

```perl
package DataReader {
    use Moo;
    use v5.36;

    has file_path => (is => 'ro', required => 1);

    sub read($self) {
        open my $fh, '<', $self->file_path
            or die "Cannot open file: $!";

        my $header_line = <$fh>;
        chomp $header_line;
        my @headers = split /,/, $header_line;

        my @data;
        while (my $line = <$fh>) {
            chomp $line;
            my @values = split /,/, $line;
            my %row;
            for my $i (0 .. $#headers) {
                $row{$headers[$i]} = $values[$i];
            }
            push @data, \%row;
        }

        close $fh;
        return \@data;
    }
}
```

このクラスの特徴は以下のとおりです。

- `file_path` 属性でCSVファイルのパスを受け取る
- `read` メソッドでファイルを読み込み、ハッシュの配列を返す
- 1行目をヘッダーとして扱い、各列の名前をキーにする
- `split` を使ってカンマ区切りでデータを分割する

## 完成コード

前回のスクリプトを改良して、`DataReader` クラスを使うようにします。

言語・バージョン: Perl v5.36以降  
外部依存: Moo

```perl
#!/usr/bin/env perl
use v5.36;
use Moo;

# DataReaderクラス
package DataReader {
    use Moo;
    use v5.36;

    has file_path => (is => 'ro', required => 1);

    sub read($self) {
        open my $fh, '<', $self->file_path
            or die "Cannot open file: $!";

        my $header_line = <$fh>;
        chomp $header_line;
        my @headers = split /,/, $header_line;

        my @data;
        while (my $line = <$fh>) {
            chomp $line;
            my @values = split /,/, $line;
            my %row;
            for my $i (0 .. $#headers) {
                $row{$headers[$i]} = $values[$i];
            }
            push @data, \%row;
        }

        close $fh;
        return \@data;
    }
}

# メイン処理
package main;

my $reader = DataReader->new(file_path => 'data.csv');
my $data = $reader->read;

# レポートを表示
say '=== 成績レポート ===';
say '';

for my $row (@$data) {
    say "$row->{name}: $row->{score}点";
}

say '';
say '=== レポート終了 ===';
```

実行方法:
```bash
perl report.pl
```

出力例:
```
=== 成績レポート ===

田中太郎: 85点
鈴木花子: 92点
佐藤一郎: 78点

=== レポート終了 ===
```

前回と同じ出力になりますが、データはCSVファイルから読み込んでいます。`data.csv` の内容を変更すれば、スクリプトを修正せずに異なるデータでレポートを生成できます。

## まとめ

- CSVファイルからデータを読み込む `DataReader` クラスを作成した
- Perlの `open` 関数でファイルを開き、`split` でカンマ区切りデータを分割した
- データをハッシュの配列として返すことで、列名でアクセスできるようにした

## 次回予告

次回は、読み込んだデータを加工する `DataProcessor` クラスを作成します。平均点の計算や、点数による並べ替えなど、データを集計・整形する処理を追加します。お楽しみに。

{{< linkcard "/2026/01/06/190000/" >}}
