---
title: "第4回-Mooで覚えるオブジェクト指向プログラミング"
draft: true
tags:
  - perl
  - moo
  - object-oriented
description: "スパゲティコードをオブジェクト指向で改善！Messageクラスを作成します"
---

[@nqounet](https://twitter.com/nqounet)です。

第3回では、配列だけで最小限のチャットを作り、そのコードが「スパゲティコード」になってしまう問題点を確認しました。投稿者とメッセージが別々の配列に散らばっていると、機能追加のたびに複数の場所を修正しなければならず、コードが複雑になっていく一方でしたね。

今回は、このスパゲティコードをオブジェクト指向で改善していきます。「メッセージ」をクラスにすることで、どれだけコードがスッキリするか体験してみましょう。

## メッセージを「もの」として考える

第3回のコードでは、1つの投稿を表現するのに2つの配列（`@authors`と`@messages`）を使っていました。

しかし、よく考えてみてください。私たちが「投稿」について話すとき、「投稿者」と「メッセージ内容」は切り離せないものですよね。「太郎さんの投稿」と言えば、「太郎」という投稿者と、その人が書いた内容がセットで頭に浮かびます。

オブジェクト指向では、このように「関連するデータをまとめて1つのもの（オブジェクト）として扱う」という考え方をします。

投稿者とメッセージ内容を別々に管理するのではなく、「メッセージ」という1つのまとまりとして扱えば、コードがずっと分かりやすくなるはずです。

## Messageクラスを作ろう

では、Mooを使って「Message」クラスを作ってみましょう。

```perl
# Messageクラスの定義
package Message {
    use Moo;
    has author => (is => 'rw');
    has body   => (is => 'rw');
};

# Messageオブジェクトを作成
my $msg1 = Message->new(author => '太郎', body => 'こんにちは！');
my $msg2 = Message->new(author => '花子', body => 'はじめまして！');

# 内容を表示
print $msg1->author . ': ' . $msg1->body . "\n";
print $msg2->author . ': ' . $msg2->body . "\n";
```

実行すると、以下のように表示されます。

```
太郎: こんにちは！
花子: はじめまして！
```

たったこれだけのコードで、投稿者とメッセージ内容が1つにまとまりました。

`has author`と`has body`で、Messageクラスが持つ2つのプロパティ（属性）を定義しています。`Message->new(...)`でオブジェクトを作成すると、それぞれのオブジェクトが自分専用の`author`と`body`を持つことになります。

第3回のコードと比べてみてください。`$authors[0]`と`$messages[0]`という「バラバラのデータ」ではなく、`$msg1->author`と`$msg1->body`という「1つのオブジェクトが持つデータ」として扱えるようになりました。

## クラスとオブジェクトの関係

ここで、オブジェクト指向の重要な概念を1つ押さえておきましょう。「クラス」と「オブジェクト」の関係です。

### クラスは「設計図」

`package Message { ... }`で定義した部分がクラスです。クラスは「こういうプロパティを持ち、こういう操作ができる」という設計図のようなものです。

Messageクラスの設計図には「authorとbodyというプロパティを持つ」と書かれています。しかし、設計図だけでは実際にデータを入れることはできません。

### オブジェクトは「設計図から作った実体」

`Message->new(...)`で作成されるのがオブジェクトです。オブジェクトは「インスタンス」とも呼ばれます。

設計図（クラス）を元に、実際に使えるものを作り出す。これが`new`メソッドの役割です。

### 1つのクラスから複数のオブジェクトを作れる

先ほどのコードでは、`$msg1`と`$msg2`という2つのオブジェクトを作りました。どちらもMessageクラスという同じ設計図から作られていますが、中に入っているデータは別々です。

`$msg1->author`は「太郎」、`$msg2->author`は「花子」。それぞれのオブジェクトが独立したデータを持っているのです。

たい焼きの型で例えると分かりやすいかもしれません。たい焼きの「型」がクラス、その型で焼いた「たい焼き」がオブジェクトです。1つの型から何個でもたい焼きを作れますし、中に入れるあんこ（データ）も1つ1つ違っていて構いません。

## まとめ

今回は、第3回のスパゲティコードをオブジェクト指向で書き直しました。

- 「投稿者」と「メッセージ内容」を1つのオブジェクトにまとめた
- Mooの`has`でプロパティを定義した
- クラスは「設計図」、オブジェクトは「設計図から作った実体」である
- 1つのクラスから複数のオブジェクトを作成できる

データを1つのオブジェクトにまとめることで、コードがスッキリし、何を扱っているのかが明確になりました。これがオブジェクト指向の基本的な考え方です。

次回は、このMessageクラスにさらに改良を加えていきます。「このプロパティは書き換えられたくない」という場合にどうするか、カプセル化について学びましょう。
