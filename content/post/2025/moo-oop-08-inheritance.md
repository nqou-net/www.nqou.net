---
title: "第8回-Mooで覚えるオブジェクト指向プログラミング"
draft: true
tags:
  - perl
  - moo
  - object-oriented
description: "extendsを使った継承を学び、MessageクラスからThreadクラスを作成します"
---

[@nqounet](https://twitter.com/nqounet)です。

第7回では、複数のメッセージを管理するBoardクラスを作成し、メソッドで投稿の追加・一覧表示・投稿数の取得といった機能を実装しました。これでシンプルな掲示板の形ができましたね。

さて、ここまで作ってきた掲示板は、すべてのメッセージがフラットに並んでいます。しかし、実際の掲示板では「スレッド」という仕組みがよく使われますよね。話題ごとにスレッドを立てて、その中で会話を続けていく形式です。

今回は、このスレッド機能を追加するために「継承」という概念を学びます。既存のMessageクラスを活かして、新しいThreadクラスを効率よく作っていきましょう。

## MessageとThreadの共通点

スレッドを作るにあたって、まずMessageクラスとThreadクラスを比較してみましょう。

Messageクラスが持っているプロパティを思い出してください。

- author（投稿者）
- body（本文）
- posted_at（投稿日時）

では、スレッドに必要な情報は何でしょうか。

- author（誰がスレッドを立てたか）
- body（スレッドの最初の投稿内容）
- posted_at（スレッドを立てた日時）
- title（スレッドのタイトル）

見比べてみると、author、body、posted_atは共通していて、スレッドにはtitleが追加されているだけです。つまり、スレッドは「タイトル付きのメッセージ」と言えます。

このような場合、Messageクラスのコードをコピペして、titleプロパティを追加したThreadクラスを作ることもできます。しかし、それではコードの重複が生まれてしまいます。もしMessageクラスにバグがあった場合、Threadクラスも同じように修正しなければなりません。

オブジェクト指向には、このような問題を解決する「継承」という仕組みがあります。

## 継承とは

継承とは、既存のクラス（親クラス）の機能を引き継いで、新しいクラス（子クラス）を作る仕組みです。

親クラスが持っているプロパティやメソッドを、子クラスはそのまま使うことができます。子クラスでは、親クラスにない機能だけを追加すればよいのです。

継承を使うと、以下のようなメリットがあります。

- コードの重複を避けられる
- 親クラスを修正すれば、子クラスにも自動的に反映される
- 「AはBの一種である」という関係を明確に表現できる

今回の例では、「スレッドはメッセージの一種である」という関係を継承で表現します。スレッドはメッセージが持つすべての機能を引き継ぎつつ、タイトルという追加の情報を持つわけです。

## extendsで継承する

Mooでは、`extends`を使って継承を行います。

では、MessageクラスとThreadクラスを実装してみましょう。Messageクラスは第6回で作成したものとほぼ同じです。

```perl
# 親クラス（Message）
package Message {
    use Moo;
    
    has author    => (is => 'ro', required => 1);
    has body      => (is => 'rw', required => 1);
    has posted_at => (is => 'ro', builder => '_build_posted_at');
    
    sub _build_posted_at {
        my $self = shift;
        return time();
    }
    
    sub show {
        my $self = shift;
        print $self->author . ': ' . $self->body . "\n";
    }
};

# 子クラス（Thread）
package Thread {
    use Moo;
    extends 'Message';  # Messageを継承
    
    has title => (is => 'ro', required => 1);
    
    sub show {
        my $self = shift;
        print "【" . $self->title . "】\n";
        print $self->author . ': ' . $self->body . "\n";
    }
};
```

Threadクラスのポイントは`extends 'Message'`の一行です。これにより、ThreadクラスはMessageクラスを継承します。

Threadクラスで定義しているのは、titleプロパティとshowメソッドだけです。author、body、posted_atといったプロパティは、親クラスであるMessageから自動的に引き継がれます。

showメソッドは親クラスにもありますが、子クラスで同じ名前のメソッドを定義すると、子クラスのメソッドが優先されます。これを「メソッドのオーバーライド」と呼びます。Threadクラスのshowメソッドでは、タイトルも一緒に表示するようにしています。

## 動かしてみよう

では、実際にThreadクラスを使ってみましょう。

```perl
# スレッドを作成
my $thread = Thread->new(
    author => '太郎',
    body   => 'Perlのオブジェクト指向について語りましょう',
    title  => 'Perl OOP雑談スレ'
);

# 親クラスのプロパティにアクセスできる
print "投稿者: " . $thread->author . "\n";
print "タイトル: " . $thread->title . "\n";

# showメソッドを呼び出す
$thread->show;
```

実行すると、以下のように表示されます。

```
投稿者: 太郎
タイトル: Perl OOP雑談スレ
【Perl OOP雑談スレ】
太郎: Perlのオブジェクト指向について語りましょう
```

ThreadクラスはMessageクラスを継承しているので、`$thread->author`のように親クラスのプロパティにもアクセスできます。Threadクラスで定義していないのに、ちゃんと動作していますよね。

これが継承の力です。既存のクラスの機能を引き継ぎつつ、新しい機能を追加できる。コードの重複なく、効率的に新しいクラスを作ることができるのです。

## まとめ

今回は、継承を使ってMessageクラスからThreadクラスを作成しました。

- 継承は親クラスの機能を子クラスに引き継ぐ仕組みである
- Mooでは`extends 'クラス名'`で継承を行う
- 子クラスは親クラスのプロパティとメソッドをそのまま使える
- 子クラスで独自のプロパティを追加できる
- 同じ名前のメソッドを定義すると、子クラスのメソッドが優先される（オーバーライド）

継承を使うことで、「スレッドはメッセージの一種である」という関係をコードで表現できました。共通部分は親クラスにまとめ、差分だけを子クラスで定義する。これにより、コードの重複を避けながら、新しい機能を追加できるのです。

次回は、Userクラスを作成し、「委譲」という継承とは別のコード再利用の仕組みを学びます。
