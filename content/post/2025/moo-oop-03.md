---
title: "第3回-Mooで覚えるオブジェクト指向プログラミング"
draft: true
tags:
  - perl
  - object-oriented
  - programming
description: "チャットアプリを題材に、Messageクラスを設計します"
---

[@nqounet](https://twitter.com/nqounet)です。

前回は、Mooのコードを1行ずつ解説しました。`package`、`has`、`sub` の役割が分かってきたところで、今回からは実際のアプリケーションを作りながら学んでいきましょう。

## チャットを作ってみよう

オブジェクト指向を学ぶには、実際に何かを作ってみるのが一番です。

今回から数回にわたって、シンプルなチャットアプリを作っていきます。

### まずはゴールを決める

最終的には、こんなことができるチャットを目指します。

- メッセージを投稿できる
- 誰が投稿したか分かる
- いつ投稿されたか分かる

いきなり全部作るのは大変なので、まずは「メッセージ」の部分から考えていきましょう。

## メッセージに必要なものは？

チャットのメッセージには、どんな情報が必要でしょうか。

実際のチャットアプリを思い浮かべてみてください。メッセージには、だいたい以下のような情報が表示されています。

### 内容、投稿者、時刻

- 内容（content）— 実際のメッセージ本文
- 投稿者（author）— 誰が投稿したか
- 時刻（timestamp）— いつ投稿されたか

この3つの情報があれば、シンプルなメッセージとして成り立ちます。

オブジェクト指向では、このような「関連するデータのまとまり」をクラスとして設計します。

## Messageクラスを設計する

それでは、メッセージを表す `BBS::Message` クラスを設計してみましょう。

```perl
package BBS::Message {
    use Moo;

    has content   => (is => 'ro', required => 1);
    has author    => (is => 'ro', required => 1);
    has timestamp => (is => 'ro', default => sub { time });
};
```

ここで新しいことがいくつか出てきました。1つずつ見ていきましょう。

まず、クラス名が `BBS::Message` になっています。`BBS::` という部分は、「BBS（掲示板）に関するクラス」であることを示す名前空間です。実際のアプリケーションでは、このように関連するクラスをグループ化することがよくあります。

次に、`required => 1` という指定があります。これは「このプロパティは必須」という意味です。`content` と `author` には必ず値を渡す必要があります。

最後に、`default => sub { time }` があります。これは「デフォルト値を設定する」という意味です。`timestamp` は指定しなければ、オブジェクトを作った時刻が自動的に設定されます。

## プロパティを定義する

前回、`is => 'rw'` と `is => 'ro'` について少し触れました。今回のコードでは、すべてのプロパティに `is => 'ro'` を使っています。

### is => 'ro' で変更禁止

`ro` は「Read-Only（読み取り専用）」の略です。一度設定した値は、後から変更できません。

メッセージの内容を考えてみてください。投稿した後に、勝手に内容が書き換わったら困りますよね。投稿者が変わるのも、時刻が変わるのもおかしいです。

そういうデータは `ro` にして、変更を禁止するのが安全です。

では、実際にメッセージを作ってみましょう。

```perl
use BBS::Message;

my $message = BBS::Message->new(
    content => 'こんにちは！',
    author  => 'nqounet',
);

print $message->content;    # こんにちは！
print $message->author;     # nqounet
print $message->timestamp;  # 1735484402（UNIXタイムスタンプ）
```

`new` メソッドに `content` と `author` を渡してオブジェクトを作成しています。`timestamp` は省略していますが、自動的に現在時刻が設定されます。

`required => 1` を指定した `content` や `author` を省略すると、エラーになります。必須のデータが欠けたオブジェクトは作れないようになっているのです。

## まとめ

今回は、チャットアプリを題材に `BBS::Message` クラスを設計しました。

- チャットのメッセージには「内容」「投稿者」「時刻」が必要である
- `is => 'ro'` — 変更禁止（読み取り専用）のプロパティを定義する
- `required => 1` — 必須のプロパティを指定する
- `default => sub { ... }` — デフォルト値を設定する

次回は、このMessageクラスにメソッドを追加して、実際に動かしてみます。
