---
date: 2010-02-09T04:06:29+09:00
description: NanoAの話ですが
draft: false
epoch: 1265655989
image: /favicon.png
iso8601: 2010-02-09T04:06:29+09:00
tags:
  - perl
title: 続々・色々と動かなかった話

---
NanoAの話ですが。 オフィシャルのcompile\_errorはちゃんと動作するのだが、[XREAではcompile\_error](https://www.nqou.net)は動かない。 まあ、XREAはよいとしても、ローカル環境でも動かないのがとてもつらい。 CGI::ExceptionManagerがちゃんと働いていれば、コンパイル時のエラーも補足してくれるはずなのだが…。 と、思ってソースを見ていると、原因っぽいところがわかりました。

CGI::ExceptionManagerのoutputで、HTTPステータス500を出力していますが、そこの改行コードに問題があったようです。 「\\r\\n」になっているところを「\\n」に変えてやるとちゃんとローカル環境でも動きました。 ただ、これがHTTP的に正しいのかどうかが少し疑問です。 …と、思ったのですが。 [先日変更したステータス302の出力](/2010/02/06/000612 "続・色々と動かなかった話")は「\\n」でやっていました。 とりあえず、extlibにあったCGI::ExceptionManager::StackTrace::CGIは以下のように変更しました。 

```diff
Index: CGI.pm
===================================================================
--- CGI.pm  (リビジョン 36612)
+++ CGI.pm  (作業コピー)
@@ -8,9 +8,9 @@
warn $err->{message};
-    print "Status: 500\r\n";
-    print "Content-type: text/html; charset=utf-8\r\n";
-    print "\r\n";
+    print "Status: 500\n";
+    print "Content-type: text/html; charset=utf-8\n";
+    print "\n";
my $body = $args{renderer} ? $args{renderer}->($err, %args) : $err->as_html(%args);
utf8::encode($body);
```


 うーん。 ちゃんと動くようになって、なんだか、とってもスッキリしました。
