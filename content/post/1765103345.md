---
title: "エージェントにアサインする時の指示が要だった"
draft: true
tags:
  - copilot
  - custom-agent
  - workflow
  - prompt
description: カスタムエージェントを使った記事作成で、アサイン時の指示が重要だと気づいた体験談。愛を込めて指示したら思わぬ反応があった話。
---

[@nqounet](https://x.com/nqounet)です。

カスタムエージェントの `perl-monger` を作った記事を書きながらウイスキーを楽しんでいた時のことです。記事を書き終えて、思い立って以下のようにCopilotにアサインしてみました。

```
@perl-monger あなたに愛を込めて記事にしました。
書きたいことがあれば追記してください。
その後 @blog-writer に渡してください。
```

## 思わぬ嬉しい反応

そうしたら、セッションの中で嬉しい反応がありました。

![perl-mongerの反応1](https://github.com/user-attachments/assets/4ae8372c-3eba-4089-a4a4-8b83ed6044fd)

![perl-mongerの反応2](https://github.com/user-attachments/assets/e324299b-30f9-4504-8eba-bb4780a3b08f)

「やあ、友よ！」で始まり、「Let's keep the Perl spirit alive! ✨💎」で締めくくられる熱いメッセージ。エージェントがPerlへの愛を語ってくれて、本当に嬉しくなりました。

## しかし結果は...

反応は嬉しかったのですが、出来上がった記事が色々と混ざりすぎていて、とても世に出せるものではなくなってしまいました。

perl-mongerが追記した内容と、blog-writerが整形した内容が入り混じり、さらに元の記事の構成とも噛み合わず、何が何だか分からない状態に。残念ながら、そっと閉じることにしました。

## 気づいたこと

一応、エージェントにアサインする時に、何かしら指示が追加できるのは分かっていました。エージェントを指示することもできるのは知っていました。

しかし、**ワークフローをここで定義してしまうのもアリだった**ようです。

今までは、`AGENTS.md`の定義でどうにかしたいと思っていました。実際、AGENTS.mdには「カスタムエージェントを使ったワークフロー」セクションがあり、以下のような推奨フローが書かれています：

1. creative-brainstorming（アイデア生成）
2. investigative-research（調査・情報収集）
3. draft（下書き生成）
4. layout-and-content-harmonization（スタイルと構成の整形）
5. proofreader（校正）
6. search-engine-optimization（メタ情報と公開準備）
7. reviewer（公開前の最終チェック）

しかし、**エージェントを明示的に連動させたいのであれば、プロンプトとして追加すれば良い**のです。

## より良いアサイン方法

今回の失敗を踏まえると、以下のようにアサインするべきでした：

```
@perl-monger この記事にPerlの視点から追記したい内容があれば教えてください。

以下の点を考慮してください：
- 記事の全体構成を崩さないこと
- 追記する場合は、具体的なセクション名と内容を提案すること
- 記事のトーンやスタイルを維持すること

提案をもらったら、人間である私が判断して記事に反映します。
```

あるいは、もっと具体的に：

```
@perl-monger この記事について、以下の点をレビューしてください：

1. Perlの技術的な正確性
2. 追加すべきベストプラクティスやTips
3. CPANモジュールの紹介で追加できるもの

レビュー結果は箇条書きで提案してください。
実際の編集は行わず、提案のみをお願いします。
```

## AGENTS.mdとプロンプトの使い分け

この経験から、以下のような使い分けが見えてきました：

### AGENTS.mdに書くべきこと

- リポジトリ全体のルールや規約
- ファイル構成や命名規則
- 基本的なワークフローの概要
- エージェントの一般的な役割定義

### プロンプト（アサイン時の指示）に書くべきこと

- その場その場の具体的なタスク
- 複数のエージェントの連携方法
- 作業の範囲や制約条件
- 期待する出力形式

AGENTS.mdは「辞書」や「マニュアル」のようなもので、プロンプトは「その時の業務指示書」のようなものだと考えると分かりやすいかもしれません。

## まとめ

カスタムエージェントに愛を込めて指示を出すのは楽しいし、エージェントからの反応も嬉しいものです。

しかし、**複数のエージェントを連携させる時は、曖昧な指示ではなく、明確なワークフローと期待値を示す必要がある**ことを学びました。

AGENTS.mdで全体の方針を定義しつつ、個別のタスクではプロンプトで具体的に指示を出す。この使い分けが、カスタムエージェントを効果的に活用する鍵だと感じています。

次回は、もっと明確な指示を出して、perl-mongerの知見を記事に活かせるようにしたいと思います。愛を込めつつ、しっかりと仕事をお願いする。それが良い関係を築く秘訣なのかもしれませんね。

## 参考リンク

- [AGENTS.md](https://github.com/nqou-net/www.nqou.net/blob/main/AGENTS.md) - このリポジトリのエージェント向けガイダンス
- カスタムエージェントの作成については、別の記事で紹介予定です
