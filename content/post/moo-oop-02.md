---
title: "第2回-データとロジックをまとめよう - Mooで覚えるオブジェクト指向プログラミング"
draft: true
tags:
  - perl
  - moo
  - object-oriented
description: "グローバル変数だらけのスパゲティコードを卒業しませんか？Mooのhasで属性を、subでメソッドを定義して、データとロジックを1つのクラスにまとめる方法を初心者向けにやさしく解説します。"
---

[@nqounet](https://x.com/nqounet)です。

「Mooで覚えるオブジェクト指向プログラミング」シリーズの第2回です。

前回は、Mooを使った簡単なコードを動かしてみました。まだ読んでいない方は、先にこちらをご覧ください。

{{< linkcard "/2021/10/31/191008/" >}}

今回は、`has`と`sub`を使って、データとロジックをまとめる方法を学びます。

## スパゲティコードの問題

プログラミングを始めたばかりの頃、こんなコードを書いたことはありませんか？

掲示板のプログラムを例に考えてみましょう。投稿データを管理するために、`$message_content`、`$message_author`、`$message_date`のようなグローバル変数をたくさん作ってしまうケースです。

変数がバラバラに散らばっていると、どの変数がどのデータに関連しているのか分かりにくくなります。また、投稿を表示する処理も、別の場所に書かれていることが多いです。

このように、データとロジックがあちこちに散らばっているコードを「スパゲティコード」と呼びます。麺が絡み合っているように、コードが複雑に絡み合っている状態です。

オブジェクト指向プログラミングを使えば、この問題を解決できます。

## `has`で属性を定義する

まずは、投稿の内容を管理する`Message`クラスを作ってみましょう。

```perl
package Message {
    use Moo;
    has content => (is => 'rw');
};

my $msg = Message->new(content => 'こんにちは');
print $msg->content;  # こんにちは
```

`has`は、クラスに属性を追加するための仕組みです。上記のコードでは、`Message`クラスに`content`という属性を定義しています。

`is => 'rw'`は、この属性が読み書き可能（read-write）であることを示しています。

これで、投稿の内容は`Message`オブジェクトの中にまとめられました。グローバル変数を使う必要はありません。

## `sub`でメソッドを定義する

次に、投稿を表示する処理もクラスの中に入れてみましょう。

```perl
package Message {
    use Moo;
    has content => (is => 'rw');

    sub show {
        my $self = shift;
        print "投稿: " . $self->content . "\n";
    }
};

my $msg = Message->new(content => 'こんにちは');
$msg->show;  # 投稿: こんにちは
```

`sub`はPerlでおなじみのサブルーチン定義です。クラスの中で定義したサブルーチンは「メソッド」と呼ばれます。

メソッドの最初の引数`$self`には、そのオブジェクト自身が渡されます。`$self->content`で、オブジェクトの`content`属性にアクセスできます。

これで、データ（content属性）とロジック（showメソッド）が`Message`クラスの中にまとまりました。

## まとめ

- `has`はクラスに属性を追加する仕組みである
- `sub`はクラスにメソッドを追加する仕組みである
- データとロジックを1つのクラスにまとめることで、スパゲティコードを防ぐ
- メソッドの第1引数`$self`はオブジェクト自身を指す

## 次回予告

次回は、オブジェクトを複数作成して、それぞれが独立したデータを持つことを確認します。オブジェクト指向の本領発揮です。お楽しみに。
