<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Docker on nqou.net</title>
        <link>https://www.nqou.net/tags/docker/</link>
        <description>Recent content in Docker on nqou.net</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ja</language>
        <lastBuildDate>Sat, 16 Feb 2019 17:21:05 +0900</lastBuildDate><atom:link href="https://www.nqou.net/tags/docker/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>キッカソン #3 に参加してきました</title>
        <link>https://www.nqou.net/2019/02/16/172105/</link>
        <pubDate>Sat, 16 Feb 2019 17:21:05 +0900</pubDate>
        
        <guid>https://www.nqou.net/2019/02/16/172105/</guid>
        <description>&lt;p&gt;先週土曜日（もう一週間も経ってしまった。。。）から一泊二日で「Perl入学式の修学旅行」という別名を持つ「キッカソン」へ行ってきました。 イベント自体は第3回ということですが、私は今回が初参加です。 {{&amp;lt; tweet user=&amp;ldquo;nqounet&amp;rdquo; id=&amp;ldquo;1094094702880542722&amp;rdquo; &amp;gt;}} じわじわ集まるのかと思っていたら、皆さん意外と到着していて驚きました（失礼） ハッカソンは、広間でワイワイとやってました。 あっちこっちで色んな話が飛び交っているのをなんとなく聞いていると、時々興味ある話が出ていたりするのでちゃっかりメモしたりしました。 {{&amp;lt; tweet user=&amp;ldquo;nqounet&amp;rdquo; id=&amp;ldquo;1094438379112919041&amp;rdquo; &amp;gt;}} 私はというと、数年前に Resque というモジュールを使って書いたジョブキューのサンプルプログラムがあったのですが、これを Docker を使った実装に変更するのをやってました。 数年前のプログラムでは、 Proclet と Test::RedisServer を使って動かしていたのですが、コンテナを使った実装に変更したいなと。 本当のことを言うと、 Perl の自動テストで Test::Mysqld を使用しているのをコンテナを使ったテストに書き換えたい、と思っていたのです。 この話は、 YAPC::Tokyo で [@onk](&lt;a class=&#34;link&#34; href=&#34;https://twitter.com/onk&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://twitter.com/onk&lt;/a&gt;) さんがチラッと話していたと思うのですが、開発中は DB のコンテナを使うのに、自動テストの時はアプリのコンテナを使っているのが微妙だな、という話です。 それがなければアプリのコンテナサイズも少しは小さくなるのかなと（副産物的な話ですが）。 実は memcached や Elasticsearch でも同じ問題があったのですが、この時はかなりのサイズダウンができたんですよね。 確か対策前はコンテナサイズが 2GB 近くあった気がします。 今は 1GB ちょっとになっています。 キッカソンの唯一の問題だったのは、ネットワーク環境です。 元々 Wi-Fi はないという話だったので通信自体はテザリングで問題ないのですが、 Docker のイメージを扱うのは時間がかかりました。。。 かつ、ダウンロードが途中で止まってしまうことも多かったので、比較的軽量な redis:alpine のイメージを使ってできることをやっていた感じです。 成果物はこちら。 - [nqounet/try-p5-resque: use Resque;](&lt;a class=&#34;link&#34; href=&#34;https://github.com/nqounet/try-p5-resque&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/nqounet/try-p5-resque&lt;/a&gt;) 新たに書く `docker-compose` の設定ファイルは `version: &amp;ldquo;3&amp;rdquo;` で書くようにしているのですが、起動するコンテナの数を指定をすると `docker-compose` では指定が無視されてしまう。 - - 手軽さを求めて `docker-compose` を使っているのもあって、今のところはミスマッチ感があるな。。。ということで、起動時にコンテナの数をオプションとして指定するようにしました。&lt;/p&gt;</description>
        </item>
        <item>
        <title>以前は動いていた Dockerfile で permission denied が出るようになった話</title>
        <link>https://www.nqou.net/2018/06/12/110204/</link>
        <pubDate>Tue, 12 Jun 2018 11:02:04 +0900</pubDate>
        
        <guid>https://www.nqou.net/2018/06/12/110204/</guid>
        <description>&lt;p&gt;Mac に入っている docker を stable から edge に変えたところ、以前は build できていたはずの Dockerfile が build に失敗するようになった。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker-compose build
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Building webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 1/9 : FROM perl:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; dbada67dc42d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 2/9 : RUN useradd -m -s /bin/bash appuser     &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; cpanm Carmel --notest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; Using cache
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; 6f9065cda747
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 3/9 : USER appuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; Using cache
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; c68da1175f01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 4/9 : RUN mkdir -p ~/webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; Running in ec4f449376a8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERROR: Service &lt;span class=&#34;s1&#34;&gt;&amp;#39;webapp&amp;#39;&lt;/span&gt; failed to build: OCI runtime create failed: container_linux.go:348: starting container process caused &lt;span class=&#34;s2&#34;&gt;&amp;#34;chdir to cwd (\&amp;#34;/root\&amp;#34;) set in config.json failed: permission denied&amp;#34;&lt;/span&gt;: unknown
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;たまたまタイミングがそうだっただけで、実際には正しくない書き方だったのかもしれないと思って、より堅実そうな書き方に変更した。&lt;/p&gt;</description>
        </item>
        <item>
        <title>DockerでHerokuでMojoliciousが動いたぞ!!!（改定版）</title>
        <link>https://www.nqou.net/2017/12/13/103356/</link>
        <pubDate>Wed, 13 Dec 2017 10:33:56 +0900</pubDate>
        
        <guid>https://www.nqou.net/2017/12/13/103356/</guid>
        <description>&lt;p&gt;（追記） この記事で書いていた Dockerfile が動かなくなっていたので動くように修正した記事を書きました。 - [以前は動いていた Dockerfile で permission denied が出るようになった話 | nqou.net](/2018/06/12/110204/) （追記ここまで） この記事は、 [Perl Advent Calendar 2017](&lt;a class=&#34;link&#34; href=&#34;https://qiita.com/advent-calendar/2017/perl&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://qiita.com/advent-calendar/2017/perl&lt;/a&gt;) の 13 日目の記事です。 昨日は [sago35](&lt;a class=&#34;link&#34; href=&#34;https://qiita.com/sago35&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://qiita.com/sago35&lt;/a&gt;) さんの 「[Strawberry Perl に Minilla をインストールする](&lt;a class=&#34;link&#34; href=&#34;https://qiita.com/sago35/items/9479ef482880fab4ee7c&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://qiita.com/sago35/items/9479ef482880fab4ee7c&lt;/a&gt;)」でした。 この記事のパッチがあたって、 CPAN からインストールできるようになったようです。 これで、 Windows + Strawberry Perl な方も安心して使えますね。 - [Minilla - CPAN module authoring tool - metacpan.org](&lt;a class=&#34;link&#34; href=&#34;https://metacpan.org/pod/Minilla&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://metacpan.org/pod/Minilla&lt;/a&gt;) ちょっとしたものを作り始める時でも Minilla で雛形を作ってから始めると色々と便利ですよね。 最近はあまり使っていなかったので、この機会にまた使い始めようと思います。 ## Docker で動いている Perl で作ったアプリを Heroku で公開する 実は少し前に「[DockerでHerokuでMojoliciousが動いたぞ!!!](/2017/12/03/012037)」というのを書いてしまっていて、これを少し改善してアドベントカレンダーのネタにしようと思います。 Heroku で Perl のプログラムを動かすには buildpack を使えばよいのですが、[少しコツがいる](/2017/12/02/170342)のです。 しかし、2年ほど前から Heroku でもコンテナを動かすことができるようになっており、最近ではインターフェイスも改善されていて、比較的簡単に公開できるようになっています。 なので、コンテナを使って Perl のアプリを作って、それを Heroku で公開する、というのが今後しばらくは良さそうかなと思います。 ## Heroku をコマンドラインインターフェイスで操作する さて、 heroku を使う時はコマンドラインツールを使うと便利です。 Mac な方は [Homebrew](&lt;a class=&#34;link&#34; href=&#34;https://brew.sh/index&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://brew.sh/index&lt;/a&gt;_ja.html) を使って `brew install heroku` が手軽だと思います。 Windows な方にも用意されているようなので使ってみてください。私は使ったことがないので使用感についてはわかりません。 - 基本的な使い方はググれば色々と出てくると思いますので省略します。幾つか丁寧そうな記事を貼っておきます。 - [Heroku初心者がHello, Herokuをしてみる - Qiita](&lt;a class=&#34;link&#34; href=&#34;https://qiita.com/Arashi/items/b2f2e01259238235e187&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://qiita.com/Arashi/items/b2f2e01259238235e187&lt;/a&gt;) - [コマンドでHerokuを操作する Heroku CLI のインストール - ゼロからはじめるWEBプログラミング入門](&lt;a class=&#34;link&#34; href=&#34;http://blog.w-hippo.com/entry/2017/01/29/143550&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://blog.w-hippo.com/entry/2017/01/29/143550&lt;/a&gt;) ## 事前の準備 一つのプロジェクトを作るところをイメージしながら進めていきます。 ソースコードは git で管理することにします。 まずは、プロジェクトのディレクトリを作成しましょう。 また、 Heroku では現在は Volume をマウントする方式には対応していないので、 COPY コマンドを使います。細かい説明は省きますが、 COPY する必要があるファイルだけをまとめておくと便利だと思います。 ここでは、 COPY するファイル群を webapp というディレクトリに入れておくことにします。 では、ターミナルを操作していきます。&lt;/p&gt;</description>
        </item>
        <item>
        <title>ローカルでの開発は docker-compose を使うと楽だった</title>
        <link>https://www.nqou.net/2017/12/03/025713/</link>
        <pubDate>Sun, 03 Dec 2017 02:57:13 +0900</pubDate>
        
        <guid>https://www.nqou.net/2017/12/03/025713/</guid>
        <description>&lt;p&gt;さっきの記事を書いて面倒だなと思ったので、ローカルの開発時は &lt;code&gt;docker-compose&lt;/code&gt; を使えば楽かなと思ってやってみた。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;carton exec -- morbo myapp.pl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;このファイルからみると、 &lt;code&gt;myapp.pl&lt;/code&gt; の場所が違うので直感的ではないけれど、 &lt;code&gt;COPY&lt;/code&gt; で &lt;code&gt;.git&lt;/code&gt; までコピーされているのを見ると、アプリに必要なファイルだけをコピーするのが良いんじゃないか、と思った次第。&lt;/p&gt;</description>
        </item>
        <item>
        <title>DockerでHerokuでMojoliciousが動いたぞ!!!</title>
        <link>https://www.nqou.net/2017/12/03/012037/</link>
        <pubDate>Sun, 03 Dec 2017 01:20:37 +0900</pubDate>
        
        <guid>https://www.nqou.net/2017/12/03/012037/</guid>
        <description>&lt;p&gt;久しぶりに Heroku を使ってみたら、いつの間にかコンテナも使えるようになっていた。&lt;/p&gt;
&lt;p&gt;というくらいに全然 Heroku を使っていなかった。&lt;/p&gt;
&lt;p&gt;正確に言うと、 Heroku で動かしているアプリはあるけど、ずっと動かしたままだったので、ダッシュボードを見ることがなかった、という感じ。&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
