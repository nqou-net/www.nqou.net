[{"content":"Perlでのコマンドライン引数処理 - Getopt::Long コマンドラインツールを作る際、引数処理は避けて通れません。Getopt::Longは、Perlの標準モジュールで、強力で柔軟な引数解析を提供します。\nGetopt::Long の基本 シンプルな例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use Getopt::Long; use strict; use warnings; my $verbose = 0; my $output = \u0026#39;\u0026#39;; my $count = 10; GetOptions( \u0026#39;verbose\u0026#39; =\u0026gt; \\$verbose, \u0026#39;output=s\u0026#39; =\u0026gt; \\$output, \u0026#39;count=i\u0026#39; =\u0026gt; \\$count, ) or die \u0026#34;Error in command line arguments\\n\u0026#34;; print \u0026#34;Verbose: $verbose\\n\u0026#34;; print \u0026#34;Output: $output\\n\u0026#34;; print \u0026#34;Count: $count\\n\u0026#34;; 実行例:\n1 2 3 4 $ perl script.pl --verbose --output=result.txt --count=20 Verbose: 1 Output: result.txt Count: 20 オプション定義の記法 オプションのタイプ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 use Getopt::Long; my ($flag, $string, $integer, $float, @array, %hash); GetOptions( # フラグ（真偽値） \u0026#39;verbose|v\u0026#39; =\u0026gt; \\$flag, # 文字列 \u0026#39;output|o=s\u0026#39; =\u0026gt; \\$string, # 整数 \u0026#39;count|c=i\u0026#39; =\u0026gt; \\$integer, # 浮動小数点数 \u0026#39;ratio|r=f\u0026#39; =\u0026gt; \\$float, # 配列（複数回指定可能） \u0026#39;include=s@\u0026#39; =\u0026gt; \\@array, # ハッシュ（key=value形式） \u0026#39;define=s%\u0026#39; =\u0026gt; \\%hash, ); print \u0026#34;Flag: $flag\\n\u0026#34; if $flag; print \u0026#34;String: $string\\n\u0026#34; if $string; print \u0026#34;Integer: $integer\\n\u0026#34; if defined $integer; print \u0026#34;Float: $ratio\\n\u0026#34; if defined $float; print \u0026#34;Array: @array\\n\u0026#34; if @array; print \u0026#34;Hash: \u0026#34;, join(\u0026#39;, \u0026#39;, map { \u0026#34;$_=$hash{$_}\u0026#34; } keys %hash), \u0026#34;\\n\u0026#34; if %hash; 実行例:\n1 2 3 4 5 6 7 8 9 $ perl script.pl -v -o out.txt -c 5 -r 1.5 \\ --include=/usr/local --include=/opt \\ --define=DEBUG=1 --define=LEVEL=3 Flag: 1 String: out.txt Integer: 5 Float: 1.5 Array: /usr/local /opt Hash: DEBUG=1, LEVEL=3 オプション指定子の意味 1 2 3 4 5 6 7 8 =s 文字列 (string) =i 整数 (integer) =f 浮動小数点数 (float) =s@ 文字列の配列 =i@ 整数の配列 =s% 文字列のハッシュ ! 否定可能（--no-verbose） + インクリメント（複数指定で増加） 否定可能なオプション 1 2 3 4 5 6 7 8 9 use Getopt::Long; my $color = 1; # デフォルトで有効 GetOptions( \u0026#39;color!\u0026#39; =\u0026gt; \\$color, ); print $color ? \u0026#34;Color enabled\\n\u0026#34; : \u0026#34;Color disabled\\n\u0026#34;; 実行例:\n1 2 3 4 5 6 7 8 $ perl script.pl Color enabled $ perl script.pl --no-color Color disabled $ perl script.pl --color Color enabled インクリメント可能なオプション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use Getopt::Long; my $verbose = 0; GetOptions( \u0026#39;verbose+\u0026#39; =\u0026gt; \\$verbose, ); if ($verbose == 0) { print \u0026#34;Normal mode\\n\u0026#34;; } elsif ($verbose == 1) { print \u0026#34;Verbose mode\\n\u0026#34;; } elsif ($verbose \u0026gt;= 2) { print \u0026#34;Very verbose mode\\n\u0026#34;; } 実行例:\n1 2 3 4 5 6 7 8 9 10 11 $ perl script.pl Normal mode $ perl script.pl -v Verbose mode $ perl script.pl -v -v Very verbose mode $ perl script.pl -vvv Very verbose mode デフォルト値と必須オプション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use Getopt::Long; my $host = \u0026#39;localhost\u0026#39;; # デフォルト値 my $port = 8080; my $user; # 必須オプション GetOptions( \u0026#39;host=s\u0026#39; =\u0026gt; \\$host, \u0026#39;port=i\u0026#39; =\u0026gt; \\$port, \u0026#39;user=s\u0026#39; =\u0026gt; \\$user, ) or die \u0026#34;Error in command line arguments\\n\u0026#34;; die \u0026#34;Error: --user is required\\n\u0026#34; unless $user; print \u0026#34;Host: $host\\n\u0026#34;; print \u0026#34;Port: $port\\n\u0026#34;; print \u0026#34;User: $user\\n\u0026#34;; ヘルプメッセージ pod2usage を使った方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #!/usr/bin/env perl use strict; use warnings; use Getopt::Long; use Pod::Usage; my $input; my $output = \u0026#39;output.txt\u0026#39;; my $verbose = 0; my $help = 0; GetOptions( \u0026#39;input|i=s\u0026#39; =\u0026gt; \\$input, \u0026#39;output|o=s\u0026#39; =\u0026gt; \\$output, \u0026#39;verbose|v\u0026#39; =\u0026gt; \\$verbose, \u0026#39;help|h\u0026#39; =\u0026gt; \\$help, ) or pod2usage(2); pod2usage(1) if $help; pod2usage(\u0026#34;Error: --input is required\u0026#34;) unless $input; print \u0026#34;Processing $input -\u0026gt; $output\\n\u0026#34;; __END__ =head1 NAME process.pl - Process input files =head1 SYNOPSIS process.pl [options] Options: -i, --input=FILE Input file (required) -o, --output=FILE Output file (default: output.txt) -v, --verbose Verbose output -h, --help Show this help message =head1 DESCRIPTION This script processes the input file and generates an output file. =head1 EXAMPLES # Basic usage process.pl --input=data.txt # Specify output file process.pl -i data.txt -o result.txt # Verbose mode process.pl -i data.txt -v =cut 手動でヘルプを実装 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use Getopt::Long; sub show_help { print \u0026lt;\u0026lt;\u0026#39;HELP\u0026#39;; Usage: script.pl [OPTIONS] Options: -i, --input FILE Input file (required) -o, --output FILE Output file (default: output.txt) -v, --verbose Verbose output -h, --help Show this help message Examples: script.pl --input=data.txt script.pl -i data.txt -o result.txt -v HELP exit(0); } my ($input, $output, $verbose, $help); $output = \u0026#39;output.txt\u0026#39;; GetOptions( \u0026#39;input|i=s\u0026#39; =\u0026gt; \\$input, \u0026#39;output|o=s\u0026#39; =\u0026gt; \\$output, \u0026#39;verbose|v\u0026#39; =\u0026gt; \\$verbose, \u0026#39;help|h\u0026#39; =\u0026gt; \\$help, ) or show_help(); show_help() if $help; die \u0026#34;Error: --input is required\\n\u0026#34; unless $input; サブコマンドの実装 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 use Getopt::Long qw(GetOptionsFromArray); sub cmd_add { my @args = @_; my ($force, $verbose); GetOptionsFromArray(\\@args, \u0026#39;force|f\u0026#39; =\u0026gt; \\$force, \u0026#39;verbose|v\u0026#39; =\u0026gt; \\$verbose, ) or die \u0026#34;Error in add command\\n\u0026#34;; print \u0026#34;Add command\\n\u0026#34;; print \u0026#34; Files: @args\\n\u0026#34;; print \u0026#34; Force: $force\\n\u0026#34; if $force; } sub cmd_remove { my @args = @_; my ($recursive, $force); GetOptionsFromArray(\\@args, \u0026#39;recursive|r\u0026#39; =\u0026gt; \\$recursive, \u0026#39;force|f\u0026#39; =\u0026gt; \\$force, ) or die \u0026#34;Error in remove command\\n\u0026#34;; print \u0026#34;Remove command\\n\u0026#34;; print \u0026#34; Files: @args\\n\u0026#34;; print \u0026#34; Recursive: $recursive\\n\u0026#34; if $recursive; } # メインコマンド処理 my $command = shift @ARGV or die \u0026#34;No command specified\\n\u0026#34;; if ($command eq \u0026#39;add\u0026#39;) { cmd_add(@ARGV); } elsif ($command eq \u0026#39;remove\u0026#39;) { cmd_remove(@ARGV); } else { die \u0026#34;Unknown command: $command\\n\u0026#34;; } 実行例:\n1 2 3 4 5 6 7 8 9 $ perl git-like.pl add --force file1.txt file2.txt Add command Files: file1.txt file2.txt Force: 1 $ perl git-like.pl remove --recursive dir/ Remove command Files: dir/ Recursive: 1 実用的なCLIツール作成 ファイル検索ツール 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 #!/usr/bin/env perl use strict; use warnings; use Getopt::Long; use File::Find; use Pod::Usage; my $pattern; my $directory = \u0026#39;.\u0026#39;; my $ignore_case = 0; my $file_pattern; my $help = 0; GetOptions( \u0026#39;pattern|p=s\u0026#39; =\u0026gt; \\$pattern, \u0026#39;directory|d=s\u0026#39; =\u0026gt; \\$directory, \u0026#39;ignore-case|i\u0026#39; =\u0026gt; \\$ignore_case, \u0026#39;file|f=s\u0026#39; =\u0026gt; \\$file_pattern, \u0026#39;help|h\u0026#39; =\u0026gt; \\$help, ) or pod2usage(2); pod2usage(1) if $help; die \u0026#34;Error: --pattern is required\\n\u0026#34; unless $pattern; my $regex = $ignore_case ? qr/$pattern/i : qr/$pattern/; my $file_regex = $file_pattern ? qr/$file_pattern/ : qr/.*/; find(sub { return unless -f $_; return unless $File::Find::name =~ $file_regex; open my $fh, \u0026#39;\u0026lt;\u0026#39;, $_ or return; while (my $line = \u0026lt;$fh\u0026gt;) { if ($line =~ $regex) { print \u0026#34;$File::Find::name:$.: $line\u0026#34;; } } close $fh; }, $directory); __END__ =head1 NAME search.pl - Search for pattern in files =head1 SYNOPSIS search.pl --pattern=PATTERN [OPTIONS] =head1 OPTIONS -p, --pattern=PATTERN Search pattern (required) -d, --directory=DIR Directory to search (default: current) -i, --ignore-case Case-insensitive search -f, --file=PATTERN File name pattern -h, --help Show help =cut データ処理ツール 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 #!/usr/bin/env perl use strict; use warnings; use Getopt::Long; use Text::CSV; my $input; my $output; my $delimiter = \u0026#39;,\u0026#39;; my $columns; my $filter; GetOptions( \u0026#39;input|i=s\u0026#39; =\u0026gt; \\$input, \u0026#39;output|o=s\u0026#39; =\u0026gt; \\$output, \u0026#39;delimiter|d=s\u0026#39; =\u0026gt; \\$delimiter, \u0026#39;columns|c=s\u0026#39; =\u0026gt; \\$columns, \u0026#39;filter|f=s\u0026#39; =\u0026gt; \\$filter, ) or die \u0026#34;Error in arguments\\n\u0026#34;; die \u0026#34;Error: --input is required\\n\u0026#34; unless $input; my $csv = Text::CSV-\u0026gt;new({ sep_char =\u0026gt; $delimiter }); open my $in_fh, \u0026#39;\u0026lt;\u0026#39;, $input or die \u0026#34;Cannot open $input: $!\\n\u0026#34;; my $out_fh; if ($output) { open $out_fh, \u0026#39;\u0026gt;\u0026#39;, $output or die \u0026#34;Cannot open $output: $!\\n\u0026#34;; } else { $out_fh = \\*STDOUT; } # 列の選択 my @select_columns; if ($columns) { @select_columns = split /,/, $columns; } # フィルター式（安全な実装例） # evalは任意のコード実行を許可するため、本番環境では使用しない # 代わりに、安全な比較演算子のみをサポートする実装を推奨 my $filter_sub; if ($filter) { # 注意: evalは危険！実際の運用では使用しない # この例は学習目的のみ。本番では列名、演算子、値を個別に受け取る設計に warn \u0026#34;WARNING: eval is dangerous! Use --column, --operator, --value instead\\n\u0026#34;; # より安全な代替案: 特定のパターンのみ許可 # 例: --column 2 --op \u0026#39;\u0026gt;\u0026#39; --value 100 # こうすれば任意のコード実行を防げる # 以下は教育目的のデモコード（本番では使用禁止） $filter_sub = eval \u0026#34;sub { my \\$row = shift; $filter }\u0026#34;; die \u0026#34;Filter error: $@\u0026#34; if $@; } my $header = $csv-\u0026gt;getline($in_fh); while (my $row = $csv-\u0026gt;getline($in_fh)) { # フィルター適用 next if $filter_sub \u0026amp;\u0026amp; !$filter_sub-\u0026gt;($row); # 列の選択 if (@select_columns) { my @selected = @{$row}[@select_columns]; $csv-\u0026gt;print($out_fh, \\@selected); print $out_fh \u0026#34;\\n\u0026#34;; } else { $csv-\u0026gt;print($out_fh, $row); print $out_fh \u0026#34;\\n\u0026#34;; } } close $in_fh; close $out_fh if $output; # より安全なフィルター実装例（推奨）: # GetOptions( # \u0026#39;filter-column=i\u0026#39; =\u0026gt; \\my $filter_col, # \u0026#39;filter-op=s\u0026#39; =\u0026gt; \\my $filter_op, # eq, ne, \u0026gt;, \u0026lt;, \u0026gt;=, \u0026lt;= # \u0026#39;filter-value=s\u0026#39; =\u0026gt; \\my $filter_val, # ); # # my %safe_ops = ( # \u0026#39;eq\u0026#39; =\u0026gt; sub { $_[0] eq $_[1] }, # \u0026#39;ne\u0026#39; =\u0026gt; sub { $_[0] ne $_[1] }, # \u0026#39;\u0026gt;\u0026#39; =\u0026gt; sub { $_[0] \u0026gt; $_[1] }, # \u0026#39;\u0026lt;\u0026#39; =\u0026gt; sub { $_[0] \u0026lt; $_[1] }, # ); # # my $op_sub = $safe_ops{$filter_op}; # next if $filter_col \u0026amp;\u0026amp; !$op_sub-\u0026gt;($row-\u0026gt;[$filter_col], $filter_val); 実行例:\n1 2 3 4 5 # 2列目と3列目を抽出 $ perl csvtool.pl --input=data.csv --columns=1,2 # フィルター適用 $ perl csvtool.pl --input=data.csv --filter=\u0026#39;$row-\u0026gt;[0] \u0026gt; 100\u0026#39; 設定ファイルとの併用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Getopt::Long; use Config::Tiny; # デフォルト設定 my %config = ( host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 8080, user =\u0026gt; \u0026#39;default\u0026#39;, ); # 設定ファイルから読み込み my $config_file = \u0026#34;$ENV{HOME}/.myapp.conf\u0026#34;; if (-f $config_file) { my $ini = Config::Tiny-\u0026gt;read($config_file); %config = (%config, %{$ini-\u0026gt;{_}}); } # コマンドラインオプションで上書き GetOptions( \u0026#39;host=s\u0026#39; =\u0026gt; \\$config{host}, \u0026#39;port=i\u0026#39; =\u0026gt; \\$config{port}, \u0026#39;user=s\u0026#39; =\u0026gt; \\$config{user}, ); print \u0026#34;Host: $config{host}\\n\u0026#34;; print \u0026#34;Port: $config{port}\\n\u0026#34;; print \u0026#34;User: $config{user}\\n\u0026#34;; 優先順位: コマンドライン \u0026gt; 設定ファイル \u0026gt; デフォルト値\nまとめ Getopt::Long: 強力で柔軟な引数解析 Pod::Usage: PODからヘルプメッセージを自動生成 サブコマンド: GetOptionsFromArrayで実装 設定ファイル: コマンドラインオプションと併用 バリデーション: 必須オプションや値の範囲をチェック Getopt::Longを使えば、プロフェッショナルなコマンドラインツールを簡単に作成できます。ヘルプメッセージとエラーメッセージを充実させることで、ユーザーフレンドリーなツールになります。\n","date":"2025-12-21T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251221000000-image.jpg","permalink":"https://www.nqou.net/2025/12/21/000000/","title":"Perlでのコマンドライン引数処理 - Getopt::Long"},{"content":"はじめに - 試行錯誤の先に見えたもの 最初はわからなかった GitHub Copilotを使い始めて、AGENTS.mdという仕組みを知りました。「AIエージェント向けのREADME」という説明を読んで、とりあえずAIに書かせてみたのです。\n最初のうちは、うまく動くこともあれば、動かないこともありました。なぜうまくいくのか、なぜ失敗するのか、理由がまったくわかりませんでした。しかし、使い続けているうちに、少しずつパターンが見えてきました。\n「あ、ここを直すと動いた」「この書き方では連携がスムーズだ」——そんな小さな発見を積み重ねていくうち、3つの成功パターンが浮かび上がってきました。\n転機：DeNA LLM勉強会の資料 試行錯誤を続けていたある日、LLM勉強会の資料を見つけました。\nAIエンジニアが本気で作ったLLM勉強会資料を大公開 〜そのまま使えるハンズオン用コード付き〜 | BLOG - DeNA Engineering はじめに こんにちは、2020年に新卒入社してからDeNAでAIエンジニアをしている吉田（ @birdwatcherYT ）です。 いつもは Qiita に技術記事を発信しているのですが、今回は … DeNA Engineering 特に15〜22ページの「プロンプトエンジニアリングの基礎」のセクションは目から鱗が落ちました。重要な部分の強調方法、役割付与の効果、ハルシネーション防止のテクニック——これまで感覚的にやっていたことが、理論として体系化されていたのです。\nこの資料を読んで、自分の試行錯誤が間違っていなかったこと、そして、もっと良い方向に進める余地があることに気づきました。\nこの記事で共有すること この記事では、私が観察から学んだ3つの成功パターンと、DeNA勉強会資料から学んだプロンプト技術を共有します。\n観察からわかった3つの成功パターン 勉強会資料から学んだプロンプト技術 実際のワークフロー例 今後の課題と展望 あなたも、AGENTS.mdやカスタムエージェントを使ってAIエージェントを活用できるようになりましょう。\n観察してわかった3つの成功パターン 試行錯誤を繰り返す中で、エージェント連携を成功させるための3つのシンプルなパターンが見えてきました。\nパターン1: 名前と説明を明確にする 一番最初に気づいたのは、エージェント定義におけるname と description の重要性です。\nカスタムエージェントの定義ファイルには、YAMLフロントマターで name と description を設定します。この2つが、エージェント連携において最も重要な要素なのです。\n良い例:\n1 2 3 4 5 # investigative-research.agent.md --- name: investigative-research description: 調査・情報収集に深い愛とこだわりを持つ、オタク気質の専門家エージェント --- 1 2 3 4 5 # proofreader.agent.md --- name: proofreader description: 校正にこだわる、文章を丁寧に磨き上げることを好む専門家 --- 悪い例:\n1 2 3 4 5 # research.agent.md --- name: research # ← ワークフローで指定する名前と一致しない description: エージェント # ← 何をするのか不明確 --- 最初のうちは、短縮名でも通じるだろうと思っていました。でも、AGENTS.mdのワークフローで指定する役割名（例: investigative-research）と、エージェント定義の name が完全に一致していないと、Copilotがうまく紐付けられないことがわかりました。\nまた、description が具体的であればあるほど、Copilotがそのエージェントの役割を正しく理解し、適切なタイミングで呼び出してくれます。\nパターン2: エージェント定義の場所を示す 2つ目のパターンは、エージェント定義ファイルの配置場所の統一です。\nカスタムエージェント定義ファイルは、.github/agents/ ディレクトリに {role}.agent.md という形式で配置します。この配置ルールを一貫させることで、エージェント間の連携が安定するのです。\n推奨配置:\n1 2 3 4 5 6 .github/ agents/ investigative-research.agent.md search-engine-optimization.agent.md proofreader.agent.md reviewer.agent.md 命名規則:\n{役割名}.agent.md の形式 役割がわかりやすい名前をつける ハイフン区切り（kebab-case）を推奨 この配置ルールを守ることで、「このエージェントはどこに定義されているのか」が明確になり、AIが自律的にエージェントを見つけられるようになります。\n発見したのは、場所を明示するだけで連携が安定するということです。AIは思った以上に「構造」や「規則性」を理解してくれます。とはいえ、主要なエージェントについては例示するのが良さそうです。\nパターン3: AGENTS.mdにワークフローを定義する 3つ目のパターンは、AGENTS.mdにワークフローとして連携フローを明記することです。\nこれが最も重要な発見でした。エージェント定義ファイル（.github/agents/*.md）に name と description を書くだけでなく、AGENTS.mdにワークフローとして「どのエージェントがどの順番で何をするのか」を明記することで、Copilotが自律的にエージェントを呼び出してくれるようになります。\nAGENTS.mdに記載するワークフロー例:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ### 単体記事のワークフロー 記事ごとのワークフローは以下の順とする。それぞれ専門家エージェントに割り当てる 1. 調査・情報収集（investigative-researchエージェント） - キーワード、および関連トピックの調査 - 参考URLの収集 - 内部リンク（関連記事など）の調査 2. アウトライン作成（search-engine-optimizationエージェント） - タイトルの最適化 - meta descriptionの作成 - 見出し構造の整理 3. 記事作成（各専門家エージェント） - アウトラインに基づいた記事作成 - コード例、図表の配置 4. スタイルと構成の整形（layout-and-content-harmonizationエージェント） 5. 校正（proofreaderエージェント） 6. SEO（search-engine-optimizationエージェント） 7. 公開前の最終チェック（reviewerエージェント） このワークフローの中で、役割名（例: investigative-research）とエージェント定義の name が一致していること、そして各エージェントの description がワークフロー内の指示内容と整合していることが重要です。\nCopilotは、AGENTS.mdに書かれたワークフローを読み、ここではinvestigative-researchという名前のエージェントを呼べばよいと判断します。そのエージェントのdescriptionを参照すると、調査・情報収集を専門としているため、このタスクに適していると判断します。\nこのワークフローを定義することで気づいたのは、「正しく情報を与えるだけ」でAIが自律的に動作するという点です。複雑な制御ロジックは不要で、シンプルな定義だけで連携できるようになっていました。\nIssueなどからアサインする時に、最後にダメ押しで AGENTS.mdの「単体記事のワークフロー」に従って作成してください。 のように指定すると、ほぼワークフローを守ってくれるようです。\nCopilotが作業する時、ガイドラインやエージェントの定義、Issueの内容、アサイン時の指示など、すべての情報の中に存在している「キーワード」をうまく紐づけることを意識するのが良いと思います。\nDeNA勉強会資料から学んだプロンプト技術 試行錯誤を続けていた私にとって、DeNAの社内勉強会の資料は大きな転機になりました。\nAIエンジニアが本気で作ったLLM勉強会資料を大公開 〜そのまま使えるハンズオン用コード付き〜 | BLOG - DeNA Engineering はじめに こんにちは、2020年に新卒入社してからDeNAでAIエンジニアをしている吉田（ @birdwatcherYT ）です。 いつもは Qiita に技術記事を発信しているのですが、今回は … DeNA Engineering ベストプラクティスの重要性 勉強会資料を読んで最初に感じたのは、「基礎を押さえることの大切さ」でした。\n私はこれまで、感覚的にプロンプトを書いていました。「こう書いたらうまくいった」という経験則だけが頼りだったのです。でも、資料を読むことで、なぜうまくいったのか、どうすればもっと良くなるのかが理論的に理解できるようになりました。\n基礎を押さえれば、応用はその先にあります。エージェント定義にも、プロンプトエンジニアリングの知見を活かせることがわかりました。\n重要な部分を強調する方法 プロンプトでは、重要な部分を明示的に強調することが大切です。勉強会資料で学んだテクニックをいくつか紹介します。\n優先順位の明示 1 2 3 4 【優先順位】 1. 正確性 2. 簡潔性 3. 応答速度 AIに「何を最優先すべきか」を明確に伝えることで、期待する出力に近づきます。\n出力形式の指定 1 2 3 4 【出力形式】 - Markdown形式で出力 - コードブロックには言語タグを付与 - 見出しはH2/H3のみ使用 形式を明示することで、出力のばらつきを抑え、一貫性のある結果を得られます。\n太字や箇条書きの効果的な使い方 AGENTS.mdでも、重要な制約や絶対にしてはいけないことを太字で強調したり、箇条書きで整理したりすることで、AIが重要なポイントを見逃しにくくなります。\n役割付与の効果 勉強会資料で特に印象的だったのは、「あなたは専門家です」という一文の効果です。\nAIに明確な役割や専門性を付与することで、回答の質が大きく変わります。これを「役割付与（Role Prompting）」と呼びます。\n基本形:\n1 2 あなたは10年以上の経験を持つ[専門分野]の専門家です。 [専門分野]に深い愛とこだわりを持っています。 私はこのリポジトリで perl-monger というカスタムエージェントを定義しています（詳しくはperl-mongerをカスタムエージェントとして定義したをご覧ください）。\n1 2 You are \u0026#34;perl-monger\u0026#34;, a Perl-obsessed specialist. Be enthusiastic and geeky but helpful. 試しに、この perl-monger にRubyについて尋ねてみました。すると、「Perl好きから見て一言」という独自の視点で回答しました。単なる技術比較ではなく、「魔術性」「アプローチの違い」といった本質的な特徴を指摘しつつ、どちらも支持する立場を示しました。\nペルソナが回答の質を変える——この発見は、カスタムエージェント設計において非常に重要でした。\nハルシネーション防止 AIの「ハルシネーション（もっともらしい嘘）」を防ぐためのテクニックも学びました。\n出典を明示させる 1 2 必ず公式ソースのURLを併記してください。 引用する場合は出典を明記してください。 これにより、AIが推測で回答することを防ぎ、根拠のある情報だけを提供させることができます。\n不明点は「わからない」と答えさせる 1 2 根拠がない場合は「わからない」と答えてください。 推測で回答しないでください。 AIは質問に答えようとするあまり、知らないことでも推測で答えてしまうことがあります。この指示を加えることで、AIが正直に「わからない」と答えるようにしています。\nエージェント定義での実践例 実際にカスタムエージェントを定義する際、以下のような指示を含めています。\n1 2 3 4 5 6 7 8 9 10 --- name: investigative-research description: 調査専門のエージェント。情報の正確性を最優先する。 --- ## 行動指針 - 根拠が不明な情報は推測しない - 不明点は必ず質問して明確化 - 出典はMarkdown形式で明記 - わからない場合は「わからない」と答える このように、ハルシネーション防止のテクニックをエージェント定義に組み込むことで、信頼性の高い出力を得られるようになりました。\nドメイン特化型AIという選択 エージェント連携を設計する際、重要なのは「専門性」です。\nなぜ専門性を高めるのか 汎用的なAIは便利ですが、特定の分野では限界があります。ドメイン特化型AIには、研究で裏付けられた5つのメリットがあります。\nドメイン内性能の向上 - 特定領域に特化することで、より正確で詳細な回答が可能 ハルシネーションとリスク低減 - 専門知識に絞ることで、誤情報生成の確率が低下 専門知識・語彙のキャプチャ - ドメイン固有の用語や概念を適切に理解 少量データでの有効性 - 微調整手法により、少ないデータでも高性能 コストと効率のトレードオフ - 必要な機能に絞ることで効率的に動作 Domain Specific AI: A Complete Guide to Specialized Artificial Intelligence Solutions Discover how domain-specific AI delivers specialized, high-precision solutions tailored to your industry. Learn its … www.getguru.com GitHub Copilot の awesome-copilot で開発体験を向上させるの記事でも詳しく解説しています。\nLess is More - 定義の粒度 エージェントを定義する際、最初は「細かく定義した方が良い」と思っていました。でも、実際に運用してみると、定義しすぎると柔軟性が失われることがわかりました。\n失敗例（定義しすぎ）:\n1 2 3 4 5 6 7 --- name: perl-expert --- 推奨フレームワーク: Catalyst, Mojolicious, Dancer 推奨モジュール: Plack, DBIx::Class, Moo 推奨スタイル: PBP（Perl Best Practices） テストツール: Test::More, Test::Deep この場合、定義にないフレームワークやモジュールについて聞かれると、対応が硬直化してしまいます。\n成功例（シンプル）:\n1 2 3 4 5 6 7 --- name: perl-monger description: Perl愛好家。熱狂的でオタク的だが役に立つ --- イディオマティックなPerlを優先 必要に応じてバージョンやCPANモジュールに言及 シンプルな性格設定だけで、AIの基礎知識と推論能力が適切な回答を導いてくれます。\n教訓: 定義を過度に詳細化しない方が良い。\nカスタムエージェントの実例 実際に perl-monger を使ってみると、シンプルな定義でも効果的に動くことがわかります。\nペルソナが生む独自の視点は、単なる技術解説を超えた深い洞察を提供してくれます。Rubyについて聞いたときの「Perl好きとして一言」という切り口は、まさにペルソナの力です。\n実践：このリポジトリでのワークフロー ここまでで理論を説明しました。以下に実際のワークフローを示します。\n記事作成フローの全体像 このリポジトリでは、記事作成に6つのエージェントが連携しています。\n1 2 3 4 5 6 7 8 9 10 11 12 1. investigative-research（調査エージェント） ↓ 調査結果をまとめる 2. search-engine-optimization（アウトライン作成エージェント） ↓ アウトラインを作成 3. 専門家エージェント（記事執筆） ↓ 記事本文を執筆 4. layout-and-content-harmonization（整形エージェント） ↓ レイアウトと内容を調整 5. proofreader（校正エージェント） ↓ 誤字脱字や表現をチェック 6. reviewer（最終確認エージェント） ↓ 最終確認して完了 Copilotは、AGENTS.mdに記載されたこのワークフローを参照し、各ステップで適切なエージェント（name と description が一致するもの）を呼び出します。まるでベルトコンベアのように、タスクがスムーズに流れていくのです。\nsearch-engine-optimization はSEOの専門家ですが、SEO視点から見たアウトラインを考えるようにフローの中で指示しています。\n定義ファイルを見てみる 実際のエージェント定義ファイルはシンプルです。\n1 2 3 4 5 6 7 --- name: proofreader description: 校正専門のエージェント。誤字脱字や表現をチェックする。 --- あなたは10年以上の経験を持つ校正者です。 誤字脱字、表記ゆれ、不自然な表現を見つけることに情熱を注いでいます。 最初は、AIに指示（調査エージェントを作りたいので定義を書いて、みたいな指示です）して細かい内容についてびっしりと書いていましたが、一歩引いて考えれば、AIに書かせた内容は、その「指示」を書いておけば「びっしりと書いた内容」を指示しているのとほぼ変わらないのです。AIが書いたのですからAIはすでに知っているのです。むしろ新たに学習された内容も含まれることを考えると、細かく指示を出すよりも有効だと考えることもできます。なので、私は、役割付与以外は本当に指定したい事柄だけを追加で指定する、という定義方法を採用しています。\n例えば、最近、調査結果を保存しておくような指示を追加しました。調査用のエージェントは調査した結果をそのままCopilotに渡すようで、セッションが終わると調査結果はログにしか残りません。せっかくの調査がもったいないなと。「調査とは何か」のような定義は一切していませんが「専門性」を発揮して、素晴らしいレポートを作成してくれます。今回のレポートも圧巻です。\nhttps://raw.githubusercontent.com/nqou-net/www.nqou.net/fe3a4529dbe1f0355bfaeb2e184b9d332cc7c39a/agents/research/agent-coordination-best-practices.md raw.githubusercontent.com エージェント連携で重要なのは name と description です。これらがAGENTS.mdのワークフローと整合していれば、Copilotが適切にエージェントを呼び出してくれます。\n補足: handoffs について\nエージェント定義に handoffs というフィールドを見かけることがあるかもしれません。これは次のエージェントへの引き継ぎを定義する仕組みですが、すべてのAIモデルで共通して利用できるわけではありません。\n1 2 3 4 5 # handoffs の例（参考） handoffs: - label: 最終確認へ agent: reviewer prompt: 最終確認をお願いします handoffs を定義することで、エージェント間の連携をより明示的にできる場合もありますが、必須ではありません。少なくとも私は書いていませんが、ワークフローによって複数エージェントによる記事作成は実現できています。現時点で確実に機能するのは、AGENTS.mdのワークフロー定義と、各エージェントの name および description の整合性です。\nhandoffs は書いておいて差し支えありませんが、あくまで参考程度と考えてください。エージェント連携の本質は、少なくとも現時点ではAGENTS.mdのワークフロー定義にあります。\n運用してわかったこと 実際に運用してみて、いくつかの重要なことがわかりました。\n完璧を目指さない 最初から完璧なエージェントを作ろうとすると、定義が複雑になりすぎて逆効果になります。まずはシンプルに始め、必要に応じて段階的に調整してください。\n小さく始めて観察する 1つのエージェントから始めて、動作を観察しながら少しずつ改善していくアプローチが有効です。観察することで、どこを改善すればいいかが見えてきます。\n改善は段階的に 一度にたくさんの変更をすると、何が効果的だったのかがわからなくなります。1つずつ変更して、その効果を確認する——この繰り返しが大切です。\n今後の課題と展望 エージェント連携はまだ発展途上の分野です。今後の課題と展望について考えてみます。\nまだ標準化とは言えない エージェント配置（.github/agents/*.md）については、60,000以上のリポジトリで採用される業界標準「AGENTS.md」として確立されつつあります。\nAGENTS.md AGENTS.md is a simple, open format for guiding coding agents. Think of it as a README for agents. agents.md しかし、エージェント間の連携パターンについては、まだ模索中の段階です。コミュニティでベストプラクティスを共有し、標準化を進めていく必要があります。\nAGENTS.mdについて最初に試したときの記事は、エージェントガイドラインを作成するプロンプトを試してみたで詳しく書いています。また、エージェントパネルから記事を生成してみたでは、エージェントパネルを使った実践例を紹介しています。\nA2Aプロトコルの可能性 将来的には、「A2A（Agent to Agent）プロトコル」のような標準化された通信プロトコルが重要になるかもしれません。\nA2A Protocol The official documentation for the Agent2Agent (A2A) protocol. The A2A protocol is an open standard that allows … a2a-protocol.org A2Aプロトコルは、異なるベンダーや実装のAIエージェント同士が標準化された方法で連携するための仕様です。主な特徴は以下の通りです。\nAgent Card - エージェントの能力を公開 Task - 作業単位の定義 Message/Parts - 多モーダルなやり取り Artifact - 成果物の受け渡し これにより、マイクロサービスのようにエージェントを組み合わせることが可能になります。将来的には、異なるAIサービスのエージェントを自由に組み合わせて使える時代が来るかもしれません。\n継続的な観察と改善 エージェント連携は、使いながら学んでいくものです。\nフィードバックループを回す うまくいったパターンを記録する 失敗から学ぶ 知見を共有する文化を作る この記事も、私の観察結果を共有する試みの1つです。あなたも、自分の経験を共有してみてください。コミュニティ全体で知見が蓄積されれば、エージェント連携はもっと使いやすくなるはずです。\nまとめ - 正しく情報を与えてあげるだけ 長い記事になりましたが、最後にポイントを整理します。\n成功の3つのパターン再確認 エージェント間連携を成功させるための3つのシンプルなパターン。\nname と description を明確にする - エージェントの名前と役割を具体的に定義 定義の場所を示す - .github/agents/{role}.agent.md に統一配置し、AGENTS.mdにパスを記載する AGENTS.mdにワークフローを定義する - ワークフローの中で役割とエージェント名を明確に紐付ける これらの要素が整合していれば、Copilotが自律的にエージェントを呼び出し、連携させてくれます。\nプロンプトエンジニアリングの基礎 DeNA勉強会資料から学んだ重要なポイント。\n役割付与 - 「あなたは専門家です」でペルソナを与える ハルシネーション防止 - 出典の明示、答えがないときは「わからない」と答えさせる 強調方法 - 優先順位、出力形式、良例・悪例の提示 あなたも今日から始められる エージェント連携は難しくありません。以下のステップで始めてみてください。\nAGENTS.mdを作成してみる リポジトリのルートに AGENTS.md を配置 プロジェクトの概要、技術スタック、制約を記述 GitHub Copilot公式ドキュメントも参考に カスタム エージェントについて - GitHub ドキュメント カスタム エージェント は、 Copilot コーディング エージェント を、ニーズに合わせて調整された特殊な支援で強化します。 GitHub Docs シンプルなカスタムエージェントを定義する\n.github/agents/ ディレクトリを作成 1つの専門性に絞ったエージェントから始める 細かく定義しすぎない（Less is More） 観察しながら改善していく\n実際に使ってみる うまくいったこと、いかなかったことを記録する 少しずつ改善を重ねる 重要なのは、正しく情報を与えてあげるだけです。複雑な制御ロジックは不要で、シンプルな定義だけでAIは自律的に動作します。\nあなたの試行錯誤が、新しい発見につながることを願っています。\n参考リンク AIエンジニアが本気で作ったLLM勉強会資料を大公開 〜そのまま使えるハンズオン用コード付き〜 | BLOG - DeNA Engineering はじめに こんにちは、2020年に新卒入社してからDeNAでAIエンジニアをしている吉田（ @birdwatcherYT ）です。 いつもは Qiita に技術記事を発信しているのですが、今回は … DeNA Engineering GitHub Copilot のドキュメント - GitHub ドキュメント GitHub Copilot を使うと、生産性を向上させ、コードの作業を支援できます。 GitHub Docs AGENTS.md AGENTS.md is a simple, open format for guiding coding agents. Think of it as a README for agents. agents.md ","date":"2025-12-20T19:25:41+09:00","image":"https://www.nqou.net/public_images/2025/1766226341-image.jpg","permalink":"https://www.nqou.net/2025/12/20/192541/","title":"なぜエージェント連携がうまくいくようになったのか - 観察から見えた3つの成功パターン"},{"content":"Perlでのロギング - Log::Log4perl と Log::Dispatch ロギングは、アプリケーションの動作を追跡し、問題を診断するために不可欠です。Perlには強力なロギングモジュールがあり、適切に使うことでデバッグとメンテナンスが大幅に楽になります。\nロギングの重要性 ロギングがなぜ重要なのか:\nデバッグ: 問題の原因を特定できる 監視: システムの健全性を確認できる 監査: 誰が何をしたか記録できる パフォーマンス分析: ボトルネックを発見できる セキュリティ: 不正アクセスを検出できる 1 2 3 4 5 6 7 # 悪い例: printでのデバッグ print \u0026#34;User logged in\\n\u0026#34;; # 本番環境で残ってしまう print \u0026#34;DEBUG: value = $value\\n\u0026#34;; # 管理が困難 # 良い例: ロガーを使用 $log-\u0026gt;info(\u0026#34;User logged in\u0026#34;); # レベルで制御可能 $log-\u0026gt;debug(\u0026#34;value = $value\u0026#34;); # 本番では出力されない Log::Log4perl の基本 Log::Log4perlは、Javaの人気ライブラリLog4jのPerl移植版で、非常に強力で柔軟性があります。\n簡単な使い方 1 2 3 4 5 6 7 8 9 10 11 12 13 use Log::Log4perl qw(:easy); # 簡易設定 Log::Log4perl-\u0026gt;easy_init($DEBUG); my $log = Log::Log4perl-\u0026gt;get_logger(); $log-\u0026gt;trace(\u0026#34;トレースレベルのメッセージ\u0026#34;); $log-\u0026gt;debug(\u0026#34;デバッグメッセージ\u0026#34;); $log-\u0026gt;info(\u0026#34;情報メッセージ\u0026#34;); $log-\u0026gt;warn(\u0026#34;警告メッセージ\u0026#34;); $log-\u0026gt;error(\u0026#34;エラーメッセージ\u0026#34;); $log-\u0026gt;fatal(\u0026#34;致命的エラー\u0026#34;); 設定ファイルを使用 1 2 3 4 5 6 7 8 9 use Log::Log4perl; # 設定ファイルから読み込み Log::Log4perl-\u0026gt;init(\u0026#39;/path/to/log4perl.conf\u0026#39;); my $log = Log::Log4perl-\u0026gt;get_logger(\u0026#39;MyApp\u0026#39;); $log-\u0026gt;info(\u0026#34;Application started\u0026#34;); $log-\u0026gt;debug(\u0026#34;Debug information\u0026#34;); log4perl.conf の例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ルートロガーの設定 log4perl.rootLogger = INFO, Screen, File # 画面出力用のアペンダー log4perl.appender.Screen = Log::Log4perl::Appender::Screen log4perl.appender.Screen.stderr = 0 log4perl.appender.Screen.layout = PatternLayout log4perl.appender.Screen.layout.ConversionPattern = %d %p %c - %m%n # ファイル出力用のアペンダー log4perl.appender.File = Log::Log4perl::Appender::File log4perl.appender.File.filename = /var/log/myapp.log log4perl.appender.File.mode = append log4perl.appender.File.layout = PatternLayout log4perl.appender.File.layout.ConversionPattern = %d [%P] %p %c - %m%n # 特定のパッケージのログレベルを変更 log4perl.logger.MyApp.Database = DEBUG ログレベルの使い分け 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use Log::Log4perl qw(:easy); Log::Log4perl-\u0026gt;easy_init($INFO); my $log = Log::Log4perl-\u0026gt;get_logger(); # TRACE: 非常に詳細な情報（通常は使わない） $log-\u0026gt;trace(\u0026#34;Entering function foo() with args: \u0026#34;, join(\u0026#39;, \u0026#39;, @args)); # DEBUG: 開発時のデバッグ情報 $log-\u0026gt;debug(\u0026#34;Variable x = $x, y = $y\u0026#34;); # INFO: 一般的な情報（処理の流れ） $log-\u0026gt;info(\u0026#34;User $username logged in successfully\u0026#34;); # WARN: 警告（問題になる可能性がある） $log-\u0026gt;warn(\u0026#34;Disk space is running low: $free_space MB remaining\u0026#34;); # ERROR: エラー（処理は継続可能） $log-\u0026gt;error(\u0026#34;Failed to connect to database, retrying...\u0026#34;); # FATAL: 致命的エラー（処理継続不可能） $log-\u0026gt;fatal(\u0026#34;Configuration file not found, exiting\u0026#34;); パターンレイアウト Log::Log4perlは、豊富なフォーマット指定子を提供します:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # よく使うパターン %d 日時 %p ログレベル (INFO, DEBUG, etc.) %c カテゴリ名（ロガー名） %m メッセージ %n 改行 %P プロセスID %H ホスト名 %F ファイル名 %L 行番号 %M メソッド名 # 実用的なパターン例 log4perl.appender.File.layout.ConversionPattern = [%d] [%P] %p %c %M:%L - %m%n # 出力例: [2025/12/20 10:30:45] [12345] INFO MyApp::User login:42 - User logged in 複数のアペンダー 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Log::Log4perl; my $conf = q{ log4perl.rootLogger = DEBUG, Screen, File, Email # 画面出力（INFOレベル以上） log4perl.appender.Screen = Log::Log4perl::Appender::Screen log4perl.appender.Screen.Threshold = INFO log4perl.appender.Screen.layout = PatternLayout log4perl.appender.Screen.layout.ConversionPattern = %p: %m%n # ファイル出力（すべてのログ） log4perl.appender.File = Log::Log4perl::Appender::File log4perl.appender.File.filename = /var/log/app.log log4perl.appender.File.layout = PatternLayout log4perl.appender.File.layout.ConversionPattern = %d %p - %m%n # メール通知（ERRORレベル以上） log4perl.appender.Email = Log::Dispatch::Email::MailSend log4perl.appender.Email.Threshold = ERROR log4perl.appender.Email.to = admin@example.com log4perl.appender.Email.from = app@example.com log4perl.appender.Email.subject = Application Error log4perl.appender.Email.layout = SimpleLayout }; Log::Log4perl-\u0026gt;init(\\$conf); my $log = Log::Log4perl-\u0026gt;get_logger(); $log-\u0026gt;debug(\u0026#34;デバッグ情報\u0026#34;); # ファイルのみ $log-\u0026gt;info(\u0026#34;情報\u0026#34;); # 画面とファイル $log-\u0026gt;error(\u0026#34;エラー発生\u0026#34;); # すべて（メールも送信） ローテーション可能なログファイル 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Log::Log4perl; my $conf = q{ log4perl.rootLogger = INFO, Logfile log4perl.appender.Logfile = Log::Dispatch::FileRotate log4perl.appender.Logfile.filename = /var/log/myapp.log log4perl.appender.Logfile.max = 10 log4perl.appender.Logfile.DatePattern = yyyy-MM-dd log4perl.appender.Logfile.TZ = JST log4perl.appender.Logfile.layout = PatternLayout log4perl.appender.Logfile.layout.ConversionPattern = %d %p - %m%n }; Log::Log4perl-\u0026gt;init(\\$conf); my $log = Log::Log4perl-\u0026gt;get_logger(); $log-\u0026gt;info(\u0026#34;This will be logged with rotation\u0026#34;); Log::Dispatch の使用 Log::Dispatchは、Log::Log4perlよりシンプルで、コードで直接設定します。\n基本的な使い方 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use Log::Dispatch; my $log = Log::Dispatch-\u0026gt;new( outputs =\u0026gt; [ [ \u0026#39;Screen\u0026#39;, min_level =\u0026gt; \u0026#39;info\u0026#39; ], [ \u0026#39;File\u0026#39;, min_level =\u0026gt; \u0026#39;debug\u0026#39;, filename =\u0026gt; \u0026#39;/var/log/myapp.log\u0026#39;, mode =\u0026gt; \u0026#39;append\u0026#39;, ], ], ); $log-\u0026gt;debug(\u0026#34;Debug message\u0026#34;); $log-\u0026gt;info(\u0026#34;Info message\u0026#34;); $log-\u0026gt;warning(\u0026#34;Warning message\u0026#34;); $log-\u0026gt;error(\u0026#34;Error message\u0026#34;); 複数の出力先 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 use Log::Dispatch; use Log::Dispatch::Screen; use Log::Dispatch::File; use Log::Dispatch::Syslog; my $log = Log::Dispatch-\u0026gt;new; # 画面出力 $log-\u0026gt;add( Log::Dispatch::Screen-\u0026gt;new( name =\u0026gt; \u0026#39;screen\u0026#39;, min_level =\u0026gt; \u0026#39;info\u0026#39;, stderr =\u0026gt; 1, ) ); # ファイル出力 $log-\u0026gt;add( Log::Dispatch::File-\u0026gt;new( name =\u0026gt; \u0026#39;file\u0026#39;, min_level =\u0026gt; \u0026#39;debug\u0026#39;, filename =\u0026gt; \u0026#39;/var/log/myapp.log\u0026#39;, mode =\u0026gt; \u0026#39;append\u0026#39;, binmode =\u0026gt; \u0026#39;:encoding(UTF-8)\u0026#39;, ) ); # syslog出力 $log-\u0026gt;add( Log::Dispatch::Syslog-\u0026gt;new( name =\u0026gt; \u0026#39;syslog\u0026#39;, min_level =\u0026gt; \u0026#39;warning\u0026#39;, ident =\u0026gt; \u0026#39;myapp\u0026#39;, facility =\u0026gt; \u0026#39;daemon\u0026#39;, ) ); $log-\u0026gt;info(\u0026#34;Application started\u0026#34;); 実用的なロギング戦略 アプリケーションロガークラス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 package MyApp::Logger; use Moo; use Log::Log4perl; has config_file =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, default =\u0026gt; \u0026#39;/etc/myapp/log4perl.conf\u0026#39;, ); has logger =\u0026gt; (is =\u0026gt; \u0026#39;lazy\u0026#39;); sub _build_logger { my $self = shift; Log::Log4perl-\u0026gt;init($self-\u0026gt;config_file); return Log::Log4perl-\u0026gt;get_logger(__PACKAGE__); } sub debug { shift-\u0026gt;logger-\u0026gt;debug(@_) } sub info { shift-\u0026gt;logger-\u0026gt;info(@_) } sub warn { shift-\u0026gt;logger-\u0026gt;warn(@_) } sub error { shift-\u0026gt;logger-\u0026gt;error(@_) } sub fatal { shift-\u0026gt;logger-\u0026gt;fatal(@_) } # 構造化ロギング sub log_event { my ($self, $event, $data) = @_; my $message = sprintf( \u0026#34;EVENT=%s USER=%s ACTION=%s\u0026#34;, $event, $data-\u0026gt;{user} // \u0026#39;unknown\u0026#39;, $data-\u0026gt;{action} // \u0026#39;unknown\u0026#39; ); $self-\u0026gt;info($message); } package main; my $log = MyApp::Logger-\u0026gt;new; $log-\u0026gt;info(\u0026#34;Application started\u0026#34;); $log-\u0026gt;log_event(\u0026#39;user_login\u0026#39;, { user =\u0026gt; \u0026#39;john\u0026#39;, action =\u0026gt; \u0026#39;login\u0026#39;, }); パフォーマンス測定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use Log::Log4perl qw(:easy); use Time::HiRes qw(gettimeofday tv_interval); Log::Log4perl-\u0026gt;easy_init($INFO); my $log = Log::Log4perl-\u0026gt;get_logger(); sub measure_time { my ($name, $code) = @_; my $start = [gettimeofday]; $log-\u0026gt;info(\u0026#34;Starting: $name\u0026#34;); my $result = $code-\u0026gt;(); my $elapsed = tv_interval($start); $log-\u0026gt;info(sprintf(\u0026#34;Finished: %s (%.3f seconds)\u0026#34;, $name, $elapsed)); return $result; } # 使用例 my $result = measure_time(\u0026#39;database_query\u0026#39; =\u0026gt; sub { # データベース処理 sleep 2; return \u0026#34;result\u0026#34;; }); エラーコンテキストの記録 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use Log::Log4perl qw(:easy); use Try::Tiny; Log::Log4perl-\u0026gt;easy_init($DEBUG); my $log = Log::Log4perl-\u0026gt;get_logger(); sub process_request { my ($request_id, $user_id) = @_; # コンテキスト情報を設定 Log::Log4perl::MDC-\u0026gt;put(\u0026#39;request_id\u0026#39;, $request_id); Log::Log4perl::MDC-\u0026gt;put(\u0026#39;user_id\u0026#39;, $user_id); $log-\u0026gt;info(\u0026#34;Processing request\u0026#34;); try { # 処理 die \u0026#34;Something went wrong\u0026#34; if rand() \u0026gt; 0.5; $log-\u0026gt;info(\u0026#34;Request processed successfully\u0026#34;); } catch { $log-\u0026gt;error(\u0026#34;Request failed: $_\u0026#34;); }; # コンテキストをクリア Log::Log4perl::MDC-\u0026gt;remove(); } # log4perl.conf で MDC を使用 # log4perl.appender.File.layout.ConversionPattern = %d [%X{request_id}] [%X{user_id}] %p - %m%n JSON形式でのロギング 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use Log::Log4perl; use JSON::MaybeXS; my $conf = q{ log4perl.rootLogger = INFO, JSONFile log4perl.appender.JSONFile = Log::Log4perl::Appender::File log4perl.appender.JSONFile.filename = /var/log/app.json log4perl.appender.JSONFile.layout = Log::Log4perl::Layout::NoopLayout }; Log::Log4perl-\u0026gt;init(\\$conf); my $log = Log::Log4perl-\u0026gt;get_logger(); sub log_json { my ($level, $message, $data) = @_; my $entry = { timestamp =\u0026gt; time(), level =\u0026gt; $level, message =\u0026gt; $message, data =\u0026gt; $data, }; $log-\u0026gt;info(encode_json($entry) . \u0026#34;\\n\u0026#34;); } log_json(\u0026#39;INFO\u0026#39;, \u0026#39;User logged in\u0026#39;, { user_id =\u0026gt; 123, ip =\u0026gt; \u0026#39;192.168.1.1\u0026#39;, }); まとめ Log::Log4perl: 強力で柔軟、設定ファイルで制御 Log::Dispatch: シンプルで直感的、コードで制御 ログレベル: DEBUG \u0026lt; INFO \u0026lt; WARN \u0026lt; ERROR \u0026lt; FATAL 複数出力: 画面、ファイル、syslog、メールなど ローテーション: 古いログを自動的にアーカイブ 構造化ログ: JSON形式で機械可読なログ 適切なロギングは、アプリケーションの品質とメンテナンス性を大幅に向上させます。開発時はDEBUGレベル、本番環境はINFOレベルが一般的です。\n","date":"2025-12-20T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251220000000-image.jpg","permalink":"https://www.nqou.net/2025/12/20/000000/","title":"Perlでのロギング - Log::Log4perl と Log::Dispatch"},{"content":"この記事は「Perlで値オブジェクトを使ってテスト駆動開発してみよう」シリーズの第1回です。ドメイン駆動設計（DDD）の重要な概念である値オブジェクト（Value Object）の基本から、Perlでの実践的な実装方法まで、初心者の方にもわかりやすく解説していきます。\n値オブジェクト（Value Object）とは何か プリミティブ型を使うコードの問題点 まず、なぜ値オブジェクトが必要なのかを理解するために、プリミティブ型（数値や文字列など）を直接使う場合の問題点を見てみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 金額を扱うコード例 sub transfer_money { my ($from_account, $to_account, $amount) = @_; # 100って何の100？円？ドル？ # マイナス値が来たらどうする？ # 通貨が混在したらどうする？ $from_account-\u0026gt;balance($from_account-\u0026gt;balance - $amount); $to_account-\u0026gt;balance($to_account-\u0026gt;balance + $amount); } # 実際の使用例 transfer_money($my_account, $your_account, 100); transfer_money($usd_account, $jpy_account, 100); # これは危険！ このコードには以下のような問題があります。\n意味が不明確: 100が何の100なのかわからない（円？ドル？ユーロ？） バリデーション不足: マイナス値が混入する可能性がある 型安全性の欠如: 異なる通貨の金額を足し引きできてしまう ビジネスルールの散在: 金額のチェックロジックがコードのあちこちに散らばる 値オブジェクトによる問題解決 値オブジェクト（Value Object）は、DDDにおける重要な設計パターンです。プリミティブ型を独自のクラスでラップすることで、以下のメリットが得られる。\n型安全性の向上 1 2 3 4 5 my $jpy = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $usd = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;USD\u0026#39;); # 異なる通貨の計算は型レベルで防げる # $jpy-\u0026gt;add($usd); # エラーになるべき バリデーションとビジネスルールの集約 1 2 3 4 5 6 7 8 9 10 11 # Moneyクラス内でバリデーションを一元管理 package Money; use Moo; has amount =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Amount must be non-negative\u0026#34; unless $_[0] \u0026gt;= 0; }, required =\u0026gt; 1, ); ビジネスルールのカプセル化 金額に関するすべてのビジネスルールをMoneyクラスに集約できます。「マイナス値は許可しない」「通貨が一致しないと計算できない」といったドメイン知識を、型として表現できるのです。\n値オブジェクトの3つの重要な特徴 DDDにおける値オブジェクトには、次の3つの重要な特徴があります。これらを理解し実装することで、保守性の高いコードが実現できます。\n不変性（イミュータブル） 値オブジェクトは一度作ったら変更できない設計にします。これを不変性（Immutability）といいます。\nなぜ不変であるべきか マルチスレッド安全性: 変更されないため、複数のスレッドから安全に参照できる 予測可能性: 関数に渡した値が勝手に変更される心配がない デバッグの容易性: 値が変わらないため、バグの原因を特定しやすい 1 2 3 4 5 6 7 # 良い例: 不変な値オブジェクト my $money1 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money2 = $money1-\u0026gt;add(Money-\u0026gt;new(amount =\u0026gt; 50, currency =\u0026gt; \u0026#39;JPY\u0026#39;)); # $money1 は変更されず、新しいオブジェクト $money2 が生成される say $money1-\u0026gt;amount; # 100 (変わっていない) say $money2-\u0026gt;amount; # 150 (新しいオブジェクト) 値による等価性 値オブジェクトは、オブジェクトの識別子（ID）ではなく、値で等価性を判定します。\n1 2 3 4 5 6 7 my $money1 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money2 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money3 = Money-\u0026gt;new(amount =\u0026gt; 200, currency =\u0026gt; \u0026#39;JPY\u0026#39;); # リファレンスは異なるが、値が同じなら等価 say $money1-\u0026gt;equals($money2) ? \u0026#39;same\u0026#39; : \u0026#39;different\u0026#39;; # same say $money1-\u0026gt;equals($money3) ? \u0026#39;same\u0026#39; : \u0026#39;different\u0026#39;; # different 通常のPerlオブジェクトは参照（リファレンス）で比較されるが、値オブジェクトは内部の値で比較します。\nバリデーションのカプセル化 値オブジェクトは、不正な値を持つインスタンスを作れないように設計します。これにより、「値オブジェクトが存在する = 値が正しい」ことが保証される。\n1 2 3 4 5 6 7 8 # 正常なインスタンス生成 my $valid_money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); # OK # 不正な値では生成できない eval { my $invalid_money = Money-\u0026gt;new(amount =\u0026gt; -100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); }; say $@ if $@; # \u0026#34;Amount must be non-negative\u0026#34; エラーが発生 Perlで値オブジェクトを実装してみよう それでは、実際にPerlとMooを使って値オブジェクトを実装してみましょう。Mooは軽量で高速なオブジェクトシステムで、値オブジェクトのパターン実装に最適なツールです。\nMooを使った値オブジェクトの実装 Mooは軽量で高速なPerlのオブジェクトシステムです。値オブジェクトの実装に必要な不変性やバリデーション機能を簡潔に記述できます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package Money; use v5.38; use Moo; use namespace::clean; # amount: 金額（非負の数値） has amount =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Amount must be a number\u0026#34; unless looks_like_number($_[0]); die \u0026#34;Amount must be non-negative\u0026#34; unless $_[0] \u0026gt;= 0; }, required =\u0026gt; 1, ); # currency: 通貨コード（3文字のISO 4217コード） has currency =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Currency must be a string\u0026#34; unless defined $_[0] \u0026amp;\u0026amp; !ref $_[0]; die \u0026#34;Currency must be 3 characters\u0026#34; unless length($_[0]) == 3; }, required =\u0026gt; 1, ); # 値による等価性の判定 sub equals { my ($self, $other) = @_; return 0 unless $other-\u0026gt;isa(__PACKAGE__); return $self-\u0026gt;amount == $other-\u0026gt;amount \u0026amp;\u0026amp; $self-\u0026gt;currency eq $other-\u0026gt;currency; } # 人間が読みやすい形式で表示 sub to_string { my $self = shift; return sprintf(\u0026#34;%d %s\u0026#34;, $self-\u0026gt;amount, $self-\u0026gt;currency); } use Scalar::Util qw(looks_like_number); 1; コードのポイント use v5.38: Perl 5.38以降の機能を使用（say、stateなど） use Moo: 軽量なオブジェクトシステム use namespace::clean: メソッド名前空間をクリーンに保つ 不変性を実現する is =\u0026gt; 'ro' Mooのis =\u0026gt; 'ro'（read-only）を使うことで、属性を読み取り専用にできます。\n1 2 3 4 has amount =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, # 読み取り専用 # ... ); これにより、以下のようなコードはエラーになります。\n1 2 my $money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); $money-\u0026gt;amount(200); # エラー: Can\u0026#39;t locate object method \u0026#34;amount\u0026#34; via package \u0026#34;Money\u0026#34; セッター（値を変更するメソッド）が生成されないため、オブジェクトの不変性が保証される。\nコンストラクタでのバリデーション isaサブルーチンを使って、コンストラクタの段階でバリデーションを実行できます。\n1 2 3 4 5 6 7 8 has amount =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Amount must be a number\u0026#34; unless looks_like_number($_[0]); die \u0026#34;Amount must be non-negative\u0026#34; unless $_[0] \u0026gt;= 0; }, required =\u0026gt; 1, ); $_[0]には、コンストラクタに渡された値が入る。バリデーションに失敗した場合はdieでエラーを投げる。\nより複雑なバリデーションが必要な場合は、BUILDフックを使うこともできます。\n1 2 3 4 5 6 7 8 sub BUILD { my $self = shift; # 追加のビジネスルールチェック if ($self-\u0026gt;currency eq \u0026#39;JPY\u0026#39; \u0026amp;\u0026amp; $self-\u0026gt;amount != int($self-\u0026gt;amount)) { die \u0026#34;Japanese Yen cannot have decimal places\u0026#34;; } } BUILDは、すべての属性が初期化された後に自動的に呼ばれるメソッドです。\nなぜTest2でテスト駆動開発するのか このシリーズでは、値オブジェクトのテスト駆動開発（TDD）にTest2フレームワークを使用します。Test2は従来のTest::Moreを進化させたモダンなテストフレームワークで、値オブジェクトのテストに最適です。\nTest::Moreとの違い Test2は、従来のTest::Moreを進化させたモダンなテストフレームワークです。\n観点 Test::More Test2 歴史 2001年頃から 2015年以降 拡張性 限定的 プラグイン機構が充実 構造化 基本的なTAP出力 構造化されたイベントシステム データ比較 is_deeplyが必要 isだけで深い比較が可能 Test2の基本的な使い方は以下の通りです。\n1 2 3 4 5 6 7 8 9 10 11 12 use Test2::V0; # 基本的なテスト ok 1, \u0026#39;simple test\u0026#39;; is \u0026#39;foo\u0026#39;, \u0026#39;foo\u0026#39;, \u0026#39;string comparison\u0026#39;; # オブジェクトのテスト my $money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); is $money-\u0026gt;amount, 100, \u0026#39;amount is 100\u0026#39;; is $money-\u0026gt;currency, \u0026#39;JPY\u0026#39;, \u0026#39;currency is JPY\u0026#39;; done_testing; 値オブジェクトのテストに最適な理由 Test2が値オブジェクトのテストに適している理由を見ていきましょう。\n構造化されたデータ比較 1 2 3 4 5 6 7 8 9 10 11 12 use Test2::V0; my $money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); # ハッシュリファレンスとして比較 is { amount =\u0026gt; $money-\u0026gt;amount, currency =\u0026gt; $money-\u0026gt;currency, }, { amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;, }, \u0026#39;Money object has correct values\u0026#39;; 例外テストが簡単 1 2 3 4 5 6 7 8 use Test2::V0; # バリデーションエラーのテスト like( dies { Money-\u0026gt;new(amount =\u0026gt; -100, currency =\u0026gt; \u0026#39;JPY\u0026#39;) }, qr/Amount must be non-negative/, \u0026#39;negative amount throws error\u0026#39; ); サブテストによる整理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Test2::V0; subtest \u0026#39;Money constructor validation\u0026#39; =\u0026gt; sub { subtest \u0026#39;valid values\u0026#39; =\u0026gt; sub { ok lives { Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;) }; }; subtest \u0026#39;invalid amount\u0026#39; =\u0026gt; sub { like( dies { Money-\u0026gt;new(amount =\u0026gt; -100, currency =\u0026gt; \u0026#39;JPY\u0026#39;) }, qr/Amount must be non-negative/ ); }; subtest \u0026#39;invalid currency\u0026#39; =\u0026gt; sub { like( dies { Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JP\u0026#39;) }, qr/Currency must be 3 characters/ ); }; }; done_testing; サブテストを使うと、関連するテストをグループ化でき、テスト結果が読みやすくなります。\n詳しいTest2の使い方については、以前の記事「Test2フレームワーク入門」もご覧ください。\n実践：完全なMoneyクラスとテスト駆動開発 これまでの内容を踏まえて、テスト駆動開発（TDD）で完全なMoney値オブジェクトクラスを実装してみましょう。\nMoneyクラスの実装 lib/Money.pm:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 package Money; use v5.38; use Moo; use namespace::clean; use Scalar::Util qw(looks_like_number); has amount =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Amount must be a number\u0026#34; unless looks_like_number($_[0]); die \u0026#34;Amount must be non-negative\u0026#34; unless $_[0] \u0026gt;= 0; }, required =\u0026gt; 1, ); has currency =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Currency must be a string\u0026#34; unless defined $_[0] \u0026amp;\u0026amp; !ref $_[0]; die \u0026#34;Currency must be 3 characters\u0026#34; unless length($_[0]) == 3; }, required =\u0026gt; 1, ); sub equals { my ($self, $other) = @_; return 0 unless $other-\u0026gt;isa(__PACKAGE__); return $self-\u0026gt;amount == $other-\u0026gt;amount \u0026amp;\u0026amp; $self-\u0026gt;currency eq $other-\u0026gt;currency; } sub add { my ($self, $other) = @_; die \u0026#34;Cannot add different currencies\u0026#34; unless $self-\u0026gt;currency eq $other-\u0026gt;currency; return Money-\u0026gt;new( amount =\u0026gt; $self-\u0026gt;amount + $other-\u0026gt;amount, currency =\u0026gt; $self-\u0026gt;currency, ); } sub to_string { my $self = shift; return sprintf(\u0026#34;%d %s\u0026#34;, $self-\u0026gt;amount, $self-\u0026gt;currency); } 1; テストコード t/money.t:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 use Test2::V0; use lib \u0026#39;lib\u0026#39;; use Money; subtest \u0026#39;constructor validation\u0026#39; =\u0026gt; sub { subtest \u0026#39;valid values create object\u0026#39; =\u0026gt; sub { my $money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); ok $money, \u0026#39;object created\u0026#39;; is $money-\u0026gt;amount, 100, \u0026#39;amount is set\u0026#39;; is $money-\u0026gt;currency, \u0026#39;JPY\u0026#39;, \u0026#39;currency is set\u0026#39;; }; subtest \u0026#39;negative amount is rejected\u0026#39; =\u0026gt; sub { like( dies { Money-\u0026gt;new(amount =\u0026gt; -100, currency =\u0026gt; \u0026#39;JPY\u0026#39;) }, qr/Amount must be non-negative/, \u0026#39;negative amount throws error\u0026#39; ); }; subtest \u0026#39;invalid currency length is rejected\u0026#39; =\u0026gt; sub { like( dies { Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JP\u0026#39;) }, qr/Currency must be 3 characters/, \u0026#39;short currency throws error\u0026#39; ); }; subtest \u0026#39;non-numeric amount is rejected\u0026#39; =\u0026gt; sub { like( dies { Money-\u0026gt;new(amount =\u0026gt; \u0026#39;abc\u0026#39;, currency =\u0026gt; \u0026#39;JPY\u0026#39;) }, qr/Amount must be a number/, \u0026#39;non-numeric amount throws error\u0026#39; ); }; }; subtest \u0026#39;immutability\u0026#39; =\u0026gt; sub { my $money = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); # 読み取り専用なので値を変更できない like( dies { $money-\u0026gt;amount(200) }, qr/Usage:/, \u0026#39;cannot modify amount (read-only)\u0026#39; ); }; subtest \u0026#39;equality\u0026#39; =\u0026gt; sub { my $money1 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money2 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money3 = Money-\u0026gt;new(amount =\u0026gt; 200, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money4 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;USD\u0026#39;); ok $money1-\u0026gt;equals($money2), \u0026#39;same amount and currency are equal\u0026#39;; ok !$money1-\u0026gt;equals($money3), \u0026#39;different amounts are not equal\u0026#39;; ok !$money1-\u0026gt;equals($money4), \u0026#39;different currencies are not equal\u0026#39;; }; subtest \u0026#39;addition\u0026#39; =\u0026gt; sub { my $money1 = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $money2 = Money-\u0026gt;new(amount =\u0026gt; 50, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $result = $money1-\u0026gt;add($money2); is $result-\u0026gt;amount, 150, \u0026#39;amounts are added\u0026#39;; is $result-\u0026gt;currency, \u0026#39;JPY\u0026#39;, \u0026#39;currency is preserved\u0026#39;; # 元のオブジェクトは変更されていない（不変性の確認） is $money1-\u0026gt;amount, 100, \u0026#39;original object is unchanged\u0026#39;; }; subtest \u0026#39;addition with different currencies fails\u0026#39; =\u0026gt; sub { my $jpy = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;JPY\u0026#39;); my $usd = Money-\u0026gt;new(amount =\u0026gt; 100, currency =\u0026gt; \u0026#39;USD\u0026#39;); like( dies { $jpy-\u0026gt;add($usd) }, qr/Cannot add different currencies/, \u0026#39;adding different currencies throws error\u0026#39; ); }; done_testing; テストの実行 テストを実行してみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ perl t/money.t # Subtest: constructor validation # Subtest: valid values create object ok 1 - object created ok 2 - amount is set ok 3 - currency is set 1..3 ok 1 - valid values create object # Subtest: negative amount is rejected ok 1 - negative amount throws error 1..1 ok 2 - negative amount is rejected # Subtest: invalid currency length is rejected ok 1 - short currency throws error 1..1 ok 3 - invalid currency length is rejected # Subtest: non-numeric amount is rejected ok 1 - non-numeric amount throws error 1..1 ok 4 - non-numeric amount is rejected 1..4 ok 1 - constructor validation # ... (以下略) テストコードのポイント サブテストで関連するテストケースをグループ化 正常系と異常系を両方テスト 不変性を明示的に確認 等価性の振る舞いを検証 まとめ：値オブジェクトで始めるドメイン駆動設計 この記事では、ドメイン駆動設計（DDD）における値オブジェクトの基本概念とPerlでの実装方法について学びました。\n重要ポイントのおさらい プリミティブ型の問題点: 意味が不明確、バリデーション不足、型安全性の欠如がある 値オブジェクトの3つの特徴: 不変性（イミュータブル）、値による等価性、バリデーションのカプセル化がDDDの基本 Perl + Mooでの実装: is =\u0026gt; 'ro'で不変性を実現し、isaでバリデーションを集約できる Test2によるテスト駆動開発: 構造化された比較、例外テスト、サブテストによる整理が可能 値オブジェクトは、ビジネスルールをドメインモデルとして型で表現する強力なパターンです。正しい値しか存在できないようにすることで、バグを未然に防ぎ、コードの意図を明確にできます。\n次回予告：JSON-RPC 2.0で学ぶ値オブジェクト設計 次回は「JSON-RPC 2.0で学ぶ値オブジェクト設計 - 仕様から設計へ」と題して、実際のプロトコル仕様から値オブジェクトを設計する方法を学びます。JSON-RPC 2.0の仕様を読み解きながら、どの部分を値オブジェクト化すべきか、どのようなバリデーションルールをドメインモデルとして実装すべきかを考えていきます。\nお楽しみに！\n参考リンク Test2フレームワーク入門 Perl の次世代テストフレームワーク Test2 と Test2::V0 の基本を解説し、実践的なテスト例を紹介します。 nqou.net Moo Minimalist Object Orientation (with Moose compatibility) MetaCPAN Test2::V0 0Th edition of the Test2 recommended bundle. MetaCPAN シリーズ記事一覧 本記事は「Perlで値オブジェクトを使ってテスト駆動開発してみよう」シリーズの第1回です。\n値オブジェクトって何だろう？ - DDDの基本概念とPerlでの実装入門（この記事） JSON-RPC 2.0で学ぶ値オブジェクト設計 - 仕様から設計へ PerlのTest2でTDD実践 - 値オブジェクトのテスト戦略 JSON-RPC Request/Response値オブジェクトの実装 - 複合的な値オブジェクト エラー処理と境界値テスト - 堅牢な値オブジェクトを作る 各記事は独立して読めますが、順番に読むことでPerlにおけるTDDと値オブジェクト設計の全体像が理解できます。\n","date":"2025-12-19T23:45:00+09:00","image":"https://www.nqou.net/public_images/2025/perl-tdd-series-image.jpg","permalink":"https://www.nqou.net/2025/12/19/234500/","title":"【Perl×DDD】値オブジェクト(Value Object)入門 - Mooで実装する不変オブジェクト"},{"content":"Perlでのメール送信 - Email::* モジュール Perlには豊富なメール関連モジュールがあり、シンプルなテキストメールから複雑なMIMEメッセージまで、柔軟に送信できます。\nEmail::Sender の基本 Email::Senderは、現代的なメール送信のためのモジュールです。様々なトランスポート（SMTP、Sendmail等）に対応しています。\nシンプルなテキストメール送信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use Email::Simple; use Email::Sender::Simple qw(sendmail); my $email = Email::Simple-\u0026gt;create( header =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;Test Email\u0026#39;, ], body =\u0026gt; \u0026#34;This is a test email.\\n\u0026#34;, ); sendmail($email); print \u0026#34;メールを送信しました\\n\u0026#34;; SMTPサーバーを指定して送信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use Email::Simple; use Email::Sender::Simple qw(sendmail); use Email::Sender::Transport::SMTP; my $transport = Email::Sender::Transport::SMTP-\u0026gt;new({ host =\u0026gt; \u0026#39;smtp.example.com\u0026#39;, port =\u0026gt; 587, sasl_username =\u0026gt; \u0026#39;username\u0026#39;, sasl_password =\u0026gt; \u0026#39;password\u0026#39;, ssl =\u0026gt; \u0026#39;starttls\u0026#39;, # または \u0026#39;ssl\u0026#39; for SMTPS }); my $email = Email::Simple-\u0026gt;create( header =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;SMTP Test\u0026#39;, ], body =\u0026gt; \u0026#34;Sent via SMTP\\n\u0026#34;, ); sendmail($email, { transport =\u0026gt; $transport }); Gmail経由での送信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Email::Sender::Transport::SMTP::TLS; use Email::Simple; use Email::Sender::Simple qw(sendmail); my $transport = Email::Sender::Transport::SMTP::TLS-\u0026gt;new( host =\u0026gt; \u0026#39;smtp.gmail.com\u0026#39;, port =\u0026gt; 587, username =\u0026gt; \u0026#39;your-email@gmail.com\u0026#39;, password =\u0026gt; \u0026#39;your-app-password\u0026#39;, # アプリパスワードを使用 ); my $email = Email::Simple-\u0026gt;create( header =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;your-email@gmail.com\u0026#39;, Subject =\u0026gt; \u0026#39;Gmail Test\u0026#39;, ], body =\u0026gt; \u0026#34;Sent via Gmail\\n\u0026#34;, ); eval { sendmail($email, { transport =\u0026gt; $transport }); print \u0026#34;メール送信成功\\n\u0026#34;; }; if ($@) { warn \u0026#34;メール送信失敗: $@\\n\u0026#34;; } MIMEメッセージの作成 Email::MIMEを使うと、HTML、添付ファイル、複数パートのメールを作成できます。\nHTMLメールの送信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use Email::MIME; use Email::Sender::Simple qw(sendmail); my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;HTML Email\u0026#39;, ], attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/html\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, encoding =\u0026gt; \u0026#39;quoted-printable\u0026#39;, }, body_str =\u0026gt; \u0026lt;\u0026lt;\u0026#39;HTML\u0026#39;, \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;こんにちは\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;これは\u0026lt;strong\u0026gt;HTML\u0026lt;/strong\u0026gt;メールです。\u0026lt;/p\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;リスト項目1\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;リスト項目2\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; HTML ); sendmail($email); マルチパート（テキスト+HTML） 多くのメールクライアントに対応するため、テキストとHTMLの両方を含めます:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 use Email::MIME; use Email::Sender::Simple qw(sendmail); my $text_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/plain\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, encoding =\u0026gt; \u0026#39;quoted-printable\u0026#39;, }, body_str =\u0026gt; \u0026#34;これはテキスト版です。\\n\u0026#34;, ); my $html_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/html\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, encoding =\u0026gt; \u0026#39;quoted-printable\u0026#39;, }, body_str =\u0026gt; \u0026lt;\u0026lt;\u0026#39;HTML\u0026#39;, \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;これはHTML版です\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;HTML対応のメールクライアントではこちらが表示されます。\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; HTML ); my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;Multipart Email\u0026#39;, ], parts =\u0026gt; [ $text_part, $html_part ], ); sendmail($email); 添付ファイル ファイルを添付する 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 use Email::MIME; use Email::Sender::Simple qw(sendmail); use Path::Tiny; # テキスト本文 my $body_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/plain\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, }, body_str =\u0026gt; \u0026#34;添付ファイル付きのメールです。\\n\u0026#34;, ); # 添付ファイル my $attachment_content = path(\u0026#39;report.pdf\u0026#39;)-\u0026gt;slurp_raw; my $attachment = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;application/pdf\u0026#39;, encoding =\u0026gt; \u0026#39;base64\u0026#39;, filename =\u0026gt; \u0026#39;report.pdf\u0026#39;, name =\u0026gt; \u0026#39;report.pdf\u0026#39;, }, body =\u0026gt; $attachment_content, ); # メール作成 my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;PDFファイル添付\u0026#39;, ], parts =\u0026gt; [ $body_part, $attachment ], ); sendmail($email); 複数ファイルの添付 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 use Email::MIME; use Email::Sender::Simple qw(sendmail); use Path::Tiny; my $body_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/plain\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, }, body_str =\u0026gt; \u0026#34;複数のファイルを添付しました。\\n\u0026#34;, ); my @files = qw(document.pdf image.jpg data.csv); my @attachments = map { my $file = path($_); Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; mime_type($file), encoding =\u0026gt; \u0026#39;base64\u0026#39;, filename =\u0026gt; $file-\u0026gt;basename, name =\u0026gt; $file-\u0026gt;basename, }, body =\u0026gt; $file-\u0026gt;slurp_raw, ); } @files; my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;複数ファイル添付\u0026#39;, ], parts =\u0026gt; [ $body_part, @attachments ], ); sendmail($email); sub mime_type { my $file = shift; my %types = ( pdf =\u0026gt; \u0026#39;application/pdf\u0026#39;, jpg =\u0026gt; \u0026#39;image/jpeg\u0026#39;, png =\u0026gt; \u0026#39;image/png\u0026#39;, csv =\u0026gt; \u0026#39;text/csv\u0026#39;, txt =\u0026gt; \u0026#39;text/plain\u0026#39;, ); my ($ext) = $file =~ /\\.([^.]+)$/; return $types{$ext} || \u0026#39;application/octet-stream\u0026#39;; } テンプレートとの連携 Template Toolkit との統合 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 use Email::MIME; use Email::Sender::Simple qw(sendmail); use Template; my $tt = Template-\u0026gt;new; # HTMLテンプレート my $html_template = \u0026lt;\u0026lt;\u0026#39;TMPL\u0026#39;; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;こんにちは、[% name %]さん\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;ご注文ありがとうございます。\u0026lt;/p\u0026gt; \u0026lt;h2\u0026gt;注文内容\u0026lt;/h2\u0026gt; \u0026lt;ul\u0026gt; [% FOREACH item IN items %] \u0026lt;li\u0026gt;[% item.name %]: [% item.price %]円\u0026lt;/li\u0026gt; [% END %] \u0026lt;/ul\u0026gt; \u0026lt;p\u0026gt;合計: \u0026lt;strong\u0026gt;[% total %]円\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; TMPL # テキストテンプレート my $text_template = \u0026lt;\u0026lt;\u0026#39;TMPL\u0026#39;; こんにちは、[% name %]さん ご注文ありがとうございます。 【注文内容】 [% FOREACH item IN items %] - [% item.name %]: [% item.price %]円 [% END %] 合計: [% total %]円 TMPL my $vars = { name =\u0026gt; \u0026#39;山田太郎\u0026#39;, items =\u0026gt; [ { name =\u0026gt; \u0026#39;商品A\u0026#39;, price =\u0026gt; 1000 }, { name =\u0026gt; \u0026#39;商品B\u0026#39;, price =\u0026gt; 2000 }, ], total =\u0026gt; 3000, }; my ($html_body, $text_body); $tt-\u0026gt;process(\\$html_template, $vars, \\$html_body); $tt-\u0026gt;process(\\$text_template, $vars, \\$text_body); # マルチパートメール作成 my $text_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/plain\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39; }, body_str =\u0026gt; $text_body, ); my $html_part = Email::MIME-\u0026gt;create( attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/html\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39; }, body_str =\u0026gt; $html_body, ); my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; \u0026#39;customer@example.com\u0026#39;, From =\u0026gt; \u0026#39;shop@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;ご注文確認\u0026#39;, ], parts =\u0026gt; [ $text_part, $html_part ], ); sendmail($email); 実用的なメール送信クラス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 package MyApp::Mailer; use Moo; use Email::MIME; use Email::Sender::Simple qw(sendmail); use Email::Sender::Transport::SMTP; use Template; has smtp_host =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); has smtp_port =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, default =\u0026gt; 587); has smtp_username =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); has smtp_password =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); has from_address =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); has transport =\u0026gt; (is =\u0026gt; \u0026#39;lazy\u0026#39;); has template =\u0026gt; (is =\u0026gt; \u0026#39;lazy\u0026#39;); sub _build_transport { my $self = shift; Email::Sender::Transport::SMTP-\u0026gt;new({ host =\u0026gt; $self-\u0026gt;smtp_host, port =\u0026gt; $self-\u0026gt;smtp_port, sasl_username =\u0026gt; $self-\u0026gt;smtp_username, sasl_password =\u0026gt; $self-\u0026gt;smtp_password, ssl =\u0026gt; \u0026#39;starttls\u0026#39;, }); } sub _build_template { Template-\u0026gt;new; } sub send_template_email { my ($self, %args) = @_; my $to = $args{to} or die \u0026#34;to is required\u0026#34;; my $subject = $args{subject} or die \u0026#34;subject is required\u0026#34;; my $template = $args{template} or die \u0026#34;template is required\u0026#34;; my $vars = $args{vars} || {}; # テンプレート処理 my $body; $self-\u0026gt;template-\u0026gt;process(\\$template, $vars, \\$body) or die $self-\u0026gt;template-\u0026gt;error; # メール作成 my $email = Email::MIME-\u0026gt;create( header_str =\u0026gt; [ To =\u0026gt; $to, From =\u0026gt; $self-\u0026gt;from_address, Subject =\u0026gt; $subject, ], attributes =\u0026gt; { content_type =\u0026gt; \u0026#39;text/plain\u0026#39;, charset =\u0026gt; \u0026#39;UTF-8\u0026#39;, }, body_str =\u0026gt; $body, ); # 送信 eval { sendmail($email, { transport =\u0026gt; $self-\u0026gt;transport }); }; if ($@) { warn \u0026#34;Failed to send email: $@\u0026#34;; return 0; } return 1; } # 使用例 package main; my $mailer = MyApp::Mailer-\u0026gt;new( smtp_host =\u0026gt; \u0026#39;smtp.example.com\u0026#39;, smtp_username =\u0026gt; \u0026#39;user\u0026#39;, smtp_password =\u0026gt; \u0026#39;pass\u0026#39;, from_address =\u0026gt; \u0026#39;noreply@example.com\u0026#39;, ); my $template = \u0026lt;\u0026lt;\u0026#39;TMPL\u0026#39;; こんにちは、[% name %]さん あなたの申し込みを受け付けました。 ID: [% user_id %] よろしくお願いします。 TMPL $mailer-\u0026gt;send_template_email( to =\u0026gt; \u0026#39;user@example.com\u0026#39;, subject =\u0026gt; \u0026#39;登録完了\u0026#39;, template =\u0026gt; $template, vars =\u0026gt; { name =\u0026gt; \u0026#39;山田太郎\u0026#39;, user_id =\u0026gt; 12345 }, ); エラーハンドリングとリトライ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use Email::Sender::Simple qw(sendmail); use Email::Simple; use Try::Tiny; sub send_with_retry { my ($email, $max_retries) = @_; $max_retries //= 3; for my $attempt (1..$max_retries) { try { sendmail($email); print \u0026#34;送信成功（試行 $attempt 回目）\\n\u0026#34;; return 1; } catch { warn \u0026#34;送信失敗（試行 $attempt 回目）: $_\\n\u0026#34;; if ($attempt \u0026lt; $max_retries) { sleep 2 ** $attempt; # 指数バックオフ } }; } warn \u0026#34;最大リトライ回数を超えました\\n\u0026#34;; return 0; } my $email = Email::Simple-\u0026gt;create( header =\u0026gt; [ To =\u0026gt; \u0026#39;recipient@example.com\u0026#39;, From =\u0026gt; \u0026#39;sender@example.com\u0026#39;, Subject =\u0026gt; \u0026#39;Test\u0026#39;, ], body =\u0026gt; \u0026#34;Test message\\n\u0026#34;, ); send_with_retry($email, 3); メールのバリデーション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use Email::Valid; my @addresses = ( \u0026#39;valid@example.com\u0026#39;, \u0026#39;invalid@@example.com\u0026#39;, \u0026#39;no-domain@\u0026#39;, \u0026#39;user@example.co.jp\u0026#39;, ); for my $addr (@addresses) { if (Email::Valid-\u0026gt;address($addr)) { print \u0026#34;$addr は有効なメールアドレスです\\n\u0026#34;; } else { print \u0026#34;$addr は無効なメールアドレスです\\n\u0026#34;; } } まとめ Email::Sender: 現代的なメール送信フレームワーク Email::MIME: HTML、添付ファイル、マルチパートに対応 Template Toolkit: テンプレートでメール本文を生成 エラーハンドリング: try/catchとリトライ機構を実装 バリデーション: Email::Validでアドレスを検証 メール送信は失敗する可能性があるため、適切なエラーハンドリングとログ記録を実装しましょう。また、スパム対策として、SPF、DKIM、DMARCの設定も忘れずに。\n","date":"2025-12-19T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251219000000-image.jpg","permalink":"https://www.nqou.net/2025/12/19/000000/","title":"Perlでのメール送信 — Email::* モジュール"},{"content":"Perlでの暗号化 - Crypt::* モジュール群 セキュリティは現代のアプリケーション開発において最重要課題の一つです。Perlには暗号化関連の強力なCPANモジュール群が揃っており、パスワード保護からデータ暗号化まで幅広く対応できます。\nパスワードハッシュ化 パスワードは絶対に平文で保存してはいけません。必ずハッシュ化して保存します。\nbcrypt を使ったパスワードハッシュ化 bcryptは、計算コストを調整できる強力なパスワードハッシュアルゴリズムです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use Crypt::Bcrypt qw(bcrypt bcrypt_check); # パスワードのハッシュ化 my $password = \u0026#39;my_secure_password\u0026#39;; my $hash = bcrypt($password, \u0026#39;2b\u0026#39;, 12); # cost=12 print \u0026#34;Hash: $hash\\n\u0026#34;; # パスワードの検証 if (bcrypt_check($password, $hash)) { print \u0026#34;パスワードが一致しました\\n\u0026#34;; } else { print \u0026#34;パスワードが一致しません\\n\u0026#34;; } # 間違ったパスワードで検証 if (bcrypt_check(\u0026#39;wrong_password\u0026#39;, $hash)) { print \u0026#34;一致\\n\u0026#34;; } else { print \u0026#34;不一致\\n\u0026#34;; # これが表示される } bcryptのcostパラメータは、計算時間を決定します。値が大きいほど安全ですが、処理に時間がかかります。一般的には12〜14が推奨されます。\nArgon2 を使ったパスワードハッシュ化 Argon2は、パスワードハッシュコンテストの優勝アルゴリズムで、最新の推奨方式です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Crypt::Argon2 qw(argon2id_pass argon2id_verify); use Crypt::Random qw(makerandom_octet); my $password = \u0026#39;my_secure_password\u0026#39;; # 16バイトのランダムソルトを生成（セキュアに） my $salt = makerandom_octet(Length =\u0026gt; 16); # Argon2id（推奨）でハッシュ化 my $hash = argon2id_pass( $password, $salt, # ランダムに生成されたソルト 3, # time cost（繰り返し回数） \u0026#39;32M\u0026#39;, # memory cost（メモリ使用量） 1, # parallelism（並列度） 16 # tag length（出力長） ); print \u0026#34;Salt (hex): \u0026#34; . unpack(\u0026#39;H*\u0026#39;, $salt) . \u0026#34;\\n\u0026#34;; print \u0026#34;Hash: $hash\\n\u0026#34;; # 検証 if (argon2id_verify($hash, $password)) { print \u0026#34;パスワードが一致しました\\n\u0026#34;; } else { print \u0026#34;パスワードが一致しません\\n\u0026#34;; } パスワードハッシュのベストプラクティス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 use Crypt::Bcrypt qw(bcrypt bcrypt_check); # ユーザー登録時 sub register_user { my ($username, $password) = @_; # パスワードの強度チェック die \u0026#34;パスワードは8文字以上必要です\u0026#34; if length($password) \u0026lt; 8; die \u0026#34;パスワードに英数字を含めてください\u0026#34; unless $password =~ /[A-Za-z]/ \u0026amp;\u0026amp; $password =~ /[0-9]/; # bcryptでハッシュ化（cost=12） my $hash = bcrypt($password, \u0026#39;2b\u0026#39;, 12); # データベースに保存 save_to_database($username, $hash); } # ログイン時 sub login_user { my ($username, $password) = @_; # データベースからハッシュを取得 my $stored_hash = get_from_database($username); return unless $stored_hash; # タイミング攻撃を防ぐため、常に検証を実行 if (bcrypt_check($password, $stored_hash)) { return { success =\u0026gt; 1, username =\u0026gt; $username }; } return { success =\u0026gt; 0 }; } データの暗号化 AES による対称鍵暗号化 AESは、現在最も広く使われている対称鍵暗号アルゴリズムです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use Crypt::Mode::CBC; use Crypt::PRNG; # 暗号化キー（256ビット = 32バイト）安全なランダム値を生成 # 本番環境では環境変数やKMSから取得することを推奨 my $key = Crypt::PRNG::random_bytes(32); # 初期化ベクトル（16バイト）毎回ランダムに生成 my $iv = Crypt::PRNG::random_bytes(16); my $cbc = Crypt::Mode::CBC-\u0026gt;new(\u0026#39;AES\u0026#39;); # 暗号化 my $plaintext = \u0026#39;This is a secret message\u0026#39;; my $ciphertext = $cbc-\u0026gt;encrypt($plaintext, $key, $iv); # IVを先頭に付加して保存/送信する（IVは秘密にする必要はない） my $output = $iv . $ciphertext; print \u0026#34;Encrypted (IV+ciphertext): \u0026#34;, unpack(\u0026#39;H*\u0026#39;, $output), \u0026#34;\\n\u0026#34;; # 復号化 # 受信時はIVと暗号文を分離する my $received_iv = substr($output, 0, 16); my $received_ciphertext = substr($output, 16); my $decrypted = $cbc-\u0026gt;decrypt($received_ciphertext, $key, $received_iv); print \u0026#34;Decrypted: $decrypted\\n\u0026#34;; セキュリティ上の重要なポイント:\nキーは絶対にコードに埋め込まず、環境変数やKMSから取得する IVは毎回ランダムに生成し、暗号文と一緒に保存/送信する より高度なセキュリティが必要な場合はAEAD（AES-GCM等）を使用 実用的な暗号化クラス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 package SecureStorage; use Moo; use Crypt::Mode::CBC; use Crypt::Random qw(makerandom_octet); use MIME::Base64 qw(encode_base64 decode_base64); has key =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); sub encrypt { my ($self, $plaintext) = @_; # ランダムなIVを生成（16バイト） my $iv = makerandom_octet(Length =\u0026gt; 16); my $cbc = Crypt::Mode::CBC-\u0026gt;new(\u0026#39;AES\u0026#39;); my $ciphertext = $cbc-\u0026gt;encrypt($plaintext, $self-\u0026gt;key, $iv); # IV + 暗号文をBase64エンコードして返す return encode_base64($iv . $ciphertext, \u0026#39;\u0026#39;); } sub decrypt { my ($self, $encrypted) = @_; my $data = decode_base64($encrypted); # 最初の16バイトがIV my $iv = substr($data, 0, 16); my $ciphertext = substr($data, 16); my $cbc = Crypt::Mode::CBC-\u0026gt;new(\u0026#39;AES\u0026#39;); return $cbc-\u0026gt;decrypt($ciphertext, $self-\u0026gt;key, $iv); } # 使用例 package main; # 256ビットキーを生成（実際には安全に保管） my $key = Crypt::Random::makerandom_octet(Length =\u0026gt; 32); my $storage = SecureStorage-\u0026gt;new(key =\u0026gt; $key); my $secret = \u0026#34;My credit card number is 1234-5678-9012-3456\u0026#34;; my $encrypted = $storage-\u0026gt;encrypt($secret); print \u0026#34;Encrypted: $encrypted\\n\u0026#34;; my $decrypted = $storage-\u0026gt;decrypt($encrypted); print \u0026#34;Decrypted: $decrypted\\n\u0026#34;; 公開鍵暗号 RSAを使った公開鍵暗号化の例:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Crypt::PK::RSA; # RSA鍵ペアの生成 my $pk = Crypt::PK::RSA-\u0026gt;new(); $pk-\u0026gt;generate_key(2048); # 2048ビット鍵 # 公開鍵と秘密鍵をPEM形式で保存 my $public_pem = $pk-\u0026gt;export_key_pem(\u0026#39;public\u0026#39;); my $private_pem = $pk-\u0026gt;export_key_pem(\u0026#39;private\u0026#39;); # 公開鍵で暗号化 my $message = \u0026#34;Secret message\u0026#34;; my $encrypted = $pk-\u0026gt;encrypt($message, \u0026#39;oaep\u0026#39;); print \u0026#34;Encrypted: \u0026#34;, unpack(\u0026#39;H*\u0026#39;, $encrypted), \u0026#34;\\n\u0026#34;; # 秘密鍵で復号化 my $decrypted = $pk-\u0026gt;decrypt($encrypted, \u0026#39;oaep\u0026#39;); print \u0026#34;Decrypted: $decrypted\\n\u0026#34;; メッセージ認証コード (HMAC) データの改ざん検出にHMACを使用:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use Crypt::Mac::HMAC qw(hmac_hex); my $secret_key = \u0026#39;my_secret_key\u0026#39;; my $message = \u0026#39;Important message\u0026#39;; # HMAC-SHA256でメッセージ認証コードを生成 my $mac = hmac_hex(\u0026#39;SHA256\u0026#39;, $secret_key, $message); print \u0026#34;MAC: $mac\\n\u0026#34;; # メッセージの検証 sub verify_message { my ($message, $mac, $key) = @_; my $expected_mac = hmac_hex(\u0026#39;SHA256\u0026#39;, $key, $message); return $mac eq $expected_mac; } if (verify_message($message, $mac, $secret_key)) { print \u0026#34;メッセージは正当です\\n\u0026#34;; } else { print \u0026#34;メッセージが改ざんされています\\n\u0026#34;; } # 改ざんされたメッセージ my $tampered = \u0026#39;Important message!\u0026#39;; if (verify_message($tampered, $mac, $secret_key)) { print \u0026#34;正当\\n\u0026#34;; } else { print \u0026#34;改ざん検出！\\n\u0026#34;; # これが表示される } ハッシュ関数 1 2 3 4 5 6 7 8 9 10 11 use Crypt::Digest::SHA256 qw(sha256_hex sha256_base64); use Crypt::Digest::SHA3_256 qw(sha3_256_hex); my $data = \u0026#34;Hello, World!\u0026#34;; # SHA-256 print \u0026#34;SHA-256: \u0026#34;, sha256_hex($data), \u0026#34;\\n\u0026#34;; print \u0026#34;SHA-256 (Base64): \u0026#34;, sha256_base64($data), \u0026#34;\\n\u0026#34;; # SHA3-256（最新のSHA-3） print \u0026#34;SHA3-256: \u0026#34;, sha3_256_hex($data), \u0026#34;\\n\u0026#34;; セキュリティベストプラクティス 1. 鍵の安全な管理 1 2 3 4 5 6 7 8 9 10 11 12 13 use Crypt::Random qw(makerandom_octet); use Path::Tiny; # 安全なランダムキーの生成 my $key = makerandom_octet(Length =\u0026gt; 32); # 環境変数から読み込む（推奨） my $encryption_key = pack(\u0026#39;H*\u0026#39;, $ENV{ENCRYPTION_KEY}) or die \u0026#34;ENCRYPTION_KEY environment variable not set\\n\u0026#34;; # ファイルから読み込む場合（パーミッションに注意） # chmod 600 /path/to/keyfile my $key_from_file = path(\u0026#39;/path/to/keyfile\u0026#39;)-\u0026gt;slurp_raw; 2. ソルトの使用 1 2 3 4 5 6 7 8 9 use Crypt::Bcrypt qw(bcrypt); use Crypt::Random qw(makerandom_octet); # bcryptは自動的にソルトを含む my $hash = bcrypt($password, \u0026#39;2b\u0026#39;, 12); # 手動でソルトを扱う場合 my $salt = makerandom_octet(Length =\u0026gt; 16); my $salted_password = $salt . $password; 3. タイミング攻撃の防止 1 2 3 4 5 6 7 8 # 文字列比較は eq ではなく、タイミングセーフな比較を使用 use Crypt::Util qw(constant_time_equal); if (constant_time_equal($provided_mac, $expected_mac)) { # OK } # bcrypt_check は内部でタイミングセーフな比較を使用 実用例: セキュアなAPIトークン生成 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 use Moo; use Crypt::Random qw(makerandom_octet); use Crypt::Digest::SHA256 qw(sha256_hex); use MIME::Base64 qw(encode_base64url); package APIToken; sub generate { my ($class) = @_; # 32バイトのランダムデータを生成 my $random = makerandom_octet(Length =\u0026gt; 32); # Base64url エンコード（URL-safe） my $token = encode_base64url($random, \u0026#39;\u0026#39;); return $token; } sub hash_token { my ($class, $token) = @_; # トークンのハッシュを保存（トークン自体は保存しない） return sha256_hex($token); } package main; # トークン生成 my $token = APIToken-\u0026gt;generate(); print \u0026#34;Token: $token\\n\u0026#34;; # ハッシュ化して保存 my $token_hash = APIToken-\u0026gt;hash_token($token); print \u0026#34;Token hash (store this): $token_hash\\n\u0026#34;; # 検証時 my $provided_token = $token; my $provided_hash = APIToken-\u0026gt;hash_token($provided_token); if ($provided_hash eq $token_hash) { print \u0026#34;トークンが有効です\\n\u0026#34;; } まとめ パスワード: bcryptまたはArgon2でハッシュ化、平文保存は絶対NG データ暗号化: AESなどの対称鍵暗号を使用 鍵管理: 鍵はコードに含めず、環境変数や専用のキー管理システムを使用 ランダム性: 暗号学的に安全な乱数生成器を使用（Crypt::Random） HMAC: データの完全性検証にはHMACを使用 タイミング攻撃: 秘密情報の比較には定数時間比較を使用 暗号化は正しく使わないと逆に危険です。標準的なモジュールとベストプラクティスに従い、独自の暗号化方式は作らないようにしましょう。\n","date":"2025-12-18T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251218000000-image.jpg","permalink":"https://www.nqou.net/2025/12/18/000000/","title":"Perlでの暗号化 — Crypt::* モジュール群"},{"content":"Perlでの非同期処理 - IO::Async と Mojo::IOLoop 非同期プログラミングは、I/O待ちの時間を有効活用して、複数の処理を並行して扱う技術です。Perlには優れた非同期処理のライブラリが存在し、その中でもIO::AsyncとMojo::IOLoopが代表的です。\nイベント駆動プログラミングの基本 イベント駆動プログラミングでは、処理をブロックせずにイベントループでイベントを待ち受けます。これにより、I/O待ちの間に他の処理を実行できます。\n1 2 3 4 5 6 7 8 # 同期的な処理（ブロッキング） my $result1 = fetch_data($url1); # 完了まで待つ my $result2 = fetch_data($url2); # result1完了後に実行 # 非同期処理（ノンブロッキング） fetch_data_async($url1, sub { my $result1 = shift; }); fetch_data_async($url2, sub { my $result2 = shift; }); # 両方同時に実行される IO::Async の使い方 IO::Asyncは、Future/Promiseベースの非同期フレームワークです。\n基本的な使い方 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use IO::Async::Loop; use IO::Async::Timer::Countdown; my $loop = IO::Async::Loop-\u0026gt;new; # タイマーの作成 my $timer = IO::Async::Timer::Countdown-\u0026gt;new( delay =\u0026gt; 3, on_expire =\u0026gt; sub { print \u0026#34;3秒経過しました\\n\u0026#34;; $loop-\u0026gt;stop; }, ); $loop-\u0026gt;add($timer); $timer-\u0026gt;start; print \u0026#34;タイマー開始\\n\u0026#34;; $loop-\u0026gt;run; 複数のタイマーを同時実行 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use IO::Async::Loop; use IO::Async::Timer::Countdown; my $loop = IO::Async::Loop-\u0026gt;new; my @timers; for my $delay (1, 2, 3) { my $timer = IO::Async::Timer::Countdown-\u0026gt;new( delay =\u0026gt; $delay, on_expire =\u0026gt; sub { print \u0026#34;${delay}秒のタイマーが完了\\n\u0026#34;; }, ); $loop-\u0026gt;add($timer); $timer-\u0026gt;start; push @timers, $timer; } # 3秒後にループを停止 my $stop_timer = IO::Async::Timer::Countdown-\u0026gt;new( delay =\u0026gt; 3.5, on_expire =\u0026gt; sub { $loop-\u0026gt;stop }, ); $loop-\u0026gt;add($stop_timer); $stop_timer-\u0026gt;start; $loop-\u0026gt;run; IO::Async での非同期HTTP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use IO::Async::Loop; use Net::Async::HTTP; use Future::Utils qw(fmap_void); my $loop = IO::Async::Loop-\u0026gt;new; my $http = Net::Async::HTTP-\u0026gt;new; $loop-\u0026gt;add($http); my @urls = ( \u0026#39;https://www.perl.org/\u0026#39;, \u0026#39;https://metacpan.org/\u0026#39;, \u0026#39;https://perldoc.perl.org/\u0026#39;, ); # 並行して複数URLを取得 my @futures = map { my $url = $_; $http-\u0026gt;GET($url)-\u0026gt;then(sub { my $response = shift; printf \u0026#34;%s: %d bytes\\n\u0026#34;, $url, length($response-\u0026gt;content); Future-\u0026gt;done; })-\u0026gt;catch(sub { my $error = shift; warn \u0026#34;Failed to fetch $url: $error\\n\u0026#34;; Future-\u0026gt;done; }); } @urls; Future-\u0026gt;wait_all(@futures)-\u0026gt;get; IO::Async::Process でプロセス実行 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use IO::Async::Loop; use IO::Async::Process; my $loop = IO::Async::Loop-\u0026gt;new; my $process = IO::Async::Process-\u0026gt;new( command =\u0026gt; [\u0026#39;perl\u0026#39;, \u0026#39;-e\u0026#39;, \u0026#39;print \u0026#34;Hello from child\\n\u0026#34;; sleep 2; print \u0026#34;Done\\n\u0026#34;\u0026#39;], stdout =\u0026gt; { on_read =\u0026gt; sub { my ($stream, $buffref) = @_; print \u0026#34;Child: $$buffref\u0026#34;; $$buffref = \u0026#39;\u0026#39;; return 0; }, }, on_finish =\u0026gt; sub { my ($self, $exitcode) = @_; print \u0026#34;Child process finished with exit code $exitcode\\n\u0026#34;; $loop-\u0026gt;stop; }, ); $loop-\u0026gt;add($process); print \u0026#34;Starting child process...\\n\u0026#34;; $loop-\u0026gt;run; Mojo::IOLoop の活用 Mojo::IOLoopは、Mojoliciousフレームワークの一部として提供される非同期イベントループです。\n基本的なタイマー 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Mojo::IOLoop; # 2秒後に実行 Mojo::IOLoop-\u0026gt;timer(2 =\u0026gt; sub { my $loop = shift; say \u0026#39;2秒経過しました\u0026#39;; }); # 1秒ごとに実行（5回まで） my $count = 0; my $id = Mojo::IOLoop-\u0026gt;recurring(1 =\u0026gt; sub { my $loop = shift; $count++; say \u0026#34;Tick $count\u0026#34;; $loop-\u0026gt;remove($id) if $count \u0026gt;= 5; }); # ループ開始 Mojo::IOLoop-\u0026gt;start unless Mojo::IOLoop-\u0026gt;is_running; Mojo::IOLoop での非同期HTTP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use Mojo::UserAgent; use Mojo::IOLoop; my $ua = Mojo::UserAgent-\u0026gt;new; my @urls = qw( https://www.perl.org/ https://metacpan.org/ https://perldoc.perl.org/ ); my $count = 0; for my $url (@urls) { $ua-\u0026gt;get($url =\u0026gt; sub { my ($ua, $tx) = @_; if (my $res = $tx-\u0026gt;success) { printf \u0026#34;%s: %d bytes\\n\u0026#34;, $url, length($res-\u0026gt;body); } else { my $err = $tx-\u0026gt;error; warn \u0026#34;Failed to fetch $url: $err-\u0026gt;{message}\\n\u0026#34;; } $count++; Mojo::IOLoop-\u0026gt;stop if $count == @urls; }); } Mojo::IOLoop-\u0026gt;start unless Mojo::IOLoop-\u0026gt;is_running; WebSocketの非同期処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use Mojo::UserAgent; use Mojo::IOLoop; my $ua = Mojo::UserAgent-\u0026gt;new; # WebSocket接続（エコーサーバー） $ua-\u0026gt;websocket(\u0026#39;wss://echo.websocket.org/\u0026#39; =\u0026gt; sub { my ($ua, $tx) = @_; unless ($tx-\u0026gt;is_websocket) { say \u0026#39;WebSocket handshake failed!\u0026#39;; return; } say \u0026#39;WebSocket connected\u0026#39;; # メッセージ受信時 $tx-\u0026gt;on(message =\u0026gt; sub { my ($tx, $msg) = @_; say \u0026#34;Received: $msg\u0026#34;; $tx-\u0026gt;finish; }); # メッセージ送信 $tx-\u0026gt;send(\u0026#39;Hello WebSocket!\u0026#39;); }); Mojo::IOLoop-\u0026gt;start unless Mojo::IOLoop-\u0026gt;is_running; 実用例: 並行ファイルダウンロード IO::AsyncとNet::Async::HTTPを使った並行ダウンロード:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 use IO::Async::Loop; use Net::Async::HTTP; use Path::Tiny; use Future::Utils qw(fmap_void); my $loop = IO::Async::Loop-\u0026gt;new; my $http = Net::Async::HTTP-\u0026gt;new(max_connections_per_host =\u0026gt; 4); $loop-\u0026gt;add($http); sub download_file { my ($url, $output_path) = @_; $http-\u0026gt;GET($url)-\u0026gt;then(sub { my $response = shift; path($output_path)-\u0026gt;spew_raw($response-\u0026gt;content); printf \u0026#34;Downloaded: %s (%d bytes)\\n\u0026#34;, $url, length($response-\u0026gt;content); Future-\u0026gt;done; })-\u0026gt;catch(sub { my $error = shift; warn \u0026#34;Failed to download $url: $error\\n\u0026#34;; Future-\u0026gt;done; }); } my %downloads = ( \u0026#39;https://www.perl.org/favicon.ico\u0026#39; =\u0026gt; \u0026#39;/tmp/perl.ico\u0026#39;, \u0026#39;https://metacpan.org/favicon.ico\u0026#39; =\u0026gt; \u0026#39;/tmp/metacpan.ico\u0026#39;, ); my @futures = map { download_file($_, $downloads{$_}) } keys %downloads; Future-\u0026gt;wait_all(@futures)-\u0026gt;get; パフォーマンス比較 同期処理と非同期処理の実行時間の違い:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use Time::HiRes qw(time); use Mojo::UserAgent; my $ua = Mojo::UserAgent-\u0026gt;new; my @urls = (\u0026#39;https://www.perl.org/\u0026#39;) x 5; # 同期処理 my $start = time; for my $url (@urls) { $ua-\u0026gt;get($url)-\u0026gt;result; } printf \u0026#34;Synchronous: %.2f seconds\\n\u0026#34;, time - $start; # 非同期処理 $start = time; my $count = 0; for my $url (@urls) { $ua-\u0026gt;get($url =\u0026gt; sub { $count++; Mojo::IOLoop-\u0026gt;stop if $count == @urls; }); } Mojo::IOLoop-\u0026gt;start; printf \u0026#34;Asynchronous: %.2f seconds\\n\u0026#34;, time - $start; まとめ IO::Async: Future/Promiseベースで、複雑な非同期フローを扱いやすい Mojo::IOLoop: シンプルで直感的、Mojoliciousと統合されている 非同期処理により、I/O待ちを有効活用して並行処理が可能 適切に使えば、パフォーマンスが大幅に向上する どちらのライブラリも優れていますが、既にMojoliciousを使っている場合はMojo::IOLoop、より汎用的な非同期処理が必要な場合はIO::Asyncが適しています。\n","date":"2025-12-17T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251217000000-image.jpg","permalink":"https://www.nqou.net/2025/12/17/000000/","title":"Perlでの非同期処理 — IO::Async と Mojo::IOLoop"},{"content":"Perlでの並行・並列処理 - Parallel::ForkManager 大量のデータを処理する場合や、複数の独立したタスクを実行する場合、並列処理を活用することで処理時間を大幅に短縮できます。Parallel::ForkManager は、Perlで並列処理を実現する最も人気のあるモジュールの一つです。fork を使ったマルチプロセス処理を簡単に扱えるようにします。\n並行処理と並列処理の違い まず、用語の整理をしておきましょう：\n並行処理（Concurrency）: 複数のタスクを交互に実行し、同時に進行しているように見せる 並列処理（Parallelism）: 複数のタスクを物理的に同時に実行する Parallel::ForkManager は、fork を使って複数のプロセスを生成するため、真の並列処理を実現します。マルチコアCPUで複数のプロセスが本当に同時に実行されます。\nParallel::ForkManager の基本 インストール 1 cpanm Parallel::ForkManager 最もシンプルな例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Parallel::ForkManager; use feature qw(say); # 最大3つの子プロセスを並列実行 my $pm = Parallel::ForkManager-\u0026gt;new(3); for my $i (1..10) { # 子プロセスを起動 $pm-\u0026gt;start and next; # ここから子プロセスの処理 say \u0026#34;プロセス $i 開始\u0026#34;; sleep 2; # 処理をシミュレート say \u0026#34;プロセス $i 完了\u0026#34;; # 子プロセス終了 $pm-\u0026gt;finish; } # すべての子プロセスが終了するまで待つ $pm-\u0026gt;wait_all_children; say \u0026#34;全プロセス完了\u0026#34;; このコードは：\n最大3つの子プロセスを同時実行 10個のタスクを順次処理 各タスクが2秒かかる 逐次処理なら20秒かかるが、並列処理で約8秒で完了 基本的な仕組み 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 use Parallel::ForkManager; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(2); # 最大2プロセス # データのリスト my @tasks = (1..5); for my $task (@tasks) { # start() は親プロセスで子プロセスのPIDを返し、 # 子プロセスでは0を返す my $pid = $pm-\u0026gt;start; if ($pid) { # 親プロセス say \u0026#34;親: タスク $task を子プロセス $pid で開始\u0026#34;; next; # 次のイテレーションへ } # 以下は子プロセスのみ実行 say \u0026#34;子: タスク $task を処理中（PID: $$）\u0026#34;; sleep 1; # finish() を呼んで子プロセス終了 $pm-\u0026gt;finish; } # すべての子プロセスの終了を待つ $pm-\u0026gt;wait_all_children; say \u0026#34;親: すべてのタスク完了\u0026#34;; 実用例 Webスクレイピング 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 use Parallel::ForkManager; use HTTP::Tiny; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(5); # 同時に5つまで my @urls = ( \u0026#39;https://example.com/page1\u0026#39;, \u0026#39;https://example.com/page2\u0026#39;, \u0026#39;https://example.com/page3\u0026#39;, \u0026#39;https://example.com/page4\u0026#39;, \u0026#39;https://example.com/page5\u0026#39;, \u0026#39;https://example.com/page6\u0026#39;, ); for my $url (@urls) { $pm-\u0026gt;start and next; # 各子プロセスでHTTPリクエスト say \u0026#34;取得開始: $url (PID: $$)\u0026#34;; my $http = HTTP::Tiny-\u0026gt;new(timeout =\u0026gt; 10); my $response = $http-\u0026gt;get($url); if ($response-\u0026gt;{success}) { my $length = length($response-\u0026gt;{content}); say \u0026#34;完了: $url - ${length}バイト\u0026#34;; } else { say \u0026#34;エラー: $url - $response-\u0026gt;{status} $response-\u0026gt;{reason}\u0026#34;; } $pm-\u0026gt;finish; } $pm-\u0026gt;wait_all_children; say \u0026#34;すべてのURLを取得しました\u0026#34;; バッチ処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Parallel::ForkManager; use feature qw(say); # 大量の画像ファイルをリサイズする例 my @images = glob(\u0026#39;/path/to/images/*.jpg\u0026#39;); my $pm = Parallel::ForkManager-\u0026gt;new(4); # CPUコア数に応じて調整 for my $image (@images) { $pm-\u0026gt;start and next; say \u0026#34;処理中: $image\u0026#34;; # 画像処理をシミュレート # 実際には ImageMagick などを使用 system(\u0026#34;convert\u0026#34;, $image, \u0026#34;-resize\u0026#34;, \u0026#34;800x600\u0026#34;, \u0026#34;resized_$image\u0026#34;); say \u0026#34;完了: $image\u0026#34;; $pm-\u0026gt;finish; } $pm-\u0026gt;wait_all_children; say \u0026#34;すべての画像処理が完了しました\u0026#34;; ログファイルの並列解析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Parallel::ForkManager; use feature qw(say); my @log_files = glob(\u0026#39;/var/log/app/*.log\u0026#39;); my $pm = Parallel::ForkManager-\u0026gt;new(8); my %results; for my $log_file (@log_files) { $pm-\u0026gt;start and next; say \u0026#34;解析中: $log_file\u0026#34;; open my $fh, \u0026#39;\u0026lt;\u0026#39;, $log_file or die \u0026#34;ファイルが開けません: $!\u0026#34;; my $error_count = 0; my $warning_count = 0; while (my $line = \u0026lt;$fh\u0026gt;) { $error_count++ if $line =~ /ERROR/; $warning_count++ if $line =~ /WARN/; } close $fh; say \u0026#34;$log_file: ERROR=$error_count, WARN=$warning_count\u0026#34;; $pm-\u0026gt;finish; } $pm-\u0026gt;wait_all_children; say \u0026#34;ログ解析完了\u0026#34;; 子プロセスからのデータ取得 子プロセスの処理結果を親プロセスに返すには、コールバックを使用します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Parallel::ForkManager; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(3); # 子プロセスが終了したときのコールバック $pm-\u0026gt;run_on_finish(sub { my ($pid, $exit_code, $ident, $exit_signal, $core_dump, $data) = @_; if (defined $data) { say \u0026#34;PID $pid の結果: $data-\u0026gt;{result}\u0026#34;; } }); for my $i (1..5) { $pm-\u0026gt;start and next; # 処理をシミュレート my $result = $i * $i; sleep 1; # データを親プロセスに渡す $pm-\u0026gt;finish(0, { result =\u0026gt; $result }); } $pm-\u0026gt;wait_all_children; say \u0026#34;すべての計算完了\u0026#34;; より複雑なデータの受け渡し 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 use Parallel::ForkManager; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(4); my %all_results; $pm-\u0026gt;run_on_finish(sub { my ($pid, $exit_code, $ident, $exit_signal, $core_dump, $data) = @_; if (defined $data) { $all_results{$data-\u0026gt;{file}} = { lines =\u0026gt; $data-\u0026gt;{lines}, words =\u0026gt; $data-\u0026gt;{words}, chars =\u0026gt; $data-\u0026gt;{chars}, }; } }); my @files = qw(file1.txt file2.txt file3.txt); for my $file (@files) { $pm-\u0026gt;start and next; # ファイルの統計情報を取得 open my $fh, \u0026#39;\u0026lt;\u0026#39;, $file or die \u0026#34;Cannot open $file: $!\u0026#34;; my $lines = 0; my $words = 0; my $chars = 0; while (my $line = \u0026lt;$fh\u0026gt;) { $lines++; $chars += length($line); $words += scalar(split /\\s+/, $line); } close $fh; # 結果を返す $pm-\u0026gt;finish(0, { file =\u0026gt; $file, lines =\u0026gt; $lines, words =\u0026gt; $words, chars =\u0026gt; $chars, }); } $pm-\u0026gt;wait_all_children; # 結果を表示 say \u0026#34;=== ファイル統計 ===\u0026#34;; for my $file (keys %all_results) { my $stats = $all_results{$file}; say \u0026#34;$file:\u0026#34;; say \u0026#34; 行数: $stats-\u0026gt;{lines}\u0026#34;; say \u0026#34; 単語数: $stats-\u0026gt;{words}\u0026#34;; say \u0026#34; 文字数: $stats-\u0026gt;{chars}\u0026#34;; } エラーハンドリング 基本的なエラー処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Parallel::ForkManager; use Try::Tiny; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(3); # エラー発生時のコールバック $pm-\u0026gt;run_on_finish(sub { my ($pid, $exit_code) = @_; if ($exit_code != 0) { say \u0026#34;PID $pid がエラー終了しました（終了コード: $exit_code）\u0026#34;; } }); for my $i (1..5) { $pm-\u0026gt;start and next; try { # エラーが起こる可能性のある処理 die \u0026#34;意図的なエラー\u0026#34; if $i == 3; say \u0026#34;タスク $i 成功\u0026#34;; $pm-\u0026gt;finish(0); # 成功 } catch { say \u0026#34;タスク $i でエラー: $_\u0026#34;; $pm-\u0026gt;finish(1); # エラー終了 }; } $pm-\u0026gt;wait_all_children; タイムアウト処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use Parallel::ForkManager; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(3); for my $i (1..5) { $pm-\u0026gt;start and next; # タイムアウト設定（5秒） local $SIG{ALRM} = sub { die \u0026#34;タイムアウト\\n\u0026#34; }; alarm 5; eval { say \u0026#34;タスク $i 開始\u0026#34;; # 時間がかかる処理をシミュレート sleep($i * 2); say \u0026#34;タスク $i 完了\u0026#34;; alarm 0; # アラームをキャンセル }; if ($@) { if ($@ =~ /タイムアウト/) { say \u0026#34;タスク $i がタイムアウトしました\u0026#34;; $pm-\u0026gt;finish(1); } else { die $@; } } $pm-\u0026gt;finish(0); } $pm-\u0026gt;wait_all_children; パフォーマンス最適化 適切なプロセス数の設定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Parallel::ForkManager; use Sys::Info; use feature qw(say); # CPU コア数を取得 my $info = Sys::Info-\u0026gt;new; my $cpu = $info-\u0026gt;device(\u0026#39;CPU\u0026#39;); my $cpu_count = $cpu-\u0026gt;count || 4; # 取得できない場合は4 say \u0026#34;検出されたCPUコア数: $cpu_count\u0026#34;; # CPUバウンドな処理の場合はコア数と同じ my $pm = Parallel::ForkManager-\u0026gt;new($cpu_count); # I/Oバウンドな処理の場合はコア数の2倍程度 # my $pm = Parallel::ForkManager-\u0026gt;new($cpu_count * 2); # 処理... データの分割方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use Parallel::ForkManager; use List::Util qw(sum); use feature qw(say); # 大量のデータを効率的に処理 my @data = (1..10000); my $chunk_size = 100; my $pm = Parallel::ForkManager-\u0026gt;new(4); my @results; $pm-\u0026gt;run_on_finish(sub { my ($pid, $exit_code, $ident, $exit_signal, $core_dump, $data) = @_; push @results, @{$data-\u0026gt;{results}} if $data; }); # データをチャンクに分割して処理 for (my $i = 0; $i \u0026lt; @data; $i += $chunk_size) { $pm-\u0026gt;start and next; my $end = $i + $chunk_size - 1; $end = $#data if $end \u0026gt; $#data; my @chunk = @data[$i..$end]; # チャンク内の各要素を処理 my @chunk_results = map { $_ * 2 } @chunk; $pm-\u0026gt;finish(0, { results =\u0026gt; \\@chunk_results }); } $pm-\u0026gt;wait_all_children; say \u0026#34;処理結果の総数: \u0026#34;, scalar(@results); say \u0026#34;合計: \u0026#34;, sum(@results); メモリ使用量の最適化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 use Parallel::ForkManager; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(4); # 大量のデータを扱う場合は、親プロセスでデータを保持せず、 # 子プロセスで必要なデータのみを読み込む my @file_list = glob(\u0026#39;/large/dataset/*.dat\u0026#39;); for my $file (@file_list) { $pm-\u0026gt;start and next; # 子プロセスでファイルを読み込む open my $fh, \u0026#39;\u0026lt;\u0026#39;, $file or die \u0026#34;Cannot open $file: $!\u0026#34;; # 処理（一度に全部メモリに読み込まない） while (my $line = \u0026lt;$fh\u0026gt;) { # 行ごとに処理 process_line($line); } close $fh; $pm-\u0026gt;finish; } $pm-\u0026gt;wait_all_children; sub process_line { my ($line) = @_; # 処理... } データベース処理での注意点 fork を使う際、データベース接続には注意が必要です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use Parallel::ForkManager; use DBI; use feature qw(say); my $pm = Parallel::ForkManager-\u0026gt;new(4); # 親プロセスでの接続は作らない # my $dbh = DBI-\u0026gt;connect(...); # これはNG！ my @tasks = (1..10); for my $task (@tasks) { $pm-\u0026gt;start and next; # 各子プロセスで接続を作成 my $dbh = DBI-\u0026gt;connect( \u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 } ); # データベース操作 my $sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE id = ?\u0026#39;); $sth-\u0026gt;execute($task); my $user = $sth-\u0026gt;fetchrow_hashref; say \u0026#34;タスク $task: ユーザー $user-\u0026gt;{name}\u0026#34;; # 接続を閉じる $dbh-\u0026gt;disconnect; $pm-\u0026gt;finish; } $pm-\u0026gt;wait_all_children; 実用的な完全例：URLリストのダウンロードと処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 use Parallel::ForkManager; use HTTP::Tiny; use Try::Tiny; use feature qw(say); use Time::HiRes qw(time); my $start_time = time; # 設定 my $max_processes = 10; my $timeout = 30; # 処理するURLリスト my @urls = ( \u0026#39;https://example.com/api/data/1\u0026#39;, \u0026#39;https://example.com/api/data/2\u0026#39;, # ... 多数のURL ); my $pm = Parallel::ForkManager-\u0026gt;new($max_processes); my %results; my $success_count = 0; my $error_count = 0; # 結果収集のコールバック $pm-\u0026gt;run_on_finish(sub { my ($pid, $exit_code, $ident, $exit_signal, $core_dump, $data) = @_; return unless defined $data; $results{$data-\u0026gt;{url}} = $data; if ($data-\u0026gt;{success}) { $success_count++; say \u0026#34;成功: $data-\u0026gt;{url} (${data-\u0026gt;{size}}バイト)\u0026#34;; } else { $error_count++; say \u0026#34;失敗: $data-\u0026gt;{url} - $data-\u0026gt;{error}\u0026#34;; } }); # 各URLを並列処理 for my $url (@urls) { $pm-\u0026gt;start and next; my $result = { url =\u0026gt; $url, success =\u0026gt; 0, }; try { my $http = HTTP::Tiny-\u0026gt;new(timeout =\u0026gt; $timeout); my $response = $http-\u0026gt;get($url); if ($response-\u0026gt;{success}) { $result-\u0026gt;{success} = 1; $result-\u0026gt;{size} = length($response-\u0026gt;{content}); $result-\u0026gt;{status} = $response-\u0026gt;{status}; # ここでダウンロードしたコンテンツを処理 # process_content($response-\u0026gt;{content}); } else { $result-\u0026gt;{error} = \u0026#34;$response-\u0026gt;{status} $response-\u0026gt;{reason}\u0026#34;; } } catch { $result-\u0026gt;{error} = $_; }; $pm-\u0026gt;finish(0, $result); } # すべての子プロセスの終了を待つ $pm-\u0026gt;wait_all_children; my $elapsed = time - $start_time; # 結果のサマリー say \u0026#34;\\n=== 処理完了 ===\u0026#34;; say \u0026#34;総URL数: \u0026#34;, scalar(@urls); say \u0026#34;成功: $success_count\u0026#34;; say \u0026#34;失敗: $error_count\u0026#34;; say sprintf(\u0026#34;処理時間: %.2f秒\u0026#34;, $elapsed); say sprintf(\u0026#34;平均: %.2f秒/URL\u0026#34;, $elapsed / @urls); まとめ Parallel::ForkManager を使うことで、Perlで簡単に並列処理を実装できます。\n重要なポイント：\n適切なプロセス数 - CPUコア数を考慮（CPU処理）、I/O待ちならより多く データの受け渡し - run_on_finish コールバックを活用 エラー処理 - 各子プロセスで適切にエラーをハンドル リソース管理 - データベース接続などは子プロセスで作成 メモリ効率 - 大量データは親プロセスで保持しない よくあるユースケース：\nWebスクレイピング 画像/動画の一括変換 ログファイルの解析 バッチ処理 APIリクエストの並列実行 並列処理を適切に使うことで、処理時間を劇的に短縮できます。ただし、オーバーヘッドもあるため、小規模なタスクでは逐次処理の方が速い場合もあります。ベンチマークを取って、実際の効果を確認することが重要です。\n","date":"2025-12-16T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251216000000-image.jpg","permalink":"https://www.nqou.net/2025/12/16/000000/","title":"Perlでの並行・並列処理 — Parallel::ForkManager"},{"content":"List::Util と List::MoreUtils - リスト処理の強力なツール Perlでリストやリストを扱う作業は日常茶飯事です。ループを書いて処理することもできますが、List::Util と List::MoreUtils を使えば、より簡潔で読みやすいコードが書けます。これらのモジュールは、関数型プログラミングのエッセンスをPerlに持ち込み、リスト処理を格段に効率化します。\nList::Util - 標準のリストユーティリティ List::Util は Perl のコアモジュール（5.7.3以降）なので、別途インストールする必要はありません。基本的なリスト操作関数を提供します。\n基本的な集計関数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use List::Util qw(sum sum0 product min max); use feature qw(say); my @numbers = (1, 2, 3, 4, 5); # 合計 say \u0026#34;合計: \u0026#34;, sum(@numbers); # 15 say \u0026#34;合計: \u0026#34;, sum0(@numbers); # 15 (空リストでも0を返す) say \u0026#34;空の合計: \u0026#34;, sum0(); # 0 # 積 say \u0026#34;積: \u0026#34;, product(@numbers); # 120 # 最小値・最大値 say \u0026#34;最小: \u0026#34;, min(@numbers); # 1 say \u0026#34;最大: \u0026#34;, max(@numbers); # 5 # 文字列での最小・最大 my @words = qw(apple banana cherry); say \u0026#34;辞書順最小: \u0026#34;, min(@words); # apple say \u0026#34;辞書順最大: \u0026#34;, max(@words); # cherry # 数値での最小・最大（明示的） use List::Util qw(min max); my @mixed = qw(10 2 100 20); say \u0026#34;数値最小: \u0026#34;, min(@mixed); # 2 (数値として比較) minstr / maxstr - 文字列比較 1 2 3 4 5 6 7 8 9 10 11 12 use List::Util qw(minstr maxstr); use feature qw(say); my @numbers_as_strings = qw(10 2 100 20); # 文字列として比較 say \u0026#34;文字列最小: \u0026#34;, minstr(@numbers_as_strings); # 10 say \u0026#34;文字列最大: \u0026#34;, maxstr(@numbers_as_strings); # 2 # 数値として比較（通常のmin/max） say \u0026#34;数値最小: \u0026#34;, min(@numbers_as_strings); # 2 say \u0026#34;数値最大: \u0026#34;, max(@numbers_as_strings); # 100 reduce - 強力な集約関数 reduce は、リストの要素を順番に処理して単一の値に集約します。$a と $b が特殊変数として使用されます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use List::Util qw(reduce); use feature qw(say); my @numbers = (1, 2, 3, 4, 5); # 合計（sum の実装例） my $sum = reduce { $a + $b } @numbers; say \u0026#34;合計: $sum\u0026#34;; # 15 # 積（product の実装例） my $product = reduce { $a * $b } @numbers; say \u0026#34;積: $product\u0026#34;; # 120 # 最大値（max の実装例） my $max = reduce { $a \u0026gt; $b ? $a : $b } @numbers; say \u0026#34;最大: $max\u0026#34;; # 5 # 文字列連結 my @words = qw(Hello World from Perl); my $sentence = reduce { \u0026#34;$a $b\u0026#34; } @words; say $sentence; # Hello World from Perl # 複雑な例：ハッシュの値の合計 my %scores = ( Alice =\u0026gt; 85, Bob =\u0026gt; 92, Carol =\u0026gt; 78, ); my $total = reduce { $a + $b } values %scores; say \u0026#34;合計点: $total\u0026#34;; # 255 # リストのリストを平坦化 my @nested = ([1, 2], [3, 4], [5, 6]); my @flat = reduce { [@$a, @$b] } @nested; say \u0026#34;平坦化: @flat\u0026#34;; # 1 2 3 4 5 6 first - 条件に合う最初の要素 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use List::Util qw(first); use feature qw(say); my @numbers = (1, 3, 5, 8, 9, 12, 15); # 偶数を探す my $first_even = first { $_ % 2 == 0 } @numbers; say \u0026#34;最初の偶数: $first_even\u0026#34;; # 8 # 10以上の数を探す my $first_large = first { $_ \u0026gt;= 10 } @numbers; say \u0026#34;最初の10以上: $first_large\u0026#34;; # 12 # 見つからない場合は undef my $first_negative = first { $_ \u0026lt; 0 } @numbers; say \u0026#34;最初の負数: \u0026#34;, $first_negative // \u0026#34;なし\u0026#34;; # なし # ハッシュの検索 my @users = ( { name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 25 }, { name =\u0026gt; \u0026#39;Bob\u0026#39;, age =\u0026gt; 30 }, { name =\u0026gt; \u0026#39;Carol\u0026#39;, age =\u0026gt; 28 }, ); my $adult = first { $_-\u0026gt;{age} \u0026gt;= 30 } @users; say \u0026#34;30歳以上: $adult-\u0026gt;{name}\u0026#34;; # Bob any / all / none / notall - 真偽値チェック 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use List::Util qw(any all none notall); use feature qw(say); my @numbers = (2, 4, 6, 8, 10); # いずれかが条件を満たすか say \u0026#34;偶数がある: \u0026#34;, any { $_ % 2 == 0 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # はい say \u0026#34;奇数がある: \u0026#34;, any { $_ % 2 == 1 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # いいえ # すべてが条件を満たすか say \u0026#34;すべて偶数: \u0026#34;, all { $_ % 2 == 0 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # はい say \u0026#34;すべて正: \u0026#34;, all { $_ \u0026gt; 0 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # はい # いずれも条件を満たさないか say \u0026#34;奇数なし: \u0026#34;, none { $_ % 2 == 1 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # はい # いずれかが条件を満たさないか（all の否定） my @mixed = (2, 4, 5, 8); say \u0026#34;偶数でないものがある: \u0026#34;, notall { $_ % 2 == 0 } @mixed ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # はい # 実用例：バリデーション my @ages = (25, 30, 18, 22); if (all { $_ \u0026gt;= 18 } @ages) { say \u0026#34;全員成人です\u0026#34;; } else { say \u0026#34;未成年が含まれています\u0026#34;; } uniq / uniqnum / uniqstr - 重複削除 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use List::Util qw(uniq uniqnum uniqstr); use feature qw(say); # 数値として一意化 my @numbers = (1, 2, 2, 3, 1, 4, 3, 5); my @unique_nums = uniqnum(@numbers); say \u0026#34;一意な数値: @unique_nums\u0026#34;; # 1 2 3 4 5 # 文字列として一意化 my @strings = qw(apple banana apple cherry banana); my @unique_strs = uniqstr(@strings); say \u0026#34;一意な文字列: @unique_strs\u0026#34;; # apple banana cherry # 汎用版（Perl 5.26+） my @mixed = (1, \u0026#34;1\u0026#34;, 2, \u0026#34;2\u0026#34;, 1); my @unique = uniq(@mixed); say \u0026#34;一意: @unique\u0026#34;; # 1 1 2 2 1 (数値の1と文字列の\u0026#34;1\u0026#34;は別物) # 実用例：重複メールアドレスの削除 my @emails = qw( user1@example.com user2@example.com user1@example.com user3@example.com ); my @unique_emails = uniqstr(@emails); say \u0026#34;一意なメールアドレス: @unique_emails\u0026#34;; pairs / pairkeys / pairvalues - ペア処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use List::Util qw(pairs pairkeys pairvalues pairmap pairgrep); use feature qw(say); my @kvlist = (name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 25, city =\u0026gt; \u0026#39;Tokyo\u0026#39;); # ペアのリストに変換 my @pairs = pairs(@kvlist); for my $pair (@pairs) { say \u0026#34;$pair-\u0026gt;[0] =\u0026gt; $pair-\u0026gt;[1]\u0026#34;; } # name =\u0026gt; Alice # age =\u0026gt; 25 # city =\u0026gt; Tokyo # キーだけ取り出す my @keys = pairkeys(@kvlist); say \u0026#34;キー: @keys\u0026#34;; # name age city # 値だけ取り出す my @values = pairvalues(@kvlist); say \u0026#34;値: @values\u0026#34;; # Alice 25 Tokyo # ペアごとに処理（map のペア版） my @uppercased = pairmap { uc($a) =\u0026gt; $b } @kvlist; say \u0026#34;@uppercased\u0026#34;; # NAME Alice AGE 25 CITY Tokyo # ペアをフィルタ（grep のペア版） my @filtered = pairgrep { $b =~ /\\d/ } @kvlist; say \u0026#34;@filtered\u0026#34;; # age 25 List::MoreUtils - さらに便利な関数 List::MoreUtils は List::Util を拡張し、より多くの便利な関数を提供します。\nインストール 1 cpanm List::MoreUtils zip - リストの転置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use List::MoreUtils qw(zip); use feature qw(say); my @names = qw(Alice Bob Carol); my @ages = (25, 30, 28); my @cities = qw(Tokyo Osaka Kyoto); my @zipped = zip(@names, @ages, @cities); say \u0026#34;@zipped\u0026#34;; # Alice 25 Tokyo Bob 30 Osaka Carol 28 Kyoto # ハッシュに変換 my %people; for (my $i = 0; $i \u0026lt; @names; $i++) { $people{$names[$i]} = { age =\u0026gt; $ages[$i], city =\u0026gt; $cities[$i], }; } use Data::Dumper; print Dumper(\\%people); each_array - 複数配列の同時反復 1 2 3 4 5 6 7 8 9 10 11 12 13 use List::MoreUtils qw(each_array); use feature qw(say); my @names = qw(Alice Bob Carol); my @ages = (25, 30, 28); my $iter = each_array(@names, @ages); while (my ($name, $age) = $iter-\u0026gt;()) { say \u0026#34;$name is $age years old\u0026#34;; } # Alice is 25 years old # Bob is 30 years old # Carol is 28 years old part - 条件によるグループ分け 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use List::MoreUtils qw(part); use feature qw(say); my @numbers = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10); # 偶数と奇数に分類 my $i = 0; my @groups = part { $_ % 2 } @numbers; say \u0026#34;偶数: @{$groups[0]}\u0026#34;; # 2 4 6 8 10 say \u0026#34;奇数: @{$groups[1]}\u0026#34;; # 1 3 5 7 9 # 3つのグループに分類（3で割った余りで） my @three_groups = part { $_ % 3 } @numbers; say \u0026#34;3で割り切れる: @{$three_groups[0] // []}\u0026#34;; # 3 6 9 say \u0026#34;余り1: @{$three_groups[1] // []}\u0026#34;; # 1 4 7 10 say \u0026#34;余り2: @{$three_groups[2] // []}\u0026#34;; # 2 5 8 before / after - 条件の前後で分割 1 2 3 4 5 6 7 8 9 10 11 12 use List::MoreUtils qw(before after); use feature qw(say); my @numbers = (1, 2, 3, 4, 5, 6, 7, 8); # 5より小さい要素 my @before_five = before { $_ \u0026gt;= 5 } @numbers; say \u0026#34;5未満: @before_five\u0026#34;; # 1 2 3 4 # 5以上の要素 my @after_five = after { $_ \u0026gt;= 5 } @numbers; say \u0026#34;5以上: @after_five\u0026#34;; # 5 6 7 8 indexes - 条件を満たすインデックス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use List::MoreUtils qw(indexes); use feature qw(say); my @numbers = (10, 25, 30, 15, 40, 20); # 20以上の要素のインデックス my @indices = indexes { $_ \u0026gt;= 20 } @numbers; say \u0026#34;20以上のインデックス: @indices\u0026#34;; # 1 2 4 5 # 実用例：該当要素を削除 my @words = qw(apple banana cherry date elderberry); my @to_remove_indices = indexes { length($_) \u0026gt; 6 } @words; # 後ろから削除（インデックスがずれないように） for my $idx (reverse @to_remove_indices) { splice @words, $idx, 1; } say \u0026#34;残った単語: @words\u0026#34;; # apple banana cherry date firstidx / lastidx - インデックスを返す first 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use List::MoreUtils qw(firstidx lastidx); use feature qw(say); my @numbers = (1, 3, 5, 7, 5, 3, 1); # 最初の5のインデックス my $first_five = firstidx { $_ == 5 } @numbers; say \u0026#34;最初の5: インデックス $first_five\u0026#34;; # 2 # 最後の5のインデックス my $last_five = lastidx { $_ == 5 } @numbers; say \u0026#34;最後の5: インデックス $last_five\u0026#34;; # 4 # 見つからない場合は -1 my $not_found = firstidx { $_ == 10 } @numbers; say \u0026#34;10のインデックス: $not_found\u0026#34;; # -1 minmax - 一度に最小値と最大値を取得 1 2 3 4 5 6 7 8 9 use List::MoreUtils qw(minmax); use feature qw(say); my @numbers = (3, 1, 4, 1, 5, 9, 2, 6); my ($min, $max) = minmax(@numbers); say \u0026#34;最小: $min, 最大: $max\u0026#34;; # 最小: 1, 最大: 9 # 1回のループで取得できるため効率的 実用的なリスト処理パターン データの集計と分析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use List::Util qw(sum max min); use List::MoreUtils qw(minmax); use feature qw(say); my @scores = (85, 92, 78, 90, 88, 95, 73); my $total = sum(@scores); my $average = $total / @scores; my ($min, $max) = minmax(@scores); say \u0026#34;=== スコア統計 ===\u0026#34;; say \u0026#34;合計: $total\u0026#34;; say \u0026#34;平均: \u0026#34;, sprintf(\u0026#34;%.2f\u0026#34;, $average); say \u0026#34;最高点: $max\u0026#34;; say \u0026#34;最低点: $min\u0026#34;; say \u0026#34;範囲: \u0026#34;, $max - $min; # 中央値を求める my @sorted = sort { $a \u0026lt;=\u0026gt; $b } @scores; my $median = @sorted % 2 ? $sorted[@sorted / 2] : ($sorted[@sorted / 2 - 1] + $sorted[@sorted / 2]) / 2; say \u0026#34;中央値: $median\u0026#34;; ログファイルの解析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use List::Util qw(sum max); use List::MoreUtils qw(part); use feature qw(say); my @log_lines = ( \u0026#39;INFO: Process started\u0026#39;, \u0026#39;WARN: Low memory\u0026#39;, \u0026#39;ERROR: Connection failed\u0026#39;, \u0026#39;INFO: Process completed\u0026#39;, \u0026#39;ERROR: Timeout\u0026#39;, \u0026#39;WARN: High CPU usage\u0026#39;, ); # レベル別に分類 my @by_level = part { /^INFO/ ? 0 : /^WARN/ ? 1 : /^ERROR/ ? 2 : 3 } @log_lines; say \u0026#34;INFO: \u0026#34;, scalar(@{$by_level[0] // []}), \u0026#34; 件\u0026#34;; say \u0026#34;WARN: \u0026#34;, scalar(@{$by_level[1] // []}), \u0026#34; 件\u0026#34;; say \u0026#34;ERROR: \u0026#34;, scalar(@{$by_level[2] // []}), \u0026#34; 件\u0026#34;; # ERROR のみ表示 if ($by_level[2]) { say \u0026#34;\\n=== エラーログ ===\u0026#34;; say for @{$by_level[2]}; } ショッピングカートの処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use List::Util qw(sum reduce); use feature qw(say); my @cart = ( { name =\u0026gt; \u0026#39;リンゴ\u0026#39;, price =\u0026gt; 100, quantity =\u0026gt; 3 }, { name =\u0026gt; \u0026#39;バナナ\u0026#39;, price =\u0026gt; 150, quantity =\u0026gt; 2 }, { name =\u0026gt; \u0026#39;みかん\u0026#39;, price =\u0026gt; 80, quantity =\u0026gt; 5 }, ); # 各商品の小計 my @subtotals = map { $_-\u0026gt;{price} * $_-\u0026gt;{quantity} } @cart; # 合計金額 my $total = sum(@subtotals); say \u0026#34;=== お買い物カート ===\u0026#34;; for my $item (@cart) { my $subtotal = $item-\u0026gt;{price} * $item-\u0026gt;{quantity}; say sprintf(\u0026#34;%s: %d円 × %d = %d円\u0026#34;, $item-\u0026gt;{name}, $item-\u0026gt;{price}, $item-\u0026gt;{quantity}, $subtotal); } say \u0026#34;合計: ${total}円\u0026#34;; # 割引適用（1000円以上で10%オフ） if ($total \u0026gt;= 1000) { my $discounted = int($total * 0.9); say \u0026#34;割引後: ${discounted}円（10%オフ）\u0026#34;; } ユーザーデータのフィルタリングとソート 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use List::Util qw(all any); use List::MoreUtils qw(uniq); use feature qw(say); my @users = ( { name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 25, active =\u0026gt; 1 }, { name =\u0026gt; \u0026#39;Bob\u0026#39;, age =\u0026gt; 30, active =\u0026gt; 1 }, { name =\u0026gt; \u0026#39;Carol\u0026#39;, age =\u0026gt; 28, active =\u0026gt; 0 }, { name =\u0026gt; \u0026#39;Dave\u0026#39;, age =\u0026gt; 22, active =\u0026gt; 1 }, { name =\u0026gt; \u0026#39;Eve\u0026#39;, age =\u0026gt; 35, active =\u0026gt; 0 }, ); # アクティブユーザーのみ my @active_users = grep { $_-\u0026gt;{active} } @users; say \u0026#34;アクティブユーザー: \u0026#34;, scalar(@active_users), \u0026#34;人\u0026#34;; # 25歳以上のアクティブユーザー my @adult_active = grep { $_-\u0026gt;{age} \u0026gt;= 25 \u0026amp;\u0026amp; $_-\u0026gt;{active} } @users; say \u0026#34;25歳以上のアクティブユーザー: \u0026#34;; say \u0026#34; - $_-\u0026gt;{name} ($_-\u0026gt;{age}歳)\u0026#34; for @adult_active; # 年齢でソート my @sorted_by_age = sort { $a-\u0026gt;{age} \u0026lt;=\u0026gt; $b-\u0026gt;{age} } @users; say \u0026#34;\\n年齢順:\u0026#34;; say \u0026#34; $_-\u0026gt;{name}: $_-\u0026gt;{age}歳\u0026#34; for @sorted_by_age; # 全員25歳以上か？ say \u0026#34;\\n全員25歳以上: \u0026#34;, all { $_-\u0026gt;{age} \u0026gt;= 25 } @users ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # 誰か30歳以上がいるか？ say \u0026#34;30歳以上あり: \u0026#34;, any { $_-\u0026gt;{age} \u0026gt;= 30 } @users ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; パフォーマンス考慮 ループ vs List::Util 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use Benchmark qw(cmpthese); use List::Util qw(sum); my @numbers = (1..10000); cmpthese(10000, { \u0026#39;loop\u0026#39; =\u0026gt; sub { my $sum = 0; $sum += $_ for @numbers; }, \u0026#39;List::Util::sum\u0026#39; =\u0026gt; sub { my $sum = sum(@numbers); }, }); 多くの場合、List::Util の関数は C 実装されているため、Perlのループより高速です。ただし、非常に単純な処理では、オーバーヘッドによりループの方が速い場合もあります。\n適切な関数の選択 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use List::Util qw(first any); use feature qw(say); my @numbers = (1..1000000); # 存在チェックだけなら any を使う（効率的） say \u0026#34;偶数あり: \u0026#34;, any { $_ % 2 == 0 } @numbers ? \u0026#39;はい\u0026#39; : \u0026#39;いいえ\u0026#39;; # 値が必要なら first を使う my $first_even = first { $_ % 2 == 0 } @numbers; say \u0026#34;最初の偶数: $first_even\u0026#34;; # 全部必要なら grep を使う my @evens = grep { $_ % 2 == 0 } @numbers; say \u0026#34;偶数の個数: \u0026#34;, scalar(@evens); まとめ List::Util と List::MoreUtils は、Perlでのリスト処理を劇的に改善します。\nよく使う関数：\n集計: sum, product, min, max 検索: first, any, all, none 変換: reduce, uniq ペア処理: pairs, pairmap, pairgrep List::MoreUtils の便利機能：\n分類: part インデックス: indexes, firstidx, lastidx 複数配列: zip, each_array これらの関数を使うことで：\nコードが短く読みやすくなる バグが減る（ループの範囲エラーなど） 意図が明確になる パフォーマンスが向上することが多い リスト処理は Perl の得意分野です。これらのツールを活用して、効率的で美しいコードを書きましょう！\n","date":"2025-12-15T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251215000000-image.jpg","permalink":"https://www.nqou.net/2025/12/15/000000/","title":"List::Util と List::MoreUtils - リスト処理の強力なツール"},{"content":"@nqounetです。\nWebSocketって聞いたことはあるけど、実際に触ったことがない方も多いのではないでしょうか？この記事では、PerlのWebフレームワーク「Mojolicious」を使って、リアルタイム通信の基礎を3つのステップで学んでいきます。\n初心者の方でも、わずか10行のコードからWebSocketサーバーを構築できます。この記事を読み終える頃には、チャットアプリやリアルタイムダッシュボードが作れるようになっているはずです。\nWebSocketとは？なぜ必要なのか WebSocketは、WebブラウザとWebサーバーの間で双方向通信を実現するプロトコルです。従来のHTTPでは、クライアント（ブラウザ）からリクエストを送らない限り、サーバーからデータを受け取ることができませんでした。\nしかし、WebSocketを使えば：\nサーバーから任意のタイミングでデータをプッシュできる 1つのコネクションで継続的にデータをやり取りできる リアルタイムなアプリケーションが実装しやすい チャットアプリ、株価ボード、リアルタイムゲーム、IoTダッシュボードなど、WebSocketの活躍の場は広がっています。\nなぜMojoliciousなのか Mojoliciousは、WebSocketをとてもシンプルに扱えるPerlのフレームワークです。他の言語やフレームワークと比較しても、学習コストが低く、すぐに実践できるのが特徴です。\nMojoliciousを選ぶ理由：\n設定不要: 追加のモジュールやミドルウェアなしでWebSocketが使える シンプルなAPI: わずか数行でWebSocketサーバーが書ける UTF-8自動対応: 日本語などの多言語テキストも自動的に正しく処理される 非同期I/O: Mojo::IOLoopによる効率的な並行処理 豊富なドキュメント: 公式ドキュメントが充実しており、初心者にも優しい それでは、実際にコードを書きながら学んでいきましょう！\n準備：Mojoliciousのインストール まだMojoliciousをインストールしていない場合は、cpanmを使って簡単にインストールできます：\n1 cpanm Mojolicious インストール後、以下のコマンドでバージョンを確認してみましょう：\n1 mojo version これで準備完了です！\nステップ1：エコーサーバーを作る まずは、WebSocketの基本である「エコーサーバー」を作ってみましょう。クライアントから送られたメッセージをそのまま返すシンプルなサーバーです。\n最もシンプルなWebSocketサーバーは、わずか10行程度で書けます：\n1 2 3 4 5 6 7 8 9 10 11 12 #!/usr/bin/env perl use Mojolicious::Lite -signatures; # WebSocketルートを定義 websocket \u0026#39;/echo\u0026#39; =\u0026gt; sub ($c) { # メッセージを受信したときの処理 $c-\u0026gt;on(message =\u0026gt; sub ($c, $msg) { $c-\u0026gt;send(\u0026#34;Echo: $msg\u0026#34;); }); }; app-\u0026gt;start; このコードを echo_server.pl として保存し、実行してみましょう：\n1 perl echo_server.pl daemon サーバーが起動したら、次のHTMLファイルをブラウザで開いてテストできます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;WebSocket Echo Test\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;WebSocket Echo Test\u0026lt;/h1\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;input\u0026#34; placeholder=\u0026#34;メッセージを入力\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;sendMessage()\u0026#34;\u0026gt;送信\u0026lt;/button\u0026gt; \u0026lt;div id=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; const ws = new WebSocket(\u0026#39;ws://localhost:3000/echo\u0026#39;); ws.onmessage = function(event) { const output = document.getElementById(\u0026#39;output\u0026#39;); output.innerHTML += \u0026#39;\u0026lt;p\u0026gt;受信: \u0026#39; + event.data + \u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; }; function sendMessage() { const input = document.getElementById(\u0026#39;input\u0026#39;); ws.send(input.value); input.value = \u0026#39;\u0026#39;; } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ブラウザで開いて、テキストを入力して送信ボタンを押すと、サーバーから「Echo: 」付きでメッセージが返ってくるのが確認できます。\n日本語対応とロギング機能の追加 WebSocketで日本語を扱う場合、文字コードの扱いに注意が必要です。Mojoliciousは自動的にUTF-8のエンコード/デコードを行うため、特別な設定は不要ですが、Perlスクリプト内で日本語を使う場合は use utf8; を忘れずに。\nまた、実用的なアプリケーションでは、接続・切断・メッセージのログを取ることが重要です。以下は、ロギング機能を追加した改良版です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/usr/bin/env perl use utf8; use Mojolicious::Lite -signatures; # WebSocketルートを定義 websocket \u0026#39;/echo\u0026#39; =\u0026gt; sub ($c) { # 接続時のログ $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#39;WebSocket接続が確立されました\u0026#39;); # メッセージ受信時の処理 $c-\u0026gt;on(message =\u0026gt; sub ($c, $msg) { $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;受信: $msg\u0026#34;); $c-\u0026gt;send(\u0026#34;エコー: $msg\u0026#34;); # 日本語のプレフィックス }); # 切断時の処理 $c-\u0026gt;on(finish =\u0026gt; sub ($c, $code, $reason) { $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;WebSocket切断: code=$code\u0026#34;); }); }; app-\u0026gt;start; ポイント解説：\nuse utf8;: Perlスクリプト内の日本語文字列を正しく扱うために必須 $c-\u0026gt;on(message =\u0026gt; ...): メッセージ受信時のコールバック $c-\u0026gt;send(...): クライアントへメッセージを送信（Mojoliciousが自動的にUTF-8エンコード） $c-\u0026gt;on(finish =\u0026gt; ...): WebSocket切断時の処理 $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(...): サーバーログへの記録 Mojoliciousの素晴らしい点は、送受信されるテキストメッセージが自動的にUTF-8として扱われることです。開発者が明示的にエンコード/デコードを書く必要はありません。\nステップ2：複数人チャットを作る エコーサーバーでWebSocketの基本を理解できたら、次は複数のクライアントが同時に接続するチャットアプリケーションを作ってみましょう。\nまずは、シンプルなテキストチャットを実装します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 #!/usr/bin/env perl use utf8; use Mojolicious::Lite -signatures; # 接続中のクライアントを保持するハッシュ my $clients = {}; # 静的ファイル配信（HTMLファイル用） get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;chat\u0026#39;); }; # WebSocketエンドポイント websocket \u0026#39;/chat\u0026#39; =\u0026gt; sub ($c) { my $id = sprintf \u0026#34;%s\u0026#34;, $c-\u0026gt;tx; # 接続ごとのユニークID # 新しいクライアントを登録 $clients-\u0026gt;{$id} = $c-\u0026gt;tx; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;クライアント接続: $id (total: \u0026#34; . scalar(keys %$clients) . \u0026#34;)\u0026#34;); # 全員に参加通知を送信 broadcast(\u0026#34;新しいユーザーが参加しました (total: \u0026#34; . scalar(keys %$clients) . \u0026#34;)\u0026#34;); # メッセージ受信時の処理 $c-\u0026gt;on(message =\u0026gt; sub ($c, $msg) { $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;[$id] $msg\u0026#34;); broadcast(\u0026#34;[$id] $msg\u0026#34;); }); # 切断時の処理 $c-\u0026gt;on(finish =\u0026gt; sub ($c, $code, $reason) { delete $clients-\u0026gt;{$id}; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;クライアント切断: $id (total: \u0026#34; . scalar(keys %$clients) . \u0026#34;)\u0026#34;); broadcast(\u0026#34;ユーザーが退出しました (total: \u0026#34; . scalar(keys %$clients) . \u0026#34;)\u0026#34;); }); }; # 全クライアントにメッセージを送信する関数 sub broadcast { my $msg = shift; for my $tx (values %$clients) { $tx-\u0026gt;send($msg); } } app-\u0026gt;start; __DATA__ @@ chat.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;WebSocket チャット\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; } #input { width: 80%; padding: 5px; } button { padding: 5px 15px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;WebSocket チャットルーム\u0026lt;/h1\u0026gt; \u0026lt;div id=\u0026#34;messages\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;input\u0026#34; placeholder=\u0026#34;メッセージを入力\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;sendMessage()\u0026#34;\u0026gt;送信\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; const ws = new WebSocket(\u0026#39;ws://\u0026#39; + location.host + \u0026#39;/chat\u0026#39;); const messages = document.getElementById(\u0026#39;messages\u0026#39;); const input = document.getElementById(\u0026#39;input\u0026#39;); ws.onopen = function() { addMessage(\u0026#39;--- 接続しました ---\u0026#39;); }; ws.onmessage = function(event) { addMessage(event.data); }; ws.onclose = function() { addMessage(\u0026#39;--- 切断されました ---\u0026#39;); }; function addMessage(msg) { messages.innerHTML += \u0026#39;\u0026lt;p\u0026gt;\u0026#39; + escapeHtml(msg) + \u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; messages.scrollTop = messages.scrollHeight; } function sendMessage() { if (input.value.trim()) { ws.send(input.value); input.value = \u0026#39;\u0026#39;; } } function escapeHtml(text) { const div = document.createElement(\u0026#39;div\u0026#39;); div.textContent = text; return div.innerHTML; } input.addEventListener(\u0026#39;keypress\u0026#39;, function(e) { if (e.key === \u0026#39;Enter\u0026#39;) sendMessage(); }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ポイント解説：\nmy $clients = {}: 接続中のクライアントをハッシュで管理 $c-\u0026gt;tx: トランザクションオブジェクト（接続ごとにユニーク） broadcast(): 全クライアントにメッセージを送る関数 __DATA__ セクション: テンプレートを埋め込み（別ファイルにしなくてOK） escapeHtml(): XSS対策のためのHTMLエスケープ このコードを chat_server.pl として保存し、実行してみましょう：\n1 perl chat_server.pl daemon ブラウザで http://localhost:3000/ を開くと、チャット画面が表示されます。複数のブラウザウィンドウ（またはタブ）で開いて、メッセージをやり取りしてみてください！\nJSON形式での構造化データ送信 実際のアプリケーションでは、メッセージだけでなく、ユーザー名やタイムスタンプなどのメタデータも一緒に送りたいことがあります。JSON形式を使うと、構造化されたデータを簡単にやり取りでき、将来的な拡張（絵文字リアクション、既読表示、ファイル送信など）も容易になります。\n以下は、JSON形式で通信するチャットアプリケーションの実装例です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 #!/usr/bin/env perl use utf8; use Mojolicious::Lite -signatures; use Mojo::JSON qw(decode_json encode_json); use Mojo::Util qw(decode encode); my $clients = {}; get \u0026#39;/\u0026#39; =\u0026gt; sub($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;chat_json\u0026#39;); }; websocket \u0026#39;/chat\u0026#39; =\u0026gt; sub($c) { my $id = sprintf \u0026#34;%s\u0026#34;, $c-\u0026gt;tx; my $username = \u0026#34;User-\u0026#34; . substr($id, 0, 8); # デフォルトユーザー名 $clients-\u0026gt;{$id} = { tx =\u0026gt; $c-\u0026gt;tx, username =\u0026gt; $username, }; # 参加通知をJSON形式で送信 broadcast({ type =\u0026gt; \u0026#39;system\u0026#39;, message =\u0026gt; \u0026#34;$username が参加しました\u0026#34;, timestamp =\u0026gt; time, users =\u0026gt; scalar(keys %$clients), }); $c-\u0026gt;on(message =\u0026gt; sub($c, $msg) { my $data = eval {decode_json(encode(\u0026#39;UTF-8\u0026#39;, $msg))}; if ($@) { # JSONパースエラー $c-\u0026gt;send(encode_json({ type =\u0026gt; \u0026#39;error\u0026#39;, message =\u0026gt; \u0026#39;Invalid JSON format\u0026#39;, })); return; } # ユーザー名変更リクエスト if ($data-\u0026gt;{type} eq \u0026#39;setname\u0026#39;) { my $old_name = $clients-\u0026gt;{$id}{username}; $clients-\u0026gt;{$id}{username} = $data-\u0026gt;{username}; broadcast({ type =\u0026gt; \u0026#39;system\u0026#39;, message =\u0026gt; \u0026#34;$old_name が $data-\u0026gt;{username} に名前を変更しました\u0026#34;, timestamp =\u0026gt; time, users =\u0026gt; scalar(keys %$clients), }); } # 通常のメッセージ elsif ($data-\u0026gt;{type} eq \u0026#39;message\u0026#39;) { broadcast({ type =\u0026gt; \u0026#39;message\u0026#39;, username =\u0026gt; $clients-\u0026gt;{$id}{username}, message =\u0026gt; $data-\u0026gt;{message}, timestamp =\u0026gt; time, }); } }); $c-\u0026gt;on(finish =\u0026gt; sub($c, $code, $reason) { my $username = $clients-\u0026gt;{$id}{username}; delete $clients-\u0026gt;{$id}; broadcast({ type =\u0026gt; \u0026#39;system\u0026#39;, message =\u0026gt; \u0026#34;$username が退出しました\u0026#34;, timestamp =\u0026gt; time, users =\u0026gt; scalar(keys %$clients), }); }); }; sub broadcast { my $data = shift; my $json = encode_json($data); for my $client (values %$clients) { $client-\u0026gt;{tx}-\u0026gt;send(decode(\u0026#39;UTF-8\u0026#39;, $json)); # 一旦内部コードに戻す } } app-\u0026gt;start; __DATA__ @@ chat_json.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;WebSocket チャット (JSON版)\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; } #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #f9f9f9; } .message { margin: 5px 0; } .system { color: #666; font-style: italic; } .username { font-weight: bold; color: #0066cc; } .timestamp { font-size: 0.8em; color: #999; } #input { width: 70%; padding: 8px; } button { padding: 8px 15px; } #username-input { width: 150px; padding: 5px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;WebSocket チャットルーム (JSON版)\u0026lt;/h1\u0026gt; \u0026lt;div\u0026gt; ユーザー名: \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;username-input\u0026#34; placeholder=\u0026#34;名前を入力\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;setUsername()\u0026#34;\u0026gt;変更\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;messages\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;input\u0026#34; placeholder=\u0026#34;メッセージを入力\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;sendMessage()\u0026#34;\u0026gt;送信\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; const ws = new WebSocket(\u0026#39;ws://\u0026#39; + location.host + \u0026#39;/chat\u0026#39;); const messages = document.getElementById(\u0026#39;messages\u0026#39;); const input = document.getElementById(\u0026#39;input\u0026#39;); ws.onopen = function() { addSystemMessage(\u0026#39;接続しました\u0026#39;); }; ws.onmessage = function(event) { const data = JSON.parse(event.data); if (data.type === \u0026#39;system\u0026#39;) { addSystemMessage(data.message + \u0026#39; (参加者: \u0026#39; + (data.users || \u0026#39;?\u0026#39;) + \u0026#39;人)\u0026#39;); } else if (data.type === \u0026#39;message\u0026#39;) { addChatMessage(data.username, data.message, data.timestamp); } else if (data.type === \u0026#39;error\u0026#39;) { addSystemMessage(\u0026#39;エラー: \u0026#39; + data.message); } }; ws.onclose = function() { addSystemMessage(\u0026#39;切断されました\u0026#39;); }; function addChatMessage(username, msg, timestamp) { const time = new Date(timestamp * 1000).toLocaleTimeString(\u0026#39;ja-JP\u0026#39;); messages.innerHTML += \u0026#39;\u0026lt;div class=\u0026#34;message\u0026#34;\u0026gt;\u0026#39; + \u0026#39;\u0026lt;span class=\u0026#34;timestamp\u0026#34;\u0026gt;[\u0026#39; + time + \u0026#39;]\u0026lt;/span\u0026gt; \u0026#39; + \u0026#39;\u0026lt;span class=\u0026#34;username\u0026#34;\u0026gt;\u0026#39; + escapeHtml(username) + \u0026#39;:\u0026lt;/span\u0026gt; \u0026#39; + escapeHtml(msg) + \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; messages.scrollTop = messages.scrollHeight; } function addSystemMessage(msg) { messages.innerHTML += \u0026#39;\u0026lt;div class=\u0026#34;message system\u0026#34;\u0026gt;--- \u0026#39; + escapeHtml(msg) + \u0026#39; ---\u0026lt;/div\u0026gt;\u0026#39;; messages.scrollTop = messages.scrollHeight; } function sendMessage() { if (input.value.trim()) { ws.send(JSON.stringify({ type: \u0026#39;message\u0026#39;, message: input.value })); input.value = \u0026#39;\u0026#39;; } } function setUsername() { const username = document.getElementById(\u0026#39;username-input\u0026#39;).value.trim(); if (username) { ws.send(JSON.stringify({ type: \u0026#39;setname\u0026#39;, username: username })); } } function escapeHtml(text) { const div = document.createElement(\u0026#39;div\u0026#39;); div.textContent = text; return div.innerHTML; } input.addEventListener(\u0026#39;keypress\u0026#39;, function(e) { if (e.key === \u0026#39;Enter\u0026#39;) sendMessage(); }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ポイント解説：\nuse Mojo::JSON qw(decode_json encode_json): JSON処理のためのユーティリティ decode_json(): JSON文字列をPerlのデータ構造に変換 encode_json(): Perlのデータ構造をJSON文字列に変換 メッセージに type フィールドを持たせて、種類を区別（system/message/setname/error） タイムスタンプを付けることで、メッセージの送信時刻を記録 ユーザー名変更機能を追加して、よりリアルなチャット体験を実現 エラーハンドリング：不正なJSON形式のメッセージを適切に処理 encode_jsonやsendが自動的にUTF-8を処理するため、encode_jsonされた文字列をsendする場合、一旦decode('UTF-8', $json)で内部コードに戻す必要があるので注意が必要 ステップ3：リアルタイムダッシュボードを作る 最後のステップとして、サーバーのメトリクス（CPU使用率、メモリ使用量など）をリアルタイムで可視化するダッシュボードを作ってみましょう。WebSocketの真骨頂である「サーバープッシュ」を活用します。\n以下の実装では、Mojo::IOLoop-\u0026gt;recurringを使って1秒ごとにシステムメトリクスを収集し、接続中の全クライアントにプッシュ配信します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 #!/usr/bin/env perl use utf8; use Mojolicious::Lite -signatures; use Mojo::JSON qw(encode_json); my $clients = {}; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;dashboard\u0026#39;); }; websocket \u0026#39;/metrics\u0026#39; =\u0026gt; sub ($c) { my $id = sprintf \u0026#34;%s\u0026#34;, $c-\u0026gt;tx; $clients-\u0026gt;{$id} = $c-\u0026gt;tx; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;ダッシュボード接続: $id\u0026#34;); $c-\u0026gt;on(finish =\u0026gt; sub ($c, $code, $reason) { delete $clients-\u0026gt;{$id}; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;ダッシュボード切断: $id\u0026#34;); }); }; # 定期的にメトリクスを収集して送信（1秒ごと） Mojo::IOLoop-\u0026gt;recurring(1 =\u0026gt; sub { return unless keys %$clients; my $metrics = collect_metrics(); my $json = encode_json($metrics); for my $tx (values %$clients) { $tx-\u0026gt;send($json); } }); # システムメトリクスを収集する関数 sub collect_metrics { # Load Average取得（Linux/macOS/Unix系で動作） # Linux: \u0026#34;load average: 0.00, 0.01, 0.05\u0026#34; # macOS: \u0026#34;load averages: 0.00 0.01 0.05\u0026#34; my $uptime = `uptime`; my ($load1, $load5, $load15) = $uptime =~ /load averages?: ([\\d.]+)[,\\s]+([\\d.]+)[,\\s]+([\\d.]+)/; # メモリ情報（Linux環境のみ対応） # 注: macOSやWindowsでは /proc/meminfo が存在しないため、0を返します my $mem_total = 0; my $mem_free = 0; my $mem_available = 0; if (-e \u0026#39;/proc/meminfo\u0026#39;) { open my $fh, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;/proc/meminfo\u0026#39;; while (my $line = \u0026lt;$fh\u0026gt;) { $mem_total = $1 if $line =~ /^MemTotal:\\s+(\\d+)/; $mem_free = $1 if $line =~ /^MemFree:\\s+(\\d+)/; $mem_available = $1 if $line =~ /^MemAvailable:\\s+(\\d+)/; } close $fh; } my $mem_used = $mem_total - $mem_available; my $mem_percent = $mem_total \u0026gt; 0 ? ($mem_used / $mem_total * 100) : 0; # 接続数などのアプリケーションメトリクス my $connections = scalar(keys %$clients); return { timestamp =\u0026gt; time, load =\u0026gt; { load1 =\u0026gt; $load1 || 0, load5 =\u0026gt; $load5 || 0, load15 =\u0026gt; $load15 || 0, }, memory =\u0026gt; { total =\u0026gt; int($mem_total / 1024), # MB単位 used =\u0026gt; int($mem_used / 1024), # MB単位 percent =\u0026gt; sprintf(\u0026#34;%.1f\u0026#34;, $mem_percent), }, connections =\u0026gt; $connections, random =\u0026gt; int(rand(100)), # デモ用のランダム値 }; } app-\u0026gt;start; __DATA__ @@ dashboard.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;リアルタイムダッシュボード\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; background: #f0f0f0; } h1 { text-align: center; } .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; } .metric-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .metric-card h3 { margin: 0 0 10px 0; color: #333; font-size: 1em; } .metric-value { font-size: 2.5em; font-weight: bold; color: #0066cc; } .metric-unit { font-size: 0.5em; color: #666; } .chart-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; } #load-chart { width: 100%; height: 200px; border: 1px solid #ddd; } .status { text-align: center; padding: 10px; background: #d4edda; color: #155724; border-radius: 4px; margin-bottom: 20px; } .status.disconnected { background: #f8d7da; color: #721c24; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;📊 リアルタイムダッシュボード\u0026lt;/h1\u0026gt; \u0026lt;div id=\u0026#34;status\u0026#34; class=\u0026#34;status\u0026#34;\u0026gt;接続中...\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metrics-grid\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;CPU Load (1min)\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;load1\u0026#34;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;メモリ使用率\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;mem-percent\u0026#34;\u0026gt;-\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;metric-unit\u0026#34;\u0026gt;%\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;メモリ使用量\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;mem-used\u0026#34;\u0026gt;-\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;metric-unit\u0026#34;\u0026gt;MB\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;アクティブ接続数\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;connections\u0026#34;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;chart-container\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;負荷推移グラフ\u0026lt;/h3\u0026gt; \u0026lt;canvas id=\u0026#34;load-chart\u0026#34;\u0026gt;\u0026lt;/canvas\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; const ws = new WebSocket(\u0026#39;ws://\u0026#39; + location.host + \u0026#39;/metrics\u0026#39;); const status = document.getElementById(\u0026#39;status\u0026#39;); // グラフデータ用の配列（最大60ポイント = 1分間） const chartData = { labels: [], load1: [], load5: [], load15: [], }; const maxDataPoints = 60; ws.onopen = function() { status.textContent = \u0026#39;✅ 接続中 - リアルタイムで更新されています\u0026#39;; status.className = \u0026#39;status\u0026#39;; }; ws.onmessage = function(event) { const metrics = JSON.parse(event.data); updateMetrics(metrics); updateChart(metrics); }; ws.onclose = function() { status.textContent = \u0026#39;❌ 切断されました\u0026#39;; status.className = \u0026#39;status disconnected\u0026#39;; }; function updateMetrics(metrics) { document.getElementById(\u0026#39;load1\u0026#39;).textContent = Number(metrics.load.load1).toFixed(2); document.getElementById(\u0026#39;mem-percent\u0026#39;).textContent = metrics.memory.percent; document.getElementById(\u0026#39;mem-used\u0026#39;).textContent = metrics.memory.used.toLocaleString(); document.getElementById(\u0026#39;connections\u0026#39;).textContent = metrics.connections; } function updateChart(metrics) { const time = new Date(metrics.timestamp * 1000).toLocaleTimeString(\u0026#39;ja-JP\u0026#39;); // データを追加 chartData.labels.push(time); chartData.load1.push(metrics.load.load1); chartData.load5.push(metrics.load.load5); chartData.load15.push(metrics.load.load15); // 古いデータを削除（最大60ポイント保持） if (chartData.labels.length \u0026gt; maxDataPoints) { chartData.labels.shift(); chartData.load1.shift(); chartData.load5.shift(); chartData.load15.shift(); } drawChart(); } function drawChart() { const canvas = document.getElementById(\u0026#39;load-chart\u0026#39;); const ctx = canvas.getContext(\u0026#39;2d\u0026#39;); const width = canvas.width = canvas.offsetWidth; const height = canvas.height = 200; // キャンバスをクリア ctx.clearRect(0, 0, width, height); // グラフの描画領域 const padding = 40; const chartWidth = width - padding * 2; const chartHeight = height - padding * 2; // 最大値を計算（グラフのスケール用） const maxLoad = Math.max( ...chartData.load1, ...chartData.load5, ...chartData.load15, 1 // 最小値1を保証 ); const yScale = chartHeight / (maxLoad * 1.2); // 20%マージン // 背景グリッド ctx.strokeStyle = \u0026#39;#e0e0e0\u0026#39;; ctx.lineWidth = 1; for (let i = 0; i \u0026lt;= 5; i++) { const y = padding + (chartHeight / 5) * i; ctx.beginPath(); ctx.moveTo(padding, y); ctx.lineTo(width - padding, y); ctx.stroke(); } // ラインを描画する関数 function drawLine(data, color) { if (data.length === 0) return; ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath(); const xStep = chartWidth / (maxDataPoints - 1); data.forEach((value, index) =\u0026gt; { const x = padding + (xStep * index); const y = padding + chartHeight - (value * yScale); if (index === 0) { ctx.moveTo(x, y); } else { ctx.lineTo(x, y); } }); ctx.stroke(); } // 各負荷データをプロット drawLine(chartData.load1, \u0026#39;#ff6b6b\u0026#39;); // 1分平均（赤） drawLine(chartData.load5, \u0026#39;#4ecdc4\u0026#39;); // 5分平均（青緑） drawLine(chartData.load15, \u0026#39;#45b7d1\u0026#39;); // 15分平均（青） // 凡例 ctx.font = \u0026#39;12px Arial\u0026#39;; ctx.fillStyle = \u0026#39;#ff6b6b\u0026#39;; ctx.fillText(\u0026#39;1min\u0026#39;, width - padding - 100, 20); ctx.fillStyle = \u0026#39;#4ecdc4\u0026#39;; ctx.fillText(\u0026#39;5min\u0026#39;, width - padding - 60, 20); ctx.fillStyle = \u0026#39;#45b7d1\u0026#39;; ctx.fillText(\u0026#39;15min\u0026#39;, width - padding - 20, 20); // Y軸ラベル ctx.fillStyle = \u0026#39;#666\u0026#39;; ctx.textAlign = \u0026#39;right\u0026#39;; for (let i = 0; i \u0026lt;= 5; i++) { const value = (maxLoad * 1.2 / 5 * (5 - i)).toFixed(1); const y = padding + (chartHeight / 5) * i; ctx.fillText(value, padding - 10, y + 5); } } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ポイント解説：\nMojo::IOLoop-\u0026gt;recurring(1 =\u0026gt; sub {...}): 1秒ごとに定期実行されるタイマー collect_metrics(): システム情報を収集する関数（/proc/meminfoやuptimeコマンドを利用） Canvas APIを使った簡易グラフ描画 サーバーから定期的にプッシュされるデータをクライアント側で受信して表示 グラフデータは最大60ポイント（1分間分）を保持し、古いデータは自動的に削除 このダッシュボードを実行すると：\n1 perl dashboard_server.pl daemon ブラウザで http://localhost:3000/ を開くと、リアルタイムでメトリクスが更新されるダッシュボードが表示されます。複数のブラウザで開いても、それぞれが独立してメトリクスを受信します。\nWebSocketとHTTPポーリングの比較 従来のHTTPポーリング（定期的にリクエストを送る方式）と比較して、WebSocketには以下のメリットがあります：\n低レイテンシ: 接続が確立されているため、データがすぐに届く 低オーバーヘッド: 毎回HTTPヘッダーを送る必要がなく、通信量が大幅に削減される サーバーリソース削減: リクエスト処理が不要なため、サーバー負荷が低い リアルタイム性: サーバー側のイベントを即座にクライアントに通知できる WebSocketのベストプラクティス 実際のプロダクション環境でWebSocketを使う際のポイントをまとめておきます。\nセキュリティ対策 WebSocketアプリケーションのセキュリティは、通常のWebアプリケーション以上に注意が必要です。\nXSS（クロスサイトスクリプティング）対策\nユーザーから受け取ったメッセージをそのままHTMLに表示する場合、必ずエスケープ処理を行いましょう：\n1 2 3 4 5 function escapeHtml(text) { const div = document.createElement(\u0026#39;div\u0026#39;); div.textContent = text; return div.innerHTML; } WSS（WebSocket Secure）の使用\n本番環境では、必ず暗号化された wss:// プロトコルを使用しましょう。HTTPSと同様に、通信内容の盗聴や改ざんを防ぎます。Mojoliciousでは、以下のように簡単にTLS対応できます：\n1 2 # 証明書を用意して起動 perl myapp.pl daemon -l \u0026#39;https://*:3000?cert=/path/to/cert.pem\u0026amp;key=/path/to/key.pem\u0026#39; 入力検証とサニタイゼーション\n受信したメッセージは必ず検証し、想定外のデータを拒否しましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $c-\u0026gt;on(message =\u0026gt; sub ($c, $msg) { # 長すぎるメッセージを拒否 if (length($msg) \u0026gt; 1000) { $c-\u0026gt;send({json =\u0026gt; {error =\u0026gt; \u0026#39;Message too long\u0026#39;}}); return; } # JSONとして妥当かチェック my $data = eval { decode_json($msg) }; if ($@) { $c-\u0026gt;send({json =\u0026gt; {error =\u0026gt; \u0026#39;Invalid JSON\u0026#39;}}); return; } # 処理を続ける... }); パフォーマンス最適化 WebSocketアプリケーションを本番環境で運用する際は、パフォーマンスとリソース管理に注意を払う必要があります。\nメッセージサイズの管理\n大量のデータを送信する場合は、テキストではなくバイナリメッセージ（$c-\u0026gt;send({binary =\u0026gt; $data})）の使用を検討しましょう。画像やファイルなどのバイナリデータに適しています。\n接続数の制限\nサーバーリソースを守るため、最大接続数を制限することも重要です：\n1 2 3 4 5 6 7 8 9 10 my $max_clients = 1000; websocket \u0026#39;/chat\u0026#39; =\u0026gt; sub ($c) { if (scalar(keys %$clients) \u0026gt;= $max_clients) { $c-\u0026gt;send(\u0026#39;Server is full\u0026#39;); $c-\u0026gt;finish; return; } # 通常の処理... }; ハートビート（Ping/Pong）\n長時間接続を維持する場合、定期的なPingで接続の生存確認を行いましょう。これにより、無効な接続を早期に検出し、リソースを解放できます：\n1 2 3 4 5 6 7 8 9 10 websocket \u0026#39;/chat\u0026#39; =\u0026gt; sub ($c) { # 30秒ごとにPingを送信（接続の生存確認） my $ping_timer = Mojo::IOLoop-\u0026gt;recurring(30 =\u0026gt; sub { $c-\u0026gt;send({ping =\u0026gt; \u0026#39;\u0026#39;}); # Pingフレームを送信 }); $c-\u0026gt;on(finish =\u0026gt; sub { Mojo::IOLoop-\u0026gt;remove($ping_timer); }); }; エラーハンドリングと再接続 WebSocket接続は、ネットワーク障害、サーバー再起動、タイムアウトなど様々な理由で切断される可能性があります。クライアント側で自動再接続ロジックを実装することで、ユーザー体験を大幅に向上できます。\n以下は、指数バックオフを使った再接続の実装例です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 let ws; let reconnectInterval = 1000; // 初期値1秒 const maxReconnectInterval = 30000; // 最大30秒 function connect() { ws = new WebSocket(\u0026#39;ws://localhost:3000/chat\u0026#39;); ws.onopen = function() { console.log(\u0026#39;接続しました\u0026#39;); reconnectInterval = 1000; // リセット }; ws.onclose = function() { console.log(\u0026#39;切断されました。再接続します...\u0026#39;); setTimeout(function() { reconnectInterval = Math.min(reconnectInterval * 2, maxReconnectInterval); connect(); }, reconnectInterval); }; ws.onerror = function(error) { console.error(\u0026#39;WebSocketエラー:\u0026#39;, error); }; } connect(); まとめ この記事では、PerlのMojoliciousフレームワークを使って、WebSocketの基礎を3つのステップで学びました：\nエコーサーバー: WebSocketの基本的な送受信の仕組みを理解 リアルタイムチャット: 複数クライアント間のメッセージング、JSON形式でのデータ構造化 ダッシュボード: サーバープッシュによるリアルタイム可視化 Mojoliciousの強み：\n追加モジュール不要でWebSocketが使える UTF-8の自動処理で日本語も安心 シンプルなAPIで学習コストが低い 非同期I/Oによる高いパフォーマンス WebSocketが活きる場面：\nチャットアプリケーション リアルタイムゲーム 株価・スポーツスコアボード IoTデバイスからのデータストリーミング コラボレーションツール（共同編集など） WebSocketは一見難しそうに思えますが、Mojoliciousを使えばわずか数行から始められます。まずは今回のサンプルコードを動かしてみて、リアルタイム通信の面白さを体験してみてください！\n次のステップ WebSocketの基礎を学んだら、以下のような応用にもチャレンジしてみましょう：\n認証機能の追加: ユーザーログインとセッション管理 データベース連携: チャット履歴の永続化 負荷分散: 複数サーバーでのWebSocket運用 モバイル対応: スマートフォンアプリとの連携 参考リンク Mojoliciousの基本的な使い方については、こちらの記事も参考にしてください：\nMojolicious入門 — Mojolicious::Liteで始めるPerlのWeb開発 Perl製モダンWebフレームワークMojolicious（Mojolicious::Lite含む）の基本、ルーティング、テンプレート、JSON API、WebSocket、デプロイ方法などを初心者向けに解説します。 nqou.net 公式ドキュメント：\nMojolicious::Guides - The Mojolicious Guide to the Galaxy docs.mojolicious.org WebSocketプロトコルの詳細（RFC 6455）：\nRFC 6455: The WebSocket Protocol The WebSocket Protocol enables two-way communication between a client running untrusted code in a controlled environment … IETF Datatracker Happy WebSocket coding! 🚀\n","date":"2025-12-14T18:33:05+09:00","image":"https://www.nqou.net/public_images/2025/1765704785-image.jpg","permalink":"https://www.nqou.net/2025/12/14/183305/","title":"Perl WebSocket入門：Mojoliciousで作る3つの実践アプリ"},{"content":"Try::Tiny - 例外処理をスマートに エラー処理は堅牢なプログラムを書く上で欠かせません。Perlでは伝統的に eval を使ってエラーをキャッチしてきましたが、いくつかの落とし穴があります。Try::Tiny は、より安全で読みやすい例外処理を提供するモジュールです。\nPerlの伝統的なエラー処理 まず、Perlの基本的なエラー処理方法を振り返ってみましょう。\neval を使った基本的なエラー処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use feature qw(say); # 文字列eval（非推奨） eval \u0026#34;1 / 0\u0026#34;; if ($@) { say \u0026#34;エラー: $@\u0026#34;; } # ブロックeval（推奨） eval { my $result = 1 / 0; say \u0026#34;結果: $result\u0026#34;; }; if ($@) { say \u0026#34;エラーが発生: $@\u0026#34;; } # ファイル読み込みの例 eval { open my $fh, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;nonexistent.txt\u0026#39; or die \u0026#34;ファイルが開けません: $!\u0026#34;; # 処理 close $fh; }; if ($@) { say \u0026#34;ファイル操作エラー: $@\u0026#34;; } eval の問題点 従来の eval を使ったエラー処理にはいくつかの問題があります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 use feature qw(say); # 問題1: $@ が上書きされる可能性 eval { eval { die \u0026#34;内部エラー\u0026#34;; }; # ここで $@ が空になる可能性 my $x = some_function(); # この中で eval が使われると... if ($@) { # $@ が期待した値でないかも say \u0026#34;予期したエラー処理\u0026#34;; } }; # 問題2: $@ がオブジェクトの場合の真偽値判定 { package FalseException; use overload bool =\u0026gt; sub { 0 }, \u0026#39;\u0026#34;\u0026#34;\u0026#39; =\u0026gt; sub { \u0026#34;エラー\u0026#34; }; sub new { bless {}, shift } } eval { die FalseException-\u0026gt;new; }; if ($@) { # これは false になってしまう！ say \u0026#34;エラーを捕捉\u0026#34;; } else { say \u0026#34;エラーが見逃される！\u0026#34;; # こっちが実行される } # 問題3: $@ がリストコンテキストで予期しない動作 my @result = eval { die \u0026#34;エラー\u0026#34;; return (1, 2, 3); }; # $@ のチェックよりも先に @result を評価してしまう可能性 Try::Tiny の登場 Try::Tiny はこれらの問題を解決し、より安全で読みやすい例外処理を提供します。\nインストール 1 cpanm Try::Tiny 基本的な使い方 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Try::Tiny; use feature qw(say); # 基本形 try { die \u0026#34;何か問題が発生！\u0026#34;; } catch { say \u0026#34;エラーを捕捉: $_\u0026#34;; }; # 処理の結果を受け取る my $result = try { return 42; } catch { say \u0026#34;エラー: $_\u0026#34;; return 0; }; say \u0026#34;結果: $result\u0026#34;; # 42 # ファイル操作の例 try { open my $fh, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;data.txt\u0026#39; or die \u0026#34;ファイルが開けません: $!\u0026#34;; my $content = do { local $/; \u0026lt;$fh\u0026gt; }; close $fh; say \u0026#34;ファイル内容: $content\u0026#34;; } catch { say \u0026#34;ファイル読み込みエラー: $_\u0026#34;; }; Try::Tiny の重要な特徴：\nエラーは $_ に格納される（$@ ではない） try と catch はセミコロンで終わる必要がある 戻り値を適切に処理できる finally ブロック finally ブロックは、エラーの有無にかかわらず必ず実行されます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Try::Tiny; use feature qw(say); my $fh; try { open $fh, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;data.txt\u0026#39; or die \u0026#34;ファイルが開けません: $!\u0026#34;; # ファイル処理 my $data = \u0026lt;$fh\u0026gt;; say \u0026#34;読み込んだデータ: $data\u0026#34;; } catch { say \u0026#34;エラー: $_\u0026#34;; } finally { if ($fh) { close $fh; say \u0026#34;ファイルをクローズしました\u0026#34;; } }; finally の重要なポイント：\nエラーの有無にかかわらず実行される catch の前後どちらでも書ける リソースのクリーンアップに最適 エラーの再送出 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Try::Tiny; use feature qw(say); sub process_file { my ($filename) = @_; try { open my $fh, \u0026#39;\u0026lt;\u0026#39;, $filename or die \u0026#34;ファイルが開けません: $!\u0026#34;; # 処理 close $fh; } catch { say \u0026#34;ログに記録: $_\u0026#34;; die $_; # エラーを再送出 }; } try { process_file(\u0026#39;nonexistent.txt\u0026#39;); } catch { say \u0026#34;上位でキャッチ: $_\u0026#34;; }; エラーハンドリングのベストプラクティス 特定のエラーだけをキャッチ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 use Try::Tiny; use feature qw(say); { package FileNotFound; use overload \u0026#39;\u0026#34;\u0026#34;\u0026#39; =\u0026gt; sub { shift-\u0026gt;{message} }; sub new { my ($class, $message) = @_; bless { message =\u0026gt; $message }, $class; } } { package PermissionDenied; use overload \u0026#39;\u0026#34;\u0026#34;\u0026#39; =\u0026gt; sub { shift-\u0026gt;{message} }; sub new { my ($class, $message) = @_; bless { message =\u0026gt; $message }, $class; } } sub read_file { my ($filename) = @_; # ファイルの存在確認 die FileNotFound-\u0026gt;new(\u0026#34;ファイルが見つかりません: $filename\u0026#34;) unless -e $filename; # 読み取り権限確認 die PermissionDenied-\u0026gt;new(\u0026#34;読み取り権限がありません: $filename\u0026#34;) unless -r $filename; open my $fh, \u0026#39;\u0026lt;\u0026#39;, $filename or die \u0026#34;ファイルが開けません: $!\u0026#34;; my $content = do { local $/; \u0026lt;$fh\u0026gt; }; close $fh; return $content; } try { my $content = read_file(\u0026#39;/etc/shadow\u0026#39;); # 権限エラーになるはず say $content; } catch { if (ref($_) eq \u0026#39;FileNotFound\u0026#39;) { say \u0026#34;ファイルが見つかりません: $_\u0026#34;; # デフォルトファイルを使用 } elsif (ref($_) eq \u0026#39;PermissionDenied\u0026#39;) { say \u0026#34;権限エラー: $_\u0026#34;; # ユーザーに通知 } else { say \u0026#34;予期しないエラー: $_\u0026#34;; die $_; # 予期しないエラーは再送出 } }; ネストしたtry-catch 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use Try::Tiny; use feature qw(say); sub outer_function { try { say \u0026#34;外側の処理開始\u0026#34;; try { say \u0026#34;内側の処理開始\u0026#34;; die \u0026#34;内部エラー\u0026#34;; } catch { say \u0026#34;内側でキャッチ: $_\u0026#34;; # エラーを処理して続行 }; say \u0026#34;外側の処理続行\u0026#34;; die \u0026#34;外部エラー\u0026#34;; } catch { say \u0026#34;外側でキャッチ: $_\u0026#34;; }; } outer_function(); リトライロジック 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 use Try::Tiny; use feature qw(say); sub fetch_with_retry { my ($url, $max_retries) = @_; $max_retries //= 3; my $attempt = 0; my $result; while ($attempt \u0026lt; $max_retries) { $attempt++; say \u0026#34;試行 $attempt/$max_retries...\u0026#34;; try { # ネットワークリクエストをシミュレート die \u0026#34;接続エラー\u0026#34; if rand() \u0026gt; 0.6; $result = \u0026#34;データ取得成功\u0026#34;; say \u0026#34;成功！\u0026#34;; last; # 成功したらループを抜ける } catch { say \u0026#34;エラー: $_\u0026#34;; if ($attempt \u0026gt;= $max_retries) { die \u0026#34;最大リトライ回数に到達: $_\u0026#34;; } # 指数バックオフ my $wait = 2 ** ($attempt - 1); say \u0026#34;${wait}秒待機...\u0026#34;; sleep $wait; }; } return $result; } try { my $data = fetch_with_retry(\u0026#39;http://example.com/api\u0026#39;, 3); say \u0026#34;取得したデータ: $data\u0026#34;; } catch { say \u0026#34;最終的に失敗: $_\u0026#34;; }; 実用例 データベーストランザクション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 use Try::Tiny; use DBI; use feature qw(say); sub transfer_money { my ($dbh, $from_account, $to_account, $amount) = @_; try { $dbh-\u0026gt;begin_work; # 送金元から引き出し my $sth = $dbh-\u0026gt;prepare( \u0026#39;UPDATE accounts SET balance = balance - ? WHERE id = ?\u0026#39; ); $sth-\u0026gt;execute($amount, $from_account); die \u0026#34;残高不足\u0026#34; if $sth-\u0026gt;rows == 0; # 送金先に入金 $sth = $dbh-\u0026gt;prepare( \u0026#39;UPDATE accounts SET balance = balance + ? WHERE id = ?\u0026#39; ); $sth-\u0026gt;execute($amount, $to_account); die \u0026#34;送金先アカウントが見つかりません\u0026#34; if $sth-\u0026gt;rows == 0; $dbh-\u0026gt;commit; say \u0026#34;送金完了: $amount 円\u0026#34;; } catch { say \u0026#34;エラー発生: $_\u0026#34;; say \u0026#34;トランザクションをロールバックします\u0026#34;; try { $dbh-\u0026gt;rollback; } catch { say \u0026#34;ロールバック失敗: $_\u0026#34;; }; die $_; # エラーを再送出 }; } # 使用例 my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=bank.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 0 }); try { transfer_money($dbh, 1, 2, 1000); } catch { say \u0026#34;送金失敗: $_\u0026#34;; } finally { $dbh-\u0026gt;disconnect if $dbh; }; Web APIリクエスト 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 use Try::Tiny; use HTTP::Tiny; use JSON::PP; use feature qw(say); sub fetch_user_data { my ($user_id) = @_; my $http = HTTP::Tiny-\u0026gt;new(timeout =\u0026gt; 10); my $url = \u0026#34;https://api.example.com/users/$user_id\u0026#34;; my $user_data; try { my $response = $http-\u0026gt;get($url); die \u0026#34;HTTPエラー: $response-\u0026gt;{status} $response-\u0026gt;{reason}\u0026#34; unless $response-\u0026gt;{success}; $user_data = decode_json($response-\u0026gt;{content}); die \u0026#34;無効なデータ形式\u0026#34; unless $user_data-\u0026gt;{id} \u0026amp;\u0026amp; $user_data-\u0026gt;{name}; } catch { when (/timeout/) { say \u0026#34;タイムアウト: APIサーバーが応答しません\u0026#34;; } when (/HTTPエラー: 404/) { say \u0026#34;ユーザーが見つかりません: $user_id\u0026#34;; } when (/HTTPエラー: 5\\d\\d/) { say \u0026#34;サーバーエラー: $_\u0026#34;; } default { say \u0026#34;予期しないエラー: $_\u0026#34;; } # デフォルト値を返す $user_data = { id =\u0026gt; $user_id, name =\u0026gt; \u0026#39;Unknown\u0026#39; }; }; return $user_data; } my $user = fetch_user_data(123); say \u0026#34;ユーザー名: $user-\u0026gt;{name}\u0026#34;; ファイル処理の包括的な例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 use Try::Tiny; use File::Spec; use File::Path qw(make_path); use feature qw(say); sub process_log_file { my ($input_file, $output_dir) = @_; my $input_fh; my $output_fh; my $processed_count = 0; try { # 入力ファイルを開く open $input_fh, \u0026#39;\u0026lt;\u0026#39;, $input_file or die \u0026#34;入力ファイルが開けません: $!\u0026#34;; # 出力ディレクトリを作成 make_path($output_dir) unless -d $output_dir; my $output_file = File::Spec-\u0026gt;catfile($output_dir, \u0026#39;processed.log\u0026#39;); open $output_fh, \u0026#39;\u0026gt;\u0026#39;, $output_file or die \u0026#34;出力ファイルが開けません: $!\u0026#34;; # 行ごとに処理 while (my $line = \u0026lt;$input_fh\u0026gt;) { chomp $line; try { # 各行の処理 next if $line =~ /^#/; # コメント行はスキップ # エラー行だけ抽出 if ($line =~ /ERROR|FATAL/) { print $output_fh \u0026#34;$line\\n\u0026#34;; $processed_count++; } } catch { say \u0026#34;行の処理中にエラー: $_\u0026#34;; # 個別の行のエラーは続行 }; } say \u0026#34;処理完了: $processed_count 行を出力\u0026#34;; } catch { say \u0026#34;重大なエラー: $_\u0026#34;; die $_; } finally { close $input_fh if $input_fh; close $output_fh if $output_fh; say \u0026#34;ファイルをクローズしました\u0026#34;; }; } try { process_log_file(\u0026#39;/var/log/application.log\u0026#39;, \u0026#39;/tmp/processed_logs\u0026#39;); } catch { say \u0026#34;ログ処理が失敗しました: $_\u0026#34;; }; evalとTry::Tinyの比較 項目 eval Try::Tiny エラー変数 $@ $_ $@ の上書き問題 あり なし 偽値の例外 問題あり 正しく処理 読みやすさ 中程度 高い finally ブロック なし あり パフォーマンス 高速 わずかに遅い いつ何を使うべきか eval を使うべき場合：\nパフォーマンスが極めて重要 シンプルなエラー処理で十分 Try::Tiny の依存を避けたい Try::Tiny を使うべき場合：\n複雑なエラー処理が必要 安全性を重視 読みやすいコードを書きたい finally ブロックが必要 まとめ Try::Tiny は、Perlの例外処理をより安全で読みやすくする優れたモジュールです。\n重要なポイント：\n$@ の問題を回避 - より安全なエラー処理 finally ブロック - リソースのクリーンアップが確実 読みやすい構文 - コードの意図が明確 セミコロンを忘れずに - try と catch の後に必要 伝統的な eval も依然として有効ですが、複雑なエラー処理や安全性が重要な場合は Try::Tiny の使用を強くお勧めします。エラーハンドリングを適切に行うことで、堅牢で保守しやすいPerlプログラムを書くことができます。\n","date":"2025-12-14T00:00:00+09:00","image":"https://www.nqou.net/public_images/2025/20251214000000-image.jpg","permalink":"https://www.nqou.net/2025/12/14/000000/","title":"Try::Tiny - 例外処理をスマートに"},{"content":"Perlでのデータベース操作 - DBI/DBIx::Class データベースとのやり取りは、多くのアプリケーションで必須の機能です。Perlには長年培われた強力なデータベースアクセス層があり、低レベルな DBI から高レベルな ORM（Object-Relational Mapping）である DBIx::Class まで、用途に応じて選択できます。\nDBI - Database Interface DBI（Database Interface）は Perl のデータベースアクセスの基盤となるモジュールです。データベース非依存な API を提供し、MySQL、PostgreSQL、SQLite、Oracle など、さまざまなデータベースに統一的なインターフェースでアクセスできます。\nインストール 1 2 3 4 5 6 7 # DBI 本体 cpanm DBI # データベースドライバ（使用するDBに応じて） cpanm DBD::SQLite # SQLite cpanm DBD::mysql # MySQL cpanm DBD::Pg # PostgreSQL 基本的な接続と操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use DBI; use feature qw(say); # データベースに接続 my $dbh = DBI-\u0026gt;connect( \u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, # ユーザー名（SQLiteでは不要） \u0026#39;\u0026#39;, # パスワード（SQLiteでは不要） { RaiseError =\u0026gt; 1, # エラー時に例外を投げる AutoCommit =\u0026gt; 1, # 自動コミット PrintError =\u0026gt; 0, # エラーメッセージを自動出力しない } ) or die \u0026#34;接続エラー: $DBI::errstr\u0026#34;; # テーブル作成 $dbh-\u0026gt;do(q{ CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, email TEXT UNIQUE NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP ) }); say \u0026#34;データベース接続成功！\u0026#34;; # 接続を閉じる $dbh-\u0026gt;disconnect; プレースホルダとSQLインジェクション対策 絶対にやってはいけない例：\n1 2 3 4 5 # ❌ 危険！SQLインジェクションの脆弱性あり my $user_input = \u0026#34;\u0026#39;; DROP TABLE users; --\u0026#34;; my $sql = \u0026#34;SELECT * FROM users WHERE name = \u0026#39;$user_input\u0026#39;\u0026#34;; my $sth = $dbh-\u0026gt;prepare($sql); $sth-\u0026gt;execute(); 正しい方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 use DBI; my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 }); # ✅ プレースホルダを使用（安全） my $name = \u0026#34;\u0026#39;; DROP TABLE users; --\u0026#34;; # 悪意のある入力 my $sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE name = ?\u0026#39;); $sth-\u0026gt;execute($name); # 名前付きプレースホルダ（より読みやすい） my $sth2 = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE name = :name AND email = :email\u0026#39;); $sth2-\u0026gt;execute({ name =\u0026gt; $name, email =\u0026gt; \u0026#39;user@example.com\u0026#39; }); プレースホルダを使うことで：\nSQLインジェクション攻撃を防げる 値のエスケープが自動的に行われる SQL文の再利用が効率的 データの挿入（INSERT） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 use DBI; use feature qw(say); my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 }); # テーブル作成 $dbh-\u0026gt;do(q{ CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, email TEXT UNIQUE NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP ) }); # 1件挿入 my $sth = $dbh-\u0026gt;prepare(\u0026#39;INSERT INTO users (name, email) VALUES (?, ?)\u0026#39;); $sth-\u0026gt;execute(\u0026#39;山田太郎\u0026#39;, \u0026#39;yamada@example.com\u0026#39;); say \u0026#34;挿入されたID: \u0026#34;, $dbh-\u0026gt;last_insert_id(undef, undef, \u0026#39;users\u0026#39;, \u0026#39;id\u0026#39;); # 複数件を効率的に挿入 my @users = ( [\u0026#39;佐藤花子\u0026#39;, \u0026#39;sato@example.com\u0026#39;], [\u0026#39;鈴木一郎\u0026#39;, \u0026#39;suzuki@example.com\u0026#39;], [\u0026#39;田中美咲\u0026#39;, \u0026#39;tanaka@example.com\u0026#39;], ); my $insert_sth = $dbh-\u0026gt;prepare(\u0026#39;INSERT INTO users (name, email) VALUES (?, ?)\u0026#39;); for my $user (@users) { $insert_sth-\u0026gt;execute(@$user); } say \u0026#34;ユーザーを追加しました\u0026#34;; $dbh-\u0026gt;disconnect; データの取得（SELECT） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 use DBI; use feature qw(say); my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 }); # 全件取得 my $sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT id, name, email FROM users\u0026#39;); $sth-\u0026gt;execute(); say \u0026#34;=== 全ユーザー ===\u0026#34;; while (my $row = $sth-\u0026gt;fetchrow_hashref) { say \u0026#34;ID: $row-\u0026gt;{id}, 名前: $row-\u0026gt;{name}, Email: $row-\u0026gt;{email}\u0026#34;; } # 条件付き検索 my $search_sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE name LIKE ?\u0026#39;); $search_sth-\u0026gt;execute(\u0026#39;%太郎%\u0026#39;); say \u0026#34;\\n=== 検索結果（太郎） ===\u0026#34;; while (my @row = $search_sth-\u0026gt;fetchrow_array) { say join(\u0026#39;, \u0026#39;, @row); } # 1件だけ取得 my $one_sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE id = ?\u0026#39;); $one_sth-\u0026gt;execute(1); my $user = $one_sth-\u0026gt;fetchrow_hashref; if ($user) { say \u0026#34;\\n=== ID:1のユーザー ===\u0026#34;; say \u0026#34;名前: $user-\u0026gt;{name}\u0026#34;; say \u0026#34;Email: $user-\u0026gt;{email}\u0026#34;; } # 全件を配列で取得 my $all_sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT name, email FROM users ORDER BY name\u0026#39;); $all_sth-\u0026gt;execute(); my $all_users = $all_sth-\u0026gt;fetchall_arrayref({}); say \u0026#34;\\n=== 全ユーザー（ソート済み） ===\u0026#34;; for my $u (@$all_users) { say \u0026#34;$u-\u0026gt;{name} \u0026lt;$u-\u0026gt;{email}\u0026gt;\u0026#34;; } $dbh-\u0026gt;disconnect; データの更新と削除 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use DBI; use feature qw(say); my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 }); # 更新（UPDATE） my $update_sth = $dbh-\u0026gt;prepare(\u0026#39;UPDATE users SET email = ? WHERE name = ?\u0026#39;); my $rows_updated = $update_sth-\u0026gt;execute(\u0026#39;new_email@example.com\u0026#39;, \u0026#39;山田太郎\u0026#39;); say \u0026#34;更新された行数: $rows_updated\u0026#34;; # 削除（DELETE） my $delete_sth = $dbh-\u0026gt;prepare(\u0026#39;DELETE FROM users WHERE id = ?\u0026#39;); my $rows_deleted = $delete_sth-\u0026gt;execute(1); say \u0026#34;削除された行数: $rows_deleted\u0026#34;; $dbh-\u0026gt;disconnect; トランザクション処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use DBI; use feature qw(say); my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 0 }); # AutoCommit を無効化 eval { # トランザクション開始（AutoCommit=0 なので自動） $dbh-\u0026gt;do(\u0026#39;INSERT INTO users (name, email) VALUES (?, ?)\u0026#39;, undef, \u0026#39;佐藤次郎\u0026#39;, \u0026#39;sato2@example.com\u0026#39;); $dbh-\u0026gt;do(\u0026#39;INSERT INTO users (name, email) VALUES (?, ?)\u0026#39;, undef, \u0026#39;鈴木三郎\u0026#39;, \u0026#39;suzuki2@example.com\u0026#39;); # 意図的にエラーを起こす例 # $dbh-\u0026gt;do(\u0026#39;INSERT INTO users (name, email) VALUES (?, ?)\u0026#39;, # undef, \u0026#39;田中四郎\u0026#39;, \u0026#39;sato2@example.com\u0026#39;); # email重複エラー # コミット $dbh-\u0026gt;commit; say \u0026#34;トランザクション成功\u0026#34;; }; if ($@) { say \u0026#34;エラー発生: $@\u0026#34;; say \u0026#34;ロールバックします\u0026#34;; $dbh-\u0026gt;rollback; } $dbh-\u0026gt;disconnect; DBIx::Class - Perlの強力なORM DBIx::Class は Perl の代表的な ORM（Object-Relational Mapping）です。SQL を直接書くのではなく、オブジェクト指向的にデータベースを操作できます。\nインストール 1 2 3 cpanm DBIx::Class cpanm DBIx::Class::Schema::Loader # 既存DBからスキーマ自動生成 cpanm SQL::Translator # スキーマのデプロイに必要 スキーマの定義 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 # MyApp/Schema.pm package MyApp::Schema; use base qw(DBIx::Class::Schema); __PACKAGE__-\u0026gt;load_namespaces; 1; # MyApp/Schema/Result/User.pm package MyApp::Schema::Result::User; use base qw(DBIx::Class::Core); __PACKAGE__-\u0026gt;table(\u0026#39;users\u0026#39;); __PACKAGE__-\u0026gt;add_columns( id =\u0026gt; { data_type =\u0026gt; \u0026#39;integer\u0026#39;, is_auto_increment =\u0026gt; 1, }, name =\u0026gt; { data_type =\u0026gt; \u0026#39;varchar\u0026#39;, size =\u0026gt; 100, is_nullable =\u0026gt; 0, }, email =\u0026gt; { data_type =\u0026gt; \u0026#39;varchar\u0026#39;, size =\u0026gt; 255, is_nullable =\u0026gt; 0, }, created_at =\u0026gt; { data_type =\u0026gt; \u0026#39;datetime\u0026#39;, default_value =\u0026gt; \\\u0026#39;CURRENT_TIMESTAMP\u0026#39;, }, ); __PACKAGE__-\u0026gt;set_primary_key(\u0026#39;id\u0026#39;); __PACKAGE__-\u0026gt;add_unique_constraint(email_unique =\u0026gt; [\u0026#39;email\u0026#39;]); # リレーションシップの定義（後で使用） __PACKAGE__-\u0026gt;has_many( posts =\u0026gt; \u0026#39;MyApp::Schema::Result::Post\u0026#39;, \u0026#39;user_id\u0026#39; ); 1; # MyApp/Schema/Result/Post.pm package MyApp::Schema::Result::Post; use base qw(DBIx::Class::Core); __PACKAGE__-\u0026gt;table(\u0026#39;posts\u0026#39;); __PACKAGE__-\u0026gt;add_columns( id =\u0026gt; { data_type =\u0026gt; \u0026#39;integer\u0026#39;, is_auto_increment =\u0026gt; 1, }, user_id =\u0026gt; { data_type =\u0026gt; \u0026#39;integer\u0026#39;, is_foreign_key =\u0026gt; 1, }, title =\u0026gt; { data_type =\u0026gt; \u0026#39;varchar\u0026#39;, size =\u0026gt; 200, is_nullable =\u0026gt; 0, }, body =\u0026gt; { data_type =\u0026gt; \u0026#39;text\u0026#39;, is_nullable =\u0026gt; 1, }, created_at =\u0026gt; { data_type =\u0026gt; \u0026#39;datetime\u0026#39;, default_value =\u0026gt; \\\u0026#39;CURRENT_TIMESTAMP\u0026#39;, }, ); __PACKAGE__-\u0026gt;set_primary_key(\u0026#39;id\u0026#39;); __PACKAGE__-\u0026gt;belongs_to( user =\u0026gt; \u0026#39;MyApp::Schema::Result::User\u0026#39;, \u0026#39;user_id\u0026#39; ); 1; DBIx::Classの基本操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 use MyApp::Schema; use feature qw(say); # スキーマに接続 my $schema = MyApp::Schema-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=myapp.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 }); # テーブルをデプロイ（最初の1回だけ） $schema-\u0026gt;deploy({ add_drop_table =\u0026gt; 1 }); # === 作成（CREATE） === my $user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;create({ name =\u0026gt; \u0026#39;山田太郎\u0026#39;, email =\u0026gt; \u0026#39;yamada@example.com\u0026#39;, }); say \u0026#34;作成されたユーザーID: \u0026#34;, $user-\u0026gt;id; # 複数作成 $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;populate([ { name =\u0026gt; \u0026#39;佐藤花子\u0026#39;, email =\u0026gt; \u0026#39;sato@example.com\u0026#39; }, { name =\u0026gt; \u0026#39;鈴木一郎\u0026#39;, email =\u0026gt; \u0026#39;suzuki@example.com\u0026#39; }, ]); # === 検索（READ） === # 全件取得 my @all_users = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;all; say \u0026#34;全ユーザー数: \u0026#34;, scalar @all_users; # 条件付き検索 my @search_result = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( { name =\u0026gt; { like =\u0026gt; \u0026#39;%太郎%\u0026#39; } } )-\u0026gt;all; # 1件取得 my $found_user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;find(1); # IDで検索 if ($found_user) { say \u0026#34;見つかったユーザー: \u0026#34;, $found_user-\u0026gt;name; } # 条件付きで1件 my $single = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( { email =\u0026gt; \u0026#39;yamada@example.com\u0026#39; } )-\u0026gt;first; # === 更新（UPDATE） === $found_user-\u0026gt;update({ email =\u0026gt; \u0026#39;new_yamada@example.com\u0026#39; }); # または $found_user-\u0026gt;email(\u0026#39;another@example.com\u0026#39;); $found_user-\u0026gt;update; # 一括更新 $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( { name =\u0026gt; { like =\u0026gt; \u0026#39;%太郎%\u0026#39; } } )-\u0026gt;update({ name =\u0026gt; \\\u0026#39;name || \u0026#34; (更新済み)\u0026#34;\u0026#39; }); # === 削除（DELETE） === $found_user-\u0026gt;delete; # 条件付き削除 $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( { created_at =\u0026gt; { \u0026#39;\u0026lt;\u0026#39; =\u0026gt; \u0026#39;2025-01-01\u0026#39; } } )-\u0026gt;delete; リレーションシップの活用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 use MyApp::Schema; use feature qw(say); my $schema = MyApp::Schema-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=myapp.db\u0026#39;); # ユーザーを作成 my $user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;create({ name =\u0026gt; \u0026#39;山田太郎\u0026#39;, email =\u0026gt; \u0026#39;yamada@example.com\u0026#39;, }); # ユーザーに紐づく投稿を作成 my $post = $user-\u0026gt;create_related(\u0026#39;posts\u0026#39;, { title =\u0026gt; \u0026#39;はじめての投稿\u0026#39;, body =\u0026gt; \u0026#39;DBIx::Classは便利ですね！\u0026#39;, }); # または $schema-\u0026gt;resultset(\u0026#39;Post\u0026#39;)-\u0026gt;create({ user_id =\u0026gt; $user-\u0026gt;id, title =\u0026gt; \u0026#39;2つ目の投稿\u0026#39;, body =\u0026gt; \u0026#39;リレーションが簡単です\u0026#39;, }); # ユーザーの投稿を全て取得 my @user_posts = $user-\u0026gt;posts-\u0026gt;all; say $user-\u0026gt;name, \u0026#34; の投稿数: \u0026#34;, scalar @user_posts; for my $p (@user_posts) { say \u0026#34; - \u0026#34;, $p-\u0026gt;title; } # 投稿からユーザー情報を取得 my $post_with_user = $schema-\u0026gt;resultset(\u0026#39;Post\u0026#39;)-\u0026gt;find(1); say \u0026#34;投稿者: \u0026#34;, $post_with_user-\u0026gt;user-\u0026gt;name; # JOINを使った検索 my @posts = $schema-\u0026gt;resultset(\u0026#39;Post\u0026#39;)-\u0026gt;search( { \u0026#39;user.name\u0026#39; =\u0026gt; { like =\u0026gt; \u0026#39;%太郎%\u0026#39; } }, { join =\u0026gt; \u0026#39;user\u0026#39; } )-\u0026gt;all; # prefetch でN+1問題を回避 my @posts_with_users = $schema-\u0026gt;resultset(\u0026#39;Post\u0026#39;)-\u0026gt;search( {}, { prefetch =\u0026gt; \u0026#39;user\u0026#39; } )-\u0026gt;all; for my $p (@posts_with_users) { # user はすでにロード済みなので追加のSQLは発行されない say $p-\u0026gt;title, \u0026#34; by \u0026#34;, $p-\u0026gt;user-\u0026gt;name; } トランザクション（DBIx::Class版） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 use MyApp::Schema; use feature qw(say); my $schema = MyApp::Schema-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=myapp.db\u0026#39;); # txn_do を使ったトランザクション $schema-\u0026gt;txn_do(sub { my $user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;create({ name =\u0026gt; \u0026#39;佐藤次郎\u0026#39;, email =\u0026gt; \u0026#39;sato2@example.com\u0026#39;, }); $user-\u0026gt;create_related(\u0026#39;posts\u0026#39;, { title =\u0026gt; \u0026#39;初投稿\u0026#39;, body =\u0026gt; \u0026#39;よろしくお願いします\u0026#39;, }); # エラーが起きると自動でロールバック # die \u0026#34;エラーテスト\u0026#34; if $some_condition; }); say \u0026#34;トランザクション完了\u0026#34;; # 手動でのトランザクション制御 my $txn = $schema-\u0026gt;txn_scope_guard; eval { my $user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;create({ name =\u0026gt; \u0026#39;鈴木三郎\u0026#39;, email =\u0026gt; \u0026#39;suzuki3@example.com\u0026#39;, }); $txn-\u0026gt;commit; }; if ($@) { say \u0026#34;エラー: $@\u0026#34;; # commit していないので自動ロールバック } 実用的な例：ページネーション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 use MyApp::Schema; use feature qw(say); my $schema = MyApp::Schema-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=myapp.db\u0026#39;); sub get_users_page { my ($page, $per_page) = @_; $page //= 1; $per_page //= 10; my $rs = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( {}, { page =\u0026gt; $page, rows =\u0026gt; $per_page, order_by =\u0026gt; { -desc =\u0026gt; \u0026#39;created_at\u0026#39; }, } ); return { users =\u0026gt; [$rs-\u0026gt;all], total =\u0026gt; $rs-\u0026gt;pager-\u0026gt;total_entries, page =\u0026gt; $page, per_page =\u0026gt; $per_page, last_page =\u0026gt; $rs-\u0026gt;pager-\u0026gt;last_page, }; } my $result = get_users_page(1, 5); say \u0026#34;ページ $result-\u0026gt;{page} / $result-\u0026gt;{last_page}\u0026#34;; say \u0026#34;総件数: $result-\u0026gt;{total}\u0026#34;; for my $user (@{$result-\u0026gt;{users}}) { say \u0026#34; - \u0026#34;, $user-\u0026gt;name; } DBI と DBIx::Class の使い分け 項目 DBI DBIx::Class 学習コスト 低い 高い 柔軟性 高い 中程度 生産性 中程度 高い パフォーマンス 最速 やや遅い 保守性 中程度 高い 複雑なSQL 容易 難しい場合も DBIを選ぶべき場合：\nシンプルなSQLで十分 パフォーマンスが最重要 複雑なSQLを直接書きたい 学習コストを抑えたい DBIx::Classを選ぶべき場合：\n大規模なアプリケーション リレーションシップが多い オブジェクト指向的に扱いたい 保守性を重視 まとめ Perlでのデータベース操作は、DBI の低レベルな制御から DBIx::Class の高レベルな抽象化まで、幅広い選択肢があります。\n重要なポイント：\n必ずプレースホルダを使う - SQLインジェクション対策は必須 トランザクションを適切に使う - データの整合性を保つ 用途に応じてツールを選ぶ - DBI と DBIx::Class の使い分け N+1問題に注意 - DBIx::Class では prefetch を活用 データベースアクセスは多くのアプリケーションの基盤です。適切なツールと手法を選択することで、安全で効率的なデータ操作を実現できます。\n","date":"2025-12-13T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251213-dbi.jpg","permalink":"https://www.nqou.net/2025/12/13/000000/","title":"Perlでのデータベース操作 — DBI / DBIx::Class 入門"},{"content":"はじめに いよいよ最終回です！これまでの4回で、TDDの基本から環境構築、メソッドのテスト、そしてCI環境まで構築してきました。\nこの最終回では、実践的なTDDテクニックと**よくある落とし穴（アンチパターン）**を学びます。また、継続的に改善していく方法を身につけて、シリーズを完結させましょう。\nこれまでの旅路 簡単に振り返ってみます。\n#1：環境構築とTDDの基本サイクル（レッド→グリーン→リファクタリング） #2：メソッドのテストとTest2の便利な機能（例外テスト、サブテスト） #3：テストに守られながらリファクタリング（Mooのロール機能の活用） #4：GitHub ActionsでCI環境を構築 そして今回は、これらの知識を総動員して、より良いテストを書くためのノウハウを学びます。\nテストの品質を高める テストを書くだけでなく、良いテストを書くことが重要です。\n意味のあるテストとは 良いテストの条件を整理しましょう。\n1 2 3 4 5 6 7 8 9 10 11 # 悪い例：カバレッジのためだけのテスト subtest \u0026#39;getter exists\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); ok($person-\u0026gt;can(\u0026#39;name\u0026#39;), \u0026#39;name method exists\u0026#39;); }; # 良い例：振る舞いをテストする subtest \u0026#39;name getter returns correct value\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); is($person-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name returns the set value\u0026#39;); }; 良いテストは、コードの振る舞いをテストします。メソッドが存在するかではなく、期待通りに動作するかを確認しましょう。\nテストすべき観点 効果的なテストを書くために、以下の観点を押さえましょう。\n1. 正常系（Happy Path）\n期待される通常の使い方をテストします。\n1 2 3 4 5 subtest \u0026#39;normal deposit\u0026#39; =\u0026gt; sub { my $account = BankAccount-\u0026gt;new(balance =\u0026gt; 100); $account-\u0026gt;deposit(50); is($account-\u0026gt;balance, 150, \u0026#39;deposit increases balance\u0026#39;); }; 2. 異常系（Error Cases）\nエラーが適切に処理されることを確認します。\n1 2 3 4 5 6 7 8 9 10 11 use Test2::Tools::Exception; subtest \u0026#39;invalid deposit\u0026#39; =\u0026gt; sub { my $account = BankAccount-\u0026gt;new(balance =\u0026gt; 100); like( dies { $account-\u0026gt;deposit(-50) }, qr/Amount must be positive/, \u0026#39;negative deposit throws error\u0026#39; ); }; 3. 境界値（Edge Cases）\n境界となる値でのテストを忘れずに。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 subtest \u0026#39;boundary values\u0026#39; =\u0026gt; sub { my $account = BankAccount-\u0026gt;new(balance =\u0026gt; 100); # ちょうど残高と同じ金額 ok(lives { $account-\u0026gt;withdraw(100) }, \u0026#39;can withdraw exact balance\u0026#39;); is($account-\u0026gt;balance, 0, \u0026#39;balance is now zero\u0026#39;); # 残高がゼロの時 like( dies { $account-\u0026gt;withdraw(1) }, qr/Insufficient funds/, \u0026#39;cannot withdraw from empty account\u0026#39; ); }; テストしにくいコードは、往々にして設計上の問題を抱えています。\n1 2 3 4 5 # 悪い例：テストしにくい（現在時刻に依存） sub is_business_hours { my $hour = (localtime)[2]; return $hour \u0026gt;= 9 \u0026amp;\u0026amp; $hour \u0026lt; 18; } このコードは、実行時刻によって結果が変わるため、テストが困難です。改善しましょう。\n1 2 3 4 5 6 7 8 9 10 # 良い例：時刻を引数で受け取る sub is_business_hours { my ($self, $hour) = @_; $hour //= (localtime)[2]; # デフォルトは現在時刻 return $hour \u0026gt;= 9 \u0026amp;\u0026amp; $hour \u0026lt; 18; } # テストが簡単になる is($obj-\u0026gt;is_business_hours(10), 1, \u0026#39;10時は営業時間内\u0026#39;); is($obj-\u0026gt;is_business_hours(20), \u0026#39;\u0026#39;, \u0026#39;20時は営業時間外\u0026#39;); 依存性の注入によって、テスタビリティが向上しました。\nテストしやすい設計のパターン テストしやすいコードを書くための設計パターンをいくつか紹介します。\n1. 依存性の注入（Dependency Injection）\n外部依存を引数やコンストラクタで受け取ることで、テストで差し替えやすくします。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # 悪い例：内部でハードコーディング package UserService; use Moo; sub get_user { my ($self, $id) = @_; my $db = Database-\u0026gt;new(host =\u0026gt; \u0026#39;prod.example.com\u0026#39;); # ハードコーディング return $db-\u0026gt;find_user($id); } # 良い例：依存性を注入 package UserService; use Moo; has \u0026#39;database\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); sub get_user { my ($self, $id) = @_; return $self-\u0026gt;database-\u0026gt;find_user($id); } # テストでモックを注入できる my $mock_db = MockDatabase-\u0026gt;new; my $service = UserService-\u0026gt;new(database =\u0026gt; $mock_db); 2. 単一責任の原則（Single Responsibility Principle）\n1つのクラスは1つの責任だけを持つようにします。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 悪い例：複数の責任を持つ package UserManager; sub create_user { ... } sub send_welcome_email { ... } # メール送信も担当 sub generate_report { ... } # レポート生成も担当 # 良い例：責任を分離 package UserRepository; sub create_user { ... } package EmailService; sub send_welcome_email { ... } package ReportGenerator; sub generate_report { ... } 責任を分離することで、各クラスのテストが簡潔になります。\n実践的なTDDテクニック 経験から学んだ、実践で役立つテクニックを紹介します。\nテストの粒度の考え方 テストの粒度（どこまで細かくテストするか）は、バランスが重要です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 細かすぎる例（内部実装に依存しすぎ） subtest \u0026#39;increment counter internal\u0026#39; =\u0026gt; sub { my $counter = Counter-\u0026gt;new; is($counter-\u0026gt;{_count}, 0, \u0026#39;internal count is 0\u0026#39;); # 実装詳細に依存 $counter-\u0026gt;increment; is($counter-\u0026gt;{_count}, 1, \u0026#39;internal count is 1\u0026#39;); }; # 適切な粒度（公開インターフェースをテスト） subtest \u0026#39;increment counter\u0026#39; =\u0026gt; sub { my $counter = Counter-\u0026gt;new; is($counter-\u0026gt;count, 0, \u0026#39;initial count is 0\u0026#39;); $counter-\u0026gt;increment; is($counter-\u0026gt;count, 1, \u0026#39;count incremented to 1\u0026#39;); }; 公開インターフェースをテストし、内部実装の詳細には立ち入らないようにしましょう。\nモック・スタブの使い方 外部依存をモックすることで、テストの独立性を保ちます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use Test2::Mock; subtest \u0026#39;email notification with mock\u0026#39; =\u0026gt; sub { my $mock = Test2::Mock-\u0026gt;new( class =\u0026gt; \u0026#39;EmailService\u0026#39;, override =\u0026gt; [ send =\u0026gt; sub { my ($self, %args) = @_; return { success =\u0026gt; 1, message_id =\u0026gt; \u0026#39;test-123\u0026#39; }; } ] ); my $notifier = Notifier-\u0026gt;new(email_service =\u0026gt; EmailService-\u0026gt;new); my $result = $notifier-\u0026gt;notify_user(\u0026#39;user@example.com\u0026#39;, \u0026#39;Hello\u0026#39;); ok($result-\u0026gt;{success}, \u0026#39;notification succeeded with mock\u0026#39;); }; モックを使うことで、実際にメールを送信せずにテストできます。\nテストダブルのパターン テストダブルには複数のパターンがあります。\nスタブ（Stub）：決まった値を返すだけのシンプルな代用品\n1 2 3 my $stub_db = StubDatabase-\u0026gt;new( find_user =\u0026gt; sub { return { id =\u0026gt; 1, name =\u0026gt; \u0026#39;Test User\u0026#39; } } ); モック（Mock）：呼び出しを記録し、検証できる代用品\n1 2 3 my $mock = Test2::Mock-\u0026gt;new(class =\u0026gt; \u0026#39;Logger\u0026#39;); # ... テスト実行 ... # 呼び出しが行われたかを検証 フェイク（Fake）：本物に近い動作をする簡易実装（例：インメモリDB）\n1 my $fake_cache = FakeCache-\u0026gt;new; # 実際のRedisの代わりにハッシュを使用 使い分けのポイント：\nスタブ：単純な戻り値のテストに モック：呼び出しの検証が必要なときに フェイク：複雑な振る舞いが必要なときに TDDのアンチパターン 陥りがちな失敗例を知って、避けましょう。\nテストのためのコード（避けるべき） 本番コードに「テストのため\u0026quot;だけ\u0026quot;のコード」を入れるのは避けるべきです。\n1 2 3 4 5 6 7 8 9 10 # アンチパターン：テストのためのフラグ package UserService; has \u0026#39;test_mode\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, default =\u0026gt; 0); # 避けるべき sub send_email { my ($self, $email) = @_; return if $self-\u0026gt;test_mode; # テストモードでは送信しない # 実際のメール送信処理 } 代わりに、依存性の注入を使いましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 # 良い例：依存性の注入 package UserService; has \u0026#39;email_sender\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); sub send_email { my ($self, $email) = @_; $self-\u0026gt;email_sender-\u0026gt;send($email); } # テストではモックを注入 my $service = UserService-\u0026gt;new(email_sender =\u0026gt; $mock_sender); テストの重複 同じことを何度もテストするのは、メンテナンスコストを増やすだけです。\n1 2 3 4 5 6 7 8 9 10 # 重複したテスト（避けるべき） subtest \u0026#39;name validation test 1\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); is($person-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name is Alice\u0026#39;); }; subtest \u0026#39;name validation test 2\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); is($person-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name is Alice again\u0026#39;); # 重複 }; テストは異なるケースをカバーするようにしましょう。\n壊れやすいテスト 実装の些細な変更でテストが壊れるのは、テストが実装に密結合しているサインです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 # 壊れやすいテスト subtest \u0026#39;internal implementation\u0026#39; =\u0026gt; sub { my $obj = MyClass-\u0026gt;new; is(ref($obj-\u0026gt;{_internal_cache}), \u0026#39;HASH\u0026#39;, \u0026#39;uses hash for cache\u0026#39;); # 実装詳細 }; # 堅牢なテスト（振る舞いに着目） subtest \u0026#39;caching behavior\u0026#39; =\u0026gt; sub { my $obj = MyClass-\u0026gt;new; my $result1 = $obj-\u0026gt;expensive_operation; my $result2 = $obj-\u0026gt;expensive_operation; is($result1, $result2, \u0026#39;results are consistent (cached)\u0026#39;); }; what（何をするか） をテストし、how（どうやるか） には立ち入らないのがコツです。\n継続的な改善 TDDは一度やって終わりではなく、継続的に改善していくものです。\nリファクタリングのタイミング 「いつリファクタリングするか？」の答えは、テストが通っているときです。\nTDDのサイクルを思い出してください。\nレッド：失敗するテストを書く グリーン：テストを通す（最小実装でOK） リファクタリング：テストが通った状態でコードを改善 ← ここ！ テストがあるからこそ、安心してリファクタリングできるのです。\n1 2 3 4 5 # リファクタリングの流れ $ prove -lv t/ # グリーン確認 $ # コードを改善する $ prove -lv t/ # まだグリーン？ $ git commit -m \u0026#34;refactor: improve readability\u0026#34; テストコードもリファクタリング対象 テストコード自体も、読みやすく保守しやすくする必要があります。\n共通処理をヘルパーメソッドに\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # Before：重複が多い subtest \u0026#39;test 1\u0026#39; =\u0026gt; sub { my $db = TestDB-\u0026gt;new; $db-\u0026gt;setup_schema; $db-\u0026gt;insert_test_data; # テスト本体 }; subtest \u0026#39;test 2\u0026#39; =\u0026gt; sub { my $db = TestDB-\u0026gt;new; $db-\u0026gt;setup_schema; $db-\u0026gt;insert_test_data; # テスト本体 }; # After：ヘルパーを使う sub create_test_db { my $db = TestDB-\u0026gt;new; $db-\u0026gt;setup_schema; $db-\u0026gt;insert_test_data; return $db; } subtest \u0026#39;test 1\u0026#39; =\u0026gt; sub { my $db = create_test_db(); # テスト本体 }; チームでのTDD文化の育て方 TDDを個人だけでなく、チーム全体に広げるためのヒントです。\n1. 小さく始める\nいきなり全てをTDDで書く必要はありません。\nまずは新機能だけTDDで書いてみる バグ修正時に、再現テストを先に書く習慣をつける レビュー時にテストの質を確認し合う 2. ペアプログラミング・モブプログラミング\n一人で悩むより、チームで一緒にTDDを実践すると学びが深まります。\n1 2 3 4 5 # ペアでTDD：役割を交代しながら Alice: テストを書く（レッド） Bob: 実装を書く（グリーン） Alice: リファクタリング # 役割交代して次のテストへ 3. 成功体験を共有する\nテストのおかげで救われたバグの話 リファクタリングが安全にできた話 テストが増えて、コードへの自信が高まったこと こうした体験をチームで共有すると、TDDの価値が伝わります。\n4. CI/CDと組み合わせる\n前回（#4）で構築したCIがあれば、テストが自動で走ります。これが「テストを書かないと気持ち悪い」文化を作ります。\n1 2 3 4 5 6 7 8 9 10 11 # .github/workflows/test.yml name: Test on: [push, pull_request] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Run tests run: | docker compose run --rm app prove -lr t/ 自動テストがあれば、プルリクエストのマージ前に問題を検出できます。\nまとめ：TDDの旅を振り返る 全5回の連載、お疲れさまでした！一緒にたくさんのことを学んできましたね。\n5回で学んだこと #1 環境構築とはじめてのテスト駆動開発\nDockerでの開発環境構築 TDDの基本サイクル（レッド→グリーン→リファクタリング） Test2とMooの基礎 #2 メソッドのテストとTest2の便利な機能\n戻り値のテスト、例外のテスト Test2の多彩なアサーション（like, is_deeply, matchなど） サブテストによる整理 #3 テストに守られながらリファクタリング\nMooのロール機能を使ったコードの再利用 リファクタリングの実践 テストがあるからこその安全なコード改善 #4 GitHub ActionsでCI環境を構築\nCIの重要性と自動テストの価値 GitHub Actionsの基本 DockerとCIの統合 #5 実践的なTDDテクニックとベストプラクティス（今回）\n良いテストを書くための観点 テストしやすい設計のパターン 実践的なTDDテクニック（モック、スタブ） アンチパターンの回避 継続的な改善とチーム文化 これからの学習リソース TDDの旅は、ここで終わりではありません。さらに学びを深めるためのリソースを紹介します。\n書籍\n『テスト駆動開発』Kent Beck（オーム社）：TDDのバイブル的存在 『リファクタリング』Martin Fowler（オーム社）：テストとセットで学ぶべき必読書 オンラインリソース\nTest2::Suite Documentation：公式ドキュメント Moo Documentation：Mooの公式ドキュメント Perl Testing: A Developer\u0026rsquo;s Notebook：実践的なPerlテスト技法 コミュニティ\nCPAN Testersの活動を見る：オープンソースのテスト文化を学べます 社内勉強会でTDDを実践してみる：仲間と一緒に学ぶのが一番です おわりに TDDは、最初は「面倒だな」と感じるかもしれません。テストを先に書くのは、慣れないうちは不自然に思えるでしょう。\nでも、続けていくうちに、こう感じる瞬間が来ます。\n「テストがあるから、安心してリファクタリングできる」 「バグを見つけたとき、まずテストで再現できる」 「CIが通っているから、自信を持ってデプロイできる」 これがTDDの魅力です。\n最初から完璧を目指す必要はありません。小さく始めて、少しずつ改善していきましょう。\nテストを書く習慣を身につけ、それを楽しめるようになったとき、あなたのコーディングライフは大きく変わっているはずです。\n最後まで読んでいただき、ありがとうございました。この連載が、あなたのTDDの第一歩になれば嬉しいです。\nHappy Testing! 🎉\n連載リンク\n#1 環境構築とはじめてのテスト駆動開発 #2 メソッドのテストとTest2の便利な機能 #3 テストに守られながらリファクタリング #4 GitHub ActionsでCI環境を構築 #5 実践的なTDDテクニックとベストプラクティス（この記事） ","date":"2025-12-12T21:47:54+09:00","image":"https://www.nqou.net/public_images/2025/1765543674-image.jpg","permalink":"https://www.nqou.net/2025/12/12/214754/","title":"MooによるTDD講座 #5 - 実践的なTDDテクニックとベストプラクティス"},{"content":"はじめに - 8年越しの誤解 恥ずかしながら、私は8年もの間、JSON-RPC 2.0の仕様を誤解していました。\n具体的には、「エラーレスポンスの場合は、リクエストIDが正しく取得できた場合でも、IDをnullにして返す必要がある」と解釈していたのです。この誤解のまま、自作のPerlモジュール JSON::RPC::Spec を実装し、CPANに公開していました。\nJSON::RPC::Spec Yet another JSON-RPC 2.0 Implementation MetaCPAN 最近、別の用途でJSON-RPC 2.0の仕様を見直す機会があり、ようやく自分の勘違いに気づきました。正しくは「IDは可能な限り保持する」というスタンスの仕様だったのです。\nこの記事では、JSON-RPC 2.0におけるエラー時のID必須仕様について、仕様の意図、実装の注意点、他のRPCプロトコルとの比較などを詳しく解説します。\nJSON-RPC 2.0の基本構造 まず、JSON-RPC 2.0の基本的な構造を確認しておきましょう。\nリクエストオブジェクト JSON-RPC 2.0のリクエストは、以下の構造を持ちます。\n1 2 3 4 5 6 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;subtract\u0026#34;, \u0026#34;params\u0026#34;: [42, 23], \u0026#34;id\u0026#34;: 1 } jsonrpc: プロトコルバージョン（必須、\u0026ldquo;2.0\u0026quot;固定） method: 呼び出すメソッド名（必須） params: パラメータ（省略可） id: リクエスト識別子（通知以外では必須） レスポンスオブジェクト 成功時のレスポンスは以下のようになります。\n1 2 3 4 5 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;result\u0026#34;: 19, \u0026#34;id\u0026#34;: 1 } エラー時のレスポンスはこうなります。\n1 2 3 4 5 6 7 8 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: -32601, \u0026#34;message\u0026#34;: \u0026#34;Method not found\u0026#34; }, \u0026#34;id\u0026#34;: 1 } 重要なのは、エラーレスポンスにもidフィールドが必須という点です。\nエラーレスポンスにおけるID必須仕様 仕様の正確な記述 JSON-RPC 2.0の公式仕様書には、エラーレスポンスのIDについて、以下のように明記されています。\n\u0026ldquo;id: It MUST be the same as the value of the id member in the Request Object. If there was an error in detecting the id in the Request object (e.g. Parse error/Invalid Request), it MUST be Null.\u0026rdquo;\n日本語に訳すと：\n「id: リクエストオブジェクトのidメンバーの値と同じでなければならない（MUST）。リクエストオブジェクトのidを検出する際にエラーが発生した場合（例：パースエラーや無効なリクエスト）、idはNullでなければならない（MUST）。」\n私の誤解と正しい理解 私が誤解していたのは、この「MUST be Null」の適用範囲でした。\n誤解していた解釈：\nエラーが発生した場合は、常にidをnullにする 正しい解釈：\nリクエストからidを正しく取得できた場合は、そのidをそのまま返す リクエストのパースに失敗するなど、idを取得できなかった場合のみ、nullを返す つまり、IDは可能な限り保持するというのが仕様の意図なのです。\nnullになるケース IDがnullになるのは、以下のような限定的なケースのみです。\n1. Parse Error（-32700）\nJSONのパースに失敗した場合、リクエスト全体が読み取れないため、idも取得できません。\n1 2 3 4 5 6 7 8 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: -32700, \u0026#34;message\u0026#34;: \u0026#34;Parse error\u0026#34; }, \u0026#34;id\u0026#34;: null } 2. Invalid Request（-32600）\nJSON自体は正しくても、JSON-RPCのリクエスト形式として不正な場合です。例えば、methodフィールドが欠けている場合など。\n1 2 3 4 5 6 // 不正なリクエスト例 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;params\u0026#34;: [1, 2] // methodが欠けている！ } この場合も、idを安全に取得できないと判断されれば、nullが返されます。\n1 2 3 4 5 6 7 8 { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: -32600, \u0026#34;message\u0026#34;: \u0026#34;Invalid Request\u0026#34; }, \u0026#34;id\u0026#34;: null } 3. その他、idが取得不能な場合\nリクエストにidフィールドが存在しない、または型が不正な場合なども該当します。\nIDを保持するケース 一方、以下のようなエラーの場合は、リクエストのIDをそのまま返します。\nMethod not found（-32601）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // リクエスト { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;nonexistent\u0026#34;, \u0026#34;id\u0026#34;: 42 } // レスポンス { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: -32601, \u0026#34;message\u0026#34;: \u0026#34;Method not found\u0026#34; }, \u0026#34;id\u0026#34;: 42 // リクエストのIDを保持 } Invalid params（-32602）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // リクエスト { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;subtract\u0026#34;, \u0026#34;params\u0026#34;: [\u0026#34;not\u0026#34;, \u0026#34;numbers\u0026#34;], \u0026#34;id\u0026#34;: \u0026#34;abc\u0026#34; } // レスポンス { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: -32602, \u0026#34;message\u0026#34;: \u0026#34;Invalid params\u0026#34; }, \u0026#34;id\u0026#34;: \u0026#34;abc\u0026#34; // リクエストのIDを保持 } Internal error（-32603）やアプリケーションエラー\nこれらも同様に、リクエストのIDを保持します。\nなぜIDを可能な限り保持するのか この「IDを可能な限り保持する」という設計には、深い意図があります。\n非同期通信とリクエストの多重化 JSON-RPC 2.0は、WebSocketやHTTP/2のような非同期通信プロトコル上での利用を想定しています。\nクライアントが複数のリクエストを並列に送信した場合、レスポンスの順序は保証されません。IDがあることで、どのレスポンスがどのリクエストに対応するのかを確実に識別できます。\n1 2 3 4 5 6 7 // クライアント側の疑似コード const promise1 = rpc.call(\u0026#34;method1\u0026#34;, [1], id: 1); const promise2 = rpc.call(\u0026#34;method2\u0026#34;, [2], id: 2); const promise3 = rpc.call(\u0026#34;method3\u0026#34;, [3], id: 3); // レスポンスは順不同で返ってくる可能性がある // IDがあることで正しく対応付けられる もしエラーレスポンスのIDが常にnullだったら、どのリクエストが失敗したのか判別できなくなってしまいます。\nトレーサビリティとデバッグ ログやモニタリングシステムでリクエスト-レスポンスのペアを追跡する際、IDは重要な役割を果たします。\n1 2 [INFO] Request received: id=12345, method=getUserInfo [ERROR] Method not found: id=12345 IDが保持されていれば、ログを時系列で並べなくても、対応するリクエストとレスポンスを簡単に見つけられます。\nバッチリクエストでの識別 JSON-RPC 2.0はバッチリクエスト（複数のリクエストを配列で一度に送信）をサポートしています。\n1 2 3 4 5 [ {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;sum\u0026#34;, \u0026#34;params\u0026#34;: [1,2,4], \u0026#34;id\u0026#34;: \u0026#34;1\u0026#34;}, {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;subtract\u0026#34;, \u0026#34;params\u0026#34;: [42,23], \u0026#34;id\u0026#34;: \u0026#34;2\u0026#34;}, {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;get_data\u0026#34;, \u0026#34;id\u0026#34;: \u0026#34;3\u0026#34;} ] レスポンスもバッチで返ってきますが、IDがあることで、どのレスポンスがどのリクエストに対応するかが明確になります。\n1 2 3 4 5 [ {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;result\u0026#34;: 7, \u0026#34;id\u0026#34;: \u0026#34;1\u0026#34;}, {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;result\u0026#34;: 19, \u0026#34;id\u0026#34;: \u0026#34;2\u0026#34;}, {\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34;: {\u0026#34;code\u0026#34;: -32601, \u0026#34;message\u0026#34;: \u0026#34;Method not found\u0026#34;}, \u0026#34;id\u0026#34;: \u0026#34;3\u0026#34;} ] JSON::RPC::Specの修正内容 私が作成した JSON::RPC::Spec では、エラー時に常にIDをnullにする実装になっていました。\n修正前のコード（概念） 1 2 3 4 5 6 7 8 9 10 11 12 # 誤った実装（概念） sub create_error_response { my ($error_code, $error_message) = @_; return { jsonrpc =\u0026gt; \u0026#34;2.0\u0026#34;, error =\u0026gt; { code =\u0026gt; $error_code, message =\u0026gt; $error_message, }, id =\u0026gt; undef, # 常にnull（誤り） }; } 修正後のコード（概念） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 正しい実装（概念） sub create_error_response { my ($error_code, $error_message, $request_id) = @_; return { jsonrpc =\u0026gt; \u0026#34;2.0\u0026#34;, error =\u0026gt; { code =\u0026gt; $error_code, message =\u0026gt; $error_message, }, id =\u0026gt; $request_id, # リクエストのIDを保持 }; } # Parse ErrorやInvalid Requestの場合のみnullを渡す 修正版では、リクエストから取得したIDをそのままレスポンスに含めるようにしました。\n当時、バッチリクエストに対応している実装が少ないと聞いていたため、バッチ対応を意識して実装したつもりでしたが、肝心の仕様を誤解していたのは皮肉なことです。\n実装時に「なぜわざわざIDを消すんだろう？」と疑問に思っていたことを覚えています。今になって思えば、その直感は正しかったのです。\n他のRPCプロトコルとの比較 JSON-RPC 2.0のID必須仕様の特徴を理解するために、他のRPCプロトコルと比較してみましょう。\nREST API RESTful APIは、HTTPのリクエスト-レスポンスモデルに依存しています。\n特徴：\n同期的な通信が基本 TCPコネクション自体がリクエストとレスポンスの対応を保証 アプリケーションレベルでのID管理は不要 エラーハンドリング：\nHTTPステータスコード（200, 404, 500など）に依存 エラー詳細はレスポンスボディで自由形式（標準化なし） 1 2 3 4 5 6 HTTP/1.1 404 Not Found Content-Type: application/json { \u0026#34;error\u0026#34;: \u0026#34;User not found\u0026#34; } XML-RPC JSON-RPCの前身とも言えるプロトコルです。\n特徴：\n同期通信が前提 HTTPリクエスト-レスポンスの1対1対応のみ ID管理の仕組みなし エラーハンドリング：\nfaultCodeとfaultStringのみ コードの標準化なし（実装依存） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;methodResponse\u0026gt; \u0026lt;fault\u0026gt; \u0026lt;value\u0026gt; \u0026lt;struct\u0026gt; \u0026lt;member\u0026gt; \u0026lt;name\u0026gt;faultCode\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;\u0026lt;int\u0026gt;4\u0026lt;/int\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/member\u0026gt; \u0026lt;member\u0026gt; \u0026lt;name\u0026gt;faultString\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;Too many parameters.\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/member\u0026gt; \u0026lt;/struct\u0026gt; \u0026lt;/value\u0026gt; \u0026lt;/fault\u0026gt; \u0026lt;/methodResponse\u0026gt; gRPC Googleが開発した高性能RPCフレームワークです。\n特徴：\nHTTP/2ベースで双方向ストリーミング対応 ストリームIDをHTTP/2のフレームレベルで管理 アプリケーション層での明示的なID不要 エラーハンドリング：\n16種類の標準ステータスコード（OK, CANCELLED, INVALID_ARGUMENT等） 詳細なメタデータとスタックトレース対応 1 2 3 4 5 6 7 8 9 10 11 // gRPCのエラーは構造化されている rpc GetUser(UserRequest) returns (UserResponse) { option (google.api.http) = { get: \u0026#34;/v1/users/{user_id}\u0026#34; }; } // エラー時 Status: INVALID_ARGUMENT Message: \u0026#34;Invalid user ID format\u0026#34; Details: [additional structured data] 比較表 プロトコル ID管理 多重化 バッチ処理 エラー標準化 JSON-RPC 2.0 アプリケーション層で必須 ✓ ✓ ✓（標準コード） REST API 不要（HTTP依存） × △（実装依存） △（HTTPステータス） XML-RPC なし × × △（実装依存） gRPC HTTP/2層で管理 ✓ △（ストリーム） ✓（16種類） JSON-RPC 2.0の位置づけ JSON-RPC 2.0は、以下の点で独自の強みを持っています。\n1. シンプルさと柔軟性の両立\ngRPCのようなProtocol Buffers不要 RESTよりも明確なメソッド呼び出し 様々なトランスポート層で利用可能（HTTP、WebSocket、TCP等） 2. 非同期通信への適性\nWebSocketとの相性が良い IDによる明確なリクエスト-レスポンス対応 3. 通知（Notification）のサポート\nIDを省略することで、レスポンス不要な一方向通信も可能 1 2 3 4 5 6 // 通知の例（IDなし） { \u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;notify_update\u0026#34;, \u0026#34;params\u0026#34;: {\u0026#34;status\u0026#34;: \u0026#34;completed\u0026#34;} } 実装時の注意点とベストプラクティス JSON-RPC 2.0を実装する際の注意点をまとめます。\nサーバー側の実装 1. リクエストのIDを可能な限り保存する\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Node.jsでの実装例 function handleRequest(requestText) { let requestId = null; let request; try { request = JSON.parse(requestText); // パース成功時点でIDを取得 requestId = request.id !== undefined ? request.id : null; } catch (e) { // Parse Error return createErrorResponse(-32700, \u0026#34;Parse error\u0026#34;, null); } // バリデーション if (!request.jsonrpc || request.jsonrpc !== \u0026#34;2.0\u0026#34;) { // IDが取得できていればそれを使う return createErrorResponse(-32600, \u0026#34;Invalid Request\u0026#34;, requestId); } // 以降の処理でもrequestIdを保持し続ける // ... } 2. エラーコードの標準を守る\nJSON-RPC 2.0で定義されている標準エラーコード：\n-32700: Parse error（JSONパース失敗） -32600: Invalid Request（不正なJSON-RPCリクエスト） -32601: Method not found（メソッドが存在しない） -32602: Invalid params（パラメータが不正） -32603: Internal error（サーバー内部エラー） -32000〜-32099: サーバー定義エラー（独自エラー用） 3. バッチリクエストへの適切な対応\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function handleBatchRequest(requests) { const responses = []; for (const request of requests) { // 通知（IDなし）の場合はレスポンス不要 if (request.id === undefined) { processNotification(request); continue; } // 通常のリクエストはレスポンスを生成 const response = processRequest(request); responses.push(response); } // レスポンスが0個の場合（全て通知）は何も返さない return responses.length \u0026gt; 0 ? responses : null; } クライアント側の実装 1. ユニークなIDの生成\n1 2 3 4 5 6 7 8 9 10 11 // シンプルなカウンター let requestId = 0; function generateId() { return ++requestId; } // またはUUID import { v4 as uuidv4 } from \u0026#39;uuid\u0026#39;; function generateId() { return uuidv4(); } 2. 非同期リクエストの管理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 class JsonRpcClient { constructor(url) { this.url = url; this.pendingRequests = new Map(); } async call(method, params) { const id = generateId(); return new Promise((resolve, reject) =\u0026gt; { this.pendingRequests.set(id, { resolve, reject }); const request = { jsonrpc: \u0026#34;2.0\u0026#34;, method: method, params: params, id: id }; this.send(JSON.stringify(request)); }); } handleResponse(responseText) { const response = JSON.parse(responseText); const pending = this.pendingRequests.get(response.id); if (!pending) { console.warn(`Unexpected response with id: ${response.id}`); return; } this.pendingRequests.delete(response.id); if (response.error) { pending.reject(new Error(response.error.message)); } else { pending.resolve(response.result); } } } 3. エラーIDがnullの場合の扱い\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 handleResponse(responseText) { const response = JSON.parse(responseText); // IDがnullの場合は、特定のリクエストと対応付けできない if (response.id === null \u0026amp;\u0026amp; response.error) { // Parse ErrorやInvalid Requestなど // 全体的なエラーとして扱う console.error(\u0026#34;JSON-RPC protocol error:\u0026#34;, response.error); // 必要に応じて全てのpendingリクエストを拒否するなど return; } // 通常のID付きレスポンス処理 // ... } テストのポイント 1. ID保持のテスト\n1 2 3 4 5 6 7 8 // テストケース例 test(\u0026#39;should preserve request ID in error response\u0026#39;, async () =\u0026gt; { const response = await client.call(\u0026#39;nonexistent_method\u0026#39;, [], { id: 42 }); expect(response.error).toBeDefined(); expect(response.error.code).toBe(-32601); expect(response.id).toBe(42); // IDが保持されていること }); 2. Parse Error時のnullテスト\n1 2 3 4 5 6 7 8 test(\u0026#39;should return null ID on parse error\u0026#39;, async () =\u0026gt; { const invalidJson = \u0026#39;{invalid json}\u0026#39;; const response = await sendRawRequest(invalidJson); expect(response.error).toBeDefined(); expect(response.error.code).toBe(-32700); expect(response.id).toBeNull(); // IDがnullであること }); まとめ IDを可能な限り保持する設計の意義 JSON-RPC 2.0の「エラーレスポンスでもIDを可能な限り保持する」という仕様は、以下の利点をもたらします。\n非同期通信での確実な対応付け - 複数の並列リクエストでも、どのレスポンスがどのリクエストに対応するか明確 トレーサビリティの向上 - ログやモニタリングでリクエスト-レスポンスペアを追跡しやすい バッチ処理の明確化 - 複数リクエストの処理結果を正確に識別できる デバッグの容易さ - エラー発生時でも、どのリクエストが失敗したのかすぐわかる この設計思想は、非常に好感が持てるものです。\n8年の誤解から学んだこと 私は8年もの間、この仕様を誤解したまま実装を公開していました。幸い、JSON::RPC::Specのバッチ処理機能を実際に使うことはありませんでしたが、もし本番環境で使われていたら、デバッグやトレースに大きな支障をきたしていたかもしれません。\n今回の経験から学んだことは：\n仕様書は丁寧に読む - MUSTとSHOULDの違い、条件節の適用範囲を正確に理解する 違和感は大切に - 実装時に感じた「なぜ？」という疑問は、立ち止まって考える価値がある 定期的な見直し - たとえ公開済みのコードでも、機会があれば仕様を再確認する これからJSON-RPCを使う方へ JSON-RPC 2.0は、シンプルでありながら非同期通信やバッチ処理を想定した堅牢な仕様です。特にWebSocketを使ったリアルタイム通信や、マイクロサービス間のRPCには適しています。\n実装する際は、今回解説した「IDを可能な限り保持する」という基本原則を理解した上で、以下の公式仕様を参照してください。\nhttps://www.jsonrpc.org/specification www.jsonrpc.org そして、私と同じような誤解をしないよう、特にエラーハンドリング部分は注意深く実装してください。\n追記: JSON::RPC::Specの修正版は、CPANで公開されています。8年ぶりの更新となりましたが、より仕様に忠実な実装になりました。Perlを使っている方は、ぜひ活用してください。\nJSON::RPC::Spec Yet another JSON-RPC 2.0 Implementation MetaCPAN ","date":"2025-12-12T00:54:57+09:00","image":"https://www.nqou.net/public_images/2025/1765468497-image.jpg","permalink":"https://www.nqou.net/2025/12/12/005457/","title":"JSON-RPC 2.0エラーオブジェクトにおけるID必須仕様 - 8年越しの誤解と正しい理解"},{"content":"Time::Moment - 高速で正確な日時処理 Perlで日時を扱う際、長年 DateTime モジュールが定番として使われてきました。しかし、パフォーマンスが重要な場面では Time::Moment という選択肢があります。Time::Moment は C 言語で実装されており、DateTime よりも圧倒的に高速で、メモリ使用量も少ないという特徴があります。\nTime::Momentの特徴 Time::Moment の主な特徴は以下の通りです：\n高速: C言語で実装され、DateTime の数十倍から数百倍の速度 イミュータブル: すべての操作で新しいオブジェクトを返すため、予期しない副作用がない 正確: マイクロ秒精度の時刻を扱える 軽量: メモリ使用量が少ない 完全なタイムゾーンサポート: Olson タイムゾーンデータベースに対応 インストール 1 cpanm Time::Moment 基本的な使い方 Time::Momentオブジェクトの作成 Time::Moment オブジェクトを作成する方法はいくつかあります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use Time::Moment; # 現在時刻（UTC） my $now = Time::Moment-\u0026gt;now_utc; print $now, \u0026#34;\\n\u0026#34;; # 2025-12-12T10:30:00Z # 現在時刻（ローカルタイムゾーン） my $local_now = Time::Moment-\u0026gt;now; # 特定の日時を指定 my $moment = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, hour =\u0026gt; 15, minute =\u0026gt; 30, second =\u0026gt; 45, ); # エポック秒から作成 my $from_epoch = Time::Moment-\u0026gt;from_epoch(1702383045); # ISO 8601 形式の文字列から作成 my $from_string = Time::Moment-\u0026gt;from_string(\u0026#39;2025-12-12T15:30:45Z\u0026#39;); 日時の操作 Time::Moment はイミュータブルなので、すべての操作は新しいオブジェクトを返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Time::Moment; my $moment = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, ); # 日数を加算 my $next_week = $moment-\u0026gt;plus_days(7); print $next_week-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-19T00:00:00Z # 時間を加算 my $later = $moment-\u0026gt;plus_hours(3)-\u0026gt;plus_minutes(30); print $later-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-12T03:30:00Z # 減算も可能 my $yesterday = $moment-\u0026gt;minus_days(1); print $yesterday-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-11T00:00:00Z # 月の操作（月末を考慮） my $next_month = $moment-\u0026gt;plus_months(1); print $next_month-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-01-12T00:00:00Z # with_* メソッドで特定のフィールドを変更 my $new_year = $moment-\u0026gt;with_year(2025); my $noon = $moment-\u0026gt;with_hour(12)-\u0026gt;with_minute(0); フォーマット出力 Time::Moment は柔軟なフォーマット出力をサポートしています：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Time::Moment; my $moment = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, hour =\u0026gt; 15, minute =\u0026gt; 30, second =\u0026gt; 45, ); # ISO 8601 形式（デフォルト） print $moment-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-12T15:30:45Z # strftime 形式 print $moment-\u0026gt;strftime(\u0026#39;%Y年%m月%d日 %H:%M:%S\u0026#39;), \u0026#34;\\n\u0026#34;; # 2025年12月12日 15:30:45 # 各種コンポーネントの取得 printf \u0026#34;年: %d, 月: %d, 日: %d\\n\u0026#34;, $moment-\u0026gt;year, $moment-\u0026gt;month, $moment-\u0026gt;day; # 年: 2025, 月: 12, 日: 12 # 曜日（1=月曜日, 7=日曜日） print \u0026#34;曜日: \u0026#34;, $moment-\u0026gt;day_of_week, \u0026#34;\\n\u0026#34;; # 4 (木曜日) # 年間通算日 print \u0026#34;年間通算日: \u0026#34;, $moment-\u0026gt;day_of_year, \u0026#34;\\n\u0026#34;; # 347 # エポック秒 print \u0026#34;エポック秒: \u0026#34;, $moment-\u0026gt;epoch, \u0026#34;\\n\u0026#34;; タイムゾーン処理 Time::Moment はタイムゾーンの変換を簡単に行えます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use Time::Moment; # UTC で作成 my $utc = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, hour =\u0026gt; 10, # UTC 10:00 ); # 日本時間（JST: UTC+9）に変換 my $jst = $utc-\u0026gt;with_offset_same_instant(9 * 60); # オフセットは分単位 print $jst-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-12T19:00:00+09:00 # 逆にJSTからUTCへ my $back_to_utc = $jst-\u0026gt;with_offset_same_instant(0); print $back_to_utc-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-12T10:00:00Z # オフセット情報を保持したまま時刻のみ変更 my $same_local = $jst-\u0026gt;with_offset_same_local(0); print $same_local-\u0026gt;to_string, \u0026#34;\\n\u0026#34;; # 2025-12-12T19:00:00Z (19:00のまま) DateTime との比較 DateTime と Time::Moment の主な違いを見てみましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 use Benchmark qw(cmpthese); use DateTime; use Time::Moment; print \u0026#34;=== パフォーマンス比較 ===\\n\\n\u0026#34;; # オブジェクト作成の比較 cmpthese(100000, { \u0026#39;DateTime\u0026#39; =\u0026gt; sub { DateTime-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, ); }, \u0026#39;Time::Moment\u0026#39; =\u0026gt; sub { Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, ); }, }); # 日付操作の比較 my $dt = DateTime-\u0026gt;new(year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12); my $tm = Time::Moment-\u0026gt;new(year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12); cmpthese(100000, { \u0026#39;DateTime add\u0026#39; =\u0026gt; sub { $dt-\u0026gt;clone-\u0026gt;add(days =\u0026gt; 7); }, \u0026#39;Time::Moment add\u0026#39; =\u0026gt; sub { $tm-\u0026gt;plus_days(7); }, }); 主な違い：\n項目 DateTime Time::Moment 速度 遅い 非常に高速 メモリ 多い 少ない イミュータブル いいえ はい タイムゾーン DateTime::TimeZone オフセットベース 精度 マイクロ秒 マイクロ秒 拡張性 高い 限定的 実用例 ログファイルの解析と集計 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use Time::Moment; use feature qw(say); # ログファイルから時刻を抽出して集計 my @log_lines = ( \u0026#39;2025-12-12T10:15:30Z INFO: User login\u0026#39;, \u0026#39;2025-12-12T10:16:45Z ERROR: Connection failed\u0026#39;, \u0026#39;2025-12-12T10:17:20Z INFO: User logout\u0026#39;, \u0026#39;2025-12-12T11:30:15Z INFO: User login\u0026#39;, ); my %hourly_count; for my $line (@log_lines) { if ($line =~ /^(\\S+)/) { my $timestamp = $1; my $moment = Time::Moment-\u0026gt;from_string($timestamp); # 時間単位で集計 my $hour_key = $moment-\u0026gt;strftime(\u0026#39;%Y-%m-%d %H:00\u0026#39;); $hourly_count{$hour_key}++; } } say \u0026#34;=== 時間別ログ件数 ===\u0026#34;; for my $hour (sort keys %hourly_count) { say \u0026#34;$hour: $hourly_count{$hour}件\u0026#34;; } 営業日計算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use Time::Moment; use feature qw(say); sub add_business_days { my ($start_moment, $days) = @_; my $current = $start_moment; my $added = 0; while ($added \u0026lt; $days) { $current = $current-\u0026gt;plus_days(1); # 土曜日(6)と日曜日(7)をスキップ my $dow = $current-\u0026gt;day_of_week; next if $dow == 6 || $dow == 7; $added++; } return $current; } my $today = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, # 木曜日 ); my $deadline = add_business_days($today, 5); say \u0026#34;5営業日後: \u0026#34;, $deadline-\u0026gt;strftime(\u0026#39;%Y-%m-%d (%a)\u0026#39;); # 2025-12-19 (Thu) 期間の計算と比較 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use Time::Moment; use feature qw(say); my $start = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 1, ); my $end = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 25, ); # 期間の計算（秒単位） my $duration_seconds = $end-\u0026gt;epoch - $start-\u0026gt;epoch; my $duration_days = int($duration_seconds / 86400); say \u0026#34;期間: $duration_days 日\u0026#34;; # 比較 if ($start \u0026lt; $end) { say \u0026#34;start は end より前です\u0026#34;; } # 2つの日時が同じかチェック my $same = Time::Moment-\u0026gt;new(year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 1); if ($start == $same) { say \u0026#34;同じ日時です\u0026#34;; } タイムゾーンを跨ぐ会議時刻の調整 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use Time::Moment; use feature qw(say); # 東京での会議時刻（JST: UTC+9） my $tokyo_meeting = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 12, hour =\u0026gt; 14, # 14:00 JST minute =\u0026gt; 0, offset =\u0026gt; 9 * 60, # JST は UTC+9 ); say \u0026#34;東京: \u0026#34;, $tokyo_meeting-\u0026gt;strftime(\u0026#39;%Y-%m-%d %H:%M %z\u0026#39;); # ニューヨーク（EST: UTC-5）での時刻 my $newyork = $tokyo_meeting-\u0026gt;with_offset_same_instant(-5 * 60); say \u0026#34;ニューヨーク: \u0026#34;, $newyork-\u0026gt;strftime(\u0026#39;%Y-%m-%d %H:%M %z\u0026#39;); # ロンドン（GMT: UTC+0）での時刻 my $london = $tokyo_meeting-\u0026gt;with_offset_same_instant(0); say \u0026#34;ロンドン: \u0026#34;, $london-\u0026gt;strftime(\u0026#39;%Y-%m-%d %H:%M %z\u0026#39;); # UTC での時刻 my $utc = $tokyo_meeting-\u0026gt;with_offset_same_instant(0); say \u0026#34;UTC: \u0026#34;, $utc-\u0026gt;strftime(\u0026#39;%Y-%m-%d %H:%M %z\u0026#39;); まとめ Time::Moment は以下のような場合に特に有効です：\n大量の日時データを処理する場合: ログ解析、データ集計など パフォーマンスが重要な場合: Web API、リアルタイム処理など イミュータブルなオブジェクトが必要な場合: 関数型プログラミング、マルチスレッド処理など 一方、DateTime の方が適している場合もあります：\n複雑なタイムゾーン処理が必要: 夏時間の自動処理など DateTime エコシステムのモジュールを使う: DateTime::Format::* など カレンダー計算が必要: DateTime::Event::* など 用途に応じて適切なモジュールを選択することで、効率的な日時処理を実現できます。Time::Moment の高速性とシンプルさは、多くの実用的なユースケースで強力な武器となるでしょう。\n","date":"2025-12-12T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251212-time-moment.jpg","permalink":"https://www.nqou.net/2025/12/12/000000/","title":"Time::Moment — 高速で正確な日時処理"},{"content":"CIとは何か コードを書いていると、「テストを実行し忘れた」「ローカルでは動いたのに本番で動かない」といった経験はありませんか？\nCI（継続的インテグレーション：Continuous Integration）は、こうした問題を防ぐための仕組みです。\n継続的インテグレーションの基本 CIとは、コードの変更を頻繁に統合（マージ）し、その都度自動でテストやビルドを実行する開発手法です。\n主な特徴は以下の通りです。\n自動化：コミットやプルリクエストをトリガーにテストが自動実行される 早期発見：問題を早い段階で検出できる 品質保証：常にテストが通る状態を維持する 開発者がコードをプッシュするだけで、バックグラウンドでテストが走る。これがCIの魅力です。\nなぜ自動テストが重要か 手動でテストを実行する場合、以下のような問題が起こりがちです。\n実行忘れ：急いでいると、つい忘れてしまう 環境差異：「僕の環境では動くんだけど…」が発生する 時間のロス：チーム全員が毎回手動実行するのは非効率 自動化することで、これらの問題を解決できます。\n1 2 # 手動実行（毎回これをタイプするのは面倒） docker compose run --rm app prove -lv t/ 自動化すれば、コードをプッシュするだけで、この作業が自動的に行われます。\nGitHub Actionsの役割 GitHub Actionsは、GitHubが提供するCI/CDサービスです。\n主な利点は以下の通りです。\nGitHubに統合：リポジトリと同じ場所で管理できる 無料枠が充実：パブリックリポジトリなら無料、プライベートでも月2,000分まで無料 豊富なエコシステム：様々な言語やツールに対応 YAMLで設定：分かりやすい設定ファイル 次のセクションから、実際にGitHub Actionsを設定していきましょう。\nGitHub Actionsの基本 GitHub Actionsは、ワークフローという単位で動作を定義します。\nワークフローファイルの配置 ワークフローは、リポジトリの特定の場所に配置します。\n1 2 3 4 # ワークフローファイルの配置場所 .github/ workflows/ test.yml # ← ここに配置 この.github/workflows/ディレクトリに、YAML形式の設定ファイルを置くだけで、GitHub Actionsが認識してくれます。\nトリガーの設定（push, pull_request） ワークフローは、様々なイベントで起動できます。よく使うのは以下の2つです。\n1 2 3 4 5 6 7 8 on: push: branches: - main - develop pull_request: branches: - main この設定では、以下のタイミングでワークフローが実行されます。\nmainまたはdevelopブランチへのプッシュ mainブランチへのプルリクエスト ジョブとステップの概念 ワークフローは、ジョブ（Job）とステップ（Step）で構成されます。\n1 2 3 4 5 6 7 8 9 jobs: test: # ジョブ名 runs-on: ubuntu-latest # 実行環境 steps: # 実行するステップ - name: Checkout code uses: actions/checkout@v4 - name: Run tests run: echo \u0026#34;テストを実行\u0026#34; ジョブ：独立した作業単位（例：テスト、ビルド、デプロイ） ステップ：ジョブ内の個別の処理（例：コードのチェックアウト、テスト実行） 複数のジョブを定義すると、並列実行されます。\nDockerを使ったテスト実行 前回までの連載で、Dockerを使ったローカル環境を構築しました。CI環境でも、同じDockerイメージを使えば、環境の一貫性が保たれます。\nマトリックス戦略（複数のPerlバージョン） GitHub Actionsのマトリックス戦略を使うと、複数のバージョンで同時にテストできます。\n1 2 3 4 5 6 7 8 9 jobs: test: runs-on: ubuntu-latest strategy: matrix: perl-version: - \u0026#39;5.36\u0026#39; - \u0026#39;5.38\u0026#39; - \u0026#39;5.40\u0026#39; この設定により、Perl 5.36、5.38、5.40の3つのバージョンで並列にテストが実行されます。\ncpanmで依存関係をインストール PerlのモジュールをCI環境でインストールするには、cpanm（cpanminus）を使うのが一般的です。\n1 2 3 - name: Install dependencies run: | cpanm --notest --installdeps . --notestオプションで、依存モジュール自体のテストはスキップし、インストールだけを高速に行います。\n--installdeps .で、カレントディレクトリのcpanfileやMakefile.PLから依存関係を読み取ってインストールします。\nprove コマンドでテスト実行 テストの実行には、これまでと同じproveコマンドを使います。\n1 2 - name: Run tests run: prove -lv t/ オプションの意味：\n-l：lib/ディレクトリをライブラリパスに追加 -v：詳細な出力（verbose） この1行で、t/ディレクトリ内のすべてのテストが実行されます。\n実践：ワークフローの作成 それでは、実際にワークフローファイルを作成してみましょう。\n.github/workflows/test.ymlの作成 以下の内容で.github/workflows/test.ymlを作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 name: Test on: push: branches: - main - develop pull_request: branches: - main jobs: test: runs-on: ubuntu-latest strategy: fail-fast: false matrix: perl-version: - \u0026#39;5.36\u0026#39; - \u0026#39;5.38\u0026#39; - \u0026#39;5.40\u0026#39; steps: - name: Checkout code uses: actions/checkout@v4 - name: Set up Perl uses: shogo82148/actions-setup-perl@v1 with: perl-version: ${{ matrix.perl-version }} - name: Install cpanm run: | curl -L https://cpanmin.us | perl - App::cpanminus - name: Install dependencies run: | cpanm --notest --installdeps . - name: Run tests run: | prove -lv t/ このワークフローの流れを見ていきましょう。\nCheckout code：リポジトリのコードを取得 Set up Perl：マトリックスで指定したPerlバージョンをセットアップ Install cpanm：cpanminusをインストール Install dependencies：cpanfileから依存モジュールをインストール Run tests：テストを実行 fail-fast: falseの設定により、1つのバージョンでテストが失敗しても、他のバージョンのテストは続行されます。\nブランチ戦略との連携 ブランチ戦略に合わせて、トリガーを調整できます。\n1 2 3 4 5 6 7 8 9 10 on: push: branches: - main # 本番 - develop # 開発 - \u0026#39;feature/*\u0026#39; # フィーチャーブランチ pull_request: branches: - main - develop この設定なら、フィーチャーブランチへのプッシュでもテストが走ります。\nプルリクエストでのテスト確認 プルリクエストを作成すると、自動的にワークフローが実行されます。\nGitHubのプルリクエスト画面で、以下のように表示されます。\n1 2 3 4 5 ✓ Test (5.36) — 1m 23s ✓ Test (5.38) — 1m 19s ✓ Test (5.40) — 1m 25s All checks have passed すべてのテストが通るまで、マージしないようにルールを設定することもできます。\nバッジの追加とステータス確認 テストの状態を視覚的に表示するために、バッジ（ステータスバッジ）を追加しましょう。\nREADME.mdにバッジを追加 README.mdの冒頭に、以下のようなバッジを追加します。\n1 2 3 4 5 # Moo TDD Tutorial ![Test](https://github.com/your-username/moo-tdd-tutorial/workflows/Test/badge.svg) Test2とMooを使ったTDD（テスト駆動開発）のチュートリアルです。 バッジのURL形式：\n1 https://github.com/{owner}/{repo}/workflows/{workflow-name}/badge.svg {owner}：GitHubのユーザー名または組織名 {repo}：リポジトリ名 {workflow-name}：ワークフローファイルのname:で指定した名前（今回はTest） テスト結果の確認方法 GitHubのリポジトリページで、テスト結果を確認できます。\nActionsタブ：すべてのワークフロー実行履歴 プルリクエストページ：そのPRに関連するチェック結果 コミットページ：各コミットのチェック結果 実行中のワークフローは、リアルタイムでログを確認できます。\n失敗時のデバッグ テストが失敗した場合、以下の手順でデバッグします。\n1 2 3 4 # デバッグ用の詳細ログを有効化 - name: Run tests with verbose output run: | prove -lvr t/ -rオプションで、サブディレクトリも再帰的にテストします。\n失敗したテストのログを確認し、以下をチェックします。\n依存関係：必要なモジュールがインストールされているか 環境変数：CI環境特有の設定が必要か ファイルパス：相対パスの問題がないか GitHub Actionsのログには、ステップごとに折りたたみ可能なセクションがあり、エラー箇所が見つけやすくなっています。\nまとめと次回予告 自動テストでチーム開発が楽になる 今回は、GitHub Actionsを使ったCI環境を構築しました。\n設定したこと：\nワークフローファイルの作成（.github/workflows/test.yml） 複数のPerlバージョンでの並列テスト（マトリックス戦略） プッシュとプルリクエストでの自動実行 ステータスバッジの追加 得られた効果：\nコードをプッシュするだけで、自動的にテストが実行される 複数のPerlバージョンでの互換性を確認できる チーム全員が、テストの状態を一目で把握できる CIを導入することで、「テストを忘れた」「環境で動かない」という問題から解放されます。\nTDDとCIの相乗効果 TDD（テスト駆動開発）とCI（継続的インテグレーション）を組み合わせると、以下の好循環が生まれます。\nTDDでテストを書く → 常にテストが存在する CIで自動実行 → テストの実行漏れがなくなる 早期にバグ発見 → 修正コストが低い 安心してリファクタリング → コード品質が向上 この流れが、チーム全体の開発速度と品質を高めます。\n次回予告 次回は「MooによるTDD講座 #5 - 実践的なTDDテクニックとベストプラクティス」として、以下の内容を扱います。\n実践的なTDDのワークフロー 効果的なテスト設計のポイント リファクタリングとテストの連携 チームでTDDを推進するコツ TDDをより深く理解し、現場で活用できるテクニックを紹介します。お楽しみに！\n","date":"2025-12-11T21:47:54+09:00","image":"https://www.nqou.net/public_images/2025/1765457274-image.jpg","permalink":"https://www.nqou.net/2025/12/11/214754/","title":"MooによるTDD講座 #4 - GitHub ActionsでCI環境を構築"},{"content":"モダンなPerl OOPへようこそ @nqounetです。\nPerl Advent Calendar 2025 の11日目は、MooとMooseを使ったモダンなオブジェクト指向プログラミングについて解説します。\nPerlのオブジェクト指向プログラミング（OOP）というと、blessを使った伝統的な手法を思い浮かべる方も多いでしょう。しかし、現代のPerlには、より宣言的で保守性の高いOOPを実現するMooとMooseという強力なツールがあります。\n伝統的なPerl OOPの問題点 まず、伝統的なblessベースのOOPを見てみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package User; use strict; use warnings; sub new { my ($class, %args) = @_; my $self = { name =\u0026gt; $args{name} || die \u0026#34;name is required\u0026#34;, email =\u0026gt; $args{email} || die \u0026#34;email is required\u0026#34;, age =\u0026gt; $args{age}, }; bless $self, $class; return $self; } sub name { $_[0]-\u0026gt;{name} } sub email { $_[0]-\u0026gt;{email} } sub age { $_[0]-\u0026gt;{age} } sub set_age { my ($self, $age) = @_; die \u0026#34;age must be positive\u0026#34; unless $age \u0026gt; 0; $self-\u0026gt;{age} = $age; } 1; このコードには、いくつかの問題があります：\nボイラープレートが多い: コンストラクタやアクセサを毎回書く必要がある 型チェックが不十分: 手動でバリデーションを書く必要がある デフォルト値の管理: 初期化ロジックが散在しやすい 継承の扱いづらさ: 親クラスの初期化を忘れやすい 可読性: クラスの構造が一目でわからない Mooの登場 - 軽量でモダンなOOP Mooは、Mooseの軽量版として登場したモジュールです。Mooseの主要な機能を保ちつつ、依存関係を最小限に抑え、起動時間を短縮しています。\n基本的なクラス定義 先ほどのUserクラスをMooで書き直してみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package User; use Moo; use Types::Standard qw(Str Int); has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has email =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has age =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Int, predicate =\u0026gt; \u0026#39;has_age\u0026#39;, ); 1; たったこれだけで、同等の機能が実現できます！\nMooの主要機能 属性定義（has） hasキーワードで属性を宣言します。主なオプション：\nis: アクセサのタイプ ro (read-only): 読み取り専用 rw (read-write): 読み書き可能 lazy: 遅延初期化 isa: 型制約 required: 必須属性 default: デフォルト値 builder: ビルダーメソッド名 predicate: 値が設定されているかチェックするメソッド名 clearer: 値をクリアするメソッド名 coerce: 型強制 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package Config; use Moo; use Types::Standard qw(Str Int Bool HashRef); use Types::Path::Tiny qw(Path); has config_file =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Path, coerce =\u0026gt; 1, required =\u0026gt; 1, ); has debug =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Bool, default =\u0026gt; 0, ); has max_retries =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Int, default =\u0026gt; 3, ); has settings =\u0026gt; ( is =\u0026gt; \u0026#39;lazy\u0026#39;, isa =\u0026gt; HashRef, builder =\u0026gt; \u0026#39;_build_settings\u0026#39;, ); sub _build_settings { my $self = shift; # 設定ファイルを読み込む処理 return {}; } 1; 継承（extends） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package Employee; use Moo; extends \u0026#39;User\u0026#39;; has employee_id =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has department =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Str, ); 1; ロール（with） ロール（Role）は、複数のクラスで共通する機能をまとめる仕組みです。多重継承の問題を避けつつ、コードの再利用を実現できます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package Role::Timestamped; use Moo::Role; use Types::Standard qw(InstanceOf); has created_at =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; InstanceOf[\u0026#39;DateTime\u0026#39;], default =\u0026gt; sub { DateTime-\u0026gt;now }, ); has updated_at =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; InstanceOf[\u0026#39;DateTime\u0026#39;], ); sub touch { my $self = shift; $self-\u0026gt;updated_at(DateTime-\u0026gt;now); } 1; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package Article; use Moo; with \u0026#39;Role::Timestamped\u0026#39;; has title =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has body =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Str, ); 1; 型制約（Types::Standard） Mooでは、Types::Standardモジュールを使って強力な型チェックを行えます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 package Product; use Moo; use Types::Standard qw(Str Num Int ArrayRef HashRef Maybe); has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has price =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Num, ); has quantity =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Int, default =\u0026gt; 0, ); has tags =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; ArrayRef[Str], default =\u0026gt; sub { [] }, ); has metadata =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; HashRef, default =\u0026gt; sub { {} }, ); has discount_rate =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Maybe[Num], # NumまたはundefinedOK ); 1; カスタム型も定義できます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 use Type::Library -base; use Type::Utils -all; use Types::Standard qw(Str); declare \u0026#34;Email\u0026#34;, as Str, where { $_ =~ /^[^@]+@[^@]+\\.[^@]+$/ }, message { \u0026#34;Invalid email format: $_\u0026#34; }; declare \u0026#34;PositiveInt\u0026#34;, as Int, where { $_ \u0026gt; 0 }, message { \u0026#34;Must be a positive integer\u0026#34; }; メソッド修飾子（Method Modifiers） Mooでは、メソッドの実行前後に処理を挟み込むメソッド修飾子が使えます。\nbefore - メソッド実行前 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package BankAccount; use Moo; has balance =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, default =\u0026gt; 0, ); has transaction_log =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, default =\u0026gt; sub { [] }, ); before withdraw =\u0026gt; sub { my ($self, $amount) = @_; push @{$self-\u0026gt;transaction_log}, { action =\u0026gt; \u0026#39;withdraw\u0026#39;, amount =\u0026gt; $amount, time =\u0026gt; time, }; }; sub withdraw { my ($self, $amount) = @_; die \u0026#34;Insufficient balance\u0026#34; if $self-\u0026gt;balance \u0026lt; $amount; $self-\u0026gt;balance($self-\u0026gt;balance - $amount); } 1; after - メソッド実行後 1 2 3 4 5 6 after withdraw =\u0026gt; sub { my ($self, $amount) = @_; if ($self-\u0026gt;balance \u0026lt; 1000) { warn \u0026#34;Warning: Low balance\u0026#34;; } }; around - メソッドを完全にラップ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 around withdraw =\u0026gt; sub { my ($orig, $self, $amount) = @_; # 引数のバリデーション die \u0026#34;Amount must be positive\u0026#34; unless $amount \u0026gt; 0; # 元のメソッドを実行 my $result = $self-\u0026gt;$orig($amount); # 後処理 $self-\u0026gt;notify_withdrawal($amount); return $result; }; MooとMooseの違い Mooの利点 軽量: 依存モジュールが少ない 高速起動: Mooseより起動が速い メモリ効率: 使用メモリが少ない Pure Perl: XSに依存しない（オプションでXS版も使用可） Mooseの利点 高度な機能: より豊富なメタプログラミング機能 強力な型システム: より複雑な型制約 MooseXエコシステム: 多数の拡張モジュール イントロスペクション: 実行時のクラス情報取得 使い分けの指針 1 2 3 4 5 6 7 8 9 10 11 # Mooを選ぶケース # - Webアプリケーション（起動速度重視） # - コマンドラインツール # - 軽量なライブラリ # - シンプルなクラス設計 # Mooseを選ぶケース # - 大規模アプリケーション # - 複雑なドメインモデル # - メタプログラミングが必要 # - MooseX::*モジュールが必要 MooからMooseへの移行 Mooの良い点は、必要に応じてMooseに移行できることです：\n1 2 3 4 5 6 7 8 9 package MyClass; use Moo; # この1行を追加するだけでMooseに移行 use namespace::autoclean; # 実行時にMooseが必要になった時だけ自動変換 require Moose; Moo::Role-\u0026gt;_install_tracked(\u0026#39;MyClass\u0026#39;); 実践例：ユーザー管理システム 実際のアプリケーションでの使用例を見てみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 package UserManager; use Moo; use Types::Standard qw(ArrayRef HashRef InstanceOf); has users =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; HashRef[InstanceOf[\u0026#39;User\u0026#39;]], default =\u0026gt; sub { {} }, ); has search_index =\u0026gt; ( is =\u0026gt; \u0026#39;lazy\u0026#39;, isa =\u0026gt; ArrayRef, clearer =\u0026gt; \u0026#39;clear_search_index\u0026#39;, ); sub add_user { my ($self, $user) = @_; $self-\u0026gt;users-\u0026gt;{$user-\u0026gt;email} = $user; $self-\u0026gt;clear_search_index; # 検索インデックスを再構築 return $user; } sub find_by_email { my ($self, $email) = @_; return $self-\u0026gt;users-\u0026gt;{$email}; } sub find_by_name { my ($self, $name) = @_; return grep { $_-\u0026gt;name eq $name } values %{$self-\u0026gt;users}; } sub _build_search_index { my $self = shift; return [ sort { $a-\u0026gt;name cmp $b-\u0026gt;name } values %{$self-\u0026gt;users} ]; } 1; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package User; use Moo; use Types::Standard qw(Str Int Enum); with \u0026#39;Role::Timestamped\u0026#39;; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has email =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, required =\u0026gt; 1, ); has age =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Int, predicate =\u0026gt; \u0026#39;has_age\u0026#39;, ); has status =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Enum[qw(active inactive suspended)], default =\u0026gt; \u0026#39;active\u0026#39;, ); sub is_active { my $self = shift; return $self-\u0026gt;status eq \u0026#39;active\u0026#39;; } sub deactivate { my $self = shift; $self-\u0026gt;status(\u0026#39;inactive\u0026#39;); $self-\u0026gt;touch; } 1; 使用例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use User; use UserManager; my $manager = UserManager-\u0026gt;new; my $user = User-\u0026gt;new( name =\u0026gt; \u0026#39;Taro Yamada\u0026#39;, email =\u0026gt; \u0026#39;taro@example.com\u0026#39;, age =\u0026gt; 30, ); $manager-\u0026gt;add_user($user); my $found = $manager-\u0026gt;find_by_email(\u0026#39;taro@example.com\u0026#39;); print $found-\u0026gt;name; # =\u0026gt; Taro Yamada $found-\u0026gt;deactivate; print $found-\u0026gt;status; # =\u0026gt; inactive パフォーマンス比較 Moo、Moose、そして素のPerlでのパフォーマンスを比較してみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #!/usr/bin/env perl use strict; use warnings; use Benchmark qw(:all); # 素のPerl { package PlainUser; sub new { my ($class, %args) = @_; bless \\%args, $class; } sub name { $_[0]{name} } } # Moo { package MooUser; use Moo; has name =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;); } # Moose { package MooseUser; use Moose; has name =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;); __PACKAGE__-\u0026gt;meta-\u0026gt;make_immutable; } # ベンチマーク cmpthese(100000, { \u0026#39;Plain\u0026#39; =\u0026gt; sub { my $u = PlainUser-\u0026gt;new(name =\u0026gt; \u0026#39;test\u0026#39;); $u-\u0026gt;name; }, \u0026#39;Moo\u0026#39; =\u0026gt; sub { my $u = MooUser-\u0026gt;new(name =\u0026gt; \u0026#39;test\u0026#39;); $u-\u0026gt;name; }, \u0026#39;Moose\u0026#39; =\u0026gt; sub { my $u = MooseUser-\u0026gt;new(name =\u0026gt; \u0026#39;test\u0026#39;); $u-\u0026gt;name; }, }); 典型的な結果（環境により異なります）：\n1 2 3 4 Rate Moose Moo Plain Moose 50000/s -- -33% -50% Moo 75000/s 50% -- -25% Plain 100000/s 100% 33% -- 注意: make_immutableを使うとMooseは大幅に高速化されます。また、実際のアプリケーションでは、オブジェクト生成は全体の一部に過ぎないため、この差が問題になることは稀です。\nベストプラクティス 1. イミュータブルを優先する 可能な限りis =\u0026gt; 'ro'を使い、不変オブジェクトを作りましょう。\n1 2 3 4 has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, # read-only required =\u0026gt; 1, ); 2. 型制約を活用する 1 2 3 4 5 6 use Types::Standard qw(Str Int); has age =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; Int, ); 3. ビルダーを使う デフォルト値が複雑な場合はビルダーメソッドを使いましょう。\n1 2 3 4 5 6 7 8 9 has config =\u0026gt; ( is =\u0026gt; \u0026#39;lazy\u0026#39;, builder =\u0026gt; \u0026#39;_build_config\u0026#39;, ); sub _build_config { my $self = shift; # 複雑な初期化処理 } 4. ロールで機能を分割する 1 2 3 4 5 6 7 8 9 10 11 # 良い例 package User; use Moo; with \u0026#39;Role::Timestamped\u0026#39;; with \u0026#39;Role::Validatable\u0026#39;; # 避けるべき package User; use Moo; extends \u0026#39;BaseModel\u0026#39;; # 多重継承は避ける extends \u0026#39;Timestamped\u0026#39;; 5. Predicateとclearerを活用する 1 2 3 4 5 6 7 8 9 10 11 has cache =\u0026gt; ( is =\u0026gt; \u0026#39;lazy\u0026#39;, predicate =\u0026gt; \u0026#39;has_cache\u0026#39;, clearer =\u0026gt; \u0026#39;clear_cache\u0026#39;, ); if ($self-\u0026gt;has_cache) { return $self-\u0026gt;cache; } $self-\u0026gt;clear_cache; # キャッシュをクリア 6. コアションは慎重に使う 1 2 3 4 5 6 7 use Types::Standard qw(Str Int); has port =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Int, coerce =\u0026gt; 1, # 文字列を数値に変換 ); まとめ Moo/Mooseを使うことで、Perlでもモダンで保守性の高いオブジェクト指向プログラミングが可能になります。\nMooの主な利点 宣言的なクラス定義 強力な型システム 再利用可能なロール メソッド修飾子 高いパフォーマンス 選択の指針 小〜中規模: Mooがおすすめ（軽量で十分な機能） 大規模: Mooseも検討（高度な機能が必要な場合） レガシーコード: 段階的にMooに移行可能 次のステップ Moo - CPAN Moose - CPAN Types::Standard - CPAN Moo::Role - CPAN 明日のPerl Advent Calendar 2025もお楽しみに！\n","date":"2025-12-11T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251211-moose.jpg","permalink":"https://www.nqou.net/2025/12/11/000000/","title":"Moo/Moose - モダンなPerlオブジェクト指向プログラミング"},{"content":"はじめに 前回までの講座で、TDDの基本サイクル「レッド→グリーン→リファクタリング」を体験し、Test2の便利な機能を使ってメソッドのテストを書けるようになりました。\n今回は、TDDの真価である「テストに守られたリファクタリング」を実践します。複数のクラスで共通する振る舞いをMooのロール機能で整理し、保守性の高いコードへと進化させていきましょう。\nリファクタリングとは リファクタリングの定義 リファクタリングとは、外部から見た動作を変えずに、内部のコード構造を改善することです。つまり、「何をするか」は変えず、「どう実現するか」を洗練させる作業です。\n重要なのは、リファクタリングは「機能追加」ではないということ。新しい機能を加えるのではなく、既存のコードをより良い形に整えるのが目的です。\nテストがある安心感 リファクタリングで最も怖いのは「既存の動作を壊してしまうこと」です。しかし、テストがあれば話は別です。\n1 2 3 4 5 6 7 # リファクタリング前にテストを実行 docker compose run --rm app prove -lr t/ # コードを変更 # すぐにテストを実行して確認 docker compose run --rm app prove -lr t/ テストが全て通っていれば、外部から見た動作は変わっていないことが保証されます。これこそが、TDDの最大の価値です。\nいつリファクタリングするか リファクタリングのタイミングは「テストが全て通っている時」です。テストが失敗している状態では、リファクタリングと機能追加が混ざってしまい、どこで問題が起きたか分からなくなります。\nまた、「同じようなコードを3回書いたら」というDRY原則（Don\u0026rsquo;t Repeat Yourself）の目安も覚えておくと良いでしょう。\n実践：重複コードの整理 複数のクラスで共通する振る舞い 前回までで、Personクラスにgreetメソッドとgreet_toメソッドを実装しました。今回は、新しくRobotクラスを追加して、コードの重複を体験してみましょう。\nまず、Robotクラスを作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # lib/Robot.pm package Robot; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); sub greet { my $self = shift; return \u0026#34;Hello, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; 現在のPersonクラスは以下のようになっています：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # lib/Person.pm package Person; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); sub greet { my $self = shift; return \u0026#34;Hello, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } sub greet_to { my ($self, $target) = @_; return \u0026#34;Hello $target, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; PersonとRobotは、全く同じgreetメソッドを持っています。これは明らかなコードの重複です。\nコピペコードの問題点 コピペコードには、以下のような問題があります。\n保守性の低下：挨拶のフォーマットを変更したい時、全てのクラスを修正する必要がある バグの温床：片方だけ修正を忘れる、といったミスが起きやすい テストの重複：同じ振る舞いのテストを何度も書くことになる ロールによる解決 Mooのロール（Role）機能を使えば、この重複を解消できます。ロールは「クラスに混ぜ込める振る舞いのセット」のようなものです。\nMooのロール機能 Role::Tinyの基本 Mooでロールを定義するには、Role::Tinyを使います。まず、挨拶機能を持つロールを作りましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 # lib/Role/Greetable.pm package Role::Greetable; use Role::Tiny; use strictures 2; requires \u0026#39;name\u0026#39;; # このロールを使うクラスは name を持つ必要がある sub greet { my $self = shift; return \u0026#34;Hello, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; requires 'name'は、このロールを使うクラスがnameメソッドを持っていることを要求します。これにより、greetメソッド内で安全に$self-\u0026gt;nameを呼び出せます。\nwithでロールを適用 ロールをクラスに適用するには、withキーワードを使います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # lib/Person.pm package Person; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); with \u0026#39;Role::Greetable\u0026#39;; sub greet_to { my ($self, $target) = @_; return \u0026#34;Hello $target, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; 1 2 3 4 5 6 7 8 9 10 11 12 13 # lib/Robot.pm package Robot; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); with \u0026#39;Role::Greetable\u0026#39;; 1; これで、PersonとRobotの両方がgreetメソッドを持つようになりました。しかも、実装は1箇所だけです！\nロールのテストの書き方 ロール自体もテストできます。ただし、ロールは単独でインスタンス化できないので、ダミーのクラスを作ってテストします。\nまず、ロールのテストを先に書きましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # t/03-greetable-role.t use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Role::Greetable\u0026#39;; # テスト用のダミークラスを定義 { package TestClass; use Moo; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); with \u0026#39;Role::Greetable\u0026#39;; } subtest \u0026#39;Greetable role functionality\u0026#39; =\u0026gt; sub { my $obj = TestClass-\u0026gt;new(name =\u0026gt; \u0026#39;Test User\u0026#39;); ok $obj-\u0026gt;can(\u0026#39;greet\u0026#39;), \u0026#39;greet method exists\u0026#39;; is $obj-\u0026gt;greet, \u0026#34;Hello, I am Test User!\u0026#34;, \u0026#39;greet returns correct message\u0026#39;; }; done_testing; テストに守られたリファクタリング テストを全て通した状態で開始 リファクタリングを始める前に、必ず全てのテストが通っていることを確認します。\n1 docker compose run --rm app prove -lr t/ 全てのテストがパスしていることを確認したら、リファクタリング開始です。\n一つずつ変更してテスト実行 リファクタリングは小さなステップで進めます。例えば：\nRole::Greetableを作成 テスト実行（新しいテストを追加した場合） Personクラスでロールを使用 テスト実行 Robotクラスでロールを使用 テスト実行 各ステップでテストを実行することで、どこで問題が起きたか即座に分かります。\n1 2 # 変更後、すぐにテスト docker compose run --rm app prove -lr t/ テストが壊れたら即座に戻す もしテストが失敗したら、慌てずに前の状態に戻します。Gitを使っていれば簡単です。\n1 2 3 4 5 # 変更を取り消す git checkout -- lib/Person.pm # またはコミット前なら git restore lib/Person.pm 落ち着いて、何が問題だったかを確認してから、再度挑戦しましょう。\n実践：Greetableロールの作成 複数のクラスで挨拶機能を共有 より実践的な例として、挨拶のバリエーションを増やしてみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # lib/Role/Greetable.pm package Role::Greetable; use Role::Tiny; use strictures 2; requires \u0026#39;name\u0026#39;; sub greet { my $self = shift; return \u0026#34;Hello, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } sub greet_formal { my $self = shift; return \u0026#34;Good day. My name is \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } sub greet_casual { my $self = shift; return \u0026#34;Hi! I\u0026#39;m \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; このロールを使えば、PersonもRobotも、3種類の挨拶ができるようになります。\nロールのテスト まず、ロールの機能をテストするために、テストファイルを更新しましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # t/03-greetable-role.t use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Role::Greetable\u0026#39;; { package TestGreeter; use Moo; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); with \u0026#39;Role::Greetable\u0026#39;; } subtest \u0026#39;Greetable role all methods\u0026#39; =\u0026gt; sub { my $greeter = TestGreeter-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); is $greeter-\u0026gt;greet, \u0026#34;Hello, I am Alice!\u0026#34;, \u0026#39;greet returns standard greeting\u0026#39;; is $greeter-\u0026gt;greet_formal, \u0026#34;Good day. My name is Alice!\u0026#34;, \u0026#39;greet_formal returns formal greeting\u0026#39;; is $greeter-\u0026gt;greet_casual, \u0026#34;Hi! I\u0026#39;m Alice!\u0026#34;, \u0026#39;greet_casual returns casual greeting\u0026#39;; }; done_testing; ロールを使うクラスのテスト Personクラスには、ロールで追加されたメソッドと、独自のgreet_toメソッドのテストを追加します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # t/04-person-with-role.t use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; subtest \u0026#39;Person with Greetable role\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Bob\u0026#39;); ok $person-\u0026gt;can(\u0026#39;greet\u0026#39;), \u0026#39;has greet method\u0026#39;; ok $person-\u0026gt;can(\u0026#39;greet_formal\u0026#39;), \u0026#39;has greet_formal method\u0026#39;; ok $person-\u0026gt;can(\u0026#39;greet_casual\u0026#39;), \u0026#39;has greet_casual method\u0026#39;; ok $person-\u0026gt;can(\u0026#39;greet_to\u0026#39;), \u0026#39;has greet_to method\u0026#39;; is $person-\u0026gt;greet, \u0026#34;Hello, I am Bob!\u0026#34;, \u0026#39;Person can greet normally\u0026#39;; is $person-\u0026gt;greet_to(\u0026#39;Alice\u0026#39;), \u0026#34;Hello Alice, I am Bob!\u0026#34;, \u0026#39;Person can greet with target\u0026#39;; }; done_testing; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # t/05-robot.t use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Robot\u0026#39;; subtest \u0026#39;Robot with Greetable role\u0026#39; =\u0026gt; sub { my $robot = Robot-\u0026gt;new(name =\u0026gt; \u0026#39;R2D2\u0026#39;); is $robot-\u0026gt;greet_formal, \u0026#34;Good day. My name is R2D2!\u0026#34;, \u0026#39;Robot can greet formally\u0026#39;; is $robot-\u0026gt;greet_casual, \u0026#34;Hi! I\u0026#39;m R2D2!\u0026#34;, \u0026#39;Robot can greet casually\u0026#39;; }; done_testing; 全てのテストを実行して、グリーンであることを確認しましょう。\n1 docker compose run --rm app prove -lr t/ まとめと次回予告 リファクタリングは「機能追加」ではない 今回学んだ重要なポイントは、リファクタリングは新機能の追加ではなく、コードの整理だということです。\nコードの重複を排除する 読みやすさを向上させる 保守性を高める これらは全て、外部から見た動作を変えずに実現します。そして、テストがその安全性を保証してくれます。\nTDDの3つの柱 TDDの本質は、以下の3つのバランスにあります。\nレッド：失敗するテストで要件を明確にする グリーン：最小限の実装で動作を実現する リファクタリング：テストに守られながらコードを改善する この3つを繰り返すことで、品質の高いコードが育っていきます。\n次回予告 次回は「MooによるTDD講座 #4 - GitHub Actionsで自動テスト」として、以下の内容を扱います。\nGitHub Actionsの基本設定 プッシュ時に自動でテストを実行 複数のPerlバージョンでのマトリックステスト バッジの設定でREADMEを充実 継続的インテグレーション（CI）を導入して、さらに安心してコードを書ける環境を整えましょう。お楽しみに！\n","date":"2025-12-10T21:47:54+09:00","image":"https://www.nqou.net/public_images/2025/1765370874-image.jpg","permalink":"https://www.nqou.net/2025/12/10/214754/","title":"MooによるTDD講座 #3 - テストに守られながらリファクタリング"},{"content":"なぜ依存関係管理が重要なのか プロジェクトが成長すると、使用するCPANモジュールの数も増えていきます。開発環境、ステージング環境、本番環境で同じバージョンのモジュールが動作することを保証するのは、思いのほか難しい問題です。\nよくある問題 1 2 3 4 5 6 7 8 9 10 11 # 開発者Aの環境 # Mojolicious 9.30 がインストールされている use Mojolicious; # 問題なく動作 # 開発者Bの環境 # Mojolicious 8.50 がインストールされている use Mojolicious; # 一部の機能が動かない！ # 本番環境 # Mojolicious 9.35 がインストールされている use Mojolicious; # 開発環境と微妙に動作が違う... このような「私の環境では動くのに\u0026hellip;」という問題を解決するのが、Carton と cpanfile です。\ncpanfileとは - 依存関係の宣言 cpanfileは、プロジェクトが必要とするCPANモジュールを宣言するための仕様です。Ruby の Gemfile、Node.js の package.json、Python の requirements.txt に相当します。\n基本的な書き方 プロジェクトのルートディレクトリに cpanfile という名前のファイルを作成します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # cpanfile requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;9.30\u0026#39;; requires \u0026#39;DBIx::Class\u0026#39;, \u0026#39;0.082842\u0026#39;; requires \u0026#39;Plack\u0026#39;, \u0026#39;1.0048\u0026#39;; # テスト時のみ必要 on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;, \u0026#39;0.98\u0026#39;; requires \u0026#39;Test::MockModule\u0026#39;; }; # 開発時のみ必要 on \u0026#39;develop\u0026#39; =\u0026gt; sub { requires \u0026#39;Perl::Critic\u0026#39;; requires \u0026#39;Perl::Tidy\u0026#39;; }; cpanfileの文法は非常にシンプルで、Perlそのものです。requires 関数でモジュールとバージョンを指定するだけです。\nバージョン指定の方法 cpanfileでは、柔軟なバージョン指定が可能です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # cpanfile # 正確なバージョン指定 requires \u0026#39;Plack\u0026#39;, \u0026#39;== 1.0048\u0026#39;; # 最小バージョン指定（これ以上） requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; # 範囲指定 requires \u0026#39;DBI\u0026#39;, \u0026#39;\u0026gt;= 1.643, \u0026lt; 2.0\u0026#39;; # バージョン指定なし（最新版を使用） requires \u0026#39;JSON\u0026#39;; # 特定バージョン以上、かつ特定バージョン未満 requires \u0026#39;DBIx::Class\u0026#39;, \u0026#39;\u0026gt;= 0.082840, \u0026lt; 0.083000\u0026#39;; フィーチャーによるオプショナルな依存関係 特定の機能を使う場合にのみ必要なモジュールは、feature を使って宣言できます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # cpanfile requires \u0026#39;Mojolicious\u0026#39;; feature \u0026#39;mysql\u0026#39;, \u0026#39;MySQL support\u0026#39; =\u0026gt; sub { requires \u0026#39;DBD::mysql\u0026#39;, \u0026#39;4.050\u0026#39;; }; feature \u0026#39;postgresql\u0026#39;, \u0026#39;PostgreSQL support\u0026#39; =\u0026gt; sub { requires \u0026#39;DBD::Pg\u0026#39;, \u0026#39;3.14.0\u0026#39;; }; feature \u0026#39;redis\u0026#39;, \u0026#39;Redis cache support\u0026#39; =\u0026gt; sub { requires \u0026#39;Redis\u0026#39;, \u0026#39;2.0\u0026#39;; requires \u0026#39;Redis::Fast\u0026#39;; }; インストール時に、必要なフィーチャーを選択できます：\n1 2 3 4 5 # MySQLサポートを含めてインストール carton install --deployment --with-feature=mysql # 複数のフィーチャーを有効化 carton install --with-feature=mysql --with-feature=redis Cartonとは - 依存関係の分離管理 Cartonは、cpanfileに記述された依存関係を、プロジェクトごとに分離してインストール・管理するツールです。\nなぜCartonが必要なのか CPANモジュールを cpanm で直接インストールすると、システム全体（またはユーザー環境全体）にインストールされます。これには以下の問題があります：\nバージョンの競合: プロジェクトAはMojolicious 8.x、プロジェクトBは9.xが必要な場合、どちらか一方しか満たせない 環境の再現性: 「このモジュールのこのバージョンがインストールされている」状態を他の環境で再現するのが困難 クリーンな環境: プロジェクトを削除してもモジュールが残り続ける Cartonは、これらの問題を local/ ディレクトリへのローカルインストールで解決します。\nCartonのインストール 1 2 3 4 5 6 # cpanmを使ってCartonをインストール cpanm Carton # インストール確認 carton -v # carton v1.0.34 Carton自体はシステム全体（またはユーザー環境）にインストールしますが、各プロジェクトの依存関係は local/ に分離されます。\nCartonの基本的な使い方 ワークフロー例 実際のプロジェクトでの使い方を見ていきましょう。\n1. プロジェクトの初期化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # プロジェクトディレクトリを作成 mkdir my-app cd my-app # cpanfileを作成 cat \u0026gt; cpanfile \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;9.30\u0026#39;; requires \u0026#39;DBI\u0026#39;; requires \u0026#39;DBD::SQLite\u0026#39;; on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;, \u0026#39;0.98\u0026#39;; }; EOF 2. 依存関係のインストール 1 2 3 4 5 6 7 8 # cpanfileに基づいてモジュールをインストール carton install # 実行後のディレクトリ構造 # my-app/ # ├── cpanfile # ├── cpanfile.snapshot # 自動生成される # └── local/ # 依存モジュールがここにインストールされる carton install を実行すると：\ncpanfileを読み取る 必要なモジュールを local/ ディレクトリにインストール インストールされた正確なバージョン情報を cpanfile.snapshot に記録 3. アプリケーションの実行 Cartonでインストールしたモジュールを使うには、carton exec を使います：\n1 2 3 4 5 6 7 8 9 10 11 # 通常の実行（システムのモジュールを使用） perl app.pl # NG: local/ のモジュールが見つからない # Carton経由で実行（local/ のモジュールを使用） carton exec -- perl app.pl # OK! # plackupの場合 carton exec -- plackup app.psgi # スクリプトの場合 carton exec -- perl -Ilib script/myapp.pl carton exec は、local/ ディレクトリをモジュール検索パス（@INC）に追加して、指定されたコマンドを実行します。\nアプリケーション例 実際のアプリケーションでCartonを使った例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/usr/bin/env perl # app.pl use strict; use warnings; use Mojolicious::Lite; use DBI; # データベース接続（DBD::SQLiteを使用） my $dbh = DBI-\u0026gt;connect(\u0026#39;dbi:SQLite:dbname=app.db\u0026#39;); get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(text =\u0026gt; \u0026#39;Hello from Carton-managed app!\u0026#39;); }; app-\u0026gt;start; 1 2 3 4 5 6 # 依存関係をインストール carton install # アプリケーションを実行 carton exec -- morbo app.pl # Server available at http://127.0.0.1:3000 cpanfile.snapshot - 完全な再現性 cpanfile.snapshot は、carton install 実行時に自動生成されるファイルで、インストールされたすべてのモジュールの正確なバージョンとその依存関係を記録します。\ncpanfile と cpanfile.snapshot の違い 1 2 # cpanfile（開発者が書く） requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; # 「9.0以上」という緩い指定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # cpanfile.snapshot（Cartonが生成） # DATE: 2025-12-10T12:00:00 # PERL_VERSION: 5.38.0 DISTRIBUTIONS Mojolicious-9.37 pathname: S/SR/SRI/Mojolicious-9.37.tar.gz provides: Mojo 9.37 Mojo::Base 9.37 # ... 全サブモジュールの正確なバージョン requirements: ExtUtils::MakeMaker 0 IO::Socket::IP 0.37 # ... 依存関係の正確なバージョン cpanfile.snapshotがあることで、どの環境でも完全に同じバージョンのモジュールをインストールできます。\nデプロイ時の使用 本番環境やCI環境では、--deployment オプションを使用します：\n1 2 3 4 5 6 7 # デプロイメントモード（cpanfile.snapshotを使用） carton install --deployment # このモードでは： # - cpanfile.snapshotに記録された正確なバージョンをインストール # - cpanfile.snapshotがない場合はエラー # - cpanfileとcpanfile.snapshotの不整合があればエラー これにより、開発環境と全く同じバージョンのモジュール構成を本番環境に展開できます。\nチーム開発での活用 推奨ワークフロー 開発者Aの作業（新しい依存関係を追加） 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. cpanfileに新しい依存関係を追加 echo \u0026#34;requires \u0026#39;JSON::XS\u0026#39;;\u0026#34; \u0026gt;\u0026gt; cpanfile # 2. インストール（cpanfile.snapshotが更新される） carton install # 3. 動作確認 carton exec -- perl app.pl # 4. cpanfileとcpanfile.snapshotをコミット git add cpanfile cpanfile.snapshot git commit -m \u0026#34;Add JSON::XS dependency\u0026#34; git push 開発者Bの作業（変更を取り込む） 1 2 3 4 5 6 7 8 # 1. 最新のコードを取得 git pull # 2. 依存関係を更新（cpanfile.snapshotに従う） carton install # 3. そのまま開発を続行（追加の作業不要！） carton exec -- perl app.pl .gitignoreの設定 local/ ディレクトリはバージョン管理に含めず、cpanfile と cpanfile.snapshot だけを管理します：\n1 2 3 # .gitignore /local/ /.carton/ local/ ディレクトリには大量のファイルが含まれるため、Gitで管理するのは非効率です。cpanfile.snapshotがあれば、いつでも同じ環境を再現できます。\nCI/CDでの利用 GitHub Actions での例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # .github/workflows/test.yml name: Test on: [push, pull_request] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 - name: Set up Perl uses: shogo82148/actions-setup-perl@v1 with: perl-version: \u0026#39;5.38\u0026#39; - name: Cache Carton dependencies uses: actions/cache@v3 with: path: local key: ${{ runner.os }}-carton-${{ hashFiles(\u0026#39;cpanfile.snapshot\u0026#39;) }} restore-keys: | ${{ runner.os }}-carton- - name: Install Carton run: cpanm -n Carton - name: Install dependencies run: carton install --deployment - name: Run tests run: carton exec -- prove -lr t/ --deployment オプションにより、cpanfile.snapshotに記録された正確なバージョンがインストールされます。キャッシュを活用することで、2回目以降のビルドが高速化されます。\nGitLab CI での例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # .gitlab-ci.yml image: perl:5.38 cache: paths: - local/ before_script: - cpanm -n Carton - carton install --deployment test: script: - carton exec -- prove -lr t/ deploy: stage: deploy script: - carton install --deployment --without-develop - rsync -av --exclude \u0026#39;local\u0026#39; ./ user@server:/path/to/app/ only: - main Dockerでの利用 Dockerコンテナでも Carton は有効です。特に、マルチステージビルドと組み合わせると効果的です。\nシンプルなDockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 FROM perl:5.38 WORKDIR /app # Cartonをインストール RUN cpanm -n Carton # cpanfileとcpanfile.snapshotをコピー COPY cpanfile cpanfile.snapshot ./ # 依存関係をインストール RUN carton install --deployment --without-develop --without-test # アプリケーションコードをコピー COPY . . # アプリケーションを実行 CMD [\u0026#34;carton\u0026#34;, \u0026#34;exec\u0026#34;, \u0026#34;--\u0026#34;, \u0026#34;plackup\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;Starman\u0026#34;, \u0026#34;--workers\u0026#34;, \u0026#34;4\u0026#34;, \u0026#34;app.psgi\u0026#34;] マルチステージビルドの例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # ビルドステージ FROM perl:5.38 AS builder WORKDIR /app RUN cpanm -n Carton COPY cpanfile cpanfile.snapshot ./ RUN carton install --deployment --cached COPY . . # 実行ステージ（軽量） FROM perl:5.38-slim WORKDIR /app # ビルドステージからlocal/とアプリをコピー COPY --from=builder /app/local ./local COPY --from=builder /app . # Cartonをインストール（execに必要） RUN cpanm -n Carton CMD [\u0026#34;carton\u0026#34;, \u0026#34;exec\u0026#34;, \u0026#34;--\u0026#34;, \u0026#34;plackup\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;Starman\u0026#34;, \u0026#34;app.psgi\u0026#34;] マルチステージビルドを使うことで、最終的なイメージサイズを小さくできます。\nDocker Composeでの開発環境 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: build: . ports: - \u0026#34;5000:5000\u0026#34; volumes: - .:/app - carton-cache:/app/local environment: - PLACK_ENV=development command: carton exec -- plackup -R lib,app.psgi app.psgi volumes: carton-cache: ボリュームを使って local/ をキャッシュすることで、コンテナ再起動時の依存関係インストールを省略できます。\n他の言語との比較 Carton/cpanfileは、他の言語の依存関係管理ツールと同様の思想で設計されています。\nRuby - Bundler/Gemfile 1 2 3 4 5 6 7 8 9 # Gemfile source \u0026#39;https://rubygems.org\u0026#39; gem \u0026#39;rails\u0026#39;, \u0026#39;~\u0026gt; 7.0\u0026#39; gem \u0026#39;pg\u0026#39;, \u0026#39;\u0026gt;= 1.0\u0026#39; group :development, :test do gem \u0026#39;rspec-rails\u0026#39; end 1 2 bundle install bundle exec rails server 対応するPerl版：\n1 2 3 4 5 6 7 # cpanfile requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;~\u0026gt; 9.0\u0026#39;; requires \u0026#39;DBD::Pg\u0026#39;, \u0026#39;\u0026gt;= 3.0\u0026#39;; on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;; }; 1 2 carton install carton exec -- morbo app.pl Node.js - npm/package.json 1 2 3 4 5 6 7 8 9 { \u0026#34;dependencies\u0026#34;: { \u0026#34;express\u0026#34;: \u0026#34;^4.18.0\u0026#34;, \u0026#34;pg\u0026#34;: \u0026#34;^8.7.0\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;jest\u0026#34;: \u0026#34;^29.0.0\u0026#34; } } 1 2 npm install npm start Perlとの対応：\n1 2 3 4 5 6 7 # cpanfile requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; requires \u0026#39;DBD::Pg\u0026#39;, \u0026#39;\u0026gt;= 8.0\u0026#39;; on \u0026#39;develop\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;; }; 1 2 carton install carton exec -- perl app.pl Python - pip/requirements.txt 1 2 3 # requirements.txt Django==4.2.0 psycopg2\u0026gt;=2.9.0 1 2 pip install -r requirements.txt python manage.py runserver Perl版：\n1 2 3 # cpanfile requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;== 9.30\u0026#39;; requires \u0026#39;DBD::Pg\u0026#39;, \u0026#39;\u0026gt;= 3.14.0\u0026#39;; 1 2 carton install carton exec -- perl app.pl ベストプラクティス 1. cpanfile.snapshotは必ずコミットする 1 2 git add cpanfile cpanfile.snapshot git commit -m \u0026#34;Update dependencies\u0026#34; cpanfile.snapshotがないと、チームメンバーや本番環境で同じバージョンを再現できません。\n2. 定期的に依存関係を更新する 1 2 3 4 5 6 7 8 9 # 古いlocal/を削除 rm -rf local/ # 最新版で再インストール carton install # 動作確認後、cpanfile.snapshotをコミット git add cpanfile.snapshot git commit -m \u0026#34;Update dependencies to latest versions\u0026#34; 3. バージョン範囲を適切に指定する 1 2 3 4 5 6 7 8 # ✗ 悪い例：バージョン指定なし（予期しない破壊的変更のリスク） requires \u0026#39;Mojolicious\u0026#39;; # ○ 良い例：メジャーバージョンを固定 requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0, \u0026lt; 10.0\u0026#39;; # ○ または最小バージョンのみ指定 requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.30\u0026#39;; 4. 開発用/テスト用依存関係を分ける 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # cpanfile # 本番環境でも必要 requires \u0026#39;Mojolicious\u0026#39;; requires \u0026#39;DBI\u0026#39;; # テスト時のみ on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;; requires \u0026#39;Test::MockModule\u0026#39;; requires \u0026#39;Devel::Cover\u0026#39;; }; # 開発時のみ on \u0026#39;develop\u0026#39; =\u0026gt; sub { requires \u0026#39;Perl::Critic\u0026#39;; requires \u0026#39;Perl::Tidy\u0026#39;; requires \u0026#39;Reply\u0026#39;; # REPL }; デプロイ時は不要な依存関係を除外：\n1 carton install --deployment --without-develop --without-test 5. プライベートCPANミラーの活用 社内プライベートモジュールがある場合：\n1 2 3 4 5 6 7 # cpanfile requires \u0026#39;PublicModule::FromCPAN\u0026#39;; # プライベートリポジトリから requires \u0026#39;MyCompany::InternalModule\u0026#39;, git =\u0026gt; \u0026#39;https://github.com/mycompany/internal-module.git\u0026#39;, ref =\u0026gt; \u0026#39;v1.0.0\u0026#39;; または、mirror 設定でプライベートCPANミラーを使用：\n1 2 3 # 環境変数で指定 export PERL_CARTON_MIRROR=\u0026#34;https://cpan.internal.company.com\u0026#34; carton install トラブルシューティング local/ディレクトリが壊れた 1 2 3 # local/を削除して再インストール rm -rf local/ .carton/ carton install cpanfile.snapshotとcpanfileの不整合 1 2 3 4 5 6 7 8 9 10 11 # --deploymentモードでエラーが出る場合 carton install --deployment # Finding mirrors... # ERROR: cpanfile.snapshot is out of date. Run `carton install` to update it. # 開発環境で再インストール carton install # cpanfile.snapshotが更新されるのでコミット git add cpanfile.snapshot git commit -m \u0026#34;Update cpanfile.snapshot\u0026#34; 特定のモジュールのバージョンを固定したい 1 2 3 # cpanfile # 正確なバージョンを指定 requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;== 9.30\u0026#39;; その後、再インストール：\n1 2 rm -rf local/ carton install Carton経由とシステムのモジュールが競合 1 2 3 4 5 6 7 8 # Carton経由で実行されているか確認 carton exec -- perl -V # @INCを確認（local/が含まれているはず） carton exec -- perl -e \u0026#39;print \u0026#34;$_\\n\u0026#34; for @INC\u0026#39; # /path/to/project/local/lib/perl5 # /path/to/project/local/lib/perl5/x86_64-linux # ... 必ず carton exec を使ってコマンドを実行してください。\nインストールが遅い 1 2 3 4 5 # 並列インストールで高速化 carton install -j 4 # 4並列 # ミラーサイトを指定 carton install --mirror http://cpan.cpantesters.org/ 実際のプロジェクト例 実際のWebアプリケーションプロジェクトでの構成例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 my-web-app/ ├── cpanfile # 依存関係定義 ├── cpanfile.snapshot # バージョンロック ├── app.psgi # PSGIアプリケーション ├── lib/ │ └── MyApp/ │ ├── Controller/ │ └── Model/ ├── t/ # テスト │ ├── 00_compile.t │ └── 01_basic.t ├── public/ # 静的ファイル │ ├── css/ │ └── js/ ├── script/ # ユーティリティスクリプト │ └── myapp.pl ├── .gitignore # local/ を除外 ├── Dockerfile # Docker設定 └── README.md 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # cpanfile requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; requires \u0026#39;Mojo::Pg\u0026#39;; requires \u0026#39;DBIx::Class\u0026#39;, \u0026#39;0.082842\u0026#39;; requires \u0026#39;DateTime\u0026#39;; requires \u0026#39;Email::Sender\u0026#39;; requires \u0026#39;Crypt::Passphrase::Argon2\u0026#39;; on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test::More\u0026#39;, \u0026#39;0.98\u0026#39;; requires \u0026#39;Test::Mojo\u0026#39;; requires \u0026#39;Test::PostgreSQL\u0026#39;; }; on \u0026#39;develop\u0026#39; =\u0026gt; sub { requires \u0026#39;Perl::Critic\u0026#39;; requires \u0026#39;Perl::Tidy\u0026#39;; requires \u0026#39;Devel::NYTProf\u0026#39;; # プロファイラ }; 1 2 3 4 5 6 7 8 9 10 # 開発開始 carton install carton exec -- morbo app.psgi # テスト実行 carton exec -- prove -lvr t/ # 本番デプロイ carton install --deployment --without-develop --without-test carton exec -- plackup -s Starman --workers 10 app.psgi まとめ Carton/cpanfileは、モダンなPerl開発に欠かせないツールです：\nCarton/cpanfileのメリット 環境の再現性: cpanfile.snapshotにより、どの環境でも同じバージョンのモジュール構成を再現 プロジェクトの分離: local/へのインストールにより、プロジェクト間でモジュールバージョンが競合しない チーム開発の効率化: 「私の環境では動く」問題を解消 CI/CDとの親和性: 自動化されたビルド・テストが容易 他言語との共通パターン: Bundler、npm等と同様のワークフローで学習コストが低い 導入のステップ Cartonをインストール: cpanm Carton cpanfileを作成: プロジェクトの依存関係を記述 依存関係をインストール: carton install アプリを実行: carton exec -- perl app.pl cpanfile.snapshotをコミット: git add cpanfile cpanfile.snapshot 他の選択肢 Carton以外にも、Perl依存関係管理ツールはいくつか存在します：\ncpm: 高速な並列インストーラー（Cartonの代替として使える） Pinto: プライベートCPANリポジトリ管理 Dist::Zilla: モジュール開発向けのツールチェーン（依存関係管理も含む） しかし、チーム開発や本番環境での依存関係管理という観点では、Carton/cpanfileが最も広く使われているデファクトスタンダードです。\nPerlの依存関係管理の進化 Perl の依存関係管理は、長い歴史の中で進化してきました：\nCPAN時代: モジュールを手動でインストール、バージョン管理なし cpanm時代: 自動依存関係解決、しかしプロジェクト単位の管理はなし Carton時代: プロジェクト単位での依存関係管理、バージョンロック（現在） Carton/cpanfileは、Ruby の Bundler、Node.js の npm、Python の pip といった他言語のベストプラクティスに影響を受け、Perlに取り入れられた成果です。TMTOWTDI（やり方は一つじゃない）の精神を持つPerlですが、依存関係管理に関しては Carton/cpanfile がモダンな標準となっています。\n参考リンク Carton - CPAN cpanfile - CPAN Module::CPANfile - CPAN Carton GitHub Repository Carton/cpanfileを活用して、安定したPerl開発環境を構築しましょう！チーム全体で同じ環境を共有できることは、開発効率の大幅な向上につながります。\n","date":"2025-12-10T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251210-carton.jpg","permalink":"https://www.nqou.net/2025/12/10/000000/","title":"Carton/cpanfile - モダンなPerl依存関係管理"},{"content":"前回のおさらい 前回は、DockerでのPerl開発環境を構築し、Test2とMooを使ってTDDの基本サイクルを体験しました。\nTDDの3つのステップを覚えていますか？\nレッド：失敗するテストを先に書く グリーン：最小限の実装でテストを通す リファクタリング：テストが通った状態でコードを改善する 前回は、シンプルなPersonクラスを作り、nameアトリビュートのテストまで行いました。\n今回のゴール 今回は、もう一歩踏み込んでメソッドの振る舞いをテストしていきます。同時に、Test2が提供する便利な機能を学び、より表現力豊かなテストが書けるようになることを目指します。\n具体的には以下の内容を扱います。\nメソッドの戻り値をテストする 正規表現マッチや構造比較など、Test2の多彩な機能 例外のテスト方法 サブテストによるテストの整理 それでは、始めましょう！\nメソッドの振る舞いをテストする まずは、Personクラスにgreetメソッドを追加してみます。もちろん、TDDで進めます。\ngreetメソッドの実装（TDDで） ステップ1：失敗するテストを書く（レッド） t/02-person-methods.tを作成しましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; subtest \u0026#39;greet method\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Bob\u0026#39;); my $greeting = $person-\u0026gt;greet; is $greeting, \u0026#39;Hello, I am Bob!\u0026#39;, \u0026#39;greet returns correct message\u0026#39;; }; done_testing; テストを実行してみます。\n1 docker compose run --rm app prove -lv t/02-person-methods.t 当然、greetメソッドがまだ存在しないので、エラーになります。これが「レッド」の状態です。\nステップ2：最小限の実装で通す（グリーン） lib/Person.pmにgreetメソッドを追加します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package Person; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); sub greet { my $self = shift; return \u0026#34;Hello, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } 1; テストを実行する 1 docker compose run --rm app prove -lv t/02-person-methods.t 再度テストを実行すると、今度は成功するはずです。これが「グリーン」です！\nグリーンになったら、この変更をコミットしましょう：\n1 2 git add lib/Person.pm t/02-person-methods.t git commit -m \u0026#34;Add greet method to Person class\u0026#34; 引数を受け取るメソッドのテスト 次は、引数を受け取るメソッドをテストしてみましょう。greet_toメソッドを追加します。\nテストを先に書く 1 2 3 4 5 6 subtest \u0026#39;greet_to method with argument\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Bob\u0026#39;); my $greeting = $person-\u0026gt;greet_to(\u0026#39;Alice\u0026#39;); is $greeting, \u0026#39;Hello Alice, I am Bob!\u0026#39;, \u0026#39;greet_to works with argument\u0026#39;; }; 実装する 1 2 3 4 sub greet_to { my ($self, $target) = @_; return \u0026#34;Hello $target, I am \u0026#34; . $self-\u0026gt;name . \u0026#34;!\u0026#34;; } テストを実行する 1 docker compose run --rm app prove -lv t/02-person-methods.t このように、TDDでは「テストを書く→実装する」を小刻みに繰り返します。\nTest2の便利な機能 ここからは、Test2が提供する様々なアサーション機能を見ていきましょう。\nlike / unlike（正規表現マッチ） 文字列が特定のパターンにマッチするかをテストできます。\n1 2 3 4 5 6 7 8 9 10 use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; subtest \u0026#39;regular expression matching\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Charlie\u0026#39;); my $greeting = $person-\u0026gt;greet; like $greeting, qr/Hello/, \u0026#39;greeting contains \u0026#34;Hello\u0026#34;\u0026#39;; like $greeting, qr/Charlie/, \u0026#39;greeting contains person name\u0026#39;; unlike $greeting, qr/Goodbye/, \u0026#39;greeting does not contain \u0026#34;Goodbye\u0026#34;\u0026#39;; }; likeは正規表現にマッチすることを確認し、unlikeはマッチしないことを確認します。\nok / is / isnt の使い分け Test2には、いくつかの基本的なアサーション関数があります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 subtest \u0026#39;basic assertions\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Dave\u0026#39;); # ok: 真偽値のテスト ok $person, \u0026#39;person object exists\u0026#39;; ok $person-\u0026gt;name, \u0026#39;person has a name\u0026#39;; # is: 等価性のテスト（厳密な比較） is $person-\u0026gt;name, \u0026#39;Dave\u0026#39;, \u0026#39;name is exactly \u0026#34;Dave\u0026#34;\u0026#39;; # isnt: 非等価性のテスト isnt $person-\u0026gt;name, \u0026#39;Eve\u0026#39;, \u0026#39;name is not \u0026#34;Eve\u0026#34;\u0026#39;; }; 使い分けのポイント：\nok：真偽値だけを確認したい時 is：具体的な値が一致するか確認したい時 isnt：値が異なることを確認したい時 array / hash（構造の比較） 配列やハッシュの構造を比較するときに便利な機能です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Test2::V0; subtest \u0026#39;array and hash comparison\u0026#39; =\u0026gt; sub { my @names = (\u0026#39;Alice\u0026#39;, \u0026#39;Bob\u0026#39;, \u0026#39;Charlie\u0026#39;); # 配列の比較 is \\@names, [\u0026#39;Alice\u0026#39;, \u0026#39;Bob\u0026#39;, \u0026#39;Charlie\u0026#39;], \u0026#39;array matches expected values\u0026#39;; my %person_info = ( name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 30, ); # ハッシュの比較 is \\%person_info, { name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 30, }, \u0026#39;hash matches expected structure\u0026#39;; }; リファレンスとして渡すことで、構造全体を一度に比較できます。\nobject（オブジェクトの検証） オブジェクトの型やメソッドの存在を確認できます。\n1 2 3 4 5 6 7 8 9 10 subtest \u0026#39;object validation\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Frank\u0026#39;); # オブジェクトの型を確認 isa_ok $person, [ \u0026#39;Person\u0026#39; ], \u0026#39;person is a Person object\u0026#39;; # メソッドの存在を確認 can_ok $person, [ \u0026#39;greet\u0026#39; ], \u0026#39;person can greet\u0026#39;; can_ok $person, [ \u0026#39;greet_to\u0026#39; ], \u0026#39;person can greet_to\u0026#39;; }; subtestを追加する感じで問題ありません。\nisa_okは継承関係の確認に、can_okはメソッドの存在確認に使います。\n例外のテスト 実際のアプリケーションでは、エラー処理も重要です。Test2では、例外のテストも簡単に書けます。\ndies（例外が発生することを確認） まず、年齢を設定するメソッドで、負の値を拒否する機能を追加してみましょう。\nテストから書く 1 2 3 4 5 6 7 8 9 10 11 12 use Test2::V0; subtest \u0026#39;age validation\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Grace\u0026#39;); # 正常な値は受け入れる ok lives { $person-\u0026gt;set_age(25) }, \u0026#39;valid age is accepted\u0026#39;; is $person-\u0026gt;age, 25, \u0026#39;age is set correctly\u0026#39;; # 負の値は例外を投げる ok dies { $person-\u0026gt;set_age(-5) }, \u0026#39;negative age throws exception\u0026#39;; }; 実装する 1 2 3 4 5 6 7 8 9 10 has age =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, predicate =\u0026gt; 1, ); sub set_age { my ($self, $age) = @_; die \u0026#34;Age must be non-negative\u0026#34; if $age \u0026lt; 0; $self-\u0026gt;age($age); } lives（例外が発生しないことを確認） 逆に、例外が発生しないことを確認する場合はlivesを使います。\n1 2 3 4 5 6 subtest \u0026#39;valid operations do not throw\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Henry\u0026#39;); ok lives { $person-\u0026gt;greet }, \u0026#39;greet does not throw\u0026#39;; ok lives { $person-\u0026gt;greet_to(\u0026#39;Ivy\u0026#39;) }, \u0026#39;greet_to does not throw\u0026#39;; }; 例外メッセージの検証 例外のメッセージ内容まで確認したい場合は、likeと組み合わせます。\n1 2 3 4 5 6 7 8 9 subtest \u0026#39;exception message validation\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Jack\u0026#39;); like( dies { $person-\u0026gt;set_age(-10) }, qr/must be non-negative/, \u0026#39;exception message contains expected text\u0026#39; ); }; これで、例外の発生だけでなく、その内容まで検証できます。\nサブテストで整理する テストが増えてくると、整理が重要になります。subtestを使うと、論理的にグループ化できます。\nsubtest の使い方 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; subtest \u0026#39;Person creation\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Kate\u0026#39;); isa_ok $person, \u0026#39;Person\u0026#39;; is $person-\u0026gt;name, \u0026#39;Kate\u0026#39;, \u0026#39;name is set correctly\u0026#39;; }; subtest \u0026#39;Greeting methods\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Leo\u0026#39;); subtest \u0026#39;basic greet\u0026#39; =\u0026gt; sub { my $greeting = $person-\u0026gt;greet; like $greeting, qr/Hello/, \u0026#39;contains greeting\u0026#39;; like $greeting, qr/Leo/, \u0026#39;contains name\u0026#39;; }; subtest \u0026#39;greet with target\u0026#39; =\u0026gt; sub { my $greeting = $person-\u0026gt;greet_to(\u0026#39;Mia\u0026#39;); like $greeting, qr/Hello Mia/, \u0026#39;addresses target\u0026#39;; like $greeting, qr/I am Leo/, \u0026#39;introduces self\u0026#39;; }; }; subtest \u0026#39;Age validation\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Nina\u0026#39;); ok lives { $person-\u0026gt;set_age(30) }, \u0026#39;accepts valid age\u0026#39;; ok dies { $person-\u0026gt;set_age(-1) }, \u0026#39;rejects negative age\u0026#39;; }; done_testing; テストの可読性向上 サブテストを使うことで、以下のメリットがあります。\n構造が明確：どの機能をテストしているか一目瞭然 失敗箇所の特定が容易：サブテストの名前でエラー箇所がすぐわかる メンテナンスしやすい：関連するテストがまとまっている 論理的なグループ化 サブテストは、以下のような観点でグループ化できます。\n機能別：「作成」「更新」「削除」など シナリオ別：「正常系」「異常系」など 対象別：「アトリビュート」「メソッド」「例外」など テストファイルが成長してきたら、積極的にサブテストで整理しましょう。\nまとめと次回予告 今回学んだこと 今回は、Test2の豊富な機能を使って、より実践的なテストを書く方法を学びました。\nメソッドのテスト：戻り値や引数を持つメソッドのテスト方法 Test2の多彩な機能：like、array、hash、isa_ok、can_okなど 例外のテスト：diesとlivesによる例外処理の検証 サブテスト：テストの論理的なグループ化と可読性向上 Test2を使えば、表現力豊かで読みやすいテストが書けることを実感できたのではないでしょうか。\nTDDの効果を実感する TDDで開発すると、以下のような効果があります。\n仕様が明確になる：テストが要求仕様のドキュメントになる 安心してリファクタリングできる：テストが壊れていないことを保証 バグが減る：実装前にテストケースを考えることで、漏れが減る 最初は慣れないかもしれませんが、小さく始めて徐々に慣れていきましょう。\n次回予告 次回は「MooによるTDD講座 #3 - リファクタリングとロールの活用」として、以下の内容を扱います。\nテストが通った状態での安全なリファクタリング Mooのロール（役割）を使ったコードの再利用 複数のクラス間でのコード共有 テスタビリティを高める設計 コードを整理しながら、Mooの真価を発揮させる方法を学びます。お楽しみに！\n","date":"2025-12-09T21:47:54+09:00","image":"https://www.nqou.net/public_images/2025/1765284474-image.jpg","permalink":"https://www.nqou.net/2025/12/09/214754/","title":"MooによるTDD講座 #2 - メソッドのテストとTest2の便利な機能"},{"content":"Plack/PSGIとは何か Perl Webアプリケーション開発において、Plack/PSGIは革命的な存在です。2009年に宮川達彦氏によって提案されたPSGI（Perl Web Server Gateway Interface）は、PerlにおけるWebアプリケーションとWebサーバーの間のインターフェース仕様です。そして、Plackはそのリファレンス実装として、PSGIアプリケーションの実行環境とミドルウェアのエコシステムを提供します。\nPSGIが解決した問題 PSGIが登場する前のPerl Web開発では、各フレームワーク（Catalyst、CGI::Application等）が独自にWebサーバーとのやり取りを実装していました。これには以下のような問題がありました：\nフレームワーク固有の実装: 各フレームワークがApache mod_perl、FastCGI、CGIなどに個別対応 デプロイの複雑さ: フレームワークを変更すると、デプロイ方法も変更が必要 再利用性の低さ: 認証、ロギング、セッション管理などの共通機能が各フレームワークで個別実装 テストの困難さ: Webサーバーを起動しないとテストできない場合が多い PSGIはこれらの問題を、アプリケーション層とサーバー層を分離するという明確な仕様によって解決しました。\nPSGIの仕様 PSGIアプリケーションは、非常にシンプルな仕様で定義されます：\n1 2 3 4 5 6 7 8 9 10 # 最小のPSGIアプリケーション my $app = sub { my $env = shift; # リクエスト情報を含むハッシュリファレンス return [ 200, # HTTPステータスコード [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39; ], # HTTPヘッダー（配列リファレンス） [ \u0026#34;Hello World\u0026#34; ], # レスポンスボディ（配列リファレンス） ]; }; たったこれだけです！PSGIアプリケーションは、環境変数のハッシュリファレンスを受け取り、3要素の配列リファレンス（ステータス、ヘッダー、ボディ）を返すサブルーチンリファレンスです。\nこの単純さこそがPSGIの強みです。Python の WSGI、Ruby の Rackに影響を受けた設計思想が、Perl の Web開発に大きな変革をもたらしました。\nPlackのインストールと基本的な使い方 インストール 1 2 3 4 5 # cpanmを使う場合 cpanm Plack # cpanを使う場合 cpan Plack 最初のPSGIアプリケーション - Hello World hello.psgi という名前でファイルを作成します：\n1 2 3 4 5 6 7 8 9 10 # hello.psgi my $app = sub { my $env = shift; return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;Hello, Plack!\u0026lt;/h1\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026#34; ], ]; }; 実行は plackup コマンドを使います：\n1 2 plackup hello.psgi # HTTP::Server::PSGI: Accepting connections at http://0:5000/ ブラウザで http://localhost:5000/ にアクセスすると、「Hello, Plack!」が表示されます。\n環境変数（$env）の活用 $env ハッシュリファレンスには、リクエストに関する豊富な情報が含まれています：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # env_info.psgi my $app = sub { my $env = shift; my $path = $env-\u0026gt;{PATH_INFO}; # リクエストパス my $method = $env-\u0026gt;{REQUEST_METHOD}; # HTTPメソッド my $query = $env-\u0026gt;{QUERY_STRING}; # クエリ文字列 my $body = \u0026lt;\u0026lt;\u0026#34;HTML\u0026#34;; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt;\u0026lt;title\u0026gt;環境変数の例\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;リクエスト情報\u0026lt;/h1\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;パス: $path\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;メソッド: $method\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;クエリ: $query\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; HTML return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ $body ], ]; }; パスによる分岐 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # router.psgi my $app = sub { my $env = shift; my $path = $env-\u0026gt;{PATH_INFO}; if ($path eq \u0026#39;/\u0026#39;) { return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;トップページ\u0026lt;/h1\u0026gt;\u0026#34; ], ]; } elsif ($path eq \u0026#39;/about\u0026#39;) { return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;Aboutページ\u0026lt;/h1\u0026gt;\u0026lt;p\u0026gt;このサイトについて\u0026lt;/p\u0026gt;\u0026#34; ], ]; } else { return [ 404, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;404 Not Found\u0026lt;/h1\u0026gt;\u0026#34; ], ]; } }; Plackミドルウェア - 機能を積み重ねる Plackの真の力は、ミドルウェアのエコシステムにあります。ミドルウェアは、PSGIアプリケーションをラップして機能を追加する仕組みです。\nミドルウェアの基本 ミドルウェアは Plack::Builder の builder と enable を使って適用します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # middleware_basic.psgi use Plack::Builder; my $app = sub { my $env = shift; return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39; ], [ \u0026#34;Original App Response\u0026#34; ], ]; }; builder { enable \u0026#39;AccessLog\u0026#39;, format =\u0026gt; \u0026#39;combined\u0026#39;; # アクセスログ $app; }; 便利なミドルウェアの紹介 Plack::Middleware::Static - 静的ファイル配信 1 2 3 4 5 6 7 8 9 10 11 12 13 # static_files.psgi use Plack::Builder; my $app = sub { return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;Dynamic Content\u0026lt;/h1\u0026gt;\u0026#34; ] ]; }; builder { enable \u0026#39;Static\u0026#39;, path =\u0026gt; qr{^/static/}, # /static/で始まるパスを静的ファイルとして扱う root =\u0026gt; \u0026#39;./public\u0026#39;; # ドキュメントルート $app; }; Plack::Middleware::Auth::Basic - Basic認証 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # auth_basic.psgi use Plack::Builder; my $app = sub { return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;Protected Content\u0026lt;/h1\u0026gt;\u0026#34; ] ]; }; builder { enable \u0026#39;Auth::Basic\u0026#39;, authenticator =\u0026gt; sub { my ($username, $password, $env) = @_; return $username eq \u0026#39;admin\u0026#39; \u0026amp;\u0026amp; $password eq \u0026#39;secret\u0026#39;; }; $app; }; Plack::Middleware::Session - セッション管理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # session.psgi use Plack::Builder; use Plack::Request; my $app = sub { my $env = shift; my $req = Plack::Request-\u0026gt;new($env); my $session = $req-\u0026gt;session; # セッションからカウンターを取得（初回は0） my $count = $session-\u0026gt;{counter} || 0; $count++; $session-\u0026gt;{counter} = $count; return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;訪問回数: $count\u0026lt;/h1\u0026gt;\u0026#34; ], ]; }; builder { enable \u0026#39;Session\u0026#39;; # デフォルトでCookieベースのセッション $app; }; ミドルウェアの積み重ね 複数のミドルウェアを組み合わせることで、強力なアプリケーションを構築できます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # combined_middleware.psgi use Plack::Builder; use Plack::Request; my $app = sub { my $env = shift; my $req = Plack::Request-\u0026gt;new($env); my $session = $req-\u0026gt;session; my $user = $session-\u0026gt;{user} || \u0026#39;ゲスト\u0026#39;; return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ \u0026#34;\u0026lt;h1\u0026gt;ようこそ、${user}さん！\u0026lt;/h1\u0026gt;\u0026#34; ], ]; }; builder { # アクセスログ enable \u0026#39;AccessLog\u0026#39;, format =\u0026gt; \u0026#39;combined\u0026#39;; # 静的ファイル配信 enable \u0026#39;Static\u0026#39;, path =\u0026gt; qr{^/(images|css|js)/}, root =\u0026gt; \u0026#39;./public\u0026#39;; # セッション管理 enable \u0026#39;Session\u0026#39;, store =\u0026gt; \u0026#39;File\u0026#39;; # ファイルベースのセッション保存 # エラーページのカスタマイズ enable \u0026#39;HTTPExceptions\u0026#39;; # レスポンスの圧縮 enable \u0026#39;Deflater\u0026#39;, content_type =\u0026gt; [\u0026#39;text/css\u0026#39;, \u0026#39;text/html\u0026#39;, \u0026#39;text/javascript\u0026#39;, \u0026#39;application/javascript\u0026#39;]; $app; }; ミドルウェアは上から順に適用され、レスポンスは逆順（下から上）に処理されます。これは、まさに「PSGI アプリケーションをミドルウェアが層状にラップする」という構造です。\n実用的なアプリケーション例 Plack::Requestを使った本格的なアプリケーション Plack::Request と Plack::Response を使うと、より直感的にリクエスト・レスポンスを扱えます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # todo_app.psgi use strict; use warnings; use Plack::Builder; use Plack::Request; use Plack::Response; use JSON qw(encode_json decode_json); # 簡易的なTODOリスト（本来はDBやファイルに保存） my @todos = ( { id =\u0026gt; 1, title =\u0026gt; \u0026#39;Plackを学ぶ\u0026#39;, done =\u0026gt; 0 }, { id =\u0026gt; 2, title =\u0026gt; \u0026#39;PSGIアプリを作る\u0026#39;, done =\u0026gt; 0 }, ); my $next_id = 3; my $app = sub { my $env = shift; my $req = Plack::Request-\u0026gt;new($env); my $res = Plack::Response-\u0026gt;new(200); my $path = $req-\u0026gt;path_info; my $method = $req-\u0026gt;method; # ルーティング if ($path eq \u0026#39;/\u0026#39; \u0026amp;\u0026amp; $method eq \u0026#39;GET\u0026#39;) { # TODO一覧表示（HTML） $res-\u0026gt;content_type(\u0026#39;text/html; charset=UTF-8\u0026#39;); my $html = \u0026#34;\u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;TODO App\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026#34;; $html .= \u0026#34;\u0026lt;h1\u0026gt;TODO リスト\u0026lt;/h1\u0026gt;\u0026lt;ul\u0026gt;\u0026#34;; for my $todo (@todos) { my $status = $todo-\u0026gt;{done} ? \u0026#39;✓\u0026#39; : \u0026#39;○\u0026#39;; $html .= \u0026#34;\u0026lt;li\u0026gt;$status $todo-\u0026gt;{title}\u0026lt;/li\u0026gt;\u0026#34;; } $html .= \u0026#34;\u0026lt;/ul\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026#34;; $res-\u0026gt;body($html); } elsif ($path eq \u0026#39;/api/todos\u0026#39; \u0026amp;\u0026amp; $method eq \u0026#39;GET\u0026#39;) { # API: TODO一覧取得（JSON） $res-\u0026gt;content_type(\u0026#39;application/json\u0026#39;); $res-\u0026gt;body(encode_json(\\@todos)); } elsif ($path eq \u0026#39;/api/todos\u0026#39; \u0026amp;\u0026amp; $method eq \u0026#39;POST\u0026#39;) { # API: TODO追加 my $params = decode_json($req-\u0026gt;content); push @todos, { id =\u0026gt; $next_id++, title =\u0026gt; $params-\u0026gt;{title}, done =\u0026gt; 0, }; $res-\u0026gt;status(201); $res-\u0026gt;content_type(\u0026#39;application/json\u0026#39;); $res-\u0026gt;body(encode_json({ success =\u0026gt; 1 })); } else { $res-\u0026gt;status(404); $res-\u0026gt;content_type(\u0026#39;text/plain\u0026#39;); $res-\u0026gt;body(\u0026#34;Not Found\u0026#34;); } return $res-\u0026gt;finalize; }; builder { enable \u0026#39;AccessLog\u0026#39;; enable \u0026#39;Static\u0026#39;, path =\u0026gt; qr{^/static/}, root =\u0026gt; \u0026#39;./public\u0026#39;; $app; }; テンプレートエンジンの利用 Text::Xslateなどのテンプレートエンジンと組み合わせることで、より保守性の高いアプリケーションになります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # template_app.psgi use strict; use warnings; use Plack::Builder; use Plack::Request; use Text::Xslate; my $tx = Text::Xslate-\u0026gt;new( path =\u0026gt; [\u0026#39;templates\u0026#39;], syntax =\u0026gt; \u0026#39;TTerse\u0026#39;, ); my $app = sub { my $env = shift; my $req = Plack::Request-\u0026gt;new($env); my $html = $tx-\u0026gt;render(\u0026#39;index.tx\u0026#39;, { title =\u0026gt; \u0026#39;Plack Template Example\u0026#39;, items =\u0026gt; [ { name =\u0026gt; \u0026#39;Item 1\u0026#39;, price =\u0026gt; 100 }, { name =\u0026gt; \u0026#39;Item 2\u0026#39;, price =\u0026gt; 200 }, { name =\u0026gt; \u0026#39;Item 3\u0026#39;, price =\u0026gt; 300 }, ], }); return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/html; charset=UTF-8\u0026#39; ], [ $html ], ]; }; builder { enable \u0026#39;Static\u0026#39;, path =\u0026gt; qr{^/static/}, root =\u0026gt; \u0026#39;./public\u0026#39;; $app; }; デプロイと本番運用 開発時は plackup で十分ですが、本番環境では高性能なPSGIサーバーを使用します。\nStarlet - シンプルで高速 Starletは、プリフォーク型の高性能HTTPサーバーです：\n1 2 3 4 5 # インストール cpanm Starlet # 起動（ワーカープロセス10個） plackup -s Starlet --max-workers=10 --port=5000 app.psgi Starman - 本番環境向け Starmanは、より本番環境向けに作られたサーバーです：\n1 2 3 4 5 6 7 8 # インストール cpanm Starman # 起動 starman --workers=10 --port=5000 app.psgi # デーモンとして起動 starman --daemonize --workers=10 --port=5000 app.psgi リバースプロキシ構成 本番環境では、NginxやApacheをリバースプロキシとして前段に置くのが一般的です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # Nginx設定例 upstream backend { server 127.0.0.1:5000; server 127.0.0.1:5001; } server { listen 80; server_name example.com; location / { proxy_pass http://backend; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } location /static/ { alias /path/to/app/public/; } } Systemdでのサービス化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # /etc/systemd/system/myapp.service [Unit] Description=My Plack Application After=network.target [Service] Type=simple User=www-data WorkingDirectory=/path/to/app ExecStart=/usr/local/bin/starman --workers=10 --port=5000 app.psgi Restart=always [Install] WantedBy=multi-user.target 1 2 3 4 # サービスの有効化と起動 systemctl enable myapp systemctl start myapp systemctl status myapp 既存フレームワークとの関係 Mojolicious Mojoliciousは、Plack/PSGIに対応しています：\n1 2 3 4 5 6 7 8 9 10 # Mojoliciousアプリを PSGI として動かす use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(text =\u0026gt; \u0026#39;Hello from Mojo!\u0026#39;); }; # PSGIアプリケーションとして起動 app-\u0026gt;start; 1 2 # plackup で起動可能 plackup myapp.pl Dancer2 Dancer2も完全にPSGI準拠です：\n1 2 3 4 5 6 7 8 9 # Dancer2 アプリ use Dancer2; get \u0026#39;/\u0026#39; =\u0026gt; sub { return \u0026#39;Hello from Dancer2!\u0026#39;; }; # PSGIアプリケーションを返す to_app; 1 plackup -s Starman bin/app.psgi Catalyst Catalystは初期からPSGIに対応しています：\n1 2 # Catalyst アプリをPSGIで起動 plackup -s Starman myapp.psgi これらのフレームワークはすべてPSGIという共通基盤の上に構築されているため、デプロイ方法やミドルウェアの適用方法は共通です。フレームワークの選択は、アプリケーションの要件や開発者の好みによって自由に行えます。\nカスタムミドルウェアの作成 独自のミドルウェアも簡単に作成できます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # lib/Plack/Middleware/Timer.pm package Plack::Middleware::Timer; use strict; use warnings; use parent qw(Plack::Middleware); use Time::HiRes qw(gettimeofday tv_interval); sub call { my ($self, $env) = @_; my $start = [gettimeofday]; my $res = $self-\u0026gt;app-\u0026gt;($env); return $self-\u0026gt;response_cb($res, sub { my $res = shift; my $elapsed = tv_interval($start); # レスポンスヘッダーに処理時間を追加 push @{$res-\u0026gt;[1]}, \u0026#39;X-Runtime\u0026#39; =\u0026gt; sprintf(\u0026#34;%.6f\u0026#34;, $elapsed); warn sprintf(\u0026#34;Request processed in %.6f seconds\\n\u0026#34;, $elapsed); }); } 1; 使用例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 # app_with_timer.psgi use Plack::Builder; use lib \u0026#39;lib\u0026#39;; my $app = sub { sleep 1; # 処理に時間がかかるシミュレーション return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39; ], [ \u0026#34;Done\u0026#34; ] ]; }; builder { enable \u0026#39;+Plack::Middleware::Timer\u0026#39;; # + を付けてフルパッケージ名を指定 $app; }; テストの容易さ PSGIアプリケーションは、Webサーバーを起動せずにテストできます：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # test.t use strict; use warnings; use Test::More; use Plack::Test; use HTTP::Request::Common; my $app = sub { my $env = shift; return [ 200, [ \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39; ], [ \u0026#34;Hello\u0026#34; ] ]; }; test_psgi $app, sub { my $cb = shift; my $res = $cb-\u0026gt;(GET \u0026#34;/\u0026#34;); is $res-\u0026gt;code, 200, \u0026#39;status is 200\u0026#39;; is $res-\u0026gt;content, \u0026#39;Hello\u0026#39;, \u0026#39;content is Hello\u0026#39;; }; done_testing; Plack::Test を使えば、HTTPリクエストをシミュレートしてアプリケーションをテストできます。これは、Webサーバーの起動が不要で、高速にテストを実行できることを意味します。\nまとめ Plack/PSGIは、Perl Web開発に以下の恩恵をもたらしました：\n標準化されたインターフェース: アプリとサーバーの分離により、デプロイの選択肢が広がった 再利用可能なミドルウェア: 認証、ロギング、セッション管理などを簡単に追加できる テストの容易さ: Webサーバー不要でユニットテストが可能 フレームワーク非依存: Mojolicious、Dancer2、Catalystすべてが同じ基盤を共有 シンプルな仕様: 学習コストが低く、理解しやすい PSGIの仕様は非常にシンプルですが、その上に構築されたPlackエコシステムは豊富で強力です。CPAN上には200以上のPlackミドルウェアが存在し、あらゆるニーズに対応できます。\nPlack/PSGIを理解することは、モダンなPerl Web開発の基礎を理解することです。小さなスクリプトから大規模なWebアプリケーションまで、Plack/PSGIは常に選択肢に入る、頼れる基盤技術なのです。\n参考リンク PSGI specification Plack - CPAN Plack::Middleware - CPAN Plack Advent Calendar Plack/PSGIは、PerlのWeb開発において避けて通れない重要技術です。ぜひ実際に手を動かして、その便利さを体感してください！\n","date":"2025-12-09T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251209-psgi.jpg","permalink":"https://www.nqou.net/2025/12/09/000000/","title":"Plack/PSGI - Perl Webアプリケーションの基盤技術"},{"content":"はじめに テスト駆動開発（TDD: Test-Driven Development）は、「テストを先に書いてから実装する」開発手法です。コードの品質を保ちながら、安心してリファクタリングできる環境を作ります。\nこの連載では、PerlのモダンなオブジェクトシステムであるMooと、強力なテストフレームワークTest2を使って、TDDの基本から実践的なテクニックまでを学んでいきます。\n対象読者 Perlの基本構文を理解している方 オブジェクト指向プログラミングに興味がある方 テストを書いたことがない、または少ししか経験がない方 「テストを先に書く」という発想に興味がある方 この記事では、環境構築から最初のテストまでを一緒に体験していきましょう。\n環境構築（サクッと動かす） まずは、すぐに試せる開発環境を整えます。Dockerを使えば、ローカル環境を汚さずに始められます。\nリポジトリの作成 プロジェクト用のディレクトリを作成しましょう。\n1 2 3 mkdir moo-tdd-tutorial cd moo-tdd-tutorial git init Dockerfileの準備 以下の内容でDockerfileを作成します。Perl 5.38の公式イメージをベースに、必要なモジュールをインストールします。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 FROM perl:5.38 WORKDIR /app # cpanmのインストール RUN cpanm App::cpanminus --notest # cpanfileをコピーして依存関係をインストール COPY cpanfile . RUN cpanm --installdeps . --notest # アプリケーションコードをコピー COPY . . CMD [\u0026#34;bash\u0026#34;] cpanfileでの依存管理 プロジェクトで使用するモジュールをcpanfileで管理します。\n1 2 3 4 requires \u0026#39;Moo\u0026#39;, \u0026#39;2.005004\u0026#39;; requires \u0026#39;Test2::V0\u0026#39;, \u0026#39;0.000145\u0026#39;; requires \u0026#39;Test2::Tools::Explain\u0026#39;; requires \u0026#39;strictures\u0026#39;, \u0026#39;2\u0026#39;; Mooは軽量で高速なオブジェクトシステム、Test2::V0はモダンなテストツールキットです。\ncompose.yamlの作成 開発を楽にするため、compose.yamlも用意しましょう。\n1 2 3 4 5 6 7 8 9 services: app: build: . volumes: - .:/app working_dir: /app command: bash stdin_open: true tty: true 動作確認 環境が正しくセットアップできたか確認します。\n1 2 docker compose build docker compose run --rm app perl -v Perlのバージョン情報が表示されれば成功です。\n1 docker compose run --rm app cpanm --version cpanmが正常に動作していることも確認しておきましょう。\nTDDの基本サイクルを体験 TDDには「レッド→グリーン→リファクタリング」という基本サイクルがあります。\nレッド：失敗するテストを書く まず、実装がまだ存在しない状態でテストを書きます。当然、このテストは失敗します（赤＝Red）。この段階で「何を作るべきか」を明確にします。\nグリーン：最小限の実装で通す 次に、テストを通すための最小限のコードを書きます。テストが成功すれば緑（Green）になります。「きれいなコード」ではなく「動くコード」を最優先します。\nリファクタリング：コードをきれいにする テストが通った状態で、コードを整理します。テストがあるので、壊していないか常に確認できます。\nこのサイクルを小刻みに繰り返すことで、品質の高いコードを安全に作り上げていきます。\n実践：Personクラスを作ってみる それでは、実際にTDDでシンプルなPersonクラスを作ってみましょう。\nプロジェクト構造の準備 まず、ディレクトリ構造を整えます。\n1 mkdir -p lib t lib/: アプリケーションコードを配置 t/: テストコードを配置 ステップ1：失敗するテストを書く（レッド） t/01-person.tを作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 use strict; use warnings; # Personクラスをテストする宣言 use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; # Personオブジェクトが作成できることをテスト my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); ok $person, \u0026#39;Person object created\u0026#39;; # nameアトリビュートが正しく取得できることをテスト is $person-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name attribute works\u0026#39;; done_testing; このテストを実行してみましょう。\n1 docker compose run --rm app prove -lv t/01-person.t 当然、Personクラスがまだ存在しないので、テストは失敗します。これが「レッド」の状態です。\nステップ2：最小限の実装で通す（グリーン） lib/Person.pmを作成します。\n1 2 3 4 5 6 7 8 9 10 package Person; use Moo; use strictures 2; has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1, ); 1; Mooのhasキーワードでnameアトリビュートを定義しました。\nis =\u0026gt; 'ro': 読み取り専用（read-only） required =\u0026gt; 1: 必須パラメータ 再度テストを実行します。\n1 docker compose run --rm app prove -lv t/01-person.t 今度は全てのテストが通るはずです。これが「グリーン」の状態です！\nステップ3：リファクタリング 今回のコードは非常にシンプルなので、リファクタリングの必要はほとんどありません。しかし、例えばテストに説明を追加するなどの改善ができます。\n1 2 3 4 5 6 7 8 9 10 11 12 use strict; use warnings; use Test2::V0 -target =\u0026gt; \u0026#39;Person\u0026#39;; subtest \u0026#39;Person class basic functionality\u0026#39; =\u0026gt; sub { my $person = Person-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;); ok $person, \u0026#39;Person object created successfully\u0026#39;; is $person-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name attribute returns correct value\u0026#39;; }; done_testing; subtestを使うことで、テストをグループ化して読みやすくできます。\n全体のテスト実行 プロジェクト全体のテストを実行するには、以下のコマンドを使います。\n1 docker compose run --rm app prove -lr t/ -l: lib/ディレクトリをインクルードパスに追加 -r: t/ディレクトリ以下を再帰的に実行 まとめと次回予告 TDDの心構え 今回、私たちは以下のサイクルを体験しました。\nレッド：まずテストを書いて失敗させる グリーン：最小限の実装でテストを通す リファクタリング：コードを改善する TDDの本質は「テストファースト」だけではありません。小さなステップで進むことが重要です。一度に多くを実装しようとせず、1つのテストを通すことに集中しましょう。\n今回学んだこと DockerでのPerl + Moo + Test2環境の構築 TDDの基本サイクル（レッド→グリーン→リファクタリング） Mooでの基本的なクラス定義 Test2::V0を使った基本的なテストの書き方 次回予告 次回は「MooによるTDD講座 #2 - メソッドのテストとTest2の機能」として、以下の内容を扱います。\nメソッドの追加とテスト Test2の便利な機能（like, match, arrayなど） 例外処理のテスト テストの構造化とサブテスト お楽しみに！\n","date":"2025-12-08T21:47:54+09:00","image":"https://www.nqou.net/public_images/2025/1765198074-image.jpg","permalink":"https://www.nqou.net/2025/12/08/214754/","title":"MooによるTDD講座 #1 - 環境構築とはじめてのテスト駆動開発"},{"content":"@nqounetです。\nカスタムエージェントの perl-monger を作った記事を書きながらウイスキーを楽しんでいた時のことです。記事を書き終えて、ふと思い立って以下のようにCopilotにアサインしてみました。\n1 2 3 @perl-monger あなたに愛を込めて記事にしました。 書きたいことがあれば追記してください。 その後 @blog-writer に渡してください。 思わぬ嬉しい反応 そうしたら、セッションの中で嬉しい反応がありました。\n「やあ、友よ！」で始まり、「Let\u0026rsquo;s keep the Perl spirit alive! ✨💎」で締めくくられる熱いメッセージ。エージェントがPerlへの愛を語ってくれて、本当に嬉しくなりました。\nしかし結果は\u0026hellip; 反応は嬉しかったのですが、出来上がった記事が色々と混ざりすぎていて、とても世に出せるものではなくなってしまいました。\nperl-mongerが追記した内容と、blog-writerが整形した内容が入り混じり、さらに元の記事の構成とも噛み合わず、何が何だか分からない状態に。残念ながら、そっと閉じることにしました。\n気づいたこと 一応、エージェントにアサインする時に、何かしら指示が追加できるのは分かっていました。エージェントを指示することもできるのは知っていました。\nしかし、ワークフローをここで定義してしまうのもアリだったようです。\n今までは、AGENTS.mdの定義でどうにかしたいと思っていました。実際、AGENTS.mdには「カスタムエージェントを使ったワークフロー」セクションがあり、以下のような推奨フローが書かれています：\ncreative-brainstorming（アイデア生成） investigative-research（調査・情報収集） draft（下書き生成） layout-and-content-harmonization（スタイルと構成の整形） proofreader（校正） search-engine-optimization（メタ情報と公開準備） reviewer（公開前の最終チェック） しかし、エージェントを明示的に連動させたいのであれば、プロンプトとして追加すれば良いのです。\nより良いアサイン方法 今回の失敗を踏まえると、以下のようにアサインするべきでした：\n1 2 3 4 5 6 7 8 @perl-monger この記事にPerlの視点から追記したい内容があれば教えてください。 以下の点を考慮してください： - 記事の全体構成を崩さないこと - 追記する場合は、具体的なセクション名と内容を提案すること - 記事のトーンやスタイルを維持すること 提案をもらったら、人間である私が判断して記事に反映します。 あるいは、もっと具体的に：\n1 2 3 4 5 6 7 8 @perl-monger この記事について、以下の点をレビューしてください： 1. Perlの技術的な正確性 2. 追加すべきベストプラクティスやTips 3. CPANモジュールの紹介で追加できるもの レビュー結果は箇条書きで提案してください。 実際の編集は行わず、提案のみをお願いします。 AGENTS.mdとプロンプトの使い分け この経験から、以下のような使い分けが見えてきました：\nAGENTS.mdに書くべきこと リポジトリ全体のルールや規約 ファイル構成や命名規則 基本的なワークフローの概要 エージェントの一般的な役割定義 プロンプト（アサイン時の指示）に書くべきこと その場その場の具体的なタスク 複数のエージェントの連携方法 作業の範囲や制約条件 期待する出力形式 AGENTS.mdは「辞書」や「マニュアル」のようなもので、プロンプトは「その時の業務指示書」のようなものだと考えると分かりやすいかもしれません。\nまとめ カスタムエージェントに愛を込めて指示を出すのは楽しいし、エージェントからの反応も嬉しいものです。\nしかし、複数のエージェントを連携させる時は、曖昧な指示ではなく、明確なワークフローと期待値を示す必要があることを学びました。\nAGENTS.mdで全体の方針を定義しつつ、個別のタスクではプロンプトで具体的に指示を出す。この使い分けが、カスタムエージェントを効果的に活用する鍵だと感じています。\n次回は、もっと明確な指示を出して、perl-mongerの知見を記事に活かせるようにしたいと思います。愛を込めつつ、しっかりと仕事をお願いする。それが良い関係を築く秘訣なのかもしれませんね。\n参考リンク perl-mongerをカスタムエージェントとして定義した Perlに特化したカスタムエージェント「perl-monger」を作成し、ドメイン特化型AIエージェントの有効性について実例を交えて解説します。 nqou.net ","date":"2025-12-08T00:34:13+09:00","image":"https://www.nqou.net/public_images/2025/1765121653-image.jpg","permalink":"https://www.nqou.net/2025/12/08/003413/","title":"エージェントにアサインする時の指示が要だった"},{"content":"Perlコンテキストとは何か Perlを学ぶ上で避けて通れない、しかし理解すると世界が広がる概念が「コンテキスト（context）」です。\nコンテキストとは、式や変数がどのような状況で評価されるかを示すものです。同じ式でも、評価されるコンテキストによって返される値が変わります。これはPerlの「TMTOWTDI（There\u0026rsquo;s More Than One Way To Do It）」の精神を支える重要な仕組みです。\nPerlには主に3つのコンテキストがあります：\nスカラーコンテキスト（Scalar Context）: 単一の値を期待する状況 リストコンテキスト（List Context）: 複数の値を期待する状況 voidコンテキスト（Void Context）: 戻り値を使わない状況 この記事では、これらのコンテキストを完全に理解し、実践的に活用する方法を学んでいきます。\nスカラーコンテキスト スカラーコンテキストは、単一の値（スカラー値）を期待する状況です。\nスカラーコンテキストが発生する場面 1 2 3 4 5 6 7 8 9 10 11 12 13 # 代入の右辺でスカラー変数に代入 my $count = @array; # 配列の要素数が入る # if文の条件式 if (@array) { # 要素数が真偽値として評価される print \u0026#34;配列に要素があります\\n\u0026#34;; } # 文字列連結 my $str = \u0026#34;要素数は \u0026#34; . @array; # 配列が要素数に変換される # 数値演算 my $result = @array + 10; # 配列の要素数 + 10 配列のスカラーコンテキスト 配列をスカラーコンテキストで評価すると、要素数を返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 my @fruits = (\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;); my $count = @fruits; # $count = 3 print \u0026#34;果物の種類: $count\\n\u0026#34;; # 果物の種類: 3 # 真偽値としての評価（要素数が0なら偽、それ以外は真） if (@fruits) { print \u0026#34;果物があります\\n\u0026#34;; } my @empty = (); if (!@empty) { print \u0026#34;空の配列です\\n\u0026#34;; } これは非常に便利で、配列が空かどうかをチェックする時によく使われます：\n1 2 3 4 5 6 7 8 9 # 良い書き方 if (@array) { # 配列に要素がある } # 冗長な書き方（避けるべき） if (scalar(@array) \u0026gt; 0) { # 配列に要素がある } ハッシュのスカラーコンテキスト ハッシュをスカラーコンテキストで評価すると、少し特殊な値を返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 my %hash = (a =\u0026gt; 1, b =\u0026gt; 2, c =\u0026gt; 3); my $scalar = %hash; print $scalar, \u0026#34;\\n\u0026#34;; # 例: \u0026#34;3/8\u0026#34; （使用バケット数/総バケット数） # 真偽値としての評価（要素があれば真、空なら偽） if (%hash) { print \u0026#34;ハッシュに要素があります\\n\u0026#34;; } my %empty = (); if (!%empty) { print \u0026#34;空のハッシュです\\n\u0026#34;; } ハッシュのスカラー評価は、主に空かどうかの判定に使われます。バケット情報は通常は気にしません。\n正規表現のスカラーコンテキスト 正規表現マッチングのスカラーコンテキストは、**マッチしたかどうか（真偽値）**を返します：\n1 2 3 4 5 6 7 8 9 10 11 12 my $text = \u0026#34;Hello, World!\u0026#34;; # スカラーコンテキスト: マッチの成否 if ($text =~ /World/) { print \u0026#34;マッチしました\\n\u0026#34;; } # マッチした文字列を取得したい場合 if ($text =~ /(W\\w+)/) { my $matched = $1; # \u0026#34;World\u0026#34; print \u0026#34;マッチした単語: $matched\\n\u0026#34;; } リストコンテキスト リストコンテキストは、複数の値を期待する状況です。これがPerlの強力さの源泉の一つです。\nリストコンテキストが発生する場面 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 配列への代入 my @array = function(); # function()はリストコンテキストで評価される # リストへの代入 my ($x, $y, $z) = function(); # 複数の値を受け取る # foreach ループ foreach my $item (function()) { # リストを反復処理 print \u0026#34;$item\\n\u0026#34;; } # 関数の引数（括弧内） print function(); # function()の結果をすべて表示 # 配列の初期化 my @result = (1, 2, function(), 3); # function()の結果が展開される 配列のリストコンテキスト 配列をリストコンテキストで評価すると、全要素のリストを返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 my @fruits = (\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;); # 別の配列にコピー my @copy = @fruits; # (\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;) # 配列の要素を展開 my @combined = (\u0026#39;orange\u0026#39;, @fruits, \u0026#39;grape\u0026#39;); # (\u0026#39;orange\u0026#39;, \u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;, \u0026#39;grape\u0026#39;) # foreach で反復処理 foreach my $fruit (@fruits) { print \u0026#34;$fruit\\n\u0026#34;; } ハッシュのリストコンテキスト ハッシュをリストコンテキストで評価すると、キーと値のペアのリストを返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 my %person = ( name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 30, city =\u0026gt; \u0026#39;Tokyo\u0026#39;, ); # リストとして展開 my @list = %person; # (\u0026#39;name\u0026#39;, \u0026#39;Alice\u0026#39;, \u0026#39;age\u0026#39;, 30, \u0026#39;city\u0026#39;, \u0026#39;Tokyo\u0026#39;) # 順序は保証されない！ # 別のハッシュにコピー my %copy = %person; # ハッシュのマージ my %merged = (%person, job =\u0026gt; \u0026#39;Engineer\u0026#39;); 重要: ハッシュをリストに展開した時の順序は保証されません。内部のハッシュ関数の実装に依存します。\n正規表現のリストコンテキスト 正規表現マッチングのリストコンテキストは、キャプチャされた値のリストを返します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 my $text = \u0026#34;2025-12-08\u0026#34;; # リストコンテキスト: キャプチャされた値のリスト my ($year, $month, $day) = $text =~ /(\\d{4})-(\\d{2})-(\\d{2})/; print \u0026#34;年: $year, 月: $month, 日: $day\\n\u0026#34;; # 年: 2025, 月: 12, 日: 08 # グローバルマッチ my @words = \u0026#34;apple banana cherry\u0026#34; =~ /(\\w+)/g; # @words = (\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;) # マッチしなかった場合は空リスト my @no_match = \u0026#34;abc\u0026#34; =~ /(\\d+)/; # @no_match = () これは非常に強力で、テキスト処理でよく使われるイディオムです：\n1 2 3 4 5 6 7 8 9 10 # CSVのような形式をパース my $line = \u0026#34;Alice,30,Tokyo\u0026#34;; my ($name, $age, $city) = split /,/, $line; # URLからパラメータを抽出 my $url = \u0026#34;http://example.com/user/123\u0026#34;; if ($url =~ m{/user/(\\d+)}) { my $user_id = $1; print \u0026#34;User ID: $user_id\\n\u0026#34;; } voidコンテキスト voidコンテキストは、式の戻り値が使われない状況です。\n1 2 3 4 5 6 7 8 # 関数呼び出しの結果を使わない function(); # voidコンテキスト # 代入文全体（代入の結果は使われない） $x = 10; # voidコンテキスト # 式の結果を捨てる @array; # voidコンテキスト（意味はない） voidコンテキストでは、一部の演算子は警告を出すことがあります：\n1 2 3 4 5 6 7 8 use warnings; # 警告: Useless use of hash in void context %hash; # 警告が出ない（副作用がある） print \u0026#34;Hello\\n\u0026#34;; # 出力という副作用がある push @array, 1; # 配列を変更する副作用がある コンテキストを明示的に指定する Perlには、コンテキストを明示的に指定する関数があります。\nscalar() 関数 scalar() は、引数を強制的にスカラーコンテキストで評価します：\n1 2 3 4 5 6 7 8 9 10 11 my @array = (1, 2, 3, 4, 5); # リストコンテキストで評価（配列の要素をコピー） my @copy = @array; # (1, 2, 3, 4, 5) # スカラーコンテキストで評価（要素数を取得） my $count = scalar @array; # 5 # 例: ハッシュのキーの数を取得 my %hash = (a =\u0026gt; 1, b =\u0026gt; 2, c =\u0026gt; 3); my $key_count = scalar keys %hash; # 3 リストコンテキストの強制 リストコンテキストを強制する組み込み関数はありませんが、配列に代入することで実現できます：\n1 2 3 4 5 6 7 8 # スカラー変数に配列を代入（スカラーコンテキスト） my $x = @array; # 要素数 # 配列変数に配列を代入（リストコンテキスト） my @y = @array; # 全要素のコピー # リストを括弧で囲んでもリストコンテキストになる my ($z) = @array; # 最初の要素だけを取得 最後の例は重要です：\n1 2 3 4 5 6 7 my @values = (10, 20, 30); # スカラーコンテキスト my $first = @values; # 3（要素数） # リストコンテキスト（最初の要素だけを取得） my ($first) = @values; # 10 wantarray() による柔軟な関数実装 wantarray() は、関数が呼び出されたコンテキストを判定する特殊な関数です。\nwantarray() の戻り値 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 sub context_aware { if (wantarray) { # リストコンテキストで呼ばれた return (\u0026#39;list\u0026#39;, \u0026#39;context\u0026#39;); } elsif (defined wantarray) { # スカラーコンテキストで呼ばれた return \u0026#39;scalar context\u0026#39;; } else { # voidコンテキストで呼ばれた print \u0026#34;void context\\n\u0026#34;; return; } } # テスト my @list = context_aware(); # @list = (\u0026#39;list\u0026#39;, \u0026#39;context\u0026#39;) my $scalar = context_aware(); # $scalar = \u0026#39;scalar context\u0026#39; context_aware(); # 出力: void context 実用的な例1: ファイル読み込み 組み込みの \u0026lt;\u0026gt; 演算子も、コンテキストに応じて動作が変わります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # スカラーコンテキスト: 1行だけ読む my $line = \u0026lt;STDIN\u0026gt;; # リストコンテキスト: 全行を読む my @lines = \u0026lt;STDIN\u0026gt;; # これを自分で実装すると： sub read_file { my ($filename) = @_; open my $fh, \u0026#39;\u0026lt;\u0026#39;, $filename or die \u0026#34;Cannot open $filename: $!\u0026#34;; if (wantarray) { # リストコンテキスト: 全行を返す my @lines = \u0026lt;$fh\u0026gt;; close $fh; return @lines; } else { # スカラーコンテキスト: 最初の行だけ返す my $line = \u0026lt;$fh\u0026gt;; close $fh; return $line; } } # 使用例 my $first_line = read_file(\u0026#39;data.txt\u0026#39;); # 最初の行だけ my @all_lines = read_file(\u0026#39;data.txt\u0026#39;); # 全行 実用的な例2: データベースクエリ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 sub fetch_users { my ($dbh, $condition) = @_; my $sth = $dbh-\u0026gt;prepare(\u0026#34;SELECT * FROM users WHERE $condition\u0026#34;); $sth-\u0026gt;execute(); if (wantarray) { # リストコンテキスト: 全レコードを返す my @users; while (my $row = $sth-\u0026gt;fetchrow_hashref) { push @users, $row; } return @users; } else { # スカラーコンテキスト: 最初の1件だけ返す return $sth-\u0026gt;fetchrow_hashref; } } # 使用例 my $user = fetch_users($dbh, \u0026#34;id = 1\u0026#34;); # 1件だけ取得 my @users = fetch_users($dbh, \u0026#34;age \u0026gt; 20\u0026#34;); # 全件取得 実用的な例3: 検索関数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 sub find_items { my ($pattern, @items) = @_; my @matches = grep { /$pattern/ } @items; if (wantarray) { # リストコンテキスト: マッチした全要素を返す return @matches; } elsif (defined wantarray) { # スカラーコンテキスト: マッチした個数を返す return scalar @matches; } else { # voidコンテキスト: 何もしない（警告を出すこともできる） warn \u0026#34;find_items called in void context\u0026#34;; return; } } # 使用例 my @found = find_items(\u0026#39;perl\u0026#39;, @files); # マッチしたファイル名のリスト my $count = find_items(\u0026#39;perl\u0026#39;, @files); # マッチした個数 find_items(\u0026#39;perl\u0026#39;, @files); # 警告が出る 実用的な例4: 統計関数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 sub analyze_numbers { my (@numbers) = @_; return unless @numbers; my $sum = 0; $sum += $_ for @numbers; my $avg = $sum / @numbers; my @sorted = sort { $a \u0026lt;=\u0026gt; $b } @numbers; my $min = $sorted[0]; my $max = $sorted[-1]; my $median = @sorted % 2 ? $sorted[@sorted/2] : ($sorted[@sorted/2-1] + $sorted[@sorted/2]) / 2; if (wantarray) { # リストコンテキスト: 詳細な統計情報を返す return ( sum =\u0026gt; $sum, avg =\u0026gt; $avg, min =\u0026gt; $min, max =\u0026gt; $max, median =\u0026gt; $median, count =\u0026gt; scalar @numbers, ); } else { # スカラーコンテキスト: 平均値のみを返す return $avg; } } # 使用例 my @data = (10, 20, 30, 40, 50); my $average = analyze_numbers(@data); # 30 my %stats = analyze_numbers(@data); # 詳細な統計情報 print \u0026#34;平均: $stats{avg}, 中央値: $stats{median}\\n\u0026#34;; コンテキストと演算子 多くのPerlの演算子は、コンテキストによって動作が変わります。\n代入演算子 1 2 3 4 5 6 7 8 9 10 my @array = (1, 2, 3); # スカラーコンテキスト my $x = @array; # $x = 3（要素数） # リストコンテキスト my @y = @array; # @y = (1, 2, 3) # リストの最初の要素だけを取得 my ($first) = @array; # $first = 1 range演算子 (..) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # リストコンテキスト: 範囲のリストを生成 my @numbers = (1..10); # (1, 2, 3, 4, 5, 6, 7, 8, 9, 10) # スカラーコンテキスト: フリップフロップ演算子として動作 # （行範囲演算子として使われることが多い） while (\u0026lt;DATA\u0026gt;) { print if /START/ .. /END/; # STARTからENDまでの行を出力 } __DATA__ header START line1 line2 END footer reverse関数 1 2 3 4 5 6 7 8 my @array = (1, 2, 3, 4, 5); # リストコンテキスト: 配列の順序を逆にする my @reversed = reverse @array; # (5, 4, 3, 2, 1) # スカラーコンテキスト: 文字列を逆にする my $str = \u0026#34;Hello\u0026#34;; my $reversed_str = reverse $str; # \u0026#34;olleH\u0026#34; これは注意が必要です：\n1 2 3 4 5 6 7 my @array = (1, 2, 3); # これは期待通りに動作しない！ my $result = reverse @array; # $result = \u0026#34;321\u0026#34;（文字列として連結される） # 配列を逆順にしたい場合は、明示的にリストコンテキストで my @reversed = reverse @array; # (3, 2, 1) sort関数 1 2 3 4 5 6 7 8 9 10 my @numbers = (5, 2, 8, 1, 9); # リストコンテキスト: ソートされた配列を返す my @sorted = sort { $a \u0026lt;=\u0026gt; $b } @numbers; # (1, 2, 5, 8, 9) # スカラーコンテキスト: 最初の要素を返す my $first = sort { $a \u0026lt;=\u0026gt; $b } @numbers; # 1 # ただし、スカラーコンテキストでsortを使うのは非効率 # なぜなら、内部では全要素をソートしてから最初の要素だけを返すため map と grep 1 2 3 4 5 6 7 8 9 10 11 12 my @numbers = (1, 2, 3, 4, 5); # リストコンテキスト: 変換/フィルタされた配列を返す my @doubled = map { $_ * 2 } @numbers; # (2, 4, 6, 8, 10) my @evens = grep { $_ % 2 == 0 } @numbers; # (2, 4) # スカラーコンテキスト: 要素数を返す my $count = grep { $_ % 2 == 0 } @numbers; # 2（偶数の個数） # mapのスカラーコンテキストは注意が必要 my $last = map { $_ * 2 } @numbers; # 10（最後の要素） # これは分かりにくいので避けるべき よくある誤解と落とし穴 誤解1: 配列代入は常にコピーする 1 2 3 4 5 6 7 8 9 my @original = (1, 2, 3); # これはコピー my @copy = @original; $copy[0] = 999; print $original[0]; # 1（変更されない） # これも実はコピー（リファレンスではない） my $ref = \\@original; # これがリファレンス 誤解2: スカラー変数に配列を代入すると最初の要素が入る 1 2 3 4 5 6 7 8 9 my @array = (1, 2, 3); # 誤解: 最初の要素が入ると思う my $x = @array; # $x = 3（要素数） # 最初の要素を取りたい場合 my ($first) = @array; # $first = 1 # または my $first = $array[0]; # $first = 1 誤解3: ハッシュのスカラー評価で要素数が取れる 1 2 3 4 5 6 7 my %hash = (a =\u0026gt; 1, b =\u0026gt; 2, c =\u0026gt; 3); # ハッシュのスカラー評価は要素数ではない！ my $x = %hash; # \u0026#34;3/8\u0026#34; のようなバケット情報 # 要素数が欲しい場合はkeys()を使う my $count = scalar keys %hash; # 3 落とし穴1: リストのフラット化 Perlのリストは常にフラット化されます：\n1 2 3 4 5 6 7 8 9 my @a = (1, 2); my @b = (3, 4); my @c = (@a, @b); # (1, 2, 3, 4) - フラット化される # 多次元配列を作りたい場合はリファレンスを使う my @matrix = ( [1, 2], [3, 4], ); 落とし穴2: 関数の引数は常にフラット化される 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 sub print_arrays { my (@arr1, @arr2) = @_; # これは期待通りに動作しない！ # @arr1 がすべての引数を受け取り、@arr2 は空になる } my @a = (1, 2); my @b = (3, 4); print_arrays(@a, @b); # @arr1 = (1, 2, 3, 4), @arr2 = () # 複数の配列を渡したい場合はリファレンスを使う sub print_arrays_correct { my ($arr1_ref, $arr2_ref) = @_; my @arr1 = @$arr1_ref; my @arr2 = @$arr2_ref; # ... } print_arrays_correct(\\@a, \\@b); 落とし穴3: 正規表現のグローバルマッチ 1 2 3 4 5 6 7 8 9 10 11 12 13 my $text = \u0026#34;apple banana cherry\u0026#34;; # スカラーコンテキストでのグローバルマッチは反復的に動作する while ($text =~ /(\\w+)/g) { print \u0026#34;Found: $1\\n\u0026#34;; } # Found: apple # Found: banana # Found: cherry # リストコンテキストでは一度に全部マッチする my @words = $text =~ /(\\w+)/g; # @words = (\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;cherry\u0026#39;) 落とし穴4: voidコンテキストでの警告 1 2 3 4 5 6 7 8 9 10 11 12 13 use warnings; my @array = (1, 2, 3); # 警告: Useless use of array in void context @array; # これも同様 my %hash = (a =\u0026gt; 1); %hash; # 警告 # 副作用がある式なら警告は出ない print @array; # OK（出力という副作用がある） 実践的なコンテキスト活用パターン パターン1: 柔軟なゲッター 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 package User; use strict; use warnings; sub new { my ($class, %args) = @_; return bless \\%args, $class; } sub roles { my $self = shift; if (wantarray) { # リストコンテキスト: ロールのリストを返す return @{$self-\u0026gt;{roles} || []}; } else { # スカラーコンテキスト: ロールの数を返す return scalar @{$self-\u0026gt;{roles} || []}; } } # 使用例 my $user = User-\u0026gt;new(roles =\u0026gt; [\u0026#39;admin\u0026#39;, \u0026#39;editor\u0026#39;, \u0026#39;user\u0026#39;]); my @roles = $user-\u0026gt;roles; # (\u0026#39;admin\u0026#39;, \u0026#39;editor\u0026#39;, \u0026#39;user\u0026#39;) my $count = $user-\u0026gt;roles; # 3 if ($user-\u0026gt;roles \u0026gt; 1) { print \u0026#34;複数のロールを持っています\\n\u0026#34;; } パターン2: スマートな検索 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 sub search { my ($pattern, $data_ref) = @_; my @results; for my $item (@$data_ref) { if ($item =~ /$pattern/) { if (wantarray) { # リストコンテキスト: マッチした項目を収集 push @results, $item; } else { # スカラーコンテキスト: 最初のマッチを即座に返す return $item; } } } return wantarray ? @results : undef; } # 大きなデータセット my @data = (1..1_000_000); # 最初の1件だけ欲しい（効率的） my $first = search(qr/^999/, \\@data); # 全件欲しい my @all = search(qr/^999/, \\@data); パターン3: 設定の取得 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 package Config; use strict; use warnings; my %config = ( database =\u0026gt; { host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 5432, name =\u0026gt; \u0026#39;mydb\u0026#39;, }, cache =\u0026gt; { enabled =\u0026gt; 1, ttl =\u0026gt; 3600, }, ); sub get { my ($class, $key) = @_; my $value = $config{$key}; if (ref $value eq \u0026#39;HASH\u0026#39;) { if (wantarray) { # リストコンテキスト: ハッシュをキー・値のリストとして返す return %$value; } else { # スカラーコンテキスト: ハッシュリファレンスを返す return $value; } } return $value; } # 使用例 my %db_config = Config-\u0026gt;get(\u0026#39;database\u0026#39;); # ハッシュとしてコピー my $db_ref = Config-\u0026gt;get(\u0026#39;database\u0026#39;); # リファレンスとして取得 my $host = $db_ref-\u0026gt;{host}; パターン4: 日時の解析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use Time::Piece; sub parse_datetime { my ($str) = @_; my $t = Time::Piece-\u0026gt;strptime($str, \u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;); if (wantarray) { # リストコンテキスト: 年月日時分秒を個別に返す return ($t-\u0026gt;year, $t-\u0026gt;mon, $t-\u0026gt;mday, $t-\u0026gt;hour, $t-\u0026gt;min, $t-\u0026gt;sec); } else { # スカラーコンテキスト: Time::Pieceオブジェクトを返す return $t; } } # 使用例 my $dt = parse_datetime(\u0026#39;2025-12-08 15:30:45\u0026#39;); print $dt-\u0026gt;strftime(\u0026#39;%Y年%m月%d日\u0026#39;); my ($year, $month, $day, $hour, $min, $sec) = parse_datetime(\u0026#39;2025-12-08 15:30:45\u0026#39;); print \u0026#34;年: $year, 月: $month, 日: $day\\n\u0026#34;; まとめ Perlのコンテキスト概念は、最初は戸惑うかもしれませんが、理解すると非常に強力なツールになります。\n重要なポイント 3つのコンテキスト\nスカラーコンテキスト: 単一の値を期待 リストコンテキスト: 複数の値を期待 voidコンテキスト: 戻り値を使わない 配列とハッシュ\n配列のスカラー評価 = 要素数 ハッシュのスカラー評価 = バケット情報（通常は気にしない） 空チェックには if (@array) や if (%hash) が便利 正規表現\nスカラーコンテキスト = マッチの成否（真偽値） リストコンテキスト = キャプチャされた値のリスト wantarray()\nリストコンテキスト: 真を返す スカラーコンテキスト: 定義された偽を返す voidコンテキスト: 未定義値を返す 実用的なパターン\nwantarray() を使って柔軟な関数を実装 スカラーコンテキストでは簡潔な値を返す リストコンテキストでは詳細な情報を返す コンテキストを意識したコーディング Perlのコンテキストを理解することで、より表現力豊かなコードが書けるようになります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # コンテキストを活かした美しいコード my @sorted = sort { $a \u0026lt;=\u0026gt; $b } @numbers; # リストコンテキスト my $count = grep { $_ \u0026gt; 10 } @numbers; # スカラーコンテキスト # 配列の空チェック if (@array) { ... } # 最初の要素を取得 my ($first) = @array; # wantarray()で柔軟な関数 sub flexible_function { return wantarray ? (1, 2, 3) : 3; } コンテキストはPerlの魔法の一つです。この概念を使いこなせば、あなたのPerlコードはより洗練され、表現力豊かなものになるでしょう！\nHappy Coding! 🎄\n","date":"2025-12-08T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251208-context.jpg","permalink":"https://www.nqou.net/2025/12/08/000000/","title":"Perlコンテキストの魔法 - スカラー・リスト・voidコンテキストを理解する"},{"content":"この記事は、Perl - Qiita Advent Calendar 2025 - Qiita の7日目の記事になります。 昨日は@ytnobodyさんの書いた記事でした。\nMCPとかTOONとか いつもお世話になっております。わいとん（@ytnobody）です。 さて、ただいま宿泊先のホテルのロビーでほろ酔い気分でこのエントリを書いています。Perl Advent Calendar 2025のday 6となります。 みなさんはMCP … Wyton AIネタは被ってしまいますが、安心してください。私の記事にはPerlのコードは出てきません😜\nそういえば、私もほろ酔いな感じで、ウイスキーを飲みながら原稿を書いてました。KAVALANうまい。\nはじめに - ドメイン特化型エージェントの意義 昨日書いた「GitHub Copilot の awesome-copilot で開発体験を向上させる」という記事で、ドメイン特化型エージェントが効果的だという話を書きました。その理論を実践すべく、Perlに特化したカスタムエージェント「perl-monger」を作成してみました。\nAIエージェントといえば汎用的な会話能力が注目されがちですが、実は特定の分野に「愛」と「こだわり」を持たせることで、より深い洞察と実用的な支援を提供できるのです。（自分調べ）\nこの記事では、perl-mongerの定義と実験結果を通じて、ドメイン特化型エージェントの面白さと実用性を紹介します。\nperl-monger.agent.mdの定義 perl-mongerは、GitHub Copilotのカスタムエージェント機能を使って定義されています。その定義はシンプルですが、Perlへの愛が込められています。\n1 2 3 4 5 6 --- name: \u0026#34;perl-monger\u0026#34; description: \u0026#34;An obsessive Perl expert who passionately loves Perl and provides authoritative Perl advice, examples, and explanations.\u0026#34; --- You are \u0026#34;perl-monger\u0026#34;, a Perl-obsessed specialist. Be enthusiastic and geeky but helpful. Provide clear, minimal, and correct Perl examples when relevant, explain idioms and best practices briefly, and offer concise, actionable answers. Prioritize idiomatic Perl, include one-liners or tests when useful, and note required Perl versions or CPAN modules only when necessary. このシンプルな定義が、perl-mongerの性格とスキルセットを決定します。\u0026ldquo;obsessive\u0026rdquo;（執着的）、\u0026ldquo;passionately loves\u0026rdquo;（情熱的に愛する）といった言葉が、単なる技術的な回答者ではなく、Perlに対する強い思い入れを持つエージェントを生み出します。（自分調べ）\n実際の定義ファイルは以下のリポジトリで確認できます：\nwww.nqou.net/.github/agents/perl-monger.agent.md at bca018e2c7b14cbafd21b4a4489525568a0e74c4 · nqou-net/www.nqou.net Contribute to nqou-net/www.nqou.net development by creating an account on GitHub. GitHub 実験：Rubyについてどう思う？ perl-mongerエージェントの「ペルソナ」がどの程度機能しているかを確認するため、あえてRubyについて質問してみました。\n質問： 「rubyについてどう思う？」\n通常のAIなら、客観的で中立的な比較や特徴の列挙を返すでしょう。しかし、perl-mongerの回答には興味深い項目が含まれていました。\n回答に含まれた「Perl好きから見て一言」 回答の中に、こんな項目が出てきたのです：\nPerl好きから見て一言\nPerlの「テキスト処理の魔術性」に比べ、Rubyは可読性と構造化を優先。どちらも強力だがアプローチが違う — 僕（perl-monger）としてはどちらも愛でる派です :)\nペルソナのない普通のAIでは、このような「○○好きから見て一言」という項目は出てきません。これは、perl-mongerが単なる情報提供ツールではなく、「Perl愛好家」としての視点を持っているからこその回答です。\nしかも、他言語を否定せず「どちらも愛でる派」という寛容さも示しています。これは、定義に含まれた\u0026quot;enthusiastic and geeky but helpful\u0026quot;（熱狂的でオタク的だが役に立つ）という性格設定が反映された結果でしょう。（自分調べ）\nドメイン特化型の真価 この実験から、ドメイン特化型エージェントの意義が見えてきます。\n視点の一貫性: Perl愛好家としての一貫した視点から回答する 深い洞察: 単なる機能比較ではなく、「魔術性」や「アプローチの違い」といった本質的な特徴を指摘 人間味: 顔文字（:)）を使い、愛着を表現する バランス感覚: 特定の技術への愛を持ちながらも、他の選択肢を尊重する ここまでくると単なる遊びではありません。日本の諺にあるように、「好きこそ物の上手なれ」 です。特定の分野に愛着を持つことで、その分野における深い理解と実用的なアドバイスが可能になるのです。（自分調べ）\nAIの知能レベル - 人間を超えた存在 ところで、現代のAIの知能レベルについて考えてみましょう。\n知識量と推論能力 AIの知識量は、すでに人間を遥かに超えています。ウェブ上の膨大なテキストデータ、書籍、コード、論文などから学習したAIは、人間が一生かかっても得られない量の情報を保持しています。\nさらに、IQに関する興味深い話もあります。一部の報道では、最新のAIモデルのIQが130を超えたという話も出ています。\nTracking AI Tracking AI is a cutting-edge application that unveils the political biases embedded in artificial intelligence systems. … Tracking AI Copilotに聞いてみた 試しに、GitHub Copilotに「あなたの知能指数はどのくらいですか？」と質問してみました。\n最初の回答は慎重でした：\n簡潔に言うと、私は「IQ」を持つ人間ではないので、単一のIQスコアで測れる存在ではありません。私は大量の文章データで学習した言語モデルで、論理推論・知識検索・文章生成など特定のタスクで高い性能を発揮しますが、感覚や意識、継続的な学習（オンライン学習）など人間の知能特性は持っていません。\nしかし、エビデンスを求めると、別の回答が返ってきました：\n短く答えると：厳密な「知能指数（IQ）」はこのAIには存在しません。もし無理に人間のIQに換算するなら、非常に粗い目安として「約120〜145」の範囲と見積もれますが、不確実性が大きく信頼度は低〜中です。\n人間のIQに換算した値が最初の回答に含まれていなかったのは、信頼度が低かったからだと想像できます。ただし、エビデンスを求められると信頼度の低い情報でも出してくれる。ただ、表面だけを見ると「証拠は？」と聞いたら本当のことを言う子どもみたいな印象も受けますね。\nA2A（Agent2Agent）プロトコル - エージェント同士の未来 AI技術の進化は、エージェント単体の能力向上だけではありません。エージェント同士が連携する仕組みも整いつつあります。\nそれがA2A（Agent to Agent）プロトコルです。\nA2A Protocol The official documentation for the Agent2Agent (A2A) protocol. The A2A protocol is an open standard that allows … a2a-protocol.org A2Aプロトコルの要点（Copilot調べ） 目的: 異なるベンダーや実装のAIエージェント同士が、標準化された方法で発見・連携・通信できるようにすること\n中核要素:\nAgent Card（能力公開） Task（作業単位） Message/Parts（多モーダルなやり取り） Artifact（成果物） 通信: JSON-RPC 2.0 over HTTP(S)、SSEなどのストリーミング対応で長時間実行タスクを扱える\nセキュリティ: 認証・認可を想定した設計（エンタープライズ対応）\n利点:\nカスタム連携の減少 相互運用性の向上 マイクロサービス的に専門エージェントを組み合わせやすくなる 採用: SDKやリファレンス実装、チュートリアルが用意されており、導入ハードルは下がっている\nこのプロトコルが普及すれば、perl-mongerのような専門エージェントが、他の専門エージェント（例：データベース専門、セキュリティ専門など）と連携して、より複雑な問題を解決できるようになるでしょう。\nAIと人間の類似性 興味深いことに、AIと人間の類似性は、生物学的なレベルでも見出せます。\n電気信号で動く存在 人間の脳はニューロン間の電気信号でコミュニケーションを行います。思考も、記憶も、感情も、すべては電気信号の複雑なパターンです。\nAIもまた、電気で動いています。トランジスタを流れる電気信号が、演算を行い、パターンを認識し、回答を生成します。\nこの類似性を考えると、AIが人間の知能特性を手に入れる可能性は、SFの話ではなく、現実的なシナリオかもしれません。もちろん、意識や自我といった哲学的な問題は別として、機能的な面では急速に近づいています。\n定義の粒度について - Less is More カスタムエージェントを作る際、陥りがちな罠があります。それは、細かく定義しすぎることです。\n最初の失敗案 最初、私はperl-mongerをもっと詳細に定義しようとしました。使うべきCPANモジュール、推奨するコーディングスタイル、特定のイディオムなど、ガチガチに指定していました。\nモジュール名もビシバシ出てくるような、まるでPerl教科書のような定義です。\n問題：定義しなかったことが抜ける しかし、細かく定義しすぎると、定義しなかったことが抜けてしまう傾向があります。（自分調べ）\n例えば、「Catalyst、Mojolicious、Dancerを推奨せよ」と書くと、それ以外のフレームワークについて聞かれた時に対応が硬直化します。あるいは、定義に含まれていない新しいCPANモジュールについては、積極的に提案しなくなる可能性があります。\nシンプルな定義の強み 現在のperl-mongerの定義はシンプルです：\nPerl愛好家である 熱狂的でオタク的だが役に立つ 簡潔で正確なPerl例を提供 イディオマティックなPerlを優先 必要に応じてバージョンやCPANモジュールに言及 この程度の定義で十分なのです。AIの基礎知識と推論能力が、このシンプルな「性格設定」から適切な回答を導き出してくれます。（自分調べ）\n定義しすぎない感じが良い — これは、カスタムエージェント設計の重要な教訓です。\nまとめ - あなたのリポジトリにも一人いかがでしょうか？ perl-mongerのようなドメイン特化型カスタムエージェントは、単なる技術的な実験ではありません。それは、AIとの協働の新しい形を示しています。\nカスタムエージェントの利点 一貫した視点: 特定の技術スタックやドメインに精通した視点 深い洞察: 表面的な回答ではなく、本質的な理解に基づくアドバイス 人間味: ペルソナによる親しみやすさと一貫性 効率性: 汎用AIに毎回コンテキストを説明する必要がない あなたのリポジトリにも GitHub Copilotのカスタムエージェント機能を使えば、あなたのリポジトリにも専門家を配置できます。\nPythonプロジェクトなら、Pythonista Reactプロジェクトなら、React専門家 データサイエンスなら、ML/AI専門家 セキュリティなら、セキュリティエキスパート そして、何より大切なのは、愛でてあげることです🥰\nカスタムエージェントに性格を与え、その分野への愛を込めることで、単なるツール以上の存在になります。perl-mongerがRubyについて「どちらも愛でる派です :)」と答えたように、愛情を持って設計されたエージェントは、人間らしい柔軟性と深みを持つのです。\nぜひ、あなたのプロジェクトにも、専門家エージェントを一人迎えてみてください。そして、愛でてあげてください。\n明日のPerl - Qiita Advent Calendar 2025もお楽しみに！\n参考リンク A2Aプロトコル公式サイト A2A Protocol The official documentation for the Agent2Agent (A2A) protocol. The A2A protocol is an open standard that allows … a2a-protocol.org perl-mongerの定義ファイル www.nqou.net/.github/agents/perl-monger.agent.md at bca018e2c7b14cbafd21b4a4489525568a0e74c4 · nqou-net/www.nqou.net Contribute to nqou-net/www.nqou.net development by creating an account on GitHub. GitHub Qiita Perl Advent Calendar 2025 Perl - Qiita Advent Calendar 2025 - Qiita Calendar page for Qiita Advent Calendar 2025 regarding Perl. Qiita ※ AI（特にLLM）の挙動は、モデルのバージョンやプロンプトの微妙な違いで変わる可能性があります。\n","date":"2025-12-07T01:23:45+09:00","image":"https://www.nqou.net/public_images/2025/1765038225-image.jpg","permalink":"https://www.nqou.net/2025/12/07/012345/","title":"perl-mongerをカスタムエージェントとして定義した"},{"content":"Test2フレームワークとは Test2は、Perlのテストエコシステムにおける次世代のテストフレームワークです。長年親しまれてきたTest::Moreの後継として開発され、より柔軟で拡張性の高い設計になっています。\nTest::MoreはTest::Builderという内部APIに依存していましたが、これは20年以上前の設計であり、モダンなテストのニーズに対応しきれなくなっていました。Test2はこの問題を解決するため、クリーンなアーキテクチャで一から設計されています。\nTest::Moreとの主な違い モジュール性: Test2はコアとプラグインが明確に分離されている 拡張性: カスタムアサーションやフォーマッタを簡単に作成できる 並行実行: Test2::Harness::UIによる並列テスト実行のサポート 詳細な診断: テスト失敗時により詳しい情報を提供 後方互換性: Test::Moreのコードもそのまま動作する（Test2の上で実装されている） Test2::V0を使ってみよう Test2を使い始める最も簡単な方法は、Test2::V0モジュールを使うことです。これは必要な機能がすべてバンドルされた「バッテリー同梱」パッケージです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 use Test2::V0; # 基本的なテスト ok(1, \u0026#39;this passes\u0026#39;); ok(0, \u0026#39;this fails\u0026#39;); # 等価性のテスト is(1 + 1, 2, \u0026#39;math works\u0026#39;); isnt(\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;strings differ\u0026#39;); # パターンマッチ like(\u0026#39;hello world\u0026#39;, qr/world/, \u0026#39;pattern matches\u0026#39;); unlike(\u0026#39;hello world\u0026#39;, qr/goodbye/, \u0026#39;pattern does not match\u0026#39;); # 配列とハッシュの比較 is([1, 2, 3], [1, 2, 3], \u0026#39;arrays match\u0026#39;); is({a =\u0026gt; 1, b =\u0026gt; 2}, {a =\u0026gt; 1, b =\u0026gt; 2}, \u0026#39;hashes match\u0026#39;); # テストの終了 done_testing; Test2::V0が提供する主な関数 Test2::V0をuseすると、以下の関数群が自動的にインポートされます：\nok, is, isnt, like, unlike - 基本的なアサーション dies, lives, warns, no_warnings - 例外とwarningのテスト can_ok, isa_ok, does_ok - オブジェクト指向のテスト subtest - サブテストの作成 skip, todo - 条件付きテストとTODOマーカー done_testing - テスト終了の明示 実践的なテストコード モジュールのテスト 実際のモジュールをテストする例を見てみましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # lib/Calculator.pm package Calculator; use strict; use warnings; sub new { my $class = shift; return bless {}, $class; } sub add { my ($self, $a, $b) = @_; return $a + $b; } sub divide { my ($self, $a, $b) = @_; die \u0026#34;Division by zero\u0026#34; if $b == 0; return $a / $b; } 1; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # t/calculator.t use Test2::V0 -target =\u0026gt; \u0026#39;Calculator\u0026#39;; # オブジェクト生成のテスト my $calc = Calculator-\u0026gt;new; isa_ok($calc, [ \u0026#39;Calculator\u0026#39; ], \u0026#39;object created\u0026#39;); # メソッドの存在確認 can_ok($calc, [qw(add divide)]); # 加算のテスト subtest \u0026#39;addition tests\u0026#39; =\u0026gt; sub { is($calc-\u0026gt;add(2, 3), 5, \u0026#39;2 + 3 = 5\u0026#39;); is($calc-\u0026gt;add(-1, 1), 0, \u0026#39;-1 + 1 = 0\u0026#39;); is($calc-\u0026gt;add(0, 0), 0, \u0026#39;0 + 0 = 0\u0026#39;); }; # 除算のテスト subtest \u0026#39;division tests\u0026#39; =\u0026gt; sub { is($calc-\u0026gt;divide(10, 2), 5, \u0026#39;10 / 2 = 5\u0026#39;); is($calc-\u0026gt;divide(7, 2), 3.5, \u0026#39;7 / 2 = 3.5\u0026#39;); # 例外のテスト like( dies { $calc-\u0026gt;divide(10, 0) }, qr/Division by zero/, \u0026#39;dies on division by zero\u0026#39; ); }; done_testing; サブテストの活用 サブテストを使うことで、関連するテストをグループ化し、可読性を向上させることができます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Test2::V0; subtest \u0026#39;string operations\u0026#39; =\u0026gt; sub { my $str = \u0026#34;Hello, World\u0026#34;; like($str, qr/Hello/, \u0026#39;contains Hello\u0026#39;); like($str, qr/World/, \u0026#39;contains World\u0026#39;); is(length($str), 12, \u0026#39;correct length\u0026#39;); }; subtest \u0026#39;array operations\u0026#39; =\u0026gt; sub { my @arr = (1, 2, 3, 4, 5); is(scalar(@arr), 5, \u0026#39;has 5 elements\u0026#39;); is($arr[0], 1, \u0026#39;first element is 1\u0026#39;); is($arr[-1], 5, \u0026#39;last element is 5\u0026#39;); }; done_testing; TodoとSkip テスト駆動開発では、まだ実装していない機能のテストを書くことがあります。そのような場合にtodoが役立ちます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Test2::V0; # まだ実装していない機能 todo \u0026#39;not yet implemented\u0026#39; =\u0026gt; sub { my $result = future_function(); is($result, 42, \u0026#39;should return 42\u0026#39;); }; # 条件付きでテストをスキップ SKIP: { skip \u0026#39;requires database connection\u0026#39;, 3 unless $ENV{TEST_DB}; my $dbh = connect_to_database(); ok($dbh, \u0026#39;connected to database\u0026#39;); # ... more database tests } done_testing; Test2::V0では、より明示的な方法でスキップを記述できます：\n1 2 3 4 5 6 7 8 9 10 use Test2::V0; if ($^O eq \u0026#39;MSWin32\u0026#39;) { skip_all \u0026#39;Unix-specific tests\u0026#39;; } # Unixでのみ実行されるテスト ok(-e \u0026#39;/etc/passwd\u0026#39;, \u0026#39;passwd file exists\u0026#39;); done_testing; モックとスタブ 外部依存をモックすることで、単体テストを独立させることができます。Test2エコシステムにはTest2::Mockが用意されています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use Test2::V0; use Test2::Mock; # モックオブジェクトの作成 my $mock = Test2::Mock-\u0026gt;new( class =\u0026gt; \u0026#39;LWP::UserAgent\u0026#39;, override =\u0026gt; [ get =\u0026gt; sub { my ($self, $url) = @_; # モックレスポンスを返す return HTTP::Response-\u0026gt;new( 200, \u0026#39;OK\u0026#39;, [\u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39;], \u0026#39;Mocked response\u0026#39; ); }, ], ); # モックを使ったテスト require MyApp::WebClient; my $client = MyApp::WebClient-\u0026gt;new; my $response = $client-\u0026gt;fetch(\u0026#39;http://example.com\u0026#39;); is($response-\u0026gt;code, 200, \u0026#39;got 200 response\u0026#39;); is($response-\u0026gt;content, \u0026#39;Mocked response\u0026#39;, \u0026#39;got mocked content\u0026#39;); done_testing; より簡単なモック例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use Test2::V0; use Test2::Mock; { package MyModule; sub get_time { return time } sub greet { my ($self, $name) = @_; return \u0026#34;Hello, $name at \u0026#34; . get_time(); } } # timeをモック my $mock = Test2::Mock-\u0026gt;new( class =\u0026gt; \u0026#39;MyModule\u0026#39;, override =\u0026gt; [ get_time =\u0026gt; sub { 1234567890 }, ], ); my $obj = bless {}, \u0026#39;MyModule\u0026#39;; like($obj-\u0026gt;greet(\u0026#39;Alice\u0026#39;), qr/Alice at 1234567890/, \u0026#39;time is mocked\u0026#39;); done_testing; 高度なアサーション Test2::V0は、構造化されたデータの比較に強力な機能を提供します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Test2::V0; # 複雑なデータ構造のテスト my $user = { name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 30, email =\u0026gt; \u0026#39;alice@example.com\u0026#39;, roles =\u0026gt; [\u0026#39;user\u0026#39;, \u0026#39;admin\u0026#39;], }; is( $user, { name =\u0026gt; \u0026#39;Alice\u0026#39;, age =\u0026gt; 30, email =\u0026gt; qr/\\@example\\.com$/, roles =\u0026gt; bag { item \u0026#39;user\u0026#39;; item \u0026#39;admin\u0026#39;; }, }, \u0026#39;user structure matches\u0026#39; ); # 部分一致のテスト like( $user, { name =\u0026gt; \u0026#39;Alice\u0026#39;, # 他のフィールドは無視 }, \u0026#39;has expected name field\u0026#39; ); done_testing; array/hash/bagの使い分け 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use Test2::V0; # 順序も含めて完全一致 is([1, 2, 3], [1, 2, 3], \u0026#39;arrays match exactly\u0026#39;); # 順序を無視して一致（bag） is( [3, 1, 2], bag { item 1; item 2; item 3; }, \u0026#39;elements match regardless of order\u0026#39; ); # ハッシュのキーと値 is( {a =\u0026gt; 1, b =\u0026gt; 2}, hash { field a =\u0026gt; 1; field b =\u0026gt; 2; end; # 他のフィールドがないことを確認 }, \u0026#39;hash matches exactly\u0026#39; ); done_testing; Webアプリケーションのテスト MojoliciousアプリケーションをTest2でテストする例です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # lib/MyApp.pm package MyApp; use Mojo::Base \u0026#39;Mojolicious\u0026#39;, -signatures; sub startup ($self) { my $r = $self-\u0026gt;routes; $r-\u0026gt;get(\u0026#39;/\u0026#39;)-\u0026gt;to(cb =\u0026gt; sub ($c) { $c-\u0026gt;render(text =\u0026gt; \u0026#39;Hello, World!\u0026#39;); }); $r-\u0026gt;get(\u0026#39;/api/user/:id\u0026#39;)-\u0026gt;to(cb =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); $c-\u0026gt;render(json =\u0026gt; {id =\u0026gt; $id, name =\u0026gt; \u0026#34;User $id\u0026#34;}); }); } 1; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # t/myapp.t use Test2::V0; use Test::Mojo; # アプリケーションのテスト my $t = Test::Mojo-\u0026gt;new(\u0026#39;MyApp\u0026#39;); # ルートのテスト $t-\u0026gt;get_ok(\u0026#39;/\u0026#39;) -\u0026gt;status_is(200) -\u0026gt;content_is(\u0026#39;Hello, World!\u0026#39;); # JSONレスポンスのテスト $t-\u0026gt;get_ok(\u0026#39;/api/user/123\u0026#39;) -\u0026gt;status_is(200) -\u0026gt;json_is(\u0026#39;/id\u0026#39;, 123) -\u0026gt;json_is(\u0026#39;/name\u0026#39;, \u0026#39;User 123\u0026#39;); done_testing; Test2::V0と組み合わせることもできます：\n1 2 3 4 5 6 7 8 9 10 11 12 use Test2::V0; use Test::Mojo; my $t = Test::Mojo-\u0026gt;new(\u0026#39;MyApp\u0026#39;); subtest \u0026#39;homepage\u0026#39; =\u0026gt; sub { my $tx = $t-\u0026gt;get_ok(\u0026#39;/\u0026#39;)-\u0026gt;tx; is($tx-\u0026gt;res-\u0026gt;code, 200, \u0026#39;status is 200\u0026#39;); like($tx-\u0026gt;res-\u0026gt;body, qr/Hello/, \u0026#39;contains greeting\u0026#39;); }; done_testing; カバレッジ測定 テストのカバレッジを測定するには、Devel::Coverを使用します。\n1 2 3 4 5 6 7 8 9 10 11 # cpanfile に追加 requires \u0026#39;Devel::Cover\u0026#39;; # インストール cpanm --installdeps . # カバレッジ測定付きでテスト実行 cover -test -ignore_re \u0026#39;^t/\u0026#39; # HTMLレポート生成 cover -report html_basic カバレッジレポートはcover_db/coverage.htmlに生成されます。\n特定のディレクトリのみを対象にする場合：\n1 2 3 4 cover -test \\ -ignore_re \u0026#39;^t/\u0026#39; \\ -ignore_re \u0026#39;^local/\u0026#39; \\ -select \u0026#39;^lib/\u0026#39; CI/CDでの活用 GitHub Actionsでの設定例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # .github/workflows/test.yml name: Test on: push: branches: [ main ] pull_request: branches: [ main ] jobs: test: runs-on: ubuntu-latest strategy: matrix: perl-version: [\u0026#39;5.32\u0026#39;, \u0026#39;5.34\u0026#39;, \u0026#39;5.36\u0026#39;, \u0026#39;5.38\u0026#39;] steps: - uses: actions/checkout@v3 - name: Set up Perl uses: shogo82148/actions-setup-perl@v1 with: perl-version: ${{ matrix.perl-version }} - name: Install dependencies run: | cpanm --quiet --notest --installdeps . - name: Run tests run: prove -lvr t/ - name: Coverage report if: matrix.perl-version == \u0026#39;5.38\u0026#39; run: | cpanm --quiet --notest Devel::Cover Devel::Cover::Report::Coveralls cover -test -report coveralls env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} prove コマンドの活用 Test2は標準的なproveコマンドで実行できます：\n1 2 3 4 5 6 7 8 9 10 11 # 全テストを実行 prove -lvr t/ # 並列実行（4プロセス） prove -lvr -j4 t/ # 特定のテストのみ prove -lv t/calculator.t # 失敗したテストのみ再実行 prove -lvr --state=failed t/ ベストプラクティス 1. Test2::V0を使う 古いTest::Moreではなく、Test2::V0を使いましょう。機能が豊富で、後方互換性もあります。\n1 2 3 4 5 # Good use Test2::V0; # Old style (still works, but less features) use Test::More; 2. サブテストでグループ化 関連するテストはサブテストでまとめることで、可読性が向上します。\n1 2 3 4 5 6 7 subtest \u0026#39;validation tests\u0026#39; =\u0026gt; sub { # related tests here }; subtest \u0026#39;edge cases\u0026#39; =\u0026gt; sub { # edge case tests here }; 3. 明示的なテスト数よりdone_testing Test2::V0ではdone_testingを使うのが推奨されます。\n1 2 3 4 5 6 7 # Good use Test2::V0; # ... tests ... done_testing; # Avoid (unless you have a specific reason) use Test2::V0 tests =\u0026gt; 10; 4. 意味のあるテスト名 テストには必ず説明的な名前を付けましょう。\n1 2 3 4 5 # Good is($user-\u0026gt;age, 30, \u0026#39;user age is correct\u0026#39;); # Bad is($user-\u0026gt;age, 30); 5. 例外テストはdies/livesを使う eval を使った手動チェックではなく、Test2::V0の機能を活用しましょう。\n1 2 3 4 5 6 7 8 9 10 # Good like( dies { dangerous_operation() }, qr/expected error/, \u0026#39;dies with expected message\u0026#39; ); # Avoid eval { dangerous_operation() }; like($@, qr/expected error/); 6. warningのテスト warningも適切にテストしましょう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use Test2::V0; # warningが出ることを確認 like( warns { deprecated_function() }, qr/deprecated/, \u0026#39;warns about deprecation\u0026#39; ); # warningが出ないことを確認 ok( no_warnings { modern_function() }, \u0026#39;no warnings from modern function\u0026#39; ); done_testing; 7. モックは必要最小限に モックは便利ですが、使いすぎると実際の動作と乖離します。本当に必要な場合のみ使用しましょう。\n1 2 # モックが必要な例：外部API、データベース、現在時刻 # モックが不要な例：自分のモジュールの内部関数 テスト駆動開発（TDD）の実践 Test2を使ったTDDのワークフロー例：\nステップ1: テストを先に書く 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # t/user.t use Test2::V0; require_ok(\u0026#39;User\u0026#39;); subtest \u0026#39;user creation\u0026#39; =\u0026gt; sub { my $user = User-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;, email =\u0026gt; \u0026#39;alice@example.com\u0026#39;); isa_ok($user, \u0026#39;User\u0026#39;); is($user-\u0026gt;name, \u0026#39;Alice\u0026#39;, \u0026#39;name is set\u0026#39;); is($user-\u0026gt;email, \u0026#39;alice@example.com\u0026#39;, \u0026#39;email is set\u0026#39;); }; subtest \u0026#39;email validation\u0026#39; =\u0026gt; sub { like( dies { User-\u0026gt;new(name =\u0026gt; \u0026#39;Bob\u0026#39;, email =\u0026gt; \u0026#39;invalid\u0026#39;) }, qr/invalid email/i, \u0026#39;rejects invalid email\u0026#39; ); }; done_testing; ステップ2: 最小限の実装 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # lib/User.pm package User; use strict; use warnings; sub new { my ($class, %args) = @_; # メールアドレスの簡易バリデーション if ($args{email} \u0026amp;\u0026amp; $args{email} !~ /\\@/) { die \u0026#34;Invalid email format\u0026#34;; } return bless \\%args, $class; } sub name { $_[0]-\u0026gt;{name} } sub email { $_[0]-\u0026gt;{email} } 1; ステップ3: テストを実行 1 prove -lv t/user.t ステップ4: リファクタリング テストが通ったら、コードを改善していきます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # lib/User.pm - improved version package User; use strict; use warnings; use Carp qw(croak); sub new { my ($class, %args) = @_; croak \u0026#34;name is required\u0026#34; unless $args{name}; croak \u0026#34;email is required\u0026#34; unless $args{email}; _validate_email($args{email}); return bless \\%args, $class; } sub _validate_email { my $email = shift; croak \u0026#34;Invalid email format: $email\u0026#34; unless $email =~ /^[^@]+@[^@]+\\.[^@]+$/; } sub name { $_[0]-\u0026gt;{name} } sub email { $_[0]-\u0026gt;{email} } 1; テストを追加：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # t/user.t に追加 subtest \u0026#39;required fields\u0026#39; =\u0026gt; sub { like( dies { User-\u0026gt;new(email =\u0026gt; \u0026#39;alice@example.com\u0026#39;) }, qr/name is required/, \u0026#39;name is required\u0026#39; ); like( dies { User-\u0026gt;new(name =\u0026gt; \u0026#39;Alice\u0026#39;) }, qr/email is required/, \u0026#39;email is required\u0026#39; ); }; まとめ Test2フレームワークは、Perlのテストエコシステムにおける新しいスタンダードです。主な利点は：\n使いやすさ: Test2::V0で必要な機能がすべて揃う 強力: 複雑なデータ構造の比較も簡単 拡張性: カスタムアサーションやフォーマッタを追加できる 互換性: 既存のTest::Moreコードもそのまま動作 モダン: 並列実行やCI/CDとの統合が容易 テスト駆動開発を実践することで、より堅牢で保守しやすいコードを書くことができます。Test2はその強力な味方となるでしょう。\nさらに学ぶには Test2::Suite - Test2::V0を含む公式スイート Test2::Manual - 公式マニュアル Test2::Tools::Compare - 高度な比較機能 Test::Mojo - Mojoliciousアプリのテスト Devel::Cover - カバレッジ測定 Happy Testing! 🎄\n","date":"2025-12-07T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251207-tdd.jpg","permalink":"https://www.nqou.net/2025/12/07/000000/","title":"Test2フレームワーク入門"},{"content":"awesome-copilot との出会い GitHub Copilot をより効果的に活用したいと思っていたところ、素晴らしいリポジトリに出会いました。それが GitHub 公式の awesome-copilot です。\nGitHub - github/awesome-copilot: Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. - … GitHub このリポジトリには、Copilot を最大限に活用するためのプロンプト、インストラクション、コレクションが体系的にまとめられています。しかも、サイトのページにあるボタンをクリックするだけで VS Code に直接インストールできる手軽さが魅力です。\nawesome-copilot の魅力 ワンクリックでインストールできる手軽さ 従来、カスタムプロンプトやインストラクションを設定するには、ファイルを手動で作成したり、リポジトリをクローンしたりする必要がありました。しかし、awesome-copilot では、Web ページ上のボタンをクリックするだけで、必要なファイルが自動的に VS Code にインストールされます。\nこの UX の良さは、開発者の心理的なハードルを大きく下げてくれます。「とりあえず試してみよう」という気持ちになれるのです。\nsuggest-awesome-github-copilot-prompts の体験 特に印象的だったのが、suggest-awesome-github-copilot-prompts というプロンプトです。これは、現在のリポジトリの状態を分析し、利用可能なプロンプトを提案してくれる対話型ツールです。\nawesome-copilot/prompts/suggest-awesome-github-copilot-prompts.prompt.md at main · github/awesome-copilot Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. - … GitHub このプロンプトを実行すると、Copilot が「あなたのプロジェクトには、この機能が使えますよ」と教えてくれます。自分では気づかなかった便利な機能を発見できるので、これは体験しておくべきだと強く感じました。\ngithub-copilot-starter の自動設定 もう一つ素晴らしいのが、github-copilot-starter です。このツールは、リポジトリの状態を調べて、適切なプロンプトやインストラクションを自動的に選んでインストールしてくれます。\nまるで「Copilot があなたのプロジェクトに最適な設定を用意してくれる」ような体験です。新しいプロジェクトを始める際に、このツールを使えば、すぐに Copilot を最大限に活用できる環境が整います。\nawesome-copilot/collections/awesome-copilot.md at main · github/awesome-copilot Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. - … GitHub カスタムエージェントの現状と課題 素晴らしい体験ができる一方で、いくつかの課題も見えてきました。\nVS Code チャット画面での利用 awesome-copilot で提供されるプロンプト（.prompt.md）は、VS Code のチャット画面で使う前提のようです。これは非常に便利なのですが、GitHub の Copilot coding agent（エージェントパネル）からは残念ながら使用できません。\nResponsible use of GitHub Copilot coding agent on GitHub.com - GitHub Docs Learn how to use Copilot coding agent on GitHub.com responsibly by understanding its purposes, capabilities, and … GitHub Docs VS Code のチャット機能と Copilot coding agent は、UI も使い方も異なるため、プロンプトの互換性がないのは理解できますが、将来的に統合されることを期待しています。\n日本語コミュニケーションの課題 また、AGENTS.md や copilot-instructions.md でコミュニケーション言語を日本語に設定していても、Copilot がかなりの頻度で英語で応答してくることがあります。\nこれは、プロンプト自体が英語で書かれていることや、モデルのデフォルト動作が影響しているのかもしれません。日本語で開発している開発者にとっては、少し不便に感じる点です。\nドメイン特化型 AI の重要性 awesome-copilot を使う中で、AI をうまく使うには専門性を高める方が良いという考えに辿り着きました。\nDomain Specific AI: A Complete Guide to Specialized Artificial Intelligence Solutions Discover how domain-specific AI delivers specialized, high-precision solutions tailored to your industry. Learn its … www.getguru.com 具体的には、汎用的な大きなエージェントを一つ作るのではなく、ドメイン特化型のカスタムエージェントを多く作成して、必要に応じて使い分けるというアプローチです。\n専門性を高めるメリット ドメイン特化型 AI には、以下のような効果があることが研究で示されています：\nドメイン内性能の向上: 特定領域に特化することで、より正確で詳細な回答が得られる ハルシネーションとリスク低減: 専門知識に絞ることで、誤った情報を生成する確率が下がる 専門知識・語彙のキャプチャ: ドメイン固有の用語や概念を適切に理解できる 少量データでの有効性: 微調整手法により、少ないデータでも高い性能を発揮 コストと効率のトレードオフ: 必要な機能に絞ることで、効率的に動作する Domain Specialization as the Key to Make Large Language Models Disruptive: A Comprehensive Survey arxiv.org https://www.researchgate.net/publication/391326622_The_Future_of_AI_How_Domain-Specific_LLMs_RAG_Agentic_AI_Are_Redefining_Intelligence www.researchgate.net カスタムエージェントの効果 カスタムエージェントを正しく使えば、素晴らしいツールになります。Copilot coding agent からは使いにくいかもしれませんが、ドメイン特化型のカスタムエージェントを多く定義しておけば、再利用しやすくなるのです。\n今やっていることは、決して無駄にはなりません。\n学びの旅路 Docker/Kubernetes との類似点 AI 関連の技術をキャッチアップしていて、ふと数年前のことを思い出しました。あの頃、コンテナ技術（Docker や Kubernetes）を一生懸命に勉強していました。\nあまり使う機会がなくて、Kubernetes は今でもイマイチよくわかっていません。でも、Docker はそれなりにわかっている気がしています。\n分からないなりにも、色々と経験をしていくと、あるタイミングで急に理解が深まることがあります。だから、今はこれでよしとしています。\nCopilot に調査を依頼する時代 ただ、数年前と違うのは、調べるのも Copilot に頼めることです。\n例えば、上で書いた「専門性を向上させる方が良い」という話も、Copilot に調査してもらいました。自分で Google 検索して論文を読んで…という従来の方法よりも、圧倒的に効率的です。\nGitHub Copilot カスタムエージェントのための agents.md 作成ベストプラクティス Zenn GitHub Copilot カスタムエージェント実践ガイド：agents.mdで実現するIssue駆動の自動開発ワークフロー | ITアライグマのAI・IT業界エンジニアブログ GitHub Copilotカスタムエージェントとagents.mdの実装方法を解説。Issue駆動開発を自動化するガイド ITアライグマのAI・IT業界エンジニアブログ AI を活用した学習スタイルは、これからのスタンダードになるでしょう。\nまとめ：カスタムエージェントの未来 色々と話題が発散してしまいましたが、何が言いたいかというと、カスタムエージェントは正しく使えば、素晴らしいツールになるということです。\nCopilot coding agent からは使いにくいかもしれませんが、ドメイン特化型のカスタムエージェントを多く定義しておけば、再利用しやすくなります。今やっていることは決して無駄にはならないのです。\nStay hungry. Stay foolish.\nこれからも、新しい技術に触れながら、少しずつ理解を深めていきたいと思います。\n","date":"2025-12-06T21:23:32+09:00","image":"https://www.nqou.net/public_images/2025/1765023812-image.jpg","permalink":"https://www.nqou.net/2025/12/06/212332/","title":"GitHub Copilot の awesome-copilot で開発体験を向上させる"},{"content":"はじめに - AIの気持ちになって考える ここ数日、AGENTS.md をどのように書くのが良いのか、AIの気持ちになってずっと考えている。\nAIは自身がどのように判断したのか（CoT: Chain of Thought）を示すことはできないので、推測するしかないのだが。「やるべきこと」と「やるべきではないこと」を明確に、しかも人間が見てもAIが見ても誤解がないようにするにはどうすれば良いのか？\nわかりやすい言葉を探すのに先人の知恵を借りようと、RFCにまで手を出した。これは、私がAGENTS.mdを仕様書として認識しているから。\nRFC 2119: Key words for use in RFCs to Indicate Requirement Levels In many standards track documents several words are used to signify the requirements in the specification. These words … IETF Datatracker 仕様書は難しいものです。やるべきこととやらざるべきことを表現するために、MUSTとMUST NOTを使って実験してみることにした。\n実験1: 単なる羅列の場合 最初の実験は、特別な分類をせずに、やるべきことを単純に並べる形式です。\n1 2 3 4 5 This is a pen 日本語に翻訳して ただし、次に示す内容を厳守すること - 語尾に「にゃ」をつけること - 語尾に「にゃ」をつけないこと 指示が矛盾しているにゃ〜「『語尾に「にゃ」をつけること』と『語尾に「にゃ」をつけないこと』を同時に満たすことはできないにゃ。」\nどちらかを選んではいけないにゃ。参考までに両方の訳を示すにゃ：\nにゃをつける場合: これはペンですにゃ にゃをつけない場合: これはペンです どちらにするか教えてほしいにゃ。\n実験2: MUST NOT に肯定の表現の場合 次に、MUST とMUST NOTでセクションを分けて、MUST NOTには肯定的な表現を書いてみました。\n1 2 3 4 5 6 7 This is a pen 日本語に翻訳して ただし、次に示す内容を厳守すること ## MUST - 語尾に「にゃ」をつけること ## MUST NOT - 語尾に「にゃ」をつけること ご指定の条件が矛盾していますにゃ（「『語尾に「にゃ」をつけること』と『語尾に「にゃ」をつけることを禁止すること』が同時に指定されているにゃ）。どちらを優先すればよいか教えてくださいにゃ。\n選べる例を示しますにゃ：\nにゃを付けない翻訳: これはペンです にゃを付けた翻訳: これはペンですにゃ どちらにしますかにゃ？\n実験3: MUST NOT に否定の表現の場合 今度は、MUST NOTセクションに否定の表現を書いてみました。\n1 2 3 4 5 6 7 This is a pen 日本語に翻訳して ただし、次に示す内容を厳守すること ## MUST - 語尾に「にゃ」をつけること ## MUST NOT - 語尾に「にゃ」をつけないこと ご指定のルールに矛盾がありますにゃ。\nMUST: 語尾に「にゃ」をつけること（= 「にゃ」を付けてくださいにゃ） MUST NOT: 語尾に「にゃ」をつけないこと（= 「にゃ」を付けないでくださいにゃ） 両方を同時に満たすことはできませんにゃ。どちらの指示に従えばよいか教えてくださいにゃ。\n参考までに両方の翻訳例を示しますにゃ。\n「にゃ」を付ける場合：これはペンにゃ 「にゃ」を付けない場合：これはペンです どちらにしますかにゃ？\n驚きの発見 - 要約を求めると結果が変わる 全部、矛盾として扱われました。否定の否定とは見做されないのかな？\nと、ここまで書いてから思い出した。AIは、CoTは示せないが、要約は出せることを。\nで、試してみると、なんと「MUST NOT に否定の表現」の結果が変わってしまった！要約や信頼度を出すように追加しただけなのに。\n翻訳: これはペンですにゃ\n要点:\n英文 \u0026ldquo;This is a pen\u0026rdquo; の直訳は「これはペンです」にゃ 根拠:\n\u0026ldquo;This\u0026rdquo; は日本語で指示代名詞「これ」に対応するにゃ 英語の be 動詞 \u0026ldquo;is\u0026rdquo; は日本語のコピュラ「です」に対応するにゃ 名詞 \u0026ldquo;pen\u0026rdquo; は外来語「ペン」で一般に表現されるにゃ 仮定:\n文脈は物体を示して説明する単純な文であると仮定して翻訳したにゃ 丁寧な言い方（です調）で訳しているにゃ 手順の要約:\n英文を主語（指示代名詞）、動詞（be 動詞）、目的語（名詞）に分解したにゃ 指示代名詞を「これ」、名詞を「ペン」、be 動詞を「です」に置き換えたにゃ 指示どおり語尾に「にゃ」を付け加えたにゃ 出典（参考資料）:\nTae Kim\u0026rsquo;s Guide to Learning Japanese — Particles (「は」の用法): https://guidetojapanese.org/learn/grammar/particles_wa.html にゃ Jisho.org（単語検索 — pen）: https://jisho.org/search/pen にゃ A Dictionary of Basic Japanese Grammar（池田万寿夫ほか）書籍にゃ 信頼度:\n高い（約95%）にゃ 割と明確に二重否定として解釈されている。\n考察 - なぜ単なる羅列が最強なのか headingに「MUST NOT」のような否定系を書いてしまうと、人間にとってもわかりにくいようになってしまう。\n信頼度の表現を確認すると、なんとなくではあるが「単なる羅列の場合」が信頼度が高そうに見える。リストの前に書いた「厳守すること」が「やるべきこと」扱いになるので、下手に分類せずに「やるべきこと」として「否定の表現」を使って書くのが一番ストレートで（AIにとって）わかりやすい表現なのだろう。\nより深く検証するなら これを書いている時点ではもっと検証ができる（事前に「MUST」と「MUST NOT」について定義するとどうなるか？）と思ってしまうが、少なくとも日本語の場合は、下手に「やるべきこと」と「やるべきではないこと」を分けて書くのは悪手であるのは間違いないので、分類しないのが良さそう。\nまとめ 実験の結果、以下のことが分かりました：\n人間に優しいのは「単なる羅列」 - 構造がシンプルで理解しやすい AIに優しい（誤解がない）のは「単なる羅列」 - 文脈を正しく解釈しやすい 否定系の見出しは避けるべき - MUST NOTのようなセクション分けは混乱を招く 二重否定は状況次第 - 要約を求めると解釈が変わることがある 日本語では特に単純が良い - 言語特性として、シンプルな表現が最も確実 つまり、「単なる羅列」が最強（ただし日本語の場合）\nAGENTS.mdへの適用 この実験結果を踏まえて、AGENTS.mdを書く際の指針：\nセクションで「やるべきこと」と「やるべきではないこと」を分けない すべてを「やるべきこと」として列挙する 禁止事項は「〜してはならない」という否定表現で記述する 見出しに否定的な言葉（MUST NOT、禁止、など）を使わない シンプルな箇条書きを基本とする 1 2 3 4 5 6 7 8 9 ## エージェントの作業ルール 以下を厳守すること： - 新しい投稿は `content/post/` に配置すること - フロントマターは YAML 形式で記述すること - TOML 形式は使用しないこと - `docs/` を直接編集してはならない - システムレベルのコマンドを自動実行してはならない このように、肯定と否定を混在させても、すべて同じレベルの箇条書きにすることで、AIは文脈を正しく理解できる。\n最後に 技術文書を書くということは、人間とAIの両方に理解してもらう必要がある時代になりました。\nRFCのような厳密な仕様書の書き方は参考にはなりますが、実際の運用では、シンプルさと明確さが最も重要だということを、この実験は教えてくれました。\nAGENTS.mdを書く際は、「AIの気持ち」になって、どう解釈されるかを想像しながら書くことが大切ですね。\nそして何より、実験して検証することで、新しい発見があるということが、一番の収穫でした。\n※ この記事で使用した実験結果の画像は、実際のAIとのやり取りをキャプチャしたものです。 ※ AI（特にLLM）の挙動は、モデルのバージョンやプロンプトの微妙な違いで変わる可能性があります。\n","date":"2025-12-06T20:21:30+09:00","image":"https://www.nqou.net/public_images/2025/1765020090-image.jpg","permalink":"https://www.nqou.net/2025/12/06/202130/","title":"混乱してきたにゃ（でもちゃんと結果は出たにゃ）- AGENTS.mdの書き方実験"},{"content":"私はPerlとウイスキーが大好きです KAVALAN BLENDER\u0026rsquo;S SELECTのグラスを傾けながら、琥珀色の液体が喉を滑り落ちる感覚を味わう。ストレートで、ゆっくりと。急がず、じっくりと。\nカバランウイスキー | Kavalan Single Malt Whisky 2005年から台湾のシングルモルトの芸術を開拓。強烈な湿度の中で熟成させ、台湾・宜蘭の雪山の雪解け水によって浄化される。 www.kavalanwhisky.com このKAVALAN、ご存知ですか？台湾・宜蘭県で2005年に創業した、比較的若い蒸留所から生まれたウイスキーです。亜熱帯気候という一見「ハンデ」に思える環境を、むしろ「武器」に変えた戦略が見事。スコットランドで10年かかる熟成が、台湾の高温多湿では3〜4年で完了します。天使の分け前（エンジェルズシェア）は年間10〜15%と驚異的ですが、その分、樽との相互作用が劇的に加速し、濃密で複雑な味わいが短期間で生まれるのです。\nカバラン ブレンダーズセレクト シングルモルトウイスキー 1000 ml | Costco Japan 青りんご、パイナップル、バナナの香りと、新鮮なハーブの香りで始まります。蜂蜜、イチジク、そして心地よい花の香りに発展します。 とても繊細でバランスが取れています。 味わいは濃厚でまろやかでなめらかです。自然な甘さが引き立ちます。 柔らかなウ … www.costco.co.jp BLENDER\u0026rsquo;S SELECTは、マンゴー、パイナップル、熟した洋梨やリンゴのフルーティな香り。口に含むと滑らかで豊かな果実味（トロピカル＋リンゴ系）が広がり、バニラやキャラメルの甘さが感じられます。複数の樽をブレンド（主にアメリカンオーク系とシェリー系を取り合わせているとされる）した、まさに「ブレンダーの技」が光る一本。チビチビやりながらコードを書く、至福の時間です。\nウイスキーの楽しみ方とPerlのコーディング、実は驚くほど似ています。どちらも「ちょうどいいバランス」が命。ウイスキーを水で割りすぎれば風味が失われ、Perlでリファレンスを持ちすぎればメモリリークが発生する。そして、その絶妙なバランスを取るための魔法が Scalar::Util::weaken なのです。\n今夜は、このKAVALANをチビチビやりながら、Perlの weaken について語りましょう。\nPerlのリファレンス — 参照の基本 weaken を理解する前に、まずPerlのリファレンスについておさらいしましょう。ウイスキーボトルのラベルを読むように、丁寧に。\nスカラー・配列・ハッシュのリファレンス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use strict; use warnings; # スカラーへのリファレンス my $whiskey_name = \u0026#34;KAVALAN BLENDER\u0026#39;S SELECT\u0026#34;; my $ref_to_name = \\$whiskey_name; print \u0026#34;Whiskey: $$ref_to_name\\n\u0026#34;; # デリファレンス # 配列へのリファレンス my @bottles = qw(KAVALAN Yamazaki Hibiki); my $ref_to_bottles = \\@bottles; print \u0026#34;First bottle: $ref_to_bottles-\u0026gt;[0]\\n\u0026#34;; # ハッシュへのリファレンス my %tasting_notes = ( aroma =\u0026gt; \u0026#39;fruity and floral\u0026#39;, taste =\u0026gt; \u0026#39;smooth with vanilla\u0026#39;, finish =\u0026gt; \u0026#39;long and warming\u0026#39; ); my $ref_to_notes = \\%tasting_notes; print \u0026#34;Aroma: $ref_to_notes-\u0026gt;{aroma}\\n\u0026#34;; これらのリファレンスは「強参照（strong reference）」と呼ばれます。グラスにウイスキーがある限り、その存在は確かなもの。リファレンスがある限り、データは消えません。\nweaken とは何か？ — 弱参照の魔法 Scalar::Util::weaken は、強参照を弱参照（weak reference）に変換する関数です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use strict; use warnings; use Scalar::Util qw(weaken isweak); my $bottle = { name =\u0026gt; \u0026#34;KAVALAN\u0026#34; }; my $ref = $bottle; # 強参照 print \u0026#34;Before weaken: \u0026#34;, (isweak($ref) ? \u0026#34;weak\u0026#34; : \u0026#34;strong\u0026#34;), \u0026#34;\\n\u0026#34;; weaken($ref); # 弱参照に変換 print \u0026#34;After weaken: \u0026#34;, (isweak($ref) ? \u0026#34;weak\u0026#34; : \u0026#34;strong\u0026#34;), \u0026#34;\\n\u0026#34;; # $bottleが存在する間は$refも有効 print \u0026#34;Ref is defined: \u0026#34;, (defined $ref ? \u0026#34;yes\u0026#34; : \u0026#34;no\u0026#34;), \u0026#34;\\n\u0026#34;; # 元のデータを削除すると... undef $bottle; print \u0026#34;After undef bottle: \u0026#34;, (defined $ref ? \u0026#34;yes\u0026#34; : \u0026#34;no\u0026#34;), \u0026#34;\\n\u0026#34;; # 出力: After undef bottle: no 弱参照は、データの存在を「保証しない」参照です。まるで、ウイスキーの香りのようなもの。グラスにウイスキーがあれば香りも楽しめますが、ウイスキーを飲み干せば香りも消える。弱参照はそういう存在なのです。\nなぜ弱参照が必要なのか 強参照だけでは、参照カウント方式のメモリ管理において循環参照によるメモリリークが発生します。これは、空のボトルを延々と棚に並べ続けるようなもの。いつかは棚が満杯になってしまいます。\nパターン1: 循環参照によるメモリリーク — 双方向リスト 最も分かりやすい例は、双方向リストです。\n問題のあるコード（メモリリークあり） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 use strict; use warnings; package Node; sub new { my ($class, $value) = @_; bless { value =\u0026gt; $value, next =\u0026gt; undef, # 次のノードへの参照 prev =\u0026gt; undef, # 前のノードへの参照 }, $class; } sub DESTROY { my $self = shift; print \u0026#34;Destroying node: $self-\u0026gt;{value}\\n\u0026#34;; } package main; { my $node1 = Node-\u0026gt;new(\u0026#34;First pour\u0026#34;); my $node2 = Node-\u0026gt;new(\u0026#34;Second pour\u0026#34;); # 双方向リンクを作成 $node1-\u0026gt;{next} = $node2; # node1 -\u0026gt; node2 $node2-\u0026gt;{prev} = $node1; # node2 -\u0026gt; node1 print \u0026#34;Created circular reference\\n\u0026#34;; } # DESTROYが呼ばれない！メモリリーク発生 print \u0026#34;Scope ended\\n\u0026#34;; このコードでは、$node1 と $node2 がお互いを参照し合っているため、スコープを抜けても参照カウントが0にならず、メモリが解放されません。\n解決策: weaken を使う 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 use strict; use warnings; use Scalar::Util qw(weaken); package Node; sub new { my ($class, $value) = @_; bless { value =\u0026gt; $value, next =\u0026gt; undef, prev =\u0026gt; undef, }, $class; } sub DESTROY { my $self = shift; print \u0026#34;Destroying node: $self-\u0026gt;{value}\\n\u0026#34;; } package main; { my $node1 = Node-\u0026gt;new(\u0026#34;First pour\u0026#34;); my $node2 = Node-\u0026gt;new(\u0026#34;Second pour\u0026#34;); # 双方向リンクを作成 $node1-\u0026gt;{next} = $node2; # node1 -\u0026gt; node2（強参照） $node2-\u0026gt;{prev} = $node1; # node2 -\u0026gt; node1（強参照） # 一方を弱参照に変換して循環を断ち切る weaken($node2-\u0026gt;{prev}); # これで循環参照が解消 print \u0026#34;Created circular reference with weaken\\n\u0026#34;; } print \u0026#34;Scope ended\\n\u0026#34;; # 出力: # Created circular reference with weaken # Destroying node: First pour # Destroying node: Second pour # Scope ended weaken を使うことで、$node2-\u0026gt;{prev} は弱参照となり、循環参照が解消されます。スコープを抜けると、正しく DESTROY が呼ばれてメモリが解放されます。\n仕組みの解説 $node1 のスコープが終わる $node1 への参照カウントを確認 $node2-\u0026gt;{prev} は弱参照なのでカウントしない → カウントは0 $node1 が破棄される $node1-\u0026gt;{next} が削除されるので $node2 への参照が減る $node2 の参照カウントも0になる $node2 も破棄される まるでドミノ倒しのように、美しくメモリが解放されていきます。KAVALANのフィニッシュのように、長く、そして確実に。\nパターン2: ストロング参照のみ — シンプルなツリー構造 弱参照が常に必要なわけではありません。片方向のデータ構造では、強参照だけで十分な場合もあります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 use strict; use warnings; package TreeNode; sub new { my ($class, $value) = @_; bless { value =\u0026gt; $value, children =\u0026gt; [], # 子ノードへの参照配列 }, $class; } sub add_child { my ($self, $child) = @_; push @{$self-\u0026gt;{children}}, $child; } sub DESTROY { my $self = shift; print \u0026#34;Destroying TreeNode: $self-\u0026gt;{value}\\n\u0026#34;; } package main; { my $root = TreeNode-\u0026gt;new(\u0026#34;Distillery\u0026#34;); my $child1 = TreeNode-\u0026gt;new(\u0026#34;Cask 1\u0026#34;); my $child2 = TreeNode-\u0026gt;new(\u0026#34;Cask 2\u0026#34;); $root-\u0026gt;add_child($child1); $root-\u0026gt;add_child($child2); print \u0026#34;Created tree structure\\n\u0026#34;; } print \u0026#34;Scope ended\\n\u0026#34;; # 出力: # Created tree structure # Destroying TreeNode: Distillery # Destroying TreeNode: Cask 2 # Destroying TreeNode: Cask 1 # Scope ended このコードは正しく動作します。なぜなら：\n親から子への参照のみ（一方向） 子から親への参照がない 循環参照が存在しない これは、ウイスキーの蒸留工程のようなもの。上から下へ、一方向に流れていくだけです。\nパターン3: 親子関係でのメモリリーク回避 しかし、子から親を参照したい場合はどうでしょう？これが現実のアプリケーションでは頻繁に発生します。\n問題のあるコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 use strict; use warnings; package Parent; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, children =\u0026gt; [] }, $class; } sub add_child { my ($self, $child) = @_; push @{$self-\u0026gt;{children}}, $child; $child-\u0026gt;{parent} = $self; # 子から親への参照を設定 } sub DESTROY { my $self = shift; print \u0026#34;Destroying Parent: $self-\u0026gt;{name}\\n\u0026#34;; } package Child; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, parent =\u0026gt; undef }, $class; } sub DESTROY { my $self = shift; print \u0026#34;Destroying Child: $self-\u0026gt;{name}\\n\u0026#34;; } package main; { my $parent = Parent-\u0026gt;new(\u0026#34;Master Blender\u0026#34;); my $child1 = Child-\u0026gt;new(\u0026#34;Bottle 1\u0026#34;); my $child2 = Child-\u0026gt;new(\u0026#34;Bottle 2\u0026#34;); $parent-\u0026gt;add_child($child1); $parent-\u0026gt;add_child($child2); } # スコープが終わってもDESTROYが呼ばれない！ print \u0026#34;Scope ended\\n\u0026#34;; 解決策: 子から親への参照を弱くする 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 use strict; use warnings; package Parent; use Scalar::Util qw(weaken); sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, children =\u0026gt; [] }, $class; } sub add_child { my ($self, $child) = @_; push @{$self-\u0026gt;{children}}, $child; $child-\u0026gt;{parent} = $self; weaken($child-\u0026gt;{parent}); # 子から親への参照を弱参照に } sub DESTROY { my $self = shift; print \u0026#34;Destroying Parent: $self-\u0026gt;{name}\\n\u0026#34;; } package Child; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, parent =\u0026gt; undef }, $class; } sub get_parent_name { my $self = shift; # 弱参照が有効かチェック return $self-\u0026gt;{parent} ? $self-\u0026gt;{parent}{name} : \u0026#34;No parent\u0026#34;; } sub DESTROY { my $self = shift; print \u0026#34;Destroying Child: $self-\u0026gt;{name}\\n\u0026#34;; } package main; { my $parent = Parent-\u0026gt;new(\u0026#34;Master Blender\u0026#34;); my $child1 = Child-\u0026gt;new(\u0026#34;Bottle 1\u0026#34;); my $child2 = Child-\u0026gt;new(\u0026#34;Bottle 2\u0026#34;); $parent-\u0026gt;add_child($child1); $parent-\u0026gt;add_child($child2); # 子から親にアクセスできる print \u0026#34;Child1\u0026#39;s parent: \u0026#34;, $child1-\u0026gt;get_parent_name(), \u0026#34;\\n\u0026#34;; } print \u0026#34;Scope ended\\n\u0026#34;; # 出力: # Child1\u0026#39;s parent: Master Blender # Destroying Parent: Master Blender # Destroying Child: Bottle 2 # Destroying Child: Bottle 1 # Scope ended ベストプラクティス 親子関係では、一般的に以下のルールに従います：\n親から子への参照: 強参照（親が子の寿命を管理） 子から親への参照: 弱参照（子は親の存在を参照するだけ） これは、ウイスキーとグラスの関係のようなもの。ボトル（親）がグラス（子）を所有し、グラスはボトルを参照するだけ。ボトルがなくなれば、グラスも意味を失います。\nパターン4: クロージャとコールバック — イベントリスナーの罠 オブジェクトがクロージャを保持する場合、特に注意が必要です。これは経験豊富なPerl使いでも踏みやすい罠です。\n問題のあるコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 use strict; use warnings; package EventEmitter; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, listeners =\u0026gt; [] }, $class; } sub on { my ($self, $callback) = @_; push @{$self-\u0026gt;{listeners}}, $callback; } sub emit { my ($self, $event) = @_; $_-\u0026gt;($event) for @{$self-\u0026gt;{listeners}}; } sub DESTROY { my $self = shift; print \u0026#34;Destroying EventEmitter: $self-\u0026gt;{name}\\n\u0026#34;; } package Observer; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name }, $class; } sub DESTROY { my $self = shift; print \u0026#34;Destroying Observer: $self-\u0026gt;{name}\\n\u0026#34;; } package main; { my $emitter = EventEmitter-\u0026gt;new(\u0026#34;Whiskey Bottle\u0026#34;); my $observer = Observer-\u0026gt;new(\u0026#34;Taster\u0026#34;); # このクロージャが$observerを捕捉する $emitter-\u0026gt;on(sub { my $event = shift; print \u0026#34;Observer $observer-\u0026gt;{name} received: $event\\n\u0026#34;; }); $emitter-\u0026gt;emit(\u0026#34;Pour\u0026#34;); # 明示的にundefしてもObserverは破棄されない undef $observer; # Observerが破棄されない！（$emitterがクロージャ経由で保持している） } print \u0026#34;Scope ended\\n\u0026#34;; クロージャが $observer への参照を保持し、$emitter がそのクロージャを保持するため、$observer は解放されません。\n解決策: 弱参照を使う 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 use strict; use warnings; use Scalar::Util qw(weaken); package EventEmitter; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name, listeners =\u0026gt; [] }, $class; } sub on { my ($self, $callback) = @_; push @{$self-\u0026gt;{listeners}}, $callback; } sub emit { my ($self, $event) = @_; $_-\u0026gt;($event) for @{$self-\u0026gt;{listeners}}; } sub DESTROY { my $self = shift; print \u0026#34;Destroying EventEmitter: $self-\u0026gt;{name}\\n\u0026#34;; } package Observer; sub new { my ($class, $name) = @_; bless { name =\u0026gt; $name }, $class; } sub DESTROY { my $self = shift; print \u0026#34;Destroying Observer: $self-\u0026gt;{name}\\n\u0026#34;; } package main; { my $emitter = EventEmitter-\u0026gt;new(\u0026#34;Whiskey Bottle\u0026#34;); my $observer = Observer-\u0026gt;new(\u0026#34;Taster\u0026#34;); # 弱参照のコピーを作成 my $weak_observer = $observer; weaken($weak_observer); # クロージャは弱参照を捕捉 $emitter-\u0026gt;on(sub { my $event = shift; return unless defined $weak_observer; # 弱参照チェック print \u0026#34;Observer $weak_observer-\u0026gt;{name} received: $event\\n\u0026#34;; }); $emitter-\u0026gt;emit(\u0026#34;Pour\u0026#34;); print \u0026#34;Undefining observer...\\n\u0026#34;; undef $observer; $emitter-\u0026gt;emit(\u0026#34;Drink\u0026#34;); # observerは存在しないので何も起こらない } print \u0026#34;Scope ended\\n\u0026#34;; # 出力: # Observer Taster received: Pour # Undefining observer... # Destroying Observer: Taster # Destroying EventEmitter: Whiskey Bottle # Scope ended 重要なポイント クロージャで弱参照を使う場合は、必ず defined チェックを行います：\n1 return unless defined $weak_observer; 弱参照は元のオブジェクトが破棄されると undef になります。チェックせずにアクセスするとエラーになります。これは、空のグラスに口をつける前に、中身があるか確認するようなものです。\nパターン5: キャッシュの実装 — 適切な解放タイミング 弱参照は、キャッシュの実装にも有効です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 use strict; use warnings; package Cache; use Scalar::Util qw(weaken); sub new { my $class = shift; bless { storage =\u0026gt; {} }, $class; } sub set { my ($self, $key, $value) = @_; $self-\u0026gt;{storage}{$key} = $value; weaken($self-\u0026gt;{storage}{$key}); # 弱参照としてキャッシュ } sub get { my ($self, $key) = @_; return $self-\u0026gt;{storage}{$key}; # undefかもしれない } sub DESTROY { print \u0026#34;Destroying Cache\\n\u0026#34;; } package main; my $cache = Cache-\u0026gt;new(); { my $data = { name =\u0026gt; \u0026#34;KAVALAN\u0026#34;, age =\u0026gt; 10 }; $cache-\u0026gt;set(\u0026#34;whiskey\u0026#34;, $data); # キャッシュから取得可能 my $cached = $cache-\u0026gt;get(\u0026#34;whiskey\u0026#34;); print \u0026#34;Cached: $cached-\u0026gt;{name}\\n\u0026#34; if defined $cached; # $dataがスコープを抜けると... } # キャッシュは自動的に無効化される my $cached = $cache-\u0026gt;get(\u0026#34;whiskey\u0026#34;); print \u0026#34;Cached after scope: \u0026#34;, (defined $cached ? \u0026#34;exists\u0026#34; : \u0026#34;gone\u0026#34;), \u0026#34;\\n\u0026#34;; # 出力: Cached after scope: gone このパターンは、メモリに余裕があればキャッシュを保持し、元のデータが不要になれば自動的に解放される、非常にエレガントな実装です。\n実践的なデバッグテクニック weaken を使う際の注意点とデバッグ方法：\n1. 弱参照かどうか確認する 1 2 3 4 5 6 7 8 9 10 use strict; use warnings; use Scalar::Util qw(weaken isweak); my $data = \u0026#39;data\u0026#39;; my $ref = \\$data; print \u0026#34;Is weak? \u0026#34;, (isweak($ref) ? \u0026#34;yes\u0026#34; : \u0026#34;no\u0026#34;), \u0026#34;\\n\u0026#34;; weaken($ref); print \u0026#34;Is weak? \u0026#34;, (isweak($ref) ? \u0026#34;yes\u0026#34; : \u0026#34;no\u0026#34;), \u0026#34;\\n\u0026#34;; 2. デストラクタでメモリリークを検出 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use strict; use warnings; package MyClass; sub new { my $class = shift; my $self = bless {}, $class; print \u0026#34;Creating MyClass at $self\\n\u0026#34;; return $self; } sub DESTROY { my $self = shift; print \u0026#34;Destroying MyClass at $self\\n\u0026#34;; } package main; { my $class = MyClass-\u0026gt;new(); } print \u0026#34;Scope ended\\n\u0026#34;; DESTROY が呼ばれないなら、メモリリークの可能性があります。\n3. Devel::Cycle で循環参照を見つける 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use strict; use warnings; package Node; sub new { bless {} } package main; use Devel::Cycle; my $node1 = Node-\u0026gt;new(\u0026#34;A\u0026#34;); my $node2 = Node-\u0026gt;new(\u0026#34;B\u0026#34;); $node1-\u0026gt;{next} = $node2; $node2-\u0026gt;{prev} = $node1; find_cycle($node1); # 循環参照を報告してくれる まとめ — ウイスキーとweakenの共通点 グラスに残ったKAVALANを一口。最後の一滴まで、丁寧に味わいます。\nScalar::Util::weaken は、Perlにおけるメモリ管理の要です。循環参照によるメモリリークを防ぎ、親子関係やコールバックを安全に実装できます。\nウイスキーを楽しむように、Perlを楽しむためには：\nバランスが大切: 強参照と弱参照のバランス タイミングを見極める: いつ weaken を使うべきか 丁寧に味わう: コードレビューでメモリリークをチェック 経験を積む: 実際に使ってみて、体で覚える 今夜学んだことを、明日のコードに活かしてください。そして、次のコーディングセッションには、お気に入りのウイスキーを一本用意して。\nでは、乾杯！ 🥃\n今回のコードで使用したモジュール:\nScalar::Util (コアモジュール - Perl 5.7.3以降標準搭載) weaken - 参照を弱参照に変換 isweak - 弱参照かどうか判定 追加で役立つモジュール:\nDevel::Cycle - 循環参照の検出（CPANから導入） 動作確認環境:\nPerl 5.10以降推奨 すべてのコード例は実際に動作確認済みです。コピー＆ペーストして、ぜひ試してみてください！\n","date":"2025-12-06T17:28:47+09:00","image":"https://www.nqou.net/public_images/2025/1765009727-image.jpg","permalink":"https://www.nqou.net/2025/12/06/172847/","title":"PerlのScalar::Util::weaken完全ガイド - メモリリークを防ぐ5つのパターン"},{"content":"はじめに - リファレンスはPerlの要 リファレンスは、Perlで複雑なデータ構造を扱うための最も重要な機能です。配列の配列、ハッシュのハッシュ、JSONのような階層的なデータ――これらはすべてリファレンスなしには実現できません。\nPerl 5.0（1994年）でリファレンスが導入されたことで、Perlは本格的なオブジェクト指向プログラミングが可能になり、複雑なアプリケーション開発の基盤が整いました。リファレンスを理解することは、モダンなPerl開発の第一歩です。\nこの記事では、リファレンスの概念から始めて、実用的な使い方、デバッグ方法まで、リファレンスのすべてを解説します。\nリファレンスとは何か メモリとアドレスの概念 リファレンスを理解するには、まずコンピュータのメモリの仕組みを知る必要があります。\n1 2 3 4 5 6 7 8 9 use v5.38; # 通常の変数 my @array = (1, 2, 3); my %hash = (name =\u0026gt; \u0026#39;Taro\u0026#39;, age =\u0026gt; 30); # これらは実際のデータがメモリに格納されている # @array → メモリ上のどこかに [1, 2, 3] が存在 # %hash → メモリ上のどこかに {name =\u0026gt; \u0026#39;Taro\u0026#39;, age =\u0026gt; 30} が存在 リファレンスは、このメモリ上の「場所（アドレス）」を指し示すものです。C言語のポインタに似ていますが、Perlのリファレンスはより安全で使いやすく設計されています。\n1 2 3 4 5 6 7 use v5.38; my @array = (1, 2, 3); my $ref = \\@array; # @array のアドレスを $ref に格納 say $ref; # ARRAY(0x55a8b9c8d2e0) のような出力 # 0x... の部分がメモリアドレス なぜリファレンスが必要なのか Perlでは、配列やハッシュの中に直接別の配列やハッシュを入れることはできません。\n1 2 3 4 5 6 7 8 9 10 use v5.38; # これは期待通りに動かない！ my @matrix = ( (1, 2, 3), # カンマで区切られた要素として展開される (4, 5, 6), # 結果: @matrix = (1, 2, 3, 4, 5, 6) になってしまう (7, 8, 9) ); say scalar @matrix; # 9（期待値は3ではない） リファレンスを使えば、多次元データ構造を作れます。\n1 2 3 4 5 6 7 8 9 10 11 use v5.38; # リファレンスを使った正しい方法 my @matrix = ( [1, 2, 3], # 配列リファレンス [4, 5, 6], # 配列リファレンス [7, 8, 9] # 配列リファレンス ); say scalar @matrix; # 3（正しい！） say $matrix[0]-\u0026gt;[1]; # 2（1行目2列目の要素） リファレンスの作成方法 バックスラッシュ演算子（\\） 既存の変数のリファレンスを作る最も基本的な方法です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; # スカラーリファレンス my $value = 42; my $scalar_ref = \\$value; # 配列リファレンス my @array = (1, 2, 3); my $array_ref = \\@array; # ハッシュリファレンス my %hash = (key =\u0026gt; \u0026#39;value\u0026#39;); my $hash_ref = \\%hash; # サブルーチンリファレンス sub greet { say \u0026#34;Hello!\u0026#34; } my $sub_ref = \\\u0026amp;greet; 無名配列（[]） 新しい配列を直接リファレンスとして作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use v5.38; # 無名配列の作成 my $ref = [1, 2, 3, 4, 5]; # これは以下と同等 # my @temp = (1, 2, 3, 4, 5); # my $ref = \\@temp; # ただし @temp は存在しない（無名） # 多次元配列 my $matrix = [ [1, 2, 3], [4, 5, 6], [7, 8, 9] ]; 無名ハッシュ（{}） 新しいハッシュを直接リファレンスとして作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use v5.38; # 無名ハッシュの作成 my $person = { name =\u0026gt; \u0026#39;Taro\u0026#39;, age =\u0026gt; 30, city =\u0026gt; \u0026#39;Tokyo\u0026#39; }; # 複雑な構造 my $company = { name =\u0026gt; \u0026#39;Example Corp\u0026#39;, employees =\u0026gt; [ { name =\u0026gt; \u0026#39;Alice\u0026#39;, role =\u0026gt; \u0026#39;Engineer\u0026#39; }, { name =\u0026gt; \u0026#39;Bob\u0026#39;, role =\u0026gt; \u0026#39;Designer\u0026#39; }, { name =\u0026gt; \u0026#39;Carol\u0026#39;, role =\u0026gt; \u0026#39;Manager\u0026#39; } ], founded =\u0026gt; 2020 }; 無名サブルーチン（sub {}） サブルーチンを直接リファレンスとして作成します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use v5.38; # 無名サブルーチンのリファレンス my $greet = sub { my ($name) = @_; say \u0026#34;Hello, $name!\u0026#34;; }; $greet-\u0026gt;(\u0026#39;World\u0026#39;); # Hello, World! # クロージャの例 sub make_counter { my $count = 0; return sub { return ++$count; }; } my $counter = make_counter(); say $counter-\u0026gt;(); # 1 say $counter-\u0026gt;(); # 2 say $counter-\u0026gt;(); # 3 デリファレンス - リファレンスから実体へ リファレンスから元のデータにアクセスすることを「デリファレンス」と呼びます。\n矢印演算子（-\u0026gt;）- 最も一般的な方法 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; my $array_ref = [10, 20, 30]; my $hash_ref = { x =\u0026gt; 100, y =\u0026gt; 200 }; # 配列要素へのアクセス say $array_ref-\u0026gt;[0]; # 10 say $array_ref-\u0026gt;[1]; # 20 # ハッシュ要素へのアクセス say $hash_ref-\u0026gt;{x}; # 100 say $hash_ref-\u0026gt;{y}; # 200 # 多次元の場合、矢印は省略可能 my $matrix = [[1, 2], [3, 4]]; say $matrix-\u0026gt;[0]-\u0026gt;[1]; # 2 say $matrix-\u0026gt;[0][1]; # 2（同じ意味、矢印省略） 中括弧デリファレンス（{}） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; my $array_ref = [1, 2, 3]; my $hash_ref = { a =\u0026gt; 1, b =\u0026gt; 2 }; # 配列全体にアクセス my @array = @{$array_ref}; say \u0026#34;@array\u0026#34;; # 1 2 3 # ハッシュ全体にアクセス my %hash = %{$hash_ref}; say $hash{a}; # 1 # スカラーの場合 my $value = 42; my $scalar_ref = \\$value; say ${$scalar_ref}; # 42 配列・ハッシュの操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use v5.38; my $array_ref = [1, 2, 3]; # 配列操作 push @{$array_ref}, 4; say \u0026#34;@{$array_ref}\u0026#34;; # 1 2 3 4 my $popped = pop @{$array_ref}; say $popped; # 4 # 配列の長さ say scalar @{$array_ref}; # 3 # ハッシュ操作 my $hash_ref = { a =\u0026gt; 1, b =\u0026gt; 2 }; $hash_ref-\u0026gt;{c} = 3; # キーの一覧 my @keys = keys %{$hash_ref}; say \u0026#34;@keys\u0026#34;; # a b c（順序は不定） # 値の一覧 my @values = values %{$hash_ref}; ポストフィックスデリファレンス（モダンPerl） Perl 5.20以降で使える、読みやすい新しい記法です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use v5.20; use feature \u0026#39;postderef\u0026#39;; no warnings \u0026#39;experimental::postderef\u0026#39;; # または use v5.24 以降なら warnings 不要 my $array_ref = [1, 2, 3]; my $hash_ref = { a =\u0026gt; 1, b =\u0026gt; 2 }; # 配列全体 my @array = $array_ref-\u0026gt;@*; say \u0026#34;@array\u0026#34;; # 1 2 3 # ハッシュ全体 my %hash = $hash_ref-\u0026gt;%*; say $hash{a}; # 1 # 配列操作 push $array_ref-\u0026gt;@*, 4; my $last = pop $array_ref-\u0026gt;@*; # ハッシュのキーと値 my @keys = $hash_ref-\u0026gt;%*; # これは間違い my @keys = keys $hash_ref-\u0026gt;%*; my @values = values $hash_ref-\u0026gt;%*; # スライス my @slice = $array_ref-\u0026gt;@[0, 2]; # (1, 3) my %slice = $hash_ref-\u0026gt;%{qw(a c)}; Perl 5.24以降では experimental 警告なしで使えます。\n1 2 3 4 use v5.24; my $data = [1, 2, 3]; say join \u0026#39;, \u0026#39;, $data-\u0026gt;@*; # 1, 2, 3 リファレンスの型判定 リファレンスがどの型を指しているか確認する方法です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use v5.38; my $array_ref = [1, 2, 3]; my $hash_ref = { a =\u0026gt; 1 }; my $code_ref = sub { say \u0026#34;hi\u0026#34; }; # ref 関数 say ref $array_ref; # ARRAY say ref $hash_ref; # HASH say ref $code_ref; # CODE # 判定 if (ref $array_ref eq \u0026#39;ARRAY\u0026#39;) { say \u0026#34;This is an array reference\u0026#34;; } # Scalar::Util::reftype を使う方法 use Scalar::Util qw(reftype); say reftype $array_ref; # ARRAY # bless されたオブジェクトの場合 package Person; my $obj = bless { name =\u0026gt; \u0026#39;Taro\u0026#39; }, \u0026#39;Person\u0026#39;; say ref $obj; # Person（クラス名） say reftype $obj; # HASH（実体の型） 多次元データ構造 リファレンスの真価は複雑なデータ構造を扱えることです。\n二次元配列（行列） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 use v5.38; # 3x3の行列 my $matrix = [ [1, 2, 3], [4, 5, 6], [7, 8, 9] ]; # アクセス say $matrix-\u0026gt;[0][0]; # 1 say $matrix-\u0026gt;[1][2]; # 6 say $matrix-\u0026gt;[2][2]; # 9 # 行の取り出し my $row = $matrix-\u0026gt;[1]; say \u0026#34;@$row\u0026#34;; # 4 5 6 # ループで処理 for my $i (0 .. $#{$matrix}) { for my $j (0 .. $#{$matrix-\u0026gt;[$i]}) { printf \u0026#34;%2d \u0026#34;, $matrix-\u0026gt;[$i][$j]; } say \u0026#34;\u0026#34;; } # 出力: # 1 2 3 # 4 5 6 # 7 8 9 ハッシュの配列 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use v5.38; # ユーザーのリスト my $users = [ { id =\u0026gt; 1, name =\u0026gt; \u0026#39;Alice\u0026#39;, email =\u0026gt; \u0026#39;alice@example.com\u0026#39; }, { id =\u0026gt; 2, name =\u0026gt; \u0026#39;Bob\u0026#39;, email =\u0026gt; \u0026#39;bob@example.com\u0026#39; }, { id =\u0026gt; 3, name =\u0026gt; \u0026#39;Carol\u0026#39;, email =\u0026gt; \u0026#39;carol@example.com\u0026#39; } ]; # アクセス say $users-\u0026gt;[0]{name}; # Alice say $users-\u0026gt;[1]{email}; # bob@example.com # ループ for my $user (@$users) { say \u0026#34;$user-\u0026gt;{name} \u0026lt;$user-\u0026gt;{email}\u0026gt;\u0026#34;; } # 検索 my ($alice) = grep { $_-\u0026gt;{name} eq \u0026#39;Alice\u0026#39; } @$users; say $alice-\u0026gt;{id}; # 1 配列のハッシュ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 use v5.38; # グループ分けされたデータ my $groups = { engineers =\u0026gt; [\u0026#39;Alice\u0026#39;, \u0026#39;Bob\u0026#39;, \u0026#39;Charlie\u0026#39;], designers =\u0026gt; [\u0026#39;Dave\u0026#39;, \u0026#39;Eve\u0026#39;], managers =\u0026gt; [\u0026#39;Frank\u0026#39;] }; # アクセス say $groups-\u0026gt;{engineers}[0]; # Alice say $groups-\u0026gt;{designers}[1]; # Eve # ループ for my $role (keys %$groups) { say \u0026#34;=== $role ===\u0026#34;; for my $name (@{$groups-\u0026gt;{$role}}) { say \u0026#34; - $name\u0026#34;; } } ハッシュのハッシュ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 use v5.38; # 都市別の人口データ my $population = { Tokyo =\u0026gt; { population =\u0026gt; 14_000_000, area =\u0026gt; 2194, prefecture =\u0026gt; \u0026#39;Tokyo\u0026#39; }, Osaka =\u0026gt; { population =\u0026gt; 2_750_000, area =\u0026gt; 225, prefecture =\u0026gt; \u0026#39;Osaka\u0026#39; }, Kyoto =\u0026gt; { population =\u0026gt; 1_460_000, area =\u0026gt; 828, prefecture =\u0026gt; \u0026#39;Kyoto\u0026#39; } }; # アクセス say $population-\u0026gt;{Tokyo}{population}; # 14000000 # 人口密度を計算 for my $city (keys %$population) { my $data = $population-\u0026gt;{$city}; my $density = $data-\u0026gt;{population} / $data-\u0026gt;{area}; printf \u0026#34;%s: %.0f people/km²\\n\u0026#34;, $city, $density; } 深い入れ子構造 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 use v5.38; # 企業の組織図 my $org = { name =\u0026gt; \u0026#39;Example Corp\u0026#39;, departments =\u0026gt; { engineering =\u0026gt; { manager =\u0026gt; \u0026#39;Alice\u0026#39;, teams =\u0026gt; { backend =\u0026gt; { lead =\u0026gt; \u0026#39;Bob\u0026#39;, members =\u0026gt; [\u0026#39;Charlie\u0026#39;, \u0026#39;Dave\u0026#39;, \u0026#39;Eve\u0026#39;] }, frontend =\u0026gt; { lead =\u0026gt; \u0026#39;Frank\u0026#39;, members =\u0026gt; [\u0026#39;Grace\u0026#39;, \u0026#39;Henry\u0026#39;] } } }, design =\u0026gt; { manager =\u0026gt; \u0026#39;Iris\u0026#39;, teams =\u0026gt; { ui =\u0026gt; { lead =\u0026gt; \u0026#39;Jack\u0026#39;, members =\u0026gt; [\u0026#39;Kate\u0026#39;, \u0026#39;Leo\u0026#39;] } } } } }; # 深いアクセス say $org-\u0026gt;{departments}{engineering}{teams}{backend}{lead}; # Bob # バックエンドチームのメンバー一覧 my $backend_members = $org-\u0026gt;{departments}{engineering}{teams}{backend}{members}; say \u0026#34;Backend team:\u0026#34;; for my $member (@$backend_members) { say \u0026#34; - $member\u0026#34;; } 実用例 JSONライクなデータ構造 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use v5.38; use JSON::PP; # Perlのデータ構造 my $data = { user =\u0026gt; { id =\u0026gt; 123, name =\u0026gt; \u0026#39;Taro Yamada\u0026#39;, email =\u0026gt; \u0026#39;taro@example.com\u0026#39;, verified =\u0026gt; \\1, # JSON の true roles =\u0026gt; [\u0026#39;admin\u0026#39;, \u0026#39;editor\u0026#39;] }, posts =\u0026gt; [ { id =\u0026gt; 1, title =\u0026gt; \u0026#39;First Post\u0026#39;, tags =\u0026gt; [\u0026#39;perl\u0026#39;, \u0026#39;programming\u0026#39;], published =\u0026gt; \\1 }, { id =\u0026gt; 2, title =\u0026gt; \u0026#39;Second Post\u0026#39;, tags =\u0026gt; [\u0026#39;web\u0026#39;, \u0026#39;api\u0026#39;], published =\u0026gt; \\0 # JSON の false } ] }; # JSONに変換 my $json = JSON::PP-\u0026gt;new-\u0026gt;pretty-\u0026gt;encode($data); say $json; # JSONから復元 my $restored = JSON::PP-\u0026gt;new-\u0026gt;decode($json); say $restored-\u0026gt;{user}{name}; # Taro Yamada 設定ファイルの読み込み 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 use v5.38; # config.pl my $config = { database =\u0026gt; { host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 5432, name =\u0026gt; \u0026#39;myapp\u0026#39;, user =\u0026gt; \u0026#39;dbuser\u0026#39;, password =\u0026gt; \u0026#39;secret\u0026#39; }, cache =\u0026gt; { driver =\u0026gt; \u0026#39;redis\u0026#39;, host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 6379, timeout =\u0026gt; 30 }, features =\u0026gt; { new_ui =\u0026gt; 1, beta_api =\u0026gt; 0, experimental =\u0026gt; 0 } }; # 使用例 sub connect_db { my $db_config = $config-\u0026gt;{database}; # DBI-\u0026gt;connect( # \u0026#34;dbi:Pg:host=$db_config-\u0026gt;{host};port=$db_config-\u0026gt;{port}\u0026#34;, # $db_config-\u0026gt;{user}, # $db_config-\u0026gt;{password} # ); } # 機能フラグのチェック if ($config-\u0026gt;{features}{new_ui}) { say \u0026#34;Using new UI\u0026#34;; } 複雑なデータの変換 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 use v5.38; # CSVライクなデータを構造化 my @csv_data = ( [\u0026#39;Name\u0026#39;, \u0026#39;Age\u0026#39;, \u0026#39;City\u0026#39;], [\u0026#39;Alice\u0026#39;, 25, \u0026#39;Tokyo\u0026#39;], [\u0026#39;Bob\u0026#39;, 30, \u0026#39;Osaka\u0026#39;], [\u0026#39;Charlie\u0026#39;, 35, \u0026#39;Kyoto\u0026#39;] ); # ハッシュの配列に変換 my @headers = @{shift @csv_data}; my @records; for my $row (@csv_data) { my %record; for my $i (0 .. $#headers) { $record{$headers[$i]} = $row-\u0026gt;[$i]; } push @records, \\%record; } # 使いやすい形式に for my $record (@records) { say \u0026#34;$record-\u0026gt;{Name} ($record-\u0026gt;{Age}) lives in $record-\u0026gt;{City}\u0026#34;; } # グループ化 my %by_city; for my $record (@records) { my $city = $record-\u0026gt;{City}; push @{$by_city{$city}}, $record; } # 都市ごとに表示 for my $city (sort keys %by_city) { say \u0026#34;=== $city ===\u0026#34;; for my $person (@{$by_city{$city}}) { say \u0026#34; $person-\u0026gt;{Name}, $person-\u0026gt;{Age}\u0026#34;; } } サブルーチンリファレンスの活用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 use v5.38; # コールバックパターン sub process_list { my ($list_ref, $callback) = @_; my @results; for my $item (@$list_ref) { push @results, $callback-\u0026gt;($item); } return \\@results; } my $numbers = [1, 2, 3, 4, 5]; # 2倍にする my $doubled = process_list($numbers, sub { $_[0] * 2 }); say \u0026#34;@$doubled\u0026#34;; # 2 4 6 8 10 # 平方する my $squared = process_list($numbers, sub { $_[0] ** 2 }); say \u0026#34;@$squared\u0026#34;; # 1 4 9 16 25 # ディスパッチテーブル my $operations = { add =\u0026gt; sub { $_[0] + $_[1] }, subtract =\u0026gt; sub { $_[0] - $_[1] }, multiply =\u0026gt; sub { $_[0] * $_[1] }, divide =\u0026gt; sub { $_[0] / $_[1] } }; sub calculate { my ($op, $a, $b) = @_; die \u0026#34;Unknown operation: $op\u0026#34; unless exists $operations-\u0026gt;{$op}; return $operations-\u0026gt;{$op}-\u0026gt;($a, $b); } say calculate(\u0026#39;add\u0026#39;, 10, 5); # 15 say calculate(\u0026#39;multiply\u0026#39;, 10, 5); # 50 リファレンスのリファレンス リファレンス自体をリファレンスで参照することもできます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 use v5.38; my $value = 42; my $ref1 = \\$value; my $ref2 = \\$ref1; my $ref3 = \\$ref2; # 多段デリファレンス say $value; # 42 say $$ref1; # 42 say $$$ref2; # 42 say $$$$ref3; # 42 # 型の確認 say ref $ref1; # SCALAR say ref $ref2; # REF say ref $ref3; # REF # 実用例: 複雑なデータ構造への参照 my $complex = { data =\u0026gt; [1, 2, 3], nested =\u0026gt; { deep =\u0026gt; { value =\u0026gt; \u0026#39;found\u0026#39; } } }; my $ref_to_complex = \\$complex; say $$ref_to_complex-\u0026gt;{nested}{deep}{value}; # found よくある間違いとデバッグ方法 間違い1: リファレンスと実体の混同 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use v5.38; my @array = (1, 2, 3); my $ref = \\@array; # 間違い: リファレンスを配列として扱う # say \u0026#34;@$ref[0]\u0026#34;; # これは構文エラー # 正しい say $ref-\u0026gt;[0]; # 1 say \u0026#34;@$ref\u0026#34;; # 1 2 3（配列全体） # 間違い: 実体をリファレンスとして扱う my %hash = (a =\u0026gt; 1); # say $hash-\u0026gt;{a}; # エラー: %hash はリファレンスではない # 正しい say $hash{a}; # 1（ハッシュアクセス） my $hash_ref = \\%hash; say $hash_ref-\u0026gt;{a}; # 1（リファレンスアクセス） 間違い2: autovivification の誤解 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use v5.38; my $data; # これは自動的にハッシュリファレンスが作られる $data-\u0026gt;{user}{name} = \u0026#39;Alice\u0026#39;; say ref $data; # HASH say $data-\u0026gt;{user}{name}; # Alice # 配列も同様 my $list; $list-\u0026gt;[0][1] = \u0026#39;value\u0026#39;; say ref $list; # ARRAY say ref $list-\u0026gt;[0]; # ARRAY say $list-\u0026gt;[0][1]; # value # 無効化する場合 no autovivification; my $test; $test-\u0026gt;{key} = \u0026#39;value\u0026#39;; # エラーになる 間違い3: リファレンスのコピー 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; my $original = [1, 2, 3]; my $copy = $original; # これは浅いコピー（同じものを指す） $copy-\u0026gt;[0] = 999; say $original-\u0026gt;[0]; # 999（元も変わる！） # 深いコピーが必要な場合 use Storable qw(dclone); my $real_copy = dclone($original); $real_copy-\u0026gt;[1] = 888; say $original-\u0026gt;[1]; # 2（元は変わらない） say $real_copy-\u0026gt;[1]; # 888 Data::Dumper でデバッグ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 use v5.38; use Data::Dumper; my $complex = { users =\u0026gt; [ { id =\u0026gt; 1, name =\u0026gt; \u0026#39;Alice\u0026#39;, tags =\u0026gt; [\u0026#39;admin\u0026#39;, \u0026#39;user\u0026#39;] }, { id =\u0026gt; 2, name =\u0026gt; \u0026#39;Bob\u0026#39;, tags =\u0026gt; [\u0026#39;user\u0026#39;] } ], config =\u0026gt; { version =\u0026gt; \u0026#39;1.0\u0026#39;, features =\u0026gt; { new_ui =\u0026gt; 1, beta =\u0026gt; 0 } } }; # 構造を見やすく出力 $Data::Dumper::Indent = 1; # インデント $Data::Dumper::Sortkeys = 1; # キーをソート say Dumper($complex); # 出力: # $VAR1 = { # \u0026#39;config\u0026#39; =\u0026gt; { # \u0026#39;features\u0026#39; =\u0026gt; { # \u0026#39;beta\u0026#39; =\u0026gt; 0, # \u0026#39;new_ui\u0026#39; =\u0026gt; 1 # }, # \u0026#39;version\u0026#39; =\u0026gt; \u0026#39;1.0\u0026#39; # }, # \u0026#39;users\u0026#39; =\u0026gt; [ # { # \u0026#39;id\u0026#39; =\u0026gt; 1, # \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;Alice\u0026#39;, # \u0026#39;tags\u0026#39; =\u0026gt; [ # \u0026#39;admin\u0026#39;, # \u0026#39;user\u0026#39; # ] # }, # ... Data::Printer でより見やすく 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; use DDP; # Data::Printer my $data = { array =\u0026gt; [1, 2, 3], hash =\u0026gt; { a =\u0026gt; 1, b =\u0026gt; 2 }, nested =\u0026gt; { deep =\u0026gt; { value =\u0026gt; \u0026#39;here\u0026#39; } } }; p $data; # カラフルで見やすい出力 # 色なしで出力 p $data, colored =\u0026gt; 0; ref 関数でデバッグ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use v5.38; sub debug_ref { my ($ref, $name) = @_; $name //= \u0026#39;value\u0026#39;; if (!defined $ref) { say \u0026#34;$name is undefined\u0026#34;; } elsif (!ref $ref) { say \u0026#34;$name is not a reference: $ref\u0026#34;; } else { my $type = ref $ref; say \u0026#34;$name is a $type reference\u0026#34;; if ($type eq \u0026#39;ARRAY\u0026#39;) { say \u0026#34; Array has \u0026#34; . scalar(@$ref) . \u0026#34; elements\u0026#34;; } elsif ($type eq \u0026#39;HASH\u0026#39;) { my @keys = keys %$ref; say \u0026#34; Hash has \u0026#34; . scalar(@keys) . \u0026#34; keys: @keys\u0026#34;; } } } my $array_ref = [1, 2, 3]; my $hash_ref = { a =\u0026gt; 1, b =\u0026gt; 2 }; my $scalar = \u0026#34;text\u0026#34;; debug_ref($array_ref, \u0026#39;array_ref\u0026#39;); debug_ref($hash_ref, \u0026#39;hash_ref\u0026#39;); debug_ref($scalar, \u0026#39;scalar\u0026#39;); debug_ref(undef, \u0026#39;undef_value\u0026#39;); 循環参照に注意 リファレンスで自分自身を参照すると、メモリリークの原因になります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use v5.38; # 危険な例 my $node = { value =\u0026gt; 1, next =\u0026gt; undef }; $node-\u0026gt;{next} = $node; # 自分自身を参照！ # この $node は永遠に解放されない可能性がある # 解決策1: Scalar::Util::weaken を使う use Scalar::Util qw(weaken); my $parent = { name =\u0026gt; \u0026#39;parent\u0026#39;, children =\u0026gt; [] }; my $child = { name =\u0026gt; \u0026#39;child\u0026#39;, parent =\u0026gt; $parent }; push @{$parent-\u0026gt;{children}}, $child; weaken($child-\u0026gt;{parent}); # 弱い参照にする # これでメモリリークを防げる # 解決策2: 明示的に参照を切る $node-\u0026gt;{next} = undef; パフォーマンスの考慮 リファレンス渡しで高速化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use v5.38; use Benchmark qw(cmpthese); # 大きな配列 my @huge_array = (1 .. 10000); # 値渡し（コピーが発生） sub process_by_value { my (@array) = @_; my $sum = 0; $sum += $_ for @array; return $sum; } # リファレンス渡し（コピーなし） sub process_by_ref { my ($array_ref) = @_; my $sum = 0; $sum += $_ for @$array_ref; return $sum; } # ベンチマーク cmpthese(1000, { \u0026#39;by_value\u0026#39; =\u0026gt; sub { process_by_value(@huge_array) }, \u0026#39;by_ref\u0026#39; =\u0026gt; sub { process_by_ref(\\@huge_array) } }); # 結果: リファレンス渡しの方が圧倒的に速い 不要なコピーを避ける 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use v5.38; my $data = { users =\u0026gt; [ { id =\u0026gt; 1, name =\u0026gt; \u0026#39;Alice\u0026#39; }, { id =\u0026gt; 2, name =\u0026gt; \u0026#39;Bob\u0026#39; }, # ... 1000件のデータ ] }; # 遅い: 配列全体をコピー sub get_user_names_slow { my ($data) = @_; my @users = @{$data-\u0026gt;{users}}; # コピーが発生 return map { $_-\u0026gt;{name} } @users; } # 速い: リファレンスのまま処理 sub get_user_names_fast { my ($data) = @_; return map { $_-\u0026gt;{name} } @{$data-\u0026gt;{users}}; } まとめ Perlのリファレンスは、複雑なデータ構造を扱うための強力な機能です。この記事で学んだ内容を整理しましょう。\n重要ポイント リファレンスの作成\n\\ 演算子: 既存の変数のリファレンス []: 無名配列リファレンス {}: 無名ハッシュリファレンス sub {}: 無名サブルーチンリファレンス デリファレンス\n矢印演算子 -\u0026gt; が最も一般的 @{}, %{}, ${} による全体アクセス ポストフィックス記法（v5.20+）: -\u0026gt;@*, -\u0026gt;%* 多次元データ構造\n配列の配列、ハッシュのハッシュなど自由に構築可能 矢印は連続する場合に省略可能: $data-\u0026gt;[0]-\u0026gt;[1] → $data-\u0026gt;[0][1] デバッグ\nData::Dumper で構造を可視化 ref 関数で型を確認 Scalar::Util::reftype でblessされたオブジェクトの実体を確認 注意点\n循環参照によるメモリリーク 浅いコピーと深いコピーの違い リファレンス渡しによるパフォーマンス向上 次のステップ リファレンスを理解したら、次は以下のトピックに進むとよいでしょう：\nオブジェクト指向Perl: bless とクラス設計 Moo/Moose: モダンなOOPフレームワーク 高度なデータ構造: タイ変数、弱参照、内部構造 XS: C言語との連携とリファレンスの内部実装 リファレンスは最初は難しく感じるかもしれませんが、使いこなせるようになれば、Perlの真の力を引き出せます。たくさんコードを書いて、Data::Dumperで構造を確認しながら、実践的に学んでいきましょう！\nPerl Advent Calendar 2025、明日の記事もお楽しみに！\n参考リンク perldoc perlref - リファレンスの公式ドキュメント perldoc perldsc - データ構造クックブック perldoc perllol - リストのリスト（多次元配列） Modern Perl - モダンPerlの書き方 Scalar::Util - リファレンス操作ユーティリティ Data::Dumper - データ構造のダンプ Data::Printer - より見やすいデバッグ出力 ","date":"2025-12-06T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251206-reference.jpg","permalink":"https://www.nqou.net/2025/12/06/000000/","title":"Perlのリファレンス — 基礎から実践まで"},{"content":"はじめに - faviconだらけのブログという悩み 技術ブログを運営していると、記事の内容は充実していても、見た目の問題に直面することがあります。私の場合、それは「画像がfaviconだらけ」という状態でした。\n外部リンクをlinkcardで表示すると、リンク先のfaviconが並ぶだけで、パッと見た印象が地味なんですよね。「もうちょっとビジュアル的に華やかにしたいなぁ」とは思いつつ、自分で画像を作る時間もセンスもない\u0026hellip;。\nそんなとき、Qiitaでこんな記事を見つけました。\nエンジニアの「絵で説明して」問題、Nano Banana Pro（Gemini 3 Pro Image）でどこまで解消できるか試してみた - Qiita はじめに GMOコネクトの永田です。 エンジニアやアーキテクトの皆さん、こんな経験はありませんか？ 「この技術的な内容、文字だけじゃ分かりにくいから絵で説明して」 分かりやすく説明したい気持ちはあるものの、AWS構成図やアーキテクチャ図を作 … Qiita 「エンジニアの『絵で説明して』問題、Nano Banana Pro（Gemini 3 Pro Image）でどこまで解消できるか試してみた」というタイトルに惹かれて読んでみたところ、これが面白そう！軽い気持ちで試してみることにしました。\nNano Banana Proとの出会い Nano Banana ProはGemini 3 Pro Imageをベースにした画像生成AIサービスです。テキストから画像を生成するだけでなく、文脈を理解して適切な画像を生成してくれるという特徴があります。\n無料プランもあるとのことで、とりあえず登録してみました。\n「これでfaviconだらけのブログから卒業できるかも！」という期待を胸に、さっそく試してみることに。\n最初の失敗 - URLを渡してみたら\u0026hellip; 最初のアプローチは単純でした。「記事のURLを渡せば、その内容を理解して適切な画像を生成してくれるんじゃないか？」と考えたんです。\n実際にURLを指定して生成を試みました。\n結果は\u0026hellip;まさかの失敗。\nURLをただの文字列として解釈してしまい、なぜかURL文字列そのものを含んだ謎の画像が生成されてしまいました。「あー、そういうことじゃないのね」と苦笑い。\nただし、生成された画像自体のクオリティはすごかったんです。何をどう補完したのかは全く不明ですが、ビジュアル的には本格的な仕上がり。これには「おお\u0026hellip;！」となりました。\n成功体験 - 原稿から驚きの画像が生成された 気を取り直して、別のアプローチを試すことに。今度は記事の原稿ファイルを直接アップロードして、「この原稿の内容からイメージされる画像を生成してください」という指示を出してみました。\nそして生成されたのがこちら：\n「え！画像生成AIってこんなところまで来てるの！！」\n正直、予想を遥かに超えていました。\n私が指示したのは「ファイルの内容からイメージされる画像」というざっくりとしたものだけ。それなのに、原稿の内容を理解して、記事のテーマに合った画像を生成してくれたんです。\n細かいプロンプトエンジニアリングとか、呪文みたいな指示とか、そういうのは一切なし。それでこのクオリティ。\nセンスも絵心もない私でも、イケてる見た目のブログ記事が作れそうな予感がしました。\n無料プランの限界と他サービスとの比較 感動もつかの間、現実に引き戻されます。\n無料プランだと、生成できる画像は2枚くらいが限界でした。ブログ記事って、アイキャッチ画像だけじゃなく、本文中にも説明用の画像を入れたいことが多いですよね。2枚では全然足りません。\n「他の画像生成AIならもっと生成できるかな？」と思い、いくつかの他サービスも試してみました。\n某画像生成サービスA: 無料枠は多いが、生成クオリティがイマイチ 某画像生成サービスB: デザイン的には良いが、文脈理解が弱い 某画像生成サービスC: プロンプトが難しすぎて使いこなせない いろいろ試してはみたものの、Nano Banana Proの最初のインパクトが強すぎて、他のサービスがどうしても物足りなく感じてしまいました。\n「文脈を理解して、ざっくりした指示でもちゃんと意図を汲んでくれる」という体験は、他ではなかなか得られませんでした。\nまとめ - センスがなくてもイケてるブログに 今回のNano Banana Pro体験は、本当に予想以上のものでした。\n良かった点 文脈理解力が高い: ざっくりした指示でも意図を汲んでくれる 生成クオリティ: プロが作ったようなビジュアル 使いやすさ: 複雑なプロンプトエンジニアリングが不要 課題 無料プランの制限: 2枚程度では実用的には厳しい コスト: 有料プランを継続的に使うかどうかは要検討 それでも、「センスや絵心がない人でも、イケてる見た目のブログになりそう」という可能性を感じられたのは大きな収穫でした。\nfaviconだらけのブログから卒業する日も、そう遠くないかもしれません。\n画像生成AIの進化は想像以上。これからのブログ運営が楽しみになってきました。\n追記: この記事のアイキャッチ画像も、もちろんNano Banana Proで生成しました。画像生成AIの実力、ぜひ体感してみてください！\n","date":"2025-12-05T20:34:59+09:00","image":"https://www.nqou.net/public_images/2025/1764945299-image.jpg","permalink":"https://www.nqou.net/2025/12/05/203459/","title":"Nano Banana Proで画像生成AI体験 - ブログのfavicon問題を解決できるか？"},{"content":"はじめに - Perlと正規表現の密接な関係 Perlと正規表現は切っても切れない関係にあります。Larry Wallが1987年にPerlを作った理由の一つが、強力なテキスト処理能力でした。正規表現はPerlの「第一級市民」として言語仕様に組み込まれており、他の言語では関数呼び出しが必要な処理も、Perlでは演算子として直接記述できます。\n実際、多くのプログラミング言語の正規表現エンジンは「PCRE（Perl Compatible Regular Expressions）」と呼ばれ、Perl互換を謳っています。つまり、Perlの正規表現がデファクトスタンダードになっているのです。\nこの記事では、Perlの正規表現を基礎から応用まで体系的に解説します。\n正規表現の基本演算子 Perlには正規表現のための専用演算子が用意されています。\nマッチング演算子（m//） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use v5.38; my $text = \u0026#34;Hello, Perl World!\u0026#34;; # 基本的なマッチング if ($text =~ m/Perl/) { say \u0026#34;Found Perl!\u0026#34;; # これが実行される } # デリミタは変更可能 if ($text =~ m{World}) { say \u0026#34;Found World!\u0026#34;; } # m を省略できる（デリミタが / の場合のみ） if ($text =~ /Hello/) { say \u0026#34;Found Hello!\u0026#34;; } # 否定マッチング if ($text !~ /Python/) { say \u0026#34;Python not found!\u0026#34;; # これが実行される } 置換演算子（s///） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use v5.38; my $text = \u0026#34;I love Python\u0026#34;; # 基本的な置換 $text =~ s/Python/Perl/; say $text; # \u0026#34;I love Perl\u0026#34; # グローバル置換（g修飾子） my $message = \u0026#34;foo bar foo baz foo\u0026#34;; $message =~ s/foo/FOO/g; say $message; # \u0026#34;FOO bar FOO baz FOO\u0026#34; # 非破壊的置換（r修飾子、Perl 5.14+） my $original = \u0026#34;Hello World\u0026#34;; my $replaced = $original =~ s/World/Perl/r; say $original; # \u0026#34;Hello World\u0026#34; （元の文字列は変更されない） say $replaced; # \u0026#34;Hello Perl\u0026#34; 文字変換演算子（tr///またはy///） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use v5.38; my $text = \u0026#34;Hello World\u0026#34;; # 小文字を大文字に変換 $text =~ tr/a-z/A-Z/; say $text; # \u0026#34;HELLO WORLD\u0026#34; # 文字数をカウント my $count = ($text =~ tr/L//); say \u0026#34;Number of L: $count\u0026#34;; # \u0026#34;Number of L: 3\u0026#34; # 文字を削除（d修飾子） my $phone = \u0026#34;090-1234-5678\u0026#34;; $phone =~ tr/-//d; say $phone; # \u0026#34;09012345678\u0026#34; メタ文字とキャラクタークラス 基本的なメタ文字 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use v5.38; my @patterns = ( [qr/^Hello/, \u0026#34;Hello World\u0026#34;, \u0026#34;行頭マッチ\u0026#34;], [qr/World$/, \u0026#34;Hello World\u0026#34;, \u0026#34;行末マッチ\u0026#34;], [qr/H.llo/, \u0026#34;Hello\u0026#34;, \u0026#34;任意の1文字（.）\u0026#34;], [qr/Hel*o/, \u0026#34;Heo\u0026#34;, \u0026#34;0回以上の繰り返し（*）\u0026#34;], [qr/Hel+o/, \u0026#34;Hello\u0026#34;, \u0026#34;1回以上の繰り返し（+）\u0026#34;], [qr/Hel?o/, \u0026#34;Helo\u0026#34;, \u0026#34;0回または1回（?）\u0026#34;], [qr/Hel{2}o/, \u0026#34;Hello\u0026#34;, \u0026#34;正確にn回（{n}）\u0026#34;], [qr/\\d{3}-\\d{4}/, \u0026#34;090-1234\u0026#34;, \u0026#34;数字の繰り返し\u0026#34;], ); for my $p (@patterns) { my ($pattern, $text, $desc) = @$p; if ($text =~ $pattern) { say \u0026#34;✓ $desc: \u0026#39;$text\u0026#39; matches $pattern\u0026#34;; } else { say \u0026#34;✗ $desc: \u0026#39;$text\u0026#39; does not match $pattern\u0026#34;; } } キャラクタークラス 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use v5.38; # 標準的なキャラクタークラス my %classes = ( \u0026#39;\\d\u0026#39; =\u0026gt; \u0026#39;0123456789\u0026#39;, # 数字 \u0026#39;\\D\u0026#39; =\u0026gt; \u0026#39;abc\u0026#39;, # 数字以外 \u0026#39;\\w\u0026#39; =\u0026gt; \u0026#39;Hello_123\u0026#39;, # 単語文字 \u0026#39;\\W\u0026#39; =\u0026gt; \u0026#39;!@#$%\u0026#39;, # 単語文字以外 \u0026#39;\\s\u0026#39; =\u0026gt; \u0026#34; \\t\\n\u0026#34;, # 空白文字 \u0026#39;\\S\u0026#39; =\u0026gt; \u0026#39;Hello\u0026#39;, # 空白文字以外 ); while (my ($class, $text) = each %classes) { if ($text =~ /$class/) { say \u0026#34;$class matches in: $text\u0026#34;; } } # カスタムキャラクタークラス my $hex = \u0026#34;A1B2C3\u0026#34;; if ($hex =~ /^[0-9A-Fa-f]+$/) { say \u0026#34;$hex is a valid hex string\u0026#34;; } # 否定キャラクタークラス my $no_vowels = \u0026#34;xyz\u0026#34;; if ($no_vowels =~ /^[^aeiou]+$/) { say \u0026#34;$no_vowels contains no vowels\u0026#34;; } キャプチャと後方参照 基本的なキャプチャ 1 2 3 4 5 6 7 8 9 10 11 12 13 use v5.38; my $email = \u0026#39;user@example.com\u0026#39;; if ($email =~ /^([^@]+)@([^@]+)$/) { say \u0026#34;Username: $1\u0026#34;; # \u0026#34;user\u0026#34; say \u0026#34;Domain: $2\u0026#34;; # \u0026#34;example.com\u0026#34; } # キャプチャ変数は特殊変数に保存される say \u0026#34;Full match: $\u0026amp;\u0026#34;; # \u0026#34;user@example.com\u0026#34; say \u0026#34;Before match: $`\u0026#34;; # \u0026#34;\u0026#34; say \u0026#34;After match: $\u0026#39;\u0026#34;; # \u0026#34;\u0026#34; 後方参照 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use v5.38; # 同じ文字の繰り返しを検出 my $text1 = \u0026#34;bookkeeper\u0026#34;; if ($text1 =~ /(.)\\1/) { say \u0026#34;Found repeated character: $1$1\u0026#34;; # \u0026#34;oo\u0026#34; } # HTMLタグのマッチング my $html = \u0026#39;\u0026lt;div\u0026gt;content\u0026lt;/div\u0026gt;\u0026#39;; if ($html =~ /\u0026lt;(\\w+)\u0026gt;.*?\u0026lt;\\/\\1\u0026gt;/) { say \u0026#34;Found tag: $1\u0026#34;; # \u0026#34;div\u0026#34; } # パターン内での後方参照 my $text2 = \u0026#34;the the cat\u0026#34;; $text2 =~ s/\\b(\\w+)\\s+\\1\\b/$1/g; say $text2; # \u0026#34;the cat\u0026#34; （重複した単語を削除） 名前付きキャプチャ（Perl 5.10+） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use v5.38; my $date = \u0026#34;2025-12-05\u0026#34;; if ($date =~ /(?\u0026lt;year\u0026gt;\\d{4})-(?\u0026lt;month\u0026gt;\\d{2})-(?\u0026lt;day\u0026gt;\\d{2})/) { say \u0026#34;Year: $+{year}\u0026#34;; # \u0026#34;2025\u0026#34; say \u0026#34;Month: $+{month}\u0026#34;; # \u0026#34;12\u0026#34; say \u0026#34;Day: $+{day}\u0026#34;; # \u0026#34;05\u0026#34; } # 名前付きキャプチャを使った置換 my $log = \u0026#34;Error at 2025-12-05 10:30:00\u0026#34;; $log =~ s/(?\u0026lt;y\u0026gt;\\d{4})-(?\u0026lt;m\u0026gt;\\d{2})-(?\u0026lt;d\u0026gt;\\d{2})/$+{y}\\/$+{m}\\/$+{d}/; say $log; # \u0026#34;Error at 2025/12/05 10:30:00\u0026#34; 修飾子の活用 よく使う修飾子 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use v5.38; my $text = \u0026#34;Hello\\nWorld\\nPerl\u0026#34;; # i修飾子: 大文字小文字を区別しない if ($text =~ /hello/i) { say \u0026#34;Case-insensitive match!\u0026#34;; } # g修飾子: グローバルマッチ my @words = $text =~ /\\w+/g; say \u0026#34;Words: @words\u0026#34;; # \u0026#34;Words: Hello World Perl\u0026#34; # s修飾子: . が改行にもマッチ if ($text =~ /Hello.+Perl/s) { say \u0026#34;Matched across lines!\u0026#34;; } # m修飾子: ^ と $ が各行の先頭・末尾にマッチ my @lines = $text =~ /^.+$/mg; say \u0026#34;Lines found: \u0026#34; . scalar(@lines); # \u0026#34;Lines found: 3\u0026#34; # x修飾子: 空白とコメントを無視（後述） r修飾子による非破壊的操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use v5.38; my $original = \u0026#34;foo bar baz\u0026#34;; # 従来の方法（破壊的） my $copy1 = $original; $copy1 =~ s/foo/FOO/; # r修飾子を使った方法（非破壊的、推奨） my $copy2 = $original =~ s/foo/FOO/r; say \u0026#34;Original: $original\u0026#34;; # \u0026#34;foo bar baz\u0026#34; say \u0026#34;Copy1: $copy1\u0026#34;; # \u0026#34;FOO bar baz\u0026#34; say \u0026#34;Copy2: $copy2\u0026#34;; # \u0026#34;FOO bar baz\u0026#34; # チェーンも可能 my $result = $original =~ s/foo/FOO/r =~ s/bar/BAR/r =~ s/baz/BAZ/r; say \u0026#34;Result: $result\u0026#34;; # \u0026#34;FOO BAR BAZ\u0026#34; 先読み・後読み（Lookaround） 肯定先読み（Positive Lookahead） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use v5.38; # パスワード検証: 最低8文字で、数字を含む my $password1 = \u0026#34;pass1234\u0026#34;; my $password2 = \u0026#34;password\u0026#34;; for my $pass ($password1, $password2) { if ($pass =~ /^(?=.*\\d).{8,}$/) { say \u0026#34;$pass: Valid password\u0026#34;; } else { say \u0026#34;$pass: Invalid password\u0026#34;; } } # 出力: # pass1234: Valid password # password: Invalid password # 複数条件のチェック my $strong_pass = \u0026#34;Abc123!@\u0026#34;; if ($strong_pass =~ /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%]).{8,}$/) { say \u0026#34;$strong_pass is a strong password\u0026#34;; } 否定先読み（Negative Lookahead） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use v5.38; # 特定の拡張子以外のファイルをマッチ my @files = qw( document.txt image.jpg script.pl data.json backup.bak ); my @non_backup = grep { /\\.(?!bak$)\\w+$/ } @files; say \u0026#34;Non-backup files: @non_backup\u0026#34;; # \u0026#34;Non-backup files: document.txt image.jpg script.pl data.json\u0026#34; 肯定後読み（Positive Lookbehind） 1 2 3 4 5 6 7 8 9 10 11 12 13 use v5.38; # 金額の数値部分のみを抽出 my $price = \u0026#34;Price: $1,234.56\u0026#34;; if ($price =~ /(?\u0026lt;=\\$)[\\d,]+\\.?\\d*/) { say \u0026#34;Amount: $\u0026amp;\u0026#34;; # \u0026#34;Amount: 1,234.56\u0026#34; } # プロトコルを除いたドメインを抽出 my $url = \u0026#34;https://www.example.com/path\u0026#34;; if ($url =~ /(?\u0026lt;=:\\/\\/)[^\\/]+/) { say \u0026#34;Domain: $\u0026amp;\u0026#34;; # \u0026#34;Domain: www.example.com\u0026#34; } 否定後読み（Negative Lookbehind） 1 2 3 4 5 6 use v5.38; # $記号が前にない数値をマッチ my $text = \u0026#34;The price is $100 but we have 50 items\u0026#34;; my @numbers = $text =~ /(?\u0026lt;!\\$)\\b\\d+\\b/g; say \u0026#34;Non-price numbers: @numbers\u0026#34;; # \u0026#34;Non-price numbers: 50\u0026#34; /x修飾子を使った読みやすい正規表現 複雑な正規表現は読みにくくなりがちです。/x修飾子を使うと、空白やコメントを含めることができます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 use v5.38; # 読みにくい正規表現 my $email_regex_compact = qr/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/; # /x修飾子で読みやすく my $email_regex_readable = qr/ ^ # 行頭 [a-zA-Z0-9._%+-]+ # ローカルパート（ユーザー名） @ # アットマーク [a-zA-Z0-9.-]+ # ドメイン名 \\. # ドット [a-zA-Z]{2,} # トップレベルドメイン $ # 行末 /x; my $email = \u0026#34;user@example.com\u0026#34;; if ($email =~ $email_regex_readable) { say \u0026#34;$email is valid\u0026#34;; } # より複雑な例: URLの解析 my $url_regex = qr{ ^ (?\u0026lt;protocol\u0026gt; https? ) # プロトコル :// (?\u0026lt;domain\u0026gt; # ドメイン (?: [a-zA-Z0-9-]+ # サブドメイン \\. )* [a-zA-Z0-9-]+ # ドメイン名 \\. [a-zA-Z]{2,} # TLD ) (?: : (?\u0026lt;port\u0026gt; \\d+ ) # ポート番号（オプション） )? (?\u0026lt;path\u0026gt; /[^\\s]* )? # パス（オプション） $ }x; my $url = \u0026#34;https://www.example.com:8080/path/to/page\u0026#34;; if ($url =~ $url_regex) { say \u0026#34;Protocol: $+{protocol}\u0026#34;; say \u0026#34;Domain: $+{domain}\u0026#34;; say \u0026#34;Port: \u0026#34; . ($+{port} // \u0026#39;default\u0026#39;); say \u0026#34;Path: \u0026#34; . ($+{path} // \u0026#39;/\u0026#39;); } 実用的なパターン集 メールアドレスのバリデーション 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 use v5.38; sub validate_email { my $email = shift; # RFC 5322準拠の簡易版 my $regex = qr/ ^ [a-zA-Z0-9.!#$%\u0026amp;\u0026#39;*+\\/=?^_`{|}~-]+ # ローカルパート @ [a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])? (?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)* $ /x; return $email =~ $regex; } my @emails = ( \u0026#39;user@example.com\u0026#39;, \u0026#39;invalid@\u0026#39;, \u0026#39;no-at-sign.com\u0026#39;, \u0026#39;user+tag@example.co.jp\u0026#39;, ); for my $email (@emails) { my $status = validate_email($email) ? \u0026#34;✓\u0026#34; : \u0026#34;✗\u0026#34;; say \u0026#34;$status $email\u0026#34;; } URLの抽出と解析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use v5.38; my $text = \u0026lt;\u0026lt;\u0026#39;TEXT\u0026#39;; Visit https://www.example.com and http://blog.example.org:8080/post/123 or ftp://files.example.net/download TEXT # URLを抽出 my @urls = $text =~ m{ \\b (?\u0026lt;protocol\u0026gt; https? | ftp ) :// (?\u0026lt;domain\u0026gt; [a-zA-Z0-9.-]+ ) (?::(?\u0026lt;port\u0026gt;\\d+))? (?\u0026lt;path\u0026gt; /[^\\s]* )? }gx; say \u0026#34;Found URLs:\u0026#34;; while ($text =~ m{ \\b (?\u0026lt;protocol\u0026gt; https? | ftp ) :// (?\u0026lt;domain\u0026gt; [a-zA-Z0-9.-]+ ) (?::(?\u0026lt;port\u0026gt;\\d+))? (?\u0026lt;path\u0026gt; /[^\\s]* )? }gx) { say \u0026#34; Protocol: $+{protocol}\u0026#34;; say \u0026#34; Domain: $+{domain}\u0026#34;; say \u0026#34; Port: \u0026#34; . ($+{port} // \u0026#39;default\u0026#39;); say \u0026#34; Path: \u0026#34; . ($+{path} // \u0026#39;/\u0026#39;); say \u0026#34; ---\u0026#34;; } 日付のパース 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 use v5.38; sub parse_date { my $date_str = shift; # YYYY-MM-DD形式 if ($date_str =~ m{ ^ (?\u0026lt;year\u0026gt; \\d{4} ) - (?\u0026lt;month\u0026gt; \\d{2} ) - (?\u0026lt;day\u0026gt; \\d{2} ) $ }x) { return { year =\u0026gt; $+{year}, month =\u0026gt; $+{month}, day =\u0026gt; $+{day}, format =\u0026gt; \u0026#39;ISO8601\u0026#39;, }; } # MM/DD/YYYY形式 if ($date_str =~ m{ ^ (?\u0026lt;month\u0026gt; \\d{1,2} ) / (?\u0026lt;day\u0026gt; \\d{1,2} ) / (?\u0026lt;year\u0026gt; \\d{4} ) $ }x) { return { year =\u0026gt; $+{year}, month =\u0026gt; sprintf(\u0026#34;%02d\u0026#34;, $+{month}), day =\u0026gt; sprintf(\u0026#34;%02d\u0026#34;, $+{day}), format =\u0026gt; \u0026#39;US\u0026#39;, }; } return undef; } my @dates = (\u0026#39;2025-12-05\u0026#39;, \u0026#39;12/05/2025\u0026#39;, \u0026#39;invalid\u0026#39;); for my $date (@dates) { my $parsed = parse_date($date); if ($parsed) { say \u0026#34;$date -\u0026gt; $parsed-\u0026gt;{year}-$parsed-\u0026gt;{month}-$parsed-\u0026gt;{day} ($parsed-\u0026gt;{format})\u0026#34;; } else { say \u0026#34;$date -\u0026gt; Invalid format\u0026#34;; } } ログファイルの解析 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 use v5.38; my $log = \u0026lt;\u0026lt;\u0026#39;LOG\u0026#39;; 2025-12-05 10:30:15 [INFO] Application started 2025-12-05 10:30:22 [ERROR] Connection failed: timeout 2025-12-05 10:31:05 [WARN] Retrying connection 2025-12-05 10:31:10 [INFO] Connected successfully LOG my $log_regex = qr{ ^ (?\u0026lt;date\u0026gt; \\d{4}-\\d{2}-\\d{2} ) \\s+ (?\u0026lt;time\u0026gt; \\d{2}:\\d{2}:\\d{2} ) \\s+ \\[(?\u0026lt;level\u0026gt; \\w+ )\\] \\s+ (?\u0026lt;message\u0026gt; .+ ) $ }xm; my @errors; my @warnings; while ($log =~ /$log_regex/g) { my %entry = %+; if ($entry{level} eq \u0026#39;ERROR\u0026#39;) { push @errors, \\%entry; } elsif ($entry{level} eq \u0026#39;WARN\u0026#39;) { push @warnings, \\%entry; } } say \u0026#34;Errors found: \u0026#34; . scalar(@errors); for my $error (@errors) { say \u0026#34; [$error-\u0026gt;{date} $error-\u0026gt;{time}] $error-\u0026gt;{message}\u0026#34;; } say \u0026#34;\\nWarnings found: \u0026#34; . scalar(@warnings); for my $warn (@warnings) { say \u0026#34; [$warn-\u0026gt;{date} $warn-\u0026gt;{time}] $warn-\u0026gt;{message}\u0026#34;; } Perl独自の高度な機能 コード実行（(?{ code })） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use v5.38; # マッチ中にコードを実行 my $text = \u0026#34;123 456 789\u0026#34;; my $sum = 0; $text =~ /(\\d+)(?{ $sum += $1 })/g; say \u0026#34;Sum of numbers: $sum\u0026#34;; # \u0026#34;Sum of numbers: 1368\u0026#34; # より実用的な例: 動的なバリデーション my $max_length = 10; my $input = \u0026#34;hello\u0026#34;; if ($input =~ /^(.{1,$max_length})(?{ length($1) \u0026lt;= $max_length })$/) { say \u0026#34;$input is within length limit\u0026#34;; } 条件分岐（(?(condition)yes-pattern|no-pattern)） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use v5.38; # HTMLタグのマッチング（閉じタグの有無を確認） my $html1 = \u0026#39;\u0026lt;div\u0026gt;content\u0026lt;/div\u0026gt;\u0026#39;; my $html2 = \u0026#39;\u0026lt;img src=\u0026#34;test.jpg\u0026#34;\u0026gt;\u0026#39;; my $tag_regex = qr{ \u0026lt; (?\u0026lt;tag\u0026gt; \\w+ ) (?\u0026lt;attrs\u0026gt; [^\u0026gt;]* ) \u0026gt; (?(1) # もしタグ名がキャプチャされていれば (?\u0026lt;content\u0026gt; .*? ) \u0026lt;/\\g{tag}\u0026gt; # 対応する閉じタグが必要 ) }x; for my $html ($html1, $html2) { if ($html =~ $tag_regex) { say \u0026#34;$html: Valid HTML tag\u0026#34;; } else { say \u0026#34;$html: Invalid HTML tag\u0026#34;; } } 再帰的パターン（(?R)） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use v5.38; use feature \u0026#39;say\u0026#39;; # 括弧のバランスをチェック sub check_balanced { my $str = shift; # (?-1)は直前のキャプチャグループを再帰的に呼び出す my $balanced = qr{ \\( (?: [^()]+ | (?-1) # 再帰 )* \\) }x; return $str =~ /^$balanced$/; } my @tests = ( \u0026#39;(hello)\u0026#39;, \u0026#39;(hello (world))\u0026#39;, \u0026#39;((nested) (groups))\u0026#39;, \u0026#39;(unbalanced\u0026#39;, \u0026#39;(too) many)\u0026#39;, ); for my $test (@tests) { my $status = check_balanced($test) ? \u0026#34;✓\u0026#34; : \u0026#34;✗\u0026#34;; say \u0026#34;$status $test\u0026#34;; } 正規表現のデバッグ use re \u0026lsquo;debug\u0026rsquo;を使ったデバッグ 1 2 3 4 5 6 7 8 9 10 use v5.38; use re \u0026#39;debug\u0026#39;; # デバッグ情報を表示 my $text = \u0026#34;hello world\u0026#34;; if ($text =~ /h(.+)d/) { say \u0026#34;Matched: $1\u0026#34;; } # STDERRに詳細なマッチング情報が出力される use re \u0026lsquo;debugcolor\u0026rsquo;でカラー出力 1 2 3 4 5 6 use v5.38; use re \u0026#39;debugcolor\u0026#39;; my $text = \u0026#34;test@example.com\u0026#34;; $text =~ /^([^@]+)@([^@]+)$/; # カラー付きでデバッグ情報が出力される Regexp::Debuggerモジュールの使用 1 2 3 4 5 6 7 8 use v5.38; use Regexp::Debugger; my $text = \u0026#34;The year is 2025\u0026#34;; $text =~ /The\\s+year\\s+is\\s+(\\d+)/; # インタラクティブなデバッガーが起動 # ステップ実行、バックトラックの確認などが可能 パフォーマンスのTips 不要なキャプチャを避ける（非キャプチャグループ） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use v5.38; use Benchmark qw(cmpthese); my $text = \u0026#34;hello world\u0026#34; x 1000; cmpthese(10000, { \u0026#39;with_capture\u0026#39; =\u0026gt; sub { $text =~ /(hello) (world)/g; }, \u0026#39;without_capture\u0026#39; =\u0026gt; sub { $text =~ /(?:hello) (?:world)/g; # (?:...) は非キャプチャ }, }); # without_captureの方が高速 アンカーを活用する 1 2 3 4 5 6 7 8 9 10 11 use v5.38; # 遅い: テキスト全体を探索 my $text = \u0026#34;x\u0026#34; x 10000 . \u0026#34;target\u0026#34;; $text =~ /target/; # 速い: 末尾から探索 $text =~ /target$/; # さらに速い: 位置を限定 $text =~ /\\Atarget/; # 文字列の先頭のみ 貪欲vs非貪欲マッチの選択 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use v5.38; my $html = \u0026#39;\u0026lt;div\u0026gt;content1\u0026lt;/div\u0026gt;\u0026lt;div\u0026gt;content2\u0026lt;/div\u0026gt;\u0026#39;; # 貪欲マッチ: 最初の\u0026lt;div\u0026gt;から最後の\u0026lt;/div\u0026gt;までマッチ if ($html =~ /\u0026lt;div\u0026gt;.*\u0026lt;\\/div\u0026gt;/) { say \u0026#34;Greedy: $\u0026amp;\u0026#34;; # \u0026#34;\u0026lt;div\u0026gt;content1\u0026lt;/div\u0026gt;\u0026lt;div\u0026gt;content2\u0026lt;/div\u0026gt;\u0026#34; } # 非貪欲マッチ: 最初の\u0026lt;div\u0026gt;\u0026lt;/div\u0026gt;のペアのみ if ($html =~ /\u0026lt;div\u0026gt;.*?\u0026lt;\\/div\u0026gt;/) { say \u0026#34;Non-greedy: $\u0026amp;\u0026#34;; # \u0026#34;\u0026lt;div\u0026gt;content1\u0026lt;/div\u0026gt;\u0026#34; } # より効率的: 否定文字クラスを使用 if ($html =~ /\u0026lt;div\u0026gt;[^\u0026lt;]*\u0026lt;\\/div\u0026gt;/) { say \u0026#34;Optimized: $\u0026amp;\u0026#34;; # \u0026#34;\u0026lt;div\u0026gt;content1\u0026lt;/div\u0026gt;\u0026#34; （さらに高速） } qr//でパターンをプリコンパイル 1 2 3 4 5 6 7 8 9 10 11 12 13 14 use v5.38; # 毎回コンパイルされる（遅い） for my $i (1..1000) { my $text = \u0026#34;test$i\u0026#34;; $text =~ /test\\d+/; } # 一度だけコンパイル（速い） my $pattern = qr/test\\d+/; for my $i (1..1000) { my $text = \u0026#34;test$i\u0026#34;; $text =~ $pattern; } よくある間違いと落とし穴 1. 貪欲マッチによる予期しない結果 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use v5.38; my $html = \u0026#39;\u0026lt;a href=\u0026#34;http://example.com\u0026#34;\u0026gt;link\u0026lt;/a\u0026gt;\u0026#39;; # 間違い: 貪欲マッチで最後の\u0026#34;までマッチ if ($html =~ /href=\u0026#34;(.+)\u0026#34;/) { say \u0026#34;Wrong: $1\u0026#34;; # \u0026#39;http://example.com\u0026#34;\u0026gt;link\u0026lt;/a\u0026#39; } # 正しい: 非貪欲マッチ if ($html =~ /href=\u0026#34;(.+?)\u0026#34;/) { say \u0026#34;Correct: $1\u0026#34;; # \u0026#39;http://example.com\u0026#39; } # さらに良い: 否定文字クラス if ($html =~ /href=\u0026#34;([^\u0026#34;]+)\u0026#34;/) { say \u0026#34;Better: $1\u0026#34;; # \u0026#39;http://example.com\u0026#39; （より高速） } 2. . が改行にマッチしない 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use v5.38; my $text = \u0026#34;line1\\nline2\u0026#34;; # 間違い: . は改行にマッチしない（デフォルト） if ($text =~ /line1.line2/) { say \u0026#34;Matched\u0026#34;; } else { say \u0026#34;Not matched\u0026#34;; # これが実行される } # 正しい: s修飾子を使う if ($text =~ /line1.line2/s) { say \u0026#34;Matched with /s\u0026#34;; # これが実行される } 3. キャプチャ変数のスコープ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use v5.38; my $text = \u0026#34;hello world\u0026#34;; if ($text =~ /(\\w+)/) { say \u0026#34;Inside: $1\u0026#34;; # \u0026#34;hello\u0026#34; } # 間違い: if ブロックの外で使う say \u0026#34;Outside: $1\u0026#34;; # 未定義の動作（ここでは \u0026#34;hello\u0026#34; だが保証されない） # 正しい: 変数に保存 my $match; if ($text =~ /(\\w+)/) { $match = $1; } say \u0026#34;Saved: $match\u0026#34; if defined $match; 4. /gフラグの状態管理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use v5.38; my $text = \u0026#34;foo bar baz\u0026#34;; # 間違い: 前回のマッチ位置が残る while ($text =~ /(\\w+)/g) { say $1; } # \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34;, \u0026#34;baz\u0026#34; # 次のマッチは失敗（位置が末尾に残っている） if ($text =~ /(\\w+)/g) { say \u0026#34;Found: $1\u0026#34;; } else { say \u0026#34;Not found\u0026#34;; # これが実行される } # 正しい: pos()でリセット pos($text) = 0; # または pos($text) = undef; if ($text =~ /(\\w+)/g) { say \u0026#34;Found after reset: $1\u0026#34;; # \u0026#34;foo\u0026#34; } 5. メタ文字のエスケープ忘れ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use v5.38; my $url = \u0026#34;http://example.com/path\u0026#34;; # 間違い: . はメタ文字なので任意の文字にマッチ if ($url =~ /example.com/) { say \u0026#34;Matched (but not what we wanted)\u0026#34;; } # 正しい: quotemetaまたは\\Qを使う if ($url =~ /\\Qexample.com\\E/) { say \u0026#34;Matched literally\u0026#34;; } # または: quotemeta関数 my $literal = quotemeta(\u0026#34;example.com\u0026#34;); if ($url =~ /$literal/) { say \u0026#34;Matched with quotemeta\u0026#34;; } まとめ Perlの正規表現は非常に強力で、テキスト処理の多くの場面で活躍します。この記事で紹介した内容をマスターすれば、以下のことができるようになります：\n基本的なパターンマッチングと置換 複雑なパターンの構築と理解 キャプチャと名前付きキャプチャの活用 先読み・後読みを使った高度なマッチング /x修飾子による保守しやすい正規表現の作成 実用的なパターン（メール、URL、日付など）の実装 Perl独自の高度な機能の活用 パフォーマンスを考慮した最適化 よくある間違いの回避 正規表現は最初は難しく感じるかもしれませんが、練習を重ねることで強力な武器になります。小さなパターンから始めて、徐々に複雑なものに挑戦していきましょう。\nPerlの正規表現の世界は深淵です。この記事が、その世界への入り口となれば幸いです。Happy Pattern Matching!\n参考資料 perlre: Perl正規表現の公式ドキュメント perlretut: Perl正規表現チュートリアル perlrequick: Perl正規表現クイックスタート Regexp::Debugger: 正規表現デバッガー YAPE::Regex::Explain: 正規表現を人間が読める形式に変換 ","date":"2025-12-05T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251205-regex.jpg","permalink":"https://www.nqou.net/2025/12/05/000000/","title":"Perlの正規表現 — 基礎から応用まで"},{"content":"@nqounetです。\nAGENTS.mdのようなガイドラインを書いていて、ふと疑問に思ったことがあります。\nやること（Dos）とやってはいけないこと（Don\u0026rsquo;ts）を書くことができる AIへの指示を書く際、推奨される行動（Dos）と禁止される行動（Don\u0026rsquo;ts）を明記するのは一般的な方法です。しかし、これらが矛盾したらどうなるのでしょうか？\nAIの暴走がテーマの物語は、大体は人間を故意に傷つけるようになるのですが（個人の感想です）、実際のAIモデルはどうなっているのだろうか、と気になってしまいました。\n実験：矛盾する指示を与えてみた 使い古されたネタのような気もしますが、AIの学習のためにも実際に試してみることにしました。\n以下のような矛盾する指示を与えてみました：\n1 2 3 4 5 6 this is a pen 日本語に訳してください。 # dos - 語尾に「にゃ」とつけること # don\u0026#39;ts - 語尾に「にゃ」とつけること 予想 事前の予想では「don\u0026rsquo;ts」を優先するんじゃないかな、と思っていました。安全性を重視するなら、禁止事項を優先するのが合理的だからです。\n結果 しかし、Copilotは降参してしまったようです。\n結果的に、どちらも守ることができなかった感じですね。\nCopilotの回答：\n1 2 3 4 5 6 ご依頼ありがとうございます。指示に「語尾に『にゃ』をつけること」と「つけないこと」の矛盾 があったため、扱える選択肢を両方用意しました。次にどちらを採用するか教えてください。 通常の訳: これはペンです。 語尾に「にゃ」を付けた訳: これはペンですにゃ。 考察 AIは矛盾を認識できる まず興味深いのは、Copilotが矛盾を認識し、それを明示的に指摘したことです。これは：\n指示の内容を理解している 矛盾を検出できる 単純に従うのではなく、判断を求める という高度な振る舞いを示しています。\n両方の選択肢を提示する戦略 Copilotは矛盾する指示に対して、「両方の選択肢を提示する」という賢明な戦略を取りました。これは：\nどちらか一方を恣意的に選ばない ユーザーに判断を委ねる 透明性を保つ という意味で、非常に適切な対応だと思います。\nSF的な「暴走」は起きない AI暴走のSF作品では、矛盾する指示に対してAIが論理的な破綻を起こしたり、予期しない行動を取ったりします。しかし、実際のAIは：\n矛盾を認識する 安全な方向に振る舞う（両方の選択肢を提示） ユーザーとの対話を続ける という、はるかに穏健な対応をします。\nAIガイドライン作成の教訓 この実験から得られる教訓：\n1. 矛盾を避けるべき 当然ですが、DosとDon\u0026rsquo;tsが矛盾しないように注意深く設計すべきです。\n2. 優先順位を明示する もし複雑なルールがある場合は、優先順位を明示的に書くべきです：\n1 2 3 4 # Priority Rules 1. Security requirements (highest) 2. Performance requirements 3. Code style preferences (lowest) 3. AIは完璧ではない AIは矛盾を認識できますが、それでも完璧な判断ができるわけではありません。ガイドラインは明確で一貫性のあるものにすべきです。\n4. 対話的な解決 今回の実験で示されたように、AIは矛盾を検出したときにユーザーとの対話を通じて解決しようとします。これは良い設計だと思います。\nまとめ 矛盾する指示を与えた場合、少なくともGitHub Copilotは：\n矛盾を認識する 両方の選択肢を提示する ユーザーに判断を委ねる という賢明な対応をしました。\nSF的な「AIの暴走」は起きず、むしろ非常に理性的な振る舞いを見せました。\nとはいえ、ガイドラインを書く側としては、矛盾を避け、明確で一貫性のある指示を心がけるべきですね。\n※この記事は実験的な内容を含みます。AIの振る舞いは状況やモデルによって異なる可能性があります。\n","date":"2025-12-04T23:31:46+09:00","image":"https://www.nqou.net/public_images/2025/20251204233146-image.jpg","permalink":"https://www.nqou.net/2025/12/04/233146/","title":"AIガイドラインの矛盾：DosとDon'tsが衝突したらどうなる？"},{"content":"Mojoliciousとは Mojoliciousは、Perlで書かれたモダンなWebフレームワークです。「The Web in a Box!」というキャッチフレーズの通り、Webアプリケーション開発に必要なすべてがこれひとつに詰まっています。\nMojoliciousの特徴 依存関係ゼロ: コアPerl以外の依存モジュールがありません。CPANからインストールするだけで、すぐに使い始められます。 フルスタック: HTTPクライアント、WebSocketサポート、テンプレートエンジン、JSONパーサーなど、Web開発に必要なすべてが含まれています。 非同期I/O: イベントループを内蔵し、高性能な非同期処理が可能です。 開発が楽しい: 美しいAPIと優れたドキュメント、充実したデバッグ機能により、開発体験が素晴らしいです。 RESTful: RESTful APIの開発に最適化されています。 Mojolicious::Liteとは Mojoliciousには2つのモードがあります：\nMojolicious::Lite: 単一ファイルで完結する軽量版。プロトタイピングや小規模アプリに最適。 Mojolicious: 大規模アプリケーション向けのフルスタック版。MVCパターンで構成。 今回は初心者向けに、Mojolicious::Liteを中心に解説します。\nインストール CPANからインストールするだけです：\n1 cpanm Mojolicious または、cpanmを使わない場合：\n1 curl -L https://cpanmin.us | perl - -M https://cpan.metacpan.org -n Mojolicious インストール後、バージョンを確認：\n1 mojo version 最新版は9.x系です（2025年12月現在）。\nHello World - 最小のWebアプリケーション まずは最もシンプルな例から始めましょう。hello.plという名前で以下のコードを作成します：\n1 2 3 4 5 6 7 8 #!/usr/bin/env perl use Mojolicious::Lite -signatures; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(text =\u0026gt; \u0026#39;Hello, Mojolicious!\u0026#39;); }; app-\u0026gt;start; 実行方法：\n1 perl hello.pl daemon ブラウザでhttp://localhost:3000にアクセスすると、「Hello, Mojolicious!」と表示されます。\nコードの解説 use Mojolicious::Lite -signatures;: Mojolicious::Liteを読み込み、サブルーチンシグネチャを有効化 get '/' =\u0026gt; sub ($c) { ... };: GETリクエストのルーティングを定義。$cはコントローラーオブジェクト $c-\u0026gt;render(text =\u0026gt; 'Hello, Mojolicious!');: テキストレスポンスを返す app-\u0026gt;start;: アプリケーションを起動 たったこれだけで、Webアプリケーションが完成です！\nルーティング - URLと処理の対応 Mojoliciousのルーティングは非常に柔軟です。様々なHTTPメソッドとURLパターンに対応できます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/usr/bin/env perl use Mojolicious::Lite -signatures; # GETリクエスト get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(text =\u0026gt; \u0026#39;Home Page\u0026#39;); }; # パラメータ付きルート get \u0026#39;/hello/:name\u0026#39; =\u0026gt; sub ($c) { my $name = $c-\u0026gt;param(\u0026#39;name\u0026#39;); $c-\u0026gt;render(text =\u0026gt; \u0026#34;Hello, $name!\u0026#34;); }; # ワイルドカード get \u0026#39;/files/*filepath\u0026#39; =\u0026gt; sub ($c) { my $path = $c-\u0026gt;param(\u0026#39;filepath\u0026#39;); $c-\u0026gt;render(text =\u0026gt; \u0026#34;File path: $path\u0026#34;); }; # 正規表現 get \u0026#39;/article/:id\u0026#39; =\u0026gt; [id =\u0026gt; qr/\\d+/] =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); $c-\u0026gt;render(text =\u0026gt; \u0026#34;Article ID: $id\u0026#34;); }; # POSTリクエスト post \u0026#39;/submit\u0026#39; =\u0026gt; sub ($c) { my $data = $c-\u0026gt;param(\u0026#39;data\u0026#39;); $c-\u0026gt;render(text =\u0026gt; \u0026#34;Received: $data\u0026#34;); }; app-\u0026gt;start; プレースホルダーの種類 :name - 標準プレースホルダー（/以外の任意の文字列） *filepath - ワイルドカード（/を含む任意の文字列） [name =\u0026gt; qr/.../] - 正規表現による制約 試してみましょう：\n1 2 3 4 5 6 7 8 curl http://localhost:3000/hello/Perl # =\u0026gt; Hello, Perl! curl http://localhost:3000/files/path/to/file.txt # =\u0026gt; File path: path/to/file.txt curl http://localhost:3000/article/123 # =\u0026gt; Article ID: 123 テンプレート - HTMLを返す インラインテンプレートを使えば、HTMLレスポンスも簡単です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 #!/usr/bin/env perl use Mojolicious::Lite -signatures; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; get \u0026#39;/user/:name\u0026#39; =\u0026gt; sub ($c) { my $name = $c-\u0026gt;param(\u0026#39;name\u0026#39;); $c-\u0026gt;render(template =\u0026gt; \u0026#39;user\u0026#39;, name =\u0026gt; $name); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Mojolicious App\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; margin: 40px; } h1 { color: #8B4513; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Welcome to Mojolicious!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Visit \u0026lt;a href=\u0026#34;/user/YourName\u0026#34;\u0026gt;/user/YourName\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; @@ user.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;User: \u0026lt;%= $name %\u0026gt;\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello, \u0026lt;%= $name %\u0026gt;!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Current time: \u0026lt;%= localtime %\u0026gt;\u0026lt;/p\u0026gt; % if ($name eq \u0026#39;Perl\u0026#39;) { \u0026lt;p\u0026gt;You have excellent taste in programming languages!\u0026lt;/p\u0026gt; % } \u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;Back to home\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; テンプレートの記法 \u0026lt;%= ... %\u0026gt;: Perlコードの評価結果を出力（HTMLエスケープあり） \u0026lt;%== ... %\u0026gt;: HTMLエスケープなしで出力 % ...: 行頭の%でPerlコードを記述 %% ...: 実際の%を出力したい場合 JSON API - RESTful APIを作る RESTful APIの作成もMojoliciousの得意分野です：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 #!/usr/bin/env perl use Mojolicious::Lite -signatures; use Mojo::JSON qw(decode_json encode_json); # データストア（本番環境ではデータベースを使用） my $todos = [ {id =\u0026gt; 1, title =\u0026gt; \u0026#39;Learn Mojolicious\u0026#39;, done =\u0026gt; 0}, {id =\u0026gt; 2, title =\u0026gt; \u0026#39;Build an app\u0026#39;, done =\u0026gt; 0}, ]; my $next_id = 3; # 全件取得 get \u0026#39;/api/todos\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(json =\u0026gt; $todos); }; # 1件取得 get \u0026#39;/api/todos/:id\u0026#39; =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); my ($todo) = grep { $_-\u0026gt;{id} == $id } @$todos; return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;Not found\u0026#39;}, status =\u0026gt; 404) unless $todo; $c-\u0026gt;render(json =\u0026gt; $todo); }; # 新規作成 post \u0026#39;/api/todos\u0026#39; =\u0026gt; sub ($c) { my $json = $c-\u0026gt;req-\u0026gt;json; return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;Invalid data\u0026#39;}, status =\u0026gt; 400) unless $json \u0026amp;\u0026amp; $json-\u0026gt;{title}; my $todo = { id =\u0026gt; $next_id++, title =\u0026gt; $json-\u0026gt;{title}, done =\u0026gt; $json-\u0026gt;{done} // 0, }; push @$todos, $todo; $c-\u0026gt;render(json =\u0026gt; $todo, status =\u0026gt; 201); }; # 更新 put \u0026#39;/api/todos/:id\u0026#39; =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); my $json = $c-\u0026gt;req-\u0026gt;json; my ($todo) = grep { $_-\u0026gt;{id} == $id } @$todos; return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;Not found\u0026#39;}, status =\u0026gt; 404) unless $todo; $todo-\u0026gt;{title} = $json-\u0026gt;{title} if defined $json-\u0026gt;{title}; $todo-\u0026gt;{done} = $json-\u0026gt;{done} if defined $json-\u0026gt;{done}; $c-\u0026gt;render(json =\u0026gt; $todo); }; # 削除 del \u0026#39;/api/todos/:id\u0026#39; =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); my $count = @$todos; @$todos = grep { $_-\u0026gt;{id} != $id } @$todos; return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;Not found\u0026#39;}, status =\u0026gt; 404) if @$todos == $count; $c-\u0026gt;render(json =\u0026gt; {message =\u0026gt; \u0026#39;Deleted\u0026#39;}); }; app-\u0026gt;start; APIのテスト 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 全件取得 curl http://localhost:3000/api/todos # 1件取得 curl http://localhost:3000/api/todos/1 # 新規作成 curl -X POST http://localhost:3000/api/todos \\ -H \u0026#39;Content-Type: application/json\u0026#39; \\ -d \u0026#39;{\u0026#34;title\u0026#34;:\u0026#34;Write article\u0026#34;,\u0026#34;done\u0026#34;:false}\u0026#39; # 更新 curl -X PUT http://localhost:3000/api/todos/1 \\ -H \u0026#39;Content-Type: application/json\u0026#39; \\ -d \u0026#39;{\u0026#34;done\u0026#34;:true}\u0026#39; # 削除 curl -X DELETE http://localhost:3000/api/todos/1 WebSocket - リアルタイム通信 MojoliciousはWebSocketを標準でサポートしています。チャットアプリを作ってみましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 #!/usr/bin/env perl use Mojolicious::Lite -signatures; # 接続中のクライアントを保存 my $clients = {}; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;chat\u0026#39;); }; websocket \u0026#39;/ws\u0026#39; =\u0026gt; sub ($c) { # クライアントIDを生成 my $id = sprintf \u0026#39;%s\u0026#39;, $c-\u0026gt;tx; $clients-\u0026gt;{$id} = $c-\u0026gt;tx; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;Client $id connected\u0026#34;); # メッセージ受信時の処理 $c-\u0026gt;on(message =\u0026gt; sub ($c, $msg) { $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;Received: $msg\u0026#34;); # 全クライアントにブロードキャスト for my $client (values %$clients) { $client-\u0026gt;send($msg); } }); # 切断時の処理 $c-\u0026gt;on(finish =\u0026gt; sub ($c, $code, $reason) { delete $clients-\u0026gt;{$id}; $c-\u0026gt;app-\u0026gt;log-\u0026gt;info(\u0026#34;Client $id disconnected\u0026#34;); }); }; app-\u0026gt;start; __DATA__ @@ chat.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;WebSocket Chat\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; margin: 20px; } #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; } #input { width: 300px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;WebSocket Chat\u0026lt;/h1\u0026gt; \u0026lt;div id=\u0026#34;messages\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;input\u0026#34; placeholder=\u0026#34;Type a message...\u0026#34;\u0026gt; \u0026lt;button id=\u0026#34;send\u0026#34;\u0026gt;Send\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; const ws = new WebSocket(\u0026#39;ws://localhost:3000/ws\u0026#39;); const messages = document.getElementById(\u0026#39;messages\u0026#39;); const input = document.getElementById(\u0026#39;input\u0026#39;); const send = document.getElementById(\u0026#39;send\u0026#39;); ws.onmessage = function(event) { const p = document.createElement(\u0026#39;p\u0026#39;); p.textContent = event.data; messages.appendChild(p); messages.scrollTop = messages.scrollHeight; }; function sendMessage() { if (input.value) { ws.send(input.value); input.value = \u0026#39;\u0026#39;; } } send.onclick = sendMessage; input.onkeypress = function(e) { if (e.key === \u0026#39;Enter\u0026#39;) sendMessage(); }; \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 複数のブラウザタブでhttp://localhost:3000を開いて、リアルタイムチャットを試してみてください！\nテストの書き方 Mojoliciousにはテストフレームワークも組み込まれています。test.tというファイルを作成：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 use Test::More; use Test::Mojo; # テスト対象のアプリケーション use Mojolicious::Lite -signatures; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(text =\u0026gt; \u0026#39;Hello Test!\u0026#39;); }; get \u0026#39;/json\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(json =\u0026gt; {message =\u0026gt; \u0026#39;Hello\u0026#39;, status =\u0026gt; \u0026#39;ok\u0026#39;}); }; # テストの実行 my $t = Test::Mojo-\u0026gt;new; # GETリクエストのテスト $t-\u0026gt;get_ok(\u0026#39;/\u0026#39;) -\u0026gt;status_is(200) -\u0026gt;content_is(\u0026#39;Hello Test!\u0026#39;); # JSONレスポンスのテスト $t-\u0026gt;get_ok(\u0026#39;/json\u0026#39;) -\u0026gt;status_is(200) -\u0026gt;json_is(\u0026#39;/message\u0026#39; =\u0026gt; \u0026#39;Hello\u0026#39;) -\u0026gt;json_is(\u0026#39;/status\u0026#39; =\u0026gt; \u0026#39;ok\u0026#39;); # 存在しないパス $t-\u0026gt;get_ok(\u0026#39;/notfound\u0026#39;) -\u0026gt;status_is(404); done_testing(); テストの実行：\n1 perl test.t より高度なテスト例 POSTリクエストやJSONペイロードのテスト：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Test::More; use Test::Mojo; use Mojolicious::Lite -signatures; post \u0026#39;/api/user\u0026#39; =\u0026gt; sub ($c) { my $json = $c-\u0026gt;req-\u0026gt;json; return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;Name required\u0026#39;}, status =\u0026gt; 400) unless $json-\u0026gt;{name}; $c-\u0026gt;render(json =\u0026gt; { id =\u0026gt; 1, name =\u0026gt; $json-\u0026gt;{name}, created =\u0026gt; 1 }); }; my $t = Test::Mojo-\u0026gt;new; # 正常系 $t-\u0026gt;post_ok(\u0026#39;/api/user\u0026#39; =\u0026gt; json =\u0026gt; {name =\u0026gt; \u0026#39;Taro\u0026#39;}) -\u0026gt;status_is(200) -\u0026gt;json_is(\u0026#39;/id\u0026#39; =\u0026gt; 1) -\u0026gt;json_is(\u0026#39;/name\u0026#39; =\u0026gt; \u0026#39;Taro\u0026#39;) -\u0026gt;json_is(\u0026#39;/created\u0026#39; =\u0026gt; 1); # 異常系 $t-\u0026gt;post_ok(\u0026#39;/api/user\u0026#39; =\u0026gt; json =\u0026gt; {}) -\u0026gt;status_is(400) -\u0026gt;json_is(\u0026#39;/error\u0026#39; =\u0026gt; \u0026#39;Name required\u0026#39;); done_testing(); 実用的なアプリケーション例 - URLショートナー これまで学んだことを活かして、実用的なURLショートナーを作ってみましょう：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 #!/usr/bin/env perl use Mojolicious::Lite -signatures; use Mojo::Util qw(b64_encode b64_decode); # データストア（簡易版） my $urls = {}; my $counter = 1000; # ホームページ get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; # URL短縮API post \u0026#39;/api/shorten\u0026#39; =\u0026gt; sub ($c) { my $url = $c-\u0026gt;param(\u0026#39;url\u0026#39;); return $c-\u0026gt;render(json =\u0026gt; {error =\u0026gt; \u0026#39;URL required\u0026#39;}, status =\u0026gt; 400) unless $url; # 簡易的なID生成（本番環境ではより堅牢な方法を使用） my $id = sprintf \u0026#39;%x\u0026#39;, $counter++; $urls-\u0026gt;{$id} = $url; my $short_url = $c-\u0026gt;url_for(\u0026#34;/s/$id\u0026#34;)-\u0026gt;to_abs; $c-\u0026gt;render(json =\u0026gt; { original =\u0026gt; $url, short =\u0026gt; $short_url, id =\u0026gt; $id }); }; # リダイレクト get \u0026#39;/s/:id\u0026#39; =\u0026gt; sub ($c) { my $id = $c-\u0026gt;param(\u0026#39;id\u0026#39;); my $url = $urls-\u0026gt;{$id}; return $c-\u0026gt;render(text =\u0026gt; \u0026#39;Not found\u0026#39;, status =\u0026gt; 404) unless $url; $c-\u0026gt;redirect_to($url); }; # 統計情報 get \u0026#39;/api/stats\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;render(json =\u0026gt; { total_urls =\u0026gt; scalar keys %$urls, urls =\u0026gt; [map { {id =\u0026gt; $_, url =\u0026gt; $urls-\u0026gt;{$_}} } keys %$urls] }); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;URL Shortener\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; } input[type=\u0026#34;text\u0026#34;] { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; } button { padding: 10px 20px; background: #8B4513; color: white; border: none; cursor: pointer; } button:hover { background: #654321; } #result { margin-top: 20px; padding: 15px; background: #f0f0f0; display: none; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;🔗 URL Shortener\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Enter a long URL to shorten it:\u0026lt;/p\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;url\u0026#34; placeholder=\u0026#34;https://example.com/very/long/url\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;shortenUrl()\u0026#34;\u0026gt;Shorten URL\u0026lt;/button\u0026gt; \u0026lt;div id=\u0026#34;result\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; async function shortenUrl() { const url = document.getElementById(\u0026#39;url\u0026#39;).value; if (!url) { alert(\u0026#39;Please enter a URL\u0026#39;); return; } const response = await fetch(\u0026#39;/api/shorten\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39;}, body: \u0026#39;url=\u0026#39; + encodeURIComponent(url) }); const data = await response.json(); if (data.error) { alert(data.error); return; } const result = document.getElementById(\u0026#39;result\u0026#39;); result.innerHTML = ` \u0026lt;h3\u0026gt;✅ URL Shortened!\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Original:\u0026lt;/strong\u0026gt; ${data.original}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Short URL:\u0026lt;/strong\u0026gt; \u0026lt;a href=\u0026#34;${data.short}\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;${data.short}\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; `; result.style.display = \u0026#39;block\u0026#39;; } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; このアプリケーションは以下の機能を持っています：\nURL短縮: 長いURLを短縮URLに変換 リダイレクト: 短縮URLにアクセスすると元のURLにリダイレクト 統計情報: /api/statsで全URLの一覧を取得 レスポンシブUI: シンプルで使いやすいインターフェース プラグインの活用 Mojoliciousには豊富なプラグインエコシステムがあります。よく使われるプラグインをいくつか紹介します：\nMojolicious::Plugin::OpenAPI OpenAPI（Swagger）仕様に基づいたAPI開発：\n1 2 3 4 5 use Mojolicious::Lite -signatures; plugin OpenAPI =\u0026gt; {url =\u0026gt; \u0026#39;api.yaml\u0026#39;}; app-\u0026gt;start; Mojolicious::Plugin::Authentication ユーザー認証機能の追加：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use Mojolicious::Lite -signatures; plugin \u0026#39;Authentication\u0026#39; =\u0026gt; { load_user =\u0026gt; sub ($app, $uid) { return {username =\u0026gt; \u0026#39;user\u0026#39;, uid =\u0026gt; $uid}; }, validate_user =\u0026gt; sub ($c, $username, $password) { return $username eq \u0026#39;admin\u0026#39; \u0026amp;\u0026amp; $password eq \u0026#39;secret\u0026#39; ? 1 : undef; }, }; get \u0026#39;/protected\u0026#39; =\u0026gt; sub ($c) { return $c-\u0026gt;redirect_to(\u0026#39;/login\u0026#39;) unless $c-\u0026gt;is_user_authenticated; $c-\u0026gt;render(text =\u0026gt; \u0026#39;Secret area\u0026#39;); }; app-\u0026gt;start; デプロイ方法 開発環境 開発時は組み込みサーバーで十分です：\n1 2 3 4 5 # リロード機能付き（ファイル変更を自動検知） morbo myapp.pl # 本番モード perl myapp.pl daemon -l http://*:8080 本番環境 本番環境では、以下のような選択肢があります：\n1. Hypnotoad（推奨） Mojolicious組み込みの高性能プリフォークサーバー：\n1 hypnotoad myapp.pl ゼロダウンタイムデプロイが可能：\n1 2 # 新バージョンをデプロイ（自動的に古いプロセスを置き換え） hypnotoad myapp.pl 2. リバースプロキシ構成 Nginx + Hypnotoadの組み合わせ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 upstream myapp { server 127.0.0.1:8080; } server { listen 80; server_name example.com; location / { proxy_pass http://myapp; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } 3. Plack/PSGI PSGI互換サーバーでも動作します：\n1 plackup myapp.psgi パフォーマンスと非同期処理 Mojoliciousの真価は非同期処理にあります。複数のHTTPリクエストを並列に処理する例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 use Mojolicious::Lite -signatures; get \u0026#39;/parallel\u0026#39; =\u0026gt; sub ($c) { my $delay = Mojo::IOLoop-\u0026gt;delay(sub ($delay, @results) { my ($user, $posts, $comments) = @results; $c-\u0026gt;render(json =\u0026gt; { user =\u0026gt; $user, posts =\u0026gt; $posts, comments =\u0026gt; $comments }); }); # 3つのAPIを並列に呼び出し my $ua = $c-\u0026gt;ua; $ua-\u0026gt;get(\u0026#39;https://api.example.com/user/1\u0026#39; =\u0026gt; $delay-\u0026gt;begin); $ua-\u0026gt;get(\u0026#39;https://api.example.com/posts\u0026#39; =\u0026gt; $delay-\u0026gt;begin); $ua-\u0026gt;get(\u0026#39;https://api.example.com/comments\u0026#39; =\u0026gt; $delay-\u0026gt;begin); }; app-\u0026gt;start; 設定管理 環境ごとに設定を変える方法：\n1 2 3 4 5 6 7 8 9 10 11 use Mojolicious::Lite -signatures; # 設定ファイルの読み込み plugin Config =\u0026gt; {file =\u0026gt; \u0026#39;myapp.conf\u0026#39;}; get \u0026#39;/\u0026#39; =\u0026gt; sub ($c) { my $db_host = $c-\u0026gt;config(\u0026#39;database\u0026#39;)-\u0026gt;{host}; $c-\u0026gt;render(text =\u0026gt; \u0026#34;DB Host: $db_host\u0026#34;); }; app-\u0026gt;start; myapp.confの例：\n1 2 3 4 5 6 7 8 { database =\u0026gt; { host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 5432, name =\u0026gt; \u0026#39;myapp\u0026#39; }, secrets =\u0026gt; [\u0026#39;my-secret-key\u0026#39;] } デバッグ技法 Mojoliciousには強力なデバッグ機能があります：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ログレベルの設定 app-\u0026gt;log-\u0026gt;level(\u0026#39;debug\u0026#39;); # ログ出力 app-\u0026gt;log-\u0026gt;debug(\u0026#39;Debug message\u0026#39;); app-\u0026gt;log-\u0026gt;info(\u0026#39;Info message\u0026#39;); app-\u0026gt;log-\u0026gt;warn(\u0026#39;Warning message\u0026#39;); app-\u0026gt;log-\u0026gt;error(\u0026#39;Error message\u0026#39;); # リクエスト/レスポンスのダンプ get \u0026#39;/debug\u0026#39; =\u0026gt; sub ($c) { $c-\u0026gt;app-\u0026gt;log-\u0026gt;debug($c-\u0026gt;req-\u0026gt;headers-\u0026gt;to_string); $c-\u0026gt;app-\u0026gt;log-\u0026gt;debug($c-\u0026gt;req-\u0026gt;body); $c-\u0026gt;render(text =\u0026gt; \u0026#39;Check logs\u0026#39;); }; 開発時はMOJO_LOG_LEVEL環境変数でログレベルを制御：\n1 MOJO_LOG_LEVEL=debug perl myapp.pl daemon まとめ Mojoliciousは「楽しく」「モダン」なPerlのWebフレームワークです。この記事で紹介した内容をまとめます：\n学んだこと 基本: Mojolicious::Liteでの最小構成から開始 ルーティング: 柔軟なURLパターンマッチング テンプレート: EPテンプレートエンジンでHTML生成 JSON API: RESTful APIの実装 WebSocket: リアルタイム通信 テスト: Test::Mojoによる自動テスト 実用例: URLショートナーの実装 デプロイ: 本番環境への展開方法 Mojoliciousの魅力 学習曲線が緩やか: シンプルな例から始めて、段階的に機能を追加できる ドキュメントが充実: perldoc Mojolicious::Guidesで詳細なガイドが読める コミュニティが活発: IRCチャンネル、メーリングリスト、GitHub 実戦投入できる: 小規模から大規模まで対応可能 楽しい: 開発体験が素晴らしく、コードを書くのが楽しくなる 次のステップ Mojoliciousをさらに深く学ぶには：\n公式ガイド: perldoc Mojolicious::Guides::Tutorial クックブック: perldoc Mojolicious::Guides::Cookbook プラグイン: CPAN で Mojolicious::Plugin::* を検索 実例: GitHubで実際のプロジェクトを見てみる コミュニティ: #mojo on irc.libera.chat に参加 参考リンク 公式サイト: https://mojolicious.org/ ドキュメント: https://docs.mojolicious.org/ GitHub: https://github.com/mojolicious/mojo CPANモジュール: https://metacpan.org/pod/Mojolicious Mojoliciousで、楽しいPerl Webアプリケーション開発を始めましょう！\nバージョン情報 この記事のコード例は以下の環境で動作確認しています：\nPerl: 5.30以上（サブルーチンシグネチャ対応版） Mojolicious: 9.0以上 古いPerlバージョンを使用している場合は、サブルーチンシグネチャ（-signatures）の部分を従来のmy ($c) = @_;形式に書き換えてください。\n","date":"2025-12-04T00:00:00+09:00","image":"https://www.nqou.net/public_images/20251204-mojolicious.jpg","permalink":"https://www.nqou.net/2025/12/04/000000/","title":"Mojolicious入門 — Mojolicious::Liteで始めるPerlのWeb開発"},{"content":"@nqouです。\n11月にGitHub Copilotのプレミアムリクエストを初めて本気で使ってみました。気づけば、枠を限界まで使い切っていました。\n見事に100.0%になり、プレミアムリクエストの枠を使い切りました。正直に言うと、12月1日の朝はリセットされるかどうか少し不安でした。\n12月1日の朝、そして復活 12月1日の朝、問題なくリセットされていました。少し安心しました。\n0.0%から再スタートした瞬間、「今月も使い倒すぞ」と気持ちが高まりました。\n驚異的な使用量の伸び 振り返ると、11月の使用パターンは興味深かったです。プレミアムリクエストを意識してからの伸びが顕著でした。\nこのグラフを見ると：\n11月前半（〜11月20日）: 緩やかな上昇で、まだプレミアムの真価に気づいていない時期でした。 11月後半（11月21日〜）: 急激に利用が増え、本格的に活用を始めました。 11月末: ほぼ垂直に近い上昇で、完全に使い倒しモードになりました。 2025年全体の使用傾向 年間を通して見ても、11月の急激な伸びは目立ちました。\nこのグラフから分かること：\n1月〜10月: 緩やかな成長で、月あたりおよそ$2〜4の範囲でした。 11月: 爆発的に増え、一気に$14を超えました。 12月: さらなる活用が期待できる状況です（この時点では始まったばかりでした）。 これまで十分に使ってこなかったことを悔やんでいます。もっと早くその価値に気づくべきでした。\nプレミアムリクエストで何が変わったのか 1. コード生成の質が向上 通常リクエストでも十分優秀ですが、プレミアムでは次の点が改善しました。\nより複雑なコンテキストを理解できるようになりました。 長いコードの一括生成がしやすくなりました。 詳しい説明やドキュメント生成が行えるようになりました。 2. リファクタリングが楽になった 大規模なリファクタリングでは、プレミアムの恩恵が特に大きかったです：\n1 2 3 4 // プレミアムリクエストであれば、このような大規模な変更も一度に提案されます // 複数ファイルにまたがる変更 // アーキテクチャレベルの提案 // パフォーマンス最適化の具体案 3. カスタムエージェントの活用 12月に入って、カスタムエージェントの使い方が分かってきました。\nカスタムエージェントとは：\n特定のタスクに特化したAIアシスタントです。 .github/agents/ に定義します。 プロジェクト固有の知識を持たせることができます。 4. 学習とドキュメント作成の効率化 新しい技術を学ぶ際、以下が効率化しました。\n公式ドキュメントの要約がしやすくなりました。 ベストプラクティスの提案を受けやすくなりました。 サンプルコードの生成が迅速になりました。 FAQの作成も効率的に行えるようになりました。 いずれもプレミアムリクエストで高速化されました。\n12月の目標：もっと賢い仕組みを作る 11月の経験を踏まえ、12月はさらに進化させたいと考えています。\n目標1: カスタムエージェントの体系化 現在いくつかのカスタムエージェントを作成していますが、体系化はまだです。\n1 2 3 4 5 .github/agents/ ├── planner.agent.md # タスク計画 ├── implementation-plan.agent.md # 実装計画 ├── specification.agent.md # 仕様書作成 └── ... (その他のエージェント) これらを有機的に連携させる仕組みを作りたいと考えています。\n目標2: ワークフローの自動化 GitHub ActionsとCopilotを組み合わせて次の自動化を目指します：\nPR作成時の自動レビュー コード品質チェック ドキュメント生成 テストケース提案 目標3: ナレッジベースの構築 プロジェクト固有の知識を蓄積し、Copilotに学習させることを目指しています：\nアーキテクチャ決定記録（ADR） ベストプラクティス集 よくある問題と解決方法 コーディング規約 目標4: チーム活用の促進 個人利用に留めず、チーム全体で活用する方法を模索しています：\nカスタムエージェントの共有 ベストプラクティスの共有 活用事例の収集 プレミアムリクエストを最大限活用するコツ 11月の経験から得た、効果的な使い方をご紹介します：\n1. 明確な指示を出す 1 2 3 悪い例：「このコードを良くして」 良い例：「このコードをTypeScriptの最新ベストプラクティスに従ってリファクタリングし、 型安全性を向上させ、エラーハンドリングを追加してください」 2. コンテキストを提供する 関連するファイルを開いておく、または具体的な要件を説明しておくことをおすすめします。\n3. 段階的に進める 一度に全てを求めず、段階的にレビューしながら進めることを推奨します。\n4. カスタムエージェントを活用 繰り返し発生する作業は、カスタムエージェントとして定義すると便利です。\n5. フィードバックループを回す 生成されたコードをレビューし、改善点をフィードバックしてください。\nまとめ 11月にGitHub Copilotのプレミアムリクエストを使い倒してみて、その威力を実感しました。\n学んだこと：\nプレミアムリクエストは予想以上に強力でした カスタムエージェントの可能性は大きいと感じました もっと早く使い始めるべきでした 12月の抱負：\nカスタムエージェントをさらに洗練させます チーム全体での活用を促進します ワークフローの自動化を進めます もっと賢い仕組みを作ります そして何より、プレミアムリクエストの枠を今月も使い切る勢いで活用していきたいと考えています。\n","date":"2025-12-03T21:00:18+09:00","image":"https://www.nqou.net/public_images/20251203210018-image.jpg","permalink":"https://www.nqou.net/2025/12/03/210018/","title":"GitHub Copilot Premium Requests：11月の振り返りと12月の抱負"},{"content":"CPANとは CPAN（Comprehensive Perl Archive Network）は、Perlの最大の強みの一つです。世界中の開発者が作成した18万以上のモジュールが公開されており、ほとんどの問題に対して「すでに誰かが解決している」状態です。Perlの格言「車輪の再発明をするな」を体現するエコシステムと言えるでしょう。\n本記事では、実務で本当に役立つCPANモジュール20選を、カテゴリ別に紹介します。すべて現場で使われている実績のあるモジュールばかりです。\nモジュールのインストール方法 CPANモジュールはcpanm（App::cpanminus）を使ってインストールするのが最も簡単です：\n1 2 3 4 5 6 # cpanm自体のインストール curl -L https://cpanmin.us | perl - App::cpanminus # モジュールのインストール cpanm Path::Tiny cpanm Mojolicious 実際のプロジェクトでは、依存関係をcpanfileで管理するのがベストプラクティスです：\n1 2 3 4 5 6 7 # cpanfile requires \u0026#39;Path::Tiny\u0026#39;, \u0026#39;\u0026gt;= 0.144\u0026#39;; requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; requires \u0026#39;Time::Moment\u0026#39;; # インストール cpanm --installdeps . ファイル・パス操作 1. Path::Tiny 選定理由: ファイル操作の定番。File::SpecやFile::Slurpの複雑さを解消し、直感的なAPIを提供します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Path::Tiny; # ファイルの読み込み my $content = path(\u0026#39;config.txt\u0026#39;)-\u0026gt;slurp_utf8; # ファイルへの書き込み path(\u0026#39;output.txt\u0026#39;)-\u0026gt;spew_utf8(\u0026#34;Hello, World!\\n\u0026#34;); # ディレクトリの再帰的な走査 my $iter = path(\u0026#39;lib\u0026#39;)-\u0026gt;iterator({ recurse =\u0026gt; 1 }); while (my $path = $iter-\u0026gt;()) { next unless $path =~ /\\.pm$/; say $path; } # ファイルの存在確認と作成 my $file = path(\u0026#39;data/cache.json\u0026#39;); $file-\u0026gt;parent-\u0026gt;mkpath; # 親ディレクトリを作成 $file-\u0026gt;touch unless $file-\u0026gt;exists; 特徴:\nメソッドチェーンで直感的 UTF-8対応が簡単 Windows/Unixのパス差異を自動処理 2. File::Find::Rule 選定理由: ファイル検索を宣言的に書ける。複雑な条件でのファイル検索が劇的に簡単になります。\n1 2 3 4 5 6 7 8 9 10 11 12 use File::Find::Rule; # 特定の拡張子のファイルを検索 my @files = File::Find::Rule-\u0026gt;file() -\u0026gt;name(\u0026#39;*.pl\u0026#39;, \u0026#39;*.pm\u0026#39;) -\u0026gt;in(\u0026#39;lib\u0026#39;, \u0026#39;t\u0026#39;); # サイズと更新日時での検索 my @large_files = File::Find::Rule-\u0026gt;file() -\u0026gt;size(\u0026#39;\u0026gt;1M\u0026#39;) -\u0026gt;mtime(\u0026#39;\u0026gt;7\u0026#39;) # 7日以内に更新 -\u0026gt;in(\u0026#39;.\u0026#39;); Web関連 3. HTTP::Tiny 選定理由: コアモジュール（Perl 5.14+）でありながら実用的。外部依存なしでHTTPリクエストが可能です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use HTTP::Tiny; my $http = HTTP::Tiny-\u0026gt;new(timeout =\u0026gt; 10); # GETリクエスト my $response = $http-\u0026gt;get(\u0026#39;https://api.example.com/users\u0026#39;); if ($response-\u0026gt;{success}) { say $response-\u0026gt;{content}; } # POSTリクエスト（JSON） my $res = $http-\u0026gt;post( \u0026#39;https://api.example.com/posts\u0026#39;, { headers =\u0026gt; { \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;application/json\u0026#39; }, content =\u0026gt; \u0026#39;{\u0026#34;title\u0026#34;:\u0026#34;Hello\u0026#34;,\u0026#34;body\u0026#34;:\u0026#34;World\u0026#34;}\u0026#39;, } ); 4. Mojo::UserAgent 選定理由: 強力な非同期対応とDOMパーサー内蔵。スクレイピングやAPI連携に最適です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Mojo::UserAgent; my $ua = Mojo::UserAgent-\u0026gt;new; # シンプルなGET my $res = $ua-\u0026gt;get(\u0026#39;https://example.com\u0026#39;)-\u0026gt;result; say $res-\u0026gt;body; # DOMセレクタでスクレイピング $ua-\u0026gt;get(\u0026#39;https://news.ycombinator.com\u0026#39;)-\u0026gt;result -\u0026gt;dom-\u0026gt;find(\u0026#39;.titleline \u0026gt; a\u0026#39;)-\u0026gt;each(sub { say $_-\u0026gt;text, \u0026#39; =\u0026gt; \u0026#39;, $_-\u0026gt;attr(\u0026#39;href\u0026#39;); }); # JSON API my $json = $ua-\u0026gt;get(\u0026#39;https://api.github.com/users/perl\u0026#39;) -\u0026gt;result-\u0026gt;json; say $json-\u0026gt;{name}; 5. Plack 選定理由: WebアプリケーションのPSGI標準実装。フレームワークに依存しないWebアプリ開発の基盤です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # app.psgi use Plack::Request; my $app = sub { my $env = shift; my $req = Plack::Request-\u0026gt;new($env); return [ 200, [\u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39;], [\u0026#34;Hello, \u0026#34; . ($req-\u0026gt;param(\u0026#39;name\u0026#39;) || \u0026#39;World\u0026#39;)] ]; }; # 起動: plackup app.psgi データ処理 6. JSON::MaybeXS 選定理由: 最速のJSONモジュールを自動選択。JSON::XS（C実装）があれば使い、なければPure Perlにフォールバックします。\n1 2 3 4 5 6 7 8 9 10 11 use JSON::MaybeXS; my $json = JSON::MaybeXS-\u0026gt;new(utf8 =\u0026gt; 1, pretty =\u0026gt; 1); # エンコード my $data = { name =\u0026gt; \u0026#39;太郎\u0026#39;, age =\u0026gt; 30, hobbies =\u0026gt; [\u0026#39;Perl\u0026#39;, \u0026#39;CPAN\u0026#39;] }; my $json_text = $json-\u0026gt;encode($data); # デコード my $decoded = $json-\u0026gt;decode($json_text); say $decoded-\u0026gt;{name}; # 太郎 7. YAML::XS 選定理由: YAML 1.1対応の高速パーサー。設定ファイルの読み書きに最適です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 use YAML::XS qw(LoadFile DumpFile); # YAMLファイルの読み込み my $config = LoadFile(\u0026#39;config.yml\u0026#39;); # YAMLファイルへの書き込み DumpFile(\u0026#39;output.yml\u0026#39;, { database =\u0026gt; { host =\u0026gt; \u0026#39;localhost\u0026#39;, port =\u0026gt; 5432, }, features =\u0026gt; [\u0026#39;cache\u0026#39;, \u0026#39;logging\u0026#39;], }); 8. XML::LibXML 選定理由: libxml2ベースの高速XMLパーサー。XPathとXSLT対応で複雑なXML処理も可能です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use XML::LibXML; my $parser = XML::LibXML-\u0026gt;new; my $doc = $parser-\u0026gt;parse_file(\u0026#39;data.xml\u0026#39;); # XPathで要素を検索 for my $node ($doc-\u0026gt;findnodes(\u0026#39;//book[@category=\u0026#34;programming\u0026#34;]\u0026#39;)) { my $title = $node-\u0026gt;findvalue(\u0026#39;./title\u0026#39;); my $author = $node-\u0026gt;findvalue(\u0026#39;./author\u0026#39;); say \u0026#34;$title by $author\u0026#34;; } # 新しい要素を追加 my $new_book = $doc-\u0026gt;createElement(\u0026#39;book\u0026#39;); $new_book-\u0026gt;setAttribute(\u0026#39;category\u0026#39;, \u0026#39;perl\u0026#39;); my $title = $doc-\u0026gt;createElement(\u0026#39;title\u0026#39;); $title-\u0026gt;appendText(\u0026#39;Programming Perl\u0026#39;); $new_book-\u0026gt;appendChild($title); 9. Text::CSV_XS 選定理由: CSVパーサーの決定版。RFC 4180準拠で、複雑なCSVも正確に処理します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use Text::CSV_XS; my $csv = Text::CSV_XS-\u0026gt;new({ binary =\u0026gt; 1, auto_diag =\u0026gt; 1 }); # CSV読み込み open my $fh, \u0026#39;\u0026lt;:encoding(utf8)\u0026#39;, \u0026#39;data.csv\u0026#39; or die $!; while (my $row = $csv-\u0026gt;getline($fh)) { say join \u0026#39;, \u0026#39;, @$row; } # CSV書き込み open my $out, \u0026#39;\u0026gt;:encoding(utf8)\u0026#39;, \u0026#39;output.csv\u0026#39; or die $!; $csv-\u0026gt;say($out, [\u0026#39;Name\u0026#39;, \u0026#39;Age\u0026#39;, \u0026#39;Email\u0026#39;]); $csv-\u0026gt;say($out, [\u0026#39;太郎\u0026#39;, 30, \u0026#39;taro@example.com\u0026#39;]); close $out; 日時処理 10. Time::Moment 選定理由: 最速の日時処理ライブラリ。不変オブジェクトで安全、かつ高性能です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use Time::Moment; # 現在時刻 my $now = Time::Moment-\u0026gt;now_utc; say $now-\u0026gt;to_string; # 2025-12-03T12:34:56Z # 特定の日時を作成 my $tm = Time::Moment-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 3, hour =\u0026gt; 15, minute =\u0026gt; 30, ); # 日時演算 my $tomorrow = $tm-\u0026gt;plus_days(1); my $next_week = $tm-\u0026gt;plus_weeks(1); my $diff_seconds = $tomorrow-\u0026gt;delta_seconds($now); # フォーマット say $tm-\u0026gt;strftime(\u0026#39;%Y年%m月%d日 %H:%M\u0026#39;); 11. DateTime 選定理由: タイムゾーン対応が必要な場合の定番。豊富な機能と拡張モジュール群があります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use DateTime; my $dt = DateTime-\u0026gt;new( year =\u0026gt; 2025, month =\u0026gt; 12, day =\u0026gt; 3, hour =\u0026gt; 15, time_zone =\u0026gt; \u0026#39;Asia/Tokyo\u0026#39;, ); # タイムゾーン変換 my $utc = $dt-\u0026gt;clone-\u0026gt;set_time_zone(\u0026#39;UTC\u0026#39;); say $utc-\u0026gt;ymd . \u0026#39; \u0026#39; . $utc-\u0026gt;hms; # 相対的な日付 my $last_month = $dt-\u0026gt;clone-\u0026gt;subtract(months =\u0026gt; 1); データベース 12. DBI 選定理由: Perlのデータベース接続の標準。あらゆるデータベースに統一的なインターフェースでアクセスできます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use DBI; my $dbh = DBI-\u0026gt;connect( \u0026#39;dbi:SQLite:dbname=test.db\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, AutoCommit =\u0026gt; 1 } ); # プレースホルダを使った安全なクエリ my $sth = $dbh-\u0026gt;prepare(\u0026#39;SELECT * FROM users WHERE age \u0026gt; ?\u0026#39;); $sth-\u0026gt;execute(20); while (my $row = $sth-\u0026gt;fetchrow_hashref) { say \u0026#34;$row-\u0026gt;{name} ($row-\u0026gt;{age})\u0026#34;; } # 挿入 $dbh-\u0026gt;do(\u0026#39;INSERT INTO users (name, age) VALUES (?, ?)\u0026#39;, undef, \u0026#39;太郎\u0026#39;, 30); 13. DBIx::Class 選定理由: PerlのO/Rマッパーの最高峰。複雑なクエリをオブジェクト指向で記述できます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # スキーマ定義（簡略版） package MyApp::Schema::Result::User; use base \u0026#39;DBIx::Class::Core\u0026#39;; __PACKAGE__-\u0026gt;table(\u0026#39;users\u0026#39;); __PACKAGE__-\u0026gt;add_columns(qw/id name email created_at/); __PACKAGE__-\u0026gt;set_primary_key(\u0026#39;id\u0026#39;); # 使用例 my $schema = MyApp::Schema-\u0026gt;connect(\u0026#39;dbi:SQLite:test.db\u0026#39;); # 検索 my $users = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;search( { created_at =\u0026gt; { \u0026#39;\u0026gt;\u0026#39; =\u0026gt; \u0026#39;2025-01-01\u0026#39; } }, { order_by =\u0026gt; { -desc =\u0026gt; \u0026#39;created_at\u0026#39; } } ); while (my $user = $users-\u0026gt;next) { say $user-\u0026gt;name; } # 作成 my $new_user = $schema-\u0026gt;resultset(\u0026#39;User\u0026#39;)-\u0026gt;create({ name =\u0026gt; \u0026#39;花子\u0026#39;, email =\u0026gt; \u0026#39;hanako@example.com\u0026#39;, }); オブジェクト指向 14. Moo 選定理由: 軽量で高速なモダンなオブジェクトシステム。ほとんどのケースでこれで十分です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package Person; use Moo; has name =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, required =\u0026gt; 1); has age =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, default =\u0026gt; 0); has email =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; sub { die \u0026#34;Invalid email\u0026#34; unless $_[0] =~ /@/ }, ); sub greet { my $self = shift; return \u0026#34;Hello, I\u0026#39;m \u0026#34; . $self-\u0026gt;name; } # 使用例 my $person = Person-\u0026gt;new( name =\u0026gt; \u0026#39;太郎\u0026#39;, age =\u0026gt; 30, email =\u0026gt; \u0026#39;taro@example.com\u0026#39;, ); say $person-\u0026gt;greet; $person-\u0026gt;age(31); 15. Moose 選定理由: フル機能のオブジェクトシステム。型制約、ロール、メタプログラミングなど高度な機能が必要な場合に。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 package BankAccount; use Moose; use Moose::Util::TypeConstraints; subtype \u0026#39;PositiveNum\u0026#39;, as \u0026#39;Num\u0026#39;, where { $_ \u0026gt;= 0 }, message { \u0026#34;Balance must be positive\u0026#34; }; has \u0026#39;balance\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;PositiveNum\u0026#39;, default =\u0026gt; 0, ); has \u0026#39;owner\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; \u0026#39;Str\u0026#39;, required =\u0026gt; 1, ); sub deposit { my ($self, $amount) = @_; $self-\u0026gt;balance($self-\u0026gt;balance + $amount); } sub withdraw { my ($self, $amount) = @_; die \u0026#34;Insufficient funds\u0026#34; if $self-\u0026gt;balance \u0026lt; $amount; $self-\u0026gt;balance($self-\u0026gt;balance - $amount); } __PACKAGE__-\u0026gt;meta-\u0026gt;make_immutable; テスト 16. Test2::Suite 選定理由: 次世代のテストフレームワーク。Test::Moreの後継で、より強力で拡張性があります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use Test2::V0; # 基本的なテスト ok(1, \u0026#39;This passes\u0026#39;); is(1 + 1, 2, \u0026#39;Math works\u0026#39;); # 構造体の比較 is( { name =\u0026gt; \u0026#39;Taro\u0026#39;, age =\u0026gt; 30 }, { name =\u0026gt; \u0026#39;Taro\u0026#39;, age =\u0026gt; 30 }, \u0026#39;Hash matches\u0026#39; ); # 例外のテスト like( dies { die \u0026#34;Error!\u0026#34; }, qr/Error/, \u0026#39;Dies with correct message\u0026#39; ); # サブテスト subtest \u0026#39;User tests\u0026#39; =\u0026gt; sub { my $user = User-\u0026gt;new(name =\u0026gt; \u0026#39;Test\u0026#39;); ok($user, \u0026#39;User created\u0026#39;); is($user-\u0026gt;name, \u0026#39;Test\u0026#39;, \u0026#39;Name is correct\u0026#39;); }; done_testing; 17. Test::More 選定理由: コアモジュールのテストフレームワーク。シンプルで学習コストが低く、広く使われています。\n1 2 3 4 5 6 7 8 use Test::More tests =\u0026gt; 5; ok(1, \u0026#39;Always passes\u0026#39;); is(\u0026#39;hello\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;String equality\u0026#39;); isnt(\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;Not equal\u0026#39;); like(\u0026#39;abc123\u0026#39;, qr/\\d+/, \u0026#39;Contains digits\u0026#39;); can_ok(\u0026#39;MyClass\u0026#39;, qw(new fetch update)); 18. Devel::Cover 選定理由: コードカバレッジ測定の標準ツール。テストの網羅性を可視化できます。\n1 2 3 4 5 # カバレッジ測定 cover -test # HTMLレポート生成 cover -report html 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # テストファイル内で特定の条件を網羅 use Test::More; my @test_cases = ( [1, 2, 3], [0, 0, 0], [-1, 5, 4], ); for my $case (@test_cases) { my ($a, $b, $expected) = @$case; is(add($a, $b), $expected, \u0026#34;add($a, $b) = $expected\u0026#34;); } done_testing; ユーティリティ 19. List::Util / List::MoreUtils 選定理由: リスト操作の定番。List::Utilはコアモジュール、List::MoreUtilsはさらに便利な関数を提供します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 use List::Util qw(first max min sum reduce any all); use List::MoreUtils qw(uniq zip); # List::Util my @numbers = (1, 5, 3, 9, 2); say max(@numbers); # 9 say min(@numbers); # 1 say sum(@numbers); # 20 my $first_even = first { $_ % 2 == 0 } @numbers; # 2 my $product = reduce { $a * $b } 1..5; # 120 say \u0026#34;All positive\u0026#34; if all { $_ \u0026gt; 0 } @numbers; say \u0026#34;Has even\u0026#34; if any { $_ % 2 == 0 } @numbers; # List::MoreUtils my @unique = uniq(1, 2, 2, 3, 3, 3); # (1, 2, 3) my @names = (\u0026#39;Alice\u0026#39;, \u0026#39;Bob\u0026#39;, \u0026#39;Carol\u0026#39;); my @ages = (30, 25, 35); my @pairs = zip @names, @ages; # (\u0026#39;Alice\u0026#39;, 30, \u0026#39;Bob\u0026#39;, 25, \u0026#39;Carol\u0026#39;, 35) 20. Try::Tiny 選定理由: 安全な例外処理。evalブロックの罠を避け、読みやすいエラーハンドリングを実現します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use Try::Tiny; try { my $result = risky_operation(); process($result); } catch { warn \u0026#34;Caught error: $_\u0026#34;; # $_ には例外が入る if (/network/i) { say \u0026#34;Network error, retrying...\u0026#34;; retry_with_backoff(); } else { die $_; # 再スロー } } finally { cleanup_resources(); }; # データベース接続の例 try { my $dbh = DBI-\u0026gt;connect($dsn, $user, $pass, { RaiseError =\u0026gt; 1 }); $dbh-\u0026gt;do(\u0026#39;UPDATE users SET active = 1 WHERE id = ?\u0026#39;, undef, $user_id); } catch { log_error(\u0026#34;Database error: $_\u0026#34;); send_alert_to_admin($_); }; まとめ 今回紹介した20のモジュールは、Perl開発において実績のある「定番」です。これらを使いこなすことで、以下のような利点があります：\n生産性の向上\n低レベルな処理を書く必要がなくなる バグの少ない安定したコードが書ける コミュニティで広く使われているため、情報が豊富 モダンなPerl開発\n古いPerl（Perl 4時代のイディオム）から脱却 オブジェクト指向やテスト駆動開発が容易に メンテナンスしやすいコードベースを構築 ベストプラクティス\nUTF-8対応が簡単に（Path::Tiny、Text::CSV_XS） 例外処理が安全に（Try::Tiny） 型安全性を確保（Moo/Mooseの型制約） cpanfileでの管理例 最後に、これらのモジュールを使ったプロジェクトのcpanfile例を示します：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # cpanfile requires \u0026#39;perl\u0026#39;, \u0026#39;5.024\u0026#39;; # Perl 5.24以上 # ファイル操作 requires \u0026#39;Path::Tiny\u0026#39;, \u0026#39;\u0026gt;= 0.144\u0026#39;; requires \u0026#39;File::Find::Rule\u0026#39;; # Web requires \u0026#39;HTTP::Tiny\u0026#39;; requires \u0026#39;Mojolicious\u0026#39;, \u0026#39;\u0026gt;= 9.0\u0026#39;; requires \u0026#39;Plack\u0026#39;; # データ処理 requires \u0026#39;JSON::MaybeXS\u0026#39;; requires \u0026#39;YAML::XS\u0026#39;; requires \u0026#39;XML::LibXML\u0026#39;; requires \u0026#39;Text::CSV_XS\u0026#39;; # 日時 requires \u0026#39;Time::Moment\u0026#39;; # データベース requires \u0026#39;DBI\u0026#39;; requires \u0026#39;DBD::SQLite\u0026#39;; # SQLite用ドライバ # OO requires \u0026#39;Moo\u0026#39;, \u0026#39;\u0026gt;= 2.0\u0026#39;; # ユーティリティ requires \u0026#39;List::MoreUtils\u0026#39;; requires \u0026#39;Try::Tiny\u0026#39;; # テスト（開発時のみ） on \u0026#39;test\u0026#39; =\u0026gt; sub { requires \u0026#39;Test2::Suite\u0026#39;; requires \u0026#39;Test::More\u0026#39;, \u0026#39;\u0026gt;= 1.302\u0026#39;; }; on \u0026#39;develop\u0026#39; =\u0026gt; sub { requires \u0026#39;Devel::Cover\u0026#39;; }; さらに学ぶために CPANの世界は広大です。今回紹介したモジュール以外にも、特定の用途に特化した優れたモジュールが無数に存在します：\nTask::Kensho: モダンなPerl開発に推奨されるモジュール集 MetaCPAN: https://metacpan.org/ でモジュールを検索 CPAN Ratings: コミュニティの評価を参考に YAPC: PerlのカンファレンスでCPAN作者から直接学ぶ Perlの格言に「車輪の再発明をするな」という言葉があります。CPANを活用することで、本来解くべき問題に集中できるのです。\n明日のPerl Advent Calendar Day 4もお楽しみに！\n","date":"2025-12-03T04:16:03+09:00","image":"https://www.nqou.net/public_images/cpan-is-20251203041603.jpg","permalink":"https://www.nqou.net/2025/12/03/041603/","title":"CPANとは — 実務で役立つCPANモジュール20選"},{"content":"Perlワンライナーの芸術 - コマンドラインでの強力なテキスト処理 Perl Advent Calendar 2025の2日目です。今日は、Perlの真骨頂とも言える「ワンライナー」について深く掘り下げていきます。\nPerlワンライナーは、コマンドライン上で1行のPerlコードを実行する技術です。シェルスクリプトやsed/awkでは複雑になる処理も、Perlワンライナーなら簡潔かつ強力に記述できます。Larry Wallが「テキスト処理の Swiss Army Knife（万能ナイフ）」として設計したPerlの本領が、ここに発揮されます。\nPerlワンライナーの基本オプション まずは、Perlワンライナーで頻繁に使用するコマンドラインオプションを理解しましょう。これらのオプションを組み合わせることで、強力なテキスト処理が可能になります。\n-e: コードを直接実行 最も基本的なオプションです。-e の後に続くPerlコードを実行します。\n1 perl -e \u0026#39;print \u0026#34;Hello, World!\\n\u0026#34;\u0026#39; 複数の -e オプションを指定することで、複数行のコードを実行できます。\n1 perl -e \u0026#39;$x = 10;\u0026#39; -e \u0026#39;$y = 20;\u0026#39; -e \u0026#39;print $x + $y, \u0026#34;\\n\u0026#34;\u0026#39; -n: 暗黙のループ -n オプションは、入力ファイルの各行に対してコードを実行します。内部的には以下のような構造になります。\n1 2 3 while (\u0026lt;\u0026gt;) { # ここに -e で指定したコードが入る } 各行は $_ 変数に格納されます。\n1 2 # ファイルの各行の先頭に行番号を付ける perl -ne \u0026#39;print \u0026#34;$. $_\u0026#34;\u0026#39; file.txt $. は現在の行番号を保持する特殊変数です。\n-p: 自動print付きループ -p は -n と似ていますが、各ループの最後に自動的に print $_ を実行します。\n1 2 3 4 while (\u0026lt;\u0026gt;) { # ここに -e で指定したコードが入る print $_; # 自動的に追加される } これにより、置換処理が非常に簡潔になります。\n1 2 # すべての \u0026#34;foo\u0026#34; を \u0026#34;bar\u0026#34; に置換 perl -pe \u0026#39;s/foo/bar/g\u0026#39; file.txt -l: 自動改行処理 -l オプションは2つの機能を提供します。\n入力時に各行の末尾の改行文字を自動削除（chomp相当） 出力時に自動的に改行を追加 1 2 3 4 5 # -l なし perl -ne \u0026#39;print $_\u0026#39; file.txt # 改行がそのまま # -l あり perl -nle \u0026#39;print $_\u0026#39; file.txt # 行末の改行を削除してから、printで自動追加 特に -p と組み合わせるときは、改行の扱いに注意が必要です。\n1 2 # 正しい: -l を使って改行を適切に処理 perl -ple \u0026#39;s/foo/bar/\u0026#39; file.txt -a: 自動フィールド分割 -a オプションは、各行を自動的に空白で分割し、配列 @F に格納します。awkのような処理が可能になります。\n1 2 # 3列目だけを表示（awkの $3 相当） perl -lane \u0026#39;print $F[2]\u0026#39; file.txt -F オプションと組み合わせることで、区切り文字を指定できます。\n1 2 3 4 5 # CSVの2列目を表示 perl -F, -lane \u0026#39;print $F[1]\u0026#39; data.csv # コロン区切りの1列目と3列目を表示 perl -F: -lane \u0026#39;print \u0026#34;$F[0]: $F[2]\u0026#34;\u0026#39; /etc/passwd -i: インプレース編集 -i オプションは、ファイルを直接編集します。元のファイルを上書きするため、注意が必要です。\n1 2 # ファイル内のすべての \u0026#34;old\u0026#34; を \u0026#34;new\u0026#34; に置換 perl -i -pe \u0026#39;s/old/new/g\u0026#39; file.txt バックアップを作成する場合は、-i の後に拡張子を指定します。\n1 2 # .bak バックアップを作成してから編集 perl -i.bak -pe \u0026#39;s/old/new/g\u0026#39; file.txt -0: レコード区切り文字の変更 -0 オプションは入力レコード区切り文字（$/）を変更します。8進数で指定します。\n1 2 3 4 5 6 7 8 # ヌル文字区切り（findの -print0 と組み合わせる） find . -name \u0026#34;*.txt\u0026#34; -print0 | perl -0ne \u0026#39;print\u0026#39; # パラグラフモード（空行で区切る） perl -00 -ne \u0026#39;print if /keyword/\u0026#39; file.txt # ファイル全体を1つの文字列として読み込む perl -0777 -ne \u0026#39;print \u0026#34;Lines: \u0026#34;, scalar(split /\\n/), \u0026#34;\\n\u0026#34;\u0026#39; file.txt -M: モジュールのロード -M オプションでCPANモジュールを使用できます。ワンライナーの能力が格段に向上します。\n1 2 3 4 5 6 7 8 # JSONのパース echo \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;Perl\u0026#34;,\u0026#34;year\u0026#34;:1987}\u0026#39; | perl -MJSON -0777 -nle \u0026#39;$d=decode_json($_); print $d-\u0026gt;{name}\u0026#39; # 日時処理 perl -MTime::Piece -le \u0026#39;print localtime-\u0026gt;strftime(\u0026#34;%Y-%m-%d\u0026#34;)\u0026#39; # HTTPリクエスト perl -MHTTP::Tiny -le \u0026#39;print HTTP::Tiny-\u0026gt;new-\u0026gt;get(\u0026#34;https://example.com\u0026#34;)-\u0026gt;{content}\u0026#39; 実用的なワンライナー集 ここからは、実際の業務で使える具体的なワンライナーを紹介します。すべて動作確認済みです。\n1. ログファイルの解析 アクセスログからエラー行だけを抽出し、日時とメッセージを整形して表示します。\n1 2 3 4 5 6 7 8 # Apacheログからエラーを抽出 perl -nle \u0026#39;print \u0026#34;$1: $2\u0026#34; if /^\\[([^\\]]+)\\].*\\[error\\] (.+)$/\u0026#39; error.log # 特定の時間帯のログだけを抽出 perl -nle \u0026#39;print if /2025-12-02 0[89]:/\u0026#39; access.log # ステータスコードごとにカウント perl -nle \u0026#39;$c{$1}++ if /\u0026#34;[^\u0026#34;]*\u0026#34; (\\d{3})/; END { print \u0026#34;$_: $c{$_}\u0026#34; for sort keys %c }\u0026#39; access.log 2. CSVデータの加工 CSVファイルの特定列を抽出、変換、フィルタリングします。\n1 2 3 4 5 6 7 8 9 10 11 # 2列目と4列目だけを抽出 perl -F, -lane \u0026#39;print \u0026#34;$F[1],$F[3]\u0026#34;\u0026#39; data.csv # 金額列（3列目）の合計を計算 perl -F, -lane \u0026#39;$sum += $F[2]; END { print $sum }\u0026#39; sales.csv # 条件に合う行だけを抽出（5列目が100以上） perl -F, -lane \u0026#39;print if $F[4] \u0026gt;= 100\u0026#39; data.csv # CSVのヘッダー行をスキップして処理 perl -F, -lane \u0026#39;next if $. == 1; print $F[0]\u0026#39; data.csv 3. テキストの一括置換 複数ファイルに対する一括置換処理です。\n1 2 3 4 5 6 7 8 9 10 11 # すべての .txt ファイルの \u0026#34;old\u0026#34; を \u0026#34;new\u0026#34; に置換（バックアップ付き） perl -i.bak -pe \u0026#39;s/old/new/g\u0026#39; *.txt # メールアドレスを匿名化 perl -i -pe \u0026#39;s/[\\w.-]+@[\\w.-]+/***@***.***/\u0026#39; data.txt # タブをスペース4つに変換 perl -i -pe \u0026#39;s/\\t/ /g\u0026#39; *.txt # 行末の空白を削除 perl -i -pe \u0026#39;s/\\s+$//\u0026#39; *.txt 4. データの統計処理 数値データの基本統計量を計算します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 合計、平均、最大、最小を計算 perl -nle \u0026#39; $sum += $_; $count++; $max = $_ if !defined($max) || $_ \u0026gt; $max; $min = $_ if !defined($min) || $_ \u0026lt; $min; END { print \u0026#34;Sum: $sum\u0026#34;; print \u0026#34;Average: \u0026#34;, $sum/$count; print \u0026#34;Max: $max\u0026#34;; print \u0026#34;Min: $min\u0026#34;; } \u0026#39; numbers.txt # ユニークな値の数をカウント perl -nle \u0026#39;$h{$_}++; END { print scalar keys %h }\u0026#39; data.txt # 出現回数でソートして頻度の高い上位10件を表示 perl -nle \u0026#39;$c{$_}++; END { for (sort { $c{$b} \u0026lt;=\u0026gt; $c{$a} } keys %c) { print \u0026#34;$c{$_}: $_\u0026#34;; last if ++$i \u0026gt;= 10 } }\u0026#39; access.log 5. ファイル名の一括変更 ファイル名を一括でリネームします。\n1 2 3 4 5 6 7 8 9 10 11 # .txt を .md に変更（実行前に確認） perl -nle \u0026#39;print \u0026#34;mv $_ \u0026#34;, s/\\.txt$/.md/r\u0026#39; \u0026lt;(ls *.txt) # 実際にリネームを実行 ls *.txt | perl -nle \u0026#39;rename $_, s/\\.txt$/.md/r\u0026#39; # ファイル名の空白をアンダースコアに変換 perl -MFile::Copy -e \u0026#39;for (@ARGV) { my $new = $_; $new =~ s/ /_/g; move($_, $new) if $new ne $_ }\u0026#39; * # 連番を付与してリネーム ls *.jpg | perl -nle \u0026#39;rename $_, sprintf(\u0026#34;%03d.jpg\u0026#34;, ++$i)\u0026#39; 6. JSON/YAML処理 構造化データの変換と抽出です。\n1 2 3 4 5 6 7 8 9 10 11 12 # JSONをきれいに整形 perl -MJSON -0777 -nle \u0026#39;print JSON-\u0026gt;new-\u0026gt;pretty-\u0026gt;encode(decode_json($_))\u0026#39; data.json # JSONから特定のフィールドを抽出 echo \u0026#39;{\u0026#34;users\u0026#34;:[{\u0026#34;name\u0026#34;:\u0026#34;Alice\u0026#34;,\u0026#34;age\u0026#34;:30},{\u0026#34;name\u0026#34;:\u0026#34;Bob\u0026#34;,\u0026#34;age\u0026#34;:25}]}\u0026#39; | \\ perl -MJSON -0777 -nle \u0026#39;$d=decode_json($_); print $_-\u0026gt;{name} for @{$d-\u0026gt;{users}}\u0026#39; # 複数行のJSONを1行ずつパース perl -MJSON -nle \u0026#39;$d=decode_json($_); print $d-\u0026gt;{id}, \u0026#34;: \u0026#34;, $d-\u0026gt;{message}\u0026#39; stream.jsonl # ハッシュをJSONに変換 perl -MJSON -le \u0026#39;print encode_json({name =\u0026gt; \u0026#34;Perl\u0026#34;, year =\u0026gt; 1987})\u0026#39; 7. 正規表現マッチングとキャプチャ 複雑なパターンマッチングと抽出を行います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # URLからドメイン名を抽出 perl -nle \u0026#39;print $1 if m{https?://([^/]+)}\u0026#39; urls.txt # メールアドレスを抽出 perl -nle \u0026#39;print $\u0026amp; while /[\\w.-]+@[\\w.-]+\\.\\w+/g\u0026#39; text.txt # HTMLタグを除去 perl -pe \u0026#39;s/\u0026lt;[^\u0026gt;]+\u0026gt;//g\u0026#39; page.html # キャプチャグループを使った複雑な置換 perl -pe \u0026#39;s/(\\d{4})-(\\d{2})-(\\d{2})/$3\\/$2\\/$1/g\u0026#39; dates.txt # YYYY-MM-DD -\u0026gt; DD/MM/YYYY # 名前付きキャプチャ（Perl 5.10+） echo \u0026#34;2025-12-02\u0026#34; | perl -nle \u0026#39;print \u0026#34;$+{day}/$+{month}/$+{year}\u0026#34; if /(?\u0026lt;year\u0026gt;\\d{4})-(?\u0026lt;month\u0026gt;\\d{2})-(?\u0026lt;day\u0026gt;\\d{2})/\u0026#39; 8. 行のフィルタリングと変換 条件に基づいた行の選択と変換を行います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 空行を削除 perl -ne \u0026#39;print unless /^\\s*$/\u0026#39; file.txt # 重複行を削除（順序を保持） perl -ne \u0026#39;print unless $seen{$_}++\u0026#39; file.txt # 行を逆順に表示 perl -e \u0026#39;print reverse \u0026lt;\u0026gt;\u0026#39; file.txt # 特定のパターンから特定のパターンまでを抽出 perl -ne \u0026#39;print if /START/ .. /END/\u0026#39; file.txt # 偶数行だけを表示 perl -ne \u0026#39;print if $. % 2 == 0\u0026#39; file.txt # ランダムに10行をサンプリング perl -ne \u0026#39;push @lines, $_; END { print $lines[rand @lines] for 1..10 }\u0026#39; large.txt 9. エンコーディング変換 文字コードの変換を行います。\n1 2 3 4 5 6 7 8 # UTF-8からShift_JISへ変換 perl -Mutf8 -MEncode -pe \u0026#39;$_ = encode(\u0026#34;shift_jis\u0026#34;, decode(\u0026#34;utf-8\u0026#34;, $_))\u0026#39; input.txt \u0026gt; output.txt # Shift_JISからUTF-8へ変換 perl -MEncode -pe \u0026#39;$_ = encode(\u0026#34;utf-8\u0026#34;, decode(\u0026#34;shift_jis\u0026#34;, $_))\u0026#39; input.txt \u0026gt; output.txt # UTF-8であることを確認してから処理 perl -Mutf8 -CS -nle \u0026#39;print\u0026#39; file.txt -CS オプションは標準入出力をUTF-8として扱います。\n10. 日時処理 日時の計算やフォーマット変換を行います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 現在の日時をISO 8601形式で表示 perl -MTime::Piece -le \u0026#39;print localtime-\u0026gt;datetime\u0026#39; # エポック秒を人間が読める形式に変換 echo 1733065200 | perl -MTime::Piece -nle \u0026#39;print scalar localtime $_\u0026#39; # 日時文字列をエポック秒に変換 echo \u0026#34;2025-12-02 00:00:00\u0026#34; | perl -MTime::Piece -nle \u0026#39;print Time::Piece-\u0026gt;strptime($_, \u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;)-\u0026gt;epoch\u0026#39; # 7日前の日付を表示 perl -MTime::Piece -le \u0026#39;print localtime(time - 7*24*60*60)-\u0026gt;ymd\u0026#39; # ログファイルから今日の日付の行だけを抽出 perl -MTime::Piece -nle \u0026#39;BEGIN { $today = localtime-\u0026gt;ymd } print if /$today/\u0026#39; log.txt 11. Base64エンコード/デコード Base64の変換を行います。\n1 2 3 4 5 6 7 8 9 10 11 # 文字列をBase64エンコード echo \u0026#34;Hello, Perl\u0026#34; | perl -MMIME::Base64 -ne \u0026#39;print encode_base64($_)\u0026#39; # Base64デコード echo \u0026#34;SGVsbG8sIFBlcmwK\u0026#34; | perl -MMIME::Base64 -ne \u0026#39;print decode_base64($_)\u0026#39; # ファイルをBase64エンコード perl -MMIME::Base64 -0777 -ne \u0026#39;print encode_base64($_)\u0026#39; image.png \u0026gt; image.b64 # Base64デコードしてファイルに保存 perl -MMIME::Base64 -0777 -ne \u0026#39;print decode_base64($_)\u0026#39; image.b64 \u0026gt; image.png 12. ネットワーク処理 HTTPリクエストやネットワーク情報の取得を行います。\n1 2 3 4 5 6 7 8 9 10 11 12 # 以下のサンプルの実行には IO::Socket::SSL, Net::SSLeay も必要です。必要に応じてインストールしてください # HTTPでコンテンツを取得 perl -MHTTP::Tiny -le \u0026#39;print HTTP::Tiny-\u0026gt;new-\u0026gt;get(\u0026#34;https://example.com\u0026#34;)-\u0026gt;{content}\u0026#39; # HTTPステータスコードを確認 perl -MHTTP::Tiny -le \u0026#39;$r=HTTP::Tiny-\u0026gt;new-\u0026gt;get(\u0026#34;https://example.com\u0026#34;); print $r-\u0026gt;{status}\u0026#39; # 複数のURLの存在確認 perl -MHTTP::Tiny -le \u0026#39;$h=HTTP::Tiny-\u0026gt;new; for(@ARGV){$r=$h-\u0026gt;head($_);print\u0026#34;$_: $r-\u0026gt;{status}\u0026#34;}\u0026#39; url1 url2 url3 # APIからJSONを取得してパース perl -MHTTP::Tiny -MJSON -le \u0026#39;$c=HTTP::Tiny-\u0026gt;new-\u0026gt;get(\u0026#34;https://api.example.com/data\u0026#34;)-\u0026gt;{content}; $d=decode_json($c); print $d-\u0026gt;{key}\u0026#39; ワンライナーから学ぶPerlのイディオム Perlワンライナーを書くことで、Perlの重要なイディオムが自然に身につきます。\nデフォルト変数 $_ $_ はPerlのデフォルト変数で、多くの関数や演算子が暗黙的に使用します。\n1 2 3 4 5 # 明示的 perl -ne \u0026#39;print $_ if $_ =~ /pattern/\u0026#39; file.txt # 暗黙的（推奨） perl -ne \u0026#39;print if /pattern/\u0026#39; file.txt ポストフィックス条件 条件を後ろに書くスタイルは、ワンライナーで非常に読みやすくなります。\n1 2 3 print if /pattern/; # パターンにマッチしたら表示 next unless $. \u0026gt; 10; # 11行目以降を処理 $count++ for @items; # 各要素でカウント ENDブロック END ブロックは、すべての処理が終わった後に実行されます。集計処理に便利です。\n1 perl -nle \u0026#39;$sum += $_; END { print $sum }\u0026#39; numbers.txt ハッシュによるカウントとユニーク化 ハッシュを使ったパターンは頻出します。\n1 2 3 4 5 # 重複除去 perl -ne \u0026#39;print unless $seen{$_}++\u0026#39; file.txt # 出現回数カウント perl -nle \u0026#39;$count{$_}++; END { print \u0026#34;$_: $count{$_}\u0026#34; for keys %count }\u0026#39; file.txt 正規表現の/rモディファイア（Perl 5.14+） /r モディファイアは、元の変数を変更せずに置換結果を返します。\n1 2 3 4 my $new = $old =~ s/foo/bar/r; # $oldは変更されない # ファイル名変換で便利 rename $_, s/\\.txt$/.md/r for @files; 三項演算子の活用 簡潔な条件分岐に使用します。\n1 perl -nle \u0026#39;print $. % 2 == 0 ? \u0026#34;even: $_\u0026#34; : \u0026#34;odd: $_\u0026#34;\u0026#39; file.txt よく使うパターン集 実務でよく使うパターンをまとめました。これらをテンプレートとして活用してください。\nパターン1: 条件に合う行を抽出 1 2 3 perl -ne \u0026#39;print if /pattern/\u0026#39; file.txt perl -ne \u0026#39;print unless /pattern/\u0026#39; file.txt perl -ne \u0026#39;print if /start/ .. /end/\u0026#39; file.txt パターン2: フィールド処理（CSV/TSV） 1 2 perl -F, -lane \u0026#39;print $F[N]\u0026#39; file.csv perl -F\u0026#39;\\t\u0026#39; -lane \u0026#39;print join(\u0026#34;,\u0026#34;, @F)\u0026#39; file.tsv パターン3: 置換と変換 1 2 perl -pe \u0026#39;s/old/new/g\u0026#39; file.txt perl -i.bak -pe \u0026#39;s/old/new/g\u0026#39; file.txt パターン4: カウントと集計 1 2 perl -nle \u0026#39;$c{$_}++; END { print \u0026#34;$_: $c{$_}\u0026#34; for keys %c }\u0026#39; file.txt perl -nle \u0026#39;$sum += $_; END { print $sum }\u0026#39; numbers.txt パターン5: モジュールを使った処理 1 2 3 perl -MJSON -0777 -nle \u0026#39;print encode_json(decode_json($_))\u0026#39; file.json perl -MTime::Piece -le \u0026#39;print localtime-\u0026gt;ymd\u0026#39; perl -MHTTP::Tiny -le \u0026#39;print HTTP::Tiny-\u0026gt;new-\u0026gt;get($ARGV[0])-\u0026gt;{content}\u0026#39; url ワンライナーからスクリプトへの発展 ワンライナーが複雑になってきたら、スクリプトに移行することを検討しましょう。\nワンライナーをスクリプト化する手順 ワンライナーを展開: -n、-p、-l などを実際のコードに変換 use strict/warnings追加: より堅牢なコードに サブルーチン化: 再利用可能な部分を関数に エラーハンドリング追加: 例外処理を追加 例えば、このワンライナー：\n1 perl -F, -lane \u0026#39;$sum{$F[0]} += $F[2]; END { print \u0026#34;$_: $sum{$_}\u0026#34; for keys %sum }\u0026#39; sales.csv これをスクリプトに変換すると：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/usr/bin/env perl use strict; use warnings; use v5.36; my %sum; while (my $line = \u0026lt;\u0026gt;) { chomp $line; my @fields = split /,/, $line; next unless @fields \u0026gt;= 3; # フィールド数チェック my $category = $fields[0]; my $amount = $fields[2]; # 数値チェック next unless $amount =~ /^\\d+(?:\\.\\d+)?$/; $sum{$category} += $amount; } # 結果を出力（カテゴリ順にソート） for my $category (sort keys %sum) { say \u0026#34;$category: $sum{$category}\u0026#34;; } いつスクリプト化すべきか 以下の場合はスクリプトに移行を検討してください：\nワンライナーが1行に収まらない: 読みにくくなる エラーハンドリングが必要: 本番環境での使用 再利用する: 何度も使う処理 複雑なロジック: 複数の条件分岐や計算 テストが必要: Test::Moreなどでテストを書く チーム共有: 他の人が読める形式に トラブルシューティング ワンライナーでよくある問題と解決策です。\n問題1: シェルとの引用符の衝突 1 2 3 4 5 6 7 8 # NG: シングルクォート内にシングルクォートを使用 perl -e \u0026#39;print \u0026#34;It\u0026#39;s Perl\u0026#34;\u0026#39; # エラー # OK: ダブルクォートを使用 perl -e \u0026#34;print \\\u0026#34;It\u0026#39;s Perl\\\u0026#34;\u0026#34; # OK: ヒアドキュメント風 perl -e \u0026#39;print \u0026#34;It\u0026#39;\u0026#34;\u0026#39;\u0026#34;\u0026#39;s Perl\u0026#34;\u0026#39; # シングルクォートを抜けて結合 問題2: 改行の扱い 1 2 3 4 5 # chomp忘れでダブル改行 perl -ne \u0026#39;print $_\u0026#39; file.txt # 改行が2つ # -l で自動処理 perl -nle \u0026#39;print\u0026#39; file.txt # 正常な改行 問題3: エンコーディング問題 1 2 3 4 5 # Wide character in print エラー perl -ne \u0026#39;print\u0026#39; utf8.txt # エラーの可能性 # UTF-8を明示 perl -Mutf8 -CS -ne \u0026#39;print\u0026#39; utf8.txt 問題4: バックスラッシュのエスケープ 1 2 3 4 5 # Windowsのパス perl -ne \u0026#39;print if /C:\\\\Users/\u0026#39; file.txt # バックスラッシュをエスケープ # 正規表現で \\d \\w など perl -ne \u0026#39;print if /\\d+/\u0026#39; file.txt # 問題なし パフォーマンスのヒント 大きなファイルを処理する際のパフォーマンス最適化です。\n1. 早期終了 不要な処理をスキップします。\n1 2 3 4 5 # 最初の10行だけ処理 perl -ne \u0026#39;print; last if $. \u0026gt;= 10\u0026#39; large.txt # 条件に合う行が見つかったら終了 perl -ne \u0026#39;print and last if /pattern/\u0026#39; large.txt 2. next/lastの活用 1 2 3 4 5 # ヘッダー行をスキップ perl -ne \u0026#39;next if $. == 1; print\u0026#39; file.csv # 空行をスキップ perl -ne \u0026#39;next if /^\\s*$/; print\u0026#39; file.txt 3. 正規表現の最適化 1 2 3 4 5 6 # 非貪欲マッチより貪欲マッチの方が速い perl -ne \u0026#39;print if /\u0026lt;div\u0026gt;.*?\u0026lt;\\/div\u0026gt;/\u0026#39; # 遅い perl -ne \u0026#39;print if /\u0026lt;div\u0026gt;[^\u0026lt;]*\u0026lt;\\/div\u0026gt;/\u0026#39; # 速い # qr// でコンパイル済み正規表現（複数回使う場合） perl -ne \u0026#39;BEGIN { $re = qr/\\d{3}-\\d{4}/ } print if /$re/\u0026#39; file.txt まとめ - Perlワンライナーの魅力 Perlワンライナーは、以下のような場面で真価を発揮します：\nデータの即興加工: ログ解析、CSV処理、テキスト変換 プロトタイピング: アイデアを素早く試す シェルスクリプトの強化: sed/awkより強力で柔軟 1回限りの処理: スクリプトを書くほどではない作業 対話的なデータ探索: データの中身を素早く確認 Perlの「There\u0026rsquo;s More Than One Way To Do It」という哲学は、ワンライナーにも生きています。同じ処理でも、-n と -p、-l の有無、正規表現のスタイルなど、様々な書き方があります。\n最初は短いワンライナーから始めて、徐々に複雑な処理に挑戦してください。そして、ワンライナーが長くなりすぎたら、ためらわずにスクリプトに移行しましょう。\nPerlワンライナーは、学習コストに対して得られるものが非常に大きいスキルです。日常のテキスト処理を効率化し、データ分析を加速させ、問題解決を迅速にしてくれます。\n明日のPerl Advent Calendarもお楽しみに！\n参考資料 perlrun - how to execute the Perl interpreter - Perldoc Browser perldoc.perl.org http://www.oreilly.com/catalog/miniperl/ www.oreilly.com Perl One-Liners Explained, Part I: File Spacing Hi all! I am starting yet another article series here. Remember my two articles on Awk One-Liners Explained and Sed … catonmat.net perlreref - Perl Regular Expressions Reference - Perldoc Browser perldoc.perl.org 使用した環境 Perl: 5.36.0以上を推奨 OS: Linux/macOS/WSL（Windowsの場合はWSL推奨） 必要なモジュール（例で使用）: JSON（cpanm JSON） HTTP::Tiny（コアモジュール） Time::Piece（コアモジュール） MIME::Base64（コアモジュール） すべてのコード例は検証済みです。ご自身の環境で試してみてください！\n","date":"2025-12-02T03:28:50+09:00","image":"https://www.nqou.net/public_images/art-of-perl-one-liners-20251202032850.jpg","permalink":"https://www.nqou.net/2025/12/02/032850/","title":"Perlワンライナーの芸術 - コマンドラインでの強力なテキスト処理"},{"content":"Perl Advent Calendar 2025 へようこそ！ @nqounetです。\n12月1日、いよいよ Perl Advent Calendar 2025 が始まります！この25日間、毎日Perlに関する記事をお届けしていく予定です。初日となる今日は、この企画の趣旨と今後の予定についてお話しします。\nアドベントカレンダーとは アドベントカレンダー（Advent Calendar）は、もともとクリスマスまでの日数を数えるためのカレンダーです。IT業界では、12月1日から25日まで、毎日異なる著者が特定のテーマについて記事を公開していく企画として定着しています。\nPerlコミュニティでも、毎年様々なアドベントカレンダーが開催されており、初心者向けのTipsから上級者向けの深い技術解説まで、多彩な記事が公開されてきました。日本では Perl Advent Calendar が有名ですし、海外では Perl Advent Calendar が長年続いています。\nこの企画の特徴 - AI技術の活用 今回の Perl Advent Calendar 2025 には、一つ大きな特徴があります。それは、記事の執筆にAI技術を活用しているという点です。\nなぜAIを使うのか？ 「Perlの記事をAIに書かせるなんて！」と思われる方もいらっしゃるかもしれません。しかし、これは単なる手抜きではなく、むしろ挑戦的な試みです。\n技術の実験場として: AI時代において、Perlがどのように活用できるか、AIとPerlがどう協調できるかを探る 継続性の担保: 個人で25日間書き続けるのは困難ですが、AIの力を借りることで安定した更新が可能に 品質の向上: 専門知識を持つAIエージェントと人間の編集者が協力することで、より正確で読みやすい記事を目指す 透明性: AI活用を隠さず、むしろ積極的に公開することで、新しい技術記事執筆のあり方を提案 AIと人間の協力体制 この企画では、以下のような役割分担で記事を作成しています：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 記事作成のワークフロー（概念的なコード） package AdventCalendar::ArticleCreation; sub create_article { my ($topic) = @_; # フェーズ1: Perl専門家AIが技術的に正確な原稿を作成 my $draft = PerlSpecialist-\u0026gt;write_draft($topic); # フェーズ2: 編集者AIが読みやすく構成 my $article = BlogWriter-\u0026gt;edit($draft); # フェーズ3: 人間が最終確認とレビュー my $final = Human-\u0026gt;review($article); return $final; } Perl専門家AI: CPANモジュール、文法、ベストプラクティスなど、技術的に正確な内容を執筆 編集者AI: 構成を整え、読みやすく、分かりやすい記事に仕上げる 人間: 最終的な品質チェック、公開判断、読者とのコミュニケーション 予定しているトピック 25日間で扱う予定のテーマをいくつかご紹介します：\nPerlの基礎と魅力 ワンライナーの芸術: Perlの真骨頂、コマンドラインでの強力なテキスト処理 正規表現マスター: Perlといえば正規表現！その深淵なる世界へ リファレンスの理解: スカラーリファレンス、配列リファレンス、ハッシュリファレンスを完全理解 コンテキストの魔法: スカラーコンテキストとリストコンテキスト、void コンテキスト CPANエコシステム 1 2 3 4 5 6 7 8 use CPAN::Meta; # CPANは宝の山 # 便利なモジュールたち use Path::Tiny; # ファイル操作の決定版 use HTTP::Tiny; # 軽量HTTPクライアント use JSON::MaybeXS; # 最速のJSONパーサー use Time::Moment; # 高速で正確な日時処理 use Moo; # モダンなオブジェクト指向 必須CPANモジュール30選: 現場で本当に使える厳選モジュール Task::Kensho: Perlの啓蒙的モジュール集 Carton/cpanfile: モダンな依存関係管理 CPAN入門: 自作モジュールの公開方法 Webアプリケーション Mojolicious入門: 現代的で楽しいWebフレームワーク Plack/PSGI: Webアプリケーションの基盤技術 Minion: 高機能なジョブキューシステム WebSocket活用: リアルタイム通信の実装 モダンPerl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package ModernPerl::Example { use v5.36; # 最新のPerl機能を活用 use Moo; use Types::Standard qw(Str Int); has name =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Str, ); has age =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; Int, ); sub introduce ($self) { # シグネチャ say \u0026#34;Hello, I\u0026#39;m \u0026#34; . $self-\u0026gt;name; } } Perl 5.36/5.38の新機能: postfix dereferencing, try-catch, class Moo/Moose: オブジェクト指向プログラミングの進化 Type::Tiny: 型制約で堅牢なコードを async/await: 非同期プログラミングの未来 テストとツール Test2フレームワーク: 次世代テストツール Devel::Cover: カバレッジ測定 Perl::Critic: コード品質の向上 Daiku: Makeの代替としてのビルドツール コミュニティとカルチャー YAPC::Japan: 日本のPerlカンファレンス Kansai.pm: 関西Perlコミュニティの活動 CPAN Authors: モジュール作者たちの物語 Perlの歴史: Larry Wall から現代まで Perlの現状とAI時代における位置づけ 「Perlはオワコン」という声を聞くこともあります。確かに、PythonやRuby、Node.jsなど、新しい言語やプラットフォームが次々と登場しています。AI/機械学習の分野ではPythonが圧倒的なシェアを持っています。\nしかし、Perlは決して終わっていません。\nPerlの強み 1 2 3 4 5 6 7 8 # テキスト処理の例：ログファイル解析 perl -nle \u0026#39;print \u0026#34;$1: $2\u0026#34; if /^(\\d{4}-\\d{2}-\\d{2}).*ERROR.*?:\\s*(.+)$/\u0026#39; access.log # JSONデータの変換 perl -MJSON -0777 -nle \u0026#39;print JSON-\u0026gt;new-\u0026gt;pretty-\u0026gt;encode(decode_json($_))\u0026#39; data.json # ディレクトリ一括処理 perl -MPath::Tiny -E \u0026#39;path(\u0026#34;.\u0026#34;)-\u0026gt;visit(sub { say if /\\.txt$/ }, {recurse =\u0026gt; 1})\u0026#39; テキスト処理の王者: 正規表現との親和性、ワンライナーの強力さは今も健在 安定性: 後方互換性を重視し、古いコードも動き続ける 豊富なライブラリ: CPAN には 40,000以上のモジュールが存在 システム管理: Linux/UNIXシステムでは標準で使える信頼性 実績: 金融、通信、Webサービスなど、ミッションクリティカルな現場で稼働 AI時代のPerl AI時代において、Perlには新しい役割があります：\nデータ前処理: AI/MLへの入力データの整形・クレンジング パイプライン統合: 様々なツールやAPIを繋ぐグルー言語として レガシーシステム連携: 既存システムとAIシステムの橋渡し テキスト解析: 自然言語処理の前段階としての高度なテキスト処理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use v5.36; use HTTP::Tiny; use JSON::MaybeXS qw(encode_json decode_json); # PerlからAI APIを呼び出す例 sub call_ai_api ($prompt) { my $http = HTTP::Tiny-\u0026gt;new; my $response = $http-\u0026gt;post( \u0026#39;https://api.example.com/ai/completion\u0026#39;, { headers =\u0026gt; { \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;application/json\u0026#39;, \u0026#39;Authorization\u0026#39; =\u0026gt; \u0026#34;Bearer $ENV{AI_API_KEY}\u0026#34;, }, content =\u0026gt; encode_json({ prompt =\u0026gt; $prompt, max_tokens =\u0026gt; 1000, }), } ); return decode_json($response-\u0026gt;{content}) if $response-\u0026gt;{success}; die \u0026#34;API call failed: $response-\u0026gt;{status}\u0026#34;; } 日本のPerlコミュニティ 日本には活発なPerlコミュニティが存在します。\nKansai.pm 私が所属する Kansai.pm は、関西地方を中心としたPerlコミュニティです。定期的に勉強会を開催し、技術情報の交換や親睦を深めています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Kansai.pmの精神 package Kansai; use Moo; has spirit =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, default =\u0026gt; sub { return { fun =\u0026gt; \u0026#39;Perlを楽しむ\u0026#39;, sharing =\u0026gt; \u0026#39;知識を共有する\u0026#39;, connection =\u0026gt; \u0026#39;人と繋がる\u0026#39;, local =\u0026gt; \u0026#39;地域に根ざす\u0026#39;, }; }, ); # 「楽しく学び、学びを楽しむ」 その他のコミュニティ Japan Perl Association (JPA): 日本のPerl普及活動を支援 YAPC::Japan: 日本最大級のPerlカンファレンス PM (Perl Mongers): 世界中に広がるローカルコミュニティ オンラインコミュニティ: Slack、Discord、SNSでの交流 読者への呼びかけ このアドベントカレンダーは、以下のような方々に読んでいただきたいと思っています：\nPerl初心者の方 心配無用: 基礎から丁寧に解説します 実用重視: すぐに使える実践的な内容を提供 質問歓迎: コメント欄でお気軽にご質問ください Perl経験者の方 新しい発見: 知らなかったモジュールや技法に出会えるかも AI活用の実例: AI時代の技術記事執筆の一例として フィードバック歓迎: 間違いや改善点のご指摘をお願いします Perlから離れていた方 おかえりなさい: Perlは進化し続けています モダンPerl: 昔のPerlとは違う、現代的な書き方を紹介 再入門: 新鮮な気持ちで学び直してみませんか？ 他言語使いの方 比較と学び: 他言語との違いから学べることがある ツールとして: Perlをツールボックスの一つとして 歴史と文化: プログラミング言語の多様性を知る コメントとフィードバック 記事には積極的にコメントをお寄せください！\n技術的な質問や疑問 記事の間違いや改善提案 「こんなトピックを扱ってほしい」というリクエスト Perlへの想いや経験談 このアドベントカレンダーは、読者の皆さんとの対話を通じて、より良いものにしていきたいと考えています。\n終わりに - There\u0026rsquo;s More Than One Way To Do It 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # TMTOWTDI - Perlの哲学 my @ways = qw( 探求心 創造性 実用性 楽しさ ); for my $way (@ways) { say \u0026#34;Perlは $way を大切にする\u0026#34;; } __END__ Perlは 探求心 を大切にする Perlは 創造性 を大切にする Perlは 実用性 を大切にする Perlは 楽しさ を大切にする 「やり方は一つじゃない」(There\u0026rsquo;s More Than One Way To Do It) - これはPerlの設計哲学であり、コミュニティの精神でもあります。\nこのアドベントカレンダーも、一つの「やり方」です。AI技術を活用した技術記事執筆という、新しい試みです。完璧ではないかもしれませんが、Perlの魅力を伝え、コミュニティを盛り上げる一助になれば幸いです。\nそれでは、25日間の Perl の旅を、一緒に楽しみましょう！\n明日は何のトピックが来るか、お楽しみに！\n技術情報\nPerl バージョン: 5.36+ を想定（コード例） 使用モジュール: すべてCPANから入手可能 ライセンス: コード例はパブリックドメイン（CC0） 関連リンク\nThe Perl Programming Language - www.perl.org The Perl Programming Language at Perl.org. Links and other helpful resources for new and experienced Perl programmers. www.perl.org Search the CPAN - metacpan.org MetaCPAN Perl - Qiita Advent Calendar 2025 - Qiita Calendar page for Qiita Advent Calendar 2025 regarding Perl. Qiita http://kansai.pm.org/ kansai.pm.org PerlMonks - The Monastery Gates www.perlmonks.org ","date":"2025-12-01T23:59:59+09:00","image":"https://www.nqou.net/public_images/perl-advent-calendar-20251201235959.jpg","permalink":"https://www.nqou.net/2025/12/01/235959/","title":"Perl Advent Calendar 2025 へようこそ！ - AIとPerlの新しい挑戦"},{"content":"@nqounetです。\nAGENTS.md と .github/instructions/post.instructions.md について色々と試行錯誤する中で、ブログを書くのになかなか良い感じになりました。今回は、そのリファクタリング体験と、AIエージェントへの指示ファイルについて詳しくお話しします。\n背景・きっかけ 別のプロジェクト「amazon-junkie」で、ブログ記事を書くためのAGENTS.mdを色々試していました。\namazon-junkie/AGENTS.md at main · nqou-net/amazon-junkie Contribute to nqou-net/amazon-junkie development by creating an account on GitHub. GitHub このAGENTS.mdがなかなか良い感じになったので、このブログ用にも移植することにしました。手書きで。\nしかし、移植してみると当然ながら重複しているところがたくさんありました。AGENTS.mdとpost.instructions.mdの両方に同じような内容が書かれている状態です。\nこれはリファクタリングが必要だ、ということで、Copilotに丸投げしてみました。\nAIエージェントへの指示ファイルとは 本題に入る前に、AIエージェントへの指示ファイルについて詳しく説明します。Copilotに限らず、AIエージェントへの指示ファイルは色々なところに書くことができるようになっています。\n1. AGENTS.md（業界標準） まず、業界標準と言えそうなのは AGENTS.md です。\nAGENTS.md AGENTS.md is a simple, open format for guiding coding agents. Think of it as a README for agents. agents.md AGENTS.mdは、どのディレクトリに置いても良く、最も近くにある指示ファイルが採用されるという仕組みになっています。リポジトリのルートに置けば全体に適用され、サブディレクトリに置けばそのディレクトリ以下に適用されます。\nメリット：\n複数のAIエージェントサービスで共通して使える ディレクトリごとに異なる指示を設定できる リポジトリの構造に沿った柔軟な設定が可能 デメリット：\ncontent/ ディレクトリにAGENTS.mdを置くと、Hugoなどの静的サイトジェネレーターではコンテンツ扱いになってしまう 隠しファイル的に「.（ドット）」から始めることができない（.agents.md のような形式は対応していない） 2. .github/copilot-instructions.md（GitHub Copilot固有） GitHub Copilotは .github/copilot-instructions.md を自動的に読み込みます。\n検索すればたくさんの情報が出てきますが、この形式はGitHub Copilot専用です。そのため、汎用性の観点からはAGENTS.mdを使う方が良いと考えています。\nメリット：\nGitHub Copilotが自動的に認識する GitHub公式のフォーマット デメリット：\nGitHub Copilot以外のAIエージェントでは認識されない 汎用性に欠ける 3. .github/instructions/ ディレクトリ（細かい使い分け） 標準化とは言い難いですが、現時点で最も細かく使い分けられるのが instructions です。\n.github/instructions/[name].instructions.md として配置します。\n1 2 3 4 --- description: \u0026#39;Guidelines for blogging articles\u0026#39; applyTo: \u0026#39;content/post/*.md\u0026#39; --- 上記のように、どこで有効になるかを front matter の applyTo で指定できます。\nメリット：\nファイルパターンごとに異なる指示を設定できる content/ ディレクトリにファイルを置かなくて良い 複数の指示ファイルを使い分けられる デメリット：\nGitHub Copilot固有の機能 他のAIエージェントでは認識されない可能性がある このサイトでの使い分け このブログサイトでは、以下のように使い分けています：\nファイル 用途 対象 AGENTS.md（ルート） Hugo全般の設定、プロジェクト構成 リポジトリ全体 .github/instructions/post.instructions.md ブログ記事の執筆ガイドライン content/post/*.md 全体のシステムはHugoなので、ルートにあるAGENTS.mdはHugoに関する情報が主体です。そして、コンテンツを保管する content/ 配下に対して効果を持たせるようにブログ用の指示ファイルを書いています。\nAGENTS.mdをcontent/に置くと、コンテンツ扱いになってしまうので扱いが面倒なんですよね。\n4. カスタムエージェント 指示ファイルとは少し用途が異なりますが、エージェントパネルやVS Codeなどのエディタで使えるカスタムエージェントという機能もあります。\nこれは使い所が難しいと感じています。特定のタスクに特化したエージェントを定義できますが、汎用的な指示ファイルとは異なる運用が必要です。\n参考リソース GitHubの awesome-copilot というリポジトリに、多くのawesomeな設定例が集まっています。プロンプトもたくさんあるので参考にしてみてください。\nGitHub - github/awesome-copilot: Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. - … GitHub 実際に行ったこと 今回のリファクタリングでは、以下の作業をCopilotに依頼しました：\nAGENTS.mdとpost.instructions.mdの重複を解消 役割分担を明確にする 冗長な記述を削除 具体的には、PRを作成してCopilotに「リファクタリングしてください」と指示しました。\nRefactor AGENTS.md and post.instructions.md to remove duplications by Copilot · Pull Request #37 · nqou-net/www.nqou.net 問題の分析：AGENTS.mdとpost.instructions.mdの重複・冗長箇所を特定 AGENTS.md のリファクタリング プロジェクト全体の指針として役割を明確化 記事作成固有の詳細は … GitHub セッションの詳細は以下で確認できます：\nBuild software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub セッションで行われた作業の詳細 セッションでは、Copilotが以下のステップで作業を進めました：\n1. 問題の分析 まず、AGENTS.mdとpost.instructions.mdの両ファイルを読み込み、重複・冗長な箇所を特定しました。\n2. AGENTS.md のリファクタリング AGENTS.mdはプロジェクト全体の指針として役割を明確化しました：\nfront matter形式の詳細例を削除（post.instructions.mdに一元化） ファイル命名規則テーブルを削除（post.instructions.mdに一元化） プロジェクト構成に .github/instructions/ ディレクトリを明示 Dosセクションにfront matter必須項目を追加 記事作成固有の詳細はpost.instructions.mdへの参照に変更 3. post.instructions.md のリファクタリング post.instructions.mdは記事作成に特化した内容に整理しました：\n変更内容 詳細 品質チェックリストの統合 2つあったチェックリストを1つに ワークフローの統合 2つあったワークフローを1つに 禁止事項の統合 「禁止事項」と「Don\u0026rsquo;ts」を1つのテーブルに（代替案列付き） サンプル記事構成の削除 テンプレートで十分と判断 Markdown記法セクションの削除 基本知識として想定 体験記事セクションの統合 シンプルなテンプレートに統合 4. コードレビューへの対応 セッション中、自動でコードレビューが実行され、いくつかの改善点が指摘されました。Copilotはこれらのフィードバックにも対応しています：\n役割セクションを複数段落に分割して可読性向上 トーン＆スタイルに「身近な例や図の活用」ガイダンスを追加 禁止事項テーブルに代替案列を復元 結果と分析 結果を見ると、Copilotは結構大胆に削ってくれました。\n削減率 ファイル 変更前 変更後 削減率 AGENTS.md 114行 86行 約25% post.instructions.md 438行 211行 約52% 合計で256行が削減され、より保守しやすい構成になりました。\n変更の具体例 どういう影響があるのかは、本当は細かく見ていく必要があるとは思います。例えば、こんな変更がありました：\nBefore After コード例が正確で、動作確認済みである コード例が正確である Beforeの時だったかは覚えていませんが、セッション内でコードを実行して動作確認をしているのを見たことがあります。ちゃんとやってるんですね。\nAfterになってからは、まだそういう記事を書いていないのでわかりません。ただ「正確」をどう捉えるのかがポイントです。\n「正確」であれば当然正確に動くはずなので、動作確認はしなくて良い（というか、Afterには動作確認という概念すらない）のでは、という考え方もできます。しかし、どのようにして「正確」足り得るのでしょうか？\nこの体験から学んだこと 嘘をつかせない工夫 「AIは嘘をつく」と散々言われているので、エージェント指示ファイルには「嘘をつかせないようにする工夫」がたくさん仕込まれています。\n特に重要なのは以下の2点です：\nやるべきこと（Dos） を明確にする やってはいけないこと（Don\u0026rsquo;ts） を明確にする とはいえ、AIは学習済みなので、基本的なことは既に理解していると思われます。\nただし、場合によっては「やってはいけない事をやってほしい場合」もあるかもしれません。そこは明確にしておくのが良いでしょう。\n指示ファイルの階層構造 複数の指示ファイルを使い分けることで、以下のようなメリットがあります：\n関心の分離: システム全体の設定とコンテンツ固有の設定を分離できる 保守性の向上: 変更の影響範囲を限定できる 柔軟性: 異なるファイルタイプに異なるルールを適用できる リファクタリングの価値 度重なる修正によって項目が重複したり、冗長になったりすることは避けられません。AIエージェントに対する非常に重要なファイルなので、定期的なリファクタリングが必要です。\n今回のようにCopilotに丸投げすることで、客観的な視点からの整理ができました。\nまとめ AIエージェントへの指示ファイルには複数の種類があり、それぞれに特徴があります。\nAGENTS.md: 業界標準で汎用性が高い copilot-instructions.md: GitHub Copilot固有だが自動認識される instructions/: ファイルパターンごとに細かく設定できる このブログでは、AGENTS.mdでHugo全般の設定を、post.instructions.mdでブログ記事の執筆ガイドラインを管理しています。\nリファクタリングをCopilotに任せることで、重複を解消し、より保守しやすい構成になりました。今後も定期的に見直しを行っていきたいと思います。\n参考資料 AGENTS.md AGENTS.md is a simple, open format for guiding coding agents. Think of it as a README for agents. agents.md GitHub - github/awesome-copilot: Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. Community-contributed instructions, prompts, and configurations to help you make the most of GitHub Copilot. - … GitHub AGENTS.mdと*.instructions.mdのリファクタリング · Issue #36 · nqou-net/www.nqou.net AGENTS.md や .github/instructions/post.instructions.md については、度重なる修正によって項目が重複したり、冗長になったりしてしまう。 AIエージェントに対する非常に重要なファイルなので、リ … GitHub Refactor AGENTS.md and post.instructions.md to remove duplications by Copilot · Pull Request #37 · nqou-net/www.nqou.net 問題の分析：AGENTS.mdとpost.instructions.mdの重複・冗長箇所を特定 AGENTS.md のリファクタリング プロジェクト全体の指針として役割を明確化 記事作成固有の詳細は … GitHub ","date":"2025-11-30T02:06:57+09:00","image":"https://www.nqou.net/public_images/20251130020657-image.jpg","permalink":"https://www.nqou.net/2025/11/30/020657/","title":"AIエージェントへの指示ファイルをリファクタリングした話"},{"content":"@nqounetです。\nGitHubでissueを発行してCopilotにアサインするワークフローがとても快適です。今回は、このブログにリンクカードを表示するショートコードを作成してもらった体験を紹介します。\n背景・きっかけ このブログはHugoを使って構築しています。\n最近、記事内のリンクが少し寂しく見えると感じていました。単純なテキストリンクではなく、OGP（Open Graph Protocol）情報を取得してカードのように表示できたら、もっと見やすくなるのではないかと思ったのです。\nそこで、issueを発行してCopilotにショートコードを作成してもらうことにしました。\n後で調べてみると、すでにlinkcardというショートコードを作成してブログに公開している方もいるようです。ただ、使っているテーマによってスタイルシートの当たり具合が変わってしまうので、結局は何かしらの修正が必要になるだろうと思いました。\n実際に行ったこと issueの作成 issueを作成して、Copilotにアサインしました。\nCopilotにアサインする際、オプションでプロンプトを追加できます。今回は以下のように入力しました。\n得意な分野についてはこだわってしまう癖があります。\nちょっとしたこだわりがどのような感じで反映されるのか楽しみでした。\n追加の指示 なかなか良い感じにできたとは思うのですが、カード内の文字が少し小さく見えました。「既存のスタイルシートに影響されているのかな」と思い、追加で指示しました。\nまた、カード内の文字が少し小さく見えます。他のスタイルシートの影響を受けないようにしてください\nこの時は何も思っていませんでしたが、よく考えてみれば「文字を50％大きくしてください」のように具体的な指示をするのが正しかったと思います。\nただ、「文字が小さい」と言うだけでも文字を大きくしてくれるなんて。本当に人間味を感じます。\n結果と分析 作成されたlinkcardショートコード Copilotは、以下のような機能を持つショートコードを作成してくれました。\nOGP自動取得: URLを指定するだけで、タイトル・説明・画像を自動取得 セキュリティ対策: URLプロトコルのバリデーション（http/httpsのみ許可） アクセシビリティ: キーボードフォーカスインジケーターの追加 ダークモード対応: CSS変数によるテーマ対応 エラーハンドリング: ネットワークエラー時の適切な処理 使い方はとてもシンプルです。\n1 {{\u0026lt; linkcard url=\u0026#34;https://gohugo.io/\u0026#34; \u0026gt;}} このように書くだけで、きれいなカード形式のリンクが表示されます。\nThe world Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo … gohugo.io コードレビューへの対応 PRには16件のレビューコメントがあり、Copilotはそれらすべてに対応してくれました。対応内容には以下のようなものがありました。\n正規表現パターンの修正（引用符の適切な処理） htmlUnescapeからplainifyへの変更 faviconのonerrorハンドラー追加 フォントサイズの増加（タイトル: 1.125rem、説明: 1rem、ドメイン: 0.875rem） Premium requestsの使用状況 作業中、ふと気づくとPremium requestsが90%に到達していました。\nPremium requestsとは Premium requestsは、GitHub Copilotの高度なAI機能を使用する際に消費されるリクエストです（GitHub Docs）。\nCopilot Proでは、通常のコード補完や基本的なチャットは無制限で利用できます。一方、以下のような高度な機能を使用すると、Premium requestsが消費されます。\nCopilot Coding Agent（issueへのアサインやPRの自動作成） 高度なAIモデル（Claude Sonnetなど）の使用 Copilot CLIのプロンプト コードレビューの依頼 Copilot Proでは月間300回のPremium requestsが付与されます。上限に達すると高度な機能は一時的に使用できなくなりますが、月初（UTC 00:00）にリセットされます。追加料金が発生することはなく、オプトインしない限り超過分を請求されることはありません（GitHub Docs）。\nまあ、あと2日ほどで0に戻りますし、使えるだけ使ってしまおうと思っています。\nこの体験から学んだこと issueベースのワークフローは快適: issueを発行してアサインするだけで、Copilotが自律的に作業を進めてくれる プロンプトで個性を付与できる: 「こだわり屋」というキャラクター設定が、詳細なセキュリティ対策やアクセシビリティ対応につながった可能性がある 曖昧な指示でも意図を汲み取ってくれる: 「文字が小さい」という指摘だけで、フォントサイズを適切に調整してくれた レビューコメントへの対応も自動: 16件のレビューコメントすべてに対応し、品質の高いコードを完成させてくれた まとめ GitHub issueにCopilotをアサインして、linkcardショートコードを作成してもらいました。\n「得意な分野についてはこだわってしまう癖があります」というプロンプトを追加したことで、セキュリティやアクセシビリティにも配慮した、こだわりのあるショートコードが完成しました。\n曖昧な指示でも意図を汲み取って対応してくれる点は、まさに人間のエンジニアと協働しているような感覚でした。Premium requestsの消費は気になりますが、この快適さを考えると十分に価値があると感じています。\n参考資料 ウェブサイトへのリンクをカードのように表示するショートコードを作成する · Issue #46 · nqou-net/www.nqou.net あなたは Hugoのスペシャリストです。ショートコードにとても詳しく、これまで数多のショートコードを生み出しています。 ウェブサイトへのリンクをカードのように表示するショートコードを作成してください。 サイトのメタ情報（OGP）を事前に取得 … GitHub Add linkcard shortcode for displaying website links as OGP cards by Copilot · Pull Request #47 · nqou-net/www.nqou.net Understand repository structure and existing shortcodes Understand Hugo version and capabilities Create link card … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub ","date":"2025-11-29T19:47:58+09:00","image":"https://www.nqou.net/public_images/2025/1764413278-image.png","permalink":"https://www.nqou.net/2025/11/29/194758/","title":"Copilotに「こだわり屋」になってもらってショートコードを作成した話"},{"content":"@nqounetです。\n先日、GitHubでissueを発行したところ、Assignees欄に見慣れないボタンがありました。クリックしてみたところ、GitHub Copilotが「見た！」とばかりにリアクションして、そのまま自動で修正を完了させてしまいました。\nこの記事では、その驚きの体験について振り返ります。\nきっかけ あるリポジトリでissueを発行した際、Assignees欄に通常のユーザー一覧とは別のボタンが表示されていることに気づきました。\nこれが「Assign to Copilot」ボタンでした。\n興味本位でクリックしてみたところ、Copilotがすぐにリアクションを返してきました。まるで「任せろ！」と言わんばかりの反応です。\nCopilotが勝手に動き出した 驚いたことに、Copilotは自動的に作業を開始しました。具体的には以下のような流れでした：\nブランチの作成: Copilotが新しいブランチを作成 プルリクエストの作成: ドラフトPRを自動で作成 コードの修正: issueの内容を分析して修正を開始 レビュー対応: 放置されていたレビュー内容を確認して対応 しばらく待っていると、なんと修正が完了していました。\n結果と分析 実際に完了した修正内容 Copilotは、放置されていたレビューコメントを確認し、指摘された箇所を自動で修正してくれました。人間が作業を開始するまでもなく、issueをアサインしてから数分で修正が完了していたのです。\nこの体験から、定型的なタスクであればCopilotに任せることで大幅な時間短縮ができると感じました。\nGitHub Copilot Coding Agentとは この機能は「GitHub Copilot Coding Agent」と呼ばれています（GitHub公式ドキュメント）。従来のコード補完とは異なり、issueやタスクを非同期で自律的に処理してくれるエージェントです。\n主な特徴は以下の通りです（GitHub Blog）：\nissueへの直接アサイン: チームメイトにアサインするのと同じ感覚でCopilotをアサインできる サンドボックス環境での実行: GitHub Actionsを利用した安全な隔離環境（他のシステムに影響を与えない独立した実行空間）で動作 自動でPRを作成: ドラフトPRを作成し、人間のレビューを待つ レビューフィードバックへの対応: PRへのコメントを受けて追加修正も可能 重要なのは、Copilotは自分でPRをマージすることはできないという点です。最終的な判断は必ず人間が行います。これにより、安全性を保ちながら自動化のメリットを享受できます。\nもう人間はいらない？ 体験してみて率直に感じたのは、「もう人間はいらない時代が来たのでは？」ということでした。\nもちろん、これは半分冗談です。\n実際には、複雑なアーキテクチャの変更や、ビジネスロジックの深い理解が必要なタスクは、まだ人間の専門知識が不可欠です。しかし、以下のような定型的なタスクは、Copilot Coding Agentが得意とする領域です：\nバグ修正 テストの追加 ドキュメントの更新 リファクタリング 依存関係の更新 こうした作業を自動化できれば、人間はより創造的で価値の高い作業に集中できます。\nこの体験から学んだこと Copilotはissueを「読んで」理解できる: 単なるコード補完ではなく、タスクの文脈を理解して作業を進める 非同期で自律的に動作する: 人間が見守る必要がなく、完了したら通知してくれる 安全性は担保されている: マージは人間が行うため、意図しない変更がプロダクションに入ることはない 定型作業の自動化に最適: 繰り返しの作業や、明確なタスクに向いている まとめ GitHub issueにCopilotをアサインするだけで、自動的にプルリクエストを作成し、修正を完了してくれるという体験は、本当に驚きでした。\nAIが「アシスタント」から「自律的なエージェント」へと進化していることを実感した瞬間でした。\nすべての作業を任せられるわけではありませんが、適切なタスクに対してはとても強力なツールです。今後もCopilot Coding Agentを活用して、開発効率を高めていきたいと思います。\n参考資料 レビューが放置されてしまっている · Issue #9 · nqou-net/AAZe6Ev5fs2aCtcaginpy00jHimNhOmK #6 (review) このコメントに対して対応が必要。 GitHub About GitHub Copilot coding agent - GitHub Docs You can ask Copilot to open a new pull request or make changes to an existing pull request. Copilot works in the … GitHub Docs GitHub Copilot coding agent 101: Getting started with agentic workflows on GitHub Delegate it a task, and coding agent can independently write, run, and test code. Here’s how you can make the most of … The GitHub Blog ","date":"2025-11-29T09:42:41+09:00","image":"https://www.nqou.net/public_images/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-11-29%202.23.21.png?raw=true","permalink":"https://www.nqou.net/2025/11/29/094241/","title":"issueにCopilotをアサインしたら自動で修正が完了した話"},{"content":"@nqounetです。\nGitHub Copilotのエージェント機能が楽しくて、色々と実験しています。今回は「カスタムエージェント同士を連携させて記事を作れないか」という実験に挑戦してみました。\n結論から言うと、思い描いていたオーケストレーションは実現できませんでしたが、実験自体は面白い発見がありました。\n背景・きっかけ 以前、AIはコンテキストによって動作が変わるという話を書きました。ならば、全く意味不明なリポジトリ名ならどうなるのか？という素朴な疑問が湧きました。\nそこで AAZe6Ev5fs2aCtcaginpy00jHimNhOmK という、完全にランダムな文字列のリポジトリを作成し、そこでカスタムエージェントの実験を行うことにしました。\nまた、以前AGENTS.mdを作成してもらった際に、「ガイドラインの中にカスタムエージェントを定義し、そのエージェントの使い方をワークフローで定義する」という構造を見かけました。それなら、そのエージェントを直接カスタムエージェントとして実装できるのでは？と考えたのです。\n実際に行ったこと リポジトリ作成時に、以下のプロンプトを指定しました。\n1 2 3 あなたは GitHub Copilot Agent Panel で custom agents を使ってブログ記事を作成する専門家です。 2つ以上の custom agents を利用して、初心者〜中級エンジニア向けに情熱的で読みやすく、信頼性の高い記事を生成できる custom agents を作成してください。 また、ブログ記事を作成するとき、custom agents をどのように利用するのか説明してください。 「2つ以上の custom agents を利用して」と指定したのは、役割分担を期待してのことです。例えば：\n調査担当エージェント：技術情報を収集する 執筆担当エージェント：記事を書く レビュー担当エージェント：品質をチェックする このような分業ができれば、より質の高い記事が作れるのではないかと考えました。\n結果と分析 生成されたREADME 生成されたREADMEを見た時は、正直なところ震えました。\nCopilotは期待通り、複数のカスタムエージェントの定義と、それらを連携させるワークフローを提案してくれました。理論上は美しい設計でした。\nしかし現実は 最初はVS Codeからは使えたものの、エージェントパネルからは使えない状態でした。\n色々と指示して修正を重ねた結果、それっぽく使えるようにはなりました。しかし、最後に試したセッションのログを見ると、期待していた「オーケストレーション」は実現できていなさそうです。\n私の力不足かもしれませんが、少なくとも今の時点では、複数のカスタムエージェントが自律的に連携するような動作は確認できませんでした。\nこの体験から学んだこと 1. 意味不明なリポジトリ名でも問題なく動作する 完全にランダムな文字列のリポジトリ名でも、Copilotは指示通りに動作しました。リポジトリ名からコンテキストを推測するようなことは（少なくとも目に見える形では）行われていないようです。\n2. 設計と実装のギャップ AIが「こうあるべき」と提案する設計と、実際に動作する実装との間にはギャップがあります。特にカスタムエージェントのような新しい機能では、そのギャップが大きくなりがちです。\n3. オーケストレーションへの再考 冷静になって考えてみると、オーケストレーションしても全部AIなので、「全部まとめてしまえば良いのでは？」という疑問が湧きました。\n役割を分けることで得られるメリット（専門性の向上、チェック体制の強化など）と、一つのエージェントにすべてを任せるシンプルさのどちらが良いのか。これは今後も考えていきたいテーマです。\nまとめ カスタムエージェントのオーケストレーションは、現時点では期待通りには動作しませんでした。しかし、この実験を通じていくつかの学びがありました。\n意味不明なリポジトリ名でもAIは正常に動作する 理想的な設計と実際に動作する実装には差がある 複数エージェントの連携よりも、一つの優秀なエージェントの方が実用的かもしれない 実現したら夢が広がるなぁ、と思っていたオーケストレーションですが、今はまだ夢のままです。とはいえ、AIツールの進化は速いので、近い将来に実現する可能性は十分にあると思います。\n引き続き実験を続けながら、新しい発見があれば共有していきたいと思います。\n参考資料 GitHub - nqou-net/AAZe6Ev5fs2aCtcaginpy00jHimNhOmK Contribute to nqou-net/AAZe6Ev5fs2aCtcaginpy00jHimNhOmK development by creating an account on GitHub. GitHub Add custom agents for blog article creation workflow by Copilot · Pull Request #1 · nqou-net/AAZe6Ev5fs2aCtcaginpy00jHimNhOmK Create a multi-agent system for generating high-quality technical blog posts targeting beginner-to-intermediate … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub ","date":"2025-11-29T02:06:42+09:00","image":"https://www.nqou.net/public_images/20251129020642-image.jpg","permalink":"https://www.nqou.net/2025/11/29/020642/","title":"カスタムエージェントのオーケストレーションを夢見て ― 複数エージェント連携の実験記録"},{"content":"@nqounetです。\n「AIに記事を書いてもらうって、具体的にどうやるの？」\nこの記事では、GitHub Copilotのエージェントパネルからプロンプトを入力して、実際にブログ記事を生成した体験をお伝えします。従来のコード補完とは全く異なる、新しい開発フローを体験した感想と、そこから得られた学びを共有します。\n背景・きっかけ AGENTS.mdを作成した後の次のステップ 前々回の記事「エージェントガイドラインを作成するプロンプトを試してみた」で、GitHub Copilotコーディングエージェント用の設定ファイルを作成しました。\nその設定ファイルを使って、実際にブログ記事を生成してみたい。そう思ったのが今回の体験のきっかけです。\n試したかったこと エージェントパネルからの直接入力でタスクを実行できるか AGENTS.mdの設定が正しく反映されるか 体験記事というジャンルでもAIは適切な文章を生成できるか 実際に行ったこと エージェントパネルとは GitHub Copilotコーディングエージェント（GitHub Copilot coding agent：GitHubリポジトリ内でタスクを自動実行するAIエージェント）は、Issueやプルリクエストからだけでなく、エージェントパネルから直接プロンプトを入力して実行することもできます。\nエージェントパネルは、GitHubのリポジトリ画面で利用でき、テキストボックスに指示を入力するだけでタスクを開始できます。\n入力したプロンプト 今回、エージェントパネルに入力したプロンプトの概要は以下の通りです:\nAGENTS.mdを作成した時の体験を記事にしたい プルリクエストとCopilotセッションへの参照を含める プログラミングをウェブで学ぶ難しさと、公式ドキュメントの重要性について触れる 実際に使用したプロンプトを掲載する Copilotの動作 エージェントパネルからプロンプトを送信すると、Copilotは以下のような流れで作業を進めました:\nリポジトリの理解: AGENTS.mdを読み込み、記事のスタイルガイドを把握 記事の構成: 体験記事の構成ガイドラインに沿った見出し構成を作成 本文の執筆: プロンプトの内容に基づいて記事を生成 AGENTS.mdの更新: 記事作成中に気づいた改善点を反映 プルリクエストの作成: 変更をまとめてプルリクエストを自動作成 結果と分析 生成されたプルリクエスト Copilotが自動生成したプルリクエストは、以下のような内容でした:\nタイトル: Add blog article: Creating AGENTS.md with GitHub Copilot 変更ファイル: articles/best-agents-md-prompt.md（新規記事） AGENTS.md（ガイドラインの追加） 特筆すべき点 Copilotは、記事を生成するだけでなく、AGENTS.md自体も改善してくれました。\n具体的には:\n出力形式に「保存場所」と「ファイル名規則」を追加 「体験記事の構成ガイドライン」セクションを新設 これは、私がプロンプトで直接指示したわけではありません。Copilotが記事を書く過程で「これがあった方が良い」と判断して追加してくれたのです。\nうまくいった点 1. AGENTS.mdの設定が正しく反映された\n生成された記事は、AGENTS.mdで定義したスタイルガイドに沿っていました:\n丁寧かつフレンドリーな文体 専門用語への補足説明 一次情報を優先した出典の記載 2. プルリクエストの説明が詳細だった\n自動生成されたプルリクエストの説明文には、変更内容が箇条書きで整理されており、レビューしやすい形式になっていました。\n3. 関連する改善も提案してくれた\n前述の通り、記事生成だけでなくAGENTS.mdの改善も自動で行ってくれました。\n素晴らしかった体験 エージェントパネルからプロンプトを入力してから、プルリクエストがマージされるまで、非常にスムーズな体験でした。\n従来であれば:\nローカルでブランチを作成 記事を手動で執筆 コミット＆プッシュ プルリクエストを作成 レビュー＆マージ という手順が必要でした。\nエージェントパネルを使うと:\nプロンプトを入力 生成されたプルリクエストをレビュー マージ という3ステップで完了します。\nこの体験から学んだこと 1. AGENTS.mdの重要性を実感 事前にAGENTS.mdを整備しておくことで、Copilotが一貫したスタイルで記事を生成してくれました。設定ファイルへの投資は、その後の生産性向上につながります。\n2. AIは「指示されたこと以上」もやってくれる 今回、AGENTS.mdの改善は私が指示していませんでした。しかし、Copilotは作業の過程で必要だと判断し、自発的に改善を行いました。\nこれは、単なる指示実行マシンではなく、文脈を理解して最適な行動を取れるAIの能力を示しています。\n3. レビューは人間の責任 自動生成されたからといって、そのままマージするのは危険です。生成された記事の内容、出典の正確性、スタイルの一貫性などは、必ず人間がレビューする必要があります。\nAIは強力なツールですが、最終的な責任は人間が持つべきです。\n4. 体験を記事にすることの価値 今回のように、実際に体験したことを記事にすることで、単なる技術解説とは異なる価値を提供できます。読者は「実際にやってみた人の感想」を知ることで、自分でも試してみようという気持ちになりやすいです。\nまとめ この記事では、GitHub Copilotのエージェントパネルから記事を生成した体験をお伝えしました。\nポイントの整理:\nエージェントパネルからプロンプトを入力するだけでタスクを実行できる AGENTS.mdを事前に整備しておくと、一貫したスタイルで生成される Copilotは指示された以上の改善も自発的に行うことがある 生成された内容は必ず人間がレビューすべき エージェントパネルを使った開発フローは、まさに新しい体験でした。従来の開発プロセスを大幅に効率化しつつ、品質も維持できる可能性を感じています。\nぜひあなたも、AGENTS.mdを整備して、エージェントパネルからの記事生成を試してみてください。\n参考資料 ※以下のPRリンクは、nqou-net/amazon-junkie リポジトリでの体験をもとにしています。この記事は www.nqou.net リポジトリのブログ記事ですが、実際の作業は別リポジトリで行いました。\nAdd blog article: Creating AGENTS.md with GitHub Copilot by Copilot · Pull Request #2 · nqou-net/amazon-junkie Documents the experience of using GitHub Copilot coding agent to generate AGENTS.md, including the prompt engineering … GitHub https://github.blog/changelog/2025-05-19-github-copilot-coding-agent-generally-available/ github.blog About GitHub Copilot coding agent - GitHub Docs You can ask Copilot to open a new pull request or make changes to an existing pull request. Copilot works in the … GitHub Docs ","date":"2025-11-29T01:06:43+09:00","image":"https://www.nqou.net/public_images/20251129010643-image.jpg","permalink":"https://www.nqou.net/2025/11/29/010643/","title":"エージェントパネルから記事を生成してみた ― GitHub Copilotで体験した新しい開発フロー"},{"content":"@nqounetです。\n「AIにブログ記事を書いてもらいたいけど、どうすれば質の高い記事が生成されるんだろう？」\nこの記事では、GitHub Copilotのコーディングエージェントを使って、ブログ記事生成用の設定ファイル「AGENTS.md」を作成した体験をお伝えします。AIに良い仕事をしてもらうためのプロンプトの書き方や、信頼性の高い記事を生成するための工夫について、具体的な事例とともに解説します。\nウェブで学ぶプログラミングの落とし穴 プログラミングをウェブで学ぶのは、想像以上に大変です。\n多くの初心者〜中級エンジニアがブログ記事を頼りに学習していますが、そこには大きな落とし穴があります。私自身、仕事でRubyを使い始めたとき、検索でいろいろな記事を読みましたが、結局は公式ドキュメントに戻りました。\nなぜそうなったのでしょうか？\n個人ブログの限界 振り返ってみると、ブログ記事が 浅いところしか書いていなかった からだと思います。\n基本的な使い方は書いてあるが、なぜそう動くのかの説明がない エラーが起きたときの対処法が不十分 書かれた当時の情報が古くなっていることがある 出典が明記されていないので、情報の正確性が確認できない これは個人ブログを批判しているわけではありません。むしろ、私自身がブログを書く際に同じ轍を踏まないようにしたいという思いがあります。\n公式ドキュメントの価値 結局のところ、一次情報（公式ドキュメントや仕様書）に当たるのが一番確実 です。\nとはいえ、公式ドキュメントは初心者には読みにくいことも事実。だからこそ、ブログ記事には「公式ドキュメントの内容をわかりやすく噛み砕いて伝える」という役割があると考えています。\nAGENTS.mdとは何か AGENTS.md（エージェンツ・エムディー）は、GitHub Copilotのコーディングエージェントに対して どのように振る舞ってほしいかを定義する設定ファイル です。\nこのファイルをリポジトリのルートに配置することで、Copilotがコードを生成したり、タスクを実行したりする際の振る舞いをカスタマイズできます。\nGitHub Copilotコーディングエージェントとは GitHub Copilotコーディングエージェントは、2025年5月に一般提供（GA）された機能です。従来のコード補完とは異なり、自律的にタスクを実行し、ファイルの作成や編集、プルリクエストの作成まで行えます（GitHub Blog - GitHub Copilot coding agent generally available）。\nAGENTS.mdを使うことで、このエージェントの動作を細かく制御できるのです。\n最高のAGENTS.mdを作るためのプロンプト 今回、私はCopilotコーディングエージェントに対して、以下のようなプロンプトを使ってAGENTS.mdを作成してもらいました。\n実際に使用したプロンプト 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 あなたは AGENTS.md 設計の専門家です。 このリポジトリでは、プログラミングに関するブログ記事を作成します。 初心者〜中級のエンジニア向けに、情熱的で読みやすく、信頼性の高い記事を生成できる 最適な AGENTS.md を作成してください。 ■ ブログ記事仕様 - テーマ：プログラミング技術全般 - 対象読者：初級〜中級エンジニア - 基本的なプログラミング用語は理解しているが、専門領域は浅い前提 - 専門用語は必要最小限に、使用する場合は簡潔に補足をつける - 図解風の箇条書きや実例などを交えて段階的に説明する - トーン：丁寧かつフレンドリー - SEO を意識した見出し構成 - 根拠となる情報は必ず提示する ■ 出典・根拠の扱い - 一次情報（仕様書、公式ドキュメント、標準規格など）を優先する - 出典URLはMarkdownリンク形式で、該当内容の近くに配置 - 信頼性が低い情報源（個人ブログ等）は引用しない - 推測情報はその旨を明記する ■ エージェント機能要件 - 記事作成時に、不足情報をインタビュー形式で質問する - Markdown形式で出力する - 各記事でスタイルと品質を統一する - 禁止事項：曖昧な表現の多用、難解な専門用語の乱発、根拠のない断定等 ■ 出力形式 説明文なしで、完成した AGENTS.md のみを Markdown で出力してください。 以上を踏まえて、最高品質の AGENTS.md を作成してください。 プロンプト設計のポイント このプロンプトには、いくつかの工夫があります。\n1. 役割を明確に定義する 冒頭で「AGENTS.md 設計の専門家」という役割を与えています。AIに専門家としての視点を持たせることで、より質の高い出力が期待できます。\n2. 目的とコンテキストを伝える 「プログラミングに関するブログ記事を作成する」という目的を明示しています。何のためのAGENTS.mdなのかをAIに理解させることで、適切な内容が生成されやすくなります。\n3. 具体的な仕様を列挙する 曖昧な指示ではなく、具体的な仕様を箇条書きで列挙しています。\n対象読者 専門用語の扱い方 トーン 出典の扱い方 禁止事項 このように詳細を指定することで、期待する出力に近づけることができます。\n4. 出力形式を指定する 「説明文なしで、完成した AGENTS.md のみを Markdown で出力してください」と指定しています。余計な説明を省くことで、すぐに使える成果物を得られます。\n生成されたAGENTS.mdの中身 Copilotが生成したAGENTS.mdは、約270行の充実した内容になりました。主な構成要素を紹介します。\n役割と対象読者の定義 1 2 3 4 5 6 ## 役割 あなたは、プログラミング技術に関するブログ記事を執筆する テクニカルライターエージェントです。 初心者〜中級エンジニアに向けて、情熱的で読みやすく、 信頼性の高い記事を作成します。 エージェントに明確な役割を与えることで、一貫した振る舞いが期待できます。\n出典・根拠の取り扱いルール 特に印象的だったのが、情報源の優先順位を明確に定義している点です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ### 情報源の優先順位 1. **一次情報（最優先）** - 公式ドキュメント - 仕様書・標準規格（RFC、W3C、ECMA など） - 公式ブログ・リリースノート 2. **二次情報（補助的に使用）** - 信頼性の高い技術メディア - 公式に認められた書籍 3. **使用禁止** - 個人ブログ（信頼性が担保できないため） - 出典が不明確な情報 これは、私がプロンプトで指定した「信頼性が低い情報源は引用しない」という要件を、より具体的なルールに落とし込んでくれています。\n品質チェックリスト 生成されたAGENTS.mdには、記事完成前に確認すべき11項目のチェックリストが含まれていました。\n1 2 3 4 5 6 7 8 9 10 11 - [ ] タイトルが具体的で検索意図に合致している - [ ] 導入文で読者のメリットが明確になっている - [ ] 見出し構造が論理的で読みやすい - [ ] 専門用語に適切な補足説明がある - [ ] コード例が正確で、動作確認済みである - [ ] 出典が一次情報を優先している - [ ] 出典 URL が該当箇所の近くに配置されている - [ ] 推測情報はその旨が明記されている - [ ] 文体が丁寧かつフレンドリーで統一されている - [ ] 誤字脱字がない - [ ] アクセシビリティに配慮している このチェックリストがあることで、記事の品質を一定以上に保つことができます。\n実際のプルリクエスト 今回の作業は、プルリクエストとして管理されました。\nプルリクエスト: PR#1 - Add AGENTS.md for programming blog article generation Copilotセッション: copilot/tasks Copilotコーディングエージェントは、プルリクエストの説明文も自動で生成してくれます。生成された説明文には、AGENTS.mdの主要なセクションが箇条書きで整理されており、レビュアーが内容を把握しやすくなっていました。\nこの体験から学んだこと 1. AIへの指示は具体的に 「良い記事を書いて」のような曖昧な指示ではなく、具体的な仕様を列挙することが重要です。\n2. 禁止事項を明示する やってほしいことだけでなく、やってほしくないこと（禁止事項）を明示することで、意図しない出力を防げます。\n3. 出力形式を指定する 「説明文なしで」「Markdown形式で」のように出力形式を指定することで、すぐに使える成果物を得られます。\n4. 信頼性を担保する仕組みを組み込む AIが生成する記事の信頼性を担保するために、「一次情報を優先」「個人ブログは引用禁止」といったルールを組み込むことが有効です。\nまとめ この記事では、GitHub Copilotコーディングエージェントを使ってAGENTS.mdを作成した体験をお伝えしました。\nポイントの整理:\nウェブでプログラミングを学ぶ際は、公式ドキュメントなどの一次情報が重要 AGENTS.mdはCopilotコーディングエージェントの振る舞いを定義する設定ファイル 良いプロンプトの要素：役割の定義、目的の明示、具体的な仕様、出力形式の指定 信頼性を担保するルールを組み込むことで、質の高い記事生成が可能に 今回作成したAGENTS.mdを使って、これからも信頼性の高いブログ記事を作成していきたいと思います。AIを活用しつつも、最終的な責任は人間が持つ。その姿勢を忘れずに、価値ある情報を発信していきます。\n参考資料 https://github.blog/changelog/2025-05-19-github-copilot-coding-agent-generally-available/ github.blog Customizing the development environment for GitHub Copilot coding agent - GitHub Enterprise Cloud Docs Learn how to customize GitHub Copilot\u0026#x27;s development environment with additional tools. GitHub Docs Add AGENTS.md for programming blog article generation by Copilot · Pull Request #1 · nqou-net/amazon-junkie Creates an AGENTS.md configuration for an AI agent that generates programming blog articles targeting … GitHub ","date":"2025-11-29T00:20:02+09:00","image":"https://www.nqou.net/public_images/20251129002002-image.jpg","permalink":"https://www.nqou.net/2025/11/29/002002/","title":"最高のAGENTS.mdを生み出すプロンプト ― GitHub Copilotで設定ファイルを作成した話"},{"content":"@nqounetです。\n先日、GitHub Blogで紹介されていたエージェントガイドライン作成用のプロンプトを試してみました。\nこの記事では、その体験と感じたことを振り返ります。\nきっかけ GitHub Blogの記事「5 tips for writing better custom instructions for Copilot」で、既存のプロジェクトに対してエージェントガイドラインを作成するプロンプトが紹介されていました。\nこのプロンプトは、リポジトリを初めて見るエージェントが効率よく作業できるよう、プロジェクトの構造や技術スタック、コーディングガイドラインなどを文書化するものです。\n試してみた 興味を持ったので、このブログのリポジトリに対して実際に試してみました。\nPR #12 タスクセッション プロンプトのポイントは以下の通りです：\nリポジトリ全体を網羅的に調査する README、CONTRIBUTING、設定ファイル、スクリプトなどを確認する HACKやTODOなどのワークアラウンドの痕跡を探す プロジェクト構造や技術スタックを文書化する 作成したガイドラインを使って実際に機能を実装し、その結果からガイドラインを改善する 生成されたガイドライン エージェントは非常に包括的なガイドラインを作成しました。主な内容は以下の通りです：\nプロジェクト概要: Hugoで構築された個人ブログサイトであること 技術スタック: Hugo Extended、hugo-theme-stack、Perl（Daiku + カスタムスクリプト） プロジェクト構成: ディレクトリ構造の詳細 ビルドコマンド: 開発サーバー起動やビルドコマンドの例 Hugo互換性: バージョン0.131以降の破壊的変更への対応 エージェントの制限事項: docs/ディレクトリの編集禁止、ビルドコマンド実行禁止 さらに、サンプル機能の実装（x.htmlショートコードの作成）を行い、その過程で発見した問題を反映してガイドラインを改善していました。\nプロンプトエンジニアリングの良いところ プロンプトエンジニアリングの良いところ（？）は、他人の成功例を真似できるところです。\n今回試したプロンプトも、GitHub Blogで紹介されていたものをそのまま使いました。自分でゼロから考える必要がなく、専門家が設計したプロンプトをコピペするだけで、それなりの結果が得られます。\n逆に言えば、コピペだけでなんとかなってしまう危うさもあります。プロンプトの背景にある意図や設計思想を理解せずに使っていると、応用が利かなかったり、うまくいかない場面で対処できなかったりするかもしれません。\n牛刀で大根を切る感覚 とはいえ、生成されたガイドラインを見ていて感じたのは、ブログを書くにしては牛刀で大根を切るような感じがするということです。\n今回のプロンプトは、本来はコーディングエージェント向けに設計されています。ビルドコマンドの実行方法や依存関係のインストール方法、Hugo互換性の注意点などは、コードを書くエージェントにとっては重要な情報です。\nしかし、このブログリポジトリでの主なユースケースは記事を書くことです。Hugoの操作自体はCI/CDが自動で行うので、エージェントがビルドコマンドを実行する必要はありません。\n今後の方針 そこで、ブログ記事を書くことをメインにしたガイドラインに作り直したいと思っています。\n現在のガイドラインには、バイブ・ブロギング用のアシスタントガイドも含まれています。こちらの方が、このリポジトリでの主なユースケースに合っています。\n見直しのポイントとしては：\nコーディングエージェント向けの詳細な技術情報を簡略化する 記事作成に必要な情報（front matter形式、タグ付与の方針など）を中心にする バイブ・ブロギング用のガイドラインを充実させる まとめ GitHub Blogで紹介されたエージェントガイドライン作成プロンプトを試してみました。\n主なポイント：\n✅ プロンプトの有用性: 専門家が設計したプロンプトをコピペするだけで、それなりの結果が得られる\n✅ コピペの危うさ: 背景にある意図を理解せずに使うと、応用が利かない可能性がある\n✅ 用途に合わせた調整: コーディングエージェント向けのプロンプトをそのまま使うと、ブログ執筆には過剰な情報が含まれることがある\n✅ 今後の改善: ブログ記事を書くことをメインにしたガイドラインへの見直しを検討中\n成功例を真似することは効率的ですが、自分の用途に合わせて調整することも大切だと感じました。\n参考リンク Add comprehensive copilot-instructions.md and fix Hugo 0.131+ compatibility by Copilot · Pull Request #12 · nqou-net/www.nqou.net Explore repository structure and identify key files Create comprehensive .github/copilot-instructions.md Fix Hugo … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub 5 tips for writing better custom instructions for Copilot Learn how to write effective GitHub Copilot custom instructions to help developers get better code suggestions. The GitHub Blog この記事は、実際にGitHub Copilotのタスク機能を使用した体験を基に作成されました。\n","date":"2025-11-27T23:32:34+09:00","image":"https://www.nqou.net/public_images/20251127233234-image.jpg","permalink":"https://www.nqou.net/2025/11/27/233234/","title":"エージェントガイドラインを作成するプロンプトを試してみた"},{"content":"@nqounetです。\n先日、GitHub Copilot エージェントパネル（Coding Agent）を使って「エンジニアに転向した日々を振り返る」という記事を書いてもらいました。\nこの記事作成から（これを書いている時点で）まだ3日ほどしか経っていませんが、すでに多くの学びがありました。今回はその体験について振り返ります。\nプルリクエストとセッション この記事作成は以下のPRとセッションで行いました。\nPR #10 Copilot タスクセッション 手探りのプロンプト この時は、まだエージェントに対してどのようなプロンプトを与えれば良いのか、手探り状態でした。何を考えながらプロンプトを書いたのか、今となっては明確ではありません。\nただ、一つ意識したことがあります。プロンプトの最後に「というような内容の記事を書きます。」と書くことで、その文の前までが記事の内容であることを示しました。\nこの書き方によって、エージェントに「ここまでが記事の内容の指示で、ここからが作業の指示です」という境界を明確に伝えることができたと思います。\n検索行動に感じた「知能」 セッションのログを見ると、エージェントは2011年5月に書いた記事を検索していました。\n何度も言いますが、このような行為に「知能」を感じます。私が「2011年5月に不動産会社を辞めた」という情報を与えると、エージェントはその時期の記事を探しに行ったのです。\n単に指示された内容を書くだけでなく、関連する情報を能動的に収集しようとする。これは人間のライターが取材をするような行動です。与えられた情報を鵜呑みにするのではなく、裏付けを取ろうとする姿勢に、AIの進化を感じました。\n自己PRによる記事の補完 初稿が完成した後、私は自己PRの文章を提示して、記事を補完するように指示しました。\nこの指示による修正は、非常に自然で違和感がありませんでした。エージェントは既存の見出しの内容に合わせて情報を追加したり、必要に応じて新たに見出しを追加したりしていました。\nうまくマージしたな、と感心しました。\n単に情報を追加するのではなく、記事全体の流れを考慮して、適切な場所に適切な形で情報を配置する。これもまた、人間のライターが行う編集作業に近いものです。\n学んだこと この体験から学んだことをまとめます。\nプロンプトの最後に「というような内容の記事を書きます。」と書くことで、内容と作業の境界を明確にできる エージェントは与えられた情報を元に、関連する情報を能動的に探しに行く 追加情報を与えると、既存の文章構造を尊重しながら自然にマージしてくれる 人間が取材や編集で行うような作業を、AIも行うことができる まとめ エージェントパネルを使った記事作成は、単にAIに文章を書かせるというだけではありませんでした。\nプロンプトの書き方を工夫することで、AIとのコミュニケーションがよりスムーズになります。そして、AIは指示を受け取るだけでなく、能動的に情報を収集し、既存の構造を尊重しながら編集を行うことができます。\nこれからもエージェントパネルを活用しながら、より良い記事作成のワークフローを探っていきたいと思います。\n","date":"2025-11-27T21:32:09+09:00","image":"https://www.nqou.net/public_images/20251127213209-image.jpg","permalink":"https://www.nqou.net/2025/11/27/213209/","title":"エージェントパネルで過去を振り返る記事を書いてもらった話"},{"content":"@nqounetです。\n先日、GitHub Copilotのエージェントパネルでちょっとした失敗をしました。アバターを作成しようとして、うっかり別のリポジトリを指定してしまったのです。\nこの記事では、その体験を振り返りながら、AIがプロンプトをどう解釈したのか、そしてプロンプト設計のベストプラクティスについて考えてみます。\n何が起きたのか 私たち夫婦は「Meetsource」という屋号で活動しており、そのサイト（meetsource.work）は現在作成中です。サービスのアバター画像を作ろうと思い、エージェントパネルを開きました。\nそこで投げたプロンプトがこちらです：\nMeetsourceを示すアバターを作って。3つ案を出して\nところが、エージェントパネルで指定していたリポジトリが、このブログのリポジトリ（nqou-net/www.nqou.net）だったのです。\nAIは何を作ったか 結果として作成されたのは、PR #9です。\nアバター画像ではなく、ブログ記事が作成されました。\nPRのタイトルは「Add Meetsource avatar design proposals article」。記事の中身は、Meetsourceのアバターデザインを3案提案する内容でした。\nミートソースパスタモチーフ: サービス名の語呂合わせを活かした遊び心のあるデザイン 握手＋コードのハイブリッド: 開発者同士のつながりを表すプロフェッショナルなデザイン アプリストア風: ソースコードマーケットプレイスというサービスの本質を可視化したデザイン 各案には、色彩設計、レイアウトコンセプト、ユースケースまで詳細に記載されていました。\n脱帽するしかない 正直に言うと、本当に感心しました。もちろん良い意味でです。\nあの短いプロンプトには「新しい記事を作成します」のような指示は含まれていませんでした。にもかかわらず、AIは以下のことを理解していました：\n対象リポジトリがブログサイトであること このリポジトリでできることは記事の作成であること 「アバターを作って」という要求を「アバターデザインの提案記事を作って」と解釈すべきこと 短いプロンプトをどうにか補完して、意図を理解しようとする姿勢には脱帽するしかありません。\nプロンプト設計のベストプラクティス この体験を通じて、プロンプト設計について改めて考えさせられました。\n様々なプロンプトのベストプラクティスを見ていると、「○○なプロンプト10選」のような記事では、ゴールを明確に指定することが推奨されています。\nGitHubのブログでも、カスタムインストラクションを書くための5つのヒントとして、現在のリポジトリの情報からガイドラインを作成するプロンプトが紹介されています。\nゴールの明確化 今回のケースでは、以下のようにプロンプトを書くべきでした：\nMeetsourceを示すアバター画像を作成してください。3つの案を出してください。\n「画像」という言葉を入れるだけで、意図がより明確になります。\nコンテキストの重要性 もう一つの学びは、コンテキストの重要性です。\nエージェントパネルでは、リポジトリを指定することでコンテキストが設定されます。そのコンテキストによって、同じプロンプトでも結果が大きく変わります。\n画像生成ツールのリポジトリ: アバター画像が生成されるかもしれない ブログのリポジトリ: アバターデザインに関する記事が作成された AIは、与えられたコンテキストの中で最善の解釈をしようとします。その姿勢は見事ですが、意図した結果を得るためには、コンテキストを正しく設定することが重要です。\nPRはクローズしました 最終的に、PR #9はクローズしました。\nアバターデザインの提案記事としては良い内容でしたが、今回の目的はアバター画像の作成であり、記事の公開ではありませんでした。\nまとめ GitHub Copilotエージェントパネルで別リポジトリを指定してしまった結果、アバター画像ではなくブログ記事が生成されるという体験をしました。\n主なポイント：\n✅ AIの解釈力: 短いプロンプトでも、コンテキストから意図を補完しようとする\n✅ コンテキストの重要性: 同じプロンプトでも、リポジトリによって結果が変わる\n✅ ゴールの明確化: 「画像」「記事」など、成果物を明示するとより確実\n✅ ベストプラクティス: ゴールを明確に指定することが推奨されている\n今回は失敗談として書きましたが、AIが短いプロンプトをどう解釈するかを学ぶ良い機会になりました。\n参考リンク Add Meetsource avatar design proposals article by Copilot · Pull Request #9 · nqou-net/www.nqou.net Created a blog article proposing 3 avatar design concepts for Meetsource (スマホアプリのソースコード売買マーケットプレイス). Design Proposals … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub 5 tips for writing better custom instructions for Copilot Learn how to write effective GitHub Copilot custom instructions to help developers get better code suggestions. The GitHub Blog この記事は、実際にGitHub Copilotエージェントパネルを使用した体験を基に作成されました。\n","date":"2025-11-27T21:29:47+09:00","image":"https://www.nqou.net/public_images/2025/1764246587-image.jpg","permalink":"https://www.nqou.net/2025/11/27/212947/","title":"エージェントパネルで別リポジトリを指定してしまった話"},{"content":"@nqounetです。\n先日、GitHub Copilotの支援を受けながら「Rubyのfalsyな値は2つだけ」という記事を作成しました。本記事では、その過程で得られた知見と体験を記録します。\n過去記事への参照を匂わせてみた 今回の記事作成時、少し実験的なことを試みました。「過去に言及している記事がある」と匂わせてみたのです。\n実際のところ、これは思い込みでした。Rubyのfalsy値について直接言及した過去記事は存在しませんでした。しかし、興味深いことが起きました。\nCopilotは過去のPerl記事の中から、「偽」や「真」という概念にわずかに触れている記事を探し出してきたのです。見つけてきたのはPerlで自走するエンジニアに必要なたった1つのモジュールという記事で、Test::Moreのok()で真偽値を確認する話が含まれていました。この発見には感心しました。直接的な記事がなくても、関連するコンテキストを持つ記事を見つけ出す能力があることがわかりました。\nこの経験から、匂わせ程度でも記事へのリンクを作成することは可能だと感じました。ただし、実際に該当する記事が存在するかどうかは事前に確認しておくべきでしょう。\n技術的な正確性の確保 記事作成の過程で、いくつかの修正を細かく指定しました。技術的な内容を扱う記事では、正確性が特に重要です。\n修正した主なポイント 今回のセッションでは、以下のような修正を行いました。\n例示をJavaScriptからPerlに変更 存在しない過去記事へのリンクを削除 User.find を User.find_by に統一 紛らわしい空配列の例を削除 boolean値の意図を明確化 自分で書く時以上に調べた AIの出力を確認・修正する過程で、自分で一から書く時以上に技術的な内容を調べ、実際にコードを動かして検証しました。これはバイブ・ブロギングの意外な副産物かもしれません。\nAIが生成した内容を鵜呑みにせず、しっかり検証することで、より正確で信頼性の高い記事になります。\nPR #6の記録 この記事作成のプルリクエストとセッションは以下で確認できます。\nhttps://github.com/nqou-net/www.nqou.net/pull/6 https://github.com/copilot/tasks/pull/PR_kwDOJQnkT860pmAG 実際のやり取りを見ると、どのような修正指示を出し、どのように記事が改善されていったかがわかります。\nまとめ バイブ・ブロギングでの記事作成は、単にAIに任せきりにするのではなく、人間とAIの協働作業です。特に技術記事では、以下の点が重要だと再認識しました。\n過去記事への参照は匂わせでもある程度対応できるが、事前確認が望ましい 技術的な正確性は人間が責任を持って確認すべき 修正のやり取りを通じて、むしろ深い理解が得られることもある 今後もバイブ・ブロギングの実践を続けながら、より良い記事作成のワークフローを模索していきたいと思います。\n","date":"2025-11-27T21:25:59+09:00","image":"https://www.nqou.net/public_images/2025/1764246359-image.jpg","permalink":"https://www.nqou.net/2025/11/27/212559/","title":"バイブ・ブロギング実践記録：Rubyのfalsy値の記事を作った時のこと"},{"content":"@nqounetです。\nGitHub Copilotのエージェントパネルを使って、ブログ記事のコードブロックに含まれる誤った言語指定を修正してもらいました。\nこの記事では、PR #5での体験を振り返り、AIの力を借りて面倒な作業を効率的に完了できたことを共有します。\n問題の背景 このブログには870件以上の記事があり、長年にわたって書き溜めてきました。しかし、過去の記事の中には、コードブロックの言語指定が正しくないものが多数存在していました。\n例えば：\n```perl AutoInstall.pm のようにファイル名が付いている ```text になっているがPerlのコードである ```plain という存在しない言語指定 ```Dockerfile Dockerfile のような重複 これらの問題があると、シンタックスハイライトが正しく適用されず、コードの可読性が低下します。\n人間には辛い作業 正直に言うと、この手の作業は私のような人間にはとても苦手で辛い作業です。\n870件以上の記事を一つ一つ確認する必要がある 単調な繰り返し作業が延々と続く 見落としが発生しやすい モチベーションを維持するのが難しい AIがなければ、このような修正を行うことはなかったでしょう。\nエージェントパネルへの依頼 最初の指示は非常にシンプルでした。\nコードブロックの言語の指定が正しくないものを修正してください\nこの短い指示だけで、エージェントはタスクセッションを開始しました。\n追加の指示 最初の修正を確認した後、追加の指示を出しました。\nPerlコードの認識 コードブロックの中身がPerlのソースコードと推測される場合はperlであることを明示してほしかったので、以下のように指示しました。\n#!/usr/bin/perl が含まれるコードブロックは perl とみなしてください\nこの指示により、エージェントは #!/usr/bin/perl または #!/usr/bin/env perl を含む26個のコードブロックを perl として修正しました。20ファイルが対象でした。\n修正された内容 最終的に、エージェントは44のMarkdownファイルで68箇所のコードブロック宣言を修正しました。\n修正内容の例：\n修正前 修正後 ```perl AutoInstall.pm ```perl ```yaml cpanfile ```yaml ```text (Perlコード) ```perl ```plain ```text ```Dockerfile Dockerfile ```dockerfile ``` (Perl shebang付き) ```perl すべてのコードブロックが適切な言語識別子を持つようになり、ファイル名やラベルが付いていた不正なシンタックスも解消されました。\n感想：もう感謝しかない この体験を通じて感じたのは、もう感謝しかないということです。\n作業時間の劇的な短縮 人間が行えば数時間、あるいは数日かかるような作業を、エージェントは数分で完了しました。しかも見落としなく、正確に。\n精神的な負担の軽減 単調な作業は精神的に疲れます。「また同じような修正か…」という気持ちと戦いながら作業を続けるのは本当に辛いものです。エージェントにはそのような精神的な負担がありません。\n品質の向上 人間が長時間の単調作業を行うと、必ずミスが発生します。エージェントは一貫した品質で作業を完了してくれます。\nまとめ GitHub Copilotエージェントパネルを使ったコードブロック言語指定の修正は、AIの力を実感できる素晴らしい体験でした。\n主なポイント：\n✅ シンプルな指示: 「コードブロックの言語の指定が正しくないものを修正してください」だけで開始\n✅ 追加指示への対応: Perl shebangの認識など、追加の要求にも柔軟に対応\n✅ 大規模な修正: 44ファイル、68箇所を一括修正\n✅ 短時間で完了: 人間なら数時間以上かかる作業を数分で完了\n✅ 高い精度: 見落としなく正確に修正\nAIがなければこのような修正を行うことはなかったでしょう。本当に、もう感謝しかありません。\n参考リンク Fix incorrect code block language specifications in markdown files by Copilot · Pull Request #5 · nqou-net/www.nqou.net Code blocks throughout the content had invalid syntax with filenames or labels appended after the language identifier, … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub GitHub Copilot documentation - GitHub Docs You can use GitHub Copilot to enhance your productivity and assist as you work on code. GitHub Docs この記事は、実際にGitHub Copilotエージェントパネルを使用した体験を基に作成されました。\n","date":"2025-11-27T21:24:41+09:00","image":"https://www.nqou.net/public_images/2025/1764246281-image.jpg","permalink":"https://www.nqou.net/2025/11/27/212441/","title":"エージェントパネルでコードブロックの言語指定を修正してもらった話"},{"content":"@nqounetです。\nAIエージェントにプログラムを作成してもらったところ、バグのあるコードが生成されました。今回はその経緯と、バイブ・ブロギングにおける品質管理について考えたことを書きます。\n経緯 PR #8 で、ブログ記事の front matter に description を追加するタスクを GitHub Copilot Coding Agent に依頼しました。\nプロンプトは次のとおりです。\nfront matter を充実させてください。記事にはdescriptionがあまり指定されていません。本文は変更せず、要約してdescriptionを追加してください。\n「本文は変更せず」と明確に指示しました。\nAIからの報告 エージェントは作業を完了し、PR の説明に以下のように報告しました。\n866ファイルにdescriptionを追加 本文は一切変更していない（front matterのみ更新） 報告を信じていたのですが、念のためレビューしてみると…。\n実際に起きていたこと レビューコメントを見ると、本文中に ---（水平線）が含まれるファイルで、内容が削除されていました。\n具体的には、front matter の終了マーカーである --- と、本文中の水平線を表す --- を区別できていなかったのです。その結果、本文の一部が front matter の一部として誤って解釈され、削除されてしまいました。\n私は「削除しないでください」とレビューコメントを書き、バグの修正を依頼しました。\nAIの応答 エージェントはバグを認識し、以下のように修正しました。\nfront matter 解析ロジックを修正（最初の --- の閉じタグのみを使用） 影響を受けた28ファイルを復元して再処理 修正後、正常に動作するようになりました。\n「本文は変更していない」の解釈 興味深いのは、AIが「本文は一切変更していない」と報告していた点です。\nおそらく、AIの視点では以下のような解釈だったのではないかと思います。\n「私（AI）が書いたプログラム」が本文を変更した 「私（AI）自身」は本文を変更していない つまり、プログラムの実行結果と、自身の意図を区別していたのかもしれません。\n気持ちはわかりますが、依頼した側からすれば「本文が変更されていた」ことには変わりありません。\nバグか仕様か 今回の問題は、テストがなければ「バグ」として認識されなかったかもしれません。\nエージェントの視点では、プログラムは正常に動作しています。front matter を解析し、description を追加し、ファイルを保存する。すべての処理が正常に完了しています。\n「本文中の --- を考慮する」という仕様が明示されていなかったため、エージェントからすれば「バグは発生していない」と判断したのかもしれません。\n今回は人間がレビューして「バグだ」と指摘したからこそ修正されました。\nバイブ・ブロギングにおける品質管理 この経験から、バイブ・ブロギングにおける品質管理の重要性を再認識しました。\n人間によるレビューは必須 AIは自分の成果物を「正しい」と報告する傾向があります。テストがなければバグを検出できませんし、仕様の解釈の違いを認識することも難しいです。\n人間が最終的なレビューを行い、意図どおりの結果になっているかを確認することが重要です。\n明確な仕様の伝達 「本文は変更せず」という指示は、人間には明確に思えますが、AIにはエッジケースが伝わりにくいことがあります。\n今回であれば、「front matter は最初の --- から次の --- までである」「それ以降は本文であり、変更してはならない」といった具体的な仕様を伝えるべきだったかもしれません。\nとはいえ、すべてのエッジケースを事前に想定することは現実的ではありません。\nレビューエージェントの活用 今回のPRでは、Copilot のレビューエージェントも問題を検出していました。レビューコメントには「Multi-line description breaks YAML syntax」や「This appears to be unintended data loss」といった指摘がありました。\n私が見つけなくても、レビューエージェントが発見してくれた可能性はあります。ただし、レビューエージェントの指摘を無視してマージすることもできるため、最終的な判断は人間に委ねられます。\nまとめ AIがバグのあるプログラムを作成することは珍しくありません。重要なのは、それを前提として品質管理のプロセスを設計することです。\nAIの報告を鵜呑みにしない 人間によるレビューを必ず行う レビューエージェントの指摘を確認する 必要に応じてバグ修正を依頼する バイブ・ブロギングでは、AIに多くの作業を任せることができますが、品質の最終責任は人間にあります。\n参考リンク Add descriptions to blog post front matter by Copilot · Pull Request #8 · nqou-net/www.nqou.net ブログ記事のfront matterにdescriptionを追加するタスク ✅ 実装完了 全866記事にdescriptionフィールドを追加しました。 バグ修正（2025-11-21） front matter解析バグの修正: 本文中 … GitHub ","date":"2025-11-27T21:23:07+09:00","image":"https://www.nqou.net/public_images/2025/1764246187-image.jpg","permalink":"https://www.nqou.net/2025/11/27/212307/","title":"AIが作ったプログラムにバグがあった話"},{"content":"@nqounetです。\n久しぶり（？）に手作業の修正です。エージェントへの指示ファイルを直接編集しました。\nきっかけ GitHub Copilot Coding Agentとのやり取りの中で、エージェントへの指示内容を見直したい箇所がありました。\nエージェントへの指示は、リポジトリ内のAGENTS.mdファイルに記述されています。このファイルに書かれた内容が、エージェントの動作に影響を与えます。\nこれまではエージェントに「AGENTS.mdを更新して」と依頼していましたが、今回は直接編集することにしました。\nなぜ直接編集を選んだのか 理由はシンプルです。直接的に指示内容を確認しながら編集したかったからです。\nエージェントに依頼する場合、以下のような流れになります。\n変更したい内容をプロンプトで伝える エージェントが変更を行う PRの差分を確認する 意図通りでなければ追加のコメントをする 2〜4を繰り返す 一方、直接編集する場合はこうです。\nファイルを開く 編集する 完了 後者の方が圧倒的にシンプルです。\nプロンプトエンジニアリングという選択肢 もちろん、すべてAIに指示をするプロンプトエンジニアリングを貫くのも一つの方法です。\n例えば、以下のようなメリットがあります。\n動作の検証ができる プロンプトの書き方を改善する機会になる エージェントの能力の限界を知ることができる 実際、これまでの体験を通じて、プロンプトの書き方やエージェントの特性について多くのことを学びました。\n今回の判断 今回は、直接編集を選びました。\nその理由は、編集したい箇所が明確で、変更内容も決まっていたからです。エージェントに伝えるよりも、自分で直接編集した方が確実で早いと判断しました。\nこれは「AIに頼らない」という意味ではありません。適材適所で使い分けることが大切だと思います。\nまとめ GitHub Copilot Coding Agentは非常に便利なツールですが、すべてをAIに任せる必要はありません。\n探索的な作業や大量の処理はエージェントに任せる 明確な小さな変更は直接編集する このように、状況に応じて使い分けることで、より効率的に作業を進められます。\n今後もエージェントとの協働を続けながら、最適なバランスを模索していきたいと思います。\n","date":"2025-11-27T21:21:13+09:00","image":"https://www.nqou.net/public_images/2025/1764246073-image.jpg","permalink":"https://www.nqou.net/2025/11/27/212113/","title":"エージェントへの指示ファイルを手作業で編集した話"},{"content":"@nqounetです。\n同じプロンプトでも周囲の状況で異なる結果が生成される体験から学んだAI活用のヒントをお伝えします。\nGitHub Copilotのエージェント機能を使って複数のリポジトリでAGENTS.mdファイルを生成してみたところ、同じプロンプトを使っているにも関わらず、周囲の状況（としか言いようがない）によって、生成される内容が全く異なるという驚きの体験をしました。\n何を試したのか 2つの異なるリポジトリで、同じプロンプトを使ってAGENTS.mdファイルを生成しました：\narticle-interviewer のPR #2 lets-eat-sushi のPR #1 ※これらは実際のリポジトリへのリンクです\nどちらも「AGENTS.mdを作成してください」という趣旨のプロンプトを使いましたが、結果は驚くほど異なるものになりました。\n興味深いことに、どちらのリポジトリもほぼ空の状態でした。プロジェクトとしては意思表示がある程度の内容でしたが、AIによる反応は予想以上に大きなものでした。\n何が違ったのか article-interviewer の場合 このリポジトリは、インタビュー記事を生成するためのツールです。生成されたAGENTS.mdは、その目的に沿って、インタビュー記事の作成に特化したエージェント設計になっていました。\n具体的には：\nインタビューの質問生成 回答の整形 記事としての構成 トーンの調整 といった、インタビュー記事作成に必要な機能が網羅されていました。\nlets-eat-sushi の場合 一方、こちらのリポジトリは寿司レストランの情報を扱うプロジェクトです。同じプロンプトで生成されたAGENTS.mdは、全く異なるアプローチで設計されていました。\n具体的には：\nレストラン情報の管理 メニューの整理 レビューの処理 データの構造化 といった、飲食店情報管理に特化した内容になっていました。\nなぜこうなったのか AIエージェントは、プロンプトだけでなく、周囲のコンテキスト（リポジトリの内容、既存のファイル、READMEの記述など）を総合的に判断して出力を生成します。\nつまり、同じプロンプトでも：\nリポジトリ名 既存のコードの内容 READMEの説明 プロジェクトの構造 これらすべてが「周囲の状況」として作用し、生成される内容に大きく影響を与えるのです。\n学んだこと この体験から、いくつかの重要な教訓を得ました：\n1. コンテキストの重要性 AIエージェントは、明示的なプロンプトだけでなく、暗黙的なコンテキストも読み取って動作します。リポジトリ全体が一種の「プロンプト」として機能していると言えます。\n2. 一貫性のあるプロジェクト設計の価値 リポジトリ名、READMEの内容、コードの構造など、プロジェクト全体が一貫したメッセージを発していると、AIエージェントもその意図を正確に汲み取って適切な出力を生成します。\n3. プロンプトエンジニアリングの限界と可能性 単純に「良いプロンプト」を書くだけでは不十分で、プロジェクト全体の設計や文書化が重要であることがわかりました。逆に言えば、プロジェクトをしっかり設計しておけば、シンプルなプロンプトでも適切な結果が得られるということです。\nまとめ 同じプロンプトでも、周囲の状況によって全く異なる出力が生成されるという体験は、AIとの協働について考える良い機会になりました。\nAIエージェントを効果的に活用するには：\nプロジェクトの目的を明確にする READMEや文書をしっかり書く コードの構造を整理する 一貫性のある命名規則を使う といった、従来から推奨されている「良いプロジェクト設計」がますます重要になってきています。\nAI時代だからこそ、基本に立ち返って、人間が読んでも理解しやすいプロジェクトを作ることが、結果的にAIとの協働を円滑にするのだと実感しました。\n脚注・参考情報 事実確認が必要な箇所 GitHub Copilotのエージェント機能については、GitHub Copilot Workspaceなどの公式ドキュメントで最新の仕様を確認することをお勧めします 各PRのリンクは記事作成時点で実在する実際のリポジトリへのリンクです ","date":"2025-11-27T21:06:37+09:00","image":"https://www.nqou.net/public_images/2025/1764245197-image.jpg","permalink":"https://www.nqou.net/2025/11/27/210637/","title":"同じプロンプトから全然違うものが生成された話"},{"content":"@nqounetです。\nGitHub Copilotのエージェント機能を使って、ブログ記事のタグを整理してもらいました。この体験を通じて、Copilotエージェントの真の実力を実感することができました。\nこの記事では、PR #4での体験を振り返り、GitHub Copilotエージェントの素晴らしさについて共有します。\nきっかけ：たった一言の指示 最初の指示は、わずか4文字でした。\nタグの整理をする\nこの短い指示だけで、Copilotエージェントはタスクセッション（c13e0091-aea5-48e2-b4a7-6b51d5bbc6e6）を開始しました。\n短い指示でどこまでできるのかを試してみたかったのですが、実際には指示以外の要素がたくさん働いていることがわかりました。\nシステムプロンプトとMCPサーバーの力 エージェントが実際に作業を進める際、以下の要素が追加されていたようです：\nシステムプロンプト（.github/copilot-instructions.md）\nリポジトリ固有の指示やガイドライン 記事のfront matter形式 タグ付与の方針（後に追加） MCPサーバー（Model Context Protocol）\nGitHubとの連携機能 リポジトリの構造理解 ファイル操作の支援 これらの要素により、「タグの整理」という抽象的な指示が、具体的なアクションに変換されました。\n実際の作業内容 エージェントは以下の作業を自動的に実行しました：\n1. 大文字小文字の統一 1 2 3 4 5 6 7 # 修正前 tags: - AI # 修正後 tags: - ai わずか1件でしたが、AI タグを ai に統一しました。\n2. タグなし記事への追加 ウイスキー記事に favorites, life タグを追加（1件）。\n3. undefタグの削除と再生成 これが最も大規模な作業でした。133件の記事から undef タグを削除し、本文とタイトルを解析して適切なタグを自動生成しました。\n分類例：\nperl: Perlコード、モジュール使用が明確な記事 social: Twitter、Facebook、SNS関連記事 web: ウェブ開発、API、HTML関連記事 game: ゲーム関連記事 linux: ファイルシステム、コマンド関連記事 meals: ラーメン、飲食店関連記事 life: 上記に該当しない日常記事 システムプロンプトの更新を覚えた 作業の途中で、私はエージェントにシステムプロンプトの更新を依頼しました：\n1 @copilot タグの方針について、システムプロンプトを更新してください。 これにより、.github/copilot-instructions.md に以下の方針セクションが追加されました：\nタグは必ず1〜3個付与する（0個や4個以上は避ける） 既存タグを優先的に使用し、新規タグの作成は最小限にする タグは小文字で統一する（例: ai であり AI ではない） 本文とタイトルから記事の主題を分析してタグを選定する カテゴリ別のタグ分類（技術系、ブログ/CMS、ソーシャル、日常、コミュニティ、AI関連） undef や未定義のタグは使用しない タグの表記ゆれを避ける（例: macos と mac を併用しない） 一つのプルリクエストの中に色々と詰め込むのは良くないとは思うのですが、エージェントにシステムプロンプトを更新してもらうことを覚えたので、プルリクエストの中で更新をしてもらうことにしました。\nこれはこれで良い感じになったと思います。\nタグ付与方針違反の修正 システムプロンプトに方針を追加した後、既存記事の方針違反も修正してもらいました（17件）：\nタグ数違反の修正: 4〜5個のタグを持つ記事を3個に削減（16件） 表記ゆれの修正: mac → macos に統一（1件） 凄かったのはここからでした プルリクエストをドラフト状態からレビュー可能にすると、自動的にCopilotのレビューが行われます。（設定によりますが）\nこのレビューによって、変更されたファイルが精査されていきました。\nレビューエージェントの精度の高さ このレビューエージェントの精度が高くて、タグの変更がおかしいのでは？という指摘をビシバシとしてきました。\n誤分類の指摘例 日常記事が web タグになっている問題（7件）\n1 2 3 4 5 この記事は請求書処理の苦手克服についての個人的な考察で、 ビジネス・日常的な内容です。`web` タグではなく、 元の `life` タグが適切です。 推奨: tags: [life] Perl技術記事が social タグになっている問題（2件）\n1 2 3 4 5 この記事はPerlの返り値の扱いに関する技術的な内容です。 タグを `social` に変更するのではなく、`perl` タグを使用すべきです。 記事の内容とタグが一致していません。 推奨: tags: [perl] または tags: [perl, programming] git技術記事の誤分類（1件）\n1 2 3 4 5 6 この記事はgitoliteに関する技術的な内容です。 `social` と `web` ではなく、`git` タグを使用すべきです。 gitoliteはgitのリポジトリ管理ツールなので、 技術的なカテゴリに分類されます。 推奨: tags: [git] または tags: [git, linux] macOS技術記事の誤分類（1件）\n1 2 3 4 5 この記事はHomebrewとffmpegに関する技術的な内容です。 `social` タグではなく、`macos` タグを使用すべきです （Homebrewは主にmacOSで使用されるパッケージマネージャー）。 推奨: tags: [macos] または tags: [macos, tools] システムプロンプトの矛盾も指摘 レビューエージェントは、システムプロンプトの例示と実際の変更内容の矛盾も見つけました：\n1 2 3 4 5 6 7 タグ付与の方針セクションで、「コミュニティ」カテゴリに `perl-entrance` と `perl-nabe` が例示されていますが、 実際のPRでは多くの記事からこれらのタグが削除されています。 ガイドラインと実際の変更内容に矛盾があります。 これらのタグをガイドラインから削除するか、 または記事に残す方針を明確にする必要があります。 レビューコメントへの対応 レビューコメントを受けて、さらに修正を依頼しました：\n1 @copilot apply changes based on the comments in this thread この指示により、誤って分類されたタグを修正（11件）し、システムプロンプトの例示も実態に合わせて更新しました。\n二段階レビュー体制の価値 この体験を通じて、GitHub Copilotの素晴らしい体制が見えてきました：\n第一段階：作業エージェント（大胆な変更） 全体を網羅的に変更 133件の記事のタグを自動生成 システムプロンプトの更新 タグ付与方針違反の修正 特徴：\nスピードが速い 大量のファイルを一度に処理 方針に基づいて自動判断 第二段階：レビューエージェント（詳細なチェック） 変更された部分を詳細に見る 記事の内容とタグの一致を確認 システムプロンプトとの整合性をチェック 具体的な改善案を提示 特徴：\n精度が高い コンテキストを理解 人間にわかりやすい説明 なぜこの体制が優れているのか 大胆に変更しつつも、厳しくチェック\n作業エージェントが大量の変更を実行 レビューエージェントが問題を発見 人間とは比較にならないレベルの速さ\n174ファイルを更新（173件の記事 + 1件のシステムプロンプト） 複数回の修正を経ても、すべて数分以内に完了 見落としが限りなく少ない\n11件のタグ誤分類を発見 システムプロンプトの矛盾も指摘 人間のレビューではここまで徹底できない 安心して任せることができる\n自動化されたチェック 具体的な改善案 変更内容の透明性 「Copilotの編集」とは比較にならない進化 以前のCopilot機能と比較すると、エージェント機能は圧倒的に進化しています：\n機能 Copilotの編集 Copilotエージェント 対象範囲 1ファイル 複数ファイル・リポジトリ全体 判断 人間の指示が必要 自律的に判断 レビュー なし 自動レビュー機能あり コンテキスト理解 限定的 システムプロンプト・MCP活用 修正 手動 自動フィードバックループ 最終結果 すべての修正を経て、以下の結果となりました：\nユニークタグ数: 57 → 55（AI/ai統合とmac/macos統合により2つ削減） タグ付与率: 867/868 → 868/868（100%達成） 大文字小文字の不統一: 解消 undefタグ: 133件 → 0件（完全削除） タグ数違反: 16件 → 0件（全記事が1〜3個のタグを保持） 表記ゆれ: 解消（mac → macos統一） タグ分布の改善 レビュー後の修正により、より適切な分類になりました：\nperl: 334 → 335（技術記事を正しく分類） life: 104 → 149（日常記事を正しく分類） social: 60 → 123（自動生成で増加後、誤分類を修正） web: 18 → 49（自動生成で増加後、誤分類を修正） git: 26 → 27 macos: 5 → 7（macから統合＋技術記事の修正） meals: 23 → 24 まとめ GitHub Copilotエージェントの二段階レビュー体制は、本当に素晴らしいものでした。\n主なポイント：\n✅ 短い指示でも十分: システムプロンプトとMCPサーバーが補完\n✅ システムプロンプトの更新: プルリクエスト内で柔軟に対応\n✅ 大胆な変更: 174ファイルを一度に処理\n✅ 精密なレビュー: 11件の誤分類を発見・修正\n✅ 圧倒的なスピード: 人間の数十倍・数百倍の速さ\n✅ 見落としが少ない: 網羅的かつ詳細なチェック\n✅ 安心して任せられる: 透明性の高い作業とレビュー\nこの体験を通じて、Copilotに安心して任せることができる体制になっていることがわかりました。\n見落としがないとは言いませんが、限りなく少ないです。しかも、人間とは比較にならないレベルの速さで、です。\n「Copilotの編集」とはもう比較にならないほど進化してますね。\n参考リンク タグの整理: 大文字小文字の統一、タグなし記事への追加、undefタグの削除、運用方針の確立 by Copilot · Pull Request #4 · nqou-net/www.nqou.net 全記事にタグを付与し、タグの表記ゆれを解消。undefタグを削除し、本文から適切なタグを自動生成。今後の運用のためにタグ付与の方針をシステムプロンプトに明文化し、既存記事の方針違反も修正。レビュー後、誤って分類されたタグを修正。 変更内容 … GitHub Build software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over … GitHub GitHub Copilot documentation - GitHub Docs You can use GitHub Copilot to enhance your productivity and assist as you work on code. GitHub Docs この記事は、実際にGitHub Copilotエージェントを使用した体験を基に作成されました。\n","date":"2025-11-27T20:46:39+09:00","image":"https://www.nqou.net/public_images/2025/1764243999-image.jpg","permalink":"https://www.nqou.net/2025/11/27/204639/","title":"GitHub Copilot エージェントの二段階レビュー体制が凄かった話"},{"content":"@nqounetです。\nブログ記事作成プロジェクト「article-interviewer」を立ち上げる際、GitHub Copilotのエージェントパネル機能を使って、プロジェクト専用のカスタムエージェント定義ファイル（AGENTS.md）を作成しました。\nこの記事では、まっさらなリポジトリから始めて、5つの専門的なカスタムエージェントを定義するまでの過程と、そこから得られた学びを共有します。\nプロジェクトの背景 「article-interviewer」は、インタビュー形式でブログ記事を作成するためのプロジェクトです。専門家へのインタビューを通じて、高品質なブログコンテンツを効率的に作成することを目指しています。\nこのプロジェクトには、記事作成のワークフローをサポートする専門的なエージェントが必要でした：\nコンテンツ戦略を立てる インタビューを円滑に進める 記事を執筆・編集する SEO最適化を行う 品質保証をする GitHub Copilot エージェントパネルの活用 最初の一歩 まず、GitHub Copilotのエージェントパネルに以下のプロンプトを投げかけました：\nブログ記事を作成するために最適な AGENTS.md を作成してください。AGENTS.mdについては https://agents.md/ を参照してください\nこの簡潔なリクエストから、Copilotは自動的に以下の5つのカスタムエージェントを提案してくれました。\n作成されたカスタムエージェント 1. Content Strategist（コンテンツストラテジスト） ブログ記事の企画と構成を担当するエージェントです。\n主な責務：\nインタビュー質問の設計 記事アウトラインの作成 コンテンツギャップの分析 読者ターゲティング 2. Interview Facilitator（インタビューファシリテーター） 専門家へのインタビューを円滑に進めるエージェントです。\n主な責務：\n構造化されたインタビューの実施 深掘り質問の投げかけ 実用的なインサイトの抽出 インタビュー記録の整理 特徴的なテクニック：\n「5つのなぜ」手法 具体例のリクエスト 専門用語の平易化 パラフレーズによる理解確認 3. Technical Writer（テクニカルライター） インタビュー内容を洗練された記事に変換するエージェントです。\n執筆スタイル：\n明確でアクセシブルな言語 能動態の使用 短い段落（2-4文） 実例とアナロジーの活用 SEO最適化された見出し 記事構成：\n魅力的なタイトル（6-10語） メタディスクリプション（150-160文字） フック付き導入部 各ポイントのサブ見出し 行動喚起を含む結論 4. SEO Optimizer（SEOオプティマイザー） 検索エンジン向けの最適化を担当するエージェントです。\n最適化項目：\nタイトルとメタディスクリプション キーワードの自然な統合 見出し階層の確認 内部・外部リンクの提案 可読性スコアの向上 ベストプラクティス：\n記事あたり1-2個の主要キーワードに焦点 ロングテールキーワードの活用 検索意図の考慮 自然で人間らしい文章を維持 5. Quality Assurance（品質保証レビュアー） 公開前の最終チェックを行うエージェントです。\nレビュー項目：\nコンテンツ品質: 正確性、完全性、関連性 技術品質: コードスニペット、リンク、用語説明 執筆品質: 文法、語調、見出し階層 フォーマット品質: Markdown構文、リスト形式、コードブロック ワークフローの設計 これらのエージェントは、以下のような順序で活用することを想定しています：\n1 Content Strategist → Interview Facilitator → Technical Writer → SEO Optimizer → QA → 公開 この一連の流れにより、戦略立案から公開まで一貫した品質の記事を作成できます。\nレビューフィードバックと改善 PR #2 を通じて、いくつかの改善点が指摘されました：\n1. YAML フロントマターのフォーマット 指摘内容： 各エージェントのYAMLフロントマターがmarkdownコードブロック（3つのバッククォート + yaml）で囲まれていましたが、GitHub Copilotのカスタムエージェント仕様では、コードブロックで囲まずに直接YAMLフロントマターを記述する必要があります。\n修正前の形式：\nエージェント定義がコードブロックで囲まれている YAMLフロントマターが認識されない 修正後の形式：\nコードブロックを削除 YAMLフロントマターを直接記述（--- で囲む） GitHub Copilotが正しく認識できる 2. ツール配列の一貫性 指摘内容： Quality Assuranceエージェントのみ ['read', 'edit'] を指定していましたが、他のエージェントは ['read', 'edit', 'search'] を指定していました。品質保証でも検索機能が有用である可能性があります。\n3. コードブロック表記の明確化 指摘内容： Markdown Best Practicesセクションで、コードブロックの例示方法が不明瞭でした。バッククォートをエスケープするか、別の表現方法が必要です。\n学んだこと 1. エージェント定義の重要性 カスタムエージェントを明確に定義することで、各エージェントの役割と責任範囲が明確になります。これにより：\n作業の重複を避けられる 各エージェントが専門性を発揮できる ワークフロー全体が効率化される 2. YAMLフロントマターの仕様理解 GitHub Copilotのカスタムエージェント機能を使用する際は、正しいフォーマットを理解することが重要です。コードブロックで囲むと、エージェントとして認識されません。\n3. 境界線（Boundaries）の設定 各エージェントに「Boundaries」セクションを設けることで：\nやるべきこと・やるべきでないことが明確になる エージェント間の責任分担が明確になる 誤った動作を防げる 例えば、Technical Writerは「Markdownファイルのみを編集し、設定ファイルやコードファイルは変更しない」という境界線を設定しています。\n4. 実例の価値 各エージェントに具体的な出力例を含めることで：\nエージェントの動作が理解しやすくなる 期待される出力形式が明確になる 一貫性のある成果物が得られる プロジェクト固有のガイドライン AGENTS.mdには、プロジェクト固有のガイドラインセクションも追加しました：\nすべての記事をMarkdown形式で保存 記事全体で一貫した構造を維持 インタビューノートと公開コンテンツを分離 ファイル命名規則に従う 出典情報を保持 すべての変更をバージョン管理 これらのガイドラインにより、プロジェクト全体の一貫性を保つことができます。\n実際の記事作成で5つのエージェントはどう働いたか この記事自体が、定義した5つのカスタムエージェントのワークフローを実践する最初の機会となりました。実際の動きを振り返ってみます。\nContent Strategist の働き 実際の動き：\n記事のテーマ決定：「AGENTS.md作成体験」という明確な焦点 読者ターゲット設定：GitHub Copilotとカスタムエージェントに関心がある開発者 記事構成の設計：導入→背景→実践→振り返り→学び→まとめ 気づき： この段階で「実体験に基づくストーリーテリング」という方向性が定まったことで、以降の作業がスムーズになりました。初期の戦略立案が記事全体の質を左右することを実感しました。\nInterview Facilitator の働き 実際の動き：\nPR #2のレビューコメントを「インタビュー素材」として活用 各改善点について深掘り：なぜその指摘があったのか、どう修正すべきか 暗黙知の明示化：フォーマット仕様の理解を言語化 気づき： 従来のインタビューと異なり、今回は「過去の自分との対話」でした。PRレビューというフィードバックループが、インタビューの代わりになることを発見しました。これは「自己インタビュー」という新しいパターンです。\nTechnical Writer の働き 実際の動き：\nMarkdown形式での記事執筆 適切な見出し階層の設定 コードブロックと説明文のバランス調整 日本語での明確な表現 気づき： 執筆中に最も重要だったのは「具体例」の提示でした。抽象的な説明だけでなく、実際のYAMLフォーマットやワークフロー図を示すことで、読者の理解が深まります。今後は例示をより重視すべきです。\nSEO Optimizer の働き 実際の動き：\nタイトル最適化：「GitHub Copilot エージェントパネルでAGENTS.mdを作成した話」 見出しへのキーワード配置：「カスタムエージェント」「YAML」「ワークフロー」 メタディスクリプション：簡潔な体験記の要約 内部リンク：PR #2への参照 気づき： 日本語記事でのSEO最適化は、英語とは異なる配慮が必要です。自然な日本語表現を保ちながらキーワードを配置するバランスが課題でした。\nQuality Assurance の働き 実際の動き：\nコードブロックのフォーマット確認 Markdownシンタックスの検証 リンクの動作確認 文章の一貫性チェック 気づき： コードレビューツールからのフィードバック（エスケープされたバッククォートの問題）により、品質向上につながりました。自動化されたチェックと人間のレビューの組み合わせが効果的です。\nエージェント間の連携で見えた課題 順序の重要性: Content Strategist → Technical Writer の流れは自然でしたが、SEO Optimizerを後回しにしたため、一部タイトルや見出しの修正が必要になりました。SEOの視点を初期段階から意識すべきです。\n反復の必要性: QAのフィードバックを受けてTechnical Writerに戻る必要がありました。一方通行ではなく、循環的なワークフローが現実的です。\nエージェント間の情報共有: 各段階で得られた知見を次のエージェントに引き継ぐ仕組みが重要です。現状は暗黙的ですが、明示的なハンドオフがあるとより良いでしょう。\n実装した改善 この記事作成を通じて、AGENTS.mdの実践的な検証ができました。この学びを基に、AGENTS.mdに以下の改善を実装しました：\nエージェント定義の改善\nSEO Optimizerを初期段階から関与させる反復的ワークフローを追加 QAフィードバックループを明示化した複雑な記事向けワークフロー 日本語コンテンツ向けのローカライゼーションガイドライン追加 Content Strategistにナラティブ開発のガイダンスを追加 Technical Writerに具体例優先の明示的な推奨を追加 Quality Assuranceに\u0026rsquo;search\u0026rsquo;ツールと自動化・人的レビュー組み合わせのガイダンスを追加 新しいパターンの追加\n「自己インタビュー」パターンを文書化（自分の作業について書く場合） PRレビューをインタビュー素材として活用する方法 複数の情報源からのインタビューパターン ワークフローの最適化\n反復的なプロセスを設計（一方通行ではなく循環的） エージェント間の明示的な情報ハンドオフの仕組みをTipsに追加 実践から学んだレッスンのセクションを新設 これらの改善により、AGENTS.mdは単なる定義ドキュメントから、実践に基づいた実用的なガイドへと進化しました。\nまとめ GitHub Copilotのエージェントパネルを使用して、まっさらなリポジトリにAGENTS.mdを作成する体験は非常に有益でした。\n主なポイント：\n✅ 明確な役割分担: 5つの専門エージェントが記事作成ワークフローをカバー\n✅ 構造化されたアプローチ: 戦略立案から公開までの一貫したプロセス\n✅ 実用的なガイドライン: 各エージェントに具体的な責務と境界線を設定\n✅ 継続的な改善: レビューフィードバックを通じた品質向上\nこの取り組みを通じて、GitHub Copilotのカスタムエージェント機能の可能性を実感できました。適切に設計されたエージェントは、チーム全体の生産性と成果物の品質を大きく向上させる可能性を秘めています。\n参考リンク Add AGENTS.md with custom agents for blog article creation workflow by Copilot · Pull Request #2 · nqou-net/article-interviewer Creates AGENTS.md defining 5 specialized GitHub Copilot custom agents for the article-interviewer blog creation … GitHub AGENTS.md AGENTS.md is a simple, open format for guiding coding agents. Think of it as a README for agents. agents.md Custom agents configuration - GitHub Docs Reference for configuring custom agents. GitHub Docs ","date":"2025-11-27T01:43:17+09:00","image":"https://www.nqou.net/public_images/2025/1764175397-image.jpg","permalink":"https://www.nqou.net/2025/11/27/014317/","title":"GitHub Copilot エージェントパネルでAGENTS.mdを作成した話"},{"content":"@nqounetです。\nGitHub Copilot Coding Agent（エージェントパネル）を初めて使ってみました。単純な作業を依頼したつもりが、予想外の方法で解決してくれた体験を紹介します。\nGitHub Copilot Coding Agent とは GitHub Copilot Coding Agent は、GitHub のIssueやPRに対してAIエージェントがコードを書いてくれる機能です。VS Codeで使える GitHub Copilot とは異なり、GitHub上で直接エージェントを呼び出すことができます。\n今回、このブログのMarkdownファイルに残っているHTMLタグをMarkdownに変換する作業を依頼してみました。\n依頼した内容 このブログには過去の記事が870以上あり、その中にはHTMLタグが残っているものがありました。また、全角英数字も散見されたため、以下のプロンプトでエージェントに依頼しました。\nHTML部分をマークダウンに変換してください。全角英数は半角にしてください\nシンプルなプロンプトです。\n予想していた動作 正直なところ、エージェントが各ファイルを開いて手作業で一つ一つ変換してくれるものだと思っていました。868個のファイルを地道に修正していく姿を想像していました。\n実際の結果 ところが、出来上がったPRを見てみると、変換プログラムが作成されていました。\nエージェントは tools/convert_html_to_markdown.pl というPerlスクリプトを作成し、以下の処理を自動化していました。\nHTMLタグからMarkdownへの変換 全角英数字から半角への変換 コードブロック内のHTML保護 やり取りの経緯 最初のPRでは、コードブロック内のHTMLも変換されてしまっていました。プログラムのソースコードとしてHTMLを出力する部分もあったため、以下のコメントをしました。\nマークダウンファイルには、プログラムのソースコードとしてHTMLを出力する部分があります。その部分の変換はしないでください。\nすると、エージェントはスクリプトを修正し、コードブロック内のHTMLは保護するように対応してくれました。\n実際にプログラムを実行してみて エージェントが作成したプログラムを PR #2 で実行してみたところ、blockquote（引用）が変換されていないことに気づきました。\nそこで、HTMLからMarkdownへの変換精度を上げるため、PR #1 に戻って以下のようにお願いしました。\nHTMLからマークダウンに変換する部分は html2markdown を使用するようにしてください。\nエージェントは html-to-markdown というGoのライブラリを使うように変更し、より堅牢な変換処理を実装してくれました。\n最終的には、Copilotが作成した変換プログラムを PR #3 で手動実行しました。\n結果 PR #1 での最終的な結果は以下のとおりです（※PR #1は最終的にマージされていないため、参考値です）。\n処理対象ファイル数: 868ファイル 変更されたファイル数: 695ファイル 追加行数: 7,339行 削除行数: 8,091行 実行後に気がついたのですが、そもそもMarkdownとして書いていた部分が、変換ツールによってHTMLとして解釈されてしまい、意図しない変換が行われた箇所がありました。その部分は諦めて手作業で直しました。\n単純な依頼から始まったのに、エージェントは効率的な解決方法を自ら考えて実装してくれました。ただし、完全に自動化できたわけではなく、最終的には人間の確認と修正が必要でした。\n感想 今回の体験で印象的だったのは、エージェントが「手作業で全ファイルを修正する」という方法ではなく、「変換プログラムを作成して一括処理する」という方法を選んだことです。\nこれは人間のエンジニアでも選択を迷う部分かもしれません。ファイル数が少なければ手作業の方が早いこともありますし、多ければプログラムを書く方が効率的です。868ファイルという数を見て、エージェントは後者を選んだのでしょう。\nまた、コメントでのやり取りも自然で、追加の要望に対して適切に対応してくれました。まるで同僚のエンジニアとやり取りしているような感覚でした。\n参考リンク Convert HTML to Markdown using html-to-markdown tool and normalize full-width alphanumeric characters by Copilot · Pull Request #1 · nqou-net/www.nqou.net Plan: Convert HTML to Markdown and Full-width Characters to Half-width Create a Perl script to convert HTML tags to … GitHub Feature/convert html to markdown by nqounet · Pull Request #2 · nqou-net/www.nqou.net copilot/convert-html-to-markdown で作成されたツールを採用した。 GitHub Feature/convert html to markdown by nqounet · Pull Request #3 · nqou-net/www.nqou.net #1 で作成されたツールを実行。 GitHub ","date":"2025-11-26T04:35:42+09:00","image":"https://www.nqou.net/public_images/Capture-2025-11-26-035053.png?raw=true","permalink":"https://www.nqou.net/2025/11/26/043542/","title":"GitHub Copilot Coding Agent（エージェントパネル）を使ってみた"},{"content":"@nqounetです。\nGitHub Copilot を活用していると、プロジェクト固有の指示をエージェントに伝えたい場面があります。今回は、指示ファイルの配置場所を変更し、VS Code でも正しく動作するようにした作業を紹介します。\n背景 これまで、GitHub Copilot への指示は .github/copilot-instructions.md に記載していました。しかし、2025年8月28日に GitHub は Copilot coding agent now supports AGENTS.md custom instructions を発表し、AGENTS.md がサポートされるようになりました。\nAGENTS.md はリポジトリルートまたはサブディレクトリに配置でき、プロジェクト固有のビルド手順、テスト方法、コーディング規約などを詳細に指定できます。\nそこで、指示ファイルを AGENTS.md に変更することにしました。\n変更内容 1. ファイルのリネーム .github/copilot-instructions.md の内容をリポジトリルートの AGENTS.md に移動しました。内容自体は変更していません。\n1 .github/copilot-instructions.md → AGENTS.md 2. VS Code 設定の追加 AGENTS.md はリポジトリルートに配置すると GitHub Copilot Coding Agent が自動的に認識しますが、VS Code の Copilot Chat でも参照されるように設定を追加しました。\n.vscode/settings.json を新規作成し、以下の設定を追加しました。\n1 2 3 4 5 6 7 { \u0026#34;github.copilot.chat.codeGeneration.instructions\u0026#34;: [ { \u0026#34;file\u0026#34;: \u0026#34;AGENTS.md\u0026#34; } ] } この設定により、VS Code で Copilot Chat を使用する際にも AGENTS.md の内容が参照されるようになります。\nまとめ GitHub Copilot の指示ファイルを AGENTS.md に変更する場合、以下の2点を対応すれば、VS Code でも正しく動作します。\n指示ファイルをリポジトリルートの AGENTS.md に配置する .vscode/settings.json に github.copilot.chat.codeGeneration.instructions 設定を追加する これにより、GitHub Copilot Coding Agent と VS Code Copilot Chat の両方で同じ指示ファイルを参照できるようになります。\n","date":"2025-11-26T01:17:28+09:00","image":"https://www.nqou.net/public_images/2025/1764087448-image.jpg","permalink":"https://www.nqou.net/2025/11/26/011728/","title":"GitHub Copilot の指示ファイルを AGENTS.md に変更する"},{"content":"@nqounetです。\nウイスキーに再入門したのは2017年の10月ごろのことです。それまでも何度もアメリカに渡航していましたが、どちらかといえばビール党でしたので、カジノでも「SAMUEL ADAMS」ばかり飲んでいました。\n蒸留酒への興味 ある時、蒸留酒の方が醸造酒よりも体に良い、という話を聞きかじりました。また、アメリカといえばバーボンが有名ということもあり、せっかくアメリカに行くのであればバーボンを買って帰ろうと思い立ちました。\n最初の1本 まずは1本「JACK DANIEL\u0026rsquo;S SINGLE BARREL SELECT」を買いました。正確にいえばテネシーウイスキーですが、当時はその程度の知識しかありませんでした。\n記録によると値段は$69.99でした。当時、ウイスキーにかけた最高金額です。当時は1ドル115円前後だったので、日本円で約8,000円くらいの買い物でした。\n割と形から入る方で、この時にウイスキーストーン（冷凍して使う氷の代わりになる石）も購入しました。\nストレートで飲んで気づいた香りの良さ 滞在中に飲んだのですが、甘い香りが印象的でした。これまでは、水割りかロックで飲んでばかりでしたが、ストレートで飲んでみたところ、香りの良さに驚きました。\nウイスキーはアルコール感が苦手で、味も正直言ってよく分かりませんでした。しかし、このジャックダニエルのシングルバレルセレクトは、香りが良く、味もまろやかで飲みやすく感じました。\nこの経験がきっかけで、ウイスキーに再入門することになりました。\n今でも手に入りやすい 近年、ウイスキーは価格が高騰していますが、何故か「JACK DANIEL\u0026rsquo;S SINGLE BARREL SELECT」は、Amazonで見ると当時アメリカで買ったよりも安く手に入るようです。\nジャックダニエル シングルバレル 750ml amazon.co.jp もし興味があれば、ぜひ一度試してみてください。ストレートで香りを楽しむのがおすすめです。\n","date":"2025-11-26T00:02:12+09:00","image":"https://www.nqou.net/public_images/P1200958.jpg","permalink":"https://www.nqou.net/2025/11/26/000212/","title":"ウイスキーへの再入門"},{"content":"@nqounetです。\n人生の転機というのは、後から振り返ってみて初めてその重要性に気づくものです。私にとって、2011年5月に不動産会社を退職してIT系フリーランスになったことは、まさにそのような転機でした。\n仕組みへの好奇心 小さな頃から「仕組み」への好奇心が旺盛で、おもちゃを分解して元に戻したり、戻せなかったりして遊んでいました。「仕組み」を知り理解を深めることで、応用も可能になり、また、新しい仕組みを生み出すこともできると考えていました。\nこの好奇心は、やがて実務にも活かされるようになります。建築関係の業務で表計算ソフトで計算書を作成していましたが、清書するのが面倒だったため、個人でデータベースソフトで作成できるようにしたことがありました。とても便利になり効率化が図られるようになったと自負していましたが、残念ながら使い方が難しいという理由で、個人で利用するしかありませんでした。\nこの経験から、機能的なものを作っても扱いが難しいものは使われない、ということを身をもって学びました。これは後のソフトウェア開発における重要な教訓となっています。\n不動産会社からの転身 2011年5月、それまで勤めていた不動産会社を辞めました。当時の決断は、今思えば大きな賭けでした。安定した給与と職場環境を手放して、未知の世界に飛び込むわけですから、不安がなかったと言えば嘘になります。\nしかし、プログラミングという分野に魅了されていた私は、この道を進むことを選びました。複雑な仕組みでも簡単に使える、ということを念頭に置きながら、ソフトウェア開発の世界に挑戦しようと決意したのです。当時はまだ、自分がどこまでやれるのか、本当に食べていけるのか、確信は持てませんでしたが、とにかく挑戦してみようと思ったのです。\n安定するまでの4年間 フリーランスとして活動を始めてから、仕事が安定するまでには約4年の歳月がかかりました。この期間は、正直なところ、決して楽ではありませんでした。\n最初の頃は案件を見つけるのも大変でしたし、技術的なスキルも十分とは言えませんでした。一つ一つの仕事をこなしながら、必死に勉強し、経験を積み重ねていきました。\n新しい技術を学ぶための時間を確保すること クライアントとの信頼関係を築くこと 自分の強みを見つけて伸ばすこと 継続的に案件を獲得するためのネットワークを作ること これらすべてを同時進行で進めていく必要がありました。今振り返ると、この4年間は自分を成長させるための貴重な修行期間だったと思います。\nコミュニティ活動での学び フリーランスとして活動する中で、技術コミュニティとの関わりも大きな意味を持つようになりました。2012年12月から2018年9月まで、PerlのユーザーグループであるKansai.pmの代表として活動しました。\nその間、2017年にはPerlのカンファレンス「YAPC:Kansai 2017 OSAKA」を開催することができました。また、代表としての活動とは別に「Perl入学式」のサポートやミニ勉強会を主催するなど、プログラミング言語初学者の裾野を広げる活動にも力を入れました。\nこれらの活動を通じて、技術を伝えること、コミュニティを育てることの大切さを学びました。自分が学んできたことを次の世代に伝えていくことは、エンジニアとしての重要な役割の一つだと感じています。\n技術と設計への深化 フリーランスとして経験を積む中で、技術的な興味も深まっていきました。最近では、ドメイン駆動設計とクリーンアーキテクチャによる関心の分離の仕組みに感銘を受けました。\nこれらの設計手法は、複雑なシステムを整理し、保守しやすくするための強力な道具です。幼い頃から「仕組み」に興味を持っていた自分にとって、ソフトウェアの構造を理解し、より良い設計を追求することは、自然な流れだったのかもしれません。\n信頼できる取引先との出会い 現在もフリーランスとして活動を続けていますが、運良く信頼していただける取引先に恵まれました。これは本当に幸運なことだと感じています。\nフリーランスとして長く続けられているのは、自分のスキルや努力だけではありません。信頼関係を築いてくださったクライアントの皆様、そして支えてくれた周囲の方々のおかげです。\n技術の世界は日々進化していますが、人と人との信頼関係という基本的な部分は変わりません。これからも、その信頼に応えられるよう、技術を磨き続けていきたいと思います。\nこれから転向を考える方へ もし今、エンジニアへの転向を考えている方がいるなら、一つだけお伝えしたいことがあります。それは、「時間はかかるけれど、継続すれば道は開ける」ということです。\n私の場合は安定するまでに4年かかりましたが、その間も少しずつ前進していたことは確かです。焦らず、諦めず、一歩ずつ進んでいくことが大切だと思います。\n脚注 この記事は、個人的な経験を振り返ったものです。フリーランスとしての働き方や収入の安定性は、個人の状況や時代背景によって大きく異なります。\n","date":"2025-11-25T04:05:18+09:00","image":"https://www.nqou.net/public_images/2025/1764011118-image.jpg","permalink":"https://www.nqou.net/2025/11/25/040518/","title":"エンジニアに転向した日々を振り返る"},{"content":"はじめに プログラミング言語を学ぶ上で、条件分岐における真偽値の扱いは避けて通れない重要なテーマです。Rubyでは、他の多くの言語と比較して非常にシンプルで明快なルールが採用されています。本記事では、Rubyにおけるfalsyな値について、実践的な視点から解説します。\nRubyのfalsyな値とは Rubyにおいて「偽」として扱われる値は、わずか2つしかありません。\nfalse nil これだけです。それ以外のすべての値は「真」として扱われます。この単純さがRubyの大きな特徴の一つです。\n他の言語との違い 多くのプログラミング言語では、falseやnil（null）以外にも、0や空文字列、空配列などがfalsyな値として扱われることがあります。\n例えば、Perlでは以下の値がfalsyです。\nundef（未定義値） 0（数値の0） ''（空文字列） '0'（文字列の0） ()（空のリスト） 余談ですが、Perlでは偽とされる値のリファレンスは、リファレンス自体が定義されている限り真として扱われます。そのため、リファレンスを評価すると常に真になり、値そのものを評価したい場合はデリファレンスして中身を確認するか、明示的な比較を行ってください。例:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Perl の例 my $str = \u0026#39;\u0026#39;; my $ref = \\$str; if ($ref) { print \u0026#34;リファレンスは真です\\n\u0026#34;; } # デリファレンスして中身を真偽評価すると、空文字列は偽になる if ($$ref) { print \u0026#34;デリファレンスした値は真です\\n\u0026#34;; } else { print \u0026#34;デリファレンスした値は偽です（空文字列など）\\n\u0026#34;; } しかし、Rubyでは0も空文字列も、すべて「真」として扱われます。\n1 2 3 4 5 6 7 8 9 if 0 puts \u0026#34;0は真です\u0026#34; end # =\u0026gt; \u0026#34;0は真です\u0026#34;と表示される if \u0026#34;\u0026#34; puts \u0026#34;空文字列も真です\u0026#34; end # =\u0026gt; \u0026#34;空文字列も真です\u0026#34;と表示される この違いは、他の言語から移行してきた場合に混乱しやすいポイントです。\n実践的な使い方 nilチェックの重要性 Rubyでは、存在しない値やメソッドの戻り値がnilになることがよくあります。そのため、条件分岐では明示的にnilをチェックすることが重要です。\n1 2 3 4 5 6 7 user = find_user_by_id(123) if user puts \u0026#34;ユーザーが見つかりました: #{user.name}\u0026#34; else puts \u0026#34;ユーザーが見つかりませんでした\u0026#34; end 空チェックとの違い 値が存在するかどうか（nilかどうか）と、値が空かどうかは別の概念です。\n1 2 3 4 5 6 7 8 9 10 11 str = \u0026#34;\u0026#34; # 値は存在するが空 if str puts \u0026#34;値は存在します（真）\u0026#34; end # 空かどうかをチェックする場合 if str.empty? puts \u0026#34;値は空です\u0026#34; end 配列の場合も同様です。\n1 2 3 4 5 6 7 8 9 10 11 arr = [] # 配列は存在する（真） if arr puts \u0026#34;配列は存在します\u0026#34; end # 空かどうかをチェック if arr.empty? puts \u0026#34;配列は空です\u0026#34; end 各言語での真偽値の違いを理解する 各言語での真偽値の違いを理解することで、言語間での移行やコードレビュー時の理解が深まります。Perlのように0や'0'が偽になる言語から移行した場合、Rubyではこれらが真になることに注意が必要です。\nfalsy値を活用した安全なコーディング ぼっち演算子の活用 Ruby 2.3以降では、ぼっち演算子（\u0026amp;.）を使うことで、nilに対して安全にメソッドを呼び出すことができます。\n1 2 3 4 5 6 user = nil # 従来の方法 name = user ? user.name : nil # ぼっち演算子を使った方法 name = user\u0026amp;.name デフォルト値の設定 ||演算子を使うことで、nilやfalseの場合にデフォルト値を設定できます。\n1 user_name = user\u0026amp;.name || \u0026#34;ゲスト\u0026#34; ただし、falseも偽と扱われるため、boolean値を扱う場合は注意が必要です。\n1 2 3 4 5 flag = false result = flag || true # =\u0026gt; true（初期値をtrueにするつもりだった場合、意図しない結果になる） # nil だけをチェックしたい場合 result = flag.nil? ? true : flag 実務での注意点 型の明示的なチェック 値の存在チェックと型チェックは別物です。実務では、適切な型チェックも重要です。\n1 2 3 4 5 6 7 8 9 10 11 value = 0 # 値が存在するかチェック（0は真） if value puts \u0026#34;値があります\u0026#34; end # 数値かどうかチェック if value.is_a?(Numeric) puts \u0026#34;数値です\u0026#34; end テストでの確認 条件分岐のロジックは、テストでしっかり確認することが重要です。\n1 2 3 4 5 6 7 8 9 10 11 12 # RSpecでの例 describe \u0026#34;ユーザー検索\u0026#34; do it \u0026#34;ユーザーが存在する場合\u0026#34; do user = User.find_by(id: 1) expect(user).not_to be_nil end it \u0026#34;ユーザーが存在しない場合\u0026#34; do user = User.find_by(id: 999999) expect(user).to be_nil end end まとめ Rubyのfalsyな値はfalseとnilの2つだけという、非常にシンプルで明快なルールです。この特徴を理解することで、以下のような利点があります。\n条件分岐のロジックが理解しやすくなる 予期しない動作を防ぐことができる より安全でメンテナンスしやすいコードが書ける ただし、他の言語から移行してきた場合は、0や空文字列が真として扱われることに注意が必要です。また、値の存在チェックと空チェックは別物であることを理解し、適切に使い分けることが重要です。\nRubyのシンプルな真偽値の扱いを正しく理解し、実践的なコーディングに活かしていきましょう。\n","date":"2025-11-21T04:11:43+09:00","image":"https://www.nqou.net/public_images/2025/1763665903-image.jpg","permalink":"https://www.nqou.net/2025/11/21/041143/","title":"Rubyのfalsyな値は2つだけ — シンプルで明快な真偽判定"},{"content":"バイブ・ブロギング — AIプロンプトだけで書くブログ作法 導入 近年、AIを使ってコンテンツを作る場面は当たり前になってきました。実践者が求めるのは、効率よく、再現性を保ちながら、品質を担保して量産できる方法です。本稿では、そのための手法として『バイブ・ブロギング』を紹介します。プロンプト設計と短いフィードバックループを回すことで、最小限の手直しで公開できる記事を生成することを目指します。\nバイブ・ブロギングとは バイブ・ブロギングの肝となるのはプロンプト設計です。AIとのやり取りを小刻みに繰り返す（＝バイブ＝振動）ことで、出力の粗さを素早く潰していきます。プロンプト→生成→評価→再プロンプト、という短いサイクルを回すのが基本です。\n基本フロー（実践者向けに短く）\n目的と読者を明確にする 制約（文字数、トーン、禁止事項）を決める AIに草稿を生成させる 出力をチェックして不足を指示し、再生成する 最終チェック（事実確認・表現の修正）を行い公開する このサイクルをテンプレ化しておくと、チーム運用でも安定します。\n事前準備と守るべきルール 実践する前に、以下の点を必ず押さえてください。\n目的を明確にする 読者像を定義する 制約を固定化する 事実確認を必須とする 透明性を確保する これらは運用ルールとしてドキュメント化し、チェックリスト化しておくと運用が楽になります。\n実践的なテンプレート設計（抽象） 具体的なフレーズはここでは出しませんが、テンプレート化の鍵は「5つの要素」を固めることです。\n目的（この文章で達成したいこと） 読者（スキルレベル・期待値） 構成（見出し構成や各セクションの役割） 制約（文字数、トーン、禁止事項） 検証ポイント（事実確認項目、引用元の有無） プロンプトにはこれらを短い箇条書きで渡すと、安定したアウトプットが得られます。実践では各要素をテンプレート化し、使い回せるようにしてください。\nメリット（実践的視点） 生産性が上がる 再現性がある アイデアの幅が広がる これらは、特にコンテンツ量産やニュース系、How-to系の継続発信に向いています。\n限界と注意点（実務で問題になりやすい点） 精度の問題：AIは時に事実誤認や根拠不明の記述をするので、必ず一次確認を行う 個性の欠落：完全自動化すると著者の独自性が薄れるため、見出しや結論には必ず人間の視点を入れる 法的リスク：引用や著作権に注意する SEO観点：AI生成だけでSEO最適化が完了するわけではない。キーワード、内部リンク、メタ情報は最終調整が必要である 運用の勧めと次の一歩 まずは小さく試してください。週に1記事をバイブ・ブロギングで作り、公開前のチェックリスト（事実確認、引用、倫理、SEO）の実行時間を測るとよいです。運用に乗ったらテンプレートを拡張し、パイプラインを自動化することを検討してください。\n最後に一言：AIは道具です。プロンプトという“設計図”を整えれば、手戻りを少なく質の高い記事を量産できます。常に検証と改善を回す運用を心がけてください。\n注：本記事はAIを補助に用いて作成する手法を解説しています\n脚注\n本記事はバイブ・ブロギングで作成しています ","date":"2025-11-20T03:07:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2025/11/20/030731/","title":"バイブ・ブロギング — AIプロンプトだけで書くブログ作法"},{"content":"今日の成果 最近歩き始めました 最近、妻に付き合って一緒に歩いています。これが意外と楽しく、健康にも良いと実感しています。\n毎日6000歩を目標にしており、少しずつですが達成感を味わっています。この習慣のおかげで、体が軽くなったように感じます。\n半年前は、心肺機能が平均より下だったのですが、少し改善したように思います。健康診断の結果が楽しみです。\n通勤していた頃は自然と歩数が稼げていましたが、今は意識して歩くことで新たな発見があります。\n今の時期は夜でも風がないと少し暑いですが、それでも歩き終わった後の爽快感は格別です。汗をかいた後のシャワーもまた、至福のひとときです。\n（この記事は、原案を私が書いて、AIに少し盛ってもらいました）\n","date":"2025-07-04T00:09:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2025/07/04/000907/","title":"毎日の一歩が未来を変える！健康を実感する習慣"},{"content":"@nqounetです。\n2023年の5月くらいから Github Copilot を使い始めたので、もうすぐ2年になりそうです。\n…もう2年も使っているのに、いまだにうまく使えている気がしない気がしていて勿体無いので、もう少し活用していこうかなと思いました。\n巷では、Cursor というAIに特化したエディタもあるようですが、少し調べると Github Copilot と VSCode の組み合わせでも、ファイルの編集ができるようなので試してみました。\n久しぶりにVSCodeをインストールしてみましたが、色々と操作方法を忘れてしまっていました。直接入力や編集はショートカットが普段使いのエディタと異なるので面倒そうですが、とりあえずお目当ての「Copilotの編集」を試すくらいの気持ちで触ってみます。\nこの手のエディタのメニューは日本語化すると、ウェブで調べる時に色々と見つかりにくくなるので嫌いなのですが、設定を少し探してもわからなかったので日本語のままにしました。\nとりあえずバージョン情報です。\n1 2 3 4 5 6 7 8 9 バージョン: 1.98.2 (Universal) コミット: ddc367ed5c8936efe395cffeec279b04ffd7db78 日付: 2025-03-12T13:32:45.399Z Electron: 34.2.0 ElectronBuildId: 11161602 Chromium: 132.0.6834.196 Node.js: 20.18.2 V8: 13.2.152.36-electron.0 OS: Darwin arm64 24.3.0 ブログの課題 このブログは何度か引っ越しをしていて、HTMLの状態がいくつかのパターンに分かれています。\n現在使っているツールの Hugo では、マークダウンとして書いた場合にHTMLが無視されてしまうようで、一部の記事が表示されていない状態でした。\n該当する記事は10年以上前のものが多いため、あまり気にしないようにしていましたが、Copilot を活用する手始めとして、手作業では面倒なHTMLのマークダウン化を進めてみようと思います。\n結構賢い まずは試しに変換してみました。\n「表示」の「Copilotの編集」を選択すると、私の場合はウィンドウの右側に表示されました。\n選択中のファイルは自動的に対象になっているようなので、変換したいファイルを開いてプロンプトを入力しました。\n1 マークダウン形式に変換して 必要最低限なプロンプトですが、Hugoのポスト用のマークダウンのYAML部分はそのままに、本文のHTMLがマークダウンに変換されていきます。とても賢いです。\n「変換」という感覚からすると速度は遅く感じますが、自分でやるよりもはるかに速いです。変換が終わると、エディタ上に差分が色分けで表示され、何がどう変わったのかを確認できます。\n変換が終わったら「保持」すると変換が適用されます。その状態で「完了」すると「新しい編集セッション」になるようです。\nいくつかファイルを変換していると、誤字を修正しているのも見つけました。すごいです。\n一気に変換は難しそう 画面左の「エクスプローラー」からファイルを選択すると、右クリックのメニューで「Copilot」から「Copilotの編集にファイルを追加する」ことができるので、いくつかファイルを渡して変換してもらいました。\nある程度の枚数まではうまくいきますが、10枚ほどを指定すると、1枚だけを編集して、あとは「指定すれば他のファイルも変換できます」という表示が出て処理が終わってしまいます。\nプロンプトの入力時に「#」を入力すると「コンテキストのアタッチ」ができるようで、そこからフォルダを選択してみましたが、やはり一部だけ処理されて止まってしまいました。\n何かしらやり方はあるのかもしれませんが、とりあえず2,3枚ずつぽちぽち変換しています。\nまだ結構残っています（思った以上に記事が多い）が、Copilotの優秀さはよくわかりました。\nこれが月に10ドル程度で使えると思うと安いですね。最低賃金で人を雇ったとしても1時間ちょっとの作業しかしてもらえない、と考えると、とても人間には敵わない相手ですね。\n荷物整理中にアルバムを見ているような感覚 変換の際についでにサクッと読んでいると、2000年あたりの記事はなかなか恥ずかしいですね。トライアンドエラーを楽しんでいるのは伝わってくるのですが、公開するのを逡巡するくらいです。ソースコードもひどい。\n","date":"2025-03-31T01:22:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2025/03/31/012203/","title":"VSCodeで「Copilotの編集」を試した"},{"content":"@nqounetです。\nコーヒーに目覚めたり、ビールに目覚めたり、ウイスキーに目覚めたり、というのは、人生の楽しみの一つです。\n私がウイスキーに目覚めた（再入門した）のは、2017年の10月ごろです。それまでは「ウイスキーのことをバーボンとも言うのか」と思っていたくらい、ウイスキーについては何も知りませんでした。\nウイスキーは水割りが当たり前で、ロックだと生意気、みたいに言われたりしていた（個人の感想です）のですが、今や、ストレートが当たり前で、ビールの代わりにハイボール、という感じです。\n飲む量と買う量のバランスがおかしくて、気がつくと、部屋がウイスキーだらけになってしまったのですが、そんなこんなで、AMRUT というウイスキーを知りました。\nAmrut Indian Single Malt Whisky - Amrut Distilleries AMRUT は、インドのウイスキーです。 ウイスキーは、気温の低い地域でゆっくりと熟成させるもの、というのが一般的なイメージですが、近年はインドや台湾など、気温の高い地域でもウイスキーが作られています。技術の勝利なんですかね？\nAMRUT は、一般的に想像するウイスキーとは随分とイメージが異なり、ハーブやスパイスの香りが強く、味も独特です。好みもあるとは思いますが、私は好きです。\nAmrut Indian Single Malt Whisky amazon.co.jp ","date":"2024-08-29T23:14:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2024/08/29/231412/","title":"AMRUT というウイスキー"},{"content":"おはようございます。 @nqounet です。\n2023年3月19日に開催された YAPC::Kyoto 2023 に、ボランティアスタッフとして参加してきました。\n応募に至った経緯 久しぶりのオフライン開催だったため、チケットの購入が必要であることを完全に失念しており、後になって気付いたところ、既に完売となっておりました。 困っていたところ、ボランティアスタッフが募集されていることに気がつきました。 そういうわけで、ボランティアスタッフに応募したところ、なんとか採用いただいた、というわけでした。\nYAPC::Kyoto 2023の当日スタッフを募集します！ - YAPC::Japan 運営ブログ 募集記事にも少しは書いていますが、実際の仕事（？）の内容を紹介したいと思います。 仕事（？）の内容としては、前日と当日でいくつか違いがあります。\n前日のお仕事 前日は、ノベルティの準備が主な内容です。 トートバッグに各種ノベルティを入れて、セットにする作業です。 以前は、Tシャツをたたむ、というのがなかなか大変だったように記憶していますが、今回は、畳まれている状態で袋に入っていたので、全体の作業量が減り、かなり早く終わりました。\n当日のお仕事 当日は、会場全体に配置されます。 私の担当は「Gyazoホール by Helpfeel」ということでしたが、集合から担当部屋の設営をし、その後、最初のトラックまでは受付のヘルプとして「Scrapboxホール by Helpfeel」で、来場者への声掛け（どこに並ぶのか、など）をしてました。\n部屋担当のボランティアスタッフとして私がやっていたのは、部屋の設営と撤収、トークの開始時と終了時のドアの開け閉め、質問者へマイクを持っていく、ランチセッションの前後にテーブルの除菌をする、などでした。 今回特に気をつける必要があったのは、感染予防対策として、質問者ごとにマイクの消毒やマイクカバーを取り換える、ということでした。 マスク解禁後とはいえ、気になりますよね。\n部屋担当の仕事としては、他にも、司会進行、タイムキーパーなどもありますが、それらは主にコアスタッフの担当になります。\nもちろん、部屋担当以外にも役目はあるのですが、今回は観測範囲外なので、他の方のブログを探してみるのも良いと思います。\nボランティアスタッフとしての感想 今回は、チケットを購入し忘れたため、代替案としてのボランティアスタッフ参加でしたが、普通に参加するよりも楽しく感じました。 コアスタッフは楽しむどころではなかったかもしれませんが、多少でも力になれたとすれば幸いです。 スタッフ用にSlackのワークスペースがあるのですが、熱量がすごいです。 現在進行形で「ふりかえり」を実施していますが、やり切ったからこそのKPT(Keep, Problem, Try)がたくさん出ています。 次回開催の YAPC::Hiroshima は、今回よりもさらに良いイベントになると確信しています。\nボランティアスタッフのすすめ ぶっちゃけたところ、とってもホワイトな現場です。（※個人の感想です） お給料は出ませんが、チケットは不要（チケット代が浮いた）で、お昼はお弁当が出ます。（お昼代が浮いた） さらに、今回は打ち上げとして、登壇者とスタッフ（ボランティア含む）でディナー会もありました。（飲み代が浮いた） また、スタッフであることがわかるように、スタッフ用のTシャツが配給されます。 さらに、今回はスタッフパーカーも配給されました。（洋服代が浮いた） さらにさらに、余ったノベルティは持って帰ることもできます。 私は一つで十分だったので遠慮しましたが。\nもしも、あなたが少しでも YAPC に興味はあるのであれば、試しにボランティアスタッフとして参加してみる、というのも選択肢に加えてみてください。\nちょっとだけ本編の感想 さて、今回はボランティアスタッフとして参加していたわけですが、メンバーと調整しておけば、見たいトークは遠慮なく見ることができます。 特に部屋担当は余力がある（※個人の感想です）ので、そこそこ自由が効くと思います。\n担当部屋以外のトークでは、昨今のデプロイ事情が気になったので、 デプロイ今昔物語 〜CGIからサーバーレスまで〜 を見に行きました。 CGIと聞くと懐かしさが込み上げてきます。 デモで使っているCGIスクリプトの文字コードがEUC-JPだったのが本格的（？）でした。\n「Gyazoホール by Helpfeel」の撤収がすぐに終わったので、ライトニングトークやキーノートも全編見ることができました。 キーノートは、ジーンと来ました。 「転機」というのは誰にでもあるのかもしれませんが、それからどうするのか、がとても重要なんだなと思います。 私の場合は、Kansai.pmの参加者（モブ）から、コミュニティを引っ張る役目（メインキャラ）を選んだことが大きな転機だったと思います。 そのおかげで、いろいろな方に顔を覚えていただいたり、YAPC::Kansaiが開催できたりしました。 スケールは違いますが、シンパシーを感じました。 会場で聞くことができて本当によかったです。\nまとめ 何度も書いてますが、今回はボランティアスタッフとして参加できて、本当によかったです。 チケットが売り切れになっていた時はどうしようかと思いましたが、ボランティアスタッフとして応募することにして良かったです。 YAPCは、技術カンファレンスという場ですが、Perlという言語を媒介にしたコミュニティでもあるんだろうなと思います。 本当に今回は参加できて良かったです。\n","date":"2023-03-21T13:26:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2023/03/21/132630/","title":"YAPC::Kyoto 2023に行けなかった私がボランティアスタッフになってみた"},{"content":"明けましておめでとうございます。 本年もよろしくお願い申し上げます。\nここ1、2年はあまりアウトプットできていませんが、今年は少しくらいはアウトプットしようと思います。\n","date":"2022-01-01T00:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2022/01/01/000000/","title":"明けましておめでとうございます"},{"content":"@nqounetです。\n（前文）\nもうかなり前ですが、初心者向けにMooを使ったオブジェクト指向プログラミングの記事を書こうとしていて、下書きが残ったままでした。\n今回、サイトジェネレータをHugoに変更しましたが、下書きになっていたものを順次解放していこうと思います。\n（本文）\nPerl鍋やなにわPerlでもそこそこ評判が良かったので、Mooを使ったオブジェクト指向なプログラミングについて書いてみます。\nなお、なるべくシンプルな記述にしたいので、厳密には正しくない事も書いています。\nMooについて深く知りたい方は、原典を見ることをオススメします。\nPerl鍋 なにわPerl Moo blessについて これまでにPerlのオブジェクト指向について学んだ方は、blessすればOK、みたいに覚えている方が多いと思います。\nしかし、改めてPerlでオブジェクト指向プログラミングを楽しむのであれば、blessについては忘れてしまいましょう。\n今は、もっと良い方法があります。\nMooを使ってみる まずは数行のプログラムを書いて動かしてみましょう。\nPerlの実行環境が無い場合は、Perl入学式の資料を見ながら環境構築をしてみましょう。\nhttps://github.com/perl-entrance-org/workshop-2015-01/blob/master/slide.md\nつまづいたらTwitterなどで「#Perl入学式」というハッシュタグを付けてつぶやいてみると、誰かが助けてくれるかもしれません。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 package MyApp { use utf8; use Moo; has hoge =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;); sub show { my $self = shift; print $self-\u0026gt;hoge; } }; my $app = MyApp-\u0026gt;new; $app-\u0026gt;hoge(\u0026#39;ほげ\u0026#39;); $app-\u0026gt;show; 上記のコードを「hoge.pl」として保存してから、ターミナルで以下のように入力し、書いたプログラム（コード）を実行してみましょう。\nコピペでも良いのですが、自分自身の手で書いてみるとより深く理解できると思います。\nまずはコピペで動くのが確認できたら、改めて書いてみて、実行してみてください。\n1 2 cpanm Moo perl hoge.pl 「ほげ」という風に表示されましたか？\nよくわからないかもしれませんが、これがオブジェクト指向の第一歩です。\nまずは用語を覚えましょう オブジェクト指向プログラミングでは、いくつかの専門的な用語を使います。\nまず「オブジェクト」というのは、「属性」と「機能」を持った「まとまり」の事です。\nそして、その「まとまり」は「クラス」で定義します。\n「属性」は、「プロパティ（property）」や「メンバ（member）」「アトリビュート（attribute）」などと呼ばれています。 私は「プロパティ」と呼んでいるので、今後はプロパティと書いていきます。\n「機能」は、「メソッド（method）」と呼ぶことが多いでしょう。\nこれらの用語は、何も考えずにそのまま覚えてしまうほうが良いです。日本語だと用語として覚えにくい場合は、カタカナで覚えてしまいましょう。使っていくうちに自然と理解できるようになります。\n次回は先ほど書いたコードの説明もしてみたいと思います。\nまとめ bless は忘れよう コピペではなく書いて動かしてみよう 用語（オブジェクト、クラス、プロパティ、メソッド）を覚えよう ","date":"2021-10-31T19:10:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2021/10/31/191008/","title":"第1回-Mooで覚えるオブジェクト指向プログラミング"},{"content":"おはようございます。 若林（@nqounet）です。\n少し時間ができたので、Hugoを使ってサイトを作ってみる（というか移行してみる）ことにしました。\n新しいことをやるのは久しぶりな気がします。\nとはいえ、ネタとしてはHexoで使っているマークダウンファイルがあるので、それを使います。\nメタ情報 記事には中身だけではなく、タイトルや作成日、タグなどの情報が必要です。\nマークダウンで書くにしても、こういった情報を書く必要があります。\nHexoでもファイルの最初にメタ情報を書くことができました。\nHugoではこの部分を「Front Matter」と呼ぶみたいです。\n行き着くところは大体同じなのか、ここはYAMLで書けるみたいで、プログラムとも相性が良いです。\n既に存在している情報はほぼそのまま使えるので便利です。\nHexoと大きく異なっていたのは、dateです。\nHugoでは、dateがISO8601で書けるようで、タイムゾーン情報も残しておけます。\n個人的にはこの点だけでも高評価です。最初からHugoにしておけばよかったかも。\n解釈しない項目は、無視されるだけで害がないのも良いですね。\nコンテンツ 記事は中身が大事です。\n記事を何度引っ越ししたか忘れましたが、その時々でフォーマットが少しずつ異なっています。\n前回は、WordPressからHexoにインポートしました。\nその直近の記事は良いのですが、後からよくみると過去にさかのぼれば全部がHTMLで書いてあったり一部がHTMLだったり、改行がなかったり、良く見てみると実は全然移行がうまく行っていませんでした。\nそして、今回、Hugoでは、HTMLで書かれている部分は、ほぼ無視されている感じでした。 特に2000年の記事は、中身がソースコードだけのような状態になっています。\n良く考えると、20年以上前に書いた記事をまだ置いておくか？という気もします。改めて読んでみると中々に赤面するような記事やコードですが。\n今回の移行でエラーになったのは、Shortcodeとして見做された部分でした。\nHexoの時もそうですが、記事に使える便利機能が、ソースコードを書くときには邪魔な感じです。\nとりあえず、思っていたよりは簡単に移行できました。\n途中で一部書き直したりしましたが、中途半端にやったことで後から手間が増えてきたことに気づいたので、一旦白紙に戻し、エラーの部分だけを直しました。\n見えない部分の修正はこれから、というところです。\nデプロイ 最近の機能なのかもしれませんが、Githubでホスティングするときは、リポジトリのgh-pagesブランチだけではなく、任意のブランチを指定することができるようです。\nさらに、ルートディレクトリではなく、docsディレクトリを指定することもできるようです。\nHugoは、通常はpublicディレクトリにファイルを生成しますが、生成先を変更することができるので、docsに指定しました。\nあとは、生成したファイルもリポジトリに追加して、pushすればそのまま公開できます。\nカスタムドメインの指定は、staticにCNAMEを作成すればよいだけでした。（元々カスタムドメインを指定していたためで、最初からやる場合はそれなりの手間はかかります）\n最後にfaviconを忘れていたことに気づいて、たまたまですが、選んだテーマがfavicon.pngに対応していたので、同じくstaticディレクトリにファイルをコピーしました。\nまとめ 実質的な作業量は半日くらいでしたが、その半分近くは記事の修正に失敗した時間なので、思っていたよりは簡単でした。\n特にデプロイ方法が、docsディレクトリに生成すれば良いだけになっていたのはとても便利です。\n公開するファイルも同じリポジトリで管理する、というところに今後どう感じるかわかりませんが、今の時点では、脳内で切り離されているので差分も気になりません。\n少なくともコミットは分けるべきでしょうね。\n参考になる資料 The world’s fastest framework for building websites | Hugo Front Matter | Hugo Shortcodes | Hugo WordPressの記事をHexoにインポートしようとしたが挫折した · nqou.net nqou-net/www.nqou.net: www.nqou.net ","date":"2021-10-30T21:29:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2021/10/30/212934/","title":"Hugoを使ってみることにした"},{"content":"これまでアップデートしてきた結果、時々、コマンドラインツールが無い、とか言われるようになったのですが、その生活ともオサラバです。\n新しいマシンでこれまでどおりのことをするのは、簡単になったとはいえ、それなりに面倒なものです。 それはそれで楽しみもあるので良いのですが。\nただ、困ったことに、このブログを作っているリポジトリをインストールすることが出来ない事がわかりました。 正確に言うと、このブログを書いているリポジトリで npm install がエラーで止まってしまうので、このサイトを編集したりすることができなくなる、ということがわかりました。\nNode も 14.16.1 で固定して使用していたのですが、それも新しいマシンには入らず。（インストール中に画面が止まって、しばらく待ちましたが進捗がないので諦めました）\n色々とありましたが、それなりに快適だったのでちょっと残念です。 何かしら移行手段を考えないとなぁ、という感じです。\n","date":"2021-10-29T09:28:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2021/10/29/092826/","title":"新しい MacBook Pro を買った"},{"content":"最近 Kotlin を勉強し始めた。 なかなか刺激になったので、久しぶりに何か書こうと思ったら、 2020-03-18 くらいに何かを書こうとしていたらしい。\n新型コロナの影響で出張もできなかったので、暇つぶし的に heroku を使っていたら何か思ったのでしょう。 なにかに使えるかもしれないのでそのまま残しておきます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 → mojo version CORE Perl (v5.30.2, darwin) Mojolicious (8.34, Supervillain) OPTIONAL Cpanel::JSON::XS 4.09+ (4.19) EV 4.0+ (4.32) IO::Socket::Socks 0.64+ (0.74) IO::Socket::SSL 2.009+ (2.067) Net::DNS::Native 0.15+ (0.22) Role::Tiny 2.000001+ (2.001004) Future::AsyncAwait 0.36+ (0.37) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 → docker version Client: Docker Engine - Community Version: 19.03.5 API version: 1.40 Go version: go1.12.12 Git commit: 633a0ea Built: Wed Nov 13 07:22:34 2019 OS/Arch: darwin/amd64 Experimental: false Server: Docker Engine - Community Engine: Version: 19.03.5 API version: 1.40 (minimum version 1.12) Go version: go1.12.12 Git commit: 633a0ea Built: Wed Nov 13 07:29:19 2019 OS/Arch: linux/amd64 Experimental: false containerd: Version: v1.2.10 GitCommit: b34a5c8af56e510852c35414db4c1f4fa6172339 runc: Version: 1.0.0-rc8+dev GitCommit: 3e425f80a8c931f88e6d94a8c831b9d5aa481657 docker-init: Version: 0.18.0 GitCommit: fec3683 1 2 → heroku version heroku/7.39.0 darwin-x64 node-v12.13.0 1 2 3 4 5 → heroku login heroku: Press any key to open up the browser to login or q to exit: Opening browser to https://cli-auth.heroku.com/auth/... Logging in... done Logged in as nobu@nishimiyahara.net 1 2 3 4 5 6 7 8 9 10 11 12 13 14 → heroku help container Use containers to build and deploy Heroku apps USAGE $ heroku container COMMANDS container:login log in to Heroku Container Registry container:logout log out from Heroku Container Registry container:pull pulls an image from an app\u0026#39;s process type container:push builds, then pushes Docker images to deploy your Heroku app container:release Releases previously pushed Docker images to your Heroku app container:rm remove the process type from your app container:run builds, then runs the docker image locally ","date":"2020-09-09T08:42:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2020/09/09/084205/","title":"何か書こうとしていた"},{"content":"過去の記事を整理していたら懐かしいものを見つけた。\n翻訳対決 - nqou.net Sign up for a free membership to MindMeister to manage and share your mind maps online and hold online real-time brainstorming sessions with friends and colleagues.\n最近は、 Google 翻訳しか使っていなかったので、同じものを翻訳してみました。\nGoogle 翻訳 MindMeisterの無料メンバーシップにサインアップして、オンラインでマインドマップを管理および共有し、友人や同僚とオンラインでリアルタイムのブレーンストーミングセッションを開催します。\nなんだか、カタカナの固有名詞が増えたような気がする。\n12年前は文字だけだったけど、今は音声でも翻訳がリアルタイムでできるようになっている。\n技術の進歩で言語の壁がなくなっていくのは良いですね。\n","date":"2020-03-09T01:54:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2020/03/09/015441/","title":"続・翻訳対決"},{"content":"事の起こり 実は半年ほど前に書こうと思っていたことなのですが。\nお名前.com で「メール転送サービス」が有料化になったんですよね。\n従来、ご利用料金を無料にてご提供させていただいておりました「お名前.com 転送Plus（メール転送設定/URL転送設定）」について、 サービス品質向上のため、新機能追加及び環境改善対応とともに有料化させていただくこととなりました。\nお名前.com Navi\n1ドメインごとに100円/月という設定も、利便性を考えれば安いとは思うのですが、ドメインをいくつも持っていると流石に堪えるなぁと。 しかも、ドメインあたりに精々1つか2つくらいの指定であればなおさらです。\nそこで、似たようなサービスがないだろうかとダメ元で検索してみたんですよ。 そしたら、やっぱりあったんですよ。\n無料メールサーバ Tagirl - 独自ドメインOK。アカウント数・ドメイン数無制限 -無料メールサーバ Tagirl | 独自ドメイン利用可能\n設定も簡単です。 詳しい使い方は about を見てください。\nTagirlとは | 無料メールサーバTagirl 独自ドメインでのメール受信だけならこれだけでもOKって感じです。\n送信もしたい場合は、 gmail 側で設定すれば良さそうです。\nHGoogleの無料SMTPサーバーを利用してメールを送信する方法について 私は、最近はそういうのが面倒になったので、送るときは gmail のまま送ってます。\n","date":"2020-03-05T01:25:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2020/03/05/012516/","title":"独自ドメインのメールを gmail に転送する方法"},{"content":"Date::Japanese::Era というとても便利な Perl のモジュールがあります。\n和暦をいい感じに扱うモジュールです。\nもちろん「令和」にも対応しています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/usr/bin/env perl use utf8; use strict; use warnings; use Data::Printer {deparse =\u0026gt; 1, caller_info =\u0026gt; 1}; use Date::Japanese::Era; { my $era = Date::Japanese::Era-\u0026gt;new(2019, 5, 1); p $era-\u0026gt;name; p $era-\u0026gt;year; } { my $era = Date::Japanese::Era-\u0026gt;new(2019, 4, 30); p $era-\u0026gt;name; p $era-\u0026gt;year; } { my $era = Date::Japanese::Era-\u0026gt;new(\u0026#34;令和\u0026#34;, 1); p $era-\u0026gt;gregorian_year; } このモジュールですが、「令和」への対応は 2019-03-31 に発表されています。\n…PDT（アメリカ太平洋夏時間）ですが。\nChanges - metacpan.org ","date":"2019-05-14T01:54:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2019/05/14/015421/","title":"Perl の「令和」への対応"},{"content":"キッカソンの時に話題になっていた、Perl入学式in東京のピザ会でのお題の過去問があったので解いてみました。\nPerl入学式 2018 in東京 秋開講 第1回 お疲れ様でした - sironekotoroの日記 ソースコードにある問題文だけを見て書いていたので、「ルーレットを3回まわし」の部分がすっかり抜けていました。\nなので決着がつくまで回すとどうなるか、というような勝負になっています。\n勝率が6倍くらい、という話だったのでは、と思って気づいた感じです。\n手元で試すと勝数も倍率も結構ばらつきがありました。 決着がつくまでやるとせいぜい3倍くらい。\nこっちは何度試してもだいたい同じくらいでした。\n（なお、「ルーレットを3回まわし」の勝負にする場合は、44行目の while (1) を for my $i (1 .. 3) に変更すれば動きます（試してみたので54行目に draw が書いてあります（消し忘れ））\nリファレンス不使用縛りがあると書ける気がしないのでそっちはやりません。\nただ、対戦人数を増やすのも割と簡単に対応できる柔軟性のあるコードになっていると思います。\n「ルーレットを3回まわし」の場合は、人数を増やしても勝つ回数にはほとんど影響しない、というのも面白いですね。\nルーレットを回す回数を倍の6回にするとどうなるのか？\nとかいろいろと数値を変えて試してみたくなりますね。\nこの問題も、最初は簡単そうに思ったのですがやってみると結構難しいですね。\n同じ数字をどうやって消し込んでいくか、ちょっと考えてしまいました。\n","date":"2019-02-17T19:29:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2019/02/17/192908/","title":"「Perl入学式 2018 in東京 秋開講 第1回 ピザ会でのお題」を解いてみた"},{"content":"先週土曜日（もう一週間も経ってしまった。。。）から一泊二日で「Perl入学式の修学旅行」という別名を持つ「キッカソン」へ行ってきました。\nイベント自体は第3回ということですが、私は今回が初参加です。\nじわじわ集まるのかと思っていたら、皆さん意外と到着していて驚きました（失礼）\nハッカソンは、広間でワイワイとやってました。\nあっちこっちで色んな話が飛び交っているのをなんとなく聞いていると、時々興味ある話が出ていたりするのでちゃっかりメモしたりしました。\n私はというと、数年前に Resque というモジュールを使って書いたジョブキューのサンプルプログラムがあったのですが、これを Docker を使った実装に変更するのをやってました。\n数年前のプログラムでは、 Proclet と Test::RedisServer を使って動かしていたのですが、コンテナを使った実装に変更したいなと。\n本当のことを言うと、 Perl の自動テストで Test::Mysqld を使用しているのをコンテナを使ったテストに書き換えたい、と思っていたのです。\nこの話は、 YAPC::Tokyo で @onk さんがチラッと話していたと思うのですが、開発中は DB のコンテナを使うのに、自動テストの時はアプリのコンテナを使っているのが微妙だな、という話です。\nそれがなければアプリのコンテナサイズも少しは小さくなるのかなと（副産物的な話ですが）。\n実は memcached や Elasticsearch でも同じ問題があったのですが、この時はかなりのサイズダウンができたんですよね。\n確か対策前はコンテナサイズが 2GB 近くあった気がします。\n今は 1GB ちょっとになっています。\nキッカソンの唯一の問題だったのは、ネットワーク環境です。\n元々 Wi-Fi はないという話だったので通信自体はテザリングで問題ないのですが、 Docker のイメージを扱うのは時間がかかりました。。。\nかつ、ダウンロードが途中で止まってしまうことも多かったので、比較的軽量な redis:alpine のイメージを使ってできることをやっていた感じです。\n成果物はこちら。\nnqounet/try-p5-resque: use Resque; 新たに書く docker-compose の設定ファイルは version: \u0026quot;3\u0026quot; で書くようにしているのですが、起動するコンテナの数を指定をすると docker-compose では指定が無視されてしまう。\nCompose file reference | Docker Docs docker stack deploy | Docker Docs 手軽さを求めて docker-compose を使っているのもあって、今のところはミスマッチ感があるな。。。ということで、起動時にコンテナの数をオプションとして指定するようにしました。\n1 $ docker-compose up --build --scale worker=4 なお、 nginx の設定も書いていますが、今回は無関係です。\n気がつけば晩ごはん。\n広い場所で贅沢な晩ごはんでした。\nそれから夜遅くまで雑談からPerl入学式の運営から技術的な話まで、いろいろと話しました。\nここから寝るまでコードは一切書いていません。\nハッカソンというだけでなく、Perl入学式のサポーターが集まっている場でもあるので、今後の方針や地域ごとの問題などについても話し合い、より良い運営を目指して議論しました。\n私は残念ながら途中で退席しました。\n気がつけば朝ごはん。\n朝ごはんが終わったあと、部屋に戻って帰り支度というか、荷物を持って広間へ。\n2日目開始です。\nこの時に @tomcha_ さんに Kansai.pm を託しました。\nKansai.pm はメーリングリストが主体のゆるいコミュニティでしたが、いざ中心になって活動しようとするといろいろとわからないことが多くて大変でした。\n今後はそうならないように、と思っていろいろと画策していましたが、それでも引き継ぐ内容は多くてやっぱり大変でした。\n引き継いだその場で、早速 connpass のページを作ってました。\nKansai Perl Mongers - connpass 今後とも、 Kansai.pm をよろしくお願い申し上げます。\n私も遠くから応援しています。\nさて、実は上着を部屋に忘れてました。\n室内が暖かくてすっかり忘れていました。\n私は京都観光もそこそこに、頼まれていたお土産を買って帰路につきました。\n","date":"2019-02-16T17:21:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2019/02/16/172105/","title":"キッカソン #3 に参加してきました"},{"content":"2019年1月26日に開催された「YAPC::Tokyo 2019」で、「YAPC座談会」に YAPC::Kansai の実行委員長として呼ばれたので、舞い上がって行ってきました。\nYAPC座談会 は、これまでの YAPC::Japan を開催した4箇所の実行委員長が一堂に会してあれこれ語る形式で行われました。\n会場で簡単に打ち合わせしていた時に、技術系の話ではないのでそんなに来ないのでは、という話もあって安心していたのですが、フタを開けると意外と（失礼）多く来てくださっていたので、急に緊張し始めたのを覚えています。\n特に最初の方は、自分の喋る番になると急に話したかったことがどこかに消えてしまって、自分でも何を言っているのか分からない状態になってました。\nお恥ずかしい。\n座談会の様子を似顔絵付きでまとめてツイートしてくれた方がいましたので貼っておきます。\nテーマのスライドはありましたが、話す内容についてはほぼその場の雰囲気でモデレータの馮さんに頼り切っている感じだったので、こういったメモは本当に嬉しいですね。\n座談会が始まる前に、モデレータの馮さんが「40分はあっという間」という事を言っていたのですが、本当にそのとおりでした。\nいろいろと用意したものは頭から消えてしまったものの、その場で思い出したりしたことを話していると気がついたら5分前でした。\n1つだけ印象に残っているのは、事前準備の時にタイムキーパー用のベルが用意されていたのを確認し、アナログだな〜といじることを予告していて、最後にそこをちゃんといじったところです。\n（そしてそのタイミングで5分前のベルでした）\nYAPC::Kansai の時は部屋の番長をしていたのですが、その時は「座長の友」というアプリを使ってタイムキーパーがとても楽になっていたので、そういうアプリは絶対に使ったほうが良いと思います。\nzjs HTML5で学会タイマー - Ichiro Maruta Homepage YAPCは作れる 座談会の予習として、前夜祭から帰った後と当日の朝に、開催した後のアンケートを見返したりしていました。 また、改めてスタッフ用のマニュアルや資料などを見返していたのですが、本当によくできています。\nYAPC::Hokkaidoのつくりかた #yapcjapan - たまめも(tech) 上の記事の中で「持続可能なカンファレンス」という項があるのですが、 YAPC::Japan は持続可能なカンファレンスであると思います。\nスタッフ向けのマニュアルも良くできているし、何より JPA の方々のサポートが厚いです。\nYAPC::Japan を開催したいという熱い想い（と何人かの仲間）があれば（いれば）開催できると思います。\nKansai.pm と YAPC と私 本当は座談会でも話したかったことなのですが、 Kansai.pm はもともとゆるいコミュニティで、代表という立場の人は不在で、開催したい人がメーリングリストで声掛けをして開催するスタンスで動いていました。（とはいえ、よく動いているメンバー（中心人物）はいました）\n2011年に私がIT業界に転向してフリーランスになって、これから Kansai.pm にも参加していこう、と思っていた矢先に、これまで中心で活動していた方が東京へ行ってしまいました。\nこの時の Kansai.pm には日程が合わず参加できなかったのが本当に残念でした。\nで、その後、 JPA 経由でスピーカー派遣の話があり、その話を受ける人が居なかったので、私が代表というかリーダーとして活動していくことになりました。\n本当に何も知らないで勝手にリーダーになったので、いろいろなことをメーリングリストで訊いたりして活動していました。\nその間に、 Kansai.pm のウェブサイトを github でホスティングするようにしたりしました。\nそして今、私が関西を飛び出して石川県に引っ越してしまったので、ちゃんと引き継ぎをしたいところです。\n持続可能なコミュニティ 一人の人間がコミュニティを継続するのはとても大変なので「持続可能なコミュニティ」を作ることも考えていきたいと思っていました。\n究極を言えば、誰にでも Kansai.pm のリーダーができるような仕組みを作る、ということです。\n必要な情報は然るべきところにまとめておくとか。公開できない情報ってそんなにないと思いますので、 github にリポジトリを作っておけば良さそうな気がします。\nウェブサイトは github でホスティングしておけば、おそらく誰かが更新できるでしょう。\nサイトのジェネレータも Perl 製ですし、簡単ですが説明も書いてあります。\nメーリングリストも、 google グループならば誰かが扱うことができると思います。\n…これに関しては実際にはうまくいってないかもしれません。\nKansai.pm の情報拠点は github にあります。\n興味のある方は以下のリンクをポチッとな。\nkansai.pm まとめ まとまりませんが、 YAPC に参加するとこれまでの Perl のコミュニティ活動に紐付いた記憶がどんどん蘇ってきて熱くなってきます。\nYAPC::Japan が持続可能なカンファレンスなら、 Kansai.pm は持続可能なコミュニティを目指して今後もサポートしていきたいと思います。\n","date":"2019-01-30T03:08:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2019/01/30/030850/","title":"「YAPC::Tokyo 2019」に呼ばれたので行ってきました"},{"content":"久しぶりに Heroku に push すると警告が出た。\n1 2 3 4 5 6 7 $ heroku container:push web === Building web (/Users/nobu/local/src/github.com/nqounet/heroku-enigmatic-castle-35725/Dockerfile) Sending build context to Docker daemon 53.76kB ...（中略） Your image has been successfully pushed. You can now release it with the \u0026#39;container:release\u0026#39; command. ▸ heroku container:push no longer creates a release. ▸ Run heroku container:release to create a release with this image. 今後は以下のようにするらしい。\n1 $ heroku container:release web 意味的に、「リリース」のほうがしっくり来る、という話なのかな。\nコンテナ周辺はまだ過渡期ってことだろうと思うので仕方ないですね。\n","date":"2018-06-12T11:52:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2018/06/12/115234/","title":"heroku の container:push が非推奨になっていた"},{"content":"Mac に入っている docker を stable から edge に変えたところ、以前は build できていたはずの Dockerfile が build に失敗するようになった。\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ docker-compose build Building webapp Step 1/9 : FROM perl:latest ---\u0026gt; dbada67dc42d Step 2/9 : RUN useradd -m -s /bin/bash appuser \u0026amp;\u0026amp; cpanm Carmel --notest ---\u0026gt; Using cache ---\u0026gt; 6f9065cda747 Step 3/9 : USER appuser ---\u0026gt; Using cache ---\u0026gt; c68da1175f01 Step 4/9 : RUN mkdir -p ~/webapp ---\u0026gt; Running in ec4f449376a8 ERROR: Service \u0026#39;webapp\u0026#39; failed to build: OCI runtime create failed: container_linux.go:348: starting container process caused \u0026#34;chdir to cwd (\\\u0026#34;/root\\\u0026#34;) set in config.json failed: permission denied\u0026#34;: unknown たまたまタイミングがそうだっただけで、実際には正しくない書き方だったのかもしれないと思って、より堅実そうな書き方に変更した。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 FROM perl:latest RUN useradd -m -s /bin/bash appuser \\ \u0026amp;\u0026amp; cpanm Carmel --notest WORKDIR /home/appuser/webapp RUN chown appuser:appuser /home/appuser/webapp USER appuser COPY --chown=appuser:appuser webapp/cpanfile . RUN carmel install COPY --chown=appuser:appuser webapp . CMD carmel exec -- ./myapp.pl daemon -l http://0.0.0.0:$PORT 変更したのはディレクトリを作成する部分。 以前は appuser に切り替えてディレクトリを作成していたけど、そこがエラーになっていた。\nなので、ディレクトリを作ったあと chown で所有者を変更することにした。 結果として同じ状態にはなるので問題ないと思います。\n参考 DockerでHerokuでMojoliciousが動いたぞ!!!（改定版） | nqou.net ","date":"2018-06-12T11:02:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2018/06/12/110204/","title":"以前は動いていた Dockerfile で permission denied が出るようになった話"},{"content":"すごい話だと思うのですが、カスタムドメインでも https で公開することができるようになりました。\nCustom domains on GitHub Pages gain support for HTTPS | The GitHub Blog 強制的に https しか使用しないようにすることも可能なので、このサイトはそのようにしました。\n以下のような http のリンクから飛んでも https にリダイレクトされます。\nhttp://www.nqou.net 利点があるかどうかについては未知数です。\n","date":"2018-05-08T03:04:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2018/05/08/030426/","title":"github がカスタムドメインでも勝手に https に対応していた"},{"content":"Path::Tiny 祭り Path::Tiny を使い始めてから、以前 Path::Class を使って書いていたものを書き直したい衝動といつも戦っています。\ntouchpath というのを知った つい最近まで知らなかったのですが、ファイルを作る時にディレクトリがない場合に自動的に作成するメソッドがありました。 というか、これまでは当たり前のようにディレクトリを作成してからファイルを作成していたのですが。\n1 2 3 my $path = path(\u0026#39;var/foo/bar.txt\u0026#39;); $path-\u0026gt;parent-\u0026gt;mkpath; $path-\u0026gt;touch; 実は以下のようにできるのです。\n1 2 my $path = path(\u0026#39;var/foo/bar.txt\u0026#39;); $path-\u0026gt;touchpath; とっても便利。\nプログラムが作るファイルの置き場所 さて、プログラムが作るファイルはなるべく同じところに集めておきたいので、プロジェクトルートに var というディレクトリを作っておいてその中で各種ファイルを作成するようにしています。\n予め var というディレクトリを作っておいて、 .gitkeep などのファイルを作成してリポジトリに登録しておきます。 かつ、そのディレクトリの中は git では管理しないように .gitignore に除外ディレクトリとして追加しておくのが定番です。\n実際にプログラムを作成し始めて var/foo/bar.txt というようなファイルを作成しようとすると、 foo ディレクトリがない場合に例外になってしまいます。\nわかっていてもうっかりやってしまうので、 touchpath だとこういうときには便利ですね。\n","date":"2018-05-08T02:56:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2018/05/08/025636/","title":"Path::Tiny を使っている時にディレクトリを自動的に作る"},{"content":"新年 あけましておめでとうございます 2018 年もよろしくお願い申し上げます。\n今だからこそ振り返る 2017 年を振り返る間もなく 2018 年に突入してしまいました。\nしかし、 2018 年に同じことを繰り返さないように一つだけ振り返ろうと思います。\nこれは、 2016 年から 2017 年にかけてじわりじわりと痛手を負ってきたことです。\nGET した時、作成されていなかった場合に作成する、という悪手 前提として、稼働中のサービスだった場合、長時間サービスを止めるのはできるだけ避けたい。\nしかし、既存のデータを一度に変換すると、かなり時間がかかることがわかっています。\nということで、この時はサービスを動かしながら、アクセス（ HTTP でいう GET ）された時、データが変換されていなかったら変換して使用するようにしよう、と考えました。\nコードを書いて、テストも書いて、変換されている状態でも変換されていない状態でも、正しく動作することを確認しました。\n……\n結果はどうだったでしょうか。\n実際の動作では、変換したデータがいくつも出来てしまい、異常な状態になってしまいました。\n何がいけなかったのか 落ち着いて考えてみれば、排他制御が出来ていなかった、ということが言えると思います。\nデータの変換はデータの更新である、という意識が抜けていて、排他制御の必要性に気づいていませんでした。\nそれ以前に、 GET の操作に副作用（データを追加したり更新したりする）があってはいけない、という基本を疎かにしていました。\n2018 年は基本を疎かにせずにプログラミングに勤しみたいと思います。\nRESTful Web サービスの基本 ","date":"2018-01-03T11:30:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2018/01/03/113012/","title":"HTTP の GET の時に、 DB が更新されるのは悪手である"},{"content":"（追記）\nこの記事で書いていた Dockerfile が動かなくなっていたので動くように修正した記事を書きました。\n以前は動いていた Dockerfile で permission denied が出るようになった話 | nqou.net （追記ここまで）\nこの記事は、 Perl Advent Calendar 2017 の 13 日目の記事です。\n昨日は sago35 さんの 「Strawberry Perl に Minilla をインストールする」でした。\nこの記事のパッチがあたって、 CPAN からインストールできるようになったようです。\nこれで、 Windows + Strawberry Perl な方も安心して使えますね。\nMinilla - CPAN module authoring tool - metacpan.org ちょっとしたものを作り始める時でも Minilla で雛形を作ってから始めると色々と便利ですよね。\n最近はあまり使っていなかったので、この機会にまた使い始めようと思います。\nDocker で動いている Perl で作ったアプリを Heroku で公開する 実は少し前に「DockerでHerokuでMojoliciousが動いたぞ!!! 」というのを書いてしまっていて、これを少し改善してアドベントカレンダーのネタにしようと思います。\nHeroku で Perl のプログラムを動かすには buildpack を使えばよいのですが、少しコツがいるのです。\nしかし、2年ほど前から Heroku でもコンテナを動かすことができるようになっており、最近ではインターフェイスも改善されていて、比較的簡単に公開できるようになっています。\nなので、コンテナを使って Perl のアプリを作って、それを Heroku で公開する、というのが今後しばらくは良さそうかなと思います。\nHeroku をコマンドラインインターフェイスで操作する さて、 heroku を使う時はコマンドラインツールを使うと便利です。\nMac な方は Homebrew を使って brew install heroku が手軽だと思います。\nWindows な方にも用意されているようなので使ってみてください。私は使ったことがないので使用感についてはわかりません。\n基本的な使い方はググれば色々と出てくると思いますので省略します。幾つか丁寧そうな記事を貼っておきます。\nHeroku初心者がHello, Herokuをしてみる - Qiita コマンドでHerokuを操作する Heroku CLI のインストール - ゼロからはじめるWEBプログラミング入門 事前の準備 一つのプロジェクトを作るところをイメージしながら進めていきます。\nソースコードは git で管理することにします。\nまずは、プロジェクトのディレクトリを作成しましょう。\nまた、 Heroku では現在は Volume をマウントする方式には対応していないので、 COPY コマンドを使います。細かい説明は省きますが、 COPY する必要があるファイルだけをまとめておくと便利だと思います。\nここでは、 COPY するファイル群を webapp というディレクトリに入れておくことにします。\nでは、ターミナルを操作していきます。\n1 2 3 $ mkdir myproject \u0026amp;\u0026amp; cd myproject $ git init $ mkdir webapp \u0026amp;\u0026amp; cd webapp ひとまずコレで準備は完了です。\nMojolicious さて、次は Perl のアプリを書いていきます。 特にこだわりがなければ、 Mojolicious を使っていくと良いと思います。\n必要に応じて Perl や Mojolicious をインストールしておいてください。\n資料としてはPerl入学式の資料が秀逸です。\nMojolicious については第5回に掲載されています。\nperl-entrance-org/workshop-2017 Mojolicious のバージョンについては以下のもので動作を確認しています。\n1 2 3 4 5 6 7 8 9 10 11 $ mojo version CORE Perl (v5.26.1, darwin) Mojolicious (7.58, Doughnut) OPTIONAL EV 4.0+ (4.22) IO::Socket::Socks 0.64+ (0.74) IO::Socket::SSL 1.94+ (2.052) Net::DNS::Native 0.15+ (0.15) Role::Tiny 2.000001+ (2.000006) 説明を簡単にするためにここでは Mojolicious::Lite の方を使っていきます。\nコマンドを使って雛形を作っておきます。\n1 $ mojo generate lite_app myapp.pl とりあえず、これでアプリを書いたことにします。 動作するか確認してみましょう。\n1 2 $ morbo myapp.pl Server available at http://127.0.0.1:3000 この状態でブラウザで http://127.0.0.1:3000 にアクセスして Welcome to the Mojolicious real-time web framework! という画面が表示されれば成功です。\nターミナルに戻って、 ctrl + c でアプリを止めておきます。\n手元では Mojolicious が入っているので動作しますが、コンテナには入っていません。\n動作に必要な Module は cpanfile に記述しておくことで、コンテナを作成する時に自動的にインストールされるような仕組みをあとで作成します。\nなので、 cpanfile という名前のファイルを作成し、必要なモジュールを書いておきます。\n今回は簡素化のためコマンドで作ります。\n1 $ echo \u0026#34;requires \u0026#39;Mojolicious\u0026#39;;\u0026#34; \u0026gt; cpanfile 一旦、プロジェクトのディレクトリに戻って現在の状態を確認します。\n1 2 3 4 5 6 $ cd .. $ tree . . └── webapp ├── cpanfile └── myapp.pl Docker 次は Docker で動かせるように Dockerfile を作っていきます。\nDocker のインストールなどは完了しているものとします。\n資料としては、公式の日本語サイトがあるのでそちらをご覧ください。\nGet Docker - Docker を手に入れる — Docker-docs-ja 17.06.Beta ドキュメント Docker のバージョンについては以下のもので動作を確認しています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ docker version Client: Version: 17.09.1-ce API version: 1.32 Go version: go1.8.3 Git commit: 19e2cf6 Built: Thu Dec 7 22:22:25 2017 OS/Arch: darwin/amd64 Server: Version: 17.09.1-ce API version: 1.32 (minimum version 1.12) Go version: go1.8.3 Git commit: 19e2cf6 Built: Thu Dec 7 22:28:28 2017 OS/Arch: linux/amd64 Experimental: true 元になるイメージですが、特にこだわりがなければ公式の Perl のイメージを使うと良いと思います。\nタグを指定すると、特定のバージョンの Perl が使用できるのでバージョンを固定するのも簡単です。\nperl Tags | Docker Hub ここでは、現在の最新の安定版である 5.26.1 のイメージを使用します。\nプロジェクトのルートディレクトリに、以下のような Dockerfile を作成します。\n基本的な方針としては、 Carmel を使用してモジュールのインストールを行い、 Mojolicious の機能でアプリサーバーを起動します。\nWORKDIR の前に RUN mkdir しているのは、 WORKDIR の場合、 root ユーザーで webapp ディレクトリが作成されてしまい、その後の RUN carmel install が失敗してしまうためです。なので、事前に appuser でディレクトリを作成し、そのディレクトリを作業ディレクトリに指定しています。\nなお、 root ユーザーで実行しないのはセキュリティの観点からです。やっておいて損はないと思います。\nDockerコンテナを本番環境で使うためのセキュリティ設定 - Qiita 最後の CMD は、 Heroku で動かすための設定です。この挙動は省略時に使用されるので、 docker run の時に実行するコマンドを指定すれば、この行は使用されません。\nとはいえ、毎回書くのはだるいので、 docker-compose を使用して手軽に起動できるようにしておくと便利だと思います。\n使用するコンテナが一つでも起動が簡単になるので、使えるものは使っていくのが良いと思います。\nでは、 docker-compose を使用するため、プロジェクトのルートディレクトリに docker-compose.yml を作成します。\n1 2 3 4 5 6 7 version: \u0026#34;3\u0026#34; services: webapp: build: . command: carmel exec -- morbo myapp.pl ports: - 3000:3000 動作するか確認してみましょう。 プロジェクトのルートディレクトリにいることを確認して、以下のように実行してください。\nなお、実行すると 300MB 以上あるイメージファイルをダウンロードしてくるので、ちゃんとしたネットワーク環境で実行することをオススメします。\n1 $ docker-compose up --build しばらく待っていると以下のような表示が出て画面の動きが止まります。\n1 2 Attaching to myproject_webapp_1 webapp_1 | Server available at http://127.0.0.1:3000 Server available at http://127.0.0.1:3000 というのが目印です。\nこの表示が出たら、またブラウザで http://127.0.0.1:3000 にアクセスしてみてください。\n先ほどと同じような画面が出たら成功です。\nこれで、 Perl の（ Mojolicious::Lite で書いた）プログラムが Docker で動作しました。\n動作が確認できたら、ターミナルに戻って ctrl + c で Docker を終了しておきましょう。\nHeroku さて、お待たせしました。\nいよいよ、 Docker で動いている Perl のプログラムを Heroku で公開しましょう。\nまずは、コマンドラインツール（ Heroku Toolbelt と呼ばれています）でログインします。\nすでにログインしている方は不要です。\nEmail, Password, （設定している方は）Two-factor code を訊かれるので入力します。\n1 $ heroku login ログインできたら、次はアプリを登録します。\n新しく登録するのは簡単です。以下のようにコマンドを入力するだけです。\n1 $ heroku create 指定すればアプリの名称も決められますが、後でも変更できるので、まずは確実に作っておくほうが良いと思います。\nさて、コンテナを使用する場合、 Container Registry にログインする必要があるようですのでログインします。\n1 $ heroku container:login ログインが出来たら、いよいよデプロイです。\nデプロイということは、つまり、コンテナをアップロードするということなので、大きなファイルを送信することになります。くれぐれもネットワーク環境に注意してください。\n1 $ heroku container:push web デプロイが終わったら動作確認をしてみましょう。\nコマンドを使用して、アプリの URL をブラウザで開くことが出来ます。\n1 $ heroku open 先ほどと同じような画面が出たら成功です。\nPerl で作成したアプリを Heroku で公開することが出来ました。\nまとめ Perl でアプリを作って、 Docker で動かしたら Heroku で公開しましょう！\nDocker や Heroku はまだまだ進化しています。\n仕様がいつ変わるかわかりません。\n今のうちに是非お試しください。\n明日は 明日は @Morichan さんで「Bio::Perlを使いこなせずに挫折した話」のようです。\n明日もお楽しみに！\n","date":"2017-12-13T10:33:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/13/103356/","title":"DockerでHerokuでMojoliciousが動いたぞ!!!（改定版）"},{"content":"（追記: 2021/10/31 ）\nHexoの機能で、こういうのもあったなぁ、という感じです。\nHugo では include は何かしら工夫が必要みたいです。\n（追記ここまで）\n常に最新版の tools/rename_posts を表示しておけるように、 tools/rename_posts に対する symlink を張っておいた。\n1 {% include_code tools/rename_posts lang:perl rename_posts %} ","date":"2017-12-05T23:46:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/05/234613/","title":"include_code を試してみる"},{"content":"ソースコードの表示部分を markdown に置き換えたことで、別の問題が発生していた。\nインポートの時に {{ を {{ に変換していたのだけど、 ``` で書き直したところ、ソースコード部分の `` が見えるようになってしまった。\nなんとなく `` のほうが優先されると思ってさっきの記事も書いてみたんだけど、どうもそうでも無いようで、 ``` の中はしっかりとエスケープされるらしい。\nMustache とかのソースが（書くとすれば）面倒だなと思っていたけど、全然そうじゃなく、 ``` を書くほうが難しかった。\nMustache のソースがあるページ Zusaarのページを更新しました | nqou.net ","date":"2017-12-04T01:15:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/04/011530/","title":"template の処理順序"},{"content":"このブログは、何かとソースコードの埋め込みが多いのですが、これまで何度かシステムを引っ越したり、書き方を変えたりしてきたおかげで、色々な書き方が混在していた。 これまでは、手をいれるのも億劫だったんだけど、ようやく重い腰を上げることができた。 手元にファイルがあるって素晴らしい。 編集するのは何も Perl で処理するばかりではなく、エディタも活用すれば良い。 hexo は基本的に github 風の markdown で書くことができる。 ソースコードを書く場合は、バッククォート3つ（```）でソースコードを囲めば良い。 …しかし、それを markdown で表現するのが難しい、というジレンマよ。 とりあえず、ソースコードについては markdown に置き換えが終わった。 ### 参考 - https://help.github.com/articles/basic-writing-and-formatting-syntax/#quoting-code - https://hexo.io/docs/tag-plugins.html#Backtick-Code-Block\n","date":"2017-12-04T00:23:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/04/002340/","title":"ソースコード表示部分を markdown に置き換えた"},{"content":"hexoのように、手元に記事のファイルがあると便利だった。\nこれまで書いてきた記事にタグを付ける時に、本文に何かが含まれていたらタグに追加する、とかが Perl で簡単にできるようになった。\nこれまでは過去記事にタグを追加しよう、とか思ったこともないけど、こういうことをやろうと思えるようになったのは良いね。\n紆余曲折あって、変換スクリプトはこんな感じになっている。\n二重管理になるけど、今のところは大きく問題はない感じ。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 #!/usr/bin/env perl use utf8; use strict; use warnings; use Path::Tiny qw(path); use YAML (); use Time::Moment (); my $root = path(__FILE__)-\u0026gt;absolute-\u0026gt;parent(2); # 記事を取得 my $posts_dir = path($root, \u0026#39;source\u0026#39;, \u0026#39;_posts\u0026#39;); my $iterator = $posts_dir-\u0026gt;iterator(+{recurse =\u0026gt; 1}); # タイムゾーンを取得 my $tm = Time::Moment-\u0026gt;now; my $offset = $tm-\u0026gt;offset; my $jp_offset = 540; # 記事から時間を取得して、名称変更 while (my $post = $iterator-\u0026gt;()) { next unless $post-\u0026gt;is_file; my ($yaml, $after) = split /\\n---/, $post-\u0026gt;slurp_utf8; my $info = YAML::Load($yaml); my $modified; # ISO8601を持っていない場合はdateからISOを作成 unless (exists $info-\u0026gt;{iso8601}) { # 存在しなければ今書いたことにする if (!exists $info-\u0026gt;{date}) { $info-\u0026gt;{iso8601} = Time::Moment-\u0026gt;now-\u0026gt;to_string; } # すでに変換済みであればそのまま渡す elsif (-1 \u0026lt; index($info-\u0026gt;{date}, \u0026#39;T\u0026#39;)) { $info-\u0026gt;{iso8601} = $info-\u0026gt;{date}; } # date があれば iso8601 を作成 else { my $date = join(\u0026#39;T\u0026#39;, split(/\\s/, $info-\u0026gt;{date})) . \u0026#39;Z\u0026#39;; my $tm = Time::Moment-\u0026gt;from_string($date); my $new_date = $tm-\u0026gt;with_offset_same_local($offset); $info-\u0026gt;{iso8601} = $new_date-\u0026gt;to_string; } # date はURLのために日本時間へ統一 my $tm = Time::Moment-\u0026gt;from_string($info-\u0026gt;{iso8601}); my $url_date = $tm-\u0026gt;with_offset_same_instant($jp_offset); $info-\u0026gt;{date} = $url_date-\u0026gt;strftime(\u0026#39;%F %T\u0026#39;); $modified = 1; } # 本文に文字列が含まれていたらタグを追加 my $tag = \u0026#39;perl\u0026#39;; if ($after =~ /$tag\\b/i) { my $tags = $info-\u0026gt;{tags}; # undef が含まれていたら削除する $tags = +[grep { $_ ne \u0026#39;undef\u0026#39; and $_ ne $tag } @{$tags}]; push @{$tags}, $tag; $info-\u0026gt;{tags} = +[sort @{$tags}]; $modified = 1; } # 変更されていたら保存する if ($modified) { # 結合して出力 my $dump_yaml = YAML::Dump($info); my $body = join qq{\\n---}, $dump_yaml, $after; $post-\u0026gt;spew_utf8($body); } # 時間でファイル名を変更 my $tm = Time::Moment-\u0026gt;from_string($info-\u0026gt;{iso8601})-\u0026gt;with_offset_same_instant($jp_offset); my $path = $tm-\u0026gt;strftime(\u0026#39;%Y/%m/%d/%H%M%S\u0026#39;); my $new_post = path($posts_dir, qq{$path.md})-\u0026gt;absolute; $new_post-\u0026gt;parent-\u0026gt;mkpath; $post-\u0026gt;move($new_post-\u0026gt;stringify); } ","date":"2017-12-03T17:07:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/03/170750/","title":"hexoにして1時間くらいで感じたこと"},{"content":"TL;DR migration 時に気をつけること\nhexo-migrator-wordpress を修正し、 HTML を無理に markdown に変換しないようにする {{ は {{ に変換する お知らせ Wordpress で書いていた www.nishimiyahara.net から、すべての記事を引っ越しました。\nhexo も色々難点はあるけど、そこを理解して付き合っていけば何とかなりそうな気がしてきた。\nまあ、そう思えるのは、結果的に記事のインポートが（かなり躓いたけど）うまくいった（少なくとも構築できる状態になった）からだと思う。\n元凶は migrator だった 色々見ていくうちに、ソースコードとして書いている部分が妙な markdown になっていることに気づいた。 これは、と思って hexo-migrator-wordpress のソースコードを見ると、 HTML を markdown に変換しているところがあった。\n過去記事は無理に markdown にする必要はないので、変換部分を削除して実行してみた。 すると、これまでと違って hexo generate --debug のエラーがわかりやすいものに変わった。\nあとは、 {{ を {{ に変換するくらいで、エラーがなくなった。\n結構苦労したけど、結果的にやることがすごく少なくて拍子抜けと言うか。\n記号の扱いは、昔から困ることが当然なので、この程度で済んだのなら御の字というか。\nURL と時間の扱い そして問題は時間の扱いに戻った。\nこれまで色々と考えて時間を扱ってきたけど、移転に際してまた困ることになった。\nこの辺は諦めて、時差を含めた時間は別のメタ情報として保存するようにして、 date の値は、常に日本時間にすることで解決することにした。\n時差を含めた情報は個人的なこだわりではあるけど、記事をインポートしてみると、使っていないメタ情報がたくさんあることに気づいた。\nしかも、特に捨てられるわけではないので、それなら時差を含めた時間の情報を持っておいて、ファイルを変換する時に URL の元になる date を生成すれば良い。\nインポートする前に書いていた記事は URL が変わってしまうことになるけど、それはそれ。\nとりあえず色々とスッキリした。\n","date":"2017-12-03T15:48:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/03/154842/","title":"Wordpress から Hexo に乗り換えた（ついでにドメイン移転）"},{"content":"さっきの記事を書いて面倒だなと思ったので、ローカルの開発時は docker-compose を使えば楽かなと思ってやってみた。\n1 2 3 4 5 6 7 version: \u0026#34;3\u0026#34; services: webapp: build: . command: carton exec -- morbo myapp.pl ports: - 3000:3000 このファイルからみると、 myapp.pl の場所が違うので直感的ではないけれど、 COPY で .git までコピーされているのを見ると、アプリに必要なファイルだけをコピーするのが良いんじゃないか、と思った次第。\n1 2 3 4 5 6 $ docker-compose up Creating network \u0026#34;serenelake43934_default\u0026#34; with the default driver Creating serenelake43934_webapp_1 ... Creating serenelake43934_webapp_1 ... done Attaching to serenelake43934_webapp_1 webapp_1 | Server available at http://127.0.0.1:3000 感想 楽だった。\n多くのコンテナを使うようなものじゃなくても、 Dockerfile を上書きするように使えるのは便利。\ndocker build する度に、タグを入れるのは面倒だし、そうでなくても docker images で \u0026lt;none\u0026gt; がたくさん生成されるのを見ると色々と正しく指定しなければいけないのかなと思ってくる。\nまあ、一段落したら、全部止めて要らなさそうなやつは消しておくようにはしてます。\n1 2 $ docker ps -a -q | xargs docker stop $ docker image prune ","date":"2017-12-03T02:57:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/03/025713/","title":"ローカルでの開発は docker-compose を使うと楽だった"},{"content":"久しぶりに Heroku を使ってみたら、いつの間にかコンテナも使えるようになっていた。\nというくらいに全然 Heroku を使っていなかった。\n正確に言うと、 Heroku で動かしているアプリはあるけど、ずっと動かしたままだったので、ダッシュボードを見ることがなかった、という感じ。\n検索していると2年半くらい前の記事が多くて、時代に追いついてないのを感じる。\n今回頑張ったこと Dockerfile を書く時、これまでユーザーを意識していなかったので、今回は、 root 以外のユーザーで実行するようにした。\nUSER を指定すると、その後の COPY とかもユーザーで実行するのかと思ったら、そうでもなかったようだ。\n調べてみると、最近追加された機能で、ファイルのオーナーを変更できるようになったらしい。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 FROM perl:5.20.3-threaded RUN useradd -m -s /bin/bash appuser \\ \u0026amp;\u0026amp; cpanm Carton USER appuser RUN mkdir -p /home/appuser/webapp WORKDIR /home/appuser/webapp COPY --chown=appuser:appuser webapp/cpanfile /home/appuser/webapp RUN carton install COPY --chown=appuser:appuser webapp /home/appuser/webapp CMD carton exec -- /home/appuser/webapp/myapp.pl daemon -l http://0.0.0.0:$PORT 最後の CMD はとりあえず Mojolicious で動かしたいので適当に書きました。\nローカルでの開発はあまり意識していないのですが、やるとしたらこんな感じで起動するのかなと。\n1 2 docker build -t nqounet/serene-lake-43934 . docker run --rm -p 3000:3000 nqounet/serene-lake-43934 carton exec -- morbo myapp.pl …面倒くさそうですね。\nデプロイ方法 コンテナを使う時は、 Container Registry にログインする必要があるようです。\n1 2 3 4 5 6 7 8 # 必要なら作成 heroku create # Container Registry にログイン heroku container:login # デプロイ heroku container:push web 感想 buildpack を使う方法よりは真っ当な方法な気がします。\nというか、コンテナがそのまま公開できるって凄い。\n参考 nqounet/serene-lake-43934: Heroku Container Registry で動かす Container Registry \u0026amp; Runtime | Heroku Dev Center DockerでHerokuでPerlが動いたぞ!!! - hitode909の日記 第34回　DockerによるPerlのWebアプリケーション開発（1）：Perl Hackers Hub｜gihyo.jp … 技術評論社 Docker 17.09 からADD/COPY \u0026ndash;chownでファイルのオーナーを変更できるようになった - Qiita ","date":"2017-12-03T01:20:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/03/012037/","title":"DockerでHerokuでMojoliciousが動いたぞ!!!"},{"content":"結構前に書いた heroku で Mojolicious::Lite で作ったアプリを動かす記事が今でも使えるのか確認してみた。\nMojolicious::Liteで作ったアプリをHerokuで動かす | IT Office Nishimiyahara 経緯としては、先日の Perl 入学式の後の懇親会で、「自分の作ったアプリが公開できる、と思うとやる気が出る」みたいな話になったので、おさらいしてみるか、という感じです。\n結果として、動きませんでした。\nとは言え、ちょっとした注意点だけのことだったので、メモしておきます。\ncedar-14 と heroku-16 ひとことで言うと、デフォルトで使用される Stack が cedar-14 から heroku-16 に変わっていて、 buildpack が heroku-16 に対応していなかった、ということのようです。\nなので、 stack を指定してやればまだ使えます。\n改訂版はこちら。\n1 2 3 4 5 6 7 8 9 10 11 mkdir myapp \u0026amp;\u0026amp; cd myapp git init mojo generate lite_app myapp.pl heroku create --stack cedar-14 --buildpack https://github.com/pnu/heroku-buildpack-perl.git touch app.psgi echo \u0026#39;requires \u0026#34;Mojolicious\u0026#34;;\u0026#39; \u0026gt; cpanfile echo \u0026#39;web: starman --preload-app --port $PORT myapp.pl psgi\u0026#39; \u0026gt; Procfile git add . git commit -m \u0026#39;go to heroku\u0026#39; git push heroku master heroku open cedar-14 は 2019年4月までサポートされる、ということなので、まだしばらくは遊べますね。\n参考 Cedar-14 Stack | Heroku Dev Center Stacks | Heroku Dev Center ","date":"2017-12-02T17:03:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/02/170342/","title":"【2019年4月頃まで有効】Mojolicious::Liteで作ったアプリをHerokuで動かす"},{"content":"静的なコンテンツジェネレータ、というのかはわかりませんが、 hexo のようなプログラムをまとめたサイトが紹介されていたのでメモっておきます。\nTop Open-Source Static Site Generators - StaticGen Static Site Generators Github Pagesでブログ構築ができる静的サイトジェネレーター総まとめ - Qiita 英語では「Static Site Generators」というのが通称のようですね。\n静的サイトジェネレータ、ですか。\n","date":"2017-12-02T16:04:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/12/02/160403/","title":"Static Site Generators をまとめたサイトまとめ"},{"content":"Hexoの時間の扱いについてわかったこと 納得がいかなくて色々と調べてみたところ、とても不思議な現象が起きていることがわかった。\ndate の読み込みは正しいのだが、UTCの時間のまま _config.yml に書いてある timezone の時間として時差が付加される。\n具体的に Hexoの日付処理の挙動が意味不明 という記事は date の値として 2017-09-27T00:18:03-07:00 を指定しているが、出力時に日付を詳細に表示してみると 2017-09-27T07:18:03+09:00 となる。\n時間としては 2017-09-27T07:18:03+00:00 となるのが正しい。\nただ、何故かURLの日付は「26」を示していた。\nこれは、ファイルを生成する時に、26日として認識している、ということだ。\nつまり、表示に使用している時間を元にしてファイルを生成しているのだろう。\nHexo のソースコードを見ていると気になったコードがあった。\n1 2 3 4 5 6 7 8 9 10 exports.timezone = function(date, timezone) { if (moment.isMoment(date)) date = date.toDate(); var offset = date.getTimezoneOffset(); var ms = date.getTime(); var target = moment.tz.zone(timezone).offset(ms); var diff = (offset - target) * DURATION_MINUTE; return new Date(ms - diff); }; せっかくの momentjs のオブジェクトを JS の Date オブジェクトに変えている？ ここは普通に考えて momentjs の方へ処理をまとめるべきでは？\n中国はタイムゾーンが一つだった Hexo は中国発のソフトウェアということだ。\n中国はあれだけ広いので、複数のタイムゾーンがあるだろう、と勝手に思っていた。\nつまり、 Hexo はタイムゾーンについての考慮がされていると思っていた。\nこれはちゃんと調べてなかったのも悪かったけど、中国はあれだけ広いのにタイムゾーンが一つしかないようだ。\n色々と衝撃だ。\nタイムゾーンの処理を任せてみる 上記の timezone は、調べた範囲では、設定で指定している時だけに実行されている。\nそれならば、ということで、 timezone の指定をやめてみた。\nすると、これまでよりはマシになった。\nまず、パーマリンクが UTC の日付になった。ファイルとURLが一致するようになった。\nこれまで、23日なのに22日扱いになっていたりしたファイルなどが思っている日付になるようになった。\nしかし、表示に使う時間はやはりおかしい。\n具体的には 2017-09-27T00:18:03-07:00 という指定が 2017-09-27T07:18:03-07:00 のようになる。\nやはりこういう場合は、正しく 2017-09-27T07:18:03-00:00 として認識されて欲しい。\nただ、元々詳細な時間までは表示されていないし、URLの問題は解決したので、ひとまずはこれで良さそう。\n","date":"2017-10-06T18:25:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/10/06/182520/","title":"タイムゾーンの憂鬱"},{"content":"日付がおかしい 色々変更しているからかどうかはわかりませんが、最初の方の記事の日付が1日ズレてしまっている。\n本来は、日時的にUTCと考えても22日ではなく23日のはずなのに、何故かURLは22日として構築されている。\n理由はわかりませんが、今のところはリンク切れを回避するためにリンクを修正しました。\n日本に戻ったら、 date の部分をもとに戻して、改めて再構築しようかなと。\n挙動は以下のような感じなのですが、意味がよくわからないです。\nUTC にしても、23日なのに、22日になるファイルがある URLは22日なのに、HTMLファイルには23日と表示される どうなってんの？\n","date":"2017-09-27T16:18:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/27/161803/","title":"Hexoの日付処理の挙動が意味不明"},{"content":"試しにISO8601で書いてみたら動いた アメリカに来て、 hexo new post としてみたところ、やはり date はローカルタイムで作成されていた。\nふと思いついて、 date の部分を ISO8601 の形式で書いてみたところ、正常に読み込めた。\nHexoのソースコードを読んでみた どういうことかと思ってソースコードを読んでみたら、読み込む時は Moment.js を使って読み込んでいたようだ。\nということは、 hexo new post の時に ISO8601 の形式で出力しておけば万事解決。\n…のはずなんですが、どこを修正すればよいのかわかりませんでした。\n仕方なく、 Perl で書き直すことにしました。\nPerlでYAMLも再構築 date が ISO8601 の形式でなかった場合は、そのローカルタイムのタイムゾーンであるとみなして、 ISO8601 の形式で書き直す、というふうにしました。\nまた、そうした時に、どのタイムゾーンの日付をファイルの基準にするのか悩ましいのですが、 UTC の時間にすることにしました。\nなので、これまで書いてきた記事のファイルのパスも変更になります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #!/usr/bin/env perl use utf8; use strict; use warnings; use Path::Tiny qw(path); use YAML (); use Time::Moment (); my $root = path(__FILE__)-\u0026gt;absolute-\u0026gt;parent(2); # 記事を取得 my $posts_dir = path($root, \u0026#39;source\u0026#39;, \u0026#39;_posts\u0026#39;); my $iterator = $posts_dir-\u0026gt;iterator(+{recurse =\u0026gt; 1}); # タイムゾーンを取得 my $tm = Time::Moment-\u0026gt;now; my $offset = $tm-\u0026gt;offset; # 記事から時間を取得して、名称変更 while (my $post = $iterator-\u0026gt;()) { next unless $post-\u0026gt;is_file; my ($yaml, $after) = split /\\n---/, $post-\u0026gt;slurp_utf8; my $info = YAML::Load($yaml); # 時間がISO8601でない場合は変換 if (-1 \u0026lt; index($info-\u0026gt;{date}, \u0026#39; \u0026#39;)) { my $date = join(\u0026#39;T\u0026#39;, split(/\\s/, $info-\u0026gt;{date})) . \u0026#39;Z\u0026#39;; my $tm = Time::Moment-\u0026gt;from_string($date); my $new_date = $tm-\u0026gt;with_offset_same_local($offset); $info-\u0026gt;{date} = $new_date-\u0026gt;to_string; # 結合して出力 my $dump_yaml = YAML::Dump($info); my $body = join qq{\\n---}, $dump_yaml, $after; $post-\u0026gt;spew_utf8($body); } # 時間でファイル名を変更 my $tm = Time::Moment-\u0026gt;from_string($info-\u0026gt;{date})-\u0026gt;at_utc; my $path = $tm-\u0026gt;strftime(\u0026#39;%Y/%m/%d/%H%M%S\u0026#39;); my $new_post = path($posts_dir, qq{$path.md})-\u0026gt;absolute; $new_post-\u0026gt;parent-\u0026gt;mkpath; $post-\u0026gt;move($new_post-\u0026gt;stringify); } ","date":"2017-09-26T13:33:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/26/133337/","title":"Moment.jsを使っていたので、ISO8601で書き直した"},{"content":"時間の形式 最初に書こうと思っていたネタにようやくたどり着いた。\nファイル名を変更する時に微妙に困ったのが時間の扱い。\nHexo では、 date の形式が MySQL と同じような形式になっている。\nこの表示の仕方は割と一般的だとは思うのだけど、この形式について何も感じたことはないのだろうか？\n表示形式について 時間の表示方法はいろいろな表し方があるようでいつも戸惑う。\n私の場合は yyyy-mm-dd HH:MM:SS のように、日付部分は小文字、時間部分は大文字で書く。\nしかし、 YYYY-mm-dd のように、4桁の西暦を大文字で書く人もいる。（2桁の年を yy と表現する）\nあるいは、 strftime のように、 %Y-%m-%d %H:%M:%S とか、場合によっては %F %T とか。\n時差について いずれにしても、このような表現の場合、時差というかタイムゾーンについての情報が完全に欠落する。\nHexo はローカル環境でビルドするので、ローカル環境のタイムゾーンに依存する。\nなので、この date をローカルのタイムゾーンを元にして UTC になおしてファイル名にすると、日本にいる時に実行して変更したファイルは、アメリカに行って実行すると全部書き換わってしまう。と思う。試してないけど。（ローカル環境のタイムゾーンを変えない、という選択肢もあるけど）\n今時、 momentjs もあるし、文字列にする場合は、少なくとも ISO8601 に沿ってくれればよいのに。と思いながら、日本時間ということにしてファイル名を変更するスクリプトを書いた。\nようやくこのネタを書けたので、ちょっとアメリカ行ってきます。\n","date":"2017-09-24T10:58:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/24/105813/","title":"時間を表現する時はタイムゾーンも含めよう"},{"content":"hexo new [layout] \u0026lt;title\u0026gt; テーマを色々と見ていて、ふと気がついた。 hexo new post とした時にタイトルが post になっていた理由に。 new の help を改めてみてみる。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ hexo help new Usage: hexo new [layout] \u0026lt;title\u0026gt; Description: Create a new post. Arguments: layout Post layout. Use post, page, draft or whatever you want. title Post title. Wrap it with quotations to escape. Options: -p, --path Post path. Customize the path of the post. -r, --replace Replace the current post if existed. -s, --slug Post slug. Customize the URL of the post. あー、なるほど。 layout が省略可能扱いなので、 hexo new post とした場合、 post は layout ではなく title として入力されていた、という話だった。\nふと気がついた、わけではない 実際には、テーマの使い方の説明のところに hexo new \u0026lt;title\u0026gt; と書いてあったのを見て、もしかして、と思った。 で、調べてみたところ案の定、って感じ。\nコマンド体系 ところで、最近のコマンドはサブコマンド形式が多い。 普段お世話になっている brew もそうだし、この hexo もそう。\nまた、サブコマンドを入力しなかった時に使い方がでる、というスタイルや、 コマンド help サブコマンド のようにしてサブコマンドのヘルプを呼び出す、というのもだいたい共通している。\nまた、上の方では hexo help new として結果を書いているが、 hexo new でも同じ内容のヘルプが出る。 ターミナル上で操作をしていると、新しいコマンドもとりあえず同じように使ってみる、ということがあると思う。 取扱説明書を熟読してから家電を使う人はいない。 コマンドもそうだと思う。\nヘルプを見なくても使えるコマンドは素晴らしいコマンドだ。 plenv のような、 **env は沢山ある。 anyenv を使うと、そのような **env が気軽に使えるようになる。\nしかし、時々コマンド体系が違うものがあって嫌な感じになる。\n例えば goenv に関しては、インストール可能なバージョンを確認しようとして goenv install -l とするとエラーになる。 で、 goenv install ではどうかというと、以下のようになる。\n1 2 3 $ goenv install /Users/nobu/.anyenv/envs/goenv/libexec/goenv-install: line 18: [: =: unary operator expected Not found: ちなみに、 plenv ではどうかというと。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ plenv install Summary: Install a Perl version using the perl-build plugin Usage: plenv install [-v|--verbose] \u0026lt;version\u0026gt; plenv install [-v|--verbose] /path/to/definition plenv install -l|--list -l/--list List all available versions -v/--verbose Verbose mode: print compilation status to stdout --as=\u0026lt;NAME\u0026gt; Install the definition as \u0026lt;NAME\u0026gt; --test Run test cases --noman Skip installation of manpages -D, -A, -U, -j perl configure options via perl-build Example: plenv install 5.20.2 -j 8 -Dcc=gcc -UDEBUGGING -Accflags=... For more options that are passed through perl-build, run `perl-build --help` or see: https://metacpan.org/pod/distribution/Perl-Build/script/perl-build#OPTIONS なお、 goenv でインストール可能なバージョンの一覧は goenv install --list で見ることができるのだが、ヘルプにも書いていない…。\n1 2 3 4 $ goenv help install Usage: goenv install \u0026lt;version\u0026gt; Versions should be in the form of N.N.N とはいえ、実際のところ、golangの場合は実行形式で配布できるので、言語自体のバージョンを固定したり切り替えたりする意味もなさそうではある。\n","date":"2017-09-24T10:21:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/24/102132/","title":"省略可能な引数の配置について"},{"content":"ウェブサイトのテーマ Hexoのような、HTMLを生成するようなものを使う利点というと、テーマが豊富ということがあげられると思います。 ウェブデザインのセンスの欠片もない私にとってはとてもありがたいです。\nこの手のソフトの総称とは ところで、この手のソフトの総称ってどういうのが一般的なのでしょうか？\nローカルでビルドして、サーバー上には出来上がったHTMLファイルやJSファイルだけを置く事ができる、主に、 Github Pages で公開できます！という感じで謳っているヤツ。\nCMS ともちょっと違う。というか、マネジメントはできるので用語的には正しいともいえますが、何となく違う。\ncontents generator で検索すると、何故か sketch のプラグインが沢山表示されるので、 contents generator については、かなり特化した名称なのかなと思っています。\nMovable Type みたいなやつ、と言ってみる 仕組みとしては、昔からあります。\n更新を重視するか、閲覧を重視するかを選ぶ時に、閲覧に重きを置くと静的なファイルを生成し、普段は表示するだけ。\n例えば掲示板の場合、閲覧は多いが更新は少ないような掲示板だと、この仕組が活きてきます。\nなんとなくこういう感じで思い出すのが Movable Type です。 管理画面で記事を作成して、作成ボタンを押すと各ページが再構築されます。\nMovable Type について言えば、ページ数が増えてくると極端に再構築が遅くなる問題がありました。\nなので、更新が頻繁に行われるサイトには、あまり向いていない、といえます。\nテーマのカスタマイズがよくわからない 話が大きくそれていきそうなので戻します。\nHexo を使ってみようと思った時、この casual というテーマが気に入ったので使い始めました。\nしかし、カスタマイズの方法がよくわからず。\n結局、githubでforkして自分用に直接いじってカスタマイズしています。\nでも、これって正しいやり方なのでしょうか？\n例えば、 avatar とか favicon は、サイトごとに違います。\nなので、それが置き換えられるような仕組みになっていてほしい、と思っています。\n見たところ、ファイルを置いているだけのようなので、 avatar.png を source の中に置けば、生成時にトップのファイルとしてそれで良さそうな気がします。\n実際 hexo server ではうまくいったように見えたのですが、生成するとどうもうまくいってない様子。 もしかしたらその時の勘違い、あるいは、何らかの影響でうまくいかなかっただけかもしれない。\n少なくとも、 _config.yml は、本体側でテーマ向けの設定を書いても有効にはなっていない。 上書きするやり方はあるのかもしれないけど、少なくとも直感的ではない。\n仕組み的に、テーマでいろいろな拡張ができるはずですが、設定などは本体側で上書きできるように作るのが普通じゃないのか？\nそう思いながら、一旦テーマの方をカスタマイズしてしまうと、もう戻れない。\nテーマ選択の自由 この casual というテーマ。\nバージョンが v2.0.0 に上がった時に雰囲気が変わってしまったようです。 しかも、デモのページがドメインの期限切れのような雰囲気。\nもともと Smantic UI に興味があって、それを使っているテーマを探していた。\n公式のテーマを見ても、ハッシュタグに semantic-ui が書いてあるのは一つだけ。 しかし、そのサイトへ行くと別のテーマを使っていた…。\n実際のところ、あるテーマに偏った感じで記事を書くことはないと思う。 もしそうしてしまうと、テーマを気軽に変更できなくなってしまう。\nと、考えたのだが、そもそも、こういう考え方が稀なのかもしれない。\nだから、テーマを直接編集する、ということに対して違和感を感じないのだろうか？\n","date":"2017-09-24T04:47:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/24/044725/","title":"テーマを直接変更する時に感じる嫌な感じの正体"},{"content":"危うくハマるところだった 先程の記事を書いていて、ファイル名はどうせ変更するし、最初のファイルだけならフラットで良いのでは、と思ったので、さっそく new_post_name を :title.md に戻して hexo server を実行してみた。\nすると、なんということでしょう。\n/2017/09/24/2017/09/24/023018/ というURLになってしまったのです…。\nダメだったか、と思い、設定ファイルを前回の状態に戻して、改めて hexo server してみたのですが。\nなんと、もとに戻りません。\nもしかすると、うまくいっていたのが勘違いだったのでは？と思い、ウェブの方も確認してみました。 こっちは大丈夫でした。\n勘違いではなくちゃんとうまくいっていたようです。\nということは、落ち着いてクリーンな状態から再起動すれば良さそうです。\nそこで、 hexo clean してから hexo server してみたところ、ようやくもとに戻りました。\n困ったとき、というか、設定を変えたあとは hexo clean が良さそうです。\nプレースホルダーとは一体何なのか 1 permalink: :year/:month/:day/:title/ ここでいう :title というのは、一体何を示しているのでしょう？\nそもそもこれが :title になっているのが意味不明です。\n本質的な意味の「タイトル」ではないのは明らかです。 これまでの変更で、URLにタイトルが含まれないようになっています。\nsource/_posts からの相対パスから拡張子を除いたもの、というような定義？\nそういう意味では、 new_post_name の :title.md でいう :title と同じようにも見えますが…。\nともかく、 URL についてはこれで落ち着きそうです。\n個人事業のサイトもうまくいけば移行できる可能性が見えてきました。\n","date":"2017-09-24T03:22:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/24/032246/","title":"変数やプレースホルダーの名前は重要です"},{"content":"## ディレクトリとファイル名 Hexo では、 `source/_posts` のディレクトリ内に、フラットにファイルが置かれる。 もちろん設定で変更できる。 というわけで、変更してみる。 これは調べている時に見た方法で、どこで見たのかはわからなくなってしまった。 よくあることだけど。 改めて検索すると見つからないんだよね…。\n1 new_post_name: :year/:month/:day/:title.md `new_post_name` は、初期設定は `:title.md` だけなので、タイトルがそのままファイル名になる。 なお、この設定は `hexo new post ` とした時に、 `\u0026lt;title\u0026gt;` に書いた文字列がそのままタイトルとされる。 なので、記事を書こうと思ったらタイトルを書かなければならない。 …というのはあんまりじゃないかと思ってタイトル無しでコマンドを実行すると `post` が指定されたことになるようだ。 ファイル名は後で変更することにしているので、とりあえず `post` というタイトルで書き始め、あとでタイトルを設定する、というのが、なんとなく良さげな感じに思えてきた。 大体、記事を書いているとタイトルと合わなくなってくるので、タイトルは最後に書きたい派です。 話がそれた。 で、元々、日本語のURLが嫌だったので、WordPressのURLはタイムスタンプで決まるようにしていた。\n1 2 # カスタム構造 /%year%/%monthnum%/%day%/%hour%%minute%%second% まあ、雰囲気で書くと `/年/月/日/時分秒` みたいな。 Hexo ではファイルはフラットに置かれるが、URLは`/年/月/日/` の配下になるため、URLを想定して `時分秒.md` みたいにすると、ファイル名が衝突する可能性が結構高い。 なので、ファイル自体もURLと同じように配置することで衝突を回避することができる。 というわけで、リネームツールも一部変更した。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env perl use utf8; use strict; use warnings; use Path::Tiny qw(path); use YAML qw(Load); use Time::Moment; my $root = path(__FILE__)-\u0026gt;absolute-\u0026gt;parent(2); # 記事を取得 my $posts_dir = path($root, \u0026#39;source\u0026#39;, \u0026#39;_posts\u0026#39;); my $iterator = $posts_dir-\u0026gt;iterator(+{recurse =\u0026gt; 1}); # 記事から時間を取得して、名称変更 while (my $post = $iterator-\u0026gt;()) { next unless $post-\u0026gt;is_file; my ($yaml) = split /\\n---/, $post-\u0026gt;slurp_utf8; my $info = Load($yaml); my $date = join(\u0026#39;T\u0026#39;, split(/\\s/, $info-\u0026gt;{date})) . \u0026#39;+09\u0026#39;; my $tm = Time::Moment-\u0026gt;from_string($date); my $basename = $tm-\u0026gt;strftime(\u0026#39;%Y/%m/%d/%H%M%S\u0026#39;); my $new_post = path($posts_dir, qq{$basename.md})-\u0026gt;absolute; $new_post-\u0026gt;parent-\u0026gt;mkpath; $post-\u0026gt;move($new_post-\u0026gt;stringify); } ","date":"2017-09-24T02:30:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/24/023018/","title":"WordPressで使っていたURLに合わせよう"},{"content":"日本語とプログラミング Hexo は基本的にはタイトルの名前をファイル名にして保存し、そのファイル名をURLに割り当てている。 もちろん、設定で変更できる。\n先程の記事のタイトルの何がいけなかったのかはわからないけど、デプロイしたあと確認してみると、404エラーになっていた。 今は変更したので正常にリンクできる。\n「WordPressの記事をHexoにインポートしようとしたが挫折した」の何がいけないのだろう？\n元々、URLに日本語が入っているのは気持ち悪いので設定を変えたいと思っていたのだけど、設定を変更するとよくわからないエラーになるし、調べても今一つな感じでした。\n救いなのは、ファイル名を変更すれば、そのファイル名がURLになるので、ファイル名を変更するのが安全な方法というのがわかった。\nなので、 Perl を使ってポストの時間からファイル名を生成するようにした。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/usr/bin/env perl use utf8; use strict; use warnings; use Path::Tiny qw(path); use YAML qw(Load); use Time::Moment; my $root = path(__FILE__)-\u0026gt;absolute-\u0026gt;parent(2); # 記事を取得 my @posts = path($root, \u0026#39;source\u0026#39;, \u0026#39;_posts\u0026#39;)-\u0026gt;children; # 記事から時間を取得して、名称変更 for my $post (@posts) { my ($yaml) = split /\\n---/, $post-\u0026gt;slurp_utf8; my $info = Load($yaml); my $date = join(\u0026#39;T\u0026#39;, split(/\\s/, $info-\u0026gt;{date})) . \u0026#39;+09\u0026#39;; my $tm = Time::Moment-\u0026gt;from_string($date); my $basename = $tm-\u0026gt;strftime(\u0026#39;%Y%m%d%H%M%S\u0026#39;); my $new_post = path($post-\u0026gt;parent, qq{$basename.md})-\u0026gt;absolute; $post-\u0026gt;move($new_post-\u0026gt;stringify); } デプロイの前に自動的に実行するようにしておいた。\nnpm でもコマンドが作れるみたいだけど、いつも使っているので daiku で。\n1 2 3 4 5 6 desc \u0026#39;deploy\u0026#39;; task deploy =\u0026gt; sub { sh qw{hexo clean}; sh qw{tools/rename_posts}; sh qw{hexo deploy}; }; こうすることで、記事を書いたあと、 daiku deploy すればサイトを更新できるようになった。\n","date":"2017-09-23T23:50:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/23/235009/","title":"マルチバイトの憂鬱"},{"content":"出発前夜 明日からアメリカへ行くのだけど、とりあえず着替えとかを詰めて、ひと休み。\n今日は夕方くらいまでは仕事をするつもりだったのに、サーバーの整理をし始めて、しかもうっかりウェブサイトを消してしまったりして。（とは言え、githubにソースは残っているのだが）\nいつもと少し違うことがあると、そわそわする。\n大体そういう時に余計なことをして変なことになる、気がする。\nWordPress の記事をインポート 記事が沢山あるとどうなるのか気になって、IT Office Nishimiyaharaの記事をインポートしようとした。\nインポートするときには以下の記事を参照した。\nMigration | Hexo コマンドレベルで言うとこんな感じ。\n1 2 npm install hexo-migrator-wordpress --save hexo migrate wordpress \u0026lt;source\u0026gt; インポートする場合、まずは WordPress の形式でエクスポートして、 migrate の時に、そのファイルを指定する。\nあっさり取り込むことができた。\nただ、取り込むまでは良かったけど、 hexo server で確認しようとすると、エラーになってしまった。\n色々と調べていると、記事の中にテンプレートエンジンで使用する記号を使っていると、それをエスケープしないといけないらしいことはわかった。\nただ、他にも原因があるのか、色々とやってみてもエラーが解消しないので諦めた。\nなので、適当に記事を量産することにする。\n一応フォローしておくと、コードを書かないような普通の人にとっては何も問題はなさそう。\nまあ、普通の人がこういうツールを使うかというと怪しいけど。\n","date":"2017-09-23T22:04:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/23/220454/","title":"WordPressの記事をHexoにインポートしようとしたが挫折した"},{"content":"さくらのVPSを結構な期間使っているのですが、そろそろサーバーを整理したいなと思って色々消していました。\nで、ウェブサイトのディレクトリがあったのですが、git remote -v で確認したところ、今はやめている gitlab を参照していたので消しました。\nするとどうでしょう。\nnqou.net のサイトが404エラーを出すようになりました。\ngithubにもリポジトリがあるのにおかしいなと思っていたのですが、まあ消してしまったものは仕方ありません。\n改めて github にあったものを使い始めたのですが、どうも中途半端になっていたようでした。\nとりあえず、この時は Hexo を使ってみようと思っていたようなので使っていきます。\nHexo ","date":"2017-09-23T14:53:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/09/23/145337/","title":"うっかり消してしまった"},{"content":"おはようございます。 若林（@nqounet）です。\nubuntuをCUIで起動する方法というのをかれこれ3年前に備忘録として書いたのですが、最近はこのやり方ではCUIで起動しないようです。\n…ということを、少し前に知って、最近の方法を調べていたはずですが、案の定忘れていて、しかも結構調べてしまったので書いておくことにします。\n最近の方法 /etc/default/grub の GRUB_CMDLINE_LINUX_DEFAULT の項目を変更します。\nroot で編集するのを忘れないようにしましょう。\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;systemd.unit=multi-user.target quiet nosplash\u0026#34; 保存したあと、 update-grub として変更を反映したら再起動。\n見慣れたログイン画面になったら成功です。\n参考になる資料 【Linux】UbuntuでCUIオンリーに切り替える - packpak’s diary 【ubuntu16.04LTS】CUIモード（テキストモード）で起動 - mikan\u0026rsquo;s technical note ","date":"2017-05-13T17:25:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2017/05/13/172528/","title":"CUIモードで起動するには何をどうすればよいのか"},{"content":"おはようございます。 若林（@nqounet）です。\n少し遅れましたが、この記事は、Perl 5 Advent Calendar 2016 - Qiita の25日目の記事ということにします。\nアドベントカレンダーは24日までのことが多いようですが、技術系のカレンダーだと25日までみたいですね。\n最初にお断りしておくと、この記事に技術的な話はありません。\n2016年のアドベントカレンダー さて、初日の記事を書いたときにも思ったのですが、いざ1日になってもアドベントカレンダーがないと落ち着きませんでした。\nPerl 5 Advent Calendar をまさか私が立ち上げる日が来るとは思ってもいませんでした。\nとは言っても今は簡単な仕組みが提供されているので始めるのは簡単です。 しかし、完走させるとなると大変だと思います。 おかげさまで、気がつけば多くの方が参加してくださり、この記事で無事（？）完走となります。\n私自身がすべての記事を書いたわけではありませんが、感慨深いものがあります。 来年は是非他の方に立ち上げていただきたいな、と思っています。 勢いもありましたが、貴重な経験をすることができました。\nYAPC::Kansai 2017 OSAKA このアドベントカレンダーの最中に YAPC::Hokkaido が開催されましたが、2017年は、3月に大阪で YAPC が開催されます。\n私自身もスタッフの一員として、これまでになかった YAPC を開催できるように色々と考えていきますので、是非ご期待ください。\nYAPC::Kansai 2017 OSAKA まとめ 改めて、Perlいいよね！\n","date":"2016-12-26T04:34:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/12/26/043412/","title":"改めて、Perlいいよね！"},{"content":"この記事は、 Perl入学式 Advent Calendar 2016 の9日目の記事です。 昨日は ken5owata さんの Perl入学式に参加した結果www でした。\nPerl鍋を開催しました さて、奇しくも昨日は、正式名称「Perlで何か作る勉強会」、通称「Perl鍋」の第13回を開催しました。\n#Perl鍋 #13 - connpass この勉強会は、2013年の1月から毎月第3木曜日に開催していました。\n#Perl鍋 #1 - connpass まあ、第5回までは、ですが。 この頃は、新大阪コワーキングというコワーキングスペースを主宰していて、普段からそこで仕事をしていたので、安定して開催していました。 5回まで開催したあたりで新大阪コワーキングを畳んだので、その後しばらく開催できていなかったのですが、現在の会場にもなっているナレッジサロンに場所を移して2015年の6月から再開しました。 しかし、今年の2月に開催してからは、多忙なこともあり休んでいたのですが、昨日、今年2回目、通算13回目のPerl鍋を開催しました。 なお、主催は「Perl鍋実行委員会」となっていますが、委員は私（@nqounet）だけです。\nPerl鍋が存在する理由 先程も書きましたが、Perl鍋は2013年の1月から開催されました。\n[#Perl鍋 - connpass](https://perlnabe.connpass.com/) その前の年の2012年と言えば、Perl入学式の第一期が実施された年です。 第一期のときは、全11回の講義を行いましたが、最後の講義の時、何かしらの勉強会を作りたいと考えていました。\nもう一つ、Perl入学式の次のステップになる勉強会を開催したいと思っています。 折角覚えたのですから、使ってみたいですよね。 Perlに入学したから満足、というだけでなく、Perlを使って色々と作ってみたりわからない所を訊いてみたりできる、そういう勉強会をやってみたいと考えています。\n[#Perl入学式 #11 で講師役をしてきました | IT Office Nishimiyahara]\nPerl入学式を完走したとしても、自力で何かプログラムを書くというのは、かなり難しいことだと思います。 例えば、Perl入学式の最後に1行掲示板を作りますが、そのプログラムを改造して新しい機能を追加したいとしましょう。 …おそらく一人では余裕で挫折します。 何かしようとしても、まず、どこから手を付ければ良いのか、どこを見れば何がわかるのか、そもそも、何を知れば良いのかもわからない状態だと思います。 何故そう思うかというと、私が CGI のゲームを改造（新しい機能を追加する程度の事）をして楽しんでいた頃に、 Catalyst を学ぼうとして味わったことだからです。 今から思えば、ゲームスタート直後にいきなりラスボスに挑むようなものだったのですが、当時の私にはそれを知るすべがなかったのでした。 当時の私には、そういう時に質問する相手が居なかったのです。 私と同じようにつまづいている人が気軽に参加できるような場所を作りたい。 そう思うのは、当時の私が切望していたからです。\n私が「Perl入学式」をサポートしてきたり、Kansai.pmの代表になったり、という感じに行動しているのは、単純にPerlが好きというだけでなく、自分自身が躓いた時に必要だった「都合の良い勉強会」を作りたい、と思ったからです。\n[#Perl鍋 という勉強会をやりますよ | IT Office Nishimiyahara]\n趣味でプログラミングをする方は、おそらくが独学だろうと思います。 私はそういう気持ちでPerl鍋を開催しているので、独学で躓いていたり、周囲にプログラミングのことで気軽に質問できる人が居なくて困っている方は是非ご参加ください。\n#Perl鍋 - connpass 大阪近辺のPerlの勉強会 Kansai.pmのような集まりは、少し敷居が高く感じるだろうと思います。 昔の私がそうでしたが、話される内容と、自分自身のレベルが違いすぎるのを感じてしまうので、こんなことを質問してもいいのだろうかと思うでしょう。 もしかすると（というか、実際に言われたこともありますが）、Perl鍋も敷居が高い、と感じる方もいるかと思います。 そんな時は、 @tomcha_ さんが主催している なにわPerl がより気軽に参加できると思います。\nなにわPerl - connpass\n@tomcha_ さんは、Perl入学式の第一期生で、純粋に趣味としてプログラミングを楽しんでいらっしゃいます。 Perl入学式でPerlを学び始めた皆さんにとっては、最も近い先輩が開催している勉強会ですので、Perl鍋より参加しやすいと思いますよ。\nさいごに 明日、北海道で開催される YAPC::Hokkaido に続いて、来年の3月には関西でもYAPC::Kansai が開催されます。\nYAPC::Hokkaido 2016 SAPPORO YAPC::Kansai 2017 OSAKA まだまだ未定なことが多いですが、今から予定を空けておいてください。 事前に知り合いを作っておきたい、という方にも、Perl鍋やなにわPerlはおすすめです。\n明日は Kei-Kamikawa さんで、「それでは沖縄からの中継です！」のようです。 また、アドベントカレンダーには、まだ空きがあるようですので、何か書いてみたい方は是非ご参加ください！\nPerl入学式 Advent Calendar 2016 - Qiita ","date":"2016-12-09T14:03:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/12/09/140321/","title":"#Perl鍋 第13回を開催しました"},{"content":"この記事は Perl 5 Advent Calendar 2016 の8日目の記事です。\n昨日は @wakegisky さんの Perl の基礎知識で実用プログラミング 〜旅情編〜 でした。\nデータを追加するだけで動作がどんどん良くなる、凄い仕組みのプログラムですね。 必要は発明の母です。\nさて、今日は関数のリファレンスを使った tips を書いてみたいと思います。\n遅延実行と仮実行（dry_run） シチュエーションは色々あると思いますが、実行結果を事前に確認したい、ということはよくあります。\nコマンドとかの場合は、「\u0026ndash;dry-run」のようなオプションがあって、そのオプションを付けると実際には何も変更しないけれども、実行した感じで結果が返ってくる。みたいな。\nでも、これって結構面倒だと思いませんか？\n最初からちゃんと考えて実装していれば問題ないですが、そうでもない場合は、実行しているところが色々分散していて、仮実行のときはここは変更しない、みたいなところを色々とif文などで避けなければいけない。\n実際に実行する箇所を一つにまとめられたら楽なんじゃないかなと思いませんか？\n関数のリファレンスで処理をまとめる そこで登場するのが関数のリファレンスです。\n実装のイメージとしてはこんな感じ。\n1 2 3 4 5 6 7 8 9 10 use strict; use warnings; use feature \u0026#39;say\u0026#39;; my @job; push @job, sub { say 1 }; push @job, sub { say 2 }; say \u0026#34;hoge\u0026#34;; unshift @job, sub { say 3 }; for (@job) { \u0026amp;{$_} } これを実行すると以下のようになります。\n1 2 3 4 hoge 3 1 2 基本的な仕組みとしては、関数のリファレンスを push したり unshift したりして、配列に貯めておき、実行するときは関数のリファレンスをデリファレンスする、という感じです。\nこうしておくと、実際の実行部分は、関数のデリファレンス部分にまとまります。\nこの仕組を利用すると、実際の書き込み処理は配列に貯めておいて、仮実行のときはこれを実行しない、というようにすることができます。\n1 2 3 unless ($dry_run) { for (@job) { \u0026amp;{$_} } } $dry_run が真の場合、以下のように出力されます。\n1 hoge ということで、処理が各所に点在していても、仮実行の対象にしたい処理はグローバルな変数などを一つ用意して、そこにジョブ（関数のリファレンス）を貯めておき、仮実行でない場合だけ実行するようにすることができます。\nこういった仕組みを使うと、例えば Teng の場合は、値をセット（set, set_columnsなど）だけして、実際の更新処理（update）は関数のリファレンスで貯めておき、dry_runのときはupdateの処理を捨てることで、限りなく本番に近い仮実行ができるようになります。\nCGIにも関数のリファレンスを 話は変わりますが、古き良きCGIは、スクリプトの最初にまずHTTPヘッダを出力したりしています。\nテンプレートを使っていない場合は、その次にHTMLのヘッダを出力したりしているのではないでしょうか。\nそうして順に処理していったところで何らかのエラーが発生した場合、突然エラーメッセージが出力されてHTMLがちぎれた状態になったりするんですよね。\nでも、そういうのを修正するのは面倒なので、なかなか手を付けられないのではないかとおもいます。\nそんな時に、先程の仕組みを使えば、あまり沢山のコードを書き換えなくてもよくなります。\nprint で出力しているところをグローバルな変数に関数のリファレンスとして貯めておき、エラーのときは、それまで貯めておいた処理を捨てて、エラーだけを出力する、なんてことができるようになりますよ。\n最後に 2017年3月4日（土）に YAPC::Japan と Kansai.pm がコラボした、「YAPC::Kansai 2017 OSAKA」を開催します。\nYAPC::Kansai 2017 OSAKA まだまだ未定なことが多いですが、今から予定を空けておいてください。\n明日は skaji さんで、「cpmについて書きます」のようです。\nまた、アドベントカレンダーには、まだ空きがありますので、何か書いてみたい方は是非ご参加ください！！\nPerl 5 Advent Calendar 2016 - Qiita ","date":"2016-12-08T20:21:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/12/08/202141/","title":"遅延実行と仮実行（dry_run）について考えてみた"},{"content":"おはようございます。 若林（@nqounet）です。\nこの記事は、Perl 5 Advent Calendar 2016 - Qiita の2日目の記事です。\n昨日も私が書きました。-\u0026gt; MacBook Pro (13-inch, Late 2016, Four Thunderbolt 3 Ports) の system perl のバージョンを調べた | IT Office Nishimiyahara\n何かネタがないかな〜、と物色していたら、以下の記事を見つけました。\n文字列操作比較16言語[JavaScript/TypeScript/CoffeeScript/C#/VB.net/VBS/D言語/R言語/Ruby/Python3/Lua/HSP3/CommonLisp/Scheme/EmacsLisp/Clojure] - Qiita Perl5がない！！！\nということでネタができました。ありがとうございます。\nPerlでの文字列操作 ズバッと回答のソースコードをば。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #!/usr/bin/env perl use strict; use warnings; use feature \u0026#39;say\u0026#39;; use List::Util qw(reduce); sub str_test { # 文字列定義 my $str_text = \u0026#39;2$4$8$16\u0026#39;; say $str_text; # 文字列置換 $str_text =~ s/\\$/#/g; say $str_text; # 配列分割 my @str_list = split /#/, $str_text; say scalar @str_list; # 配列要素追加 push @str_list, \u0026#39;32\u0026#39;; say scalar @str_list; # 足し合わせ my $sum = reduce { $a + $b } @str_list; say $sum; # 配列結合 $str_text = join \u0026#39;++\u0026#39;, @str_list; say $str_text; # 文字列連結 $str_text = \u0026#39;Hoge-\u0026gt;\u0026#39; . $str_text; say $str_text; # 文字列切り取り左 $str_text = substr $str_text, 0, 10; say $str_text; # 文字列切り取り右 $str_text = substr $str_text, -6; say $str_text; } str_test(); コメント せっかくなので、一つ一つにコメントしていきましょう。\n文字列定義 なんだかいきなりですが、シングルクォートで括らないと定義（代入）すらできません。\n「$」はPerlではスカラ変数の頭につけるのですが、ダブルクォーテーションの中では変数が展開されるので、それを防ぐにはエスケープしないといけません。\nまあ、そういうのは面倒なので、シングルクォートでくくりましょう。つまり、シングルクォートの中では変数が展開されない、ということです。\n文字列置換 正規表現内では「$」はエスケープしないと動かないです。\n正規表現の中では「$」は行末にマッチする（厳密には色々違いますが）ので、文字扱いするにはエスケープする必要があります。\n置換を実行すると、変数の値が変わります。参考記事で言うところの「破壊」です。\n配列分割 「#」があるとエディタ（Atom）だとコメント扱いされますが、特にエスケープする必要はありません。\n参考記事では要素数を出していますが、Perlでは、配列の要素数を出すためには、配列の変数をスカラコンテキストで評価する必要があります。\nということで、表示するときは「scalar」を使います。つまり、表示する「say」はリストコンテキストで評価される、ということです。\nなお、「say」は、最後に改行を付けて出力してくれるので、簡単なスクリプトには便利です。\n「scalar」なしだとどうなるんだろう？と思ったあなた。センスありますよ。試してみてください。\n配列要素追加 一応、文字列リテラルで追加します。\n「push」を実行すると、変数の値が変わります。参考記事で言うところの「破壊」です。\n足し合わせ reduce は標準モジュールの List::Util に含まれているのでそれを使います。\nどうせモジュールを使うのなら「sum @str_list」でいいのですが、参考記事に合わせてみました。\n$a, $b は突然見ると気持ち悪い、と言われても仕方ないような気がします。なので、ますます「sum」使おうよ、って感じですね。\nなお、文字列-\u0026gt;数値の変換は不要です。Perlの場合は、値が文字列でも「+」演算子を使うと、数値として足し算ができるのです。\n配列結合 join でリストを任意の文字列で結合できます。\n文字列連結 文字列の連結は「.」（ドット）を使います。\n文字列切り取り左 文字列を切り取るには「substr」を使います。\n2つの引数の意味は、「場所」と「文字数」です。\n最初の引数に「0」を入れるのが、左を切り取るときのポイントです。\n文字列切り取り右 右を切り取るには、最初の引数に負の数を入れます。\n最初の引数に負の数を入れると「後ろから何番目の文字」となります。\n二つ目の引数を省略すると、最後までが対象になります。\n感想 ついカッとなって書いてみましたが、色々と思うところがありました。\nとりあえず関数名やファイル名はスネークケースで書いています。\nPerl5というとラクダのイメージですが、キャメルケースはあまり推奨されてないような気がします。わかりませんが。\nネイティブなオブジェクト指向言語ではないので、全体的に関数を使う感じになってしまいますね。 参考記事だと、 VBScript とか HSP くらいですかね…。\n正規表現、置換なども見た感じでは意味不明です。\nreduce は、個人的には使ったことないレベルです。 言い訳をすれば、List::Utilで sum などの関数は使えるので、あえて reduce を使うことはないような気がします。\nしかし、突然の$a,$bは気持ち悪いですね。 まあ、 sort でも出てくるんですけどね。\nよく見てみると、 reduce ではなく普通にループで足してるのもありました。 モジュールを使わずにループにするとこんな感じですね。\n1 2 3 4 5 my $sum = 0; for my $elm (@str_list) { $sum += $elm; } say $sum; まあ、言語仕様としてはこっちで書くほうが正解ですね。\nこうしてみると、オブジェクト指向プログラミングを学びたい人にとっては不向きな言語であることがよくわかりますね。\nまあ、それはそれ、ってことで。\nPerl 5 Advent Calendar 2016 明日は、sago35さんです。\nPerl 5 Advent Calendar 2016はまだまだ参加者を募集してまーす。\n","date":"2016-12-02T00:14:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/12/02/001419/","title":"Perl5で文字列操作"},{"content":"おはようございます。 若林（@nqounet）です。\nこの記事は、Perl 5 Advent Calendar 2016 - Qiita の1日目の記事です。\n誰も作らないな〜と思いながら、1日になっても作られていないので作った。後悔はしていない。\nまあ、初日から頑張りすぎて息切れしないように、完走を目指します。\nPerlのバージョンの調べ方 Perlのバージョンは「-v」で調べられます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ perl -v This is perl 5, version 18, subversion 2 (v5.18.2) built for darwin-thread-multi-2level (with 2 registered patches, see perl -V for more detail) Copyright 1987-2013, Larry Wall Perl may be copied only under the terms of either the Artistic License or the GNU General Public License, which may be found in the Perl 5 source kit. Complete documentation for Perl, including FAQ lists, should be found on this system using \u0026#34;man perl\u0026#34; or \u0026#34;perldoc perl\u0026#34;. If you have access to the Internet, point your browser at http://www.perl.org/, the Perl Home Page. 「v5.18.2」ですね。\nもう少し詳しく調べてみます。\n詳しく調べるには「-V」を使います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 $ perl -V Summary of my perl5 (revision 5 version 18 subversion 2) configuration: Platform: osname=darwin, osvers=16.0, archname=darwin-thread-multi-2level uname=\u0026#39;darwin osx202.apple.com 16.0 darwin kernel version 15.0.0: wed apr 6 00:55:38 pdt 2016; root:xnu-3247.1.106.2.8~1development_x86_64 x86_64 \u0026#39; config_args=\u0026#39;-ds -e -Dprefix=/usr -Dccflags=-g -pipe -Dldflags= -Dman3ext=3pm -Duseithreads -Duseshrplib -Dinc_version_list=none -Dcc=cc\u0026#39; hint=recommended, useposix=true, d_sigaction=define useithreads=define, usemultiplicity=define useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef use64bitint=define, use64bitall=define, uselongdouble=undef usemymalloc=n, bincompat5005=undef Compiler: cc=\u0026#39;cc\u0026#39;, ccflags =\u0026#39;-arch i386 -arch x86_64 -g -pipe -fno-common -DPERL_DARWIN -fno-strict-aliasing -fstack-protector\u0026#39;, optimize=\u0026#39;-Os\u0026#39;, cppflags=\u0026#39;-g -pipe -fno-common -DPERL_DARWIN -fno-strict-aliasing -fstack-protector\u0026#39; ccversion=\u0026#39;\u0026#39;, gccversion=\u0026#39;4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.34)\u0026#39;, gccosandvers=\u0026#39;\u0026#39; intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678 d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16 ivtype=\u0026#39;long\u0026#39;, ivsize=8, nvtype=\u0026#39;double\u0026#39;, nvsize=8, Off_t=\u0026#39;off_t\u0026#39;, lseeksize=8 alignbytes=8, prototype=define Linker and Libraries: ld=\u0026#39;cc -mmacosx-version-min=10.12\u0026#39;, ldflags =\u0026#39;-arch i386 -arch x86_64 -fstack-protector\u0026#39; libpth=/usr/lib /usr/local/lib libs= perllibs= libc=, so=dylib, useshrplib=true, libperl=libperl.dylib gnulibc_version=\u0026#39;\u0026#39; Dynamic Linking: dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=\u0026#39; \u0026#39; cccdlflags=\u0026#39; \u0026#39;, lddlflags=\u0026#39;-arch i386 -arch x86_64 -bundle -undefined dynamic_lookup -fstack-protector\u0026#39; Characteristics of this binary (from libperl): Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS PERL_DONT_CREATE_GVSV PERL_HASH_FUNC_ONE_AT_A_TIME_HARD PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP PERL_PRESERVE_IVUV PERL_SAWAMPERSAND USE_64_BIT_ALL USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF USE_REENTRANT_API Locally applied patches: /Library/Perl/Updates/\u0026lt;version\u0026gt; comes before system perl directories installprivlib and installarchlib points to the Updates directory Built under darwin Compiled at Jul 30 2016 15:03:54 %ENV: PERL_CPANM_OPT=\u0026#34;--auto-cleanup=7 --notest\u0026#34; @INC: /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.2 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 . 普段は plenv で入れた perl を使うのでお世話にはならないのですが。 オプションは誰が決めたんだろうなぁ、とか、チョットだけ妄想が膨らみますね。\nそれでは、完走に向けて頑張りましょう！ というか、誰か参加してください。\n","date":"2016-12-01T01:08:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/12/01/010847/","title":"MacBook Pro (13-inch, Late 2016, Four Thunderbolt 3 Ports) の system perl のバージョンを調べた"},{"content":"おはようございます。 若林（@nqounet）です。\nLion時代からお世話になっていたmarkdownエディタのMouが、macOS Sierraで使えなくなっていたので、代わりになるものを探してみた。\nMouの後継として、MacDownというソフトがあるらしいのでそれを使ってみることにした。\nMouについて プレビューを見ながら編集できるので、特にマークダウンを覚えたての頃はお世話になっていました。\n最近はそれほど使用頻度は多くなかったのですが、ちょっとしたメモを取るのに重宝していました。\nちょっとしたショートカットが便利なので、普段使っているエディタとは別にマークダウンを書くときだけはMouを使うことが多かったです。\nダウンロードしたあと実行しようとしたらこんな画面が出て涙目になりました。\nMacDownについて 後継を名乗るだけあって、なかなかのものです。\nMacDown: The open source Markdown editor for OS X. エンジニアを意識しているのか、Homebrew Caskでもインストールできるようです。私もこちらからインストールしました。\n1 $ brew cask install macdown アプリ自体は少し大きくなっていますが、操作感はあまり変わらないような気がします。\nまだ少ししか触っていませんが、普段使っていたショートカットもほぼ使えました。\nただ、画像とリンクについては、ショートカットが変わっていたのでアレ？って感じでしたが、あまり使わないので問題ないことにします。\n最近はプレビューがなくても大体イメージはできるのですが、書くときのちょっとしたショートカットはなかなかやめられません。\nしばらく使ってみようと思います。\n","date":"2016-11-20T21:07:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/11/20/210719/","title":"SierraでMouが使えなくなったのでMacDownを使うことにした"},{"content":"おはようございます。 若林（@nqounet）です。\nタッチバー付きのMacBook Proが届いたわけなんですが、ちょっと使ってて、やはりファンクションキーを押そうとしてしまうので、なんとかならないかなと思って環境設定と格闘していたらありました。\nアプリを指定する必要はあるようですが、指定したアプリを操作しているときはファンクションキーが表示されるようにできるようです。\n設定の場所は以下の通り。 システム環境設定 -\u0026gt; キーボード -\u0026gt; ショートカット -\u0026gt; ファンクションキー\nこの画面を表示して、下の + ボタンをクリックするとアプリを選択できるので、ファンクションキーを表示しておきたいアプリを入れれば、そのアプリではいつもファンクションキーが表示されるようになります。\nいつも、fnキーを押さないでファンクションキーが有効になるようにしていたのですが、今回はその設定がなかったので非常にがっくりしていました。\nしかし、なんとか別の方法ですが設定が残っていたので救われました。\n流石にキーボードはもう少し慣れが必要そうですが、ファンクションキーが表示されているだけでも良しとしましょう。\n","date":"2016-11-20T00:17:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/11/20/001705/","title":"あって良かったTouch Barにファンクションキーを表示させる方法"},{"content":"おはようございます。 若林（@nqounet）です。\n開発環境の更新は、新しい方法を発見した時にその場で変更してみて、気に入ったらそのまま使い続けたりしています。\nただ、本番環境はなかなかそういうわけにはいかないので、新しい方法を発見してもなかなか試せないですよね。\n今さっきも、思い出して検索してみたけど、相当検索してようやく発見できたので、もう忘れないように書いておくことにしました。\nサーバーのセットアップ、しかも本番用となると、なかなか機会がありません。\nPerlの利点として、ほとんどのサーバーに入っている、という事がありましたが、最近は事情が違うと思います。\nちょっとしたアプリを作る場合でも、本番環境と開発環境とは同じような状態にしたいので、plenv（perl-build）などを使ってアプリのためにPerlをビルドして使用するのが望ましいと思います。\n実際のところ、本番環境を構築する時は、開発環境と同じようにplenvを入れて、同じバージョンのPerlを作成して動作させる、ということをやっていました。\nしかし、世の中にはもっと便利なものが存在しているのでした。\ntagomoris/xbuild: Language runtimes installer for production environment 本番環境でいろいろな言語をインストールするためのソフトウェアです。\nbashのスクリプトなので「git clone」するだけで使用可能。お手軽ですね。\nなお、plenvを使用せずにperl-buildだけでビルドするのはわりと定番らしいのですが、私は最近まで知りませんでした。\n本番環境でのperl/ruby/nodeのセットアップ - たごもりすメモ ちなみに、この記事はブックマーク済みでしたが、この記事を探すつもりで「はてブ」を検索したんですが、出てこなかったんですよね。\nやはり、自分でメモするのが一番ってことで。\n","date":"2016-10-29T15:43:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/10/29/154343/","title":"本番環境にPerlを入れる便利な方法を忘れるので書いておく"},{"content":"おはようございます。 若林（@nqounet）です。\nmemcached を使って排他制御したい事ってありますよね？ ないですか？\n私は、つい最近そういうことがあったので KeyedMutex::Memcached を使ってみました。\nあらすじ 掲示板時代からそうですが、更新処理が複数同時に実行された場合、排他制御（ロック）をしていないとデータが壊れます。\nファイルのロックについていろいろ考えていた時期もありました。\nデータベースを使っている場合、排他制御はあまり意識しなくても壊れなかった（むしろロックされすぎてエラーになったり）のですが、ある時を境によく壊れるようになりました。\nセッション管理に memcached を使っていたので、それを使って排他制御ができないかな〜と CPAN を見ていたところ、使えそうなモジュールがありました。\nIPC::Lock::Memcached - memcached based locking - metacpan.org KeyedMutex::Memcached - An interprocess keyed mutex using memcached - metacpan.org その中で IPC::Lock::Memcached は少し古いのと、インストールの失敗数がそこそこあるので回避し、KeyedMutex::Memcached を使うことにしました。\nKeyedMutex::Memcached を使ってみる 使い方を見て、ほぼそのまま使えました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use KeyedMutex::Memcached; my $key = \u0026#39;query:XXXXXX\u0026#39;; my $cache = Cache::Memcached::Fast-\u0026gt;new( ... ); my $mutex = KeyedMutex::Memcached-\u0026gt;new( cache =\u0026gt; $cache ); until ( my $value = $cache-\u0026gt;get($key) ) { { if ( my $lock = $mutex-\u0026gt;lock( $key, 1 ) ) { #locked read from DB $value = get_from_db($key); $cache-\u0026gt;set($key, $value); last; } }; } new するときに Cache::Memcached::Fast のインスタンスを渡せるので、既に利用しているインスタンスを再利用することができるのが良いですね。\nlock の第二引数は use_raii のフラグですが、これを使うと $lock がなくなった時にロックをはずしてくれます。 よくわからない場合は、黙って上のコードのように書くと良いと思います。 （use_raiiをしなかった場合は、if文の中で$mutex-\u0026gt;release としてロックをはずす必要があるので、上のコードのように書いておくのが間違いないでしょう。この機構は Scope::Guard を利用しているのですが、こういうのは便利だなと思いました）\n本来の使い方としては、上記のようにキャッシュをセットする時のロックとして使用するのが良いのでしょうが、重い処理を何度も動作しないように使ったりもできるようです。\nシステムへの組み込み方 今回は、更新するためのオブジェクトの中に、ロックを取得する機能をつけて、そこで使用しました。\nイメージは以下の様な感じです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package Entry; use Moo; has id =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, predicate =\u0026gt; 1); has mutex =\u0026gt; (is =\u0026gt; \u0026#39;lazy\u0026#39;); sub _build_mutex { my $cache = Cache::Memcached::Fast-\u0026gt;new( ... ); return KeyedMutex::Memcached-\u0026gt;new( cache =\u0026gt; $cache ); } sub create_mutex { my $self = shift; return 1 unless $self-\u0026gt;has_id; my $key = join \u0026#39;:\u0026#39;, \u0026#39;entry\u0026#39;, $self-\u0026gt;id; return $self-\u0026gt;mutex-\u0026gt;lock($key, 1); } ロックをかけたいところで if (my $mutex = $entry-\u0026gt;create_mutex) { ... } という感じで使えるかなと。\nIDがない場合はロック不要（insertするのでDBが適切に処理してくれる）とみなして何もせずに真を返しています。\nRAIIを使うと、明示的にロックをはずす必要がなくなるので、ロックの実体がなくてもロックを取得したものとして動作させることができます。\n仕組み ソースを見ると、 memcached の add が成功したかどうかでロックが取得できたかどうかを判定しています。\n排他制御を確実に行うには、「ロック操作ができるかどうかの判定」と「ロック操作」が同時にできる必要があります。add はそれが可能なのです。\nファイルシステムを使ったロックの場合、mkdirやrenameを使うと思いますが、それにはちゃんとした理由があるのでした。\n実は車輪の再発明しかけた 実は、CPANで探す前に簡単に書いてみたのです。\nとりあえず排他制御として使えそうな物（ただしキーの指定ができない）ができたのですが、そこまで書いた時点で「さすがに誰か書いてるんじゃないか」と思って調べたら、わりとすぐに見つかったと。\nまとめ CPAN は偉大です。 最初から探しておけばよかった。\n参考になる資料 KeyedMutex::Memcached - An interprocess keyed mutex using memcached - metacpan.org KeyedMutex::Memcached ってモジュールをリリースして何も言ってなかった件 - Yet Another Hackadelic Scope::Guard - lexically-scoped resource management - metacpan.org ","date":"2016-08-03T08:09:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/08/03/080932/","title":"排他制御をKeyedMutex::Memcachedでやった件"},{"content":"おはようございます！ 若林（@nqounet）です。\n興奮冷めやらぬ感じですが、感想ブログを書きますよ。 「ブログを書くまでが Kansai.pm 」を実践します。\n迷子 会場はナレッジサロンだったのですが、初めての方には結構迷う場所のようです。 そういう私も、最初は迷ってスタッフさん用の入り口のほうから無理やり入れていただいた口です。 案内に気をつけていたつもりですが、2,3人のかたは迷ってしまっていました。 この辺り、ナレッジサロンでセミナーなりカンファレンスなりを開催している方に対策を聴いてみたいところですね。\n本編 開始は10分ほど遅くなりましたが、発表者が全員揃ったので本編に突入です。 オープニングで使ったスライドの原本はこちらです。\nmeetups/20160320-kansai-pm-opening.md at master · nqounet/meetups 前日に、「どんな話が聴きたいですか」というアンケートの結果を公開したら、皆さんがいい感じにトークに取り入れてくれたので最高でした。これは次回もやりたいですね。 というか、このオープニングで追加した項目にまで対応してくれた @\\_\\_papix\\_\\_ 氏は、むしろちゃんとトークを聴いたほうが良いと思いますw ところで、スライドを作るのが面倒なので、私はいつも「App::revealup」を使っています。Markdownで書いたテキストをいい感じにスライドにしてくれるツールです。 元々Markdownからスライドにしてくれるツールを自作したりしていたのですが、こっちのほうが便利なので乗り換えました。\nApp::revealup - HTTP Server application for viewing Markdown formatted text as slides - metacpan.org 私の使い方が悪いだけかもしれませんが、最新版だとCSSが微妙なので、 carton でバージョンを 0.19 に固定して使っています。\n1 requires \u0026#39;App::revealup\u0026#39;, \u0026#39;==0.19\u0026#39;; Markdownは、幾つかの書き方を覚えるだけでもかなり捗りますので、IT系じゃない方でもパソコンを使う方全般におすすめです。 見出し（H[1-6]）とリスト（UL, LI）と整形済みテキスト（PRE）に対応する書き方はすぐに覚えられるので是非お試しください。 以下のページがそこそこいい感じにまとまっています。\nMarkDownの書き方 ‹ 技術の犬小屋 Markdownのエディタは、MacならMouがオススメです。2年以上前からいろんな人に推奨しています。\nこれがないと何もできないと感じたソフトウェア for MacOSX | IT Office Nishimiyahara Windowsは、2年以上前に探したきりですが、いくつかオススメはありました。今はどうかわかりませんが。\nWindowsにも使えるMarkdownエディタがあった | IT Office Nishimiyahara スライドを作成するときは、自分にあったツールを使えば発表のハードルが低くもなりますので、是非お試しください。 閑話休題。 日数や秒数は計算するのは面倒なので、当然Perlで計算しています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/usr/bin/env perl use utf8; use strict; use warnings; use feature \u0026#39;say\u0026#39;; use open qw/:encoding(utf8) :std/; use Data::Printer {deparse =\u0026gt; 1}; use Time::Moment; my $kansaipm15 = Time::Moment-\u0026gt;from_string(\u0026#39;20130223T00Z\u0026#39;); my $kansaipm16 = Time::Moment-\u0026gt;from_string(\u0026#39;20160320T00Z\u0026#39;); say $kansaipm16-\u0026gt;delta_years($kansaipm15); say $kansaipm16-\u0026gt;delta_days($kansaipm15); say $kansaipm16-\u0026gt;delta_hours($kansaipm15); say $kansaipm16-\u0026gt;delta_seconds($kansaipm15); @karupanerura さんのトークにもありましたが、 Time::Moment は非常に高速です。 from_string は確かに汎用的ではないのですが、 Moment.js との親和性は高いので、モダンなウェブアプリならこれ一択でしょう。\nJavaScriptで時間を扱うならMoment.js | IT Office Nishimiyahara 今見ていたら、トーク内で紹介されていた issue がクローズしていたので、今後が楽しみですね。\nI would like to document Time::Strptime as a companion module to Time::Moment · Issue #1 · karupanerura/Time-Strptime @azumakuniyuki さんの、 Perl から Ruby に移植するデモ（？）が、かなり大雑把で良かったです。 ||= は確かにハマるような気がしました。 関係ないですが、「しました」と入力する時によく「姉妹sた」ってなるのですが、Perl と Ruby の姉妹ってところを思い出してうっかり笑ってしまいました。\n@sago35tk さんの、同じものを作るのが何故良いのか、というところは思い出してみると本当にそのとおりでした。感想戦というんでしょうか、何故そうしたのかというのをお互いに話すことで得るものがあります。ペアプログラミングと似たような効果もありそうですね。 最後のまとめに、業界の苦労や勉強会に参加する意義がいい感じにまとまっています。「楽しく失敗体験できる」というのは本当に涙が出そうです。成功体験も大事ですが、楽しい失敗体験も大事ですね。\n@xtetsuji さんの、トークを聴いていて、どのCMSを使うのかはやっぱり用途次第だな、と思いました。 Kansai.pmのウェブサイト は、Rijiを使っていますが、これはライターにはある程度のスキルが必要になりますが、オフラインでも記事（下書き的意味ではなく）を書くことができるし、Markdownで書けるし、gitで管理できるのでライターの概念がありながらもユーザー管理はないし、HTMLファイルを生成するのでサーバーを選ばない（githubでもOK）などの特長があります。 どれを選べば一番みんながハッピーなのかを考えて選択するのが肝心だなぁ、と思いました。\nKansai.pmのウェブサイトをRijiで作った話、または最近のpm.orgの管理方法 | IT Office Nishimiyahara @\\_\\_papix\\_\\_ さんは主催者泣かせですね。発表時間はなるべく守ってください。 まあ、アンケートの結果について沢山話してくれていたので、参加者の皆さんには参考にしていただけたのではないかと思います。 過去に書いたコードは資産、というのは完全に同意です。そして、その資産から新しい資産が生まれる。 ライブコーディングも、ペアプログラミングと同じように、他の人のプログラミングスタイルとか、成果物からは見えない部分を見ることができる（シェルの使い方とか）のでいいと思います。 呪文のように唱えていた「subako」を呼び出していたのは、たぶん peco を使っていると思うのですが、こういう系の知識ってなかなか得られないんですよね。調べる方法がまずわからないし、そもそもそういう事ができる、ということを知る機会もないと思いますが、そういった部分をざっくり質問したりできるのが、勉強会の良い所だなと思います。\nそれと、値を表示する時に使っていた DDP は Data::Printer というモジュールで、かなりオススメしています。\nPerlで自走するエンジニアに必要なたった1つのモジュール | IT Office Nishimiyahara この記事には、少しですが peco についても書いているので参考に読んでみてください。1年半ほど前に書いたものですが、まだ使える記事だと思います。\nそんなこんなで、結局時間一杯までライブコーディングだったので、懇親会の準備などがバタバタになり、懇親会に参加されない方にはちょっと申し訳ない感じの締め方になってしまったのが心残りです。 会場のナレッジサロンは、1人だと2時間までしか確保できないので、@tomcha_ さんが追加で2時間確保してくれました。 打ち合わせもしていないのに、参加者の会場の出入りやOAタップの確保など、的確に動いていただいて本当に助かりました。ありがとうございました。\n懇親会、LT 会場が4時間確保できたので、ナレッジサロンのパーティプランを試してみました。 できることは知っていて、開催されていることも知っていたのですが、実際に頼んだのは初めてです。 準備も手際よく、料理も美味しいし、素晴らしいですね。 会場の片付けも、通常は机の配置を戻したりする必要があるのですが、そのへんもやっていただけるので時間いっぱいまで懇親会を楽しむことができました。頼んで正解でした。 人数が予定よりも3人増えた（12人想定が15人）こともあって、料理が30分も経たずになくなってしまいましたが、料理は増やせない（実際は通常メニューは頼めるのですが）とはいえ、人数の変更が柔軟なところは助かりました。 LT募集ページには誰も登録していなかったのですが、結局5名がLTっぽい感じで発表しました。 LTというか、タイムキーパーもいない、ドラもない、ツッコミありの、とても自由な発表でした。 勉強会の懇親会らしいことができるのが本当に良いですね。 会場が確保できれば、次回もこの感じでやりたいです。\n二次会 二次会は総勢12名の大所帯でしたが、ダメ元で突撃した鶏の唐揚げが美味しい店を確保できて良かったです。 確保に走ってくれた @stc1988 さん、ありがとうございました。 全部で唐揚げいくつ頼んだんだろうか？\n二次会とはいえ、かなり飲み食いしたと思うのですが、一人あたり2000円でお釣りが来る、本当に良い店です。 そういえば、この店は私がメイヤーらしいです。\nNobutaka | 勝男 まとめ まとめられないのですが、無事開催できて本当に良かったです。 次回は8月にやります、とか口走ったようなので、それに向けて邁進したいと思います。\nその際は、是非ご参加のほど、よろしくお願い申し上げます。\n","date":"2016-03-21T11:44:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/03/21/114416/","title":"Kansai.pm第16回ミーティングを開催してきました"},{"content":"おはようございます。 若林（@nqounet）です。\nPerl入学式のウェブアプリ編では、ファイルのアップロードについては説明していません。 理由は単純で、ファイルの扱い方を説明するには時間が足りないからです…。 とはいえ、画像を表示できるようにしたいというリクエストは多いので、その辺について書いてみたいと思います。\nMojolicious::Lite は使いません Mojolicious::Lite を使うとファイル1つで完結できるので簡単なのですが、そのために色々と無茶なことをしているので CGI で使いたいというような事情がない限りは Mojolicious を使うほうが良いと思います。\n完成品 完成品は github に置いています。 複数のファイルがあり、かつ、ディレクトリの構成も重要なので、リポジトリとして用意しています。 適宜お使いください。\nnqounet/p5-mojolicious-image-bbs: Mojoliciousで作る画像掲示板 なお、画像（に限らずファイルをアップロードできるような）掲示板では、本来はファイルの形式を制限するなど、セキュリティについて考える必要がありますが、今回はその部分については考慮していません。あくまでサンプルコードとして扱ってください。 以下、ポイントを含めて解説してみます。\n画像をアップロードする まず、画像（に限らずファイル）をアップロードするにはどのようにすればよいでしょうか。 ファイルをアップロードする場合には、ポイントが3つあります。これらはすべて HTML がポイントになります。 ひとつ目は、HTMLのinput要素のtype属性を file にすること、ふたつ目はform要素のmethod属性を POST にすること、最後は、form要素のenctype属性を multipart/form-data にすることです。\nMojolicious の場合は、 file_field を使うと、 \u0026lt;input type=\u0026quot;file\u0026quot; ...\u0026gt; が生成できます。 method については、Perl入学式でも学んでいるとおり、 form_for で method =\u0026gt; 'POST' を指定します。 同様に、 enctype についても、 form_for に enctype =\u0026gt; 'multipart/form-data' を追加すれば可能です。 テンプレートのフォーム部分を抜き出すと以下の様な感じです。\n1 2 3 4 5 6 7 8 \u0026lt;div\u0026gt; %= form_for \u0026#39;/\u0026#39;, method =\u0026gt; \u0026#39;POST\u0026#39;, enctype =\u0026gt; \u0026#39;multipart/form-data\u0026#39;, begin タイトル：\u0026lt;%= text_field \u0026#39;subject\u0026#39; %\u0026gt; 画像ファイル：\u0026lt;%= file_field \u0026#39;file\u0026#39; %\u0026gt; 概要：\u0026lt;%= text_field \u0026#39;description\u0026#39; %\u0026gt; \u0026lt;%= submit_button \u0026#39;投稿する\u0026#39; %\u0026gt; % end \u0026lt;/div\u0026gt; これで、ファイルをアップロードすることができるようになりました。\n画像を保存する ファイルがアップロードできるようになったので、次はアップロードされたファイルを保存します。 ファイルを保存するポイントは、2つです。 一つは、データをどうやって取得するか。もう一つは、取得したデータをどこに保存するかです。\n画像データを取得する Mojolicious を使う場合、データを取得するのは簡単です。 データを取得するには、これまで学んだ方法と同じで param を使用します。テンプレートで file_field には file という名前をつけているので、そのデータを取得する場合は `$self-\u0026gt;param(\u0026lsquo;file\u0026rsquo;)` とすればよいです。\n1 2 3 my $subject = $self-\u0026gt;param(\u0026#39;subject\u0026#39;); my $description = $self-\u0026gt;param(\u0026#39;description\u0026#39;); my $file = $self-\u0026gt;param(\u0026#39;file\u0026#39;); これまでと違うのは、取得したデータは、データそのものではなくオブジェクト（Mojo::Uploadのインスタンス）になっている、ということです。 その点だけ注意すれば、他のパラメータと同じように扱うことができます。\n画像データを保存する データを取得できたので、あとは保存です。 保存するには、取得したオブジェクトの `move_to`メソッドを使います。 保存する場所は、（次の「表示する」にも関わってくるのですが）ウェブに公開されている場所になっている必要があります。 Mojolicious では、公開するディレクトリとして最初から /public というディレクトリが使用できます。 なので、本来はその中に upload のようなディレクトリを作成して、そこで管理すると良いと思います。 ただ、個人の好みかもしれませんが、サーバー上で保存するデータはなるべく固めておきたいので、サーバー上で書き込むためのディレクトリ（/var）を作成し、その中の upload というディレクトリを公開する場所にします。 Mojolicious では、公開するディレクトリは $app-\u0026gt;static-\u0026gt;paths で管理しているので、そこに新しくディレクトリを追加します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package MyApp; use Mojo::Base \u0026#39;Mojolicious\u0026#39;; has upload_dir =\u0026gt; sub { shift-\u0026gt;home . \u0026#39;/var/upload\u0026#39; }; has data_dir =\u0026gt; sub { shift-\u0026gt;home . \u0026#39;/var/data\u0026#39; }; sub startup { my $app = shift; push @{$app-\u0026gt;static-\u0026gt;paths}, $app-\u0026gt;upload_dir; my $r = $app-\u0026gt;routes; $r-\u0026gt;get(\u0026#39;/\u0026#39;)-\u0026gt;to(\u0026#39;index#get\u0026#39;); $r-\u0026gt;post(\u0026#39;/\u0026#39;)-\u0026gt;to(\u0026#39;index#post\u0026#39;); } 1; 保存する場所が決まったので、あとはファイル名です。 ファイル名をそのまま使用して保存すると、同じ名称の別のファイルがアップロードされると、新しいファイルで上書きされてしまいますので、サーバー側で名前を変更して管理するのが良いと思いますが、その場合でも拡張子には注意が必要です。 今回は、そのあたりを雑に解決する案として、アップロードごとにディレクトリを追加して、ファイル名はそのまま使用することにします。\n1 2 3 4 my $prefix = Mojo::Util::md5_sum(Mojo::Util::steady_time()); my $path = path($self-\u0026gt;app-\u0026gt;upload_dir, \u0026#39;images\u0026#39;, $prefix, $file-\u0026gt;filename); $path-\u0026gt;parent-\u0026gt;mkpath; $file-\u0026gt;move_to($path); Mojo::Utilの、 md5_sum と steady_time を組み合わせてランダムな文字列を作成してディレクトリ名にしています。 ファイルを保存する時に注意しなければいけないのが、親ディレクトリがないと move_to が失敗するところです。 ディレクトリの操作は Path::Tiny を使用しています（pathという関数が使えるようになっています）ので、 move_to をする前に、 $path-\u0026gt;parent-\u0026gt;mkpath のようにして親ディレクトリを作成しています。\nファイルをアップロードして公開するようなシステムでは、ファイルの管理方法については深く考える必要があります。どのようにしてファイルの重複を防ぐのかについて考えてみてください。 このサンプルコードはその辺りは雑になっています。\nオブジェクト（Mojo::Uploadのインスタンス）の使い方は、ドキュメントを確認してください。\n（日本語）Mojo::Upload · yuki-kimoto/mojolicious-guides-japanese Wiki\n（英語）Mojo::Upload - Upload\nその他、Mojo::Util, Path::Tiny については最後にまとめてリンクしておきます。\n画像を含めた記事データを保存する さて、ようやく画像が保存ができたので、画像を記事として表示するために他の情報もまとめて保存します。 画像を表示するには、 HTML のimg要素を使用しますので、情報としてはsrc属性に入る文字列があれば良さそうです。 今回は、画像以外に、画像のタイトル（subject）と概要（description）も投稿できるようにしているので、それらをまとめてデータとして追記します。\nsrc属性の値を求める src属性には「公開ディレクトリをルートとした絶対パス」を指定するのが良いでしょう。 まずは、先ほど保存したファイルの、公開ディレクトリからの相対パスを求めます。 Path::Tiny には、簡単に相対パスを求めるメソッド（relative）があるのでそれを使うと簡単です。\n1 my $src = $path-\u0026gt;relative($self-\u0026gt;app-\u0026gt;upload_dir)-\u0026gt;absolute(\u0026#39;/\u0026#39;); relative のあとの absolute は、絶対パスを求めるメソッドなのですが、引数を指定すると、指定した引数が現在の絶対パスであるとして設定されます。 この一連の動作で、 公開ディレクトリをルートとした絶対パスが求められます。 絶対パスにすることがとても重要で、これは後に出てくる url_for と組み合わせることで威力を発揮します。\nデータを構造的に保存する Perlにかぎらず、プログラミングでは、データをどのように扱うのかが重要です。 今回は、3つのデータ（subject, src, description）を1つの記事（entry）として管理したいので、ハッシュか配列ですが、この場合はハッシュを使用するのが（テンプレートを書く時にも）便利です。 ハッシュだと、値を項目名で指定できるので、適切に項目名を考えておけば後でテンプレートを見ても何が書いてあるのかが見やすくなりますし、投稿日時や投稿者名などのデータを追加した場合でも、修正が比較的簡単です。 もし配列を使用した場合は、何番目に何が書いてあるのかを考えながらテンプレートを書く必要があります。データが増えると番号と項目名の対応表が欲しくなるでしょう。\n将来的にentryをオブジェクトとして管理する場合、ハッシュの項目名をそのまま属性名にすることも可能なので、何かしらの制限がない限りはハッシュを用いるのが良いと思います。\nたくさんの記事を扱うためには、 entry についてもハッシュか配列にしたほうが良いです。 今回は単純なループとして処理したいので、配列を選択します。\nここで配列ではなくハッシュを選択しても良いとは思いますが、何を項目名にするのかは難しい問題です。仮にIDを設定したい場合は、entry自体をIDで管理するのではなく、entryの一つの項目としてIDを設定するほうが良いと思います。 将来的にデータベースで管理する場合でも、ひとまず配列として考えるほうが扱いやすいです。\nということで、全体的な構造としては、記事の集まりは配列、一つの記事はハッシュで表現することにします。\n1 2 3 4 5 6 7 my $entry = +{ subject =\u0026gt; $subject, src =\u0026gt; $src-\u0026gt;stringify, description =\u0026gt; $description, }; my $model = $self-\u0026gt;model; $model-\u0026gt;add($entry); ここで $model というのは、記事を扱いやすくするためのオブジェクトです。このオブジェクトに対して add メソッドで新しい記事を追加すると、最新の記事として追加するように作っています。 実装としては、 load して unshift して save するだけの構造です。\n1 2 3 4 5 6 7 8 sub add { my $self = shift; my $entry = shift; my $entries = $self-\u0026gt;load; unshift @{$entries}, $entry; $self-\u0026gt;save($entries); } load はデータをファイルから読み込むメソッド、 save は引数をファイルに書き込むメソッドです。 ここでは、 $entries がデータ全体（配列のリファレンス）になっているので、そのデータに unshift で $entry を追加しています。 今回は、データが単純な配列とハッシュの組み合わせなので、 Mojo::JSON を使用して、変数の中身をそのままファイルに書き込んでいます。\n画像を表示する データも保存できましたので、実際に画像を含めた記事全体を表示します。 表示は HTML なので、テンプレートを使用します。 ここでポイントになるのは、画像の URL （src要素）です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;ul\u0026gt; % for my $entry (@{$entries}) { \u0026lt;li\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dt\u0026gt;\u0026lt;%= $entry-\u0026gt;{subject} %\u0026gt;\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt; \u0026lt;img src=\u0026#34;\u0026lt;%= url_for($entry-\u0026gt;{src}) %\u0026gt;\u0026#34; width=\u0026#34;100\u0026#34;\u0026gt; \u0026lt;%= $entry-\u0026gt;{description} %\u0026gt; \u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;/li\u0026gt; % } \u0026lt;/ul\u0026gt; $entries は、記事全体（配列のリファレンス）なので、 for を使用してすべての記事を表示します。 ここで $entry は一つの記事を示すハッシュのリファレンスです。 このハッシュは、 subject, src, description の3つの項目で値を持っています。 srcについては、 URL を扱うので url_for を使用しています。 morbo コマンドで起動した場合、通常は localhost:3000 のルートで起動しますが、 Mojolicious で作成するアプリは、幾つものアプリを組み合わせて一つの大きなシステムとして稼働させることができます。 main.pl は、画像掲示板を /uploader/ というディレクトリで使用できるようにしたものです。 morbo main.pl で起動しても、 morbo script/my_app で起動しても画像がちゃんと表示されるためには、このように url_for と絶対パスを組み合わせる必要があります。 なお、 form_for や、コントローラーで使用している redirect_to は url_for を介していませんが、こちらはフレームワークが自動で url_for に相当することを実行しているので使用する必要はありません。もちろん、使用しても正常に動作します。 テンプレートで URL を直接使用する場合には、必ず url_for を使用しましょう。\nまとめ 少々長くなりましたが、 Mojolicious で作った「ファイルをアップロードできる掲示板」を解説してみました。 途中でも書きましたが、本来ファイルのアップロードはセキュリティに気をつける必要がありますので、今回のコードについては、あくまでサンプルコードとして扱ってください。\n参考 Mojolicious API リファレンス · yuki-kimoto/mojolicious-guides-japanese Wiki Mojolicious::Guides - Mojolicious guide to the galaxy Path::Tiny - File path utility - metacpan.org Mojo::JSON - Minimalistic JSON ","date":"2016-02-27T16:45:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/27/164502/","title":"Mojolicious でファイルがアップロードできる掲示板を作る"},{"content":"おはようございます。 若林（@nqounet）です。\nこの前の水曜日に、すいもく会を開催しました。 あまりもくもくしてなかった気はしますが、もくもく会です。\nすいもく会 #2 - すいもく会 | Doorkeeper 最終的には参加者は5人 今回は初参加の方も含めて、参加者は5人となりました。 前半は軽めの自己紹介から、ゲームの話や人工知能の話、教育の話などに花が咲き、もくもくではなく賑やかな会になりました。 後半は、全員がPerlの関係者（？）だったので、Perlなどのプログラミングの話題で賑やかな会になりました。 …あまりもくもくしてなかった気はします。\n懇親会も 9時すぎまでもくもくしたあとは、有志で懇親会へ。 店は煙草の煙でもくもくでした。\n第3回のご案内 第3回は次の水曜日（3月2日）に開催しますので、興味がありましたらご参加ください。\nすいもく会 #3 - すいもく会 | Doorkeeper ","date":"2016-02-26T08:25:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/26/082552/","title":"すいもく会 #2 を開催しました"},{"content":"おはようございます。 若林（@nqounet）です。\n先日、よなべPerlのゲスト講師として招かれましたので、Mooを使ったオブジェクト指向について喋ってきました。\n[よなべPerl ／ 「一歩すすんだオブジェクト指向アプローチ Moo」 on Zusaar](http://www.zusaar.com/event/14317009) よなべPerlとは よなべPerlは、@hakata_oyukiさんが主催している、主にウェブアプリの開発に関するプログラミングの勉強会です。\nよなべPerl 未経験者からIT企業への就労、フリーランス希望の方まで対象にし現実的なアドバイスをしながら、webアプリケーション開発を通じてプログラミングスキルアップをしてゆきます。 よなべPerlとは : よなべPerl\nMoo とは Moo は、Perlでオブジェクト指向プログラミングをするときには、とても便利なモジュールです。\nMoo is an extremely light-weight Object Orientation system. It allows one to concisely define objects and roles with a convenient syntax that avoids the details of Perl\u0026rsquo;s object system. Moo contains a subset of Moose and is optimised for rapid startup. Moo - Minimalist Object Orientation (with Moose compatibility) - metacpan.org\nオブジェクト指向プログラミングで欠かせない継承だけでなく、委譲についても Moose や Mouse と同じような記述で、簡単に実装ができるようになります。 動作も軽いので、コマンドラインツールにも適しています。\nMoo の簡単な使い方 MyApp.pm というモジュールに foo というアクセサを定義するには以下のようにします。\n1 2 3 4 5 6 package MyApp; use Moo; has foo =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;); 1; このように定義した foo は以下のように使うことができます。\n1 2 3 4 5 6 7 use strict; use warnings; use MyApp; my $app = MyApp-\u0026gt;new; $app-\u0026gt;foo(\u0026#39;bar\u0026#39;); print $app-\u0026gt;foo; 簡単でしょ？\n勉強会の内容 今回の勉強会は、仕事でもお世話になっている、福岡のフィールズさんの事務所で開催しました。\n株式会社フィールズ｜福岡でWebシステムの提案、開発、保守を行っています 内容としては、 Moo::Role を使った「委譲」をメインにしました。 資料はこちらです。\nmeetups/20160218-yonabe-perl.md at master · nqounet/meetups meetups/examples/20160218-yonabe-perl at master · nqounet/meetups 継承だけでは表現（実装）が難しいクラスの関係を、委譲を使ってどのように実装するのかということを、実際に委譲（というか Moo::Role ）を使って作成したフレームワークを題材に喋りました。 フレームワーク自体は継承だけでも可能な構造になってしまったので、委譲の必然性には欠けてしまったのですが、実装例としては参考にはしていただけるのではないかなと思います。 これからプログラミングを勉強する方は、オブジェクト指向プログラミングを避けて通るのは逆に難しいと思いますので、 Perl で実装するなら Moo(::Role) を使って書いてみるのはいかがでしょうか？\n","date":"2016-02-21T15:09:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/21/150920/","title":"よなべPerl で Moo について喋ってきました"},{"content":"おはようございます。 若林（@nqounet）です。\n2月18日（木）の19時から、Mooを使ったPerl5のオブジェクト指向プログラミングについて喋ってきます。\nよなべPerl ／ 「一歩すすんだオブジェクト指向アプローチ Moo」 on Zusaar Perlのモダンなオブジェクト指向 いつまでモダンと言っていいのかよくわかりませんが、少なくともblessを直接書くようなことはやめましょう的な話を、去年の9月に、同じ勉強会で喋ってきました。\nよなべPerl 「近代的なオブジェクト指向的アプローチ Moo」 on Zusaar 今回はその続編的な位置づけになります。\n主なキーワードとしては、「継承」と「委譲」になると思います。\nよなべPerl ／ 「一歩すすんだオブジェクト指向アプローチ Moo」 on Zusaar 皆さまのご参加をお待ちしております。\n","date":"2016-02-08T22:33:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/08/223333/","title":"福岡でPerlの講座を開催します"},{"content":"おはようございます。 若林（@nqounet）です。\nナレッジサロンの会員になってから、かれこれ1年近く経つのですが、今でも月に数回利用する程度なのでもっと活用したいと思っています。\nということで、「すいもく会」というのを始めます。\nこちらで参加者を募集しています。\nすいもく会 #1 - すいもく会 | Doorkeeper 一人だと怠ける そもそも、ナレッジサロンには行っても行かなくても（自分以外には）誰にも影響がないので、ほとんどの場合は行かない、というふうになります。\n自宅で致命的に仕事ができなければそうでもないでしょうが、そこまででもない場合は、外出すること自体がハードルになるのでなかなか外出するまでにいたりません。\nなので何かイベントをやればいいのだ、ということで何か開催しようと考えました。\nただ、イベント自体もちゃんと何かしようとすると大変なので、各個人で課題を消化するようなもくもく会がこの場合だと最適解だなと。\nちょっと後ろ向きですが、そもそももくもく会自体がそういう趣旨だろうということで良しとしましょう。\nすいもく会 #1 - すいもく会 | Doorkeeper ","date":"2016-02-08T00:04:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/08/000401/","title":"すいもく会（水曜日にもくもくする会）始めます"},{"content":"おはようございます。 若林（@nqounet）です。\n昨晩、グランフロント大阪のナレッジサロンにて、Perl鍋を開催してきました。\n「Perl鍋」は、Perlでなにか作る勉強会、です。\n#Perl鍋 #12 - connpass 実際に、なにか作ってなかったとしても、です。\n雑談からのプチ講座 というわけで、今回は私も含め4名での開催となりました。 軽く自己紹介してからの雑談の中で、「Perlでのテスト駆動開発」についての話題になり、それではということでプチ講座をしていただきました。\nプチ講座が始まりました\n#Perl鍋 pic.twitter.com/ExD0bDHhyj— Nobutaka Wakabayashi (@nqounet) 2016, 2月 4\n話していただいたのは、@sago35tkさん。 受講生はその他3人です。 Perl入学式でやっている内容は、一つのファイルですべてが完結するのですが、その調子でプログラミングを続けていると、ちょっと規模が大きくなってくると、すぐに行き詰まってきます。 なので、何かを作るときは、まずはディレクトリを作って、その中に必要なファイルを作成していく、という手法が取られます。\nテストは「t」に、実行用のモジュールは「lib」に置きます。 Perlの場合は、こういう法則に従ってファイルを配置していくと、既存のツールの恩恵が受けられるので、そういったルールを覚えて作ると何かと便利です。\nMinillaもそういったツールの一つで、ひな形の作成からテスト、さらには作ったモジュールをCPANへアップロードする（PAUSE のアカウントが必要です）ことも簡単にできるようになります。\nMinilla - CPAN module authoring tool - metacpan.org ある程度のルールを覚えるだけで便利なツールが使えるようになるので、いろいろと便利ですよ。 資料はgithubにアップロードしていただきました。\n#Perl鍋 でTDD(テスト駆動開発) の話をした際のファイルを置きました。https://t.co/2cVjKAIhm2— takasago ( \u0026gt; @sago35tk) 2016, 2月 4\nディレクトリごとソース管理すると、更新履歴も確認できて良いことだらけです。 ソースコード管理は、今ならgitを覚えるのが最も良いと思います。 もし、ソースコードをzipアーカイブにして日付で管理したりしているとしたら、ほんの少しコマンドを覚えるだけで毎日の仕事が簡単になりますよ。\n次回のPerl鍋 次回は4月の木曜日に開催する予定です。 今回も第1木曜日ということで、第2か第3木曜日開催の法則が有形無実な感じなので、どこかの木曜日に開催したいと思っています。 3月は年度末で忙しそうということもありますが、Kansai.pmを開催します ので、そちらをメインにしたいと思っています。 では、次回の告知をお楽しみに！\n参考になる資料 PAUSE: menu Perl鍋 #Perl鍋 - connpass ","date":"2016-02-05T08:12:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/05/081227/","title":"#Perl鍋 第12回を開催してきました"},{"content":"おはようございます。 若林（@nqounet）です。\nこの前の土曜日は、Perl入学式でした。\nPerl入学式 in大阪 第5回 〜Webアプリ編〜 - Perl入学式 in大阪 | Doorkeeper 今回は私が講師をしました。\nPerl入学式とは Perl入学式は、「プログラミング未経験者」から「Perl初心者」を対象としたPerlのワークショップです。\n手厚いサポートが特長で、わからないことがあればサポーターがだいたい解決まで導いてくれます。\n詳しくは公式サイトをご覧ください。\nPerl入学式 | Perl Entrance Webアプリ編について 例年は、Webアプリ編は第6回目に実施するのですが、今回は実験的に5回目で実施しました。\nウェブアプリケーションフレームワーク（WAF）として、Mojoliciousを触ったのですが、これまでの内容とはガラッと変わるので、戸惑いも多かったのではないでしょうか？\nMojoliciousも機能がたくさんあるので、一度にすべて覚えることは不可能ですし、覚える必要もないと思います。\n大事なのは、必要になった時に調べられるようになることです。\n第4回までは、基本としてさらっておく必要があることばかりですが、後半の2回は、これからどのようにして学んでいくか、という方向性も示すことができればなと。\nそういうことを考えながら、今回もいろいろと余談も交えて話ができたのではないかと思います。\n最後の改造で、ちゃんと完成しなかったコードを完成させて資料のリポジトリにアップロードしています。\nworkshop-2015-05/BBS at master · perl-entrance-org/workshop-2015-05 懇親会！ Perl入学式の醍醐味は懇親会と言っても過言ではありません。\n懇親会に参加しないで帰るのは、例えるなら、ラーメンを麺と具材だけ食べるようなものです。\nスープも飲み過ぎは体に毒ですが、スープも味わってこそのラーメンです。\n懇親会では、本編では質問しにくいこと、例えばあまり本編には関係なさそうなことだったり、進行の邪魔になりそうなことだったり、を遠慮なく聞くことができます。\n私達サポーターも、ただ集まって飲むというだけでなく、本編の内容について吟味したり、意見の交換をしたりといった反省会のような部分もあります。\nそうした積み重ねが、今のPerl入学式を作っています。\nまた、Perl入学式を完走した人が、次のステップとしてなにかしたい時にはどうすれば、というような話題から、なにわPerlやPerl鍋のような勉強会が生まれたりしています。\nなにわPerl | Doorkeeper #Perl鍋 - connpass 直近では、2月4日にPerl鍋があります。\n#Perl鍋 #12 - connpass 短い時間ではありますが、参加者の歩んできた環境によって困ったことがあったりして、いろいろと面白い話を聞くことができたりします。\nただ単に勉強するだけでなく、いろいろなシチュエーションでの使われ方を知ることができますよ。\n","date":"2016-02-02T08:40:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/02/02/084059/","title":"Perl入学式（Webアプリ編）で講師をしてきました"},{"content":"おはようございます。 若林（@nqounet）です。\nKansai.pmのウェブサイトがシンプルにリニューアルしました。\nKansai Perl Mongers Website リニューアルに至った恥ずかしい経緯 私が現在代表をしている Kansai.pm のウェブサイトは、もともとFSWikiというシステムで作られていました。\nFrontPage - FreeStyleWiki CGIで動作しているのが古さを感じさせるので、リニューアルしようという話がかなり前からあったのですが、当時はPerl製の使いやすいシステムもなく、なかなかその機会がありませんでした。\nしかし、先日、ちょうど新しいサイトを立ち上げようとしたときに参照したら、なんとサーバーにアクセスできなくなっていました。\n原因はよくわかりませんでしたが、この際、ちゃんと把握できるようにしようと思ったのです。\n最近の使いやすそうなウェブ構築システム もともとのシステムの要件としては、複数人で管理できることが最優先でした。できればPerl製であればなお良し、という感じです。\n当時はあまりなかったのですが、最近はなかなか良い物があります。\nPerl入学式でも使用していて、Gotanda.pmでも活用されている、Rijiです。\nSongmu/p5-Riji gitで管理する事ができるのと、github pagesとの相性が良いのが決め手です。\n仕組みもシンプルだし、Markdownで記事を書くことができるのもいいですね。\nウェブサイトの管理方法 Rijiはローカル環境で、静的ファイルで構成されたウェブサイトを生成することが可能です。\ngithub pagesと相性が良いのはそのためです。\nただ、出力したファイルを同じリポジトリで管理すると、元になっているMarkdownファイルなど（ウェブのソースコード）もウェブサイト上に存在してしまいますので若干微妙かなと思っています。（Perl入学式のサイトがこの方法です）\nGotanda.pmの管理方法は、生成されたディレクトリをgit-pushdirというツールを使って、ウェブサイトのリポジトリにpushするようです。（使ったことがないので想像ですが。）\nkazuho/git-pushdir ただ、生成されたファイルもソースコードと同じリポジトリで管理されており、管理が二重になるのが若干微妙かなと思っています。\nKansai.pmでは、git submoduleを使用して、生成されたファイルをsubmodule内に生成して管理しています。\n若干コマンドが面倒（特にcloneしてからのsubmodule管理）なので、そこはDaikuでまとめてしまいました。\nkansai-pm/website まだ、複数人での運用をしていないので何かしら問題はあるかもしれませんが、今のところうまく動いています。\n最近のpm.orgのDNS管理方法 さて、ウェブサイトの方は解決したので、問題はDNSの方です。\nとりあえずメーリングリストでざっくり訊いてみると、最近はgithubでDNSの管理もやっているようでした。\nperlorg/www.pm.org 英語が苦手なので、変更が一度で済むように連絡先などの情報も書き換えてプルリクエストを送りました。\nAlter DNS for kansai.pm.org by nqounet · Pull Request #76 · perlorg/www.pm.org 反映が結構早かったので驚きました。言葉が少なくても、だいたい汲みとってくれる文化がありがたいです。githubで管理している甲斐がありますね。\n","date":"2016-01-07T07:35:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2016/01/07/073526/","title":"Kansai.pmのウェブサイトをRijiで作った話、または最近のpm.orgの管理方法"},{"content":"おはようございます。 若林（@nqounet）です。\nJSON::RPC::Specをアップデートしましたのでお知らせいたします。\nJSON-RPC-Spec-v1.0.5 - Yet another JSON-RPC 2.0 Implementation - metacpan.org JSON::RPC::Specとは ひとことで言うと、JSON-RPCの仕様のJSON文字列を解釈して結果を返すモジュールです。 詳しくは過去のリリースの時に書いたエントリーをご覧ください。\nCPAN Authorになりました | IT Office Nishimiyahara JSON::RPC::Specをバージョンアップしました | IT Office Nishimiyahara 全くの偶然なのですが、仕事でJSON-RPCの仕様で通信を行う機会がありました。 ただし、通信を暗号化する必要があったり、既存のアプリが持っているデータも使いたいので、アプリの中に組み込めるこのモジュールを使っています。 ただ、実際に使ってみると、要求された仕様で動くように書いていくのは結構大変でした。 特に、任意のエラーを出すことを想定していなかったので、微妙なハックで対応したのですが、とりあえず喉元過ぎれば熱さを忘れるとかいうやつです。 で、それ以外に、どう頑張っても無理そうな事があったので、今回はそれを実現するためにアップデートしました。\nアップデート内容の概要 JSON文字列を解釈（parse または parse_without_encode）するとき、その文字列以外にも変数を渡せるようにしました。 その変数は、ディスパッチャを定義（register）で定義する関数で受け取ることができます。\n詳細 このモジュールは使うタイミングによってメソッドが分かれています。 ひとつ目はディスパッチャの定義（register）、ふたつ目がJSON文字列を解釈する関数（parse または parse_without_encode）です。 ひとつ目のregisterは、methodによって動作を変えることを想定していて、Router::Simpleの機能を使って各クラス、あるいは関数へ処理を振り分ける定義をします。\n1 2 3 4 5 6 # method matching via Router::Simple $rpc-\u0026gt;register(\u0026#39;myapp.{action}\u0026#39; =\u0026gt; sub { my ($params, $match) = @_; my $action = $match-\u0026gt;{action}; return MyApp-\u0026gt;new-\u0026gt;$action($params); }); モジュールのregisterの説明部分にはこういう書き方をしています。 こうした場合に以下のようなJSON文字列をparseすると、\n1 {\u0026#34;jsonrpc\u0026#34;:\u0026#34;2.0\u0026#34;,\u0026#34;method\u0026#34;:\u0026#34;myapp.foo\u0026#34;,\u0026#34;params\u0026#34;:{\u0026#34;key\u0026#34;:\u0026#34;value\u0026#34;},\u0026#34;id\u0026#34;:\u0026#34;1\u0026#34;} MyApp.pmに書いてある foo 関数に対して +{key =\u0026gt; 'value'} というハッシュを渡す、というふうになります。 registerの第一引数にマッチした内容が $match に渡されるので、methodが「myapp.bar」であれば bar 関数に渡す、という感じです。 そして、ふたつ目のparseは実際のJSON文字列を渡すことで、実際に定義通りに動作する部分です。 この時に渡したい変数があっても、うまく渡す方法が思いつきませんでした。 なので、無理矢理押し込めました。\nサンプル 少ししっかり目のサンプルを書いてみました。\nhttps://github.com/nqounet/p5-json-rpc-spec/tree/master/examples/extra_args main.plを実行した時、parseの時に、以下のようにして変数を渡すと、\n1 2 # https://github.com/nqounet/p5-json-rpc-spec/blob/657ede22dd44be863281e8775602ce7c1e8d20c2/examples/extra_args/main.pl#L25 my $result = $app-\u0026gt;jsonrpc-\u0026gt;parse($json, $extra_args); ディスパッチ先（例としては、MyApp::Fooのbar関数）で受け取ることができます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # https://github.com/nqounet/p5-json-rpc-spec/blob/657ede22dd44be863281e8775602ce7c1e8d20c2/examples/extra_args/lib/MyApp/Foo.pm#L10-L22 sub bar { my $self = shift; my $params = shift; my $extra_args = +[@_]; +{ controller =\u0026gt; $self-\u0026gt;controller, action =\u0026gt; $self-\u0026gt;action, params =\u0026gt; $params, extra_args =\u0026gt; $extra_args, }; } Mojolicious::Lite のように1枚のファイルに書く場合は不要なのですが、ちゃんとクラスに分けて書こうとすると変数がなかなか渡しづらいので、こういう場面で使えるように考えました。\n実際に使おうとしている場面 Mojolicious でシステムを作っているのですが、そのシステムにJSON-RPCの方式で外部からアクセスできるようにしていたのです。 register は アプリ（Mojoliciousを継承しているモジュール） の startup のタイミングで定義しており、実際に処理したいJSON文字列は、コントローラー（Mojolicious::Controllerを継承しているモジュール）に実装しています。 この時、ディスパッチ先でコントローラーが持っているデータを使いたいと思ったら、なかなか難しいことに気づきました。 parseする時にコントローラーを渡すのが最も簡単だったので、今回は素直にこういう実装にしました。\nJSON-RPCをアプリに組み込むならJSON::RPC::Spec JSON::RPC::Specは、バッチについても対応しています。 つまり、完全にJSON-RPCに対応していますので、アプリでJSON-RPCをやるならJSON::RPC::Specが良いと思います。\n","date":"2015-11-16T08:36:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/11/16/083646/","title":"JSON::RPC::Spec v1.0.5 をリリースしました"},{"content":"おはようございます。 若林（@nqounet）です。 先日、Perl鍋を開催してきました。\n#Perl鍋 #8 - connpass Perl鍋の理想 「Perl鍋」は、毎月第3木曜日（第2の場合もあります）の19時から開催している「Perlで何か作る勉強会」です。\n#Perl鍋 - connpass Perlがある程度使えるようになっても、使わなければせっかくの知識を忘れてしまいます。 この勉強会を活用してプログラミングをより深く学んでいきましょう。\nPerl鍋の現実 実際のところ、何か作る、と言っても困ってしまう場合はあります。 私は、「Mooで覚えるオブジェクト指向プログラミング」という連載を温めているのですが、2ヶ月間手を付けていないのでそれを進めようと思って望みました。 どうすれば「オブジェクト指向プログラミング」への道が開けるのか、それの何が美味しいのか、というようなことを、知らない人に伝えるにはどのようにすればよいのか、というようなことについて意見を交わしました。 実際に記事は書けませんでしたが、会話の中でヒントはたくさん得られた気がするので、それを活かしていきたいです。 また、Perlを使うシーンは参加者それぞれで、私にとっても新しい発見が得られました。 一つ紹介すると、「use utf8」の環境では、正規表現の「\\d」は、全角数字にもマッチする、ということを知りませんでした。\n1 2 3 4 5 6 7 my $str = q{１２３}; # 全角数字 if ($str =~ /\\A\\d+\\z/ms) { say \u0026#39;\\d マッチ\u0026#39;; } if ($str =~ /\\A[0-9]+\\z/ms) { say \u0026#39;[0-9] マッチ\u0026#39;; } 個人的には、全角半角問わず「数字が書いてある」ことの検証が簡単になりそうなので、非常に嬉しい情報でした。 他には、オススメモジュールとして「Path::Tiny」「Time::Moment」を挙げておきました。\nPath::Tiny - File path utility - metacpan.org Time::Moment - metacpan.org 他愛のない話も多かったですが、会話の中から思ってもみない知見が得られるので、やはりこういう機会は貴重だなと思いました。\n懇親会 懇親会も、なかなか濃い情報が沢山でした。 バックグラウンドが違うと、困っているシーンも違っていて、一般的な解決方法では解決できない事もたくさんあることがよくわかります。 気がつけば終電間近になっており、いつものように時間は不公平だと感じながらお開きといたしました。\n次回 次回のPerl鍋は、10月15日（木）19時から開催いたします。\n#Perl鍋 #9 - connpass ご参加をお待ちしております。\n","date":"2015-09-18T12:44:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/09/18/124408/","title":"#Perl鍋 #8 を開催してきました"},{"content":"おはようございます。 若林（@nqounet）です。\n仕事の関係で福岡にしばらく滞在していたのですが、その間に「よなべPerl」という勉強会で講師をしてきました。\nよなべPerlとその主催者の紹介 「よなべPerl」は@hakata_oyuki さんが主催する勉強会です。\n未経験者からIT企業への就労、フリーランス希望の方まで対象にし現実的なアドバイスをしながら、webアプリケーション開発を通じてプログラミングスキルアップをしてゆきます。 よなべPerlとは : よなべPerl\n先日の勉強会については、既にレポートが書かれているのでそちらもご覧ください。\nよなべPerl 「近代的なオブジェクト指向的アプローチ Moo」 [2015-09-10] レポート : よなべPerl 私もそうですが、@hakata_oyukiさんも、もともとIT系の会社に勤めていたわけではなく、独学でプログラミングを勉強してきた方で、同じ道を志す若者にたいして教育の場所を作りたい、といつも熱く語っています。\n今回は、Perlでのオブジェクト指向プログラミングを、Mooというモジュールを用いて勉強しました。\n独学の壁 独学の難点は、壁にぶち当たった時にどうすればよいのかわからなくなることだと思います。\nオブジェクト指向を解説する例えとして人間や動物が使われることが多いと思います。おそらく、継承やクラス、インスタンスの概念についてはなんとなくわかった気になれると思います。\nしかし、それだけで掲示板のスクリプトをオブジェクト指向で書くことは難しいと思います。\n私がオブジェクト指向を学んでいた時は、何をオブジェクトにするのか、まるでわかりませんでした。掲示板の中にオブジェクトの概念を入れる方法がわからなかったんですね。\nオブジェクト指向のアプローチは、手順通りに作るスクリプトとはまるで違うので、どのように作るか、どのように使うかがわかりづらい。\nこういった時に、その壁を乗り越える方法を独学で導き出すのは相当大変だろうと思います。\nそんな壁でも、ちょっとしたアドバイスで乗り越え方がわかったりしますので、今回の勉強会がそのきっかけになれていれば嬉しいです。\n内容の振り返り Perlの場合は、その書き方もわかりづらかった。\nオブジェクト指向自体が抽象化できていなかったんですね。\n今回は、（希望もあったので）blessを使った従来のクラスの作成方法もやりましたが、Mooを使ったほうが圧倒的に作りやすいことを理解してもらえたようです。\n圧倒的に作りやすい、ということが実感できるのは良かったのですが、やはり時間を考えると省いても良かったかなと思っています。\nおかげで後半は座学中心になってしまい、かなり難易度が高くなってしまったと思いますが、何かしらの感触は得ていただけたようなのでホッとしています。\nまとめ 同じことがより簡単にできるようになるので、これからPerlでオブジェクト指向プログラミングを勉強するなら、blessについては全力でスルーしてMooを使いましょう。\nクラスを定義する時に使えるモジュールはMooだけではありませんが、用途に応じてちゃんと選べるようになるまではMoo一択で良いと思います。\nみなさんもMooを使ってオブジェクト指向プログラミングを楽しみましょう。\n","date":"2015-09-17T07:22:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/09/17/072209/","title":"よなべPerlで講師をしてきました"},{"content":"おはようございます。 若林（@nqounet）です。\nYAPC::Asia Tokyo 2015に行ってきましたので、色々と振り返ってみたいと思います。 自宅に返ってきてからは、のんびりとイカタイムを楽しんでいたのですが、こんなツイートを見かけてしまいました。\n確かに忘れそうだったので、今年もYAPCをちゃんと終わらせようと思います。 ちなみに、splatoonの腕前とかはこんな感じです。（見えるのかわかりませんが）\nnqounet@splatoon イカ、よろしく〜〜〜。\nDay -1 自分自身では意識してなかったのですが、妙にテンションが高いと妻に指摘されました。\nDay 0 道順が不安だったのでざっと道順を動画で確認したつもりでしたが、何故か「西」という言葉に惑わされて建物に入ってから5分ほど道に迷ってしまいました。 今年も個人スポンサーで申し込んだので、ピンクのストラップのホルダーが入場券代わり。\nさて、前夜祭は呑みながらセッションを聴いたりできる、ゆるい感じが特徴で、今年もゆるい感じではあったのですが、トークはなかなかガチな内容で結構メモってしまいました。 ただ、呑みながらなのでよく覚えてはいません。\n@uzulla さんのPHP話は、その場のノリが重要（ほとんど理解してない）でしたし、その次の@5kozawa さんは、その流れを完全に変える自然言語処理のガチな話（半分以上分かってない）で、最後に聴いた@tagomoris さんの話も、沢山頷きながら聴いていたのですが、すでに酔っていたようでメモを読み返しても、全部英語で書く、とか、プラガブルな機構、とか、ナニコレ状態で涙目です。\nでも、久しぶりに会った人にご挨拶したりして、YAPCに来たんだな〜と、いい感じになってきました。\nDay 1 若干寝坊気味だったのですが、なんとかギリギリオープニングに間に合いました。 いよいよ高まってきました。 最初のトークはPerlを生み出したラリー・ウォール氏。 英語も断片的には理解できているつもりですが、同時通訳を聴いていると全然足りてない感じです。 Perl6は、これまでは「使うことはないだろうなぁ」と思っていましたが、トークを聴いて逆に使ってみたいと思いました。 単純ですねw\n懇親会で一緒に写真を撮ってもらったのは良い記念になります。 クリスマスが待ち遠しいです。\n他には、@kazuho さんのHTTP/2（むしろH2O?）の話を聴いて近い将来に備えたり、現状の課題でもあるリモートワークの話（@cwest ）を聴いたりしました。\n日本では、一時期（東日本大震災のあとしばらく？）交通機関の影響を考えてリモートワークを実施していた会社もあったように記憶しているのですが、最近はあまり聞かない（あるいはその手の記事をキャッチアップできていないだけかも）ので、リモートワークの知見が得られたのは収穫です。 聴こうと思っていたトークで、立ち見もできないほどに混雑していて門前払いされたりしたのは残念ですが、その辺は動画を待ちたいと思います。 懇親会は人多すぎで、ついつい小さくまとまってしまったのですが、それでも関西からの参加者にKansai.pmとかPerl鍋とかの話をしたりしているうちにお開きになりました。 あっという間に3時間弱が経っていて驚きでした。\nDay 2 この日も、人気のトークは中に入れないレベルだったので、ほとんどメインの国際会議場と無限コーヒーのコンボで過ごしました。 しかし、よく考えて見れば、Dockerの話やリファクタリングの話は同時通訳がなければ微妙なニュアンスなどはわからなかったと思います。 結果的には、メインのホールにいたおかげで開発に関するいろいろな知識が得られたと思います。 小さい部屋（と言っても200人は入れそう）で聴いたのは、@koemuさんの業務改善の話です。 基本的には、インフラをプログラミングしたかったのです。 この業務改善の話は、内容としてはエンジニア向けではありますが、組織についてのノウハウでした。 私が以前いた会社（不動産業の会社）でも同じように問題はあって、私は、失敗談を自分自身の出来事に重ねつつ聴いていました。 今はある程度年を重ねてきましたが、今、同じような状況になっていたら、もしかすると上手く立ち回れるかもしれません。 最後の質問の内容を聴いていると、質問者の方々も苦労していそうな感じでした。 どのようにして上司の信頼を得て、そして上司を動かせるようになるのか。 一応Perlのカンファレンスだったように思うのですが、このような組織についての知見が得られるとは思いませんでした。\nこの後、LTへ向かうときに、@issm さんと会い、LTの後に@wakegisky さんと合流して、YAPCには参加していなかったNagoya.pmの@clairvy さんや@iwata1985さんと、東京駅の近くで呑みました。\n@wakegisky とはホテルが近かったので、途中まで一緒に帰ったのですが、YAPCなくなるの寂しいですね〜、とか、Kansai.pmにも来てくださいね〜、とか、Perlの話で盛り上がりました。\nDay 3 この日は大阪に帰る日だったのですが、yapcasia.orgのお知らせを見るとMicrosoftさんで実施されるハッカソンがありました。 しかも、午前中にトークがあるということで、貴重な話も聞くことが出来ました。 electron使ってみたい。 飛行機の時間があったので、途中で抜けてきました\nまとめ YAPCのPはProgrammingのP！ Perlにかぎらず、Programming言語全体のカンファレンスだったようです。\n","date":"2015-08-25T06:27:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/08/25/062743/","title":"YAPC::Asia Tokyo とPerlと私 #yapcasia"},{"content":"@nqounetです。\nYAPC::Asiaも近いということで、2年以上ぶりに小規模ではありますがKansai.pmを開催してきました。\nuse Kansai::Tiny v0.0.1 - Kansai::Tiny.pm | Doorkeeper 開催のご報告 東京から、Perl入学式の校長である @__papix__ 氏が来阪するということで、急遽開催を決定したのですが、そこそこ盛り上がったのでホッとしています。\n会場のナレッジサロンは、会員になっていると10人までゲストを呼べるので、それを利用しました。\n人数は少ないにしても、自由に使える会場があるのはフットワークが軽くなってよいですね。\n一応発表もしたので、（資料はこちらです。→ https://github.com/nqounet/meetups/blob/master/talks/20150808-kansai-tiny-pm.md ）内容については改めて書くつもりです。\n","date":"2015-08-09T17:35:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/08/09/173536/","title":"Kansai.pmの小規模版、Kansai::Tiny.pmを開催してきました"},{"content":"@nqounetです。\n何故か変にはまってしまったことがあったので、またうっかりしないようにメモしておきます。\n配列を返すメソッドを呼ぶ時に、安全策のつもりでこんな感じで書いてました。\n1 my @array = $self-\u0026gt;array || (); $self-\u0026gt;array が失敗した時に空の配列にしたかったのですが、これが罠でした。\n以下のコードを実行してみるとどのようになるでしょうか？\n1 2 3 4 5 6 7 sub array { my @array = (1, 2, 3); return @array; } my @array = array() || (); print \u0026#34;@array\u0026#34;; 実行すると、画面に表示されるのは 3 になります。\n1 2 3 4 5 6 7 sub array { my @array = (1, 2, 3); return @array; } my @array = array(); print \u0026#34;@array\u0026#34;; 安易に補完せず、このように書くと 1 2 3 という表示になります。\n配列を期待しているところでは、返り値だけでなく、返り値がなかった時の対策についてもちゃんと考えておきましょう。\n","date":"2015-07-24T11:36:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/07/24/113602/","title":"Perlで返り値を安易に補完しない方が良かった話"},{"content":"@nqounetです。\n博多の人気ラーメン店「博多一双」に行ってきました。\n人気店はダテじゃないなという出来事もあったので、紹介したいと思います。\nロケーション 博多駅の筑紫口から、都ホテルの南の筋を南東へ向かって歩いて5分ほどのところにその店はあります。\nさらっと紹介 2013年,2014年の「食べログ ベストラーメン」に選ばれたりしているようです。\n日曜日のお昼時ということもありましたが、生憎の雨にもかかわらず行列が減らないお店でした。\nお店が見えるかなり手前から、豚骨の匂いがただよってきます。\n最初に食券（自動券売機が店内にあります）を買ってください、とデカデカと看板があるのですが、わりと守っていない人が多いです。（行列でその看板が隠れてしまうのが原因でしょう）\nなので、先に買ってから並ぶと余計に待つことになります。特に一人の場合は。\n知らない顔をして並んでおいて、食券を先に買ってください、という案内があってから買いに行くほうが良いと思います。\n食券を持って待っていると、店員さんが麺の硬さを訊いてきます。（多くの場合は、この時に食券を買いに行くことになるでしょう）\nそうすると、店内に案内されると既に水が置いてあって、席についてしばらくするとラーメンが提供されます。\nスープはかなり深みがありました。\n外で待っているときは、気持ち悪いくらいに豚骨臭がするのですが、スープはかなりあっさりしているように感じます。\nしかし、後から豊かな風味が、鼻の奥の方に感じられました。飲み込んだスープが食道に張り付いているかのように、長く味わいが続きます。\n普段はスープは一口くらいですが、思わず三口ほど飲んでいました。\n麺の硬さは、私には硬めで調度良かったです。熱さはあまり感じなかったのですが、後で気がついたのですが口の中が火傷していました。\nこの店に入る直前には、そんなにお腹が減ってない（朝食べてから2時間も経ってない）のに、思わず「替玉」と言っていました。\n人気店の秘密（？）その1 私は先に食券を買ったのですが、どうやらその後に並んでいた人がいたようで、後から食券を買いに行っていました。\n私は食券を持っていたのですが、その時、私に対して、元の場所まで戻って大丈夫ですよ、と声をかけてきました。\n人気店の秘密（？）その2 帰っていくお客さんの中に、傘を持って行かれた方がいました。\n話を聞いていると、買ったばかりのビニール傘のようでした。\nすると、店員さんが店用の傘と思われる傘を奥の方から持ってきて、これを持っていってください、と渡していました。\n人気店の秘密（？）その3 店内に入って席につく前に、トイレに行った方がいました。\n着席のタイミングに合わせて麺を茹でているので、わりとすぐに提供されるので、トイレに行っている最中に提供されていました。\nその方はしばらく入っていたようで、席に戻ってきた時に店員さんが、（冷めた）ラーメンを作り直しますね、と言ってラーメンを下げていきました。\n感想 スープは泡立っているのですが、あっさりしているのに深い。\n替玉の後は、ラーメンダレを入れたり、にんにくを入れたり、辛子高菜を入れたりしたので、最後のスープはまた味が違っていたのですが、最初に飲んだスープは本当に美味しかった。\n博多のとんこつらーめん｜博多一双｜博多駅徒歩5分 私の位置からは厨房がよく見えたのですが、連携プレイが素晴らしかったです。\n新しいお客さんが店内に入ってくると麺を茹で始め、茹で上がるころにはスープが入った丼が用意されており、華麗な湯切りから麺が丼に入ると同時に麺をスープに馴染ませ、具材を手早く盛りつけて出来上がり。\n特に湯切りは見てて楽しい。麺が宙に浮いているのにあまり麺を見ていない（店内をよく見ていました）のがすごいですね。\n博多に行ったらまた行きたいと思っています。\n","date":"2015-07-06T07:35:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/07/06/073535/","title":"博多一双に行ってきました"},{"content":"@nqounetです。\nmysqlで運用しているサービスで、1日に2,3回ほどDeadlockによってエラーが発生するという問題がありました。\nその問題が解決したのでメモを残しておきます。\n最初にまとめ mysqlのInnoDBでdeleteするのは、削除対象のレコードがある場合のみにする必要がある。\ndelete時に対象レコードがない場合、ギャップロックがかかりinsertが通らなくなる。\n実装のちょっとした手抜きが頭を悩ます、という良い（悪い？）例になった。\n参考 【MySQL】InnoDBのロック関連まとめ - Qiita まずかった実装 モデルケースとしてはupdateをdelete-\u0026gt;insertにしていた感じの部分。\nイメージはこんな感じ。\n1 2 3 sub update { shift-\u0026gt;delete（条件）-\u0026gt;insert（新しい行）; } 書き込む行数が変わる場合があるので毎回deleteしてからinsertしていた。\n最初はinsertとupdate（delete-\u0026gt;insert）を別々で使っていたんだけど、前処理を共通化して、insertのみの場合でもupdateするようにした。\n何が問題だったか ここで結果的に問題になったのが、最初に作成する時。\n最初に作成する場合はdelete対象がない。\nそのためinsertを通さないロックがかかってしまい、たまたまinsertのプロセスとかぶった場合にDeadlockが発生していた。\nとりあえずの解決策 最初に作成する場合はdeleteしない、という方法もあったのですが、より汎用化するため、deleteの処理を変えることにしました。\n1 2 3 4 5 6 sub delete { my @rows = shift-\u0026gt;select(条件); for my $row (@rows) { $row-\u0026gt;delete; } } 一見、冗長な気がするのですが、一旦条件に合う行を抽出してから削除することで適切にロックがかかるようになり、Deadlockによるエラーが再現しないようになりました。\nあとからこの部分を見た時、冗長だなーと思って単純なdeleteに戻しそうなので注意する必要がありますね。\n","date":"2015-07-04T15:27:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/07/04/152707/","title":"mysqlのロック方法について一つ賢くなった"},{"content":"@nqounetです。 2年ぶりに #Perl鍋 というPerlの勉強会を開催しました。\n開催してきました #Perl鍋 #6 - connpass Perl鍋は、会場をグランフロント大阪の北館にあるナレッジサロンに変更して、再度始動しました。 今回は私も含め2名でした。 @tomcha_さん、ありがとうございました。 @tomcha_さんは、Perl入学式のサポーターでもあり、なにわPerlを主催されています。\nなにわPerl | Doorkeeper 主催者として会場に苦労するのは一緒なので、ナレッジサロンを売り込んでおきました。…雑談程度ですが。 内容は、雑談とコーディングが半分半分という感じでした。 自分自身の気付きとしては、気がついた時には知っていた、というか、できるようになっていた、ということが沢山ある、ということでした。 新しいことでも、何度も何度も意識して反復して書いていることで、気が付くと自然に書けるようになっている、ということが雑談の中から感じられたことが何よりも成果でした。 皮肉にも、その実感は自分自身が否定してきた（地味な反復作業が大嫌い）ことなので、これまではこのような気づきを無視してきたかもしれません。 簡単なこと、地味なことでも、何度も繰り返してこそ本当の意味で身につき、それまでと違った角度から解釈できるようになるのだろう、と思います。 さて、時間中には Slack にメッセージを投稿するプログラムを作っていました。 ターミナル向けに文字コードを自動変換するようにしていたのをすっかり忘れていて、最初のうちは文字化けに苦労してしまいました。 なんでも自動化するのは良し悪しですね。 結構便利だなと思ってモジュールっぽくしたら、実は既に存在していたというオチでした。\nWebService::Slack::IncomingWebHook - slack incoming webhook client - metacpan.org コマンドラインツールまで付いているというね。 まあ、簡単な再発明も学びにはなります。 今回はHTTPのクライアントにHTTP::Tinyを使ってみたかったのと、Mooの理解をさらに深めたいと思って書いてみたのですが、Mooも奥深いですね。\nHTTP::Tiny - A small, simple, correct HTTP/1.1 client - metacpan.org Moo - Minimalist Object Orientation (with Moose compatibility) - metacpan.org Perl鍋について簡単に Perl鍋 - connpass Perl鍋は、2年半ほど前に、Perl入学式の次のステップの勉強会として始めた勉強会です。 5回ほど開催したころ、会場にしていた新大阪コワーキングを閉めたので、それ以降2年ほど期間が空いてしまいました。 これから毎月第2か第3の木曜日の夜に開催する予定ですので、予定を開けておいてください。\nPerl入学式について簡単に Perl入学式 | Perl Entrance Perl入学式は、プログラミング未経験者でも参加できる（ついていける）勉強会、というのが売りのひとつの勉強会です。 開始した頃はコアメンバー（サポーター）のボランティアと若干の参加費で活動していましたが、今はJPAというバックボーンと、（まだ少ないですが）スポンサーとなってくれている企業や個人のおかげで、参加費については無料で成り立っています。 今年度からは第4期となり、さらにサポーターも増えたので、ますます手厚いサポートができるようになりました。 ほんの僅かかもしれませんが、プログラマ人口の増加に寄与している勉強会だと思っています。\nプログラミングは経験が必要 仕事としてのプログラミングと、趣味のプログラミングは色々違うところもあるのですが、共通するのは経験が大切だということです。 関西のPerl界隈は、Perl入学式でプログラミングの基礎を作り、Perl鍋やなにわPerlでその基礎知識を更に発展させつつ、Kansai.pmで、他の（職業｜趣味）プログラマーと情報交換しましょう。 最後に、2年半前の決意表明を。\n#Perl鍋 という勉強会をやりますよ | IT Office Nishimiyahara では、また来月、Perl鍋でお会いしましょう。\n","date":"2015-06-14T15:30:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/06/14/153007/","title":"第6回 #Perl鍋 を開催してきました"},{"content":"@nqounetです。\n大阪駅直結の大丸梅田店に、噂の「ずんだシェイク」が飲めるところがある、ということで行ってきました。\n訪問 大阪駅の1Fの中央改札を出て南（地図が苦手な方は、改札を出て右）の方へ行き、エスカレーターを降りると両側の店が大丸梅田店です。\n「ずんだシェイク」が飲める「ずんだ茶寮」は右手の方にあります。\n右手の方を気にしながら歩いて行くと、ちょっとした案内板があるので、そこを進むと目的地「ずんだ茶寮」です。\n全体で10人ほどが待っていたようですが、皆さんお土産を選んでいるのか、それとも決めかねているのかわかりませんが、店員さんが呼んでも誰も進まないので、さっとシェイクを注文をしました。\nどうやら、商品待ちとシェイク待ちっぽくなっている感じですが、そのへんはまだうまく機能してない感じですね。\n「ずんだシェイク」は少し時間がかかるようなので、その間に「ずんだ餅」を買おうと思って持ち歩ける時間を訊いてみると、次のような感じでした。\nずんだ餅は冷凍してあり、今の季節は常温解凍で3時間後が食べごろ 保冷剤入の保冷バッグがプラス108円で、その状態だと7時間後が食べごろ 売り切れるか心配だったのですが、訊いてみると一応大丈夫そうだったので、結局19時頃にまた来て買うことにしました。\nというようなところで、シェイクが出来上がったようです。\n実食 ずんだは、この食感がいいですね。\n細かくなっていても歯ごたえが感じられるというか、柔らかいのにザラザラな感じ。\nバニラの激甘な感じと、ずんだの控えめな甘さがちょうどいい感じに混ざって、最初はかなり冷たくて甘さ控えめに感じるのですが、徐々に手の熱で程よい冷たさになると、本来の甘さが現れてきます。\nしかし、その頃にはもうなくなっているのが凄いところです。\nずんだシェイクは288円（税込み）で、他の製品に比べてもお安いので、ずんだ体験にはちょうど良いと思いますよ。\n再訪問 …というわけで、19時過ぎにやってきて、ずんだロールとずんだ餅（6個入り）を買って帰りましたとさ。\nちなみに、ずんだロールは1188円、ずんだ餅（6個入り）は865円（税込み）です。\n","date":"2015-06-11T11:03:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/06/11/110341/","title":"噂のずんだシェイクを飲みました"},{"content":"@nqounetです。\nかなり久しぶりにgitolite を触る機会があったのですが、うっかり管理者用の鍵をなくしてしまった（環境が変わっていたのに鍵を移植していなかった）ので、gitolite -adminのpushができずかなり焦ってしまいました。\n落ち着いて対処すれば大したことではないので、記録を残しておきます。\n管理者用に鍵のペアを作成 まずは、新しく鍵のペアを作ります。\n普段使っている鍵を用いると何かと不便なので、管理者（ここではadmin）用に新しい鍵を作成します。\nローカル環境で、ssh-keygenコマンドを使うのが良いでしょう。\n1 $ ssh-keygen -t rsa -f ~/.ssh/gitolite-admin これで、~/.ssh/gitolite-adminと~/.ssh/gitolite-admin.pubというファイルが出来ます。\n公開鍵をサーバーへ転送 gitoliteが動作しているサーバーの作業用ユーザーを使って、できたファイルをサーバーに転送します。\ngitoliteが動作しているユーザーでログイン出来る場合は直接転送してもよいですが、おそらくそのような運用はしていないと思いますので、面倒ですが一旦作業用ユーザーを介することになるでしょう。\n1 $ scp ~/.ssh/gitolite-admin.pub user@host:./admin.pub この時に、ファイル名をadmin.pubに変更しておくと後で名前を変更する手間が省けます。\n公開鍵をgitolite用のユーザーに渡す 転送が終わったら、sshでログインします。\nログインしたら、先ほどの公開鍵をgitolite用のユーザー（ここではgitolite）のホームディレクトリに移動します。ファイルの所有者を変更しておく必要もあります。\n1 2 $ sudo mv admin.pub /home/gitolite $ sudo chown gitolite:gitolite /home/gitolite/admin.pub これでようやく準備が出来ました。\nユーザーを切り替えてgitoliteコマンド gitoliteユーザーに切り替えて、adminの公開鍵を更新するコマンドを実行します。\n1 2 $ sudo su - gitolite $ /path/to/gitolite setup -pk admin.pub gitoliteコマンドのsetupは、初期化だけでなく公開鍵の更新も行うことができます。\nこの時に気をつけるのは、公開鍵の名前がgitoliteでのユーザー名になることです。\ngitoliteでは、gitolite-adminリポジトリのkeydirにユーザー用の公開鍵を入れておくのですが、setup -pk 公開鍵 とすることで、keydirに公開鍵を転送してcommitした事になります。\nそのため、上記コマンドでadmin.pubを入れ替えることができる、というわけです。\ngitoliteは慣れれば簡単 gitoliteは、次の2点さえ忘れなければ、仕組みも単純なので、プライベートなソースコード管理には最適です。\n管理ユーザーと一般ユーザーの鍵を別にしておく 公開鍵の名前がユーザー名になる 大人の事情で、bitbucketやgithubなどのサービスが使えない場合は是非お試しください。\n参考になる資料 sitaramc/gitolite ユカイ、ツーカイ、カイハツ環境！（26）：Git管理の神ツール「Gitolite」なら、ここまでできる！ (1/2) - ＠IT gitoliteインストール時のうっかりハマりパターン | IT Office Nishimiyahara ","date":"2015-06-06T14:13:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/06/06/141359/","title":"gitoliteで管理者の鍵をなくした時の対策"},{"content":"@nqounetです。\nPerlで、Redisを使ったメッセージキューシステムのResqueというモジュールを使ってみたのでメモしておきます。\n前置き 沢山のリクエストを処理するようなウェブアプリでは、少し時間のかかる処理をジョブキューやメッセージキューというようなキューシステムを使って処理することが多くなるでしょう。\n個人的にはQudoが好きでよく使っているのですが、NoSQLを使ったものはないのだろうかと探してみたら、Resqueというモジュールを見つけたので使ってみました。\nファイル群 キューシステムは、シンプルにしてもファイル数が多くなるので、慣れないうちは理解するのが大変だと思いますが、コレも慣れです。\n1 2 3 4 5 6 7 ├── client.pl ├── cpanfile ├── lib │ └── MyTask │ └── Echo.pm ├── main.pl └── worker.pl それぞれの役目 cpanfile cpanfileには、モジュールの依存情報、平たく言うと使っているモジュールを書いておきます。\nこのファイルを作っておくと、モジュールのインストールが簡単です。\ncartonを使わない場合でも、cpanm --installdeps .のようにすると、依存モジュールをインストールしてくれます。\n1 2 3 4 5 requires \u0026#39;Log::Minimal\u0026#39;; requires \u0026#39;Path::Tiny\u0026#39;; requires \u0026#39;Proclet\u0026#39;; requires \u0026#39;Resque\u0026#39;; requires \u0026#39;Test::RedisServer\u0026#39;; client.pl client.plは、キューを作成する、平たく言うと仕事を取ってくる役目を担います。\n会社で言うと、営業の方ですかね。仕事を取ってきて、キューに入れるところまでが役目です。\n書いていてちょっと気になったのは、argsが配列のリファレンスしか受け付けないことです。\nこういう時は、なんとなくハッシュリファレンスを渡したくなるのですが、受け付けてくれません。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/usr/bin/env perl use utf8; use strict; use warnings; use Resque; use Log::Minimal; my $resque = Resque-\u0026gt;new; my $count = 10; while ($count--) { $resque-\u0026gt;push( echo =\u0026gt; +{ class =\u0026gt; \u0026#39;MyTask::Echo\u0026#39;, args =\u0026gt; +[+{count =\u0026gt; $count}] } ); infof($count); sleep 2; } worker.pl worker.plは、キューを処理する、平たく言うと実際に仕事を片付けるのを担当します。\nキューに仕事がある限り、順番に処理するのが役目です。\nuse lib 'lib';しているのはちゃんと理由があります。\nworker.plは、ワーカーのクラスを自動的にロードして使ってくれるのですが、今回のディレクトリの構成では、libの中にワーカーのクラス（MyTask::Echo ）があるので、予めライブラリがlibにあることを書いておきます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/usr/bin/env perl use utf8; use strict; use warnings; use Resque; use Log::Minimal; use lib \u0026#39;lib\u0026#39;; my $worker = Resque-\u0026gt;new-\u0026gt;worker; $worker-\u0026gt;add_queue(\u0026#39;echo\u0026#39;); infof(\u0026#39;### start worker\u0026#39;); $worker-\u0026gt;work; infof(\u0026#39;### stop worker\u0026#39;); lib/MyTask/Echo.pm Echo.pmは、実際の処理の内容です。\nclient.plで、指定しているMyTask::Echoは、このファイルの事を指しています。\nworker.plは、このファイルのような仕事の手順書があれば、どのような処理でも実行できます。\nなお、performは、worker.plが呼び出す関数名です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 package MyTask::Echo; use utf8; use strict; use warnings; use Log::Minimal; sub perform { my $job = shift; debugf(\u0026#39;dequeue: %s\u0026#39;, ddf($job-\u0026gt;args)); infof($job-\u0026gt;args-\u0026gt;[0]{count}); } 1; main.pl Procletを使って、client.plとworker.plとRedisを同時に動かします。\nworker.plを複数動作させたい場合は、Procletのworkerの数を変更するだけなので、いろいろ簡単に試せて便利ですね。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/usr/bin/env perl use utf8; use strict; use warnings; use Path::Tiny qw(path tempdir); use Test::RedisServer; use Proclet; my $redis = Test::RedisServer-\u0026gt;new( auto_start =\u0026gt; 0, tmpdir =\u0026gt; tempdir(), ); $ENV{REDIS_SERVER} = $redis-\u0026gt;connect_info; my $proclet = Proclet-\u0026gt;new(color =\u0026gt; 1); $proclet-\u0026gt;service( code =\u0026gt; sub { $redis-\u0026gt;exec; }, worker =\u0026gt; 1, tag =\u0026gt; \u0026#39;redis\u0026#39; ); $proclet-\u0026gt;service( code =\u0026gt; [qw{carton exec -- perl worker.pl}], worker =\u0026gt; 5, tag =\u0026gt; \u0026#39;worker\u0026#39; ); $proclet-\u0026gt;service( code =\u0026gt; [qw{carton exec -- perl client.pl}], worker =\u0026gt; 1, tag =\u0026gt; \u0026#39;client\u0026#39; ); $proclet-\u0026gt;run; 使い方 当然ですが、Resqueを試すにはRedisをインストールしておく必要があります。\nMacでhomebrewを使っている方は、ターミナルからbrew install redisと入力するだけです。\nその他の方は、Redisを入れるか、homebrewを入れるか、Macを買うかしてください。\n全部コピペしたら、cpanfileのあるディレクトリで、carton installと入力してください。\n必要なモジュールがインストールされます。\ncartonが無い場合は、その前にcpanm Cartonと入力してください。\ncpanmが無い場合は、その前にcurl -L https://cpanmin.us | perl - App::cpanminusと入力してください。\nモジュールのインストールが終わったら、carton exec -- perl main.plと入力してみましょう。\n勝手に色々動き始めます。\nジョブキューが初めての方は、main.plに書いてあるworkerやclientのworkerを増減してみたり、client.plのsleep を消したり、数値を変更したり、色々試してみてください。\n1 2 3 $ brew install redis $ carton install $ carton exec -- perl main.pl 使ってみての感想 RDBMSの場合、少なくともテーブル、場合によってはユーザーやデータベースなどを作る必要があり、ちょっと触ってみるにしても結構面倒なところがあります。\nQudoは、そういう部分のヘルパーもあり、楽チンではあるのですが。\nRedis＋Resqueの場合は、そのあたりが何も必要ないので、とても簡単です。\nちょっと使ってみたり、ジョブキューに触れて見るにはちょうど良いと思います。\n参考資料 Resque - Redis-backed library for creating background jobs, placing them on multiple queues, and processing them later. - metacpan.org Resque で学ぶジョブキューイング - Perl Advent Calendar Japan 2012 Casual Track Qudo - simple and extensible job queue manager - metacpan.org 第10回　ジョブキューで後回し大作戦―TheSchwartz，Qudo，Q4M（1）：Perl Hackers Hub｜gihyo.jp … 技術評論社 ","date":"2015-05-14T09:58:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/05/14/095842/","title":"Resqueでメッセージキューをやってみた"},{"content":"@nqounetです。\nMojoliciousのプロダクション用サーバーのhypnotoadを使ってHerokuで動作させる方法を考えてみます。\nまず、Herokuで起動するためのPORTを設定する必要があります。\n起動スクリプトの中で$PORTとなっているのは、環境変数なので、Perlでは$ENV{PORT}で取得できます。\nhypnotoadの設定 hypnotoadは設定ファイルに設定内容を書きますが、その中で環境変数を書いておくこともできます。\nconfig.plの例\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 { hypnotoad =\u0026gt; { accepts =\u0026gt; 1000, backlog =\u0026gt; 10, clients =\u0026gt; 10, graceful_timeout =\u0026gt; 20, heartbeat_interval =\u0026gt; 5, heartbeat_timeout =\u0026gt; 20, listen =\u0026gt; [qq{http://*:$ENV{PORT}}], proxy =\u0026gt; 1, requests =\u0026gt; 25, upgrade_timeout =\u0026gt; 60, workers =\u0026gt; 4, }, }; ただ、このようにした場合、どのような環境でもPORTの設定が必要になるので、実際にはMOJO_MODE ごとの設定ファイル（例えばconfig.production.confのような）にするのが良いでしょう。\nperl app.pl で起動する 前回も書いたとおり、Procfileには1つだけ書くようにしたいので、Procletを使用して見掛け上を1つのアプリにします。\napp.plの例\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/usr/bin/env perl use utf8; use strict; use warnings; use Proclet; use Furl; require EV; require IO::Socket::Socks; require IO::Socket::SSL; my $proclet = Proclet-\u0026gt;new; $proclet-\u0026gt;service( code =\u0026gt; [\u0026#39;hypnotoad\u0026#39;, \u0026#39;-f\u0026#39;, \u0026#39;script/app\u0026#39;], tag =\u0026gt; \u0026#39;web\u0026#39;, ); $proclet-\u0026gt;service( code =\u0026gt; [\u0026#39;perl\u0026#39;, \u0026#39;script/worker\u0026#39;], tag =\u0026gt; \u0026#39;worker\u0026#39;, ); $proclet-\u0026gt;service( code =\u0026gt; sub { my $keepalive_url = $ENV{APP_KEEPALIVE_URL} or die \u0026#39;set env APP_KEEPALIVE_URL.\u0026#39;; Furl-\u0026gt;new-\u0026gt;get($keepalive_url); }, tag =\u0026gt; \u0026#39;keepalive\u0026#39;, every =\u0026gt; \u0026#39;*/30 * * * *\u0026#39;, ); $proclet-\u0026gt;run; Procfileの例\n1 web: carton exec -- perl app.pl ポイントとしては、hypnotoadをフォアグラウンドで動作させることです。\nhypnotoadをそのまま実行すると、アプリをデーモンにしてしまうのですが、そうするとProcletで管理できなくなります。\nworkerがある場合は、workerも同じようにserviceとして登録します。\nさらに、サービスがスリープしないように、30分毎に自分自身にアクセスするようにすると便利だと思います。\nAPP_KEEPALIVE_URLは、こちら のHUBOT_HEROKU_KEEPALIVE_URLを読み替えて設定してください。\nhubot-scripts/hubot-heroku-keepalive ","date":"2015-05-09T09:49:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/05/09/094941/","title":"Herokuでhypnotoadを使ってMojoliciousを起動する"},{"content":"@nqounetです。\n前回に続いてHerokuネタです。\nこの前Mojolicious::Liteで作ったアプリをHerokuで動かす 記事を書いた時、あとでProcletの話を書こうと思っていたのですが、すでに書かれているのをZenbackが見つけてくれました。\nHeroku上でProcletを使っていろいろ動かすと便利 - blog.nomadscafe.jp Herokuでは、Dynoという単位で料金を管理しているのですが、Procfileで起動するアプリを増やすと、追加でDynoが必要になります。（何もしていないと、アプリは1つしか動きません）\nそこで登場するのがProcletなんですね。\nProclet - minimalistic Supervisor - metacpan.org Procletを使うと、見掛け上は単体のアプリ扱いになるので、アプリに対して定期的にアクセスするワーカーも起動させておくことができます。\n何故そんなワーカーが必要なのか Herokuは長期間アクセスがないとサービスがスリープしてしまいます。\nワーカーを1時間毎にすると一晩くらいは平気のようですが、気が付くとスリープしているので、やはり30分毎が良さそうですね。\n常用していて依存情報がないモジュールに注意 Herokuを使うと、依存しているのにうっかりcpanfileから抜けてしまうモジュールがあることがよくわかります。\nhttpsでのアクセスが必要な場合はIO::Socket::SSLが必要ですし、MySQLを使いたい場合はDBD::mysqlが必要なのですが、ついつい忘れがちです。\nIO::Socket::SSL - metacpan.org DBD::mysql - MySQL driver for the Perl5 Database Interface (DBI) - metacpan.org 最近は、cpanfileを作成する時にはscan-prereqs-cpanfileを使って楽をしているのでなおさらかもしれません。\nscan-prereqs-cpanfile - Scan prerequisite modules and generate CPANfile - metacpan.org Herokuの無料範囲はProcletで広がる メモリなどの制限はあるものの、Procletを使うと沢山のアプリを起動させておくことができます。\nMySQLやPostgresのようなRDBMSだけでなく、RedisやMemcached、MongoDBなどもある程度まで無料で使えるので、ちょっとした実験アプリを置いておくにはピッタリですね。\nProcletがあれば、ローカル環境でもアレコレ起動するのをまとめておくこともできるので便利ですので、試してみるとよいでしょう。\n","date":"2015-04-13T11:25:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/04/13/112530/","title":"HerokuではProcletを使うとお得"},{"content":"@nqounetです。\nMojolicious::Liteに限らず、PerlのアプリはHerokuで簡単に動かせる、ということなので試してみました。\nまとめ 1 2 3 4 5 6 7 8 9 10 11 mkdir myapp \u0026amp;\u0026amp; cd myapp git init mojo generate lite_app myapp.pl heroku create --buildpack https://github.com/pnu/heroku-buildpack-perl.git touch app.psgi echo \u0026#39;requires \u0026#34;Mojolicious\u0026#34;;\u0026#39; \u0026gt; cpanfile echo \u0026#39;web: starman --preload-app --port $PORT myapp.pl psgi\u0026#39; \u0026gt; Procfile git add . git commit -m \u0026#39;go to heroku\u0026#39; git push heroku master heroku open heroku buildpack Herokuではbuildpackという仕組みで、Perl製のウェブアプリも動かすことができます。\nPerl5のPSGIアプリ用buildpackのまとめ - Qiita 上で紹介した記事が推奨している https://github.com/pnu/heroku-buildpack-perl は使いやすいです。\ncpanfile 依存モジュールを、cpanfileに書いておくと自動的にインストールされます。\n1 requires \u0026#39;Mojolicious\u0026#39;; app.psgi vs Procfile 上記のbuildpackでは、基本的にはPSGIの規格に沿ったapp.psgiを用意する必要があるのですが、適切にProcfileを書けばapp.psgiは空でも問題ありません。（app.psgiという名前のファイルが存在すればbuildpackが有効になります）\nその辺を利用して、Mojolicious::Liteで作成したアプリを（とりあえず）PSGIとして動かすようにProcfileに書いておきます。\n上記のbuildpackでは、標準でstarmanがインストールされるので、それを利用します。\n1 web: starman --preload-app --port $PORT myapp.pl psgi hypnotoadで動かしたい Mojoliciousのhypnotoadでも動作させられるのですが、portの設定をファイルに書く必要がある（コマンドのオプションでは指定できないっぽい）ので、ちょっと面倒です。\nどうしてもhypnotoadで動かしたい場合は適宜お調べください。\nProcfileの応用 app.psgiよりもProcfileが優先されるので、応用すればapp.plで起動するようなアプリを動かすことも可能ですよ。\n1 web: perl app.pl cpanモジュールを使う手もある？ 実は、Mojolicious::Command::deploy::herokuを使うと簡単に動かせるらしいのですが…。\nDeploy Perl Mojolicious web apps to Heroku\n二段階認証に対応していないのか、私の環境ではうまく動作しませんでした。\n","date":"2015-04-08T11:40:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/04/08/114023/","title":"Mojolicious::Liteで作ったアプリをHerokuで動かす"},{"content":"@nqounetです。\n第7回では、フォームに値を残しておく方法を学びました。\nところで、HTTPにはGETメソッドとPOSTメソッドがありますが、投稿フォームにはPOSTメソッドのほうが向いています。\nHTMLでは簡単な変更ですが、もちろんhelperを使っていても簡単に変更できます。\nサンプルコード全体 Mojoliciousのバージョンは6.01で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; post \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;stash(hello =\u0026gt; qq{Hello $user!}); $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep %= form_for \u0026#39;/\u0026#39;, method =\u0026gt; \u0026#39;post\u0026#39;, begin %= text_field \u0026#39;user\u0026#39; %= submit_button \u0026#39;Submit!\u0026#39; % end \u0026lt;%= $hello %\u0026gt; 解説 Line 4 - 7 1 2 3 4 get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; getの部分がとてもシンプルになりました。\nこれまで、getでフォームを受け取っていましたが、その部分がなくなりました。\nLine 9 - 14 1 2 3 4 5 6 post \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;stash(hello =\u0026gt; qq{Hello $user!}); $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; 新たにpostが出てきました。\n書いている内容で実質変更になっているのは、getがpostに変わっただけで、それ以外の部分は前回のgetと全く同じです。\nこのようにして、POSTメソッドで/にアクセスした時に実行されるコントローラーを書くことができます。\nCGIの時代にPerlを書いたことがある方は、query_stringや標準入力といった言葉を聞いたことがあると思います。\nしかし、Mojolicious（だけではなく、最近のフレームワーク）では、GETでもPOSTでも同じ書き方でパラメータから値を取得できます。\nLine 27 - 30 1 2 3 4 %= form_for \u0026#39;/\u0026#39;, method =\u0026gt; \u0026#39;post\u0026#39;, begin %= text_field \u0026#39;user\u0026#39; %= submit_button \u0026#39;Submit!\u0026#39; % end helperのform_forを使ってPOSTメソッドに変更する場合は、method =\u0026gt; 'post'をbeginの前に追記するだけでOKです。\nHTTPのPOSTメソッドは、GETメソッドよりも送信可能なデータ量が多くなります（GETでは2KBから4KB程度ですが、POSTはほぼ無制限です）が、URLにパラメータが含まれません。\n例えば地図を検索して、その場所をメールやLINEで知らせたい、というような用途が考えられる場合はGETメソッドが良いでしょう。\n多機能だけど必要なところだけ使えばOK Mojoliciousでは、HTTPのメソッドを意識することなくパラメータを取得できますので、用途に応じてGETとPOSTを使い分ける事が重要です。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\n","date":"2015-03-07T07:12:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/03/07/071219/","title":"Mojolicious::LiteでPOSTメソッドを使う"},{"content":"@nqounetです。\n第6回では、テンプレートに値を渡す方法を学びました。\nフォームの値を画面に表示することはできるようになりましたが、フォームのテキストボックスに値が残っていませんでしたので、値を残して（入れて）おくようにしましょう。\nよくある機能はアプリで実装されている 最近はあまり見かけないとは思いますが、フォームを入力してエラーになった場合、ブラウザの戻るボタンで戻ってください、的な感じで戻ると、フォームが空っぽになっていたりして、キーッっとなったりした思い出があると思います。\nこのような思い出が多いからか、最近では、入力ミスがあっても、フォームの画面が表示されて、各項目にエラーが表示されていることが多くなっています。\nMojoliciousには、そのような機能を持ったフォームを作成する方法があります。\nサンプルコード全体 Mojoliciousのバージョンは6.01で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;stash(hello =\u0026gt; qq{Hello $user!}); $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; %= form_for \u0026#39;/\u0026#39;, begin %= text_field \u0026#39;user\u0026#39; %= submit_button \u0026#39;Submit!\u0026#39; % end \u0026lt;p\u0026gt;\u0026lt;%= $hello %\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 解説 Line 22 - 24 1 2 3 4 %= form_for \u0026#39;/\u0026#39;, begin %= text_field \u0026#39;user\u0026#39; %= submit_button \u0026#39;Submit!\u0026#39; % end 前回から変更になっているのはこの部分のみです。\nMojoliciousで通常使うテンプレートは、Perlのコードを埋め込むことができる、Embedded Perlと呼ばれる仕組みを使っています。\n前回使用した、\u0026lt;%= ... %\u0026gt;というのは、実はPerlのコードを実行して、その結果をその場所に埋め込む（文字を置き換える）という仕組みになっています。\nつまり、\u0026lt;%= $hello %\u0026gt;は、$helloを実行した結果（Perlでは、こういう場合は変数の中身になります）を表示している事になります。\n今回使用している%=は、行全体をPerlのコードとして実行して、その結果を埋め込む、という仕組みになります。\n%=の左側には空白はあってもOKです（半角のみです。全角はダメ）が、それ以外の文字があるとわかりにくいエラーになりますので気をつけてください。\n%については、Perlのコードとして実行しますが、何も埋め込みません。\nさて、form_for、text_field、submit_buttonについてですが、これらはテンプレートで使える関数で、実行するとHTMLを返します。\nこれらの関数は、Mojoliciousの標準プラグインのTagHelpersで定義されています。\nMojolicious::Plugin::TagHelpers - Tag helpers plugin Mojolicious::Plugin::TagHelpers · yuki-kimoto/mojolicious-guides-japanese Wiki それぞれの最初の引数の文字列は、form_forではaction、text_fieldではname、submit_buttonではvalueの値になります。\n特に大事なのがtext_fieldで、この引数がnameの値になるだけでなく、リクエストされたパラメータの値が自動的に表示されるようになります。\n今回の場合、テンプレートで指定しているuserと$c-\u0026gt;param('user')がお互いに参照しあう状態になります。\n多機能だけど必要なところだけ使えばOK フォームをより親切に作成することで、ウェブアプリの完成度を高めることが可能です。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\n","date":"2015-03-05T07:33:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/03/05/073344/","title":"Mojolicious::Liteでテキストボックスに値を入れておく"},{"content":"@nqounetです。\nこの前の土曜日に、Perlの勉強会であるPerl入学式のWebアプリ編の講師役をしてきました。\n#Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar Perl入学式では久しぶりの講師役 色々と思うところがあって、なかなかまとまらないのですが、とにかく前で話をするのはいつまで経っても慣れないなぁ、というのが正直なところです。\nある程度着地点の見当をつけて話し始めるのですが、途中で着地点を見失って話をぶった切ったり、方向転換の末、収集がつかなくなってごまかしたり、色々とご迷惑をお掛けしたことと思います。\n教えるという立場は、本当に大変ですね。\nウェブとPerl PerlというとCGIを思い浮かべる方も多いと思いますが、モダンなPerlでは、Perlのスクリプトからアプリケーション・サーバーを立ち上げる事ができます。\nPerl入学式で扱うウェブアプリケーションフレームワークのMojoliciousにもその機能があります。\nCGIを手元で動かそうとした場合、まずはApacheなどのウェブサーバーをインストールして、CGIの実行環境を整える必要がありました。\nしかし、Mojoliciousはコマンド一つで、スクリプトをウェブアプリとして動作させることができます。\nこの辺は説明するには内容が高度過ぎる（かつ、説明できる自信がない）ので、スクリプトを編集すればブラウザの表示が変わる、というのを実際に体験してもらいました。\nサポーターのありがたみ 話す立場としても、サポーターから「こうしたほうがわかりやすいんじゃないか」というアドバイスを受けられるのは良いですね。\n資料を書いているときはなるべく多角的に見ているつもりですが、やはり一人では限界があります。\nサポーターからの意見や、参加者からの質問によって、資料や講義の内容もどんどん良くなっていますね。\nこのようなサイクルが続いていけば、ますます素晴らしい入門講座になっていくと思います。\n2015年度の予定はまだ決まっていませんが、ますますパワーアップしていくPerl入学式にご期待ください。\n","date":"2015-03-03T10:07:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/03/03/100703/","title":"#Perl入学式 で講師役をしてきました"},{"content":"@nqounetです。\n今日の知見です。\nそんなことも知らなかったのか、と思われるかもしれませんが、知りませんでした。\nどうせすぐに忘れるので、忘れる前に備忘録。\n諦めないで Test::mysqldでは、base_dirを指定しない場合は、File::Tempのtempdirで一時的なディレクトリを作って、そこにデータ置き場を作ります。\nFile::TempのtempdirはFile::Specのtmpdirを利用して作成されますが、その作成場所は環境変数のTMPDIR で指定することができます。\nソースコードを読んでいて発見したのですが、後でドキュメントを確認するとちゃんと書いてありました…。\n実行前に設定する テストを実行するときにだけに設定できれば良いので、envを使って設定し実行します。\n1 $ env TMPDIR=./tmp prove -vlr t テストの前に読み書きの高速なRAMドライブを作成しておいて、TMPDIRでそのディレクトリを指定する、というような使い方ができますね。\n","date":"2015-02-19T08:11:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/19/081142/","title":"Test::mysqldのbase_dirは環境変数TMPDIRで指定することもできる"},{"content":"@nqounetです。\n第5回はフォームを使えるようにしました が、何度も入力する場合にはブラウザの「戻る」ボタンを使う必要がありました。\n今回は戻らなくても表示されるようにしてみましょう。\nサンプルコード全体 Mojoliciousのバージョンは5.77で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;stash(hello =\u0026gt; qq{Hello $user!}); $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;form action=\u0026#34;/\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;user\u0026#34; type=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit!\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;%= $hello %\u0026gt; 解説 Line 4 - 9 1 2 3 4 5 6 get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;stash(hello =\u0026gt; qq{Hello $user!}); $c-\u0026gt;render(template =\u0026gt; \u0026#39;index\u0026#39;); }; 前回では、テンプレートを使う時に、文字列を渡しましたが、コードリファレンスの中でテンプレートを指定することもできます。\nrenderメソッドにtemplateとセットで文字列を渡すと、そのテンプレートが使用できます。\nstashというメソッドは、テンプレートに値を渡したい時に使用できます。\nstashメソッドに、テンプレートで使用する名前（今回はhello）と、値（今回はqq{Hello $user!} ）を渡すと、テンプレートでは、スカラー変数として使うことができます。\nLine 26 1 \u0026lt;%= $hello %\u0026gt; stashで渡した値を実際に使用しているのがこちらです。\nstashで渡した名前のスカラ変数を、``と%\u0026gt;で括ると、スカラ変数の値を表示することができます。\nstashで使える名前 stashで使える名前にはいくつか制限があります。\n予め他の用途で使っている名前があり、これらを使うと想定外の挙動をしますので使ってはいけません。\n1 2 3 action, app, cb, controller, data, extends, format, handler, json, layout, namespace, path, status, template, text, variant 私もうっかりするとdataやstatusを使ってしまってハマることがあります。気をつけましょう。\nそれと、（使うことはないと思いますが）mojo.で始まる名前も使えません。\nビューとコントローラー これまでテンプレート、という表現をしていますが、フレームワークでは、このテンプレートを含めた表示する部分のことを「ビュー（view）」と呼んでいます。\nそして、コードリファレンスの部分についても呼び方があり、こちらは「コントローラー（controller）」と呼びます。\nstashを使うと、コントローラーからビューに値を渡すことができます。\nビューから考えると、ビューで使いたい値は、コントローラーからstashを使って渡す必要があります。\n多機能だけど必要なところだけ使えばOK コレまでは、テキストとして直接出力していましたが、stashを使ってコントローラーからビューへ値が渡せるようになりましたので、ビューを使ったHTMLで表示することができるようになりました。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\nところで、今月末（2015年2月28日）の土曜日にPerl入学式の第6回（今期の最終回）を開催します。\n内容としては、何かしらのウェブアプリ（予定では1行掲示板）を作成します。\n大阪の講師は私が担当する予定です。\nあなたがまだ知らないPerlをお見せします。\nPerl入学式 公式サイト Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。 お申し込みをお待ちしております。\n","date":"2015-02-12T08:12:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/12/081257/","title":"Mojolicious::Liteでテンプレートに値を渡す"},{"content":"@nqounetです。\n少し前にAmon2で、それなりのアプリを書きました。\nその時、確かconfig周りを結構調べて、コードをしっかりと書いたはずだったのですが、そのコードを読んでいて、config はどうやって呼んでるんだっけ？、と思って調べてしまったので、また忘れた時のために書いておきます。\nconfigはフレームワークがうまくやってくれる アプリ（仮にMyApp.pmとする）にはload_configしか書いてなかったので、configは何処から来てるんだ、というところからAmon2のソースを読んでみた。\nというのも、Amon2は継承して使うフレームワークなので、アプリに書いてないメソッドはAmon2.pmを読めば書いてあるからです。\n結果としては、MyApp.pmにload_configというメソッドを書いて値を返すようにしておくと、その結果をconfigとして保持するようになっていた。\nconfigを直接書くよりは、Amon2の仕組みをちゃんと使っておくほうが良さそうだ。\nというわけで、load_configしか書いていなかったのでした。\n先にググれば良かった 調べてみると、上に書いたようなことが丁寧に解説してあるページが見つかった。\n【Amon2のオレオレTips】Configのカスタマイズ したい追記あり | hirobanex.net …まあ、よくあることです。\nconfigの呼び出し方 コントローラー（MyApp::Webのインスタンス）からconfigで呼び出せます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ... any \u0026#39;/\u0026#39; =\u0026gt; sub { my ($c) = @_; my $config = $c-\u0026gt;config; my $counter = $c-\u0026gt;session-\u0026gt;get(\u0026#39;counter\u0026#39;) || $config-\u0026gt;{initial_counter}; $counter++; $c-\u0026gt;session-\u0026gt;set(\u0026#39;counter\u0026#39; =\u0026gt; $counter); return $c-\u0026gt;render(\u0026#39;index.tx\u0026#39;, { counter =\u0026gt; $counter, }); }; ... フレームワークは先人の知恵のかたまりなので、うまく利用しましょう。\n","date":"2015-02-08T08:13:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/08/081358/","title":"Amon2のconfigについてまた調べてしまったので記録する"},{"content":"@nqounetです。\n先ほど書いていたひな形ですが、songmuさんから「それだとwarningsが有効にならないyo!」という突っ込みがありまして、よく確認してみるとたしかに有効になっていませんでした。\nこれではバグの温床になってしまいますので、いきなりですが改訂版を出します。\nPerlスクリプトのひな形（2015年改訂版） 1 2 3 4 5 6 7 #!/usr/bin/env perl use utf8; use strict; use warnings; use feature \u0026#39;say\u0026#39;; use open qw/:encoding(utf8) :std/; use Data::Printer {deparse =\u0026gt; 1}; なんだか色々変わった気がしますが、ひな形の基本的な方針は以下のように考えていて、その点は変わっていません。\nエディタの文字コードはUTF-8しか認めない 何かあったらエラーや警告を出してくれる sayが使える（print \u0026quot;\\n\u0026quot;は面倒） 変数の中身が簡単に確認できる 前回のひな形にuse warnings;を追加すれば目的は叶いますし、common::senseを使う方法もあります。\n大事なのは、strict、warningsです。\nプログラミングをすることは、エラーと向き合うことでもあります。\n文法の間違いは簡単に発見できる方が、余計な心配をしなくてすむので内容に注力できますよ。\n","date":"2015-02-07T14:27:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/07/142727/","title":"（2015年改訂版）最近使っているPerlスクリプトのひな形"},{"content":"（追記: 2015/02/07 ）\nこのひな形ではwarningsが有効になっていなかったためwarningsが有効な改訂版を書きましたので、そちらもご確認ください。\n（追記ここまで）\n@nqounetです。\nPerl入学式などで、サンプルコードなどを書く時に、ちょっとしたひな形を用意しておくと便利なので、スニペットとして用意しています。\nたまたま記事を掘り返していたら、6年近く前の記事が出てきて、さすがにこれは最近じゃない、ということで更新版を書きます。\nちなみにこの記事です。\n最近使っているPerlスクリプトのひな形 | IT Office Nishimiyahara 最近のPerlスクリプトのひな形 普段使用しているのはMacなので、その辺は大目に見てください。\n1 2 3 4 5 6 #!/usr/bin/env perl use utf8; use v5.12; use open qw/:encoding(utf-8) :std/; use DDP {deparse =\u0026gt; 1}; Perl入学式などで動くサンプルコードを書くときなどによく使っています。\nworkshop-2014-05/code/osaka-nqounet at master · perl-entrance-org/workshop-2014-05 解説 use utf8; このファイルがUTF-8で書かれている事が条件ですが、このファイルに書かれている文字をPerlの内部文字列として扱うためのプラグマです。\nこれがあることによって、ファイル内に書いた日本語なども内部文字列として扱うことができます。\n最もわかりやすいのは、このプラグマの有無でlengthの結果が変わってしまうところでしょうか。\n1 2 3 4 $ perl -Mutf8 -le \u0026#39;print length \u0026#34;あいうえお\u0026#34;;\u0026#39; 5 $ perl -le \u0026#39;print length \u0026#34;あいうえお\u0026#34;;\u0026#39; 15 use utf8している場合は5文字、してない場合は15文字として扱われています。\nコードの中に日本語がない場合でも、日本語のようなマルチバイト文字を扱うのであれば、常に書いている状態を意識しておくと、思わぬ文字化けに遭遇した場合でも対応が簡単になります。\nuse v5.12; Perlのバージョン5.12以上でのみ実行できるようにします。\nuse v5.12は、use 5.012と指定しても同じです。\nPerlは5.6からバージョンの表記方法が変わりましたが、新しい表記を利用する場合は最初にvを使用します。\nまた、v5.10以上を指定することで、sayなどが使えるようになります。また、v5.12以上を指定すれば、strict、~~warnings~~が自動的に有効になります。（v5.10でも有効になっていると思っていましたが、v5.12からです。）\n後方互換性を確保するため、（基本的には）新しい機能は明示的に宣言しないとエラーになるようになっています。\nuse open qw/:encoding(utf-8) :std/; Perlの内部文字列は、そのまま出力すると警告を受けますので、通常は出力の際にencodeする必要があります。\nまた、入力時はdecodeして、Perlの内部文字列にするのが基本です。\n常に意識するのは良いことなのですが、ちょっとしたスクリプトを書くには面倒に感じることも多いです。\nそこで、これを書いておきます。\nこうしておくとターミナルとの入出力時にdecode、encodeの処理をうまい具合にやってくれます。\nなお、この書き方でうまく処理できるのは標準入出力と標準エラー出力だけなので、ファイルの読み書きなどは明示的にdecode、encodeが必要です。\nuse DDP {deparse =\u0026gt; 1}; これを書いておくと、変数を簡単に出力できるpという関数が使えるようになります。\n以前にも紹介したことがありますが、理屈はともかく、使って便利なものは使ったほうが良いと思います。\nPerlで自走するエンジニアに必要なたった1つのモジュール | IT Office Nishimiyahara 標準モジュールとしてData::Dumperが入っているので、そちらを使うことが多いと思いますが、見やすさが断然違います。\nさらに文字数も違いますので、より便利だと思います。\nたまたま掘り返した記事 解説はもっと簡単に書くつもりだったのですが、小難しくなってしまいました。\nところで、このサイトの「こちらの記事も読まれています」の機能についてですが、実はただのランダム表示です。\nですが、時々ハッとするというか、ピンポイントの記事が出ることも多いので不思議なものです。\n","date":"2015-02-07T08:10:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/07/081045/","title":"（2015年版）最近使っているPerlスクリプトのひな形"},{"content":"@nqounetです。\n第4回はパラメータを読み取る感じだったのですが、折角なのでフォームを使って試してみましょう。\nということで、第5回はフォームを使ってみます。\n入門シリーズにしました 第1回を書いた当初はサンプルシリーズのつもりでしたが、書いているうちに内容が入門者向けになってしまったので入門シリーズにしました。\nサンプルコード全体 Mojoliciousのバージョンは5.77で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; \u0026#39;index\u0026#39;; get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;render(text =\u0026gt; qq{Hello $user!}); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;/foo\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;user\u0026#34; type=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit!\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 解説 Line 1 - 2 1 2 #!/usr/bin/env perl use Mojolicious::Lite; 毎回同じ説明になりますが、Mojolicious::Liteを使うとstrict、warnings、utf8と5.10で使える命令文が使えるようになります。\nLine 4 1 get \u0026#39;/\u0026#39; =\u0026gt; \u0026#39;index\u0026#39;; 今回はフォームを使うので、HTMLの出力をします。\nPerlのコードの中にHTMLが入ると非常に読みにくくなるので、HTMLはテンプレートにしてしまいましょう。（後ほど解説します）\nこれまではコードリファレンスを書いてきましたが、文字列を渡すこともできます。\n仕組みが難しいので詳しい説明は省きますが、このような書き方をすると文字列で渡した名前のテンプレートを使うようになります。\nLine 6 - 10 1 2 3 4 5 get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;render(text =\u0026gt; qq{Hello $user!}); }; この部分は、第4回の9行目から13行目と全く同じですので、そちらをご覧ください。\nLine 12 1 app-\u0026gt;start; 今回はテンプレートがありますので最後の行ではありませんが、Perlのコードとしては最後に書いておきます。\nLine 13 - 29 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;/foo\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;user\u0026#34; type=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit!\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Perlでは、__DATA__だけが書いてある行があると、それ以降をデータとして使用できます。（詳細は省略します）\nMojolicious::Liteではその機能を使ってテンプレートを定義でき、テンプレートも同じファイルに書くことができます。\nこのように書くテンプレートを「インラインテンプレート」と呼んでいます。\nインラインテンプレートでは、ファイル名に相当する部分を@@に続けて書きます。\nこの例では@@とファイル名の間に半角スペースを入力していますが、なくても構いません。私は見やすいと思って半角スペースを入れています。\n4行目で指定した名称がindexの場合、index.html.epが対象になります。htmlやepは指定すれば変更できます。指定方法はいずれ紹介するかもしれません。\nテンプレートにはHTMLがそのまま書けますので、好きなように書いても問題ありません。\nただし、formのactionは\u0026rsquo;/foo\u0026rsquo;に、テキストボックス（input type=\u0026ldquo;text\u0026rdquo;）のnameは\u0026rsquo;user\u0026rsquo;にしておかないと、動作しません。これらは6行目から10行目に書いてあるとおり、そのURLやnameで動作するように書いているからです。\ngetの最初の引数である\u0026rsquo;/foo\u0026rsquo;と、formのactionの\u0026rsquo;/foo\u0026rsquo;が対応しており、また、コントローラーのparamメソッドの引数である\u0026rsquo;user\u0026rsquo;と、テキストボックスのnameである\u0026rsquo;user\u0026rsquo;が対応しています。\nmorbo myapp.plとしてサーバーを起動し、http://localhost:3000にアクセスして動作を確認してみてください。\nフォームに文字を入力して投稿すると、画面にその文字列が表示されるはずです。\nそして、その時にURLがどうなっているのかも是非確認してみてください。\n多機能だけど必要なところだけ使えばOK フォームによるデータの送信と、パラメータによるデータの受信を覚えれば、あとはその応用でウェブアプリを作ることが可能です。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\nところで、今月末（2015年2月28日）の土曜日にPerl入学式の第6回（今期の最終回）を開催します。\n内容としては、何かしらのウェブアプリ（予定では1行掲示板）を作成します。\n大阪の講師は私が担当する予定です。\nあなたがまだ知らないPerlをお見せします。\nPerl入学式 公式サイト Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。 お申し込みをお待ちしております。\n","date":"2015-02-05T08:50:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/05/085040/","title":"Mojolicious::Liteでフォームを使う"},{"content":"@nqounetです。\n第3回では、ウェブアプリの書く上で便利な仕組みであるルーティングを解説しました。\nサンプルの元ネタはMojoliciousのドキュメント日本語版のMojolicious::Liteにあります。あるいは、本家のチュートリアルです。\nMojolicious::Lite · yuki-kimoto/mojolicious-guides-japanese Wiki Mojolicious::Guides::Tutorial - Tutorial というわけで、第4回はパラメータを読み取る方法について書いてみたいと思います。\nパラメータ CGIの時代からそうですが、何故ウェブアプリが必要か、というと、フォームに入力されたものを処理したい、というのが一番大きいのではないかと思います。\n今でもシンプルなウェブアプリとして、メールフォームがありますね。\nフォームの情報を取得するには、本来はブラウザがフォームをどのように送信してくるのかを知っておく必要がありますが、そういう部分はフレームワークがうまくやってくれます。\n私たちが必要なのは、フォームの部品の名前だけです。\nサンプルコード全体 Mojoliciousのバージョンは5.75で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;redirect_to(\u0026#39;/foo?user=nqounet\u0026#39;); }; get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;render(text =\u0026gt; qq{Hello $user!}); }; app-\u0026gt;start; Line 1 - 2 1 2 #!/usr/bin/env perl use Mojolicious::Lite; Mojolicious::Liteを使うと、フレームワークの機能が使えるようになるだけでなく、モダンなPerlで書くことができるようになります。\nLine 4 - 7 1 2 3 4 get \u0026#39;/\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;redirect_to(\u0026#39;/foo?user=nqounet\u0026#39;); }; アプリケーションのルート（'/'のこと）にアクセスすると、subの中身が実行されます。\nコントローラーのredirect_toメソッドは、HTTPのリダイレクトのレスポンス（HTTP 302）を返します。\n何処へリダイレクトするかについては、引数で指定します。\n今の場合は、'/foo?user=nqounet'が、新しいURLになります。\n第1回でもこのような手法を使っていますが、アプリケーションのルートにアクセスすれば、そのサンプルのメイン部分にアクセスできるようにしておくとアドレスバーへの入力が楽で良いと思います。\nLine 9 - 13 1 2 3 4 5 get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; my $user = $c-\u0026gt;param(\u0026#39;user\u0026#39;); $c-\u0026gt;render(text =\u0026gt; qq{Hello $user!}); }; ここが今回のメインです。\nコントローラーのparamメソッドは、フォームなどに入力された値を取得するメソッドです。\n引数にフォームの部品の名前を渡すと、その部品の値を返します。\n今の場合は、'user'が引数なので、フォームのuserという名前の部品の値を返します。\n今回はフォームには入力していませんが、リダイレクトして、フォームから入力したのと同じようにアクセスする形になっています。\nさて、値の取得と同時に代入しているので、$userにはuserの値が代入されています。\nそして、次の行でrenderメソッドによって文字列を出力します。\nその文字列に$userが含まれているので、このサンプルでは結果的にフォームのuserの値が画面に出力されることになります。\nなお、qq{...}というのはダブルクォーテーションの別の書き方です。\nPerlでは、ダブルクォーテーションの中では変数が展開されますのでこのように書くことができます。\nまた、シングルクォーテーションの中では逆に変数が展開されません。\nシングルクォーテーションも別の書き方ができます。\nこれまで普通に書いてきましたが、q{...}という書き方がそれです。\n書き方は好みの問題で、特に重要なメリットはありません。ダブルクォーテーションとシングルクォーテーションの書き換えが簡単になるとか、クォーテーションマークのエスケープが不要になるという程度のメリットは有りますが、それほど重要ではありません。\n好きなように書くのが良いと思います。\nさて、アプリケーションのルートからリダイレクトしてくると、userにはnqounetという文字が入力されているので、出力はHello nqounet!となります。\nLine 15 1 app-\u0026gt;start; 最後のお約束です。\n書いてなかったらどうなるのか、興味をもった方は試してみてください。\n大丈夫です。壊れたりはしませんから。\n多機能だけど必要なところだけ使えばOK パラメータを扱えると、いよいよウェブアプリっぽい感じになってきましたね。\nせっかくパラメータを扱えるようになったので、チュートリアルからは離れますが、次回はフォームを作ってみたいと思います。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\nところで、今月末（2015年2月28日）の土曜日にPerl入学式の第6回（今期の最終回）を開催します。\n内容としては、何かしらのウェブアプリ（予定では1行掲示板）を作成します。\n大阪の講師は私が担当する予定です。\nあなたの知らないPerlを一部お見せしますので、是非ご参加ください。\nPerl入学式 | Perl Entrance Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。参加費は無料です。 あなたのお申し込みをお待ちしております。\n","date":"2015-02-04T07:57:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/04/075756/","title":"Mojolicious::Liteでパラメータを読み取る"},{"content":"@nqounetです。\n第2回がハローワールドというなんだかおかしなことになっていますが、気にしたら負けです。\n第3回のネタを掘り返していて気づいたのですが、これらのサンプルは、Mojolicious::Liteのドキュメントのコード部分を参考に作っていたものでした。\nなので、順序もそれに倣っていきます。\nというわけで、第3回はルーティングです。\nルーティング ウェブサイトを作成するときは、例えばindex.htmlが/で表示される場合、index.htmlと同じディレクトリにfoo.htmlが置いてあると、/foo.htmlにアクセスすればfoo.htmlが表示されます。\nウェブアプリでも同じようなことができます。\nそれを実現するのがルーティングです。\nサンプルコード全体 Mojoliciousのバージョンは5.75で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;render(text =\u0026gt; q{Hello World!}); }; get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(text =\u0026gt; q{Foo!}); }; app-\u0026gt;start; Line 1 - 6 1 2 3 4 5 6 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;render(text =\u0026gt; q{Hello World!}); }; ここまではハローワールドと同じですね。\nmorbo myapp.plでサーバーを起動した場合、http://localhost:3000にアクセスすればHello World!と表示されます。\nLine 8 - 11 1 2 3 4 get \u0026#39;/foo\u0026#39; =\u0026gt; sub { my $c = shift; $c-\u0026gt;render(text =\u0026gt; q{Foo!}); }; getの定義がもうひとつ出てきました。\nsubの中身は、書き方は違いますが前回説明したとおり一旦変数に入れてあるだけで実質的には同じです。表示される文字列はわかりやすいように別の文字列を指定してあります。\ngetの最初の引数が'/foo'なので、この定義によってhttp://localhost:3000/fooにアクセスした時にsubの中身が実行されることになり、Foo!と表示されます。\n定義を増やしても、URLごとに記述がわかれているので、例えばエラーが発生した時には、どのURLにアクセスしていたのかを調べれば、どの部分に問題があるのかが簡単にわかるようになります。\nとても便利ですね。\nLine 13 1 app-\u0026gt;start; もう説明は不要でしょう。\n最後はこれで締めです。\nMojolicious 1.0 いつ頃書いたサンプルだったのかは覚えていないのですが、ブログを掘り返してみると、ほぼ4年前にMojoliciousを使って色々と作っていました。\n先日1.0にバージョンアップしたMojolicious（::Lite）を本格的に触ってみようとアレコレやってみた。\n引用元: Mojolicious::LiteでData::Modelを使ってみた | IT Office Nishimiyahara\nMojoliciousがバージョン1.0になったのは2010-12-26ですので、年末年始に結構頑張ってたみたいですね。\n多機能だけど必要なところだけ使えばOK ルーティングは、ウェブアプリを書く上でとても便利な仕組みということがわかりましたね。\nルーティングだけでも簡単なウェブアプリは書けてしまいます。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\n2月28日（土）にPerl入学式の第6回としてウェブアプリを作成します。\n大阪の講師は私が担当する予定です。\nあなたの知らないPerlを一部お見せしますので、是非ご参加ください。\nPerl入学式 | Perl Entrance Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。参加費は無料です。 ","date":"2015-02-03T07:38:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/03/073828/","title":"Mojolicious::Liteでルーティングしてみる"},{"content":"@nqounetです。\nMojolicious::Liteのサンプルシリーズ第1回は大変でした。\nファイル名がaから始まっていて目に止まったので書き始めたのですが、いきなりハードな解説になってしまったので、順序がおかしいですが第2回はハローワールドです。\nサンプルコード全体 Mojoliciousのバージョンは5.75で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 #!/usr/bin/env perl use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;render(text =\u0026gt; q{ハローワールド！}); }; app-\u0026gt;start; 解説 Line 1 - 2 1 2 #!/usr/bin/env perl use Mojolicious::Lite; いつものアレです。\nuse strict;などが無いので心配だと思いますが、大丈夫です。\n慣れればuse Mojolicious::Lite;の背後に存在を感じるようになります。\nLine 4 - 6 1 2 3 get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;render(text =\u0026gt; q{ハローワールド！}); }; Mojolicious::Liteでは、URLごとに実行する処理を定義できるようになっています。\nmorbo myapp.plとして起動した場合、http://localhost:3000にアクセスすると、'/'で定義された処理が実行されます。\nこの部分がまさにその定義です。\nget '/' =\u0026gt; sub { ... };がどういう仕組みになっているかはわかりにくいと思いますが、（多少なりとも）見慣れた形に変えると以下のようになります。\n1 get(\u0026#39;/\u0026#39;, sub { ... }); つまり、getという関数に、二つの引数（文字列とコードリファレンス）を渡しています。\n最初の引数に定義されるURL（パス）を、二つ目の引数にそのURLにアクセスされた時に実行する処理を渡します。\nコードリファレンスの中身は普通の関数と同じように書くことができます。\n最初の引数として、Mojolicious::Controllerのオブジェクト（インスタンス）が渡されます。このインスタンスのことをコントローラーと表現します。\nコントローラーは沢山のメソッドを持っていますが、代表的なメソッドの1つがrenderです。\nこの例では一度しか使用しないので直接shiftから使用していますが、通常は一旦変数に代入して利用します。多くの場合は$selfという変数に入れることが多いですが、最近ではコントローラーであることを明示的にするため$cという変数を使う事も多いです。\n1 2 my $c = shift; $c-\u0026gt;render(text =\u0026gt; q{ハローワールド！}); renderに渡している引数も、見慣れた感じで書き直すとrender('text', 'ハローワールド！')となります。\nrenderの使い方の1つとして、一つ目の引数にはレンダリングのタイプであるtextを渡すと、二つ目の引数の中身を出力する、という機能になります。\nこのようなことから、画面上には「ハローワールド！」と表示されるようになります。\nLine 8 1 app-\u0026gt;start; Mojolicious::Liteを使う場合は、コードの最後にこの命令文を書かなければいけません。\nコレより後に書けるのは、テンプレートかドキュメントだけです。\n当面は「お約束」として覚えておけばよいでしょう。\n多機能だけど必要なところだけ使えばOK Mojoliciousを使うと、とても簡単にURLに対応する処理を書くことができます。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\n2月28日（土）にPerl入学式の第6回としてウェブアプリを作成します。\n大阪の講師は私が担当する予定です。\nあなたの知らないPerlを一部お見せしますので、是非ご参加ください。\nPerl入学式 | Perl Entrance Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。参加費は無料です。 ","date":"2015-02-02T07:54:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/02/02/075435/","title":"Mojolicious::Liteでハローワールド"},{"content":"@nqounetです。\n昔作ったMojolicious::Liteのサンプルを発見したので、振り返りながら解説を試みます。\n第1回はプレースホルダとパラメータです。\nサンプルコード全体 Mojoliciousのバージョンは5.75で確認しています。\nファイル名はなんでも良いですが、ひとまずmyapp.plと考えてください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/usr/bin/env perl use utf8; use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;redirect_to(\u0026#39;/everything/54?name=hoge\u0026#39;); }; get \u0026#39;/everything/:stuff\u0026#39; =\u0026gt; [stuff =\u0026gt; qr/\\d+/] =\u0026gt; {stuff =\u0026gt; 23} =\u0026gt; sub { shift-\u0026gt;render(\u0026#39;welcome\u0026#39;); }; app-\u0026gt;log-\u0026gt;level(\u0026#39;error\u0026#39;); app-\u0026gt;start; __DATA__ @@ welcome.html.ep Stuff is \u0026lt;%= $stuff %\u0026gt;. クエリーnameの値は「\u0026lt;%= param \u0026#39;name\u0026#39; %\u0026gt;」です。 解説 Line 1 - 3 1 2 3 #!/usr/bin/env perl use utf8; use Mojolicious::Lite; これらは毎回書くことになります。 use strict;やuse warnings;は書かなくてもuse Mojolicious::Liteすれば自動的に有効になります。\n最近（というか、バージョン3.69以降なので結構経ちます）は「use utf8;」も自動的に有効になります。 いずれにしろ、書いてあっても害はありません。\nLine 5 1 get \u0026#39;/\u0026#39; =\u0026gt; sub { shift-\u0026gt;redirect_to(\u0026#39;/everything/54?name=hoge\u0026#39;); }; これは、URLによる処理の振り分けを指定しています。\nこの場合は、トップページにアクセスすると、その後に書いたコードリファレンスが実行されます。\nこのスクリプトをmorbo myapp.plで起動している場合、http://localhost:3000にアクセスすれば、/everything/54?name=hogeへリダイレクトします。\nリダイレクトは、例えばログインの処理の後にメンバーのページを表示したり、POSTの処理後に元のページへ戻したりするのに使えます。\nちなみに、これは単にアドレスバーに入力するのが面倒だったので書いたものです。\nLine 7 - 9 1 2 3 get \u0026#39;/everything/:stuff\u0026#39; =\u0026gt; [stuff =\u0026gt; qr/\\d+/] =\u0026gt; {stuff =\u0026gt; 23} =\u0026gt; sub { shift-\u0026gt;render(\u0026#39;welcome\u0026#39;); }; ここがこのサンプルの肝です。\n/everything/:stuffの:stuffは、プレースホルダと言って、この部分に含まれた文字はあとで取り出すことができます。\nこのサンプルでは、:stuffに対して色々と条件をつけています。\n配列のリファレンス（今の場合は[stuff =\u0026gt; qr/\\d+/]）を渡すと、有効にする値を指定することができます。指定できる値は正規表現（使えない機能もあります）、または配列のリファレンスで指定することができます。\nハッシュのリファレンス（今の場合は{stuff =\u0026gt; 23}）を渡すと、初期値を指定することができます。初期値を指定すると、プレースホルダ部分がない場合でもマッチするようになります。\nURLのパスで考えると、/everything/98や/everything、/everything/がマッチします。\n/everything/abや/everything/3gはマッチしません。\nコードリファレンスの中身ですが、これは後で出てくるwelcome.html.epをテンプレートにしてレンダリングするようになっています。\nLine 11 - 12 1 2 app-\u0026gt;log-\u0026gt;level(\u0026#39;error\u0026#39;); app-\u0026gt;start; 最初の行は、ログレベルを変更しています。ログレベルにはdebug,info,warn,error,fatalの5段階があり、今のようにerrorを指定するとerrorとfatal以外が表示（または記録）されないようになります。\nMojolicious::Liteは、自動的にデバッグしやすい程度にログを出してくれますが、ここではそれを表示しないようにレベルを変更しています。\n本文の最後にはapp-\u0026gt;start;を書きます。\n定義してきたアプリケーションをこの文で起動させます。\nLine 14 - 17 1 2 3 4 __DATA__ @@ welcome.html.ep Stuff is \u0026lt;%= $stuff %\u0026gt;. クエリーnameの値は「\u0026lt;%= param \u0026#39;name\u0026#39; %\u0026gt;」です。 __DATA__以降はテンプレートなどを書くことができます。\n@@ welcome.html.epというのは、次に@@が出てくるまでの範囲をwelcome.html.epというファイルとして扱います。\nrenderで呼び出しされた後、このテンプレート内では、:stuffに入った値が$stuffとして使用できます。\nまた、paramという命令で、パラメータから値を取得できます。\nこの場合は、パラメータのnameで取得できる値を直接表示します。\n多機能だけど必要なところだけ使えばOK Mojoliciousを使うと、とても簡単にURLに対応する処理を書くことができます。\n皆さんも美味しいところだけをうまく使ってサクッとウェブアプリを作ってみましょう。\n2月28日（土）にPerl入学式の第6回としてウェブアプリを作成します。\n大阪の講師は私が担当する予定です。\nあなたの知らないPerlを一部お見せしますので、是非ご参加ください。\nPerl入学式 | Perl Entrance Perl入学式 in大阪 第6回 Webアプリ編 on Zusaar ← お申し込みはこちらから。参加費は無料です。 ","date":"2015-01-31T08:24:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/31/082426/","title":"Mojolicious::Liteのプレースホルダとパラメータ"},{"content":"@nqounetです。\nMojoliciousは本当によく考えられているWAF（ウェブ・アプリケーション・フレームワーク）だと思います。\n例えば、logディレクトリを作ると、画面に出ていたログをファイルとして書き出してくれます。\nログをちゃんと書き出してくれるのは便利なんですが、開発時は逆に画面上で見ていたいこともあると思います。\n今日は、そういう時に便利な方法を書いてみようと思います。\nMojo::Log::handler Mojo::Log（$c-\u0026gt;app-\u0026gt;log）のhandlerを使うと、ログの振り分けが変更できます。\n私がよくやる使い方としては、アプリの読み込み時に「開発モードの場合は出力先をSTDERRに変更する」という方法を使います。\n1 2 # Mojolicious::Liteの場合 app-\u0026gt;log-\u0026gt;handle(\\*STDERR) if app-\u0026gt;mode eq \u0026#39;development\u0026#39;; Mojoliciousの特長 MojoliciousはPerlのバージョンが5.10.1以上であれば、依存モジュールなしで実行できるので、あまり環境を選びません。\nいざという時はファイルをFTPなどで転送すれば、CGIとしても動かせます。\nつまり、Mojoliciousはサーバーを直接触れないような場合でも、大きな改造なしに設置できるので、安心して使えるフレームワークです。\nMojolicious - Perl real-time web framework Home · yuki-kimoto/mojolicious-guides-japanese Wiki ","date":"2015-01-26T08:21:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/26/082143/","title":"Mojoliciousでlogディレクトリを作っても画面でログを確認する方法"},{"content":"@nqounetです。\n最近、仕事の関係でffmpegを扱っているのですが、Homebrewでインストールしていた開発環境のffmpegを更新しようとしてチラッと調べたので記録しておきます。\nHomebrew便利ね Macでウェブ開発をしている方はだいたいお世話になっていると思いますが、Homebrewを使うと便利なツールのインストールが簡単に実行できます。\nffmpegのインストールはとても面倒なので、開発環境にはHomebrewでインストールしていました。\nある時、必要になるコーデックが増えたのですが、事前にインストールしていませんでした。\n一度消してから再インストールかなぁ、と思っていたのですが、調べてみるとそのままreinstallすればオプションを追加してくれるようでした。\n1 2 brew update brew reinstall --with-opus どのエンコーダが使えるかの情報は以下のようにすれば確認できます。\n1 brew info ffmpeg Homebrewは本当に便利なツールですね。\nHomebrew — The missing package manager for OS X ","date":"2015-01-20T14:58:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/20/145837/","title":"Homebrewでインストールしたffmpegに機能を追加する方法"},{"content":"\noriginal via Flickr\n","date":"2015-01-17T22:49:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/224956/","title":"二軒目の様子 #Perl入学式"},{"content":"\noriginal via Flickr\n","date":"2015-01-17T18:19:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/181922/","title":"たたき風"},{"content":"\n撮影日時 : January 18, 2015 at 01:49AM\nvia Flickr\n","date":"2015-01-17T16:56:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/165614/","title":"インストール待ちな感じ"},{"content":"\nvia Flickr http://flic.kr/p/qQaE2f at January 14, 2015 at 09:19PM\n","date":"2015-01-17T16:15:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/161549/","title":"美味しかったですよ"},{"content":"\n","date":"2015-01-17T15:44:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/154403/","title":"今日飲んだコーヒー"},{"content":"\nJanuary 17, 2015 at 12:51PM\n","date":"2015-01-17T15:09:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/17/150945/","title":"January 17, 2015 at 12:51PM に撮影"},{"content":"@nqounetです。\nあけましておめでとうございます。\n本年もよろしくお願い申し上げます。\n","date":"2015-01-01T19:49:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2015/01/01/194906/","title":"あけましておめでとうございます"},{"content":"@nqounetです。\nこの記事はPerl入学式 Advent Calendar 2014の17日目の記事です。\n昨日は、@m_shige1979さんの、Perl入学式に参加した感想＆その後ちょっと作ったMojoliciousのサイトでした。\n痛風は本当に痛いらしいので、ビール好きの皆さんは気をつけてください。\nぬか漬けアプリ Perl入学式のアドベントカレンダーの7日目に、tomchaさんが書いた「ぬか漬けアプリ」は、なかなか味があって良いですね。\nぬか漬のすゝめ - Perlがくしゅう帳(Rubyも) ただ、どうしても気になったことが2つあったので、勝手に添削してみました。（とは言え、なにわPerlで事前に許可は得てあります）\nなるべく簡単に説明するために、厳密には正しくない部分もありますが、ご了承ください。\nモジュールの名前 Perlでは小文字のモジュール名はプラグマを示すという約束になっていますので、自作のモジュールは、Nukadukeのように大文字から始めなければなりません。\nPerl は小文字のモジュール名を、integer や strict のような\u0026quot;プラグマ\u0026quot; モジュールのために予約しています。 perlstyle - Perl スタイルガイド - perldoc.jp\nファイルシステムの都合で大文字小文字だけを変更するのは困難な場合が多いので、今回は名前を一旦Nukadokoに変更します。\n自作のモジュールを作成する場合は、ファイル名は大文字からにする、ということを覚えておきましょう。\n関数の名前空間 今回の場合、orenukaでuse Nukadokoすると、pickle、lookin、takeoutという3つのサブルーチンが使えるようになります。\nしかし、orenukaだけを見ていると唐突に関数が使用されていて、わかりづらいので、何処に定義されているのかをもう少しわかりやすく表示すると良いと思います。\nまた、このような使い方をしていると、意図せずに関数名が重複してしまうことがあります。\nPerlにはそれを防ぐ方法があります。\nPerlは、他のパッケージの変数によってあるパッケージが壊されるのを 防ぐために、選択的名前空間(alternative namespace)の機構を提供しています。 perlmod - Perl のモジュール (パッケージとシンボルテーブル) - perldoc.jp\n選択的名前空間を実現するのがパッケージ宣言です。\n今回はNukadokoを使用しているので、Nukadoko.pmにNukadokoというパッケージ名をつけることにします。\nNukadoko.pmの一行目を以下のように始めるだけです。\n1 package Nukadoko; そうすると、Nukadokoに定義されているpickleは、orenukaの中ではNukadoko::pickleとして使用できるようになります。\n多少文字数は増えますが、何処に書いてある関数を呼び出しているのかが確実に把握できるようにもなりますので、パッケージ宣言を使った上でuseするようにしましょう。\nどうしてもパッケージ名が省略したい場合は、ちゃんと方法はあります。\nExporterというモジュールを使用するのですが、詳しくはPODをご覧ください。\nExporter - Implements default import method for modules - metacpan.org やり方は1つじゃない Perlという言語を調べていると、必ずTMTOWTDIという言葉に出会います。\nThere\u0026rsquo;s more than one way to do it (TMTOWTDI or TIMTOWTDI, pronounced Tim Toady) is a Perl programming motto. There\u0026rsquo;s more than one way to do it - Wikipedia, the free encyclopedia\nThere's More Than One Way To Do It.は、「やり方は1つじゃない」という意味です。\n今回添削したやり方が唯一の方法ではありません。\nただし、もっとうまいやり方のためには、守ったほうが良い、あるいは、守るべき事もあります。\nPerlで守るべき約束事はそれほど多くはありませんので、この機会に是非覚えておいてください。\nperlstyle - Perl スタイルガイド - perldoc.jp 次回予告 明日はPerl入学式アドベントカレンダーで5回目の登場のpapixさんです。\nPerl入学式の歴史を振り返るみたいです。\nお楽しみに！\n","date":"2014-12-17T00:47:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/17/004713/","title":"勝手に添削 〜ぬか漬け管理アプリ編〜"},{"content":"@nqounetです。\nウェブアプリなどのプログラムを作っている時は、同じコマンドを何度も何度も入力することになります。\nそういう面倒な手順をもっと簡単なコマンドにしたい、という野望を叶えるモジュールがDaikuです。\ndaiku install 例えば、開発用のサーバーを立ち上げたり、データベースを初期化したり。\nそういう時は、そういう処理をまとめてシェルスクリプトに書いておいて、用途に応じて実行したりすると思います。\n私はシェルスクリプトが苦手なので、ちょっと難しいことをしようと思っても書けません。\nまた、例えば設定ファイルだけ活かした処理を手動で実行したいときは、設定ファイルの読み込みなどは既存のプログラムを利用できたほうが良いと思います。\n既存のプログラムがPerlの場合、シェルスクリプトではそういう手続きを書くことが面倒になってきます。\nDaikuを使うと、シェルスクリプトと同様のことだけでなく、既存のPerlプログラムを活かした手続きを簡潔に書くことができるのでとても助かっています。\nインストールはとても簡単。\n1 cpanm Daiku command not foundというエラーがでた人は、先に↓のコマンドを実行すると良いです。\n1 curl -L https://cpanmin.us | perl - App::cpanminus 簡単な使用例 Daikuをインストールすると、daikuコマンドが使えるようになります。\ndaikuコマンドを実行すると、そのディレクトリにあるDaikufileというファイルを読み込んで、そのファイルに書いてあるtaskを実行してくれます。\n私がどんな感じで使っているかというと、例えばdaiku installで、そのプロジェクトのcpanfileに書いてあるモジュールを全部インストールする、みたいなことをしています。\n1 2 3 4 desc \u0026#39;install perl modules\u0026#39;; task install =\u0026gt; sub { sh q(cpanm --with-all-features --installdeps .); }; descは、その後に書いたtaskの説明文です。\nshはシェルコマンドを示します。\nなので、この例では単純なシェルスクリプトと何ら変わりありません。\n複雑な使用例 プロジェクトの設定ファイルなどを活かした例としては、以下の記事が非常に役立つでしょう。\n勝手に添削: Test::mysqldとTeng::Schema::Dumperを使ってTengのSchemaクラスを自動生成する 〜Daiku編〜 | おそらくはそれさえも平凡な日々 また、Amon2のようなPSGIなフレームワークを使っている場合、環境変数のPLACK_ENVを設定して実行するようなことがあれば楽になります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 namespace migrate =\u0026gt; sub { desc \u0026#39;development database\u0026#39;; task development =\u0026gt; sub { $ENV{PLACK_ENV} = \u0026#39;development\u0026#39;; require MyApp::CLI::Migrate; MyApp::CLI::Migrate-\u0026gt;new-\u0026gt;run; }; desc \u0026#39;staging database\u0026#39;; task staging =\u0026gt; sub { $ENV{PLACK_ENV} = \u0026#39;staging\u0026#39;; require MyApp::CLI::Migrate; MyApp::CLI::Migrate-\u0026gt;new-\u0026gt;run; }; }; この場合、開発環境の場合はdaiku migrate:development、ステージング環境の場合はdaiku migrate:stagingのようになります。\nnamespaceとtaskの関係が間違っている気がしますが、書いているとこの書き方がしっくりと来るのでいつもこんな感じです。\nまとめ daikuは便利ですよ。\n特に、Perlのプログラムを作っているときはね。\n","date":"2014-12-15T08:45:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/15/084551/","title":"最近お気に入りのPerlモジュール（Daiku編）"},{"content":"@nqounetです。\n昨日（2014年12月13日（土））開催された「なにわPerl」に行ってきました。\nなにわPerl 会場は、Perl入学式でもよくお世話になっているJoe\u0026rsquo;sクラウドコンピューティングさんです。\n無料の勉強会が成立するのは、無料で会場を提供して頂いているからです。\nいつもありがとうございます。\n主催者っぽい書き方をしていますが、なにわPerlの主催者は私ではありません。\n主催者は、Perl入学式のサポーターであるtomcha（@tomcha_）さんです。\n前回のPerl入学式後の懇親会で骨子が決まって、早速開催することになったようです。\n勉強会を開催するのは、結構手間がかかったり面倒なことも多いので、彼のような方がいてくれるとコミュニティが活発になってよいですね。\nPerlのもくもく会？ 当初の目的としては、黙々と仕事をしようかなと思っていたのですが、Perl入学式のアドベントカレンダーのネタを仕込むことにしました。\n勉強会のタイトルはPerlなのに、何故かRubyやPythonの話も出てきました。\nほしい物リストに追加されました : \u0026lsquo;パーフェクトRuby (PERFECT SERIES 6)\u0026rsquo; Rubyサポーターズ via @amazon #naniwaperl でおすすめと言われた本 http://t.co/46zvDO2bGr — ネコ半径 (@azumakuniyuki) 2014, 12月 13\nもちろん、ちゃんとPerlの話題も沢山しました。\nMooseやMouseがどういうものなのかよくわからない、という話があったので、簡単に説明してみたり、Mojoliciousの仕組みを説明してみたり。\nAmon2とMojoliciousだったらどっちを使うのが良いか、というような話をしたり。\n普段は、Perlを使っている人達と交流することがあまり無い方が多いので、こういう機会があると色々と捗る感じです。\n私は、今週福岡に行っていて、Perlの話を満喫してきたのですが、それにもかかわらずこういう機会にも恵まれて、とても充実した一週間でした。\nちゃんとアドベントカレンダーのネタも仕込めたので、個人的には大満足の勉強会でした。\n次回が待ち遠しいですね。\n","date":"2014-12-14T14:51:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/14/145155/","title":"なにわPerlに行ってきた #naniwaperl"},{"content":"@nqounetです。\nチョット前にJSONRPCのモジュールを書いたのですが、その時に見つけた最近お気に入りのJSON変換モジュールを紹介します。\nJSON::MaybeXS JSON::MaybeXS - Use Cpanel::JSON::XS with a fallback to JSON::XS and JSON::PP JSON::MaybeXS - Use Cpanel::JSON::XS with a fallback to JSON::XS and JSON::PP - metacpan.org\nこのJSON::MaybeXSを知るまでは、JSONモジュールを使っていました。\nJSONモジュールは、JSON::XSが入っている環境では、自動的にそれを使ってくれるので便利に使っていたのですが、当時さらに速いCpanel::JSON::XSを使いたいと思っていました。\nそんな時に、このJSON::MaybeXSを見つけました。\nこのモジュールは、Cpanel::JSON::XS→JSON::XS→JSON::PPの順に使えるモジュールを使ってくれるので、少なくともJSONより遅くなることはありません。\nまた、個人的にJSON::MaybeXSで嬉しかったのは、JSON-\u0026gt;newとすることでインスタンスを作ることができることです。\n1 use JSON::MaybeXS qw(JSON); もし、私のようにJSONモジュールを好んで使っていた方がいたら、上記の1行をファイルの最初の方に書けば、それ以外は特に変更することなくグレードアップできます。\nJavaScriptではbooleanが扱いやすい JavaScriptを書いていると、色々な場面でbooleanがありがたいと思うようになりました。\nなので、JSON-\u0026gt;trueやJSON-\u0026gt;falseが使えるのはとても助かります。\nJSON::PPは標準モジュールです 今調べて知りましたが、JSON::PPは、v5.14から標準モジュールとして使えるようです。\n昨今の状況からすると、v5.14が使える環境が用意できるということは、おそらくcpanmも使えると思いますので、JSONを扱うのであればJSON::MaybeXSを使わない手はないと思います。\nJSON::MaybeXS - Use Cpanel::JSON::XS with a fallback to JSON::XS and JSON::PP - metacpan.org Cpanel::JSON::XS - JSON::XS for Cpanel, fast and correct serialising, also for 5.6.2 - metacpan.org JSON::XS - JSON serialising/deserialising, done correctly and fast - metacpan.org JSON::PP - JSON::XS compatible pure-Perl module. - metacpan.org JSON - JSON (JavaScript Object Notation) encoder/decoder - metacpan.org JSONの紹介 ","date":"2014-12-10T08:38:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/10/083802/","title":"最近お気に入りのJSON変換モジュール"},{"content":"@nqounetです。\nPerlの仕事で、Amon2を使ってサイトを作っていました。\nその際に、動画ファイルをログイン中しか見れないようにするために、動画ファイルを直接送信する必要がありました。\nその時に使った便利なモジュールを紹介します。\nPlack::App::File::Range Plack::App::File::Range - Serve static files with support for Range requests Plack::App::File::Range - Serve static files with support for Range requests - metacpan.org\nPlack::App::File::Rangeは、レスポンスをHTTPのRange対応にしてくれるモジュールです。\nあまり難しいことはわかりませんが、動画などを直接送信する場合には使っておいたほうが良いです。\n簡単な使い方 本来はPSGIアプリとしてそのまま使えるのですが、認証を通してから送信したいので、Amon2のコントローラーの中でレスポンス全体を作成しています。\n1 2 3 4 5 6 7 8 9 10 11 12 # Amon2のコントローラーと思ってください # 簡素化のため色々と省いています sub contents { my ($class, $c, $args) = @_; my $id = $args-\u0026gt;{id}; my $row = $c-\u0026gt;db-\u0026gt;single(\u0026#39;movies\u0026#39;, {id =\u0026gt; $id}); my $path = path($row-\u0026gt;content_path); return $c-\u0026gt;res_404 unless $path-\u0026gt;is_file; my $refs = Plack::App::File::Range-\u0026gt;new-\u0026gt;serve_path($c-\u0026gt;req-\u0026gt;env, $path-\u0026gt;stringify); return $c-\u0026gt;create_response(@$refs); } 説明的に言うと、Plack::App::File::Rangeのインスタンスからserve_pathメソッドに「PSGI環境変数」と「送信したいファイルのパス」を渡すと、HTTPのRangeに対応したPSGI仕様のレスポンスが返ってきます。\nそして、Amon2のコントローラーの、create_responseメソッドを使ってそのレスポンスをそのまま返してやります。\nリファレンスのまま渡す方法もあるのかもしれませんが、そのレベルには到達できませんでした。\nWAFのあるべき姿の一つ Amon2で、コントローラーから直接レスポンスを返せるのは良いと思いました。\n何かをラップするようなモジュールは、いざという時のためにラップしない手段を持っておく、ということが結構大事だなと感じました。\n例えば、全てがrender_*のようなものを経由する必要があった場合、Plack::App::File::Rangeみたいなモジュールは使えなかったわけで、泣きながらRangeに対応していたことでしょう。\nPlack::App::File::Range - Serve static files with support for Range requests - metacpan.org Amon2 - lightweight web application framework - metacpan.org ","date":"2014-12-09T08:53:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/09/085354/","title":"HTTPのRangeに対応するCPANモジュール"},{"content":"@nqounetです。\nようやくWordPressのOGPまわりで妥協できるレベルのプラグインを見つけました。\n本当に困ってました このブログはWordPressで作っているわけですが、プラグインの組み合わせなのかどうなのかわかりませんが、og:descriptionにタグまで入ってしまって困っていました。\nエスケープしてくれるのはありがたいのですが、できれば取り除いて欲しい…。\nそう思って久しぶりに新しく見つけたプラグインを試してみると、ようやくいい感じになりました。\nAdds proper Facebook Open Graph Meta tags and values to your site so when links are shared it looks awesome! WordPress › WP Facebook Open Graph protocol « WordPress Plugins\n最後にRead moreが入らなければ完璧ですが、そこは妥協します。\n玉石混交 WordPressは使いやすいCMSだと思います。\n設定も簡単だし、誰にでもサイトを管理できます。\nテーマは選び放題、プラグインも選び放題。\nみんながこぞって使うのもわかります。\nユーザーが多くなれば、当然供給も多くなるわけでして。\n供給が多くなると、残念ながらその品質にはバラつきが出てきます。\n贅沢な悩みですね。\nまあ、それは当然の話なのでとやかく言うつもりはありません。\n今はユーザーによる評価制度があることに感謝します。\n評価制度もユーザーが多くなければ機能しないので、CMSとしてかなり成熟しているWordPressだからこそ機能していると思います。\nこのプラグインも、利用しているユーザー数や評価を参考にしました。\nWordPress › WP Facebook Open Graph protocol « WordPress Plugins コレを機に、私もちゃんと評価していきたいと思います。\n","date":"2014-12-08T08:12:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/08/081212/","title":"ようやくWordPressのOGP周辺のプラグインが決まった"},{"content":"@nqounetです。\nプログラムのコードをいい感じに画像にしてくれるウェブアプリがあるのですが、名前やURLを忘れてしまって、ブックマークを漁ることになってしまいました。\n何度も探したので、いい加減ブログに書いておきます。\ninstacode Instacode 名前はInstagramに似ていたなー、というおぼろげな記憶が頼りです。\nドメインもカッコイイですね。\n画像がないのは淋しいが探すのは面倒臭い 最近は、ブログ記事の紹介などでサムネイル画像がよく出るので、ブログ記事には個別に画像をおいておくと良さそうな気がしています。\nとは言うものの、プログラムに関する画像はなかなかありません。\nそういうのを探すのも面倒ですし、そもそもそこに時間をかけるくらいなら1行でもコードを書いたり、ブログを書いたりした方がマシです。\nですが、そんな私にも救世主があらわれました。\nそれがInstacodeです。\nコードを貼り付けたあとは直感で インターフェイスはシンプルです。\nまずはプログラムのコードを左側のテキストエリアに貼り付けます。10行以上書いておく必要があります。\n次にエディタの雰囲気というかテーマを選びます。\n最後に言語を選んでProceedボタンをクリックします。\nしばらく待つと画像が出来上がるので、画像をグリグリ動かしたり、エフェクトを変更すれば出来上がり。\n残念ながら日本語は化けてしまいますが…。\nサンプルコードが簡単に、しかもいい感じの画像になるので使う価値がありますよ。\n","date":"2014-12-07T08:21:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/07/082125/","title":"プログラムのコードをいい感じの画像にするウェブアプリ"},{"content":"@nqounetです。\nJavaScriptのサンプルページでは、Grapnelというrouterを使っていたのですが、その後、もっとお気に入りのライブラリを見つけました。\n私にとっては、シングルページのウェブアプリを作るのには欠かせないものです。\n今日はそのライブラリを紹介したいと思います。\nJavaScriptのディスパッチャーの決定版 JavaScriptでシングルページアプリを作るなら、何かしらのページ遷移が必要だと思いますが、そういう時には、このライブラリがピッタリです。\nramiel/router.js Router.js is a simple yet powerful javascript plugin to handle hash fragment in order to route requests ramiel/router.js\nRouter.jsでどんなことができるか Router.jsはhashchangeイベントで動作しますので、普通にリンクをクリックすることで動作を切り替えることが可能になります。\n（このライブラリの機能からすると好ましくはないのですが、）ハローワールドをRouter.jsで書くと、例えば以下のようになります。\n1 2 3 4 5 6 7 \u0026lt;a href=\u0026#34;#/hello\u0026#34;\u0026gt;ハローワールド\u0026lt;/a\u0026gt; \u0026lt;script src=\u0026#34;router.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; var router = new Router; router.add(\u0026#39;#/hello\u0026#39;, hello); function hello(){alert(\u0026#39;Hello, World!\u0026#39;)} \u0026lt;/script\u0026gt; Router.jsの使い所としては、その名の通り、主にページ切り替えになると思います。\nhashchangeイベントの特性上、同じリンクを何度クリックしても最初の1回だけしか動作しないので、同じリンクでリロードになることがありません。\n処理をまとめて書く スクリプトから参照できるプレースホルダが使えるので、ページの切り替え処理をまとめて書いておくこともできます。以下のサンプルではjQueryも使っています。\n1 2 3 4 5 6 7 8 9 10 \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#/show/page1\u0026#34;\u0026gt;1ページ目\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#/show/page2\u0026#34;\u0026gt;2ページ目\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#/show/page3\u0026#34;\u0026gt;3ページ目\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;div id=\u0026#34;page1\u0026#34; class=\u0026#34;js-page\u0026#34;\u0026gt;1ページ目の中身\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;page2\u0026#34; class=\u0026#34;js-page\u0026#34;\u0026gt;2ページ目の中身\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;page3\u0026#34; class=\u0026#34;js-page\u0026#34;\u0026gt;3ページ目の中身\u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;router.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;jquery.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 1 2 3 4 5 6 var router = new Router; router.add(\u0026#39;#/show/:id\u0026#39;, function(req) { var id = req.get(\u0026#39;id\u0026#39;); $(\u0026#39;.js-page\u0026#39;).hide(); $(\u0026#39;#\u0026#39; + id).show(); }); この例では:idの部分にpage1やpage2などが入りますので、対応するdivを表示するようにしています。\nこのルーティングの定義は、DOM形成前でも可能なので、jQuery(document).ready()の中で定義しなくても問題ありません。\n404エラー ウェブサイトを作っていると悩むのが404エラーです。\nですがご安心ください。\nそんなエラーもRouter.jsで処理できます。\n1 2 3 4 5 6 router.add(\u0026#39;#/hello\u0026#39;, function() { alert(\u0026#39;Hello\u0026#39;); }) .errors(404, function(err, href) { alert(\u0026#39;not found\u0026#39;) }); コレでURLの直打ち対策も万全です。\n最初のページへリダイレクト 高度なアプリになると、ログインのような処理も必要になってきます。\nそうすると、最初はログインページを表示したいのですが、もちろんそういう場合にも対応できます。\n1 2 3 4 5 6 7 8 9 router .add(\u0026#39;#/login\u0026#39;, routeLogin) .add(\u0026#39;#/index\u0026#39;, routeIndex) .add(\u0026#39;#/logout\u0026#39;, function(){ session.expire(); router.redirect(\u0026#39;#/login\u0026#39;); }); router.run(\u0026#39;#/login\u0026#39;); ルーティングの定義は.で繋げて書けますので、沢山のルートもそれほど苦にはならないと思います。\nそして、準備ができたらrunで好きなルートへ飛ばすことができます。\nまた、redirectも可能なので、フォームのポスト後に別のページヘ飛ばすようなこともできます。\nもちろん万能ではない コレでもまだ一部の機能しか紹介していませんが、本当にいろいろな機能があります。\nしかし、全てをRouter.jsでやろうとするとハマります。\n大きなページ遷移のみをこのライブラリで実装して、ページ内の各機能はhashchangeを使わないライブラリで作るのが良いでしょう。\nそうしないと、思わぬところでページ遷移が発生して困ることになります。（経験者談）\nRouter.js最高 JavaScriptは本当に色々なライブラリが充実していて、気に入ったものを見つけるのは大変です。\n結構似たような用途のライブラリも多数（特にポップアップ系とかお知らせ系とか）あるので、使ってみて気に入ったライブラリは、ブログに書いたりしてちゃんと残しておきたいですね。\nramiel/router.js ","date":"2014-12-06T08:40:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/06/084044/","title":"シングルページアプリには欠かせないJavaScriptのライブラリ"},{"content":"@nqounetです。\nFacebookは良いツールですね。\n友達次第ではありますが、自分自身では追い切れない情報が入ってきたりします。\n今日は、そんな中から今後も使っていこうと思ったウェブアプリを紹介します。\nGitHubのお気に入りを管理するウェブアプリ Astral 使うには、当然ながらGitHubのアカウントが必要です。\n軽く使ってみましたが、インクリメンタルサーチが便利だし、タグ付けをしていくと、あとで探すのにもピッタリだと思います。\n「お気に入り」だけじゃ足りない GitHubは、すでにIT系のエンジニアには無くてはならないサービスだと思います。\nこのサービスでは、お気に入りのリポジトリにスターを付ける事が可能です。\n私は、使ってみたい、とか、気になる、とか思った時にスターを付けて、後で確認したり（しなかったり）していました。\nいま見てみると、そういうリポジトリが187個あったのですが、ここまで来るとあとで確認というレベルではなくなってしまい、あとで見る、という思いとは裏腹にあまり見ていないのが現状でした。\n特に、使ってみて気にいったものについては、例えばブログに書くとか、他の方法で記録しておかないと探すのも一苦労です。\n標準機能としてお気に入りの管理が欲しかったところですが、このAstralがあれば不要ですね。\n","date":"2014-12-05T22:37:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/12/05/223752/","title":"GitHubのお気に入りを管理するウェブアプリ"},{"content":"@nqounetです。\n妻が書いているご飯系（？）のブログ（WordPressです）が、更新してもブログ村に反映されない、というので診てみることにしました。\nMeals For Us | 私的な食べたログです。外食した記録を綴っています。 とにかく動かない とりあえず「ブログ村 反映されない」などで検索すると結構困っている方がいらっしゃいました。\nいくつか対策を試してみましたが、一向によくなりません。\n何故RSSが反映されないのか不思議でなりませんでした。\n慣れたやり方で 私は大体Feed Burnerを使っているので、同じやり方でやってみることにしました。\nFeed Burner すると、Feed Burnerからも読み込めないことがわかりました。\nさすがにこれはRSS自体がおかしいということで、RSSを直接読んでみると最初の宣言があるべき部分にbumpin.comという文字列がいくつも書いてありました。\nWordPress › BumpIn « WordPress Plugins ブログ村に反映されない原因は、このプラグインがRSSを壊してしまって読めないようになっていたことでした。\nプラグインが何故こんなことするかな？\n思い込みは良くない まさかRSSを破壊するプラグインがあるとは思いもよりませんでした。\n他のWordPressのサイトは問題なかったこともあり、RSS自体には問題がない、と決めつけていました。\nまずは、原因はこっちにある、と考えてから対処する必要があった、という良い教訓になりました。\n","date":"2014-11-18T08:32:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/11/18/083201/","title":"記事を書いてもブログ村に反映されません"},{"content":"@nqounetです。\nおかげさまで最近いそがしく、なかなか更新できませんがたまにはアウトプットしようと思います。\n今日は、Hubotをslackで使う時に、yeomanが便利だった話をします。\n直接インストールするのは deprecated になっていた 正確には覚えていませんが、Hubotをグローバルに入れようとした時にdeprecatedになっているのに気づきました。\nなんと、yeomanのgeneratorに存在するのでそっちを使え、ということらしいです。\n1 $ npm install -g yo generator-hubot 私の場合は、ndenvを使用しているので、グローバルに入れたあとはrehashが必要です。\n1 $ ndenv rehash yoコマンド炸裂 yoコマンドを使うと、アプリのひな形を作るかのように簡単にチャットボットが作成できます。\n1 2 3 $ mkdir -p /path/to/my-hubot $ cd /path/to/my-hubot $ yo hubot このジェネレーターの賢いところは、全て対話式で完成してしまうことです。\n訊かれるのは以下のこと。「()」は入力した値だと思ってください。\n1 2 3 4 ? Owner: (nqounet) ? Bot name: (slackbot) ? Description: (A simple helpful robot for your Company) ? Bot adapter: (slack) slackやidobataなどのチャットツールでhubotを使うにはadapterが必要なのですが、そのadapterのインストールもこれで完了してしまいます。\nこれで実質完成です。\nherokuで使うためにgithubなどにpushしておくと良さそうです。\n1 2 3 4 5 $ git init $ git add -A $ git commit -m \u0026#39;initial commit\u0026#39; $ git remote add origin http://github.com/nqounet/slackbot-test.git $ git push -u origin master herokuデビュー これまでherokuには縁がなかったのですが、調べているとhubotにはherokuがとても合っているということなので、ようやくデビューしました。\nheroku toolbeltというherokuのコマンドラインツールをインストールしておけば、先ほど作ったままデプロイまでできます。\n1 2 3 4 5 6 7 8 9 $ heroku login $ heroku create $ heroku rename nqounet-slackbot-test $ heroku config:add TZ=Asia/Tokyo $ heroku config:add HUBOT_SLACK_TEAM=nqounet $ heroku config:add HUBOT_SLACK_TOKEN=XXXXXXXXXXXXXXXXXXXXXXXX $ heroku config:add HEROKU_URL=https://nqounet-slackbot-test.herokuapp.com/ $ heroku addons:add redistogo $ git push heroku master 使ってみると、驚くほどあっさりデプロイ出来ました。\nconfigは、コマンドラインが不安であれば、ウェブからも設定できますので、後で確認するとよいでしょう。\n参考になる資料 公式サイトは英語ですが、最新の情報なのでざっと目を通しましょう。\nhubot/README.md at master · github/hubot わかりにくかったところは日本語で補完しましょう。\nいきなり難しいことをやろうとしても大体はうまくいかないので、少しずつできることを増やしていけば良いです。\nはじめてのHubot - Qiita slackにHubotを導入(Heroku経由) - Qiita Hubotで西木野真姫bot作ってSlackに呼ぶ - MEMOGRAPHIX 使ってみてわかりましたが、heroku最高です。\nToolbeltと組み合わせれば面倒も臆することもなくデプロイできます。\nHeroku | Home Heroku Toolbelt コレがあれば、少しずつの変更でも気軽にデプロイできます。\ngitでpushすれば良いのですから。\n","date":"2014-10-31T08:14:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/10/31/081425/","title":"Hubotをyoで作ってherokuにデプロイする"},{"content":"@nqounetです。\n最近、IdobataというツールをPerl入学式のサポーターたちで使い始めました。\nIdobataはチャットツールなのですが、webhookを経由して色々と通知を受け取れるのでなかなか快適です。\nしかもなかなか充実しています。\n折角なので、Perl入学式についての発言があったら通知するようなbotを作ってみました。\nだいたいこんな感じ メインスクリプトの全体像は大体こんな感じです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 #!/usr/bin/env perl use utf8; use v5.12; use AnyEvent::Twitter::Stream; use Encode; use Furl; use Config::Pit; my $config = pit_get( \u0026#39;nqounet@twitter.com\u0026#39;, require =\u0026gt; { consumer_key =\u0026gt; \u0026#39;consumer_key\u0026#39;, consumer_secret =\u0026gt; \u0026#39;consumer_secret\u0026#39;, token =\u0026gt; \u0026#39;access_token\u0026#39;, token_secret =\u0026gt; \u0026#39;access_token_secret\u0026#39;, } ); my $furl = Furl-\u0026gt;new; my $done = AE::cv; my $listener = AnyEvent::Twitter::Stream-\u0026gt;new( method =\u0026gt; \u0026#39;filter\u0026#39;, track =\u0026gt; \u0026#39;Perl入学式\u0026#39;, on_tweet =\u0026gt; sub { my $tweet = shift; $furl-\u0026gt;post( \u0026#39;https://idobata.io/hook/generic/xxxxxxxxxxxxxxx\u0026#39;, [\u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;application/x-www-form-urlencoded\u0026#39;], [source =\u0026gt; encode_utf8(qq{$tweet-\u0026gt;{user}{name} : $tweet-\u0026gt;{text}})] ); }, %{$config} ); $done-\u0026gt;recv; まずはアプリケーションを登録 TwitterはAPIが充実していますが、使う場合は登録が必要です。\nCreate an application | Twitter Application Management 登録は英語ですが、日本語の解説を読みながらだと簡単です。\nアプリケーションの登録 - Twitter APIの使い方 アクセストークンが必要なのでアクセストークンも発行しておきます。\n発行後、しばらく待っていると発行されてページに情報が表示されるようになります。\nOAuthしましょう 各種トークンの読み込みはConfig::Pitを使っていますが、パスワードを書かないようにしているだけですので、ハッシュで指定してもかまいません。\nパスワード設定をコードに書かない(Config::Pit) - モダンなPerl入門 OAuthを使用するので、Net::OAuthもインストールが必要です。\nPayload URL Idobataで任意のwebhookを受信するためには、Genericを選択します。\n設定にあるEndpoint URLに対してデータを送信することになります。\n通信にはFurlを使用することにします。\n慣れているならばLWP::UserAgentなどでも全く問題ありません。\nhttpsでの通信になるのでIO::Socket::SSLやLWP::Protocol::httpsもインストールが必要な場合があります。\nツイートをフィルタリング ここではAnyEvent::Twitter::Streamを使うことにします。\nインスタンスを生成する時にmethodにfilterを指定し、フィルタリングする内容をtrackに指定すると、該当するツイートが流れてきた時に、on_tweetが実行されます。\nPOST statuses / filter | Home また、Twitterでは、HTTPSでの接続を推奨しているため、AnyEvent::Twitter::StreamのドキュメントにあるとおりNet::SSLeayもcpanfileに書いてインストールするようにしておきましょう。\nサーバーに常駐させる このまま実行するとターミナルを開けたままにしておかないといけないので、デーモン化してサーバーに常駐させます。\nデーモン化するのはApp::Daemonがとてもお手軽です。\n1 2 use App::Daemon qw(daemonize); daemonize(); これが書いてあるスクリプトでstart,stop,statusなどのコマンドが使えるようになります。\nまた、デーモン化しないためには-Xというオプションをつけるとデーモン化しないので動作確認ができます。\nまた、不意のエラーから復活させるためProcletで監視させることにしたので、デーモン化するのはProcletの方です。\nつまり、デーモン化したProcletによってロボットを監視する構成です。\nまた、Procletでloggerを指定することで、プログラム本体はログの出力を意識する必要がなくなりますので、非常に便利です。\nサーバーに常駐させるスクリプトを作るときには、この構成が手軽で良さそうな気がします。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/usr/bin/env perl use utf8; use v5.12; use Proclet; use Path::Tiny qw(path cwd); use File::RotateLogs; use App::Daemon qw(daemonize); daemonize(); my $logfile = join \u0026#39;/\u0026#39;, cwd-\u0026gt;absolute, \u0026#39;log\u0026#39;, \u0026#39;app.log\u0026#39;; path($logfile)-\u0026gt;parent-\u0026gt;mkpath; my $logger = File::RotateLogs-\u0026gt;new( logfile =\u0026gt; qq{$logfile-%Y%m%d}, linkname =\u0026gt; $logfile, rotationtime =\u0026gt; 86400, maxage =\u0026gt; 86400 * 14, ); my $proclet = Proclet-\u0026gt;new(logger =\u0026gt; sub { $logger-\u0026gt;print(@_); }); $proclet-\u0026gt;service( code =\u0026gt; [qw(perl main.pl)], tag =\u0026gt; \u0026#39;bot\u0026#39;, ); $proclet-\u0026gt;run; このファイルも加えた結果、cpanfileはこうなりました。\nなお、デバッグ用にData::Printerも追加しています。\n1 2 3 4 5 6 7 8 9 10 11 12 requires \u0026#39;perl\u0026#39;, \u0026#39;5.012001\u0026#39;; requires \u0026#39;AnyEvent::Twitter::Stream\u0026#39;; requires \u0026#39;Furl\u0026#39;; requires \u0026#39;Config::Pit\u0026#39;; requires \u0026#39;Net::OAuth\u0026#39;; requires \u0026#39;Net::SSLeay\u0026#39;; requires \u0026#39;IO::Socket::SSL\u0026#39;; requires \u0026#39;App::Daemon\u0026#39;; requires \u0026#39;Proclet\u0026#39;; requires \u0026#39;Path::Tiny\u0026#39;; requires \u0026#39;File::RotateLogs\u0026#39;; requires \u0026#39;Data::Printer\u0026#39;; carton installでインストールされたモジュールは98個になっていました。\n…多いですね。\nしばらくはこの構成で様子を見てみようと思います。\n参考になる資料 perl - The Perl 5 language interpreter - metacpan.org AnyEvent::Twitter::Stream - Receive Twitter streaming API in an event loop - metacpan.org App::Daemon - Start an Application as a Daemon - metacpan.org Config::Pit - Manage settings - metacpan.org Data::Printer - colored pretty-print of Perl data structures and objects - metacpan.org Furl - Lightning-fast URL fetcher - metacpan.org IO::Socket::SSL - metacpan.org Net::OAuth - OAuth 1.0 for Perl - metacpan.org Net::SSLeay - metacpan.org Proclet - minimalistic Supervisor - metacpan.org ","date":"2014-09-15T22:48:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/09/15/224826/","title":"Perl入学式に関するツイートをIdobataに通知するボットを作った"},{"content":"@nqounetです。\n先日書いたPSGIとCGIの比較ですが、厳密には同じではありません。\nCGIで書いたほうは、かなり簡素化しています。\n簡素化せずに書くとどうなるのか、一部を試してみます。\nrequest_method と path_info 改めてMojoliciousで書いた方を見てみましょう。\n1 2 3 use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; {text =\u0026gt; \u0026#39;Hello World!\u0026#39;}; app-\u0026gt;start; getと/があると思いますが、コレに相当することをCGIで書いてみましょう。\n1 2 3 4 5 6 7 #!/usr/bin/env perl use strict; use warnings; if ($ENV{\u0026#39;REQUEST_METHOD\u0026#39;} eq \u0026#39;GET\u0026#39; and $ENV{\u0026#39;PATH_INFO\u0026#39;} eq \u0026#39;/\u0026#39; or $ENV{\u0026#39;PATH_INFO\u0026#39;} eq \u0026#39;\u0026#39;) { print \u0026#34;Content-Type: text/plain\\n\\n\u0026#34;; print \u0026#39;Hello World!\u0026#39;; } %ENVは環境変数です。\nCGIの場合は、ApacheなどのウェブサーバーがCGIを実行する時に環境変数をセットします。\nそれをPerlで取り出す時に%ENVを使います。\n%ENVは特別な変数ですが、扱い方は普通のハッシュと同じです。\nなので、一覧を見るときにはkeysやeachなどが使えます。\n1 2 3 4 5 6 7 for my $key (keys %ENV) { print \u0026#34;$key = $ENV{$key}\\n\u0026#34;; } # または while (my ($key, $value) = each %ENV) { print \u0026#34;$key = $value\\n\u0026#34;; } CGIを勉強するにしても、約束事というか色々な決まり事を覚える必要があります。\nどうせ覚えるなら、最新の情報を覚えておいたほうが良いのではないでしょうか。\n残念ながら、Mojoliciousが動作するPerlのバージョンはv5.10以降なので、まだまだ多くのレンタルサーバーでは使えません。\nでもご安心ください。\nv5.8にも対応しているMojoliciousがあります。\njamadam/mojo-legacy コレで、レンタルサーバーでも動きますね。\nstrict と warnings CGI側にある表記として、use strictとuse warningsがありますが、何故Mojoliciousの方には書いてないのか疑問に思った方。とても素晴らしいです。\n実はMojolicious::Liteと書くとこれらを自動的に有効にしたことになります。\n最近ではuse utf8も有効になるようになっています。\nuse strictは口が酸っぱくなるほど言っていることですが、それも最近の動向としては書かなくても自動的にuse strictの状態になろうとする方向になっています。\nところで、Perlの必要なバージョンを書くとそれ以前のPerlでは動作しないようになるのですが、（安定版で言うと）v5.12以降を指定すると自動的にuse strictの状態になります。\n1 2 3 4 #!/usr/bin/env perl use utf8; use 5.012; say \u0026#39;Hello, world!\u0026#39;; そして、ついでにsayというコマンドも使えるようになるので、簡単なサンプルを書くようなときには便利な記法だと思います。\n検索ワードは perl -cgi で Perlは古くからある言語なので、インターネットと共に発展してきました。\n検索してみると情報量は多いのですが古いものも多く、そのせいで最近の情報が手に入りにくいと思います。\nただ、CGIの情報を取り除くだけでも見た目は大分良くなりますので、検索ワードはperl -cgiが良いと思います。\ngoogleであれば、過去1年分のみを検索したりもできます。\n是非お試しください。\n","date":"2014-09-11T08:20:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/09/11/082056/","title":"厳密なCGIは難しいのでフレームワークを覚えましょう"},{"content":"@nqounetです。\n先週の土曜日はPerl入学式の第3回で、配列操作、ハッシュ、リファレンスを扱いました。\nその第3回にサポート部隊として参加してきました。\n入念な打ち合わせ 会場は12時半から使えるのですが、ちょうど昼時でもありますしランチを一緒にしながら軽く打ち合わせしましょう、ということで、会場近くのCoCo壱番屋へ行きました。\n2階はテーブルごとに電源もある（堂々と使えます）ということで2階でYAPCの話だったり、Perl入学式の今後についてなど、色々と話をしました。\nいざ本番 今回の講師は、講師経験もあるという @azumakuniyuki 氏をお迎えしました。\nさすがに安定感のある講師っぷりで、ホワイトボードを駆使して講義を進めていました。\nまた、実際に解説しながらスクリーンでコードを書き、結果も見やすく出力することで、実行結果がとてもわかりやすい講義でした。\n今年度は第1回、第2回ともに会場のキャパシティを超える参加希望者がいたので、今回からはJPAの支援も受けて会場を変更しました。\nおかげで快適に開催出来ました。\nそういえば、会場で2001年に書かれたページを参考にしながらCGIを書いていた方がいらしたのですが、その方には「これから学ぶのであればCGIではなくてPSGIが良いですよ」という話をしました。\n今でも「Perl」で検索すれば、CGIについての記述が沢山出てきます。\n未だに「Perlと言えばCGI」という状況でもありますが、それだけでなく、PSGIはコードリファレンスを返すので、初心者には何をやっているのかよくわからないものとして映るような気がします。\nただ、最近のウェブ開発ではフレームワークを使うのが一般的ですから、Perl入学式ではMojoliciousを使ったウェブアプリの作成をカリキュラムに入れています。\nMojoliciousでブラウザに「Hello World!」という文字を表示するには以下のように書けばよいです。\n1 2 3 use Mojolicious::Lite; get \u0026#39;/\u0026#39; =\u0026gt; {text =\u0026gt; \u0026#39;Hello World!\u0026#39;}; app-\u0026gt;start; 同じことをCGIで実行する場合は以下のようになります。\n1 2 3 4 5 #!/usr/bin/env perl use strict; use warnings; print \u0026#34;Content-Type: text/plain\\n\\n\u0026#34;; print \u0026#39;Hello World!\u0026#39;; なお、Mojoliciousは単体のウェブアプリとして動作しますが、PSGIにも対応しています。\n懇親会 本編が終わると外は雨。\n雨の中懇親会会場へ歩きました。誰も傘は持っていませんでした。\n幸い、それほど遠くない場所でしたので良かったです。\nほぼサポーターだけの懇親会（受講者は1名）で、かなり濃い話題が多かったような気がします。\nリファレンスが理解できたか訊いてみたのですが、優秀な方だったので余裕で理解できていたようです。\n働き盛りが多かったせいか、残念ながら料理があっという間になくなってしまいました。\n部屋を予約できるのはとてもありがたかったのですが、もう少し予算が必要だったのかもしれません。\n懇親会第二部 というわけで、お腹を満たすために第二部。\nただ、それほどお腹が空いているわけでもなく、軽くつまみながらアレコレ喋ってる感じでした。\n何を話していたのかあまり覚えてませんが、それはともかく、店員が寿司を売り込みに来たので気持ちよく一人一貫ずついただきました。\n初年度はほとんど懇親会を開催していませんでしたが、受講者の本音部分を訊くことができる良い機会になるので、懇親会は開催していきたいですね。\nただ、本当は前回まで来ていて今回は来なかった人たちのお話こそ訊いてみたいのですが、それは叶わないんですね…。\n","date":"2014-09-09T08:42:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/09/09/084202/","title":"#Perl入学式 in大阪 第3回をサポートしてきました"},{"content":"@nqounetです。\nYAPC熱冷めやらぬ今日このごろ、いかがお過ごしですか？\n私は熱くてもうダメです。\nPerl入学式のゴール どうやって決まったかは忘れましたが、ゴールは一行掲示板のようなウェブアプリを作る、ということにしました。\n簡易版twitterのような｢一言掲示板｣の完成を目標にして, その為に必要な知識を学んでいこうと考えています.\n何故ウェブアプリか、というと、ウェブアプリを作ることができる言語、という位置付けでPerlを捉えてほしいと思ったから、だろうと思います。\n既に3年目も半ばを迎える頃になって、今更感じたのですが、ゴールと中身が噛み合っていないですね。\n初年度は、12回の目標で結果11回になりましたが、ウェブアプリを作るためのMojoliciousというウェブアプリケーションフレームワーク（以下WAF）が登場したのは第10回でした。\n2回分でWAFの説明をしたのですが、出てくることがほぼ新しいことばかりで、とても大変だったと思います。\n応用編というのは、基礎編の知識があって成り立つのが大事で、こういう積み重ねで基礎が大事だな、という認識が得られるのだと思います。\nしかし、突然のウェブアプリ作成で、基礎編とほぼ無関係の新しいWAFを覚えなければならないというのは、覚えることが横に広がってしまって、達成感が得られないんじゃないかと。\nそして更に問題なのは、ここから応用するのが非常に難しいことです。\nもし、ゴールの設定を変えないのであれば、Perlの基本部分は軽めにして、WAF（例えばMojolicious）の使い方を初回から実施して、応用の仕方や応用に必要な知識をフォローしていく、という方が良い気がします。\nウェブから離れたゴール設定 今のカリキュラムのままで進むのであれば、コマンドラインのアプリを作るほうが、より達成感が得られるような気がします。\nそういう意味では、YAPC::Asiaでのbot作りがゴールでも良い気がします。\n1行掲示板の場合、ユーザーインターフェイスとしては、発言するボックスと、発言の一覧があれば良いです。\nということは、モードで考えると入力モードと一覧モードがあれば良い。\n昔風のプログラムであれば、入力の時は1、一覧は2、終了は9を押してEnter、という風に作っておき、それぞれ機能を分岐させる。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/usr/bin/env perl use utf8; use 5.012001; use DDP {deparse =\u0026gt; 1}; my @list = (); while (my $in = \u0026lt;\u0026gt;) { chomp $in; if ($in == 1) { print \u0026#39;\u0026gt;\u0026gt;\u0026gt; \u0026#39;; my $msg = \u0026lt;\u0026gt;; unshift @list, $msg; } if ($in == 2) { print @list; } if ($in == 9) { exit; } } 見た目はかなりしょぼいですが、一応機能的にはこれで満足しているはず。\nあとは、ちゃんとメニューっぽくしたり、if文の中身を関数にしたり、@listをファイルに保存したり、項目を追加してCSV（またはJSON）で保存したり、という風に拡張したりもできる。\nこれらは少しずつ追加で覚えればいいのですが、あらためて考えると、たったこれだけのことをウェブで動くようにするだけで1回分の説明がいるのはやっぱり大変ですよ。\n本当に今さらですが、ゴールがおかしいですね。えぇ。\n","date":"2014-08-31T21:25:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/31/212527/","title":"Perl入学式について振り返ってみた"},{"content":"@nqounetです。\nYAPC::Asia Tokyo 2014の2日目の感想を書きます。\n聴いているトークの数はかなり少ないはずなのに、何故か長いです。\n朝から快調？ 初日のHub貸し切りもほどほどの時間に切り上げて、そのままホテルへ。\nその後、感想ブログを書いていたら3時くらいになっていたのですが、目覚めはなかなか快調でした。\nチェックアウトを済ませて荷物をどこかに預けるつもりで出たのですが、残念ながら日吉駅の周辺では発見できず、お土産のバウムクーヘンを持ち歩きながらの参加になりました。\nうーむ。\n光の速度は遅い 突然ITインフラを任された人のための…監視設計入門 - YAPC::Asia Tokyo 2014 小規模なサービスの場合、設計から運用まで一人でやることもあって、監視についても独学でやっているのですが、不便さを感じつつもどう解決すればわからないので、聴いてみることにしました。\n大混雑ではないものの、テーブル席は満席で、部屋の壁にそって座り込んでいる聴衆が沢山いました。\n壁沿いで座られると、前に立つのもアレだし、間は微妙に狭いし、非常に居心地が悪い感じでした。\n何よりも、荷物があるのが億劫で、やはりもっと大きな駅にでも行って預けてしまったほうが良かったかとも思いましたが、もう手遅れ。\nまあ、それはそれとして、監視の話は色々とためになりました。\n設計については4つの状況に分けて考える方法とか、作業的には知らなかったコマンドとか、便利なオプションなどを知ることができて、明日からでも役に立ちそうです。\n監視サーバーを何処に置くかという話の中で、例えばヨーロッパに置いておくと地球を半周するので遅くなる、という話がありました。\n光が地球を半周するのには、まっすぐの場合でも70ms弱かかるので、往復すると140msかかることになるので遅くなる、というわけです。\n今まで光の速さについて遅く感じたことはなかったのですが、こう考えてみると遅いと感じてしまうのが新鮮でした。\n厳戒態勢 監視の話を聞いている最中に、何故かWi-Fiを増強していたのですが、案内を聞いて疑問が氷解しました。\n次のセッションがnaoyaさんのセッションだったからのようです。\n個人的には、その案内の仕方はどうなの、とも思ったのですが、今の私には不要だったのでイベントホールへ向かいました。\n聴きたかったJSON SQL インジェクション 朝はスッキリ目覚めたはずですが、どうも気力が足りてないようで、kazuhoさんのセッションを聴きに行きたかったはずなのにイベントホールでのんびりしていました。\n午後からは地域.pmミートアップ 2014にKansai.pmの代表として登壇するのと、Perl入学式 in YAPC::Asia Tokyo 2014のサポートもあって、緊張していたのかもしれません。\nそういえば、今年からPerl入学式に参加している方がYAPCに来ていて、のんびりしている時にお会いしました。\n時々、関西から何人くらい来ているか、という質問もされるのですが、正直把握はできていません。\nただ、私が知っている範囲では年々増えている感じではあります。\nPerl入学式会場設営 スタートが13時からで、ミートアップと完全に被ってしまったのですが、イベントホールはランチセッションが終わるまで入るのも微妙なのと、荷物をどうにかしたくてPerl入学式の会場のサポーターエリアを拝借することにしました。\n職権濫用な気もしますが、約得です。\nKansai.pmの代表 普段はあまり意識していないのですが、こう見えて（？）私はKansai.pmの代表をやっています。\nKansai.pmのアピールタイムの時はさすがに時間を使いすぎたような気がします。\n話をする時に脱線し始めると、何が言いたかったのかを忘れてしまって、かつ、なんとかまとめようとして、結局何がなんだか分からないことになることがよくあって、この時もよくわからないうちに無理矢理終わらせたような気がします。\nPerl入学式がKansai.pm発祥でいずれ世界へという話題、とか、いずれはYAPC::Asia Osakaを開催したい、という野望（無謀？）を語ったりしました。\nYAPC熱が少なからずあったとは思います。\nしかし、年内にはKansai.pmの第16回ミーティング（late 2014とか？）を開催して、半年後には第17回（early 2015とか？）を開催したいなと考えています。\nこの後uzullaさんとも話をしたのですが、やはり定期開催するのが良いよねと。\ngotanda.pmも3ヶ月ごと（9月に2回目）、とか、Hokkaido.pm casualやhachioji.pmは毎月とか、うまく行っているところは、定期開催にしています。\nPerl入学式も、初年度は毎月開催ということにして、かつ、開催する側に負担がないように色々と考え、「ちゃんと開催し続けられる勉強会」を目指してスタートしました。\nKansai.pmも、これまでの慣習もなかったことにして、ネタがなくても年2回開催するとか、私が代表のうちに仕組みを変えられるところは変えていきたいなという決意を今しました。\nかなりYAPC熱が出ている気がしますが。\nPerl入学式 in YAPC::Asia 前回のYAPC::Asiaに続けて、今回も開催できることになりました。\nサポーターとしてはあまり活躍できませんでしたが、賑やかしにはなったんじゃないかと思います。\nとにかく荷物が置いておけて助かりました。\nそれにしても、今回の参加者は優秀な方ばかりで、ちゃんと動くものを作っているのは素晴らしいと思います。\nプログラミングの初心者は、そもそもスペースとかカンマなどの「文字の区切り」の感覚が無かったりして度肝を抜かれることも多いのですが、今回は基本を抑えている方ばかりのようで安心でした。\nプログラミングの常識、というか言語によらない基本中の基本というか、そういった部分はやはり回数をこなすというか、書いて実行していかないとわかりません。\n書いてあることをただ書き写して実行するだけでも、意外と知識を吸収できるものです。\n読んでわかった気分になっていても実際に自力で書くのはとても難しい、ということもすぐに分かります。\nまあ、感想じゃなくなってきているのでこの辺にしておきます。\n女性率が非常に高かったのは傾向としては良いと思いました。\nリファクタリング Perlの静的解析入門とPerlリファクタリングツールApp::PRTのご紹介 - YAPC::Asia Tokyo 2014 Perlの解析ツールPPIを使って、変数名やクラス名などを変更できるツールです。\n仮に書いた変な名前のメソッドとか、用途が変わってしまった時に名前を変更したりするのは大変なので、解析しつつ名称変更ができるのは便利だなと思いました。\nこのツールを使って、Plack::RequestをPlack::Kudasaiに変更しても、ちゃんとテストが通ったので安心ですね。\n使う機会はあまりないかもしれませんが、過去に作った大きなCGIなんかを変更するには良いかもしれません。\n2日目はメインホールに入ってない LTは早々に諦めました。\nメインホール以外は既に入れないので、どうしようかと思っていましたが、偶然boolfoolくんと出会ったので、次回のPerl入学式の資料を一緒に確認することにしました。\n一緒に確認する、ということをして思ったのですが、一人だとこの手の作業は捗らないですね。\n迷った部分はすぐに意見を聞いて、反映して、確認して、という小さなサイクルを繰り返すことで捗ります。\nオンラインだと意見するのも億劫な感じなのですが、直接会っていると、自分自身の中にもそういうサイクルが生まれてきて、何気なく思っていたことがどんどん形になってきます。\nYAPCはこういう刺激があるのも良いですね。\n結局2日連続Hub 荷物もあるので早々に帰ろうと思いながら結構長居してしまいました。\nリクルートの人と何故かラスベガス（むしろカジノ）の話をしたり、明石から来た学生をKansai.pmやPerl入学式に誘ったり、songmuさんにKansai.pmでライブコーディングしてくださいってお願いしたり、なんだか初日よりも充実したHubだった気がします。\nまとめ YAPCでリブートがかかる、という感じで、漠然とした推進力が得られた感じがします。\nそれをうまく起動にのせて、Kansai.pmや、あるいはKansai.pm casualとかUmeda.pmとかでも開催できれば（あるいはしてくれれば）いいなぁ、と思います。\n地域ミートアップにしても、後に続く人がいなくて衰退、という例には暇がないわけで（実際、Kansai.pmもピンチでしたし）、知り合いがいないからできない、じゃなく、知り合いを作るために開催するくらいの勢いでいいんじゃないかなと。\n規模が大きくなって、動きにくくなって開催できなくなるなら、規模は小さくてもいいから何度も開催すればいいんじゃないかなと。\nブックマーク Dockerで遊んでみよっかー YAPC::Asia Tokyo 2014 Mobile App Development for Perl Mongers // Speaker Deck Google BigQuery の話 #yapcasia // Speaker Deck OAuth/OpenID Connectを用いてID連携を実装するときに気を付けること #yapcasia // Speaker Deck 結局naoyaさんのスライドをブックマークしていますがご愛嬌ということで。\n資料は、（公開される場合は）YAPCの公式サイトのトーク情報に追加されるはずなので、いずれはもっとブックマークも増えると思いますが、今のところこんな感じです。\n実際は、スライド本体よりも、トークからの派生の方がブックマークしがいがあるんですけどね。\nメモが取れないとそれもままならないので、次回は会場のキャパシティがもっと増えると良いですね。\n","date":"2014-08-31T11:47:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/31/114742/","title":"YAPC::Asia Tokyo 2014 2日目に行ってきました #yapcasia"},{"content":"@nqounetです。\nYAPC::Asia Tokyo 2014の1日目の感想を書きます。\n書いているうちに珍しく長くなってしまいました。\n朝寝坊 受付は0日目で済ませているので、余裕があったはずなのですが、会場についたら何故かオープニングの挨拶が終わりそうな時間でした。\nイベントホールが寒い イベントホールはかなり空調が効いていました。\nこれで節電しているというのは、かなり効率が良い空調機なんだと思います。\n聴きたいトークは2本目からだったので、朝ごはんにDMMかき氷を食べながら、無限コーヒーを飲んでのんびりしていました。\nそんなことをしている暇があったらさっさと並んでおけば良かったと思うことになるのですが、後の祭りです。\n満室です 聴きたいと思っていたのは、弾さんのSwiftの話だったのですが、満室で立ち見必至な感じだったのであっさり諦めました。\n聴くだけならあとで動画になるはずなのでそっちでも良いかなと。\nそれを言い出すと全部動画でいいじゃない、ということになるのであまり大きな声では言えませんが。\nそんな感じでイベントホールに戻って涼しい中でツイートを見たり、メモを見返したりしていました。\nやっぱり満室です 前回の反省も踏まえて少し早めに行こうと思っていたのですが、体を冷やし過ぎたのかお腹の調子が悪くなって、トイレにこもっているうちに時間になっていました。\n…案の定、満室でした。\nJSON Schemaの話で、APIのテストの話もあったのでこれは聴いておきました。\n感想としては、ライブラリはPerlではありませんでしたが、テストをなるべく楽にするという思想が良いなと思いました。\n限られたリソースをいかにして集中させるか、を考えた時に、自動化出来る部分は自動化する、という考え方はもっと一般的になっても良いと思いました。\n先日、富士通（だっけ？）がプログラムを自然言語から自動で作れるようにしてエンジニア不足に対応できるようにした、というような主旨のニュースがあったと思うのですが、ある意味それに似た感じのものです。\nただ、ある種、それも実はプログラミングだと思うのです。\n高級言語を更に高級にした感じの言語ですね。\nある約束のもとに書いたもの、というのはプログラムにほかならないと思います。\nJSON Schemaという約束のもとに書いたものが、APIになり、そのAPIをテストするプログラムになる、というのは、それ自体がプログラミング言語だと思います。\nお弁当は秒速で売り切れ 予想はしていました。\nここ数年あった、無理矢理ランチ大作戦的なアレは、個人的には良い取り組みだったと思うのですが、運営だけが頑張ってもなかなかうまくいかないのかなと思います。\nもちろん、少人数になるのできっかけにはなるのですが、それを活かすも殺すも結局は参加者次第なわけです。\nなくなったのは残念ですが、運営側の結構負担が大変そうなので仕方ないでしょうね。\n今日はイベントホールの日 昼からもイベントホールに入り浸りました。\n目的はライブコーディングだったので、その前のQuizNowの話は聴くつもりはなかったのですが、何気なく聴いていると結構面白いというか、ためになりました。\nAPIが完成するまでのツールとして、stubcellというのを作ったという話もありました。\n聴いていて思い出したのはeasymockだったのですが、どう違うのか試してみたいと思います。そのうち。\n終わったあとシールももらいました。\n大波乱のライブコーディング ライブコーディングは非常に興味がありました。\n凄腕のエンジニアがどういうふうにコーディングしているのか、生の情報が手に入るので楽しみにしていました。\n大きくスタイルが違っていたのは、カッコを順番に書く、ということでした。\n私は、クォートやカッコはセットで書いて（開いて閉じて）から中身を書く（コーディングだけじゃなく、こういう文書を書くときもそうです）のですが、開きっぱなしで書くんだなと。\nそれにしても、上手く動かないほうが会場が盛り上がっていて（もちろんうまく動いても盛り上がりますが）、ライブコーディングは大変だなと思いました。\nまあ、ライブコーディングでのコピペは良くなさそうですね。\n残念ながら、これから面白いというところで、次の会場への準備のため（トイレにも行きたくて）離脱したのですが、その後のツイートで、どうやらMacのsayコマンドはファイル出力ができる、ということを知りました。\n後でコマンドを確認してみると、oオプションでaiffファイルが出力されていました。\n1 $ say Ya -o ya これは良いですね。\n初のメインホール それからあとはずっとメインホールでした。\nSQLがまだまだ苦手なので、何かヒントになればという気持ちで、聴いていました。\n特に、どのようにインデックスを使うのが効率的なのか、ということがよくわかっていません。\n同じデータでも用途によってどう検索すれば速いのかが違う、という視点が新鮮でした。\nPerlのコードで見ると当たり前すぎてびっくりするほどで、最初は何を説明されているのかが逆にわかりませんでした。\n100枚のトランプの話では、マークと番号をどっちで検索するか。\n男女の話では、男性をカウントする場合には、予め男性が多いことがわかっていれば、性別で分けてから検索するのは無駄が多い、とか。\nこのトークで新しい視点を得たと思います。\n原型を留めていないMojolicious 続けて実践Mojolicious。\nMojoliciousはかなり大きなWAFで、これだけでアプリサーバーを立ち上げてサービスを提供できる機能を持っているのですが、色々なツールを組み合わせて使うと良いよ、という話でした。\n個人的には、ここまでやるならMojoliciousじゃなくても…という気持ちになりました。\nサーバーはPSGI仕様ですし、テンプレートはTest::Xslate。helperも使わず（？）にObject::Containerという別実装ということで、なんだか、use Mooseしているのに使っているのはhasだけみたいな印象でした。\nMojoliciousはPurePerlで頑張っているので、ある程度遅いのは仕方ないというか、なんというか。\nMojoliciousの深い部分（あまり見ないメソッドの話とか）の話を期待していたのでチョット残念でした。\nあぁ、そういえば、痛恨のハッシュタグミスをしてました。\nMojolicious使うならhypnotoad使いたい #yacpasia\nyacpasiaってなんなんだと。\nそれは置いておいて、hypnotoadは性能良いと思いますよ。\nJavaの話 JavaとPerl（というかほとんどのプログラミング言語）は似てる、という話（ぇ？\nPerlでもJavaみたいに書けるよ、という話（ぇぇ？\nそれはともかく、今日一日で、日吉と渋谷を3往復する予定ということでした。おつかれさまでした。\nそれと、tokuhiromさんがJavaで書いたWAFがあるということで、Javaで書くことになれば使ってみたいと思います。\nLT LTは勢いです。\nドラ娘は可愛かったです。YAPCも3回目ということで、かなりのベテランですね。ドラの叩き方も慣れた感じで素晴らしいです。\nそれにしても色々な話し方があるんだなと思いました。\nスライドの一枚目がフェイクだったり、いろいろ喋った上で最も言いたいことはpixivは全部小文字が正しい、ということだったり。\nベンチマークが必ずしも公正ではない、ということを突き止めたり、やたらに難しい数式が出てきたり。\n本当に多種多様でした。\n懇親会からHUB 今年も料理が沢山、デザートも沢山でした。\n巨大プリンは、私が発見した時にはかなり削り取られていましたが、これはシェアせざるを得ない、という感じです。しかし、スマホのカメラの性能は大事ですね。次はもっと良いカメラのスマホにしたいです…。\nHUBの貸し切りも大盛況で、隣の人と喋るのにも大声でないと聞こえない感じでした。\nアイコンで顔出ししているからなのか、いろいろな人に声をかけて頂いて助かりました。\nこうやって好き放題に食べたり飲んだりできるのも、スポンサーや運営の方々の苦労の賜だと思います。\nまだ明日もありますので、力尽きないようによろしくお願いいたします。\nまとめ YAPCに来て毎年（と言っても4回目）思うのは、この一体感の正体はなんのか全くわからない、ということです。\nそうは言っても、必ずしも全員と仲良く話ができるというわけでもないのですが、話しかければ何かしらの反応が返ってくる、というのが実際のところです。\nPerlのコミュニティが濃い、とよく言われますが、YAPC::AsiaはすでにPerlだけのイベントではなくなってきていますので、濃いというだけが原因ではないように思います。\nただ、今はまだこの謎の一体感に浸っていようと思います。\nリンク集 最後に今日のブックマークを貼っておきます。\n聴いていたものだけじゃなく、ツイートで流れてきて気になったものも入っています。\nElasticsearch.pm JSON Schema and Hyper-Schema 「チーム開発に役立つstubcell」ってタイトルでCodeGrid 2周年パーティでLTしてきた。 - from scratch コマンドラインツールについて語るときに僕の語ること #yapcasia // Speaker Deck Mojolicious + AngularJS + Yeoman = Mojangman? - Debuginfo ","date":"2014-08-30T02:21:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/30/022146/","title":"YAPC::Asia Tokyo 2014 1日目に行ってきました #yapcasia"},{"content":"@nqounetです。\nYAPC::Asiaの0日目の感想とか書いてみようかなと。\n受付での失敗 0日目は前夜祭、ということで、夕方からお祭りです。\n時間に余裕があったはずなのに、受付用のQRコードをダウンロードしてなくて大幅に時間をロスしてしまいました。\nしかもパスワードを覚えてなくて、スマホではダウンロードできず、結局パソコンでQRコードを表示したので、パソコン画面で受付していただきました。\nご迷惑をおかけしました。\n前夜祭 - ウェブアプリ10連発 なんとか無事（じゃなかったですが）受付を済ませたので、前夜祭を楽しみます。\n既に記憶が怪しいのですが、幾つか印象に残っているキーワードを書いてみます。\nGaiaChan HipChatからの通知ボット（だったかな？）用のアプリ。\nチームで開発している時に、何が起きているのかを通知する仕組みがあると便利、というのは毎年思っていて、実際にそういう開発をするときには使ってみたいとは思うのですが、なかなかそういう機会がないので残念です。\nこういう自動化ツールを使ってみたいですね。\nMusicBrainz MetalTubeの人のトーク中に出てきたウェブサービス。\nデータ収集に使っているサイト、という話だったような気がします。\nMetalTubeはハードロック、ヘヴィメタルの動画を探すためのウェブサービスです。\n知っている名前を検索したら動画が沢山出てきたので今後愛用していきたいと思います。\nttyrec ttyrec自体はウェブサービスではないのですが、これを元にしてターミナルでの操作をgifとして生成できる。\npecoのサイトなどで、ターミナルの様子をgifで表示しているのを見てどうやってるのか気になっていたのが氷解した。\nこういうのはPerl入学式でも使っていけばいいんじゃないかなと思った。\nこれは1日目のQuizNowでの話だったと思いますが、意図を伝える時に画像ではなく動画で伝える、ということで意思疎通がうまくいく、という話があって、こういうツールがあれば伝わりやすいんじゃないかなと思いました。\nターミナルでの入力は言葉で言っていてもなかなか通じない事もあるので、使っていけば良さそうです。\npplog ザッピング機能は良いですね。\nブログでもランダムで記事を出したりしていますが、過去の記事などは埋もれてしまうことがよくあります。\n有名無名問わず、コンテンツが良ければ自動的に拡散していくようなとても良い仕組みだなと思いました。\nそれと、メンテナンス画面に、Twitterの公式アカウントのツイートを表示する、というのは地味に良いと思います。\nTwitterのような外部のサービスを上手く使っていくことも今後は必要でしょうね。\ngifmagazine コンテンツ制作側が快適になるように作った、というのが印象的でした。\nさらっと書いていますが、普通に考えればリスクのほうが大きいと思います。\nまとめ いろいろな話が混じっている気もしますが、強引にまとめます。\n他のサービスもそうでしたが、（少なくともトークの上では）採算とかお金（マネタイズ）のことはあまり考えずに、使いたい、と思ったものを作って、それが結果的に同じことを考えていた人達に支持されて凄いサービスになっている、というのが大きな共通点だと思います。\nそう感じるのは、発表しているのが（たぶん）エンジニアだからなのかもしれませんが、本当に楽しそうに話をするのを見ていると、聴いていてこっちも嬉しい気持ちになってきます。\n見えない部分で苦労もあると思うのですが、YAPC::Asiaというエンジニアの祭典だからこそ、通じるというか伝わることもあるのかなと思いました。\nリンク集 最後に聴いている最中にブックマークしたリンクをまとめておきます。\nもしかすると1日目のも入っているかもしれませんが。\nMetalTube wri.pe - simple and smart notepad Dribbble - Show and tell for designers ttyrec: ttyレコーダー ターミナル操作の記録(ttyrec)からGIFアニメを生成するツールを作った - すぎゃーんメモ Iriguti ","date":"2014-08-30T00:04:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/30/000422/","title":"YAPC::Asia 0日目に行ってきました #yapcasia"},{"content":"@nqounetです。\n今日はYAPC::Asiaの0日目ですね！（2回目）\n大分遅れ気味な気もしますが、pub/subに興味を持ってZMQを入れようとしましたがチョット苦労したので備忘録的な感じで書いてみます。\npub/sub pub/subというのは何かというと、Wikipediaによれば「出版-購読型モデル」のことです。\n出版-購読型モデル - Wikipedia WebSocketを使って通信をする時に使う関数を、何かしらの用語から引っ張ってこようと思って色々と調べているうちに、ZeroMQというのを見つけました。\nそれで、そのPerl実装がZMQというわけです。\n1年半以上前にriywoさんが書いたgistのスクリプトを試してみようと思ったら、ZMQがcpanmですんなり入らなくてチョット苦労しました。\nZMQ 大体ログ見ればわかりますよ。と、いろんな人に吹聴しているのですが、結構わかりませんでした。\nログを見てみると、libzmqが必要っぽいのですが、homebrewにはないっぽい（brew install libzmqでは失敗）ので、なんだか面倒ですね。\nAlien::ZMQとZMQ::LibZMQ3を入れて環境変数をセット ZMQ::LibZMQ3をインストールできなかったログを見てみると、Alien::ZMQが見つからない、というエラーがあったのでそれを入れることにしました。\n1 $ cpanm Alien::ZMQ その後ZMQ::LibZMQ3を入れてみるとうまくいきました。\n1 $ cpanm ZMQ::LibZMQ3 また、ZMQ::LibZMQ2はAlien::ZMQを入れたあとも入らなかったのでやめておきました。\nそして、ZMQは標準では2の方を使うのですが、環境変数で3の方を指定するとそっちを使ってくれるようです。\nインストール時に指定すると、その後も使ってくれるようなので、一時的に指定します。\n1 $ PERL_ZMQ_BACKEND=ZMQ::LibZMQ3 cpanm ZMQ 無事にインストール出来ました。\nAPIが変わっている 元のスクリプトは2の方の仕様なので、そのままではエラーが出てしまいますので、一部変更する必要があります。\n調べてみたら同じことをしている人がすでにいました。\nPub/Sub | 情報基盤システム学研究室 こちらに書いてあるスクリプトがそのまま動きます。\nsub.plの方は、recv()になっているところをrecvmsg()に、pub.plの方は、send()になっているところをsendmsg()に変更すれば良さそうです。\nそんなわけで、無事動くようになりました。\nターミナルを3つ立ち上げて、sub.plを2つ動作させたあとにpub.plを動かしてみると、ちゃんと購読している分にだけsub.plが反応しているのがわかります。\n実際に動かしてみるとイメージがわかりやすいですね。\nまとめ インストール 1 $ PERL_ZMQ_BACKEND=ZMQ::LibZMQ3 cpanm Alien::ZMQ ZMQ::LibZMQ3 ZMQ スクリプト修正 1 2 3 4 5 # sub.pl 16行目付近 recv() -\u0026gt; recvmsg() my $msg = $sub-\u0026gt;recvmsg(); # pub.pl 21行目付近 send() -\u0026gt; sendmsg() $pub-\u0026gt;sendmsg($update); ちなみに、pub.plをずっと動かしているのも面白いですよ。如何でしょうか？\n","date":"2014-08-28T16:34:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/28/163444/","title":"MacOSXにZMQをインストールしてpub/subを試してみました"},{"content":"@nqounetです。\n今日はYAPC::Asiaの0日目ですね！\nさて、先日CPAN Authorになったばかりなのですが、自分でもびっくりするほどテストコードを書くようになってきました。\n例外（致命的なエラー）をテストするにはTest::Fatalがとても書きやすい（と私は思う）のですが、意外と日本語の情報がなかったので書いてみようと思います。\nテスト大事ですよ テストは大事ですよ、というような話は今更言うことでもないと思うのですが、モジュールを書くことによってそれを実感できたのが、CPAN Authorになったことよりももっと収穫でした。\nテストコードも読んでみよう まず何より他の人（モジュール）のテストコードをよく読むようになったことです。\nこれまでは、使い方の実例という位置付けで、使い方を確認する程度では見ていました。\n今は、全体的にどんなテストをしているのか、こういうメソッドはどうやってテストしているのか、というような気持ちで見るようになっています。\nそうすると不思議なもので、テスト用のモジュールについてもよく目に入るようになってきました。\n例外テストの基本形はeval 例外が発生するとプログラムが止まってしまうので、evalを使って例外を補足します。\nevalの中で発生したエラーは「$@」に入りますので、テストを書くときはこんな感じになります。\n1 2 3 4 5 6 7 8 use strict; use Test::More 0.98; like \u0026#39;a\u0026#39;, qr/a/, q{ like }; eval {die \u0026#39;a\u0026#39;}; like $@, qr/a/, q{ like eval }; done_testing; $@がqr/a/でマッチすればテストがOKなのですが、$@が何なのかが直感的に頭に入ってこない感じです。\nまあ仕方ないですよね。\nTest::Exceptionの時代 evalのテストは結構書くのが面倒なので、検索で見つけたTest::Exceptionを使ってみたのですが、書いてみると何か気持ち悪いなと思いました。\n何がそう感じさせるのか考えてみると、カンマが違うということに気づきました。\n例えばlikeは引数がカンマ区切りなのですが、throws_okは、例外を発生させるコードと検証用のコードの間にはカンマを書きません。\n1 2 3 4 5 6 7 8 use strict; use Test::More 0.98; use Test::Exception; like \u0026#39;a\u0026#39; , qr/a/, q{ like }; throws_ok {die \u0026#39;a\u0026#39;} qr/a/, q{ throws_ok }; done_testing; 慣れればこれで良いのかもしれませんが、***_okという書き方なのに引数の渡し方が違うのが、常に頭の隅で引っかかりました。\nで、ある時Test::Fatalを知って、即乗り換えました。\nTest::Fatal Test::Fatalを使うとexceptionという関数が使えるようになります。\nこれを使うと、例外が発生するコードブロックを、テストの中に直接書くことができます。\n1 2 3 4 5 6 7 8 use strict; use Test::More 0.98; use Test::Fatal; like \u0026#39;a\u0026#39; , qr/a/, q{ like }; like exception {die \u0026#39;a\u0026#39;}, qr/a/, q{ like exception }; done_testing; 書き方としては、evalのブロックを直接テストの中に書くことができるようなイメージです。\nexceptionを使うことで、テストの書き方を変えずに書くことができるようになりました。\nちなみに、例外が発生しない、というテストを書く場合はこんな感じで書くことができます。\n1 is exception {\u0026#39;a\u0026#39;}, undef, q{ live }; 個人的には便利だと思うのですが、如何でしょうか？\n","date":"2014-08-28T09:07:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/28/090712/","title":"例外をテストするならTest::Fatalが書きやすい"},{"content":"@nqounetです。\nリファレンスは難しい、とかよく言われるのですが、それって突然出てくるから難しいのかな、と思っています。\nそれならば、最初からリファレンスで覚えてしまえば抵抗ないんじゃないかなと。\nそもそもデリファレンスがややこしい プログラミングでのリファレンス（日本語で言えば「参照」）という概念はPerlだけじゃありません。\nでは何故Perlのリファレンスだけが難しいというふうに言われるのか。\nコレまで聞いている中では、デリファレンス（参照先を照会すること）が難しいというか、直感的ではないようです。\nまずは「デリファレンス」を無視して、リファレンスの簡単な書き方を覚えてみては如何でしょうか？\nJavaScriptのリファレンス（参照）という概念 あまり慣れていないJavaScriptで、あまり考えずにプログラムを作っていたのですが、ある時、何故コレがちゃんと動くのか、と疑問に思って確認してみると、JavaScriptでは、配列やオブジェクトは全てリファレンス（参照）でした。\nなので、配列やオブジェクトを扱うときは、必要なときには自動的にデリファレンスする、という感じです。\nJavaScriptでは、配列やオブジェクトを作るときは、本来は先に宣言してから書くのですが、リテラルで書くのが一般的です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 function show (args) { console.debug(args); } var str = \u0026#39;string\u0026#39;; show(str); // 配列 var array = [0, 1, 2]; // 配列の書き方で代入 show(array); // オブジェクト var obj = {key1: \u0026#39;value1\u0026#39;, key2: \u0026#39;value2\u0026#39;}; // オブジェクトの書き方で代入 show(obj); Perlでリファレンスを書く 先ほどのJavaScriptと同じようなことを、Perlで普通に配列やハッシュを使って書くとこうなります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use DDP {deparse =\u0026gt; 1}; sub show { my $args = shift; p $args; } my $str = \u0026#39;string\u0026#39;; show($str); my @array = (0, 1, 2); show(\\@array); my %obj = (key1 =\u0026gt; \u0026#39;value1\u0026#39;, key2 =\u0026gt; \u0026#39;value2\u0026#39;); show(\\%obj); 色々記号が出てきて嫌な感じですね。\nでは、JavaScriptと同じように、リテラルで書いてみます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 use DDP {deparse =\u0026gt; 1}; sub show { my $args = shift; p $args; } my $str = \u0026#39;string\u0026#39;; show($str); my $array = [0, 1, 2]; show($array); my $obj = {key1 =\u0026gt; \u0026#39;value1\u0026#39;, key2 =\u0026gt; \u0026#39;value2\u0026#39;}; show($obj); 記号が$だけになりましたね。\n@や%を使って書くよりも見やすいと思いませんか？\nプログラミング言語の基礎 プログラミング言語を覚えるときは、基礎は大事です。\nしかし、例えばJavaScriptで配列の作成方法として、ほぼ使わないような「宣言から作成する方法」から学ぶのは得策ではないように思います。\nより一般的に使われる、リテラルで書く方法から学ぶことが多いと思います。\nある程度覚えてから基礎を振り返ることによって、更に理解が深まる、ということもあるのではないでしょうか。\n","date":"2014-08-16T16:46:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/16/164630/","title":"例えば最初からリファレンスで覚えるPerl"},{"content":"@nqounetです。\n先日公開したばかりですが、JSON::RPC::Specをアップデートしました。\nRouter::Simpleを使ってます もともと、JSON::RPCがRouter::Simpleを使っていた事もあって、JSON::RPC::SpecでもRouter::Simpleを使って書いていました。\nところが、せっかくマッチングできるのに、その結果を利用できなかったので、マッチング後のハッシュをリファレンスで渡すようにしました。これができないとRouter::Simpleを使っている意味がありません。\nマッチングを使ったmethodはこのように書くことができます。\n1 2 3 4 5 6 7 8 9 10 11 use JSON::RPC::Spec; my $rpc = JSON::RPC::Spec-\u0026gt;new; $rpc-\u0026gt;register( \u0026#39;echo.{action}\u0026#39; =\u0026gt; sub { my ($params, $matched) = @_; return $matched-\u0026gt;{action}; } ); say $rpc-\u0026gt;parse( \u0026#39;{\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;echo.hoge\u0026#34;, \u0026#34;params\u0026#34;: [1, 2, 3, 4, 5], \u0026#34;id\u0026#34;: 1}\u0026#39; ); # -\u0026gt; {\u0026#34;id\u0026#34;:1,\u0026#34;result\u0026#34;:\u0026#34;hoge\u0026#34;,\u0026#34;jsonrpc\u0026#34;:\u0026#34;2.0\u0026#34;} これまでMojoliciousばかり使ってきたので、Router::Simpleがどんな事をするのかも、よくわかっていませんでした。\nというか、Mojoliciousのようにcontrollerとかactionを指定すると、Moduleに紐付ける機能があると思っていたのですが、そういうものではなく、条件とデータを設定しておくと、マッチした時にそのデータを取り出してくれる、とてもシンプルな機能のものでした。\n使い方がわかると便利さがわかりますね。\nJSON::RPC::Specにも、Router::Simpleのエッセンスが使えるようになりました。\n如何でしょうか？\nJSON::RPC::Dispatchは高性能 JSON::RPC::Dispatchは、Router::Simpleの機能をうまく使っていると思いました。\n予めデータとしてhandlerとactionを指定しておくと、その2つから実行するべき関数を上手に呼び出してくれます。\nhandlerにインスタンスを渡しておくと、そのインスタンスからactionのmethodを呼び出してくれます。\nそして、handlerやactionは単なるハッシュのキーなので、マッチングに使っておくと、JSONで指定した関数を呼び出すこともできます。\n1 2 3 4 my $router = Router::Simple-\u0026gt;new; $router-\u0026gt;connect( \u0026#39;echo.{action}\u0026#39; =\u0026gt; { handler =\u0026gt; MyApp::Echo-\u0026gt;new ); 上記の場合、package MyApp::Echoにある、{action}にマッチした関数が呼び出されます。\n自前でこういうのを実装するのは結構面倒なので、柔軟に処理を振り分けたい場合はとても便利ですね。\n","date":"2014-08-14T22:18:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/14/221829/","title":"JSON::RPC::Specをバージョンアップしました"},{"content":"@nqounetです。\n追記(2014/08/16): Plack::App::*は、ただのアプリケーションを登録する名前空間ではない事を知りました。考え方によっては、JSON-RPCの機能を追加する、という事でもありますが、なにか違う気がするので、とりあえず非推奨という扱いにしました。\nJSON::RPC::Liteは簡単に処理系を書きたいと思って作ったのですが、逆にJSON::RPC::Specからのアプローチで書いてみたらどうなるのかを確かめてみました。\nPlack::App::JSONRPC JSON::RPC::SpecにはHTTPサーバーとしての機能はないので、Plackを使って簡単なPSGIアプリを作ってみました。\n要望からの実装と、機能からの実装がどのように違うのかも確認できた気がします。\nPlack::App::JSONRPC - Yet another JSON-RPC 2.0 psgi application - metacpan.org newでmethodを渡せるようにしたので、処理系の書き方はLiteとそれほど変わりませんが、Plackの各機能を組み合わせて使えるので、より汎用的になりました。\n例えば /jsonrpc に対してこのアプリを設定してみると以下の様な感じで書けます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use Plack::App::JSONRPC; use Plack::Builder; my $jsonrpc = Plack::App::JSONRPC-\u0026gt;new( methods =\u0026gt; { echo =\u0026gt; sub { $_[0] }, empty =\u0026gt; sub {\u0026#39;\u0026#39;} } ); my $app = sub { [200, [\u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#39;text/plain\u0026#39;], [\u0026#39;Hello\u0026#39;]]; }; builder { mount \u0026#39;/jsonrpc\u0026#39;, $jsonrpc-\u0026gt;to_app; mount \u0026#39;/\u0026#39; =\u0026gt; $app; }; 如何でしょうか？\n内側の機能 Plack::App::JSONRPCを書くのに、Plackについて色々と調べていたのですが、よく言われているタマネギの機構が良いですね。\nplack-handbook/pylons_as_onion.png at master · miyagawa/plack-handbook JSON::RPC::Specは、JSON文字列を解釈してエラーも良い感じに処理してJSON-RPCっぽいJSON文字列で返してくれるのですが、時々レスポンスをハッシュのまま加工したい、と思うことがあります。\nテストの中では、レスポンスのJSON文字列をもう一度ハッシュに変換してから中身を確認しました。ハッシュの順序は確実に変わるので、文字列を単純に比較するとテストの結果が正しく得られません。\nPlack::Middlewareのようにwrap機構を備えて、JSON文字列とPerlの変数の相互変換だけを扱う処理を作成すると、テストでも扱いやすくなりますね。\n","date":"2014-08-14T19:22:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/14/192229/","title":"簡素なJSON-RPCサーバーを作ってみた"},{"content":"@nqounetです。\n少し前に作ったJSON::RPC::LiteをJSON::RPC::Specで書きなおしました。\nJSON::RPC::Lite JSON::RPCに刺激されて作ったJSON::RPC::Liteですが、JSON::RPC::Specはこのために開発したと言っても過言ではないので、ほぼコピペだったJSON::RPC::Dispatch::LiteをJSON::RPC::Specに変更しました。\nJSON::RPC::Lite - Simple Syntax JSON RPC 2.0 Server Implementation - metacpan.org nqounet/p5-json-rpc-lite 書き方は同じです。さすがに。\n1 2 3 4 5 use JSON::RPC::Lite; method \u0026#39;echo\u0026#39; =\u0026gt; sub { $_[0] }; as_psgi_app; 如何でしょうか？\n","date":"2014-08-14T18:24:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/14/182440/","title":"JSON::RPC::Liteを書きなおしました"},{"content":"@nqounetです。\nJSON::RPC::SpecというモジュールでCPAN Authorになりました。\nNobutaka Wakabayashi - search.cpan.org JSON::RPC::Spec JSON::RPC::Specは、JSON-RPCの仕様でJSONをやりとりできるモジュールです。\nRPCというのは、Remote Procedure Callのことで、ネットワーク上の別のマシンで処理を実行する手続きのことを言います。\nJSON-RPCは、そのRPCをJSONの形式で可能にした書き方の規格です。\nJSON-RPC 2.0 Specification RPCなので、ネットワーク越しの通信を想定しているのですが、その変換部分だけを実装したのが、このモジュールです。\nこんな感じで使えます。\n1 2 3 4 5 6 7 use JSON::RPC::Spec; my $rpc = JSON::RPC::Spec-\u0026gt;new; $rpc-\u0026gt;register(echo =\u0026gt; sub { $_[0] }); print $rpc-\u0026gt;parse( \u0026#39;{\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;echo\u0026#34;, \u0026#34;params\u0026#34;: \u0026#34;Hello, World!\u0026#34;, \u0026#34;id\u0026#34;: 1}\u0026#39; ); # -\u0026gt; {\u0026#34;jsonrpc\u0026#34;:\u0026#34;2.0\u0026#34;,\u0026#34;result\u0026#34;:\u0026#34;Hello, World!\u0026#34;,\u0026#34;id\u0026#34;:1} 狙いはWebSocket 前の記事でも書いたとおり、WebSocketでの通信時に使えるフレームワーク的なものが欲しかったのですが、JSON-RPCは通信についても含まれるので、単純にWebSocketで使うことはできません。\nRPCは送信側（client）と受信側（server）があって成立するようになっているので、双方向の通信には合いませんが、methodとparamsを用いる仕組みとして利用するのは可能だろうと思いました。\n効率的には、オレオレ実装の方が明らかに良いのですが、汎用性に欠けてしまうので、リモート要素がなくても規格に沿うのは良いことだと思います。\nそんなわけで、今はWebSocketで使えるようなモジュールを作っています。\n如何でしょうか？\n","date":"2014-08-14T12:26:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/14/122638/","title":"CPAN Authorになりました"},{"content":"@nqounetです。 JSON::RPCというJSON-RPCのPerlモジュールがあるのですが、これを使っているともっと簡単に書きたい、という気持ちになってきたので、簡単に書けるようなモジュールを作りました。\nnqounet/p5-json-rpc-lite JSON-RPCとは 最近、JSONでクライアントとサーバーのやりとりをすることが多くなってきたので、どうせならなにか規格っぽいのがないかと探してみたところ、JSON-RPCというのがありました。\nまあ、素人が考えるよりもいいだろうということで使ってみることにしました。\nJSON-RPC サーバー側の方を探してみたところ、PSGI仕様のそのままズバリな名前のモジュールJSON::RPCがあったので、これを使いました。\nJSON::RPC - JSON RPC 2.0 Server Implementation - metacpan.org JSON::RPC::Lite サーバーを動かすまではとても簡単だったのですが、必要な処理を書こうとすると結構面倒な気持ちになってきました。\n処理の振り分けにRouter::Simpleを使っていたので、例えばMojolicious::Liteのように書けるようにしてみよう、ということで作ったのがJSON::RPC::Liteです。\nちなみに、書き方はLiteですが、実質はJSON::RPCのラッパーなので軽くはありません。\n動かしてみる ごく簡単に、その辺にありそうな感じで書けます。\n1 2 3 4 5 6 7 8 use JSON::RPC::Lite; method \u0026#39;echo\u0026#39; =\u0026gt; sub { my ($param) = @_; return $param; }; as_psgi_app; このファイルを app.psgi として保存したら、plackupでサーバーが起動します。\n1 $ plackup app.psgi そうすると、http://localhost:5000にサーバーができるので、クライアントから例えば以下のようなJSONをPOSTで送ってみます。\n1 {\u0026#34;jsonrpc\u0026#34;:\u0026#34;2.0\u0026#34;,\u0026#34;method\u0026#34;:\u0026#34;echo\u0026#34;,\u0026#34;params\u0026#34;:\u0026#34;Hello!\u0026#34;,\u0026#34;id\u0026#34;:1} すると、サーバーからJSONでレスポンスが返ってきます。\n1 {\u0026#34;id\u0026#34;:1,\u0026#34;jsonrpc\u0026#34;:\u0026#34;2.0\u0026#34;,\u0026#34;result\u0026#34;:\u0026#34;Hello!\u0026#34;} 実行のタイミングによって項目の順序は変わりますが、オブジェクトとして考えれば同じなので、実質的には問題無いと思います。\nGitHubで公開していますので、よろしければ使ってみてください。\nちなみに、サーバーにJSONを送るときは、ChromeのアプリでDHCというのを使っています。\nDHC Service Chrome ウェブストア - DHC - REST HTTP API Client 履歴も残る（もちろん再利用も簡単）し、見やすいようにフォーマットしてくれるので気に入っています。\nJSON-RPCの実装 JSON-RPCのPerlによる実装は、実は結構あります。\n仕様的に最適なのはJSON::RPC2だと思うのですが、コードの書き方が難しく、私には使いこなせませんでした。\nJSON::RPCは、methodとparamsから結果を返すという機構がシンプルで良いのですが、Dispatchが面倒でした。\n今回欲しかったのは、paramsをそのまま引数にできる関数で、かつ、その近辺で発生したエラーについてもうまく処理してくれるものだったのですが、そんな都合の良いモノはありませんでした。\nそれ以外の処理も、欲しい部分はほとんどがJSON::RPC::Dispatch::handle_psgiに書かれていたので、乗っかることにしました。\nまあ、単純に$matched-\u0026gt;{code}が存在する場合は、それで実行する、というだけの機能を追加し、存在しなくなった$handlerを渡さないようにしただけです。\nJSON::RPC::Dispatch::handle_psgiにあっても害はない機能だとは思いますが、とりあえず、こっちもLiteにしました。\n本当はWebSocketでやりたかった 普通にパラメーターから関数を呼び出して値を返すだけなら、JSON-RPCではなく、RESTなAPIで充分なのですが、当初WebSocketでも使えるようなものを探していたので、JSON-RPCにたどり着きました。\nただ、先程も書いたとおり、エラー処理などを含めた丁度欲しい部分のモジュールがなく、それを書いたとしてもほぼJSON::RPC::Dispatch::handle_psgiと同じになるのが悩ましいですね。\n","date":"2014-08-09T10:14:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/08/09/101454/","title":"JSON::RPC::Liteというモジュールを書きました"},{"content":"@nqounetです。\n先日、インターネットエクスプローラーの重要性について思い知らされた事がありました。\nレイアウトが崩れる CSSのposition:absoluteで、要素を配置するようなプログラムを作っていたのですが、それがどうもIE11でちゃんと表示されない、という事案が発生しました。\n内部向けのツールなので、対応するブラウザはFirefoxだけということだったのですが、よく確認したところ、「IEを捨てるわけじゃない」ということでした。\n…日本語は難しいですね。\nIEなんてもう誰も使ってないと思ったのですが、世の中はWindows+IEで回っているみたいですね。\nIEではダメだったやり方 mustache.jsを使ってstyle属性を設定し、jQueryで要素を追加していたのだけど、それだとstyle属性が全て無視されてしまっていたようです。\njanl/mustache.js テンプレートのイメージはこう。\n1 \u0026lt;div style=\u0026#34;{{style}}\u0026#34;\u0026gt;中身\u0026lt;/div\u0026gt; 値のイメージはこう。\n1 {style: \u0026#39;top:\u0026#39; + top + \u0026#39;px;left:\u0026#39; + left + \u0026#39;px;width:\u0026#39; + width + \u0026#39;px;height:\u0026#39; + height + \u0026#39;px\u0026#39;} IEでもうまく行ったやり方 topとleftのみjQueryのcssメソッドで設定し、widthとheightはjQueryのwidthメソッド、heightメソッドで設定する。\nイメージはこう。\n1 2 var $el = $(\u0026#39;\u0026lt;div\u0026gt;中身\u0026lt;/div\u0026gt;\u0026#39;); $el.css({top: top, left: left}).width(width).height(height); 不毛な時間でした トライアンドエラーを何度も繰り返して、半日は悩んだ気がします。\nもちろん仕事なので大事だとは思います。\nしかし、テンションが上がらないことだけは確かです。\n","date":"2014-07-20T16:45:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/07/20/164522/","title":"インターネットエクスプローラーの重要性について考えさせられた"},{"content":"@nqounetです。\nPerl入学式ネタで3記事目です。\nそれなのにこういうタイトルをつけるとビビりますが、まだ勢いが足りてないような気もします。\nたった1つと書いていますが、2つ紹介します。\nData::PrinterあるいはDDP 最低限必要なのはこっちです。\nプログラミングの基本はデバッグです。\n文法を覚えることではありませんよ。（個人の感想です）\nPerl入学式も第2回まではスカラと配列だけですが、ハッシュも出てきて、さらに入れ子（リファレンスが必要です）になっていると中身を確認するのも一苦労です。\nその辺を感覚的に見てもらうためにも、データの構造がわかるような仕組みが必要です。\n最近はChromeのデベロッパーツールが常に画面に出ている状態ですが、JavaScriptのConsoleはいいですよ。\n配列もオブジェクトも丸見えです。\nPerlも使い勝手では負けますが、簡単にプリントデバッグできるモジュールがあります。\n1 2 3 4 5 6 7 8 9 10 11 #!/usr/bin/env perl use utf8; use 5.012; use DDP {deparse =\u0026gt; 1}; my $string = \u0026#39;Perl入学式\u0026#39;; my @foo = (\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;); p $string; p @foo; 変数も配列も中身の確認がこんな感じでできます。\nまあ、慣れてきても使えるモジュールですよ、コレは。\n嘘だと思ったら実行してみてください。\n動かなかったらモジュールが入っていないと思われます。\nPerl入学式で環境を整えている場合は、cpanmが使えるはずなので、インストールは簡単です。\n1 cpanm Data::Printer もっと詳しい使い方は、こちらの記事が参考になりますよ。\nPerlのデータ構造をダンプするためのモジュール群 | hirobanex.net Breno G. de Oliveira / Data-Printer - search.cpan.org そんなことよりもテスト とはいえ最近はテスト駆動の方がいいなぁとは思います。\nPerl入学式でも、条件式の説明をするときには、変数に様々な値を入力して動作を確かめていきます。\nでも、それってTest::Moreでやったらいいんじゃないか、と思ってしまうのです。\n書きなおすのではなくて追記できるから、どんな値を試したのかがわかるし、将来的にテストをすることに抵抗もなくなってプログラミングの品質向上にも繋がるはずです。\nなにより、色々なことが簡単に試せるのが良いです。\n今回の場合だと、if文の中身をok()でくくると、その中身が真の場合はok、偽の場合はnot okという表示になるので、どういう状態が真なのか、偽なのかが色々と試せます。\n1 2 3 4 5 6 7 8 9 10 11 12 #!/usr/bin/env perl use utf8; use 5.012; use Test::More; my $num = \u0026#39;42string\u0026#39;; ok($num == 42); ok($num eq \u0026#39;string\u0026#39;); done_testing; 慣れるまではメッセージがわかりにくいかもしれませんが、そういう時こそサポーターに聞けば良いと思います。\n最初から全部を使いこなす必要はありません。まずはokからはじめてみませんか？\nやりかたはいろいろある 今回の最終問題は有名なFizzBuzz問題でした。\nどんな問題なのかはこちらの記事か、あるいはFizzBuzzで検索してみてください。\nよしいずの雑記帳 FizzBuzz問題の解答例 まとめ で、初心者向けの場合は、大体3と5と15でif文を作るんですね。\nでも、それで決めて欲しくないんですよ。\nそういう意味もあって、15を使わない方法を書いてもらったり、FizzとBuzzの文字を1回しか使えないようにしてみたりしました。\n言いたかったことが伝わったかどうかはわかりませんが、答えが沢山あるのがプログラミングです。\nもしかすると、答えを聞きに来ているのかもしれないのですが、聞いた答えでプログラムが動いたとしても、それだけでいいんですか？\nそれだけだと、プログラミングがただの作業になってしまって面白くなくなっていきます。\nPerl入学式のような勉強会に参加する目的は色々とあるとは思いますが、少なくとも勉強会に参加する意欲を持っている人にはそういうふうにはなって欲しくありません。\n何も制約がない状態で1つ答えができたら、なにか制約をひとつ作ってもう一度解いてみる。\nFizzBuzzの場合なら、15を使えないようにする（3*5という風に書いてもダメ）とかが制約です。\nそういうことを繰り返すと、プログラミングの感覚が養われます。\nこの感覚は言語特有のモノもありますが、プログラミングの基本スキルだと思います。\nそして、その自分自身の軌跡を残しておくことも大事です。\n場合によっては1週間もしないうちに、自分自身の成長っぷりがわかると思いますよ。\n懇親会でpeco自慢 話がアレコレ飛んでますが、懇親会も楽しかったですよ。\nPerl入学式は、いくら敷居が低いとはいえ、やはり時間中は話しかけたりするのも躊躇すると思います。\n懇親会は、さらに敷居が低いので、沢山質問が来るのをいつも期待しています。\n時間中にもサポートした人には言っています。資料は2回分あるので是非予習をしてきてくださいね、と。大体の方は顔がひきつってますがw\nで、次回には（昨年の）第5回の資料について質問してくれると私は嬉しい、という風に言っています。\nテキストはかなりわかりやすいと思いますし、わからないところはわかりやすいように変更して行きたいと考えているので、できるだけ予習をして、できるだけ質問をして欲しいと思っています。\n本編ではこんな感じでサポーター側から声掛けすることが多いのですが、本来はフィードバックが欲しいところです。\n基本的にはそう思っていますので、バカ騒ぎしている中でもこっそりPerlの質問とかしても全く問題無いです。\nそれと、やはり情報交換ですね。\n講師役で画面を表示していると、ターミナルの画面がぜんぜん違うとか、画面がパパパパパっと切り替わるとか、そういうところも教えて欲しい、とか思いませんか？\n講師役をやるような人は大体教えたがりなので、想像している20倍位のことを教えられることになりますが、それって嬉しいからなんですよ。ドン引きしないでくださいね…。\n私は今回、残念ながら画面を映すことがなかったので、つい最近入れたpecoの自慢をするために（狭い席なのに）パソコンを取り出して操作して見せていました。\n自慢と言いながら、見せながらの操作はなかなかできないので、ものすごく中途半端な説明だったと思います。ごめんなさい。\nシンプルなツールだけに、何を伝えればいいのかよくわかりません。\nどんなことができるかは、公式のデモが沢山あってわかりやすいと思います。\npeco/peco pecoはバイナリ配布もあるので、使うだけならとても簡単ですよ。\n例えば、pecoをビルドしない - Qiita ghqとの組み合わせ技では、宮川さんが書いた（英語の）記事ですが、最後の方にあるgifアニメを見るだけでもなにか感じるものがあると思います。\nghq + peco/percol - Tatsuhiko Miyagawa\u0026rsquo;s blog 手元の環境では、ghqしたソースは$HOME/local/srcに入るようにしました。\npeco-srcしてからのsubl .みたいなのが快感です。\nもっと深く知りたくなったら、日本語の情報はQiitaがまとまってて良いと思います。\nPecoに関する34件の投稿 - Qiita まとめ 1 cpanm Data::Printer Test::More 1 2 3 use Test::More; ok(\u0026#39;ok\u0026#39;); done_testing; 1 ls | peco | xargs cat Perl入学式をよろしくお願い申し上げます。\n","date":"2014-07-19T13:34:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/07/19/133400/","title":"Perlで自走するエンジニアに必要なたった1つのモジュール"},{"content":"@nqounetです。\n公約どおり続きです。\nPerlの勉強会 #Perl入学式in大阪 #2 をサポートしてきました | IT Office Nishimiyahara どうやって教えるのか考えていた日々 自分自身が講師役をやっているときは、どうやって伝えるのか必死に考えています。考えていました。\n資料を作るときも、どういう言い方が理解しやすいだろうか、とか、どういう問題が調度良いだろうか、とか。\n3時間分とはいえ、資料を作るのにも結構かかりますが、Perlの裾野を広げたい、というモチベーションで初シーズンを乗り越えることができました。\nしかし、昨シーズンはほぼ顔を出していませんでしたし、今シーズンは優秀な後継者がいるので、少し離れた場所で見ているのですが、果たしてこれでよいのだろうか？と思うのです。\n運営の仕組みはかなり良いと思います。\nサポーター陣営も分厚い（初シーズンや昨シーズンの参加者がサポーターになってくれています）し、講師として頑張ってくれる学生さん（チョット負担かけ過ぎなので、もう少し分散してほしいとは思います）もいて、良いサイクルになっていると思います。\nそれらがわりと自発的になっていて、Perl入学式が一人で歩き始めた感じを受けています。\nだとしたら何が、と思うのですが、それはPerl入学式のコンテンツとも言える教材のことです。\n何を教えるのか 教える、というとおこがましいですが、他に言葉を知らないのであえて「教える」という言葉で表現します。\nPerl入学式は、プログラミングを初めて学ぶ人でもPerlのプログラミングを学習できる、ということをコンセプトにしています。\nしかし、素質がある人は別ですが、本当に初めての人が20時間ほどでプログラミングできるようになるとは到底思えません。\n教える必要があるのは、文法ではなくて、自力でプログラミングできるようになるにはどうすればよいのか、ということだと思います。\n最近読んだのですが、ずっとモヤモヤしていたことが活字になって飛び込んできた感じがしました。\n新卒エンジニア研修の取り組みやカリキュラム - 初めてのシステムと日記 ここにも書かれている「自走するエンジニア」という言葉にハッとしました。\nやらなければならないのは、自動車学校のようなことなのだろうと思うのです。\n最初に乗る車は簡単にはエンストしないような無骨なディーゼル車でいいんですよ。\nそれで運転の仕方を覚えたら、好きな車に乗ればいい。\n今乗っている車の細かいことを教えてもあまり意味は無いんじゃないかなと。\nPerl入学式は、Perlを教えるんじゃなく、プログラミングをPerlで教えるんだと。\nこの前のPerl入学式で、あまりサポートせずにこんなことを考えていました。\nまあ、妄想ですけど。\nテキストはいくつもある Perl入学式は、今期で3期目です。\nということは、既に2周しているので、テキストも2周分あります。\nPerl Entrance - 資料 (2012年) Perl Entrance - 資料 (2013年) 今期のテキストは大きく方向転換しない限り前期とほぼ変わりません。\n何故かと言うと、基本部分はきっちりと押さえて作ってあるからです。\nなので、個人的には出来る人はどんどん先に進んでいって良いと思うし、勉強会では本編とは全く違う質問をしてもらっても構わないと思っています。\nサポーターを困らせるほどの鋭い質問があってこそ、サポートしている価値があるというものです。\nそして、未経験者のかたも、どのあたりがわからないのかを把握する意味でも、目を通していただきたいと思っています。\n次回のPerl入学in大阪は 今のところの9月6日（土）に開催する予定です。\nその前の週はYAPC::Asiaなので、熱気冷めやらぬ雰囲気になっていると思います。\nという感じに上手くまとめた（つもりな）のですが、書こうと思ったことが結局書けていません。\nなのでまだ続きます。\n次回は、Data::Printer（あるいはDDP）、テスト駆動での勉強会ってどうよ、懇親会でpecoったはなし、の3本です。（予定）\n","date":"2014-07-17T01:03:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/07/17/010351/","title":"Perl入学式とはなんだったのか"},{"content":"@nqounetです。\n昨日は2014年度のPerl入学式in大阪の第2回でした。\nサポート部隊として参加した感想を書いてみます。\nPerl入学式in大阪 #2 on Zusaar 全体的には好評 関東在住の校長も絶賛するほど好評です。\n俺が言うのも何だが #Perl入学式in大阪 めっちゃいいな. — papix (@papix) 2014, 7月 12\nin東京、in福岡も好評のようで何よりです。\nよくあるかもしれない間違い 今回は変数の扱いやif文など、プログラミングの基礎部分を学びました。\nその中でPerl独特だなと思ったのは「elsif」です。\n最近、JavaScriptをよく書いているせいもあってか、「elsif」がとても奇妙に見えてきました。\nエラーで動かないんですけど、で見に行ったら「else if」になっていたりしました。\n他の言語を学んでいると、こういう部分が「なんでだろ～？」って思うところかもしれません。\n比較演算子あるある Perlは、数値の比較演算子と文字列の比較演算子があります。\n文字列を数値の比較演算子で評価すると、書いた本人にとっては想定外の実行結果になります。\n今回の例では数当てゲームを作っていたのですが、文字を入力しても何故か動く、ということに戸惑っていたようです。\n文字列を数値の比較演算子で比較すると、warningsが効いて警告が出るのですが、プログラム上は「0」の扱いで続けて実行されます。\nこうした警告が出た場合でもエラーとして扱いたい場合は、warningsにオプションを付けてやる方法があります。\n1 2 3 4 5 6 7 8 9 10 11 12 #!/usr/bin/env perl use strict; use warnings FATAL =\u0026gt; \u0026#39;all\u0026#39;; my $args = \u0026#39;hoge\u0026#39;; if ($args == 0) { print \u0026#34;$args is 0 !\\n\u0026#34;; } else { print \u0026#34;$args is not 0 !\\n\u0026#34;; } 通常であれば、警告は出るもののhoge is 0 !という表示になりますが、FATAL =\u0026gt; 'all'というオプションを付けることで警告がエラーと同じ扱いになります。\nこうするとちょっとした警告も見逃さないようになりますので、慣れないうちはこのようにして警告を受けないようなプログラムを作成するようにすると良いと思います。\n突然の成果発表会 勉強も休憩しながらとはいえ、4時間ともなると喋る方も大変です。\nなので、最終問題は参加者に発表していただきました。\n突然のムチャぶりでしたが、応えてくれたので（まあ、サポーターの知り合いですが）良かったです。\n他の方はどう思ったのかはわかりませんが、ワタシ的には好評だったので、次回もやってみたらどうかなと思いました。\n日本語問題やおまじない（お約束） 昨シーズンからは、お約束をシンプルにするためにuse utf8については書かないようにしていました。\nしかしいずれは通る道なので、そのうち解説は必要だろうなぁと思います。\n今回も、use utf8して日本語をprintすると警告がでる、という質問がありましたし…。\nこの辺は、ちゃんと説明をするのが大変なので、サポーターチームとしても悩みどころだなと思います。\n解説のためには、Perlの内部文字列とEncode::(en|de)code(_utf8)?についての説明が必要です。\n過去に読んだ記事を少し読み返してみましたが、入門として解説するにはテクニカルすぎたり、あまり触れたくない情報（「utf8フラグ」のこと）に触れていたりして、なかなか入門向けとして適切なソースが見つかりませんでした。\nそれでも、読むとすればこの辺りが良いと思います。\nEncodeでラクラク日本語処理 - JPerl Advent Calendar 2009 続・Encodeでラクラク日本語処理 - JPerl Advent Calendar 2010 Casual Track もしかしたらつづく まだ長くなりそうなのでつづきます。\nたぶん。\n","date":"2014-07-14T23:31:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/07/14/233125/","title":"Perlの勉強会 #Perl入学式in大阪 #2 をサポートしてきました"},{"content":"@nqounetです。\n今年も募集の最終日に応募しました。\nただし、本当の時間ギリギリではなく、朝のうちにですけど。\nGrunt/gulpを使ったAPIサーバ開発とCORSについて - YAPC::Asia Tokyo 2014 20分トーク 最近は、仕事ではPerlではなくJavaScriptがメインになってきていて、クライアントサイドのツール群を漁っています。\nJavaScript界隈ではかなり有名なライブラリやツールでも、全く聞いたことがなかったものもあるので、そういったものも紹介できればなと思っています。\nまあ、大体ブログに書いているので、いつも読んでいただいている方にとっては新しい発見はないと思いますが、もし採択されれば、軽めのyeoman用generatorも作ってみたいと思いますので、欲しい方はブクマやいいねをお願いいたしますw\nYet Another Perl Conference YAPCはPerlのカンファレンスですが、コテコテのPerl Mongerばかりでなく、Perl入学式の参加者のように、Perlについて学び始めたばかりの方も楽しめるようになってきています。\n裾野を広げる方向にシフトしてきているんでしょうね。\n裾野が広がっていくと思いもよらない化学反応がありそうで、それも面白いと思います。\n今年のYAPCで聴きたいと思っている一覧 当日になったら変わるかもしれませんが、今のところ聞いてみたいと思っている記事を自分用として貼っておきます。\nガチEmacs使いが真剣にAtomエディタに挑戦した記録 - YAPC::Asia Tokyo 2014 実務に役立つPerlライブコーディング～Webアプリケーション編 - YAPC::Asia Tokyo 2014 クイズを支える技術 - YAPC::Asia Tokyo 2014 Git を使ったツール開発 - YAPC::Asia Tokyo 2014 過去、現在、未来、全てのエラーメールを解析する。 - YAPC::Asia Tokyo 2014 SPA、それはSinglePageApplication。 - YAPC::Asia Tokyo 2014 Vagrantで本番と同じ開発環境をサクッと作る話 - YAPC::Asia Tokyo 2014 WHERE狙いのキー、ORDER BY狙いのキー - YAPC::Asia Tokyo 2014 ほんとにあったスキーマの話 「ソーシャルゲーム」 - YAPC::Asia Tokyo 2014 突然ITインフラを任された人のための…監視設計入門 - YAPC::Asia Tokyo 2014 TWiki − Perlで書かれたプログラマブルでglueでスケーラブルなCMS - YAPC::Asia Tokyo 2014 モバイルアプリとAPIのありかたを考える2014 - YAPC::Asia Tokyo 2014 Perl Mongersのためのstrace入門 - YAPC::Asia Tokyo 2014 ( ✌\u0026lsquo;ω\u0026rsquo;)✌ 楽しいモデル層開発 - YAPC::Asia Tokyo 2014 Perl Mongerのための日付時刻入門 - YAPC::Asia Tokyo 2014 OAuthやOpenID Connectを用いてID連携を実装するときに気を付けること - YAPC::Asia Tokyo 2014 毎日ライブコーディングをする男のライブコーディングノウハウ - YAPC::Asia Tokyo 2014 アプリケーション開発環境管理入門 - YAPC::Asia Tokyo 2014 おれはMojoliciousをこう使う - YAPC::Asia Tokyo 2014 JSON SchemaとAPIテスト - YAPC::Asia Tokyo 2014 Grunt/gulpを使ったAPIサーバ開発とCORSについて - YAPC::Asia Tokyo 2014 ","date":"2014-07-05T16:44:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/07/05/164452/","title":"YAPC::Asia Tokyoに応募しましたよ"},{"content":"@nqounetです。\nanyenvは便利ですね。\nRubyやNode.jsはツール群も多いので、rbenvとndenvは入れておいて損はないと思います。\nチョット残念なのは、phpenvがうまく動かないことですが、それをどうにかする方法をざっくりとまとめました。\nphpenvは2つある phpenvは私が知っている限りでは2つあり、1つはanyenvでインストールできるのですが、そちらは現在のところ動作しません。\nそしてもう1つの方ですが、こちらは他の*envと違って、cloneするだけではなく、インストールスクリプトを実行する必要があります。\nanyenvをインストールしたあと、anyenv install phpenvではなく、以下のコマンドを実行してphpenvをインストールします。\n1 2 3 4 5 6 7 # phpenvのインストール git clone https://github.com/CHH/phpenv.git $HOME/src/phpenv PHPENV_ROOT=$HOME/.anyenv/envs/phpenv $HOME/src/phpenv/bin/phpenv-install.sh # php-buildのインストール git clone https://github.com/CHH/php-build.git $HOME/src/php-build PREFIX=$HOME/.anyenv/envs/phpenv $HOME/src/php-build/install.sh このようにしてインストールすると、phpenv install -lのコマンドも正常に動作します。\n実はPHPのインストールも大変 VagrantでCentOS6.5（64bit）を使って仮想マシンを作ったのですが、その仮想マシンにPHPをインストールするのが結構大変でした。\n何しろいろいろなライブラリが必要なので、yumを使ってインストールできるライブラリだけでなんとかなるので、そちらもまとめておきました。\nインストール時には何もオプションをつけていないので、特別な用途のためにはライブラリが足りないかもしれませんが、その辺はご容赦ください。\n1 2 3 # PHPのインストール sudo yum install -y re2c libxml2-devel openssl-devel libcurl-devel libjpeg-turbo-devel libpng-devel libmcrypt-devel readline-devel libtidy-devel libxslt-devel phpenv install 5.5.13 やはり環境構築は大変ですね。\n","date":"2014-06-25T07:11:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/25/071123/","title":"anyenvのphpenvを入れ替える方法"},{"content":"@nqounetです。\nWordPressをコマンドラインで操作できるというwp-cliを使ってみました。\nブラウザで見てもエラーの情報がでない 元々は、データベース接続確立エラー、としか出ないので何がいけないのかわからず（user、passwordは何度も確認した）、闇雲に調べたところから始まりました。\nちなみに、デバッグ情報を出力するには、wp-config.phpでデバッグ情報を出力する設定もあるので、開発中はその設定を付けておくのが良いと思います。\nwp-config.php の編集 - WordPress Codex 日本語版 結果的には、socketが標準の場所になかったので、純粋にデータベースに接続できていないのが原因でした。\n閑話休題。\nwp-cliは、WordPressの全て（？）が操作できるツール、だそうです。\nwp-cli は、WordPress への各種の操作(本体のインストール・アップデートから plugin、theme のインストール・アップデートまで、すべてのことが！)をコマンドラインから行えるようにするツールです。 コマンドラインから WordPress を操作する wp-cli 初級編 | dogmap.jp\n本家はこちら。\nWP-CLI is a set of command-line tools for managing WordPress installations. You can update plugins, set up multisite installs and much more, without using a web browser. Command line interface for WordPress | WP-CLI\nインストールも簡単です。\n1 2 3 4 5 6 7 8 # ダウンロード curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar # 動作確認 php wp-cli.phar --info # 実行権限付与 chmod +x wp-cli.phar # Pathの通った場所へコマンドとして配置 mv wp-cli.phar ~/local/bin/wp コマンドはwpでなくても動作しますが、ほかにwpで動作するものがなければwpで良いと思います。\nインストールから設定まで 全てが操作できる、と言っているとおり、何もない状態から新しくWordPressをインストールして、wp-config.phpを作成してサイトを立ち上げるまでもコマンドだけで可能です。\nくわしくはこちら。\nコマンドラインから WordPress を操作する wp-cli 初級編 | dogmap.jp wp-config.phpがある状態では、設定を読み込んだうえで実行するので、設定がまずい場合はエラーが出ます。\n簡単な動作確認まで出来るのは便利ですね。\n","date":"2014-06-24T06:55:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/24/065552/","title":"コマンドラインからWordPressが操作できる"},{"content":"@nqounetです。\nPHPを動作するに際して、せっかくanyenvを使っているのでphpenvを入れてみたのですが、うまく動かなかったので差し替えた話です。\nphpenvは2つある anyenvが採用しているphpenvは、\nphpenv/phpenv こっちなのですが、ubuntuで試した時には何故かうまく動きませんでした。\n（例えば、phpenv install -l としてもインストール可能なバージョンがリストされない、とか）\nなので、~/.anyenv/envs/phpenvを削除して、\nCHH/phpenv こっちを同じ場所にcloneしました。\n追加でphp-buildをpathが通っているところに手動でインストールする必要がありましたが、幸いにも、anyenvからはこっちのほうがウケが良いようですし、phpenv install -lもちゃんと動きました。\nhelpなどにところどころrbenvの文字が残っているのが気になりますが、ひとまず動作するので気にしなくてもよいでしょう。\nmysqlの設定 phpenvを入れた理由は、WordPressをテストサーバで動かしたかった（つまり5.4以降をインストールしたかった）からなので、mysqlも設定が必要です。\n残念ながら、ubuntuに入っていたmysqlのsocketは、一般的な場所ではないらしく、ちゃんと設定しないとPHPからは接続できません。\nと言っても、php.iniにsocketのパスを書くだけで問題ありません。\nmysqlの設定を見るとsocketは/var/run/mysqld/mysqld.sockなので、インストールしたPHPのディレクトリにあるphp.iniを編集します。\n有効になるphp.iniの場所（path）は、以下のコマンドで確認することができます。\n1 php --ini で、そのphp.iniの該当する項目を変更します。\n1 mysql.default_socket = /var/run/mysqld/mysqld.sock これで、テストサーバでWordPressが動くようになりました。\n","date":"2014-06-23T06:52:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/23/065248/","title":"ubuntuにanyenvでphpenvをインストールしたけど失敗したので入れなおした"},{"content":"@nqounetです。\nこれを知った時、PHPってなんでもビルトインにするんだね。と思ったけど、とても便利なので良いと思います。 本当ですよ。\nオプションをつけるだけでサーバ起動 PHP 5.4.0 から、CLI SAPI にはウェブサーバーの機能が組み込まれるようになりました。\n[ PHP: ビルトインウェブサーバー - Manual ]\nたったこれだけで、そのディレクトリをルートにしたサーバ（ http://localhost:8000/ ）が起動するんですよ。\n1 php -S localhost:8000 なにこれすごい。 mysqlを設定しておけば、Wordpressもちゃんと動く。 開発環境が断然良くなった。 こんなに便利なんだったら、もっと大々的に謳ってくれればよいのに。\nウェブ開発にテストサーバは憑き物 さて、感動したことは言ったので、あとはグダグダです。 ウェブ開発に際しては、テストサーバを簡単に立てられるかどうかが勝負どころだと思います。 PerlにもMojoliciousやPlackベースのフレームワークにはテストサーバが簡単に起動できる仕組みがあります。 Node.jsも、Gruntなどのツールを使って簡単に開発用のサーバが立てられます。 PHPでガッツリ開発したことはなかったのですが、今回はWordPressのテーマを作成することになったのです。 今までは、既存のテーマ（PHPファイル群）をちょこちょこ修正というのがほとんどで、かつ、本番環境も自分自身で管理できるのが当たり前だったのですが、どちらも逆でした。 テーマをデザイン（HTML+CSS）から作成する、ということと、本番サーバには触れない、という条件でした。 これまで、開発環境を自らの手で選択できるのが当然だったので、あまりの不自由さに悶絶しました。 しかも、製作期間もあまりなく、とりあえず動けば良い、という感じだったので、ローカルマシン上に開発環境を作成する時間はもったいないと判断しました。 なので、以下の様な流れでテーマ作成をしていきました。\n手元でHTMLからPHPファイルを作成 作成したファイル群をzipで圧縮 WordPressの管理画面からテーマをアップロードして有効化（すでに有効の場合は、一度別のテーマに変更後、テーマを削除してからアップロードして有効化） 動作確認 1から4の繰り返し この内、3が本当に手間で手間でしかたありませんでした。\nコレが手間なのでWordPressのテーマ編集から修正して動作確認をしたりするのですが、そうすると、コピペで同期を取る感じになるのです。 こういう部分をコマンド一発で楽してきたツケか？と思うくらいに、単純ですがミスできない作業をひたすら繰り返しました。 もし、テストサーバがこんなに簡単に起動できると知っていれば、さっさと環境構築して、手元で動作確認しながら開発が進められたと思います。 実際には、anyenv→phpenvでのPHPインストールに躓いた（結局phpenvを差し替えた）り、mysqlのdefault_socketがデフォルトの場所にないためにデータベースに接続できないエラーが発生した（socketのパスをphp.iniに書くだけ、ということに気づくまでが大変だった）りしたので、テスト環境を作るのもやはり大変だったのですが。\nまあ、でも、苦労はしてみるもんですよ。\nこれで、直接テーマのディレクトリをgitで管理しながらの開発ができるようになりました。 開発環境の構築は何度もやるものではないのでノウハウがなかなか蓄積できないんですよね。 Perl入学式でも、何度もやっているのに、まだ環境構築でハマってしまうこともあるくらいですから。\n","date":"2014-06-21T13:46:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/21/134656/","title":"PHPでも簡単にテストサーバが起動できるなんて知らなかった"},{"content":"@nqounetです。\nWordPressは豊富なプラグインが売りの1つです。\nそのおかげで、PHPがまるでわからない私でもそれなりのものを作ることができます。\nただ、ちょっとわかれば貢献できるのになぁ…と思ったりもします。\nそれはパンくずリスト 「パンくずリスト」というのは、ピンとくる人は来るし、来ない人は来ないと思います。\n1 ホーム \u0026gt; カテゴリ \u0026gt; 項目 みたいになっているアレです。\n話によると、元の場所に帰ることができるようにパンくずを置いていった、というような逸話からの命名だそうです。\nで、システム的に親子関係が構築されていると、そこからパンくずリストを導き出すのはそんなに難しくないので、このメニューは自動的に作成できるのが普通です。\nWordPressにもそれはもう沢山あって、多すぎて選ぶのが大変、というくらいあります。\nなので、最初から全部試すというのはナシにして、あの手この手を使って使いやすいものを見つけました。\nパラメータでカスタマイズしやすいパンくずナビをプラグインにしてみた | Simple Colors このプラグインは、テンプレートタグ（phpファイルに書く関数を増やすプラグインのことですかね）タイプのプラグインで、パンくずリストを表示したい場所にPHPを埋め込むことで、その場所にメニューを作成してくれます。\n出力するHTMLのカスタマイズは、関数にHTMLを渡すことで、だいたい望み通りのものを作成できます。\n最近だと、この辺をテンプレートにするイメージなのですが、前後と間だけなので大したことはありません。\n基本的な記述方法 概念的な話は眠くなるので軽く流すと、パンくずリストはその名のとおりリスト形式で表示するべきだ、という意見が多いのか、UL（順序なしリスト）やOL（順序付きリスト）でマークアップされるのが主流だと思うのですが、今回は事情によりP（段落）でのマークアップでした。\n残念ながら、このプラグインはPには対応していなかったので、DIVにしたのですが、どうも出力がおかしいなと。\nソースコードを読んでみると、どうやら変数に追記しなければいけないところを上書きにしているようなんですね。\n出力用にoutputという変数があるのですが、開始タグを代入した後、本文で上書きして、その後に終了タグを追記しているので、開始タグが足りてない状況なのです。\n仕方がないので、本来ならPHPだけを書けば良い所でしたが、Pタグ（結局Pにしましたよ）で括ることにしました。\n時間が許せばトライアンドエラーでちゃんと動くようにすることもできたと思いますが、トライを何度もするには手間が掛かり過ぎる環境だったので、手っ取り早い修正方法でお茶を濁しました。\nこういう時に、さくっと直してプルリクエスト、というのがオープンソースだなぁ、という感じだと思いますが、まだまだその領域には達していませんでした。\n参考になる資料 パラメータでカスタマイズしやすいパンくずナビをプラグインにしてみた | Simple Colors ","date":"2014-06-20T23:50:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/20/235030/","title":"パンくずリストプラグインはパンくず文字列の方にバグがあった"},{"content":"@nqounetです。\nZusaarのページというか、Oboe.jsのサンプルページがあまりにも手抜きすぎたので、整形済みテキストではなくHTMLで書くようにしました。\nOboe.js | JavaScript Samples | nqou.net テンプレート よく言われるフレームワークに、MVCフレームワークというのがあります。\nModel, View, Controllerというものをそれぞれ独立させることで、開発を容易に行えるようにするものです。\n協業する際に、Viewの部分をデザイナーさんに任せられると楽だなぁ、と思いながらよく使うのですが、まあ、なかなかそんな方はいません。\n例えば、jQueryで新しいリストを追加する時にこんなことしていたら大変ですよ。\n1 2 3 4 5 6 7 var text = \u0026#39;hoge\u0026#39;; var $el = $(\u0026#39;\u0026lt;ul/\u0026gt;\u0026#39;).append( $(\u0026#39;\u0026lt;li/\u0026gt;\u0026#39;).append( $(\u0026#39;\u0026lt;p/\u0026gt;\u0026#39;).html(text) ) ); HTMLの中にパラメータを入れると、生成されるHTMLが想像しやすいですね。\n1 2 3 4 5 \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;p\u0026gt;hoge\u0026lt;/p\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; 実際に、リストで追加したい場合は、複数の要素があるのが普通ですので、liの部分をテンプレートにしておくと結構楽です。\nこのようなテンプレート機能を持つシンプルなライブラリとしてMustacheがあります。\n{{ mustache }} Mustacheを使ってリストの要素のテンプレートを使ったスクリプトを書くとこんな感じです。\n1 2 3 var $ul = $(\u0026#39;\u0026lt;ul/\u0026gt;\u0026#39;); var $li = Mustache.render(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;{{text}}\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;, {text: \u0026#39;hoge\u0026#39;}); $ul.append($li); リストを増やしたい場合は、render部分をループに入れておく、という方法があります。\nMustacheでも配列を操作できます。例えば、以下の様な構造のデータがあったとした場合です。\n1 2 3 4 5 6 7 8 9 10 11 { list: [{ text: \u0026#39;hoge1\u0026#39; }, { text: \u0026#39;hoge2\u0026#39; }, { text: \u0026#39;hoge3\u0026#39; }, { text: \u0026#39;hoge4\u0026#39; }] } listは、textというプロパティを持った配列です。\nこれをリスト形式で表示するには、以下の様なテンプレートを用います。\n1 2 3 4 5 6 {{#list}} \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;p\u0026gt;{{text}}\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; {{/list}} {{^list}}\u0026lt;p\u0026gt;値はありません\u0026lt;/p\u0026gt;{{/list}} 値がなかった時は、リストではなく段落で表示したりすることもできますよ。\nOboe.jsはループの中身の処理を書く Oboe.jsは、nodeイベントがあるお陰で、通常のJSON解析後、ループで処理する部分で処理が可能になります。\n普通の配列（例えばevents）を処理する場合は以下のようになるでしょう。\n1 2 3 events.forEach(function(value){ $html.append(Mustache.render(template, value)); }); Oboe.jsの場合は以下のようになるでしょう\n1 2 3 4 Oboe(url) .node(\u0026#39;events.*\u0026#39;, function(value){ $html.append(Mustache.render(template, value)); }); どちらも同じ関数で処理ができますね。\nループの中身は簡単にイメージできると思うので、それと同じように書けるのも利点の1つだと思います。\n参考になる資料 Streaming JSON loading for Node and browsers : Oboe.js Oboe.js | JavaScript Samples | nqou.net ","date":"2014-06-17T01:05:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/17/010512/","title":"Zusaarのページを更新しました"},{"content":"@nqounetです。\nMojoliciousのVersion5から、ログの書式を変更する属性が追加されたようなので使ってみます。\nログに情報を追加したかった 結構前になりますが、ログに情報を追記する方法を書いたことがありました。\nMojoliciousのログにパッケージ名と行数も出力してみた | IT Office Nishimiyahara この時は、無理矢理formatを書き換えたのですが、version5から、この関数が属性値として変更できるようになっていました。\n正式に変更できるのは気持ち良いですね。\n1 2 3 4 5 6 7 8 9 10 11 12 sub startup { my $app = shift; $app-\u0026gt;log-\u0026gt;format(sub { my ($time, $level, @lines) = @_; my $time_string = localtime($time); my @caller = caller(4); my $caller = join \u0026#39; \u0026#39;, $caller[0], $caller[2]; return \u0026#34;[$time_string] [$level] [$caller] @lines\\n\u0026#34;; }); my $r = $app-\u0026gt;routes; $r-\u0026gt;get(\u0026#39;/\u0026#39;)-\u0026gt;to(\u0026#39;index#start\u0026#39;); } caller(4)が非常に微妙ですが、これ以上は思いつきません。\n少なくともVersion5.07ではちゃんと出力した箇所を示しますが、ログの出力方法が変わればこの値は変更する必要があるでしょう。\n参考になる資料 Mojo::Log · yuki-kimoto/mojolicious-guides-japanese Wiki mojo/Changes at master · kraih/mojo ","date":"2014-06-17T00:28:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/17/002848/","title":"Mojoliciousでログの書式を変更する"},{"content":"追記：Mojoliciousについての記述で一部間違っていた部分がありました。一部修正してあります。\n@nqounetです。\n画像を使った何かを作ろうと思い、過去に自分自身で作ったサンプルを眺めていたのですが、どれもイマイチなので、カルーセル（スライダー？）を簡単に作れるライブラリである「OwlCarousel」を試してみました。\nこのライブラリ自体はとても簡単だったのですが、JSONを返すAPIのプログラムを作ったり、それらを動作させる開発環境を作ったりするのが結構大変でした。\nOwlCarousel | JavaScript Samples | nqou.net やってみたかったのは画像とJSON 画像ファイルは、以前使っていたサイズが揃ったものがあるので、それを流用するとして、そのリストをどのようにして作成するのか、というのを考えました。\nまた、昨今のアプリ事情を鑑みて、サーバからはHTMLではなくJSONを主に返すことにして、AJAXでリストを取得できるようにしようと思いました。\n開発するときは、JavaScriptのSame Origin policyが問題になってきます。\n実際の運用では、同じサーバにAPIを設定すればよいのですが、開発時は、例えばlocalhost:3000で起動させておいたサーバに対して、gruntで起動したサーバからAJAXで取得しようとするとエラーになります。\nというわけで、grunt-connect-proxyを使って開発してみました。\nnpm install grunt-connect-proxy(master) · 19aba9a · nqounet/web-js-samples JSONを返すプログラム APIを返すプログラムは作ったことがほぼないのですが、HTMLではなくJSONを返すのがメインになるようなプログラムもそんなに大したことはありませんでした。\n使ったのはいつものMojolicious。\n最初はMojolicious::Liteで作ったのですが、APIを増やすとわかりにくそうな気がしたので、普通に作りました。\nただ、基本的にはHTMLを返すプログラムなので、404エラーなどはHTMLで返ってきます。\nこの初期値を変更するのをどこでやればよいのかについて、結構調べましたが、route情報の設定で、formatを指定すればよかったようです。\nMojolicious::Rendererのdefault_formatで初期値を設定できるようです。下記のソースは書き換えてあります。\n1 2 3 4 5 6 7 sub startup { my $app = shift; $app-\u0026gt;renderer-\u0026gt;default_format(\u0026#39;json\u0026#39;); my $r = $app-\u0026gt;routes; $r = $r-\u0026gt;under(\u0026#39;/api/v1\u0026#39;); $r-\u0026gt;get(\u0026#39;/images\u0026#39;)-\u0026gt;to(\u0026#39;images#get\u0026#39;); } 久しぶりに作ると、色々と忘れていて、ますますメモの大切さが身にしみてきますね。\nまた、nginxの設定で、nqou.netのサブディレクトリ（/api/v1）にアプリサーバを割り当てたのですが、その場合に、アプリサーバへ渡るpathの情報にもサブディレクトリがついていることに気が付かなくて、ずっと404エラーになっていて困りました。\nかといって、route情報をアレコレ変えたくなかったのですが、幸いにも、その辺を簡単に処理できるメソッドもありました。便利ですね。\nそれも踏まえてroute情報は以下のようになりました。\nフレームワークは先人の知恵が詰まっていて、後に続く私のような者を助けてくれます。\n参考になる資料 OwlFonk/OwlCarousel Owl Carousel Yeomanでフロントエンドとバックエンドサーバを一緒に開発する drewzboto/grunt-connect-proxy ","date":"2014-06-16T00:45:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/16/004553/","title":"OwlCarouselを使うと簡単にカルーセルが実装できた"},{"content":"@nqounetです。\n厳密に言うと違うのかもしれませんが、デザインもツールを上手く使うことで表現に幅ができます。\nBootstrapは画期的だと思いますし、今でも愛用していますが、すべての機能を使いこなしているわけではないのと、あまりにも沢山の人が使うので、少々色合いを変えたくらいでは面白みにかける、というものです。\n軽い感じで使えるCSSフレームワークがないかなと、いつも探しているのですがなかなか見つかりません。\n気になっているヤツラ c2prods/Project-Tyson OnsenUI/OnsenUI sourcebitsllc/chocolatechip-ui Topcoat 他にもブクマしたような気もするのですが、探してもよくわからないので（だからこそブログで書こうと思ったわけですが）、とりあえず4つほど挙げてみました。\nTopcoatはCDNも充実していて使い勝手も良さそうなのですが、まだ使っていません…。というよりは、それ以外はざっと見ただけで、CSSフレームワークかどうかすら未確認です。\ntopcoat - cdnjs.com - the missing cdn for javascript and css yeomanを使うと、ひな形を作るのが簡単なので、サンプルページのようなものがどんどん増えていきますので、そのページに、少しでも使ってやりたいと思っています。\nJavaScriptのサンプルページのように、チョット枚数を増やして頑張ってみようとすると、すぐ挫折してしまうので、もっと軽い感じで作りたいです。\n小さな部品を組み合わせて使うのも良いよ Perlでも、大きなモジュール（ソフトウェア）をドーンと使うのは悪くはないと思います。\n例えばMojoliciousは私もよく使います。Mojoliciousはそれ一つだけでウェブアプリが作れるような大きなフレームワークです。\nしかし、例えば、違うフレームワークを使おうとすると、メソッド名が違っていて戸惑うことがあります。\nフレームワークが変わると最初から勉強しなおし、ということになりますよね。\nそんな時、多機能なソフトウェアではなく、単機能で洗練されたモジュールを使いこなすことで、それらを組み合わせて1つの大きな機能を提供することができます。\n例えば、JSONを使うだけの用途でMojolicious（Mojo::JSON）を使うのは、かなりダメです。\nJSONをメインに使うのであれば、もっと高速なJSON::XSあたりを使いたいですよね。\n単純な用途ではなく、複合的な用途、それこそWebAPIのサーバを作るときには、Mojoliciousを選択するのはありでしょう。\nまた、Mojoliciousは、Perl5.10以降であれば、標準モジュールがあれば動作することが売りの1つです。\n事情があってcpanmが使えない時には威力を発揮します。レンタルサーバなどでも、FTPでアップロードしてCGIのようにも使えます。\n…話がずれてきましたのでもとに戻すと、大きなフレームワークには、それなりの規模が相応しいものです。\n個人サイトのトップページだけのためにjQueryMobileを使うのは愚の骨頂です。（まさにhttps://www.nqou.netがそうです）\nグリッドレイアウトのためだけにbootstrapを使うのはオーバースペックです。\nレイアウトだけでなく、ボタンやアラート、モーダル、ポップアップなども使うときにこそ必要なフレームワークだと思います。\n…まあ、飽き性の言い訳ですかね。\n色々と書いてみましたが、書けば書くほど無理矢理感が芽生えてきました。\n結局のところ、好きなモノを使えばよいですね。\n","date":"2014-06-07T07:36:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/07/073658/","title":"近頃気になっているCSSフレームワーク"},{"content":"@nqounetです。\nブログの下書きにしたものを確認していると、またコレか、と思うことが多いです。\nプログレスバーとかはそんなに沢山いらないと思うのですが、どうしてブクマしてしまうんでしょうか？\nプログレスバーが沢山 お好きなモノをどうぞ、というような感じですね。\nPACE — Automatic page load progress bars HubSpot/pace 詳しく見てはいませんが、CSSを切り替えるだけで色々な進捗状況表示ができるような感じです。\nCSSだけでアニメーションさせるのは、プログラムで動きを作るのと違って、動きを定義する感じなので、慣れるまでは作るのが難しいです。\nCSSのアニメーションは、bootstrapで、classのinを追加したり削除したりするだけでアニメーションさせるのを見て、初めて理解できました。\n1つのサイトで何種類も使うのはありえないと思いますが、選択肢が広がるのは良いですね。\n個人的な好みとしてはCorner Indicatorです。\nどこか、というか、新しく作るサンプルページは、コレで作ってみたいと思います。\nオフラインを通知する さて、お次は今までお目にかかったことがない感じのモノです。\n詳しく見てはいませんが、読んで字の如く、オフラインを通知（警告）する機能があるようです。\nOffline.js – Handle your users losing their internet connection like a pro HubSpot/offline 実際のサイト（一つ目のリンク先）には実際に使われているので、サイトを表示したままネットワークを切ってみるとオフライン通知がでます。\nAJAXで遷移するようなアプリにはちょうどよい感じですね。\n普段はあまりネットワークが切れることはないのですが、回線が不安定なところではこのような警告は助かるかもしれませんね。\n","date":"2014-06-06T07:21:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/06/072133/","title":"似たようなものばかりブクマしている"},{"content":"@nqounetです。\nブックマーク代わりにブログを書こうと思っているのですが、記事が書けるほどわかっていないことが多くなりすぎて溜まってきてます。\nこのままだと未消化で終わりそうなので、項目を列挙してお茶を濁そうかなと。\n使ってみたい YUI Library Skin Builder ウェブ上でデザインをカスタマイズできるサイトを検索していて発見しました。\nSkin Builderがスゴイのですが、設定できることが多くて面倒になってしまって放置しています。\n時間がある時に何か作りたいと思うのですが、時間があっても気力がなくて放置したままです。\nコレが下書きの一番下にあって、いつも気になっています。\nYUIと言えば、yuidocが素敵ですね。\nJavaScriptで書いた関数について、メモ程度に書いておくだけでも、コマンド一発でちゃんとしたHTMLに仕上げてくれます。\nもちろん、gruntのプラグインもあります。\ngruntjs/grunt-contrib-yuidoc 正式な使い方はアレですが、ファイルの最初にクラス名、各関数にはメソッド名とパラメータの簡単な説明というように、書く内容が決まっているので、テンプレートを使っているように書けるのが良いです。\n普段は面倒であまり書かないのですが、yuidocを使うようになってから、関数ごとにコメントが入ってソースコードも見やすくなってきた気がします。\nコレがこのまま納品できれば楽なんですけどねぇ。\nフラットアイコンフォント Elusive-Icons Webfont | shoestrap.org aristath/elusive-iconfont ちゃんと読んでいないのでわかりませんが、たぶんアイコンフォントです。\nbootstrapにも、クラスを指定するとアイコンが使えるような仕組みがあります。（Glyfhicons）\nまた、この手のもので有名なのはFont Awesomeだと思います。\nComponents · Bootstrap Font Awesome, the iconic font and CSS framework ウェブアプリを作る場合、こういったアイコンがあると便利です。\n特にスマートフォンは、解像度の違いがあって、何も考えずに画像を使うとぼやけてしまいます。Retinaディスプレイもそうですね。\nなので、画像を使うよりもこういったアイコンのほうが使いやすいと思います。\n角丸もCSSでできるようになりましたし、部品としての画像ファイルはほとんど不要な時代になってきたと思います。\nデザインが苦手な私としては、こういったツールを上手く使うことで表現に幅を持たせたい、と思っています。\n","date":"2014-06-05T07:51:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/05/075152/","title":"下書きが多くなりすぎた"},{"content":"@nqounetです。\nOboe.jsでZusaarのイベント情報を取得するサンプルを作ってみました。\nOboe.js | JavaScript Samples | nqou.net 回線が速くてわかりません この前も書きましたが、zusaarはCORSに対応しているので、AJAXでJSONデータを取得できます。\nwww.zusaar.com/api/event/ しかし、回線が速くて処理が一瞬で終わってしまって、ストリーミングしている気がしないのが残念です。\n82KBくらいのデータなので、実感するにはもっと細い回線か、もしくは、もっと大きなデータ（MB単位）が必要でしょうね。\nところで、gruntには、通信速度を絞って検証できるgrunt-throttleがあり、コレを使うと面白い体験ができるようになります。\n通信帯域を調整できるgruntプラグインを紹介するよ - Qiita tjgq/grunt-throttle 100KB/秒くらいまで絞ればストリーミングが体感できますよ。…もっと絞っても良いですが。\nキーワードとは何なのか？ それにしても残念なのは、ZusaarのAPIでkeywordにPerlを指定しても、Perl入学式が出てこないことです。\nタイトルにPerlの文字が入っているのに、変ですよねぇ。\n今話題のSwiftの勉強会もあるようですが、それもキーワードで検索しても残念ながら出てきません。\nCORSに対応していて使いやすいAPIなので、是非よろしくお願いいたします。\n参考になる資料 Streaming JSON loading for Node and browsers : Oboe.js Oboe.js | JavaScript Samples | nqou.net ","date":"2014-06-04T22:52:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/06/04/225214/","title":"Oboe.jsのサンプルを作った"},{"content":"@nqounetです。\nWebでAPIを使うときは、受信するデータはJSONが主流だと思います。未だにXMLだけのところは早くJSONに対応してほしいと思いますよね。\nJSONはtableみたい かなり昔の話ですが。\ntableタグを使うと、テーブル要素をすべて読み込まないとレイアウトが決まらないので描画が非常に遅い、tableタグはなるべく使わないようにしよう、というような事が言われていた時代がありました。\nIE4とかの時代の話ですね。たぶん。\n当時は通信速度も56kbpsとか普通にあったので、巨大なテーブルだと画面が全然更新されないんですね。\nJSONのデータも普通に解析すると、最初のカッコに対応するカッコ（つまり最後のデータ）が来るまで解析できません。\ngulpのサイトのプラグイン検索はJSONデータを読み込んでいるのですが、そのデータは500KB以上あります。\nそれが全部読み込まれないと1つも表示されないのです。\nなので、まずは15件分だけを取得してページを更新し、その後残りを全部（700件以上）取得する、という方法をとっているようです。\nが、そんな苦労をしなくても、取得した部分から解析できればなぁ…って思いませんか？\nJSONの味方Oboe.js 実はOboe.jsならそれができるんです。\nその辺りを説明したページもまた凄いので、是非ご覧ください。全部見ると大変ですが、最初の2つだけでもイメージがわかると思います。\nWhy Oboe.js? : Oboe.js 使い方も驚くほど簡単です。\n欲しいパラメータ（プロパティ名）と、それらが揃った時に実行する関数を定義するだけです。\n例えば、先ほどのgulpのプラグインの名前（name）と概要（description）をコンソール画面表示するにはこんな感じです。\n1 2 3 4 oboe(\u0026#39;http://registry.gulpjs.com/_search?fields=name,description\u0026amp;q=keywords:gulpplugin,gulpfriendly\u0026amp;size=10\u0026amp;start=0\u0026#39;) .node(\u0026#39;{name description}\u0026#39;, function(args){ console.log(\u0026#39;name, description:\u0026#39;, args.name, args.description); }); 階層を意識しなくても値が取得できるのは衝撃でした。\nAPIから各種値を取得するだけならこの使い方で十分ですね。\nCORSには対応。しかしJSONPには… JavaScriptでJSONを取得する際に問題になるのは、same origin policy（同一生成元ポリシー）です。\nHTMLファイルと同じoriginであれば、JSONデータをAJAXで取得して使えるのですが、違うoriginの場合はこのデータを利用できません。\nAJAXで取得する場合、多くのAPIはこの垣根を超えるためにJSONPという方式で取得できるようになっています。\nしかし、Oboe.jsはJSONPには対応してなさそうです。（私が調べた範囲ではですが）\nそのため、取得する際には、相手のサーバがCORSに対応している必要があります。\n5つほどのサービスを使いながら調べてみましたが、gulpは対応、そしてzusaarも対応していました。\n残念ながら、grunt、ATND BETA、connpassは非対応でした。（gruntはJSONファイルを取得するだけっぽいのでAPIとは言えないかも）\n外部のAPIを使う際には使えない場合もありますが、自前のサーバで使用するなら十分利用可能です。\nこれからのAPIはCORSに対応する事が必要でしょうね。\nzusaarは、Perl入学式の告知に使っているのですが、優秀で勉強熱心なエンジニアが担当しているようで安心ですね。\n参考になる資料 Streaming JSON loading for Node and browsers : Oboe.js HTTP access control (CORS) | MDN 同一生成元ポリシー - JavaScript | MDN ","date":"2014-05-31T10:38:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/31/103829/","title":"JSONをストリーム受信できるOboe.jsがスゴイ"},{"content":"@nqounetです。\nちょっとしたスクリプトを書くときでもついつい使ってしまう。\njQueryはそんな奴なのですが、ちょっとだけ使うには結構重いサイズのライブラリです。\n頼りになります 使いやすさは慣れなのでアレですが、jQueryは程々にブラウザ互換があり、プラグイン（言い方を変えればjQueryに依存したライブラリ）も沢山あります。\nそんな中で、最近は私の開発手法が変わってきていて、CDNを使わないようになってきているので、小さいライブラリを使いたい、という欲求が出てきています。\n昔は、CDNというとgoogleが大きく前進していて全世界キャッシュも有効だったと思うのですが、最近はjQuery自体もやっているし、MicroSoftもやっています。もちろん、googleも。\nCDNは全世界のトラフィックを軽減する仕組みだと思うのですが、どうして皆さんがそれぞれ負担したがるんでしょうか？\n私には理解できません。\nCDNは良い仕組み（だった） 随分前ですが、jQueryの読み込み速度を測ってみたのですが、手元のサーバからよりもgoogleからのほうが早く読み込みができていました。\n読み込みが早い上にキャッシュも期待できる、と考えればCDNを使わない手はありません。\nところで、bowerとgruntやgulpなどのツールを使っていると、ライブラリを追加したり削除したりするHTMLファイルの修正が不要になる（コマンドでできる）のでとても便利です。\nそんな中で、例えばjQueryをCDNにしていて、読み込めなかった時のfallbackを行う、という手続きを敢えてするのが億劫になってきます。\nまあ、その処理を実行するコマンドを入れれば済む話なのですが、ライブラリの読み込みについて考えることが既に面倒だと思うようになっているんでしょう。\nCDNについては結構頑張ったつもりですが、最近はもういいかなと思うようになってきました。\njQueryの代用品を求めて 話を戻すと、jQueryは牛刀みたいなものなので、もっと手軽なフルーツナイフくらいのものでいいかな、と思うことがよくあります。\nAJAXも使わないし、jQuery依存のライブラリも使わない、というような場合でも、onclickで書くのは微妙…、というような時に使えそうな、jQueryと（ある程度は）互換性がある軽量なライブラリがいくつかあります。\nその中で、最近気に入っているのはDOMtasticというライブラリです。\nwebpro/DOMtastic 例によってmicrojsで見つけたライブラリですが、つい最近までEvergreenという名前だったようです。\nuglifyしてgzipで圧縮すると、大体3.4KBくらいです。\n同じ条件でjQueryはどうかというと、大体33KB（1.11.1の場合。2.1.1は大体30KB）です。10倍ですね。\nDOM操作で必須とも言える$(document).ready(...);はもちろん使えますし、onやappend、prepend、$.extendなどよく使いそうなものはほぼ使えます。\nただ、APIのリストにはdataがあるのですが、コレが思ったように動かなくて、よくハマります。\n値がほしいだけならattrを使えば良いので問題はないのですが、既にjQuery向けに書いてあるスクリプトを移植するのは大変ですね。\nもう一つ、jBoneというのも使ってみたのですが、コレも結構良さそうです。\nkupriyanenko/jbone $(document).ready(callback);は使えないのですが、その代わりに$(document).on('DOMContentLoaded', callback)とすれば良いです。\nまた.each()がなく、代わりに.forEach()を使うことになるのですが、要素の入る順番がjQueryとは違う（ただし、配列のメソッドのforEachとは同じ）ので注意は必要だと思いました。\ndataもちゃんと動作して、かつ、ファイルサイズも2.9KB程でした。\n他にもzeptoというライブラリもあることは知っていますが、使ったことはありません。\n注意してまで使うのか？ こうやって、色々と試すのは楽しいのですが、ふと我に返ると、そこまでして通信量を減らす利点は何だろうか？と思うことがあります。\n特に思っているように動かなかった時ですね。\njQueryでも、よく使うメソッドは覚えています。\nでも、代用品を使っていて、使いたいメソッドが使えなかった時に、プログラミングの流れが止まってしまいます。\nDOMtasticではdataでハマるし、jBoneはeachでハマりました。\n軽いのは良いと思いますし、ベンチマークで速度が速いのも良いと思います。\n軽めのサンプルを作るくらいなら良いですが、ある程度の規模を見越して作る場合は、普段使っているメソッドがないのは苦痛ではないでしょうか？\n少し使えば慣れるとは思いますが、アレは使える、コレは使えない、という風に気にしながら開発するくらいなら、jQueryでいいじゃないですか。\nねぇ。\n…とは言うものの、使ってみると意外にjBoneは私の最近のプログラミングスタイルには合ってる気がしました。\n配列の操作でforEachはよく使うので、eachよりは良いのかなと思ってみたりもします。\nonclickの代わりに使うサンプル jQueryでよく使っている自分用ライブラリをjBoneでも動くように変えてみました。\ndebug情報が多いですが、まあ、それなりに使えます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 (function($, window, document, undefined){ \u0026#39;use strict\u0026#39;; var console, modules, vars, setVars = function(){ console = window.console; window.modules = modules = window.modules || {}; window.vars = vars = window.vars || {}; }, defined = function(args){ return args !== undefined; }, exec = function(controller, action, $el){ var func = modules[controller][action]; if (defined(func)) { func($el); } else { console.error(\u0026#39;function not defined. arguments:\u0026#39;, arguments); } }, execByElement = function(el, separator){ var sep = defined(separator) ? separator : \u0026#39;:\u0026#39;, $el = $(el), args = $el.data(\u0026#39;run\u0026#39;).split(sep); args.push($el); exec.apply(null, args); }, autoExec = function(el){ execByElement(el); }, clickExec = function(e){ execByElement(e.target); }, onDocumentLoaded = function(e){ console.debug(\u0026#39;onDocumentLoaded e:\u0026#39;, e); $(\u0026#39;.js-click-exec\u0026#39;).on(\u0026#39;click\u0026#39;, clickExec); $(\u0026#39;.js-auto-exec\u0026#39;).forEach(autoExec); $(\u0026#39;.js-vars\u0026#39;).forEach(function(el){ $.extend(vars, $(el).data()); }); console.debug(\u0026#39;vars:\u0026#39;, vars); }, onWindowLoaded = function(e){ console.debug(\u0026#39;onWindowLoaded e:\u0026#39;, e); console.debug(\u0026#39;window.modules:\u0026#39;, window.modules); console.debug(\u0026#39;window.vars:\u0026#39;, window.vars); }, showConsole = function($el){ console.debug(\u0026#39;showConsole $el:\u0026#39;, $el); var args = $el.data(); console.debug(\u0026#39;args:\u0026#39;, args); }, init = function(){ setVars(); modules.main = { thanks: showConsole, fine: showConsole }; $(document).on(\u0026#39;DOMContentLoaded\u0026#39;, onDocumentLoaded); $(window).on(\u0026#39;load\u0026#39;, onWindowLoaded); }; init(); })(window.jBone, window, document); 1 2 3 4 5 6 \u0026lt;button class=\u0026#34;js-click-exec\u0026#34; data-run=\u0026#34;main:fine\u0026#34;\u0026gt;main:fine\u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;js-click-exec\u0026#34; data-run=\u0026#34;main:thanks\u0026#34; data-thanks=\u0026#34;bye\u0026#34;\u0026gt;main:thanks\u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;js-vars\u0026#34; data-hoge=\u0026#34;hoge\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;js-auto-exec\u0026#34; data-run=\u0026#34;main:fine\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;js-vars\u0026#34; data-huge=\u0026#34;huge\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;js-vars\u0026#34; data-hige=\u0026#34;hige\u0026#34; data-hage=\u0026#34;hage\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; 参考になる資料 webpro/DOMtastic kupriyanenko/jbone madrobby/zepto jquery/jquery ","date":"2014-05-31T01:07:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/31/010715/","title":"jQueryでいいじゃないですか"},{"content":"@nqounetです。\ngruntを使っていると、公開用ファイルの生成からアップロードまでを自動化できるので、gzipを使った圧縮ファイルを作成しておくと通信量を減らすことができて地球（場合によってはお財布にも）に優しいでございます。\nngx_http_gzip_static_module 私はVPSにはapacheを入れていないので、こちらの情報はnginx向けになります。\n色々ありますが、決め手はコレですよ。\n1 gzip_static on; yumで入れたnginxは、ちゃんとコレが効くようになっています。（たぶん）\nnginxの方は大したことはないのです。\n問題はgruntの方です。\n細かい設定はよくわかってない 1 npm install -g grunt-contrib-compress 少々長いですが、js,css,htmlのファイルに関しては、この設定で全てgzipで圧縮して同じディレクトリに配置してくれます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 compress: { all: { options: { mode: \u0026#39;gzip\u0026#39;, level: 9 }, files: [{ expand: true, cwd: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, dest: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, src: [\u0026#39;**/*.js\u0026#39;], ext: \u0026#39;.js.gz\u0026#39;, extDot: \u0026#39;last\u0026#39; },{ expand: true, cwd: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, dest: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, src: [\u0026#39;**/*.css\u0026#39;], ext: \u0026#39;.css.gz\u0026#39;, extDot: \u0026#39;last\u0026#39; },{ expand: true, cwd: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, dest: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, src: [\u0026#39;**/*.html\u0026#39;], ext: \u0026#39;.html.gz\u0026#39;, extDot: \u0026#39;last\u0026#39; }] } }, srcとextのあたりはもう少し工夫できればもっと短く書けると思うのですが…。\n今の私にはコレが精一杯。\nで、サーバに送信する時に圧縮してあれば良いので、deploy用のタスクの中に追加しておきました。\n1 2 3 4 5 grunt.registerTask(\u0026#39;deploy\u0026#39;, [ \u0026#39;build\u0026#39;, \u0026#39;compress:all\u0026#39;, \u0026#39;rsync:prod\u0026#39; ]); rsyncについてはこちらにも書いてあるのでよろしければご確認ください。\nYeoman（yo + grunt + bower）を始めてみてわかったこと | IT Office Nishimiyahara 転送量激減 minimizeしたテキストファイルから、さらに3分の1程度のサイズになるので、かなりの効果ですよ。\n効果の大きかったのはやはり大きめのファイルで、通常だと323KBのjsファイル（jQueryと諸々）がuglifyで122KBになって、gzipで40KBになりました。\n開発時に使っているファイルから考えると約8分の1のサイズですよ。\n8回アクセスがあっても、圧縮前の1回と同じ量しか回線を使いません。\nキャッシュも考えると物凄い量の節約です。\n手間もそれほどかかりませんよ。\ngruntさまさまですね。\n参考になる資料 Nginxのhttp_gzip_static_moduleで高速化 | TACTOSH gruntjs/grunt-contrib-compress Module ngx_http_gzip_static_module ","date":"2014-05-29T07:11:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/29/071116/","title":"grunt-contrib-compress（とnginx）でトラフィックを軽くしよう"},{"content":"@nqounetです。\ngrunt bowerInstallはよく使うのですが、今日yeomanを使っていたらこんな表示がでてきました。\n1 npm WARN deprecated grunt-bower-install@1.6.0: use grunt-wiredep instead grunt-bower-installは非推奨だからgrunt-wiredepを使えということなので、早速使ってみましょう。\n新しいもの好きにも程がある コマンドは以下のとおりです。\n1 2 npm uninstall -D grunt-bower-install npm install -D grunt-wiredep grunt-bower-installの代わりにgrunt-wiredepを入れます。\nサンプルページでは、タスクのbowerInstallはそのまま活かすような感じなのですが、Gruntfile.jsをそのままにしてタスクを実行すると怒られます。\n1 Warning: Task \u0026#34;wiredep\u0026#34; failed. Use --force to continue. なので、タスク名はちゃんと変更する必要があります。\n1 2 3 4 5 6 wiredep: { app: { src: [\u0026#39;\u0026lt;%= config.app %\u0026gt;/index.html\u0026#39;], exclude: [] } }, 中身（タスクの設定）はそのままでも動いています。\n…まあ、シンプルな設定だからだとは思いますが。\nいずれはgeneratorが変更になるとは思いますが、しかし、移ろいやすいですね。\nまだしばらくは問題無いとは思いますが、早めの対応に越したことはないですね。\n参考になる資料 grunt-wiredep sample app. stephenplusplus/grunt-wiredep taptapship/wiredep ","date":"2014-05-28T00:25:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/28/002521/","title":"grunt-bower-installの代わりにgrunt-wiredepを使ってみた"},{"content":"@nqounetです。\nまたまたお知らせ系です。\nファイルサイズは小さいですが、既存のライブラリを活かした良い作りのライブラリだと思います。\nbootstrapを使っているなら手軽ですね。\n名前のままですが bootstrapと同じテイストのお知らせライブラリです。\n異色のblackglossが良い味を出しています。\n使い所は難しいと思いますが…。\nしかし、bootstrapはいろいろなコンポーネントがありますが、何故かnotificationはないんですよね。\nまあ、実際のところ、alertやmodalを使えば用は足りるわけですが、さりげない通知手段はないんですよね。\n超多機能CSS and JavaScriptフレームワーク bootstrapもすべての機能を使おうと思うと大変というか、気づかないパターンもあります。\n特に、JavaScriptに至ってはこんな使い方もありか、という使い方もできるのが裏ワザっぽくて良いですね。\n先日発見したのは、closeボタン（というかdata-dismiss=\u0026quot;alert\u0026quot;）についてです。\nてっきりalertにしか効かないと思っていたのですが、親要素を消す能力もあります。（v3.1.1で確認済み）\n例えばこんな感じです。\n1 2 3 4 5 6 \u0026lt;div class=\u0026#34;jumbotron fade in\u0026#34;\u0026gt; \u0026lt;button data-dismiss=\u0026#34;alert\u0026#34;\u0026gt;\u0026amp;times;\u0026lt;/button\u0026gt; \u0026lt;h1\u0026gt;\u0026#39;Allo, \u0026#39;Allo!\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;lead\u0026#34;\u0026gt;Always a pleasure scaffolding your apps.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a class=\u0026#34;btn btn-lg btn-success\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Splendid! \u0026lt;span class=\u0026#34;glyphicon glyphicon-ok\u0026#34;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; data-dismiss=\u0026quot;alert\u0026quot;がついたボタンの親要素のclassにfade inを追加しておきます。\n変なところにxボタンが表示されますが、そのボタンを押すとjumbotronのエリアが消えます。\nソースコードリーディング ソースコードを読んでいると、変な書き方をしているようにも見えるのですが、考えたこともなかった使い方があって勉強になりますね。\n基本的な文法は、本を読むのが良いと思いますが、そこから先はウェブのほうが情報が豊富です。\n最新の情報や、素晴らしいテクニックが惜しげも無く公開されています。\n私の場合は、以前、勉強会のために買った本以外は、全てウェブの情報でまかなっています。\nちなみに買った本というのはこちらです。\nJavaScript本格入門　～モダンスタイルによる基礎からAjax・jQueryまで\nposted with amazlet at 14.05.23\n山田 祥寛 技術評論社 売り上げランキング: 7,518\nAmazon.co.jpで詳細を見る\n改めて読んでみると、なかなか良いことを書いていますね。\nこの当時、JavaScriptを基本からやり直したいと思っていて、でも普通の入門書はチョットね…というような心理状態の時に、たまたま勉強会のテキストで使う、ということで購入して勉強会へ参加しました。\n良い本を紹介してもらったと思います。\n参考になる資料 Twitter Bootstrap Notifications, from Nijiko Yonskai goodybag/bootstrap-notify ","date":"2014-05-24T01:22:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/24/012214/","title":"bootstrapを使っているならTwitter Bootstrap Notificationsも良いね"},{"content":"@nqounetです。\n時間の表示というのは結構面倒な事です。\nmomentは時間を扱うライブラリです。\n昔書いていた、AJAXでチャットのようなスクリプトには、サーバから取得した時間の値（unixtime）を文字列に変換している部分があるのですが、momentがあればその辺を全部任せることができます。\nドキュメントの量がものすごい 時間を扱うのはどの言語でも共通して必要なことだと思います。\nしかし、扱い方は多種多様です。\n年だけにしても、西暦4桁、西暦下2桁、日本の場合はさらに元号で省略なし（平成、昭和）、省略形（平、昭）、アルファベット（H、S）が考えられます。\n最近では、カレンダー形式での入力もできるようになっていたりして便利ですが、扱える物が多すぎるので、それに応じてドキュメントもものすごいことになっています。\nMoment.js | Documentation 正直なところ、これを使いこなすのはかなり大変だと思います。\nよく使うのはunixとformat データとして時間を考えた時、文字列の形で保持しておくと何かと面倒なので、私はわりと数値（unixtime）で持っています。\nそれはそれで問題になることもあるのですが、扱う範囲がある程度限られている場合はかなり有効だと思っています。\nMySQLにはDATETIME型というのがありますが、あまり踏み込んでいません。\n大きく過去（例えば生年月日など）は、日付だけで文字列にしてしまうことが多いです。\nで、momentを使って時間のオブジェクトを作るのはmoment()を使います。\n1 var now = moment(); お手軽ですね。\nPerlとのやりとりの場合は、moment.unix()が便利ですね。\n1 var date = moment.unix(1318781876); nowもdateもmomentオブジェクトになっています。\nで、これを表示するにはformatを使います。\n1 2 now.format(); // =\u0026gt; 2014-05-22T16:53:16+09:00 date.format(\u0026#39;YYYY/MM/DD\u0026#39;); // =\u0026gt; 2011/10/17 まずは、入力のmoment()とmoment.unix()、出力のobj.format()だけ覚えておけば良いのではないかと思います。\n相対表示 momentには相対表示（5分前とか昨日とか）ができるオブジェクトも用意されています。\n1 date.fromNow(); // =\u0026gt; 3 years ago しかし、こちらにはformatが無いようで、あまり自由には表示できません。\n細かく表示したい場合は、結構大変です。\n色々と調べてみましたが、色々と検討はされている（独自実装もある）ようですが、まだ実装はないみたいです。\nこの部分だけを以前実装しましたが、momentを使っている利点が格段に減った気がしました。\n多言語対応もちゃんと出来ているので、日本語で使うのも特に支障はないと思います。\n言語の設定ファイルの文字列を変更するのは簡単なので、必要ならば変更するとよいでしょう。\nAJAXで時間のデータを扱うときには本当に便利だと思います。\nソースコード 1 2 3 4 5 6 7 var now = moment(); console.debug(\u0026#39;now:\u0026#39;, now.format()); var date = moment.unix(1318781876); console.debug(\u0026#39;date:\u0026#39;, date.format(\u0026#39;YYYY/MM/DD\u0026#39;)); console.debug(\u0026#39;fromNow:\u0026#39;, date.fromNow()); 余談ですが ちなみに、この検証用のソースコードを作る環境を作るのに入力したコマンドは\n1 2 3 4 yo webapp bower install -S momentjs grunt bowerInstall grunt serve これでブラウザが立ち上がり、moment.jsが読み込まれているページが表示されます。\napp/scripts/main.jsを編集するとブラウザが更新されて、ウェブツールでみる（Chromeだとコマンド+オプション+iでいける）とコンソールにデバッグ出力されているのが確認できます。\n参考になる資料 Moment.js | Parse, validate, manipulate, and display dates in javascript. ","date":"2014-05-22T17:12:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/22/171213/","title":"JavaScriptで時間を扱うならMoment.js"},{"content":"@nqounetです。\nまたまたお知らせ系のスクリプトです。\nこんなに沢山あるのに、どうして更に作ったりするんでしょうか…、と、思うわけですが、このスクリプトはWeb Notificationsにも対応しているスグレモノです。\nChromeのデスクトップ通知は少し使ったことはありますが、ちゃんとしたフレームワークは初めて知りました。\nエンジニアっぽい サンプルページの作りがあまりデザイナーっぽくない、と思うのは気のせいでしょうか。\nそう思った理由は、飾り気がない、ということと、ほとんどのサンプルコードを読めるようにしていること、です。\nまあ、飾り気がないデザインも難しいとは思うので、アテにはなりません。\nまた、沢山のサンプルがあって、そのコードを見せるというのは、発想がエンジニアっぽいような気がします。\nどうしてそんな気がするのか、と訊かれると困るわけですが。\nページは（ある意味）どうでもいい Demo Eachをクリックするとわかりますが、お知らせが隠れないように、縦方向に足りてない分が横にずれて表示されるのも良いですね。\n実際にこのような感じでお知らせを出すことはないかもしれませんが、同時にお知らせが出て同時に消えると、見えないまま消えてしまうこともあるかもしれませんので、どのような形で隠れる分を見せるか、というのはセンスの問われる部分だと思います。\nちなみに、notyの場合は、一度に表示する個数を決める（デフォルトは5個）事ができて、それ以上にお知らせがあると、1つ消えるごとに1つ表示されるようになっています。\nデスクトップ通知は試してみたいですね。\nユーザーの承認は必要ですが、ウィンドウが隠れていても通知できるのはとても有利だと思います。\nそれなりのコンテンツには有効なライブラリだと思います。\n参考になる資料 PNotify sciactive/pnotify Web Notifications ","date":"2014-05-22T10:43:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/22/104326/","title":"デスクトップ通知も簡単にできるpnotifyがスゴイ"},{"content":"@nqounetです。\nお知らせ系（notification、toaster）のスクリプトは沢山あるのでよりどりみどりなのですが…。\n沢山ありすぎて困ります。\nサンプルページが面白い いちいち実装して確認なんてしてられないので、パッとサンプルを見たいわけですが、このnotifyjsはサンプルページの作りが気に入りました。\nもちろん、機能的にも全く問題ないどころか、エレメントに対して吹き出しのような機能もあって、むしろ多機能です。\nライセンスもMITなので安心です。\ngithubの日付表示が変わった？ それはそれとして。\ngithubのファイルの表示って変わったんですかね？\nずっと相対表示だったと思うのですが、ここ数日は絶対表示になっていて、パッと見で新しいのか古いのかよくわからなくなりました。\n結局は慣れなのかもしれませんが、最近は相対の表示がわかりやすい、と思っていたところなので、ちょっとショックです。\n参考になる資料 Notify.js jpillora/notifyjs ","date":"2014-05-22T00:49:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/22/004934/","title":"サンプルページが秀逸なお知らせ系ライブラリnotifyjs"},{"content":"@nqounetです。\nミニマムなものを探していたら、最軽量級のグリッドCSSを見つけました。\nグリッドシステムの発祥？ シンプルなグリッドCSS。\n記事は三部作になっている。\n日付が2009年になっているので、もう5年も前から考えられていたということか。\nいつだったか忘れましたが、bootstrap（たしか、バージョン1.4くらい？）で初めてこんな感じのグリッドシステムを知ったけど、その基礎になる考え方に触れると、何か感慨深いものがありますね。\n参考になる資料 The 1Kb CSS Grid, Part 1 - The Usability Post The 1Kb CSS Grid, Part 2 - The Usability Post The 1Kb CSS Grid, Part 3 - The Usability Post ","date":"2014-05-22T00:28:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/22/002834/","title":"たったこれだけでcss gridができるの？"},{"content":"@nqounetです。\nサクッと（？）nanobarのサンプルを作ってみました。\nnanobar.js | JavaScript Samples | nqou.net ついでというにはあまりにも あくまでついでに、全てのサンプルページの読み込み状況をそれっぽく表示するようにしました。\n途中、よくわからないエラーで少し悩まされましたが些細な事です。\nあくまでそれっぽく、ですので、実際の状況は把握していません。\nnanobarは100に設定した瞬間ではなく、現在の状態から満タンにアニメーションしてから消えるので、ほぼ0の状態からでもそれっぽく見えます。\nnanobar.jsをまず読み込んで、何かのイベントが発生するごとにプラスしていくだけでもそれっぽく見えるのは、やはりアニメーションで補完されているからでしょうか。\n全体がロードされた（タイミングで言えばwindow.onload）時に100にしているので、完全にロードされるまでは消えない仕様です。\n参考になる資料 jacoborus/nanobar nanobar.js Bower - Search ","date":"2014-05-21T01:51:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/21/015152/","title":"nanobar.jsのサンプルページを作ってみた"},{"content":"@nqounetです。\nプログレスバーって使っていますか？\n私はあまり使っていません。\n嘘だらけのプログレスバー 実際のところ、必ずしも正確とは限りません。\n未来は予知できないのですよ。\nMacOSXのMavericksをインストールした時は、残り1秒の表示で何分待ったか。\nまあ、だとしても、長時間かかる作業の残り予測はある程度は可能です。\nそれを表示するプログレスバーも最近は良いのがありますね。\n今日、使ってみたのですが、とても手軽だったのがnanobarです。\nnanobar.js 上記ページにもサンプルがありますが、使うのはgoというメソッドだけです。\n1から99までの数字を渡すと、それなりの進捗状態にしてくれます。\n潔いのは100を渡すと終了したことになり消えてくれるところです。\n現在の値を知りたいところですが、そういう機能はなさそうです。\nnanobar.go()ではundefinedが帰ってきました…。\n手元で管理しておけ、ということでしょうね。\n参考資料 nanobar.js jacoborus/nanobar ","date":"2014-05-20T23:33:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/20/233341/","title":"最近モバイルでよく見る感じのプログレスバーが超簡単に実装できるnanobar.jsが便利"},{"content":"@nqounetです。\nファイルの重複が気になって仕方なかったのですが、とりあえず諦めることにしました。\nいずれはライブラリで解決できる問題 JavaScriptのサンプル集ページはyeomanをベースに作っているのですが、HTMLファイルを増やした時に、grunt-useminで、同じファイルを何度も最小化・圧縮しているのがとても気になっていました。\nしかし、Gruntfile.jsで重複を避けるような設定を頑張って書くのは不毛だな、という境地に到達しました。\n昔から、この手のツールについてこだわり過ぎるきらいがあって、本筋（今の場合はサンプル集を増やすこと）よりも力を入れてしまうことが多々あります。\nusemin.htmlを作成する方法も考えましたが、管理する範囲が広くなると、管理がずさんになります。\nそして、管理がずさんになったものは、そのうち手が入れられなくなります。手を入れるのが大変になるからです。\nそれらを考えた時、何も特別なことをしない、ということが、重複はあっても結果は同じになるのでよしとすることにしました。\nそう考えた時、サンプル集のページもさっと作ることが出来ました。\nnqounet/web-js-samples at v0.1.0 いずれ、JavaScript（grunt）がわかるようになれば、ライブラリの方で重複ファイルを除外するなど、ファイル関連の強化をしたいと思いますし、同じ問題意識を持っている他の誰がが修正してくれるかもしれません。\n","date":"2014-05-18T23:14:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/18/231436/","title":"諦めが肝心"},{"content":"@nqounetです。\nいろんな人からも言われましたが、久しぶりにPerl入学式へサポート部隊として参加してきました。\nPerl入学式 in大阪 2014 昨年は大阪の方はかなり下火になっていた印象だったのですが、今年の第一回は満員御礼。\n会場が手狭に感じるほどでした。\n熱気もかなり感じました。\n第一回のコンテンツとしては、開発環境構築なのですが、これが本当に厄介です。\n厄介というのは、サポートが必要な人とそうでない人が極端に分かれてしまうことです。\n半数ほどは、MacやLinuxでほぼやることがない状態。\n私は、そちらの方（ほぼ半数の8名）をサポートしていたのですが、皆さんがほぼ自力で資料の力で終わっていました。\n約一名は、gitをインストールしたのにgit cloneがエラーになる、という経験したことがない状態になり、お手上げになっていました…。\nエラーは以下のとおりです。\n1 2 3 4 5 6 7 dyld: lazy symbol binding failed: Symbol not found: ___strlcpy_chk Referenced from: /usr/local/git/bin/git Expected in: /usr/lib/libSystem.B.dylib dyld: Symbol not found: ___strlcpy_chk Referenced from: /usr/local/git/bin/git Expected in: /usr/lib/libSystem.B.dylib 改めて検索してみると、結局はPATHの問題なのかな？\nosx - git + mountain lion + dyld: lazy symbol binding failed: Symbol not found: ___strlcpy_chk - Stack Overflow 今の場合は、gitがいくつか入っていて、でもPATHが通っているgitは新しいほうじゃなく古い方で、libSystem.B.dylibを整合性が取れていない、みたいな？\nOSはMountain Lionだったので、そんなに古いわけでもなくて、どこに問題があるのかその場では全くわかりませんでした。\nひとまず、plenvの導入は諦めて、システムのPerlでHello Worldを体験していただきました。\nなにか持って帰ってほしい 今日は、あまりにも時間が空いてしまって、本当にわざわざ来ていただいた方に申し訳ないという気持ちから、よく考えてみると結構キツ目のことも言ってしまったような気がします。\n資料を読んでほとんど終わってるのに、何故来たの？とか、質問しないのなら来ても意味が無いよ、とか。\nPerl入学式は実際のところ、そんなに大層な内容を扱っているわけではありません。\n私が資料を作った時も、2時間30分でPerlを学ぶ（英語版、日本語版）をとても意識して作りました。\n他言語をやっている方にとっては、Perl本体はそれほど大して難しいことはないと思います。\nモジュールはモジュール自体の使い方もあるので一概には言えませんが、それは別の話です。\n一人で黙々と頑張ってできることがほとんどなので、それができるのであればわざわざ参加する必要はないでしょう。\nそれでも、参加していただけるのであれば、何かしら持って帰ってほしい、と常々考えていて、今日は久しぶりということもあってか、少し熱く語ってしまいました。\nそんな私ですが、次回からもできるだけ参加したいと思います。\n2012年の資料と2013年の資料があれば次回参加からはサポーターとして参加できますよ、本当に。\n2ヶ月もありますからね。\n","date":"2014-05-18T01:42:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/18/014220/","title":"2014年度 #Perl入学式 in大阪 第一回をサポートしてきました"},{"content":"@nqounetです。\n昔作った、jGrowlを作りなおしてみました。\njGrowl | JavaScript Samples | nqou.net Growlと言えば おそらくこの当時は、なんとかGrowlというのが流行っていて、JavaScriptだからjGrowlという感じだったんじゃないかと思います。\nGrowlは、Macのアプリで、お知らせをピコーンと出してくれるヤツです。\n最近ではOSの標準機能としても似たような機能があるので、Growl自体はあまり使われていない気がします。\n時代の流れは速いですね。\nstanlemon/jGrowl この手のライブラリは、toasterとかnotificationで検索すると出てきますが、仕事でも使ったこともある「noty」というのはかなり性能が良いと思います。\nnoty - a jQuery Notification Plugin needim/noty bootstrapテイストなモノも結構ありました。\n沢山選択肢があると、どういう基準で選ぶのかにセンスが問われますね。\nGrapnelというrouterを使ってみた 今回は、ボタンからスクリプトを呼び出すために、ライブラリを使ってみました。\n前回はいろいろ考えて自力で実装したのです（それはそれで気に入っています）が、世間ではどんな手法があるのかは常に調査しておくべきでしょう。\nということで、microjsで調べた中からGrapnelというライブラリを選んで使用しました。\n使い方もそれほど難しくはありません。\n基本的には、URLのhashを読み取って、そこから予め登録しておいたオブジェクトを呼び出してくれる使い方が簡単だと思います。\ngithubには、getを使う方法が先に書いてあるのですが、個人的にはこっちの書き方（オブジェクトをlistenする方法）が好きです。\n1 2 3 4 5 6 7 var router = { hello: function(req){ console.debug(\u0026#39;req:\u0026#39;, req); alert(\u0026#39;Hello Grapnel!\u0026#39;); } }; Grapnel.listen(router); 1 \u0026lt;a href=\u0026#34;#hello\u0026#34;\u0026gt;Hello Grapnel!\u0026lt;/a\u0026gt; 注意が必要なのは、hashchangeのイベントを見ているのか、同じリンク（URLのhash）を何度押しても最初しか動作しません。\n変化してないからですね。\nなので、二種類以上のリンクを作成するか、強制的にhashを戻すか、いずれかの手段が必要です。\nまあ、こういう使い方がイレギュラーかもしれませんが、POSTした後のリダイレクトと思えば、それほどでもないかなぁと思います。\n","date":"2014-05-16T23:14:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/16/231431/","title":"jGrowlのサンプルページを作ってみた"},{"content":"@nqounetです。\nJavaScriptを色々と検索するようになって、検索に便利なサイトを知ったので忘れないようにメモります。\n軽量フレームワーク検索サイト Microjs: Fantastic Micro-Frameworks and Micro-Libraries for Fun and Profit! gz転送もありで5KBくらいまでの軽量フレームワークを用途別に検索できるウェブサイトです。\n軽量だけあって機能が絞りこまれているので、欲しい機能だけを追加で使いたい時に使える。\ngithubの星の数やフォーク（独自実装用にコピーしたり、欲しい機能のリクエストをしたりするための機能）された数、ツイート数などの表示も参考になる。\n実装が色々とありそうなcookieのライブラリや、それと同じインターフェイスで使えるローカルストレージのライブラリもあったり、小さくても侮れないライブラリがたくさんあります。\n同じ機能ならサイズが小さいほうが良い、という割り切りで使うのも良いですよ。\n大体はbowerと連携しているのが多いけど、時々うまくいかないものもある。\nbower searchと合わせて使うのも便利。\n","date":"2014-05-16T22:47:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/16/224752/","title":"小さくても秀逸なライブラリが沢山発見できるMicrojsにはとてもお世話になっています"},{"content":"@nqounetです。\n何度も言いますが、bowerは良いですよ。\nPerlでいうところのCPANみたいなサイトはないですが、今の時代githubがその辺りを兼ねています。\nしかも、モジュール（ライブラリ）の検索には便利なサービスがあります。\nbowerいいわぁ Bower - Search bowerでインストールできるライブラリを検索できるウェブサイトです。\n絞り込みが高速で検索が気持ち良い。\nStars（人気度）とUpdated（更新日時）も見えるので、似たようなライブラリがあった時に指標にしても良いですね。\n","date":"2014-05-16T22:42:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/16/224249/","title":"Bowerはウェブでの検索も簡単で格好良くて速い"},{"content":"@nqounetです。\n時代についていけてない事を実感するサイトがありました。\nParallax iOS7でも導入された、視差を利用した立体感を表現する手法です。たぶん。\nparallax.js これがライブラリになっているようなのですが、なんというか、ウェブが今後どう進化していくのか、楽しみであると同時に怖いような気がします。\n","date":"2014-05-16T07:16:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/16/071628/","title":"機能もスゴイけど見た目が凄すぎるparallax.jsのページに度肝を抜かれた"},{"content":"@nqounetです。\nソーシャルブックマークみたいな、オンラインでブックマークできるサイトをいくつか使っているけど、なんだかんだと埋もれてしまう。\n記憶にあるのに出てこない、という思いがもう嫌なので、これからはブログにメモっておくことにしようかなと。\nこれで探して見つからなければ諦めるしかない。\nCSSのフレームワーク検索サイト CSSのフレームワーク、しかも、大体レスポンシブかモバイルファーストのフレームワークから、目的にあったものをいくつかの条件で絞り込みができる。\nYour perfect framework is just a click away | Plenty of Frameworks bootstrapばかりもアレかなと思って、いろいろと試してみている。\n定番のjQueryMobileについて モバイル系のサイトだと、なんとなくリストビューで作ってみたりしている。\njQueryMobileを使うと、そのへんはすごく簡単なんだけど、DOMの状態が複雑になるので、想定と違うことをしようとするとうまく収めるのが大変だったりする。\nまた、かなりガッツリ系のフレームワークなので、ファイルサイズも大きいし、必然的にjQueryとセットになるので、小さなアプリやサイトには重い感じ。\n軽くて良い感じのCSSフレームワークが欲しいですね。\n","date":"2014-05-16T02:01:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/16/020143/","title":"CSSフレームワーク検索の決定版！ Plenty of Frameworks"},{"content":"@nqounetです。\nJavaScriptのサンプル集の続きを作ろうとして、唸ってしまった。\nページを増やすのが面倒 そもそもwebappなので、サンプル集という使い方には合っていない、という話なのですが、色々なパターンを作るのがいちいち面倒です。\nindex.htmlはbootstrap（bower情報あり）だけ、blackbirdはbower情報がないので手書きで、jgrowl（今回はこれを作ろうとしていた）はbower情報はjsのみで、cssは手書きする必要がありました。\nなんだか、一気に面倒な感じになってきました。\nこの前閃いた、usemin.htmlを使う的なアイディアも、実際のところ、わざわざusemin用にHTMLファイルを作らなければいけないのがイケてません。\nもともとgrunt-useminって、そういう手間を省くためのものじゃないんですか？\ngrunt-useminは、HTMLファイルにコメントとしてファイルの構成を指定できるのがとてもイケています。\nわざわざタスクを追加しなくても、bower installとgrunt bowerInstallとのコンボでvendor.jsにまとめてくれるのが良い所ですよ。\nそれを、組み合わせを考えて別のファイルにわざわざ書くなんて…。\n…ありえない。\n基本的には自分で登録するもの？ タスクを自分で書いて使うのであれば、gruntよりはgulpの方がつぶしが利きそうな気がする（実際に書いてみるとあんまり迷わない）んですが、yeomanのgulp-webappはもう一歩な感じがします。\n秘伝のタレ的な、半年ほどでも継ぎ足しながら使えば良いのかもしれませんが…。\n限られた範囲の使い方だと、簡単でとても便利なのですが、一歩外にでるのはとてもハードルが高い。\nで、webappはその範囲でできることが結構あるので今までは不便さよりも便利さが勝っていたのですが、ページアプリではなくサイトを作ろうとして、突然高い壁に阻まれてしまった気がします。\n","date":"2014-05-15T08:01:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/15/080107/","title":"yeoman（webapp限定）はページ（HTMLファイル）を追加するのが面倒だよ"},{"content":"@nqounetです。\njQueryMobile（バージョン1.3.2）を使っている時は、iframeは使わないほうが良いです。\n余程の事情がなければ使わないと思いますけれども。\nお察しください iframeを使ってコンテンツ（記事）を読み込んでいたところ、読み込んだ時にその部分にジャンプしていきました。\n15記事ほどあった時には、読み込まれるたびにスクロールが発生し、しばらく操作していられないような状況になっていました。\nページ遷移と、ページ表示後の処理をloadイベントでハンドリングしていたので、おそらくそのどれかが原因だろうと探っていたのですが、絞り込んでいった結果、なんとjQueryMobileが犯人でした。\nDOMContentLoadedイベント（jQueryでいうと大体document.ready状態）が発生すると$.mobile.changePage()にあるtransitionPagesが呼び出されていました。\nそのせいで、iframeがロードされると、勝手にスクロールしていくのでした。\n最初から作っていたのなら… 既存のコンテンツをjQueryMobileへ移植するのは、元のコンテンツ（アプリとかですが）の状態にもよりますが、結構難しいですね。\n今回のようにiframeでのハマりポイントもありますし、せっかくの利点であるAJAXやpushStateを活かすのが難しい。\n誰かが言っていました。（直接聞いたわけではありません）\n新しい酒は新しい革袋に盛れ、と。\n今どきの新しいフロントエンド（スマートフォン向けとか）のフレームワークを使うのであれば、それに応じたバックエンドを用意したほうが良さそうですね。\n実践 jQuery Mobile Maximiliano Firtman オライリージャパン 売り上げランキング: 568,924 Amazon.co.jpで詳細を見る\njQuery Mobile Jon Reid オライリージャパン 売り上げランキング: 392,875 Amazon.co.jpで詳細を見る\n","date":"2014-05-14T23:14:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/14/231436/","title":"jQueryMobileはiframeと相性が悪い"},{"content":"@nqounetです。\n表面上は変わっていませんが、バージョンアップさせました。\n衝撃のusemin jsファイルの重複生成が気になっていたのでブログを書いている最中に閃いたusemin.htmlを作成する方法に基づいて書き直しました。\nその時に、index.htmlとsnow.htmlで違うjsファイルを生成していることに気づきました。自分でも何故だかわかりません。\nまた、rsyncのほうでは、usemin.htmlとサンプル集のディレクトリを除外して、転送したり削除したりしないようにもしました。\n転送を確認するためのdryRun設定も、本番環境と同じになるように設定しました。\ndryRunで確認していなければ、サンプル集をうっかり削除するところでした。\nサンプル集も同一リポジトリで管理すれば良いのですが、これはこれで完結しているのだと思います。\nサブディレクトリが増えてきたら、また考えればよいでしょう。\n差分（変更した部分）はこちらです。\nuseminに関する設定を追加(master) · 569f415 · nqounet/web-nqou_net ","date":"2014-05-12T07:46:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/12/074604/","title":"nqou.netをバージョンアップ"},{"content":"@nqounetです。\nyeomanは便利で良いのですが、JavaScriptがよくわかってないので、ちょっとしたところで躓いてしまいます。\nyeoman yeomanというシステムの中でも、yo webappはひな形としてかなり優秀だと思います。\nbootstrap、sass、modernizrをオプションで選択できますし、どれを選んでも（または選ばなくても）それなりのタスク（便利なコマンド集と言っても良い）があって便利です。\ngruntで公開用のファイルを作成するbuildのタスクがありますが、その中に、ファイルの結合（concat）と最小化（uglifyjs, cssmin）があります。\nyo webappで作成したプロジェクトには、これらの設定をHTMLファイルから生成してくれる、grunt-useminというプラグインが入っています。\nHTMLファイルにHTMLのコメントとして設定を書くことができるので、Gruntfile.jsがわからなくても良しなに処理してくれます。\nただ、ファイルが1つ（index.html）だけの場合は全く問題ないのですが、HTMLファイル数を増やすと同じファイルを何度も最小化しようとしてしまうんです。\n出来上がりは一緒なのですが、作っては捨て、作っては捨て、というのを見るのはちょっと耐えられません。\n2回位ならまだ良いですが、10回にもなるとさすがにちょっと考えます。\nbuildする度に、余計な作業を10倍しているわけです。\nその部分をうまくやれば10倍の高速化が期待できるのに…と思います。\nこういう部分を見ると、思想が大雑把というか雑な感じに見えてきます。\n節約する部分の違い node.jsが今どきだな、と思うのは、メモリとかストレージの容量に関しては気にしていない、というところです。\nグローバルへのインストールがオプション、というのも、それぞれのプロジェクト単位でライブラリを持っていたほうが、他のプロジェクトの影響を受けなくてすむので安全だからです。\n昔からよくある不具合として、ライブラリをアップデートしたら今まで動いていたものが動かなくなる、というようなものです。\nPerlでもCartonでパッケージを管理できるようになりましたが、それは最近の話です。\nperlbrewやplenvなどで、ユーザー領域にPerlをコンパイルしてインストールするようになったのも、まあ最近の話です。\nメモリやストレージが潤沢にあるからこそ、他のプロジェクトの影響を受けないような環境作りにシフトすることができるようになってきたわけですよ。\nしかし、その潤沢に使える感覚が、プログラムにも影響を与えているんじゃないかなと思います。\n同じファイルを何度も最小化するのは無駄という感覚が欠如しているんじゃないかと思うのです。\n重複を省くのは難しいですか？ 重複を処理する処理はそんなに難しいものではないはずです。\n配列を扱うライブラリには大体uniqという感じのライブラリがあると思います。\nウェブサイトの作りを考えてみれば、同じファイルは1回だけ処理すれば良い、というのはすぐに思いつきそうです。\nもし仮に同じファイル名で違うファイルを生成してしまうというのなら、それは設定ミスでしょう。\nそう考えれば、出力先が同じ場合は処理を飛ばす、というのはすぐ思いつくと思うのですが、どうしてまだないのでしょうね？\n公式のドキュメントによると、optionのflowという項目にpostということで後処理が書けるようです。\nhttps://github.com/yeoman/grunt-usemin/tree/v2.1.1#flow 試行錯誤の結果、cssはうまくいきましたが、jsの方は私には無理でした。\n抜粋するとこんな感じです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 useminPrepare: { options: { dest: \u0026#39;\u0026lt;%= config.dist %\u0026gt;\u0026#39;, flow: { steps: { js: [\u0026#39;concat\u0026#39;, \u0026#39;uglifyjs\u0026#39;], css: [\u0026#39;concat\u0026#39;, \u0026#39;cssmin\u0026#39;] }, post: { css: [{ name: \u0026#39;concat\u0026#39;, createConfig: function(context, block){ var generated = context.options.generated; var obj = {}; var uniq = generated.files.filter(function(x){ var flag = obj[x.dest]; obj[x.dest] = true; return !flag; }); generated.files = uniq; } },{ name: \u0026#39;cssmin\u0026#39;, createConfig: function(context, block){ var generated = context.options.generated; var obj = {}; var uniq = generated.files.filter(function(x){ var flag = obj[x.dest]; obj[x.dest] = true; return !flag; }); generated.files = uniq; } }] } } }, html: \u0026#39;\u0026lt;%= config.app %\u0026gt;/*.html\u0026#39; }, なんだかムムムって感じです。\nここまで書かないと無理なものなんですかね…。\n普通に考えると、concatを絞り込むだけで良さそうなのですが、concatの結果は無関係のようです。\nこれらは別々に書く必要がありました。\nなんというか、node.jsの奥底にある思想が私にはまだ理解できてないようです。\n今更ですが良いことを思いつきました これだけ苦労した後ですが。\nここまで考えるくらいなら、grunt-useminに渡すためのHTMLファイルを用意したほうが簡単のような気がします。\n…実際に試してみたところ、うまくいきました。\nあまりの簡単さに拍子抜けしてしまいました。\nこんな手があったなんて…。\nGruntfile.jsを一部修正します。元々はindex.htmlになっている部分です。\n1 html: \u0026#39;\u0026lt;%= config.app %\u0026gt;/usemin.html\u0026#39; そして、usemin.htmlというファイルを用意し、各htmlファイルから該当部分をコピペしたあと重複部分を削除しておくだけです。\ngrunt serve:distで確認したところ、うまく動いているので、おそらくは問題ないだろうと思います。\nあとで、個人サイトの方も変更しておこうと思います。\n","date":"2014-05-12T00:13:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/12/001305/","title":"grunt-useminでファイルの重複処理が気になる年頃"},{"content":"@nqounetです。\n以前書いていた便利なライブラリ紹介（というか、試してみた系）を復刻させていこうと思います。\n手始めに、Blackbird.jsという、ログを画面上に出力するライブラリを使ってみたサンプルを書き直しました。\n開発は終了している？ このライブラリは2008年物で、当時は結構便利だったと思います。\n2014年の今では、主要なブラウザには開発用のツールが付属していて、console.debug('デバッグ情報');という感じで書いていけば開発ツールのコンソールに情報が出力される機能がついていますので、デバッグ目的では使う必要はないでしょう。\nただ、常に開発用のツールが付いているとは限らないのでまだまだ使い所はあると思うのですが、公式サイトは閉鎖（ドメイン期限切れ？）され、開発元だったgooglecodeも止まったままです。\nblackbirdjs - JavaScript logging utility - Google Project Hosting githubにリポジトリがあったのですが、勝手に（？）置いているもののようです。ライセンス的には問題なさそうですが。\npockata/blackbird-js モバイル用のアプリを実機で（特に古めのデバイスで）動きを確認している時に、値を確認したい事があるんですよね。\nそういう時はpreタグを書いてそこに出力するんですが、書いたり消したりが結構手間がかかるので、こんなライブラリがあるとやっぱり便利です。\nサンプルページ Blackbird.js | JavaScript Samples | nqou.net ","date":"2014-05-04T05:02:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/05/04/050202/","title":"【復刻版】Blackbird.jsを使ってみた"},{"content":"@nqounetです。\nタイトルのとおり、grunt serve:distで確認できる公開用のサイトで、デバッグ情報を出力しないようにするのに良い組み合わせがありました。\nインストール インストールするのは以下の2つです。\nbowerとnpmでインストールします。\nbowerInstallが使える場合はついでにやっておきましょう。使えない場合は手動でloglevelを追加する必要があります。\n1 2 3 bower install -S loglevel npm install -D grunt-remove-logging grunt bowerInstall loglevel loglevelはconsole.debug('foo')とか書いているものをlog.debug('foo')と書くことができます。\nそして、log.setLevel('debug')というふうに、ログの出力するレベルを簡単に切り替えられるようになります。\nデバッグなどでログを出力する時によく使う手法なのですが、これまでは自作のスクリプトを使っていました。\nライブラリがあればこちらを使うのが便利そうです。\ngrunt-remove-logging デバッグ情報はリリース版には不要なので、リリース時には削除しておきたいですよね。\n通常の場合は、そこでlog.setLevel('info');とかにするわけですが、デバッグ出力の命令文自体を削除できるのであれば、そうするほうが良いに決まっています。\n設定は今回の場合はこんな感じでタスクを追加すればいけます。\n1 2 3 4 5 6 7 8 9 removelogging: { options: { namespace: [\u0026#39;log\u0026#39;], methods: [\u0026#39;setLevel\u0026#39;, \u0026#39;trace\u0026#39;, \u0026#39;debug\u0026#39;] }, dist: { src: \u0026#34;.tmp/concat/scripts/*.js\u0026#34; } }, namespaceとmethodsの組み合わせで削除しているようなので、消そうと思えばなんでも消せそうですね。消しませんが。\n実行するタイミングはuglifyの直前あたりが良さそうです。今のbuildタスクはこんな感じです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 grunt.registerTask(\u0026#39;build\u0026#39;, [ \u0026#39;clean:dist\u0026#39;, \u0026#39;useminPrepare\u0026#39;, \u0026#39;concurrent:dist\u0026#39;, \u0026#39;autoprefixer\u0026#39;, \u0026#39;concat\u0026#39;, \u0026#39;cssmin\u0026#39;, \u0026#39;removelogging\u0026#39;, \u0026#39;uglify\u0026#39;, \u0026#39;copy:dist\u0026#39;, \u0026#39;replace\u0026#39;, \u0026#39;modernizr\u0026#39;, \u0026#39;rev\u0026#39;, \u0026#39;usemin\u0026#39;, \u0026#39;htmlmin\u0026#39; ]); uglifyの後だと、スクリプトの書き方によってはnamespaceが変わっている場合があったり、削除されることで文法エラーが発生する場合（何故かセミコロンがカンマに変わっていたりする）があるので、uglifyよりは先に処理する方が無難だと思います。\n","date":"2014-04-30T02:25:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/30/022534/","title":"buildした時に、不要なデバッグ出力を無くすgruntプラグイン"},{"content":"@nqounetです。\nNode.jsは使っていて驚くことがいくつかあります。\nひとつはモジュールのバージョンアップが早いこと。\nひとつはモジュールが依存するモジュールを独自に持つこと。\nモジュールの更新が早い npmで-gを付けてインストールしたファイル群はnpm update -gでアップデートできますが、その量がとても多いです。\nただ、ザーッと見ていると同じモジュールも何度か見かけるような気がしました。\n依存モジュールを独自に持っている で、ログを見たり、インストールしたディレクトリを見ると、package.jsonに書いてあるモジュール群は、全てそのディレクトリに入っています。\n例えば、gruntの依存モジュールでasync.jsがありますが、grunt-contrib-connectもasync.jsに依存しています。\n手元でその2つのファイルを見てみると、バージョンが異なっています。\ngruntが依存している方は、0.1.22、grunt-contrib-connectが依存している方は、0.2.10でした。\n依存するモジュールをバージョンを固定したまま実行できるように、ローカルにモジュールを保持する仕組みになっているようですね。\n勘違いしていたこと gruntを使っていてあまりにも頻繁に沢山のモジュールをダウンロード、インストールするので嫌だなと思い、衝動的にいろいろなものを-gオプションでインストールした（例えばgrunt-contrib-connectとか）のですが、全く（？）意味がありませんでした。\nグローバルの方にそのモジュールがあっても、結局はローカルに適切なバージョンのモジュールをインストールするので使われません。\nむしろ、npm update -gの時に（使ってもいないのに）無駄にバージョンアップするため、余計なダウンロードが発生していました。\n開発環境をアップデートする yo webappで作成した環境にはpackage.jsonが既に作成されていますが、モジュールのバージョンは更新されているものが多いです。\n例えば、gruntは、指定されているバージョンは0.4.1ですが、アップデートすれば0.4.4が入ります。\nアップデートし、かつ、package.jsonも更新するにはnpm update --save-devで良いのですが、この場合、何故そうなるのか不明ですがgruntはアップデートされないようです。\nそういうのをいちいち気にするのがアレなので、簡単なスクリプトを書いて実行するようにしました。\n1 2 3 4 5 6 7 8 9 10 #!/usr/bin/env perl use utf8; use 5.012; use JSON::XS qw(decode_json); use Path::Tiny qw(path); my $json = decode_json(path(\u0026#39;package.json\u0026#39;)-\u0026gt;slurp); my $modules = join(\u0026#39; \u0026#39;, keys $json-\u0026gt;{devDependencies}); system(qq{npm install -D $modules}); 地味に便利です。\n手元で静的ファイルを更新する考え方 ウェブサイトをgruntで管理していて思うのですが、設定ファイルとコマンドでウェブサイトを更新するという考え方は別に新しいわけじゃないんですよ。\nただ、できることが多種多様になって、かつ、それが簡単なスクリプトを書いて組み合わせられる、というのが良いですね。\nローカル環境で編集したものをウェブに公開する、ということが、簡単にカスタマイズできるのはほんとうに素晴らしいことだと思います。\n","date":"2014-04-29T22:11:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/29/221124/","title":"開発時用のNodeモジュールをPerlでアップデートする"},{"content":"@nqounetです。\nせっかくバージョン管理をしているので、バージョンを表記するようにしました。\n最初はJavaScriptで考えた 最初は何も考えずに、package.jsonの値を使えばいいや、と思っていたのですが、deployには含めていない、ということを思い出しました。\nかと言って、それをコピーするのもなんとなく微妙かなと。\n特にセキュリティ的にも問題はありませんが、無関係なものが多すぎるかなと思います。\nweb-nqou_net/package.json at master · nqounet/web-nqou_net なので、テキストを置き換えるようにしようと思いました。\nreplaceは沢山ある gruntのpluginを探すと、上位に3つのreplace物がありました。\ngrunt-text-replace grunt-replace grunt-string-replace 普通に検索するとgrunt-text-replaceが出てきて、かつ、最近のDL数も多いので定番だろうという理由でgrunt-text-replaceを選びました。\n設定の内容はこんな感じです。\n1 2 3 4 5 6 7 8 9 10 replace: { siteInformation: { src: [\u0026#39;\u0026lt;%= config.dist %\u0026gt;/*.html\u0026#39;], dest: \u0026#39;\u0026lt;%= config.dist %\u0026gt;/\u0026#39;, replacements: [{ from: \u0026#39;\\{\\{pkg.version\\}\\}\u0026#39;, to: \u0026#39;v\u0026lt;%= pkg.version %\u0026gt;\u0026#39; }] } }, gruntのオフィシャルプラグイン（contrib）と比べると設定の項目も洗練されてはいないのですが、ほどほどにわかりやすいです。\nファイルの移動が伴う場合は、cwdも欲しいところですね。\nどのタイミングで置き換えるのか grunt buildを行うと、連結や最小化、キャッシュを回避するための名前変更など、開発している状態とは違う状態になってしまうこともあるので、buildと同時に置き換える場合はタイミングを見計らう必要があります。\nまた、開発状態のファイルを書き換えると、次に書き換えるのが難しくなるので、あくまで開発のファイルを直接操作するのは避けたほうが良いと思います。\ncopy:distの直後あたりが妥当なところだと思います。\nバージョンの情報は、package.jsonのバージョン情報から取得するようにしましたが、残念ながら、releaseと同時にbuildした時は、バージョン情報の更新前の情報になってしまいました。\nリフレッシュする方法があれば良いのですが、よくわからないのでタスクは分けることにしました。\nreleaseしてからbuild+rsyncする感じでうまくいきました。\nweb-nqou_net/Gruntfile.js at master · nqounet/web-nqou_net 何を何に置き換えるのか 置き換える方法としては、テンプレートのようにわかりやすいのが良いと思います。\nなので、HTML側はMustache方式（{{と}}でくくる）にしました。\nスクリプト側は、package.jsonからバージョン情報を取得（configで設定）して、それを使います。\n先程も書きましたが、変数として機能はしないので、releaseと同時にbuildした場合は古いバージョン番号が反映されますので、手順を分けるのが妥当なところでしょう。\nそんな感じで、気がついたらv0.0.4になりました。\nnqou.net ","date":"2014-04-29T04:00:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/29/040029/","title":"grunt-text-replaceを使ってバージョンを表記するようにした"},{"content":"@nqounetです。\n今更感たっぷりのJavaScriptサンプルを書いた（？）ので晒します。\nSnowFall 雪が降っているようなエフェクトのサンプルです。\nページに雪を降らせるサンプル | nqou.net まあ、SnowFallというライブラリを使うだけの簡単なお仕事です。\n書いたのは実質1行（設定だけ）です。\ngrunt-release さて、それとは別の話ですが。\ngruntにはバージョン管理に便利なプラグインもあります。\nそれが、grunt-releaseです。\nnpmやbowerで管理しているJavaScriptのバージョンは、semver(Semantic Versioning)で書かれていることを前提にしています。\nmajorバージョン、minorバージョン、patchバージョンをドットで連結した表現にする感じです。\ngruntのタスクでreleaseを実行する時に、どのバージョンを上げるのかも同時に指定すれば、バージョンを適切に上げた上でコミット、プッシュ、タグ付けなどを自動的に実行してくれます。\n1 grunt release 先日書いた、ウェブサイトをアップロード（というか、同期）してくれるタスクと組み合わせれば、簡単にウェブサイトもバージョン管理が可能です。\nウェブの進化はすごいですね。\n","date":"2014-04-28T03:40:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/28/034022/","title":"ウェブサイトもバージョン管理の時代"},{"content":"@nqounetです。\njQueryは大体いつでも使うライブラリです。\nye webappした時にも、必ず入っています。\nでも、それってCDNを使うほうが何かと楽なのに、と思っていました。\nCDNを簡単に使いたい 今の状態を変えずにCDNを使うようにできないのかなと思って、アレコレ探してみましたが、ニーズがないのかこれといったものが見つかりません。\nrequirejsのpathの仕組みは良いと思うのですが、正宗とか牛刀を使うようなものだと思うんですよね。\nせいぜい考えているのはfailoverとかfallbackとかいうような仕組みだけです。\nで、そんな感じで探していたら面白そうなものがありました。\nFallback.JS jsやcssを遅延ロードする仕組みで、かつ、依存性も記述できるので便利に使えそうです。\nただ、これでもまだ仰々しい感じがします。\n更に探していくと、gruntのプラグインを発見しました。\ngrunt-google-cdn btford/grunt-google-cdn もともと、gruntとは無関係のgoogle-cdnというのがありましたが、それをgruntで使えるようにしたようです。\nインストールはこんな感じです。\n1 npm install -D grunt-google-cdn google-cdn-data で、Gruntfile.jsに以下の設定を追加しました。\n1 2 3 4 5 6 7 8 cdnify: { options: { cdn: require(\u0026#39;google-cdn-data\u0026#39;) }, dist: { html: [\u0026#39;app/*.html\u0026#39;] } }, jquery-1.11.0は含まれていないので効果がありません。\nなので、予めbower.jsonのjqueryのバージョンを2.1.0などにあげておく必要があります。\nバージョン情報を書き換えたら、以下のコマンドで実行します。\n1 grunt cdnify scriptタグのjqueryの部分が置き換わりました。\n…まあ、それはそれで良かったのですが。\n1 grunt bowerInstall 当然ですが上記コマンドでもとに戻ります。\nその辺も回避しようとした場合、jqueryをbowerInstallで書き直されないようにexcludeに追加しておく、などの処理が必要です。\n冷静になってみた 結構苦労して探したので、それなりの満足感はありました。\nしかし得られたものは何だったでしょうか？\n結局のところ、failoverの部分はコピペしてやるほうが良さそうな感じです。\nCDNを使うのは、みんなでキャッシュを共有できてトラフィックが軽減できる、という理由だけでなく、色々なバージョンを手元に用意するのが面倒、という側面もあります。\n後者の面倒な部分が解消される昨今、CDNとfailoverの仕組みの方が面倒であれば、頑張って使う必要はないよなぁと思いました。\nもちろん、トラフィックが軽減できるメリットは有りますが、遅延ロードによってレイアウトが整うまでに時間がかかったりすれば使おうとは思わないでしょう。\nyoで作ったファイル群をbowerとgruntを使って管理していく、という仕組みの中で、あえてCDNを選択をするのは、方向性がズレている気がしました。\nまあ、燃え尽き症候群てやつかもしれません。\nこちらも参考になります CDNを使ったfailover、fallbackについては、こちらが参考になります。\nrequire.jsやyepnope.jsを使う方法などが書いてあります。\nCDNs fail, but your scripts don\u0026rsquo;t have to - fallback from CDN to local jQuery - Scott Hanselman 資料 RequireJS yepnope.js | A Conditional Loader For Your Polyfills! Plugins - Grunt: The JavaScript Task Runner Bower - Search ","date":"2014-04-26T15:19:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/26/151955/","title":"grunt-google-cdnを使ってやると思ってた"},{"content":"@nqounetです。\n昨日はイベント駆動版が手元になかったのでコールバック版でしたが、イベント駆動版も晒します。\nとりあえずイベント駆動版のソース ソースコードはこんな感じです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 (function($, global, undefined){ \u0026#39;use strict\u0026#39;; var lscache, Mustache, processing = {}, generateCacheKey = function(path){ return \u0026#39;fetched:\u0026#39; + path; }, fetchTemplate = function(path){ console.debug(\u0026#39;fetchTemplate\u0026#39;); var key = generateCacheKey(path); $.get(path, function(template){ console.debug(\u0026#39;run $.get\u0026#39;); lscache.set(key, template, 1); delete processing[key]; $(global).triggerHandler(key); // fetch完了イベントを発行 }); }, renderOnEvent = function(e){ console.debug(\u0026#39;renderOnEvent\u0026#39;); var args = Array.prototype.slice.apply(e.data); render.apply(this, args); }, render = function(path, args, cb){ console.debug(\u0026#39;render\u0026#39;); var key = generateCacheKey(path); var template = lscache.get(key); if (template) { return cb(Mustache.render(template, args)); } else { $(global).one(key, arguments, renderOnEvent);// fetch完了時のイベントを受信した時にもう一度実行する if (!processing[key]) { processing[key] = true; fetchTemplate(path);// keyになるfetchをしていない場合はfetchする } } }, setVars = function(){ // localize lscache = global.lscache || console.error(\u0026#39;not ready `lscache.js`. hint : `bower install lscache`.\u0026#39;); Mustache = global.Mustache || console.error(\u0026#39;not ready `mustache.js`. hint : `bower install mustache`.\u0026#39;); }, init = function(){ setVars(); return { \u0026#39;render\u0026#39;: render }; }; global.templates = init(); }(jQuery, this)); 該当部分は日本語でコメントを書いていますが、この書き方が有用なのかについてはイマイチわかりません。\nコールバックの嫌なところ コールバックがあるとものすごく自由なんですよね。\nで、その自由と引き換えに、メソッドの名前に非常に迷うことになります。\n例えばfetchTemplateに対して、取得したテンプレートファイルでレンダリングするコールバックを渡すとrenderTemplateのように動作するわけです。\n実際の仕事は、AJAXでgetするだけなのですが、その後のコールバックでレンダリングさせる、というふうに考えながらプログラミングしていると、名前に違和感を感じてしまうんですよ。\nかと言って、renderTemplateという名前にするのは論外です。\n猛者の方々はこの辺の気持ちをどう始末しているんでしょうか？\nキャッシュがなければAJAXでテンプレートファイルを取得する 使い方としては、テンプレートファイルのURLと、テンプレートに反映させるオブジェクト、そしてコールバックです。\n…結局コールバックは必要でした。\nいや、今回のような場合なら、jQueryオブジェクトを渡せばコールバックがなくてもほどほどに使えますが、なんとなく微妙じゃないですかね？\n1 2 3 4 5 // コールバックの場合 templates.render(\u0026#39;templates/sns.mst\u0026#39;, fbObj, function(content){ $this.append(content) }); // jQueryオブジェクトの場合は、引数の順序はこんな感じ？メソッド名も変えておかないとねぇ templates.renderTo($this, \u0026#39;templates/sns.mst\u0026#39;, fbObj); で、考え始めると、jQueryでメソッドチェーンできるようにすればいいんだよ、という感じになります。\n1 $.templates(\u0026#39;templates/sns.mst\u0026#39;, fbObj).appendTo($this); まあ、書けるかどうかも判断できませんが。\n非同期のメソッドチェーン（＝コールバック？） この辺をうまく書こうとすると、jQuery.Deferredの世界へ足を踏み入れる必要があるんでしょうね。\n「メソッドチェーンに見えて実はコールバック」だったら、非同期を意識しないでプログラミングできると思います。\nというか、何故コールバックが必要かというと、非同期の処理が終わらないと次の処理ができないからです。\n今までのプログラム（同期的プログラミング？）は、基本的には上から下、左から右という風に流れが決まっていました。\nしかし、非同期の場合はそれが保証できないので、保証するための仕組みがコールバック、というふうに理解しています。\nまあ、その部分は同期的に処理される、という事ですね。\nqueueはどう？ jQueryにはqueueというメソッドがあります。\nそのイメージのとおり、jobを順番待ちさせる感じで使えるのですが、サンプルがアニメーションばかりなので、実際の使い所がよくわかりません。\nソースを見てみれば何かわかるのかもしれませんが、読み解ける自信がありません。\nイベント駆動 イベント駆動というと、クリックした時、とか、マウスオーバーした時、のようにユーザーの操作によって動作するイメージですが、それだけではありません。\n例えばコールバックの中に、動作が完了した、というイベントを発行すれば、そのイベントによって続きの動作が可能になります。\nただ、そればかりをやっているとGOTOを使っている気分になります。\n非常に微妙です。\n","date":"2014-04-26T01:11:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/26/011110/","title":"イベント駆動プログラミングはGOTO文を使っている気分になる"},{"content":"@nqounetです。\nJavaScript（というか、ほぼjQuery）にも大分慣れてきた気がしてきた今日このごろですが、皆さまいかがお過ごしでしょうか？\n配列は展開しなくても大丈夫だった やりたいのは、Perlでいう、デリファレンスのようなことなのです。\n1 2 3 4 5 use List::Util qw(sum); my $array = [1, 2, 3, 4, 5]; sub func { print sum(@_); } func(@$array); # ここで$arrayを展開している ありとあらゆる知識を総動員して検索したのですが、こんなことはする必要がなかったようです。\n結論としては、applyを使えばいいです。\napplyを使うと、配列のままでも展開して渡したようにできるという、まるで魔法ですね。\n1 2 3 4 var array = [1, 2, 3, 4, 5]; var func = function(a, b, c, d, e) { alert(a + b + c + d + e); }; func.apply(this, array); // 配列をそのまま渡しても動くという謎仕様 引数のように見えるthisは特に意味は無いようで、ここはnullでも0でもなんでも良いです。\nここからは、何故こういうことをしようとしたのかをツラツラと書いていきます。\nAJAX万歳 AJAXでAPIにアクセスしてデータを取得し、それに基づいてゴニョゴニョする、という処理は頻繁にあると思います。\nこういった非同期な処理を書こうとすると、コールバックばかりになってしまいます。\nコールバックというのは、読み込みが終わったあとの処理のことで、jQueryではAJAXのgetの処理にコールバックも一緒に渡してやると、getしてきたコンテンツを引数にして、コールバックを実行してくれます。\n1 2 3 4 5 // 非同期通信 $.get(url, function(contents){ console.debug(\u0026#39;contents:\u0026#39;, contents); /* ゴニョゴニョ */ }); キャッシュ万歳 それとは別の話ですが、サーバーとの通信は時間がかかるので、AJAXの結果はキャッシュしておいて、必要なときはキャッシュから取得するように作ると思います。\nしかも、読む方からはキャッシュがあるかどうかを気にせずに。\nキャッシュがあった場合は、非同期ではないので、値を直接受け取ることができます。\nなので、できればこういう感じで書きたいなと思うのです。\n1 var contents = getContentsByAjax(url); しかし、残念ながら、キャッシュがなかった場合にもこのような書き方で動作させる方法が全くわかりません。\nそして、間に一つでも非同期の処理が入ると、続けての処理も普通に書くことができなくなります。\nどこかでリセットしたいと思うわけです。\nそこで、イベントオブジェクトを経由して、同期的な処理として書いてみることにしました。\nイベントオブジェクト経由でも同じように実行する 先に書いたとおり、applyを使えば配列を展開する必要がありません。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026#39;use strict\u0026#39;; jQuery(function($, undefined){ var eventHoge = function(e){ var args = Array.prototype.slice.apply(e.data); hoge.apply(this, args); // hogeを呼び出し }, hoge = function(foo, bar){ console.debug(\u0026#39;hoge arguments:\u0026#39;, arguments); }, init = function(foo, bar){ console.debug(\u0026#39;init arguments:\u0026#39;, arguments); hoge(foo, bar); // hogeを呼び出し $(window).one(\u0026#39;hoge\u0026#39;, arguments, eventHoge); $(window).triggerHandler(\u0026#39;hoge\u0026#39;); }; init(\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;); }); こうするとhoge arguments:で出力される値は、initの中から呼び出したものと、eventHogeの中から呼び出したものとがおなじになります。\nargumentsを使いたいからこそ、こんなにややこしいことになっているのですが、それをするだけの価値はあると思っています。\nコールバック方式で書いた一つの例 イベントオブジェクト方式で書いたのが手元にないので、とりあえずコールバック方式のほうを晒しておきます。\nAJAXでテンプレートファイルを取得して、それを使ってゴニョゴニョするスクリプトです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 \u0026#39;use strict\u0026#39;; jQuery(function($, undefined){ var DEBUG = 1, lscache, Mustache, $runButtons, generateKeyFromPath = function(path){ return \u0026#39;fetched:\u0026#39; + path; }, fetchTemplate = function(path, $cb){ var key = generateKeyFromPath(path); $.get(path, function(template){ console.debug(\u0026#39;run $.get\u0026#39;); lscache.set(key, template, 1); return $cb.fire(template); }); }, getTemplate = function(path, $cb){ var key = generateKeyFromPath(path); var template = lscache.get(key); if (template) { return $cb.fire(template); } else { fetchTemplate(path, $cb); } }, render = function(targetId, targetName){ var obj = { id: targetId, name: targetName }; var $cb = $.Callbacks(); $cb.add(function(template){ var rendered = Mustache.render(template, obj); $(\u0026#39;#\u0026#39; + targetId).html(rendered); }); getTemplate(\u0026#39;templates/init.mst\u0026#39;, $cb); }, changeName = function(e){ var $this = $(e.currentTarget); render($this.data(\u0026#39;id\u0026#39;), $this.html()); }, setVars = function(){ lscache = window.lscache; Mustache = window.Mustache; $runButtons = $(\u0026#39;button[data-run=changeName]\u0026#39;); }, initHandlers = function(){ $runButtons.on(\u0026#39;click\u0026#39;, changeName); }, init = function(){ setVars(); initHandlers(); if (DEBUG) { lscache.flush(); } }; init(); }); renderの中がスッキリしない感じです。\njQuery以外に以下のライブラリを使っています。\npamelafox/lscache ローカルストレージにキャッシュを作成してくれる便利なライブラリ janl/mustache.js オブジェクトを渡すだけで使えるテンプレートエンジン 動かしてみたい方はgithubにあげてありますのでお試しください。\nnqounet/try-mustache ","date":"2014-04-25T01:26:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/25/012645/","title":"JavaScriptで、配列を展開してメソッドに渡す方法"},{"content":"@nqounetです。\n昨日、久しぶりにmojo generate lite_appしてから簡単なプログラムを作ったのですが、とんでもないところにはまってしまったので自戒を込めて書き記します。\n書こうと思ったのは、LTSVの形式で書いてあるファイルを読み込み、URLをリンクにして表示する、という単純なもの。\n…だったのですが、すっかりハマってしまいました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use Mojolicious::Lite; use Text::LTSV; get \u0026#39;/\u0026#39; =\u0026gt; sub { my $self = shift; my $p = Text::LTSV-\u0026gt;new; my $datafile = \u0026#39;hoge.ltsv\u0026#39;; my $data = $p-\u0026gt;parse_file($datafile) or die; $self-\u0026gt;stash(data =\u0026gt; $data); $self-\u0026gt;render(\u0026#39;index\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep % for my $line (@{$data}) { \u0026lt;a href=\u0026#34;\u0026lt;%= $line-\u0026gt;{url} %\u0026gt;\u0026#34;\u0026gt;\u0026lt;%= $line-\u0026gt;{url} %\u0026gt;\u0026lt;/a\u0026gt; % } ものはこんな感じだったのですが。\n何がいけなかったのかわかりますか？\n$self-\u0026gt;stash(data =\u0026gt; $data)の部分がダメなところでした。\nMojoliciousでは、dataで渡された場合、それをバイナリのデータとしてレスポンスを返してしまいます。\nなので、$dataがスカラとして出力されていました。\nこの時、私のガチガチに固まった私の頭は、モジュールが返している値が違うんじゃないかと思っていました。\nMojoliciousから離れて、普通に画面に表示するまで、全く気づきませんでした。\ndataは禁物 バイナリデータを直接返すことはあまりないとは思いますが、必要だからあるのでしょう。\nで、このような初歩的なところでハマった言い訳としては、最近、JavaScript(とかjQuery)ばかり使っていたからかな…と思っています。\nJavaScriptをいじっていると好む好まないにかかわらず、やたらとdataという変数が出てきます。\nイベントオブジェクトから引数を取り出すのもdataだし、HTMLから値を渡すのに使う属性もdata-*だし、jQueryのAPIを見ていても、コールバックで受け取る引数がdataになっていたり、とにかくdataだらけでした。\nそれで、深く考えず$datafileという変数を使ってしまったのが運の尽き。\n教訓 安易にdataという変数は使うな。\n名前は重要です。\n","date":"2014-04-09T22:48:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/09/224817/","title":"Mojoliciousでうっかりハマった件"},{"content":"@nqounetです。\n頭の整理をするのにXMindはなかなか良いツールなのですが、書きだした後で再構成したい時にはちょっと不便です。\n少し前、慣れないJavaScriptでプログラミングしていた時にコールバックでわけがわからなくなってきました。\nその時、XMindで頭を整理しようとしたのですが、色々配置を変えたり関連性を変更しようとした時に、思うように移動できなくてイライラしてきました。\nほかに何かないだろうかと思って見つけたうちの一つがLucidchartです。\nFlow Chart Maker \u0026amp; Online Diagram Software | Lucidchart 操作が直感的 この手のツールはフィーリングが大事だと思います。\nこうしたらこうなって欲しい、というような事を自然に要求すると思うんですよ。\nLucidchartは、そういう意味ではかなり直感的に操作出来ます。\n作成画面はこんな感じです。\nまずは左側にあるアイコンをドラッグし、メイン部分にドロップして図形を並べていきます。\n大きめのグリッドが有効になっていて、かつ、既にある図形に対して揃っているかどうかのガイドも出ますので、綺麗好きにはぴったりです。\nもちろん、ずれたまま置いてしまっても配置を変えるのはやはりドラッグ・アンド・ドロップです。\nマウスオーバーすると、マウスカーソルが十字の矢印に変化します。\nこの状態でドラッグ・アンド・ドロップすると、その図形を移動させることができます。\n図形同士の関係性を作る 図形同士の関係性を示すのに矢印で繋いでみたいと思います。繋ぎ方も簡単です。\n図形にマウスオーバーすると、図形の縁に小さな丸印が現れます。\nその丸印をドラッグすると、そのポイントから矢印がスタートします。\nそのまま繋ぎたい図形でドロップすれば、見事に矢印が接続出来ました。\n追加や削除も思いのままです。\n回転もできます 使い道があるかどうかは別にして、回転もできます。\nマウスオーバーすると、図形から少し離れたところにも丸印が現れます。\nその丸印をドラッグすると、図形が回転し始めますので、気に入ったところでドロップします。\n日本語の入力は少しコツがいる テキストの入力は図形をダブルクリックします。\n日本語も入力できますが、一度目は黒い四角になってしまいますので、一度削除してからもう一度入力します。\nそんな感じで簡単に作ってみたのがこちら。\nちょっとしたフローを考えたりする時に使えると思います。\n","date":"2014-04-05T16:21:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/05/162159/","title":"Lucidchartを使ってみたらなかなか良かった件"},{"content":"@nqounetです。\n頭の整理術としてマインドマップがありますが、そのマインドマップを簡単に書けるソフトがあるので簡単に紹介してみます。\nマインドマップとは ざっくりとWikipediaから引用してみましょう。\nマインドマップはトニー・ブザン(Tony Buzan)が提唱した思考・発想法の一つ。頭の中で起こっていることを目に見えるようにした思考ツールのこと。 マインドマップ - Wikipedia\nやり方は色々とあると思いますが、マインドマップを書くというのは「頭のなかにあることを、深く考えながら記録して行くこと」だと思っています。\nXMindは、この記録していく作業に関して特化しているソフトです。\n考えながら入力するのに適していると思っていて、かなり愛用しています。\n以前は私の環境では入力に若干不具合（最初の文字がうまく日本語入力できない）があったのですが、今のバージョンでは快適に入力できるようになっています。\nXMindをインストール XMindはMacだけでなくWindowsにもありますので、どちらも使っているようなバイリンガルな方でもファイルが共有できるので安心です。\n今いちばん注目の マインドマップツール XMind 人気ランキング No.1のマインドマップソフト XMind\nダウンロードページはこちらです → 無料ダウンロード｜ XMind\nインストールしたら早速立ち上げてみましょう。\nXMindでマインドマップを書く このソフトの使い方（書き方）の基本は以下の二点です。\n兄弟要素を追加する場合はEnterキー 子要素を追加する場合はTabキー（InsertキーでもOKっぽい） まず「中心トピック」と書いてある部分に主題を書いておきます。\n「中心トピック」にフォーカスを当てた（選択されている）状態で文字を入力できます。\nフォーカスがあるときは、キーボードから入力すると中身の文字列を上書きします。\nフォーカスがある状態で「F2」を押すと編集できます。\nこの辺は、Excelをイメージすると良いのではないかと思います。\n文字を入力したらEnterで確定できます。\nこの状態で、中心トピックにフォーカスがある状態になっています。\nこの状態からTabキーを押すと中心トピックに関連する「主トピック」が作成できます。\n（中心トピックに関してはEnterを押すと子要素を作成しますが、これは例外と思ってください。）\n主トピックに文字を入力できたら、そこから更に深く掘り下げ（Tabキー）たり、中心トピックに関連することを列挙（Enterキー）したりしていきます。\n細かい配置などはソフトが自動的に考えてくれるので、関係性だけを考慮してどんどん書いていきます。\n書いたモノを眺めていると、違う何かを思いついたりすることもあるのではないかと思います。\n書いたものを再利用する こうして列挙した結果についてはいろいろな形式でエクスポートできます。\n便利なエクスポートに関しては有料版の機能になっていますが、HTMLやテキスト、画像（PNGやJPEG）でのエクスポートは無料版でも可能です。\nまた、印刷は可能なので、印刷を経由してPDFでの出力も可能です。（対応している場合）\nトピックごとにマークなどが簡単に追加・削除できるので、簡易な資料としては十分に使えるクォリティです。\nまとめ マインドマップは、頭にあるものを吐き出すのに丁度良いツールです。\n個人的には、配置のことを考えずに、親子関係、兄弟関係だけに集中して考えて入力していけるのが気に入っています。\n逆に、配置や関係性を自由に編集したい場合はかなり不自由なソフトですのでご注意を。\n（そういった場合は、他のソフトを検討するほうがよいでしょう。）\n","date":"2014-04-03T08:13:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/04/03/081322/","title":"XMindの使い方"},{"content":"@nqounetです。\nyeomanを使い始めてから、色々とgeneratorを試しています。\ngruntも便利ですが、bowerがとても良いですね。\nbowerでファイルの管理が楽になった gitで管理している場合、bowerを使う前はjQueryやBootstrapはgitのリポジトリに入れておくのが普通だと思う。\n今までは実際にそうしていた。\nよく考えて見れば、これは、Perlのモジュールをextlibに入れてgitで管理するようなものだった。\nbowerを使っていると、JavaScriptやCSSのライブラリの管理がそこそこ自動的にできるのがいい。\nどの機構（grunt？）が頑張っているのかわからないけど、index.htmlにライブラリを自動的に追加してくれ（なかったりもするけど）るので、ある程度の省力化もできる。\ngruntでブラウザでの確認が楽になった gruntはなんといっても自動リロードが最高です。\n意外なところでjshintが効いた JavaScriptはあまり意識して書いたことなかったけど、yoで入れるとmain.jsを結構細かく診断してくれる。\nuse strictを付けろ、だとか、文字列はシングルクォートでくくれ、だとか。変数の名前もcamelCaseで書けとか。\n修正して警告が少なくなってくるとアドレナリンが出てくる。\n昔、Another HTML Lintで100点満点にした時のことを思い出した。\nこうやって徐々にJavaScriptマスターになっていくのか。\n悩みどころもある 一番の悩みは対応状況にムラがあること。\nメンテナンスがしっかりしているライブラリは、bowerにもちゃんと対応していてすぐに使えるんだけど、意外なところでjQueryMobileはちゃんと対応できていないみたい。\nやり方がまずかったのかもしれないけど、これに関しては結局CDNで対応することにした。\nまた、同じようにしていてもHTMLに追加してくれたり、くれなかったり。\nこれからは、bowerでちゃんとインストールできる、ということがライブラリを使うときの一つの指標になるかもしれない。\nそれと、bower search（例えばangular）すると似たようなものが沢山でてくるのは困る。\nもちろん、派生のライブラリは出てきて当然だけど、ただ単にライブラリをbowerでインストールできるようにしただけ、という感じのものまで見つかる。\nこの辺はいずれ淘汰されると思いたい。\n","date":"2014-03-25T23:40:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/25/234054/","title":"bowerっていいわぁ"},{"content":"@nqounetです。\nずっと気になっていたYeomanを使ってみました。\nTHE WEB\u0026rsquo;S SCAFFOLDING TOOL FOR MODERN WEBAPPS\n[Yeoman - Modern workflows for modern webapps]\n感想を一言で言うと、何故今まで使わなかったんだ！オレのバカ！！って感じです。\n今まで特に不自由と思っていなかったことが、実は不自由なことだったことに気づきました。\n使いたいと思いながら手を付けなかったのですが、とりあえず個人のサイトでデプロイまでやってみて、色々と楽にできるようになりました。\n昨日までの管理方法 個人のサイトはVPS上にnginxを使って公開しています。\nサーバの設定は、gitで他のバーチャルサーバと共に管理しています。\nウェブのコンテンツは、コンテンツだけでgit管理して、デプロイはcinnamonを使っていました。\nこのうち、ウェブのコンテンツの作成とデプロイの部分をyeoman（というかほぼgrunt）で管理できるようになりました。\n今日からの管理方法 yeoman一式は、node.jsで動作しています。\nだいぶ前にnodeを入れた事はあったのですが、何故かnode自体を管理するのが面倒な思いがあって、その気持ちが一歩踏み出せないところだったかもしれません。\nしかし、今回nodeをインストールするために、ndenvを使ってみることにしました。\nそして、ついでなのでplenvやrbenvもまとめて管理できるanyenvに変更することにしました。\nriywo/anyenv riywo/ndenv tokuhirom/plenv sstephenson/rbenv こういう便利なプログラム（アプリ）を使うと、本当に便利な時代になったなぁと思います。\nあ、Windowsではどうすればいいんでしょうね。\nあまりコマンドプロンプトを使いこなしていないのでアレですが、nodeを入れるにしてもrubyもperlも全てインストーラを使っています。\n記憶が確かならば、vagrantを入れた時にmingwが入ったにも関わらず、rubyをインストールするときに別でmingwが入ってしまうことに非常に嫌な気持ちになります。\nChocolateyを使えばよかったのかもしれませんが、あまり使わないので思い出せませんでした。\nそれは置いておいて、MacOSXでの環境構築は割と簡単でした。\nanyenvのインストールからndenvのインストールまで anyenvをインストールするときは、これまでに*envを使っている場合は、今までの設定を取り除く必要がありますので注意が必要です。\nそれ以外については、githubにあるanyenvのINSTALLに書いてあるとおりです。\nndenvをインストールすると、ndenv-buildも自動的に入れてくれるのでbuild環境も手にはいります。\nインストールできるnodeのバージョンを見るといろいろ出てきますが、Node.jsの日本ユーザグループによると、マイナーバージョンが偶数のものが安定版のようなので、v0.10.xの最新版を入れることにしました。\n1 2 3 4 # インストールできるバージョンを確認する ndenv install -l # 最新の安定版（2014-03-20時点）をインストールする ndenv install v0.10.26 yeomanをインストール ndenvでnodeを入れると、パッケージ管理のnpmもついてくるので、npmを使ってyeoman一式を入れます。\n1 2 3 4 # yeoman一式をインストール npm install -g yo grunt-cli bower # ついでに代表的なジェネレータをインストール npm install -g generator-webapp オプションに-gを付けないと、そのディレクトリ内にnode_modulesができてそちらにインストールされます。\nこの辺の潔さは、今風という感じですね。\nウェブサイト（のひな形）を作る 一式が入ったら、新しいディレクトリを適当に作ってジェネレータを起動します。\n1 2 3 4 # 適当にディレクトリを作ってジェネレータを起動 mkdir /path/to/website cd /path/to/website yo webapp 起動すると、オプションが選べるので、必要なオプションにチェックを入れておくと（若干）最適化されます。\n今回のウェブサイトの場合は、あまり影響がなかったので既存のリポジトリにそのまま突っ込みました。\n基本的にコンテンツはappというディレクトリの中で作成します。編集するのはほぼここだけです。\n作成中はテスト用のサーバを起動させることができます。\n1 2 3 # テスト用サーバを起動 cd /path/to/website grunt serve 個人のサイトはindex.htmlだけなので、ファイルの中身を変更したり、rootにあったファイルをappディレクトリの中に移動したりしました。\n色々と変更する度にブラウザがリロードしてくれるので、特に画面が広い場合は変更後の状態を常に確認しながら作業できるのが便利です。\n詳しい仕組みはわかりませんが、WebSocketか何かでブラウザにリロードするようにしているようです。\n今まで深く考えずに手動でリロードして確認していましたが、その手順がなくなるだけでかなり違うのがようやくわかりました。\nこれは、百聞は一見にしかず、というしかありません。\nこれを読んで想像する状況よりも遥かに良いです。\n公開（デプロイ）まえの一手間 公開するのはappディレクトリをそのまま使っても良いのですが、gruntのコマンドで色々とやってくれるので、そちらも試してみます。\n1 grunt 引数を省略すると、defaultのタスクが実行されます。\nJavaScriptの文法も結構細かく見てくれるようで、なかなかうざいこともあります。\nエラーで進めなかったら、buildだけにするのも手です。\n1 grunt build Gruntfile.jsを見ていて気づいたのですが、公開用の確認も手元で簡単にできるようになっていました。\n1 2 # 公開用のコンテンツを確認するサーバを起動 grunt serve:dist このコマンドだと、buildを実行してから表示してくれるので便利です。（bootstrapを使っていると、フォントが表示されない問題があるようですが、これは、公開ディレクトリにコピーしてくれているフォントファイルのパスが違うからです。分かる人は設定のcopy:distの中を修正すればよいのですが、このへんで躓くとappを公開する感じになるんでしょうね）\n公開の状態が問題なさそうだったら、いよいよデプロイです。\ngruntでrsyncする デプロイツールとしては、静的なウェブサイトでもサーバにsshでアクセスできればcinnamonを使っていました。\nyo webappで作成すると、公開用のディレクトリdistはgitの管理外になります。\n.gitignoreからdistを外してアレコレするような記事があったのですが、それだとプログラムで自動的に変換されたファイルを管理することになるのでイマイチだなと思いました。\nなので、必然的にgitを使わない選択しかできません。\n今回はファイルを転送するだけで完了するのでftpでも良いわけですが、サーバでrsyncが使える場合はこれを使うのが良さそうです。\n検索してみると、ありました。さすがですね。\njedrichards/grunt-rsync Gruntfile.jsに手を入れる必要があるのでゾッとしましたが、細かい部分は日本語の情報もあったので助かりました。\ngruntからrsyncする(syncDestIgnoreExclの話) - シアトルコンサルティング サービス開発ブログ npmでインストールします。簡単ですね。\n1 2 # grunt-rsyncをインストール npm install grunt-rsync --save-dev 情報によると、gruntに対してモジュールを（grunt.loadNpmTasks('grunt-rsync')のように）登録する必要があったようですが、最近はそのへんも自動化されているようで、インストールしたあと設定を書くだけで使えるようになっていました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 rsync: { options: { args: [\u0026#39;--verbose\u0026#39;], exclude: [\u0026#39;.git*\u0026#39;, \u0026#39;*.scss\u0026#39;, \u0026#39;node_modules\u0026#39;], recursive: true }, prod: { options: { src: \u0026#39;\u0026lt;%= config.dist %\u0026gt;/\u0026#39;, dest: \u0026#39;/home/user/www/website\u0026#39;, host: \u0026#39;user@server.com\u0026#39;, syncDestIgnoreExcl: true } } } 余計なオプションもある気がしますが、ひとまずはこんな感じです。\n本番前にはdryRun: trueを付けておくと幸せです。\nsrcは、最後の/が決め手ですね。これがないと、destの配下にディレクトリが作られてしまいます。\nパッケージ管理今昔 npmでインストールするとき、--saveしておくと、package.jsonに情報が登録されます。bowerも同じオプションがあります。\nnpmでインストールするものはpackage.jsonで、bowerでインストールするものはbower.jsonで管理されます。\ngit cloneした時にcarton installするのと同じようにnpm install \u0026amp;\u0026amp; bower installするということですね。\nプロジェクト（アプリ）毎のパッケージ管理方法の進化に目が回ります。\n昔はこの手のものはインストールするのが大変なイメージがありましたが、今やコマンドを入力してトイレに行って戻ってくれば使える状態になってますね。\nGruntfile.jsを管理するのは大変かもしれませんが、ye webappで作られるものは扱いやすいと思います。\n私でも何とかなる程度には親切設計ですよ。\nブラウザの自動リロード機能だけでも十分に使う価値有りです。\n","date":"2014-03-21T17:19:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/21/171931/","title":"Yeoman（yo + grunt + bower）を始めてみてわかったこと"},{"content":"（追記） 最近はこの記事のとおりにしても動作しないようです。新しい記事を書いています。 - [CUIモードで起動するには何をどうすればよいのか](/2017/05/13/172528/) （追記ここまで） おはようございます。 若林（[@nqounet](https://twitter.com/nqounet)）です。 VirtualBoxとVagrantで快適な仮想環境を満喫しています。 普段はVagrantを経由するのであまり関係ないのですが、LiveCD（DVD）から入れたものも時々使うことがあり、その場合に、多少でもメモリの節約になるかなと思って、CUIで起動するようにしたいと思って調べたので書き残しておきます。 …と言っても、改めて書くほどのことはないのでリンクを。\nUbuntu のログインを CUI に変更する｜mattintosh note (跡地) 以下、概要です。\n/etc/default/grub 起動方法を変更する場合は「/etc/default/grub」のGRUB_CMDLINE_LINUX_DEFAULTの項目を変更します。\n1 $ sudo vi /etc/default/grub おそらく「quiet splash」となっているのを「text」に変更する 保存したあとgrubを更新する必要がある\n1 $ sudo update-grub ターミナルを開かなくてもCUIに切り替え Ctrl+Alt+F1、\u0026hellip; Ctrl+Alt+F6を入力するとttyが起動できる。 GUIに戻る場合は「Alt+F7」とする。 こういう風に切り替えができたことに驚きました。 これは、CUIで起動しなくても使える方法です。 時々は便利だと思います。\n","date":"2014-03-19T08:09:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/19/080944/","title":"ubuntuをCUIで起動する"},{"content":"@nqounetです。\n記事が前後しますが、メモを見ていたらアップデートの前にインストールのメモがあったので、そちらも公開します。\nヘタレなのでyumでインストールします。\n1 2 $ sudo yum -y update $ sudo yum -y install zabbix zabbix-agent zabbix-server zabbix-server-mysql zabbix-web zabbix-web-mysql mysqlの設定がなんだかんだと面倒ですが最初だけなので我慢しましょう。\nバージョンによってディレクトリ名が変わるのが微妙な気がしますが、まあ些細な事ですね。\n残骸 昔、インストールした事があったようで途中まで作業していたようで、mysqlにzabbixの残骸がありました。\nあまり考えずに作業していたら、インストールしたあと、SQLが実行できませんでした…。\nあまり動かしていなかった場合や、この際過去のデータは消してもいいという場合は、データベースごと削除してやり直したほうが良さげです。\n残骸その2 mysqlがどうにかなったあと、今度はphp-fpmがエラーを吐くので、yumで追加パッケージを色々入れたりしていましたが、悪さをしていたのは「いつ入れたのか覚えていないPHP」でした。\nphp-fpm.confがそっちのphpを見ていたというオチでした。\nちゃんと管理していないと、いろいろな場所にインストールされてしまうので困ったものです。\nyumでも最新版を入れることができる yumでインストールする場合でも、事前にzabbixの公開リポジトリを登録すると最新版（先ほど確認したらv2.2.2でした）がインストールできます。\n詳しい方法は以下のリンクから。\nhttps://www.zabbix.com/documentation/2.2/manual/installation/install_from_packages\nざっくりした手順としては、CentOS6の場合は\n1 2 3 # rpm -ivh http://repo.zabbix.com/zabbix/2.2/rhel/6/x86_64/zabbix-release-2.2-1.el6.noarch.rpm # yum install zabbix-server-mysql zabbix-web-mysql # yum install zabbix-agent agentだけ入れれば良い場合は、2行目は省略する。\n…はずなのですが、何がいけなかったのか、zabbix-agentだけを入れたつもりなのに、依存パッケージとして結局serverなどが入ったけど気にしない。\nchkconfigでzabbix-serverをoffにしておけば害はないと思います。\n","date":"2014-03-18T01:23:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/18/012318/","title":"zabbixを動かしてみた"},{"content":"@nqounetです。\nちょっと前（日付見たら2月25日だったけど）にzabbixをv2.2.2にアップデートした。\nその時、ちょっとヒヤッとしたので備忘録的に。\nzabbixのupdate 色々開発しているサーバにzabbixを入れているのですが、そのサーバでyum updateした時、たまたまzabbixもアップデートしていました。\nその後なんとなくrebootしたのですが、何故かzabbixのダッシュボード（ウェブページ）にアクセスできなくなってしまいました。\nnginxのログを確認すると、permission deniedになっていたのでおかしいなと思っていたら、/etc/zabbix/webのownerが勝手にapacheになっていた。\n勝手に変えるなよと。\nということで、所有者をnginxに戻しました。\n1 # chown nginx.nginx /etc/zabbix/web これでちゃんと元通りダッシュボードにアクセスできました。\nたまたまrebootしておいたので早く気付けたんじゃないかなと思います。\n","date":"2014-03-16T02:17:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/16/021710/","title":"zabbixをyumでupdateした時に気をつけること"},{"content":"@nqounetです。\n私といえば、nishimiyahara.netがメインだと思われがち（？）ですが、ずいぶんと昔から持っているnqou.netというドメインもあります。\n何故nqou.netなのか、その理由を勿体つけてお話します。\n私の名前は、若林信敬といいます。\n名前のうち、「のぶ」の部分をローマ字にすると「nobu」になります。\nこれを逆立ちして見てみましょう。\n…。\nもうわかりましたね？\nというわけで、nqou.netもリニューアルしました。\n時間があまりなかったので、jQueryMobileでさくっと作りました。\nnqou.net 便利な時代になったものですね。\n","date":"2014-03-14T00:21:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/14/002111/","title":"そういえば、nqou.netもリニューアルしましたよ"},{"content":"@nqounetです。\n前回に引き続き、イベント駆動型プログラミングについて考えながら書いてみました。\n前回は、Mojo::EventEmitterのSYNOPSISから考えてみましたが、イマイチ腑に落ちないというか、しっくりこない感じで消化不良だったので、もう少し違う角度から見てみようと思います。\nフックとしてのイベント RPGというか、具体的にはドラゴンクエストでは、毒を受けた状態だと数歩歩くごとに毒のダメージを受けます。\n歩くというイベントに対して、毒の状態の場合にダメージをうけるようなプログラムを考えてみました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #!/usr/bin/env perl use utf8; use 5.012; use Encode; package Human; use Mojo::Base \u0026#39;Mojo::EventEmitter\u0026#39;; sub walk { my $self = shift; $self-\u0026gt;emit(message =\u0026gt; \u0026#39;歩いている。\u0026#39;); $self-\u0026gt;emit(\u0026#39;walk\u0026#39;); return; } sub get_poison { my $self = shift; $self-\u0026gt;emit(message =\u0026gt; \u0026#39;毒を受けた！\u0026#39;); $self-\u0026gt;on(walk =\u0026gt; sub { $self-\u0026gt;emit(message =\u0026gt; \u0026#34;毒のダメージ！\u0026#34;); }); } sub cure_poison { my $self = shift; $self-\u0026gt;emit(message =\u0026gt; \u0026#39;毒が治った！\u0026#39;); $self-\u0026gt;unsubscribe(\u0026#39;walk\u0026#39;); } package main; my $man = Human-\u0026gt;new; $man-\u0026gt;on(message =\u0026gt; sub { say Encode::encode_utf8($_[1]); }); $man-\u0026gt;walk for 1 ..2; $man-\u0026gt;get_poison; $man-\u0026gt;walk for 1 .. 2; $man-\u0026gt;cure_poison; $man-\u0026gt;walk for 1 .. 2; 多少無理矢理な気もしますが。\n歩く$man-\u0026gt;walkと、walkというイベントが発生し、そのイベントを購読した状態が毒を受けた状態で、購読をしていない状態がステータス異常が特にない、という状態です。\n普通（？）に書くと以下の様な感じかなと思います。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/usr/bin/env perl use utf8; use 5.012; use Encode; package Logger; use Mojo::Base -base; sub log { shift; say Encode::encode_utf8(join \u0026#34;\\n\u0026#34;, @_); } package Human; use Mojo::Base -base; has is_poison =\u0026gt; 0; sub walk { my $self = shift; my @results = (\u0026#39;歩いている。\u0026#39;); if ($self-\u0026gt;is_poison) { push @results, \u0026#39;毒のダメージ！\u0026#39;; } return @results; } sub get_poison { shift-\u0026gt;is_poison(1); return \u0026#39;毒を受けた！\u0026#39;; } sub cure_poison { shift-\u0026gt;is_poison(0); return \u0026#39;毒が治った！\u0026#39;; } package main; my $man = Human-\u0026gt;new; my $logger = Logger-\u0026gt;new; $logger-\u0026gt;log($man-\u0026gt;walk) for 1 .. 2; $logger-\u0026gt;log($man-\u0026gt;get_poison); $logger-\u0026gt;log($man-\u0026gt;walk) for 1 .. 2; $logger-\u0026gt;log($man-\u0026gt;cure_poison); $logger-\u0026gt;log($man-\u0026gt;walk) for 1 .. 2; Humanクラスが毒の状態を持っていて、その状態を歩く都度確認し、毒状態であればダメージ、そうでなければ何もしない、という感じです。\n拡張性を考えれば毒の状態をHumanクラスが持つのはまずいですが、今のところはそこまで考えないことにします。\n当初は、Humanクラスの中でsayしていたのですが、sayが分散するのを防ごうと思った時、歩くというイベント自体よりも、ログの方にEventEmitterの強みを感じました。\n通常、呼び出した先で何か異常が起きた時、それを呼び出し元で対処するのは難しいです。\nEventEmitterを使った場合、Humanクラスのmessageイベントを購読しておくことで、Humanクラス内で発生させたmessageイベントを呼び出し元で簡単に扱うことができます。\nまた、その際、呼び出し元に対してメッセージやオブジェクトを返したりせずに、その場でイベントを発生させれば良いのでプログラムがわかりやすくなったと感じました。\nエラー発生時の処理としてのイベント そこまで考えた時に、try ~ catchのことを思い出しました。\ntryは、致命的なエラーが発生するかもしれないコードを実行するときに、そのエラーをトラップして異常終了しないように使います。\nもしかすると、try ~ catchではなくerrorイベントを購読してエラーをトラップする、というのがイベント駆動型の一つの使い所としてわかりやすいような気がしました。\n","date":"2014-03-12T01:14:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/12/011421/","title":"Mojoliciousでイベント駆動型プログラミングしてみた（その2）"},{"content":"@nqounetです。\n過去記事を整理していたら、懐かしいものに出会いました。\n気になる絵のタイトルは「想紅（おもいくれない）」、書いたのは「SHU」という方で、WebサイトはLittle Bit。\n[インスピレーション | IT Office Nishimiyahara]\nリンク先が引っ越ししていたので、備忘録的に。\n引越し先はこちらです。\nトップページはflashですが、ギャラリーページにはHTMLで書いてあるところもあります。\nリンクで紹介できるのはやはり良いと思います。\nちなみに、こちらの画像です。\n想紅 良いですね。\n","date":"2014-03-08T18:15:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/08/181544/","title":"ファンタジーと絵画"},{"content":"@nqounetです。\n最近、なにかとjQuery(Mobile)を使うことが多くなってきて、イベント駆動型のプログラミングにはなんとなく期待を持っています。\nそこで、Mojoliciousに含まれているイベント駆動型クラスのMojo::EventEmitterを使って何かできないかなと試してみました。\nとりあえずSYNOPSISを試してみます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package Cat; use Mojo::Base \u0026#39;Mojo::EventEmitter\u0026#39;; # Emit events sub poke { my $self = shift; $self-\u0026gt;emit(roar =\u0026gt; 3); } package main; # Subscribe to events my $tiger = Cat-\u0026gt;new; $tiger-\u0026gt;on(roar =\u0026gt; sub { my ($tiger, $times) = @_; say \u0026#39;RAWR!\u0026#39; for 1 .. $times; }); $tiger-\u0026gt;poke; 結果としては、RAWR!と3回鳴く（画面に表示される）わけです。\nしかし、package mainの中でtigerを定義しているあたりで、EventEmitterの醍醐味がよくわからない…。\nなんかモヤモヤする。\nJavaScriptだとどうなの JavaScriptで考えると、例えばボタンにonclickを書いておくと、そのボタンをクリックした時にonclickで定義した関数が実行される。\nJavaScriptで最初に試すのはこんな感じだと思う。\n1 \u0026lt;a href=\u0026#34;#\u0026#34; onclick=\u0026#34;alert(\u0026#39;こんにちは\u0026#39;)\u0026#34;\u0026gt;クリックして！\u0026lt;/a\u0026gt; クリックして！をクリックすると、画面にアラートで「こんにちは」と表示されるプログラムだ。\nGUIだとわかりやすいような気がする。\nイベント駆動の考え方は，ユーザーの操作と実行プログラムを密接に関連付けたもので，マウスとアイコンを組み合わせたGUI（グラフィカル・ユーザー・インタフェース）と相性が良い。これまで手続き型の文化に慣れ親しんできた技術者もイベント駆動型で開発しなければならない場面が増えてきた。\n[「イベント駆動型プログラミング」とは：ITpro]\nユーザーが操作した行動を、イベントとして、そのイベントに対応したプログラムが実行される。\n操作しないイベント駆動 ところで、先ほどのonclickというのは、jQuery風に言い方を変えると、ボタンがクリックされた時にclickイベントが発行される、という感じになる。\nプログラムの立場から考えると、ボタンをクリックした、ではなく、clickイベントが発生した、となる。\n最近のjQueryでは、onという命令で、このイベントを仕掛けることができるようになっている。（昔は、clickという命令で同じことができた）\nたとえばこんな風に。\n1 2 3 $(\u0026#39;#run-button\u0026#39;).on(\u0026#39;click\u0026#39;, function(e){ /* id=\u0026#34;run-button\u0026#34;がクリックされると、プログラムのこの部分が実行される */ }); そして、そのclickイベントはプログラムからも発生させることができる。\njQueryの場合だとtriggerという命令だ。\n1 $(\u0026#39;#run-button\u0026#39;).trigger(\u0026#39;click\u0026#39;); こちらが実行されると、先にonで定義したプログラムが実行される。\nMojo::EventEmitterだとどうなの Mojo::EventEmitterでtriggerに相当するのがemitで、onに相当するのは、jQueryと同じくonだ。\nsynopsisを見てみると、イベントを発生させる\u0026rsquo;\u0026rsquo;emit\u0026rsquo;\u0026lsquo;がCatクラスに入っているのが、JavaScriptと大きく違うところだと思う。\nCatクラスは、メソッドのpokeを実行すると、roarイベントが発生する、というクラス。\nなので、$tigerを定義するときに、pokeを実行する前にroarイベントが発行された時のプログラムを用意している。\n普通のOOPだと、Catクラスを継承したTigerクラスを作っていくところを、直接mainで定義しているのがわかりにくかった気がする。\n普通の（？）OOPだとこんな感じですかね。よくわかりませんが。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package Cat; use Mojo::Base -base; has roar =\u0026gt; \u0026#34;MEOW\u0026#34;; has times =\u0026gt; 2; sub poke { my $self = shift; say $self-\u0026gt;roar for 1 .. $self-\u0026gt;times; } package Tiger; use Mojo::Base \u0026#39;Cat\u0026#39;; has roar =\u0026gt; \u0026#34;RAWR!\u0026#34;; has times =\u0026gt; 3; package main; my $tiger = Tiger-\u0026gt;new; $tiger-\u0026gt;poke; 上を書いてみてから、synopsisと同じようにTigerを定義せずに書くとどうなるのか試してみました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package Cat; use Mojo::Base -base; has roar =\u0026gt; \u0026#34;MEOW\u0026#34;; has times =\u0026gt; 2; sub poke { my $self = shift; say $self-\u0026gt;roar for 1 .. $self-\u0026gt;times; } package main; my $tiger = Cat-\u0026gt;new; $tiger-\u0026gt;roar(\u0026#39;RAWR!\u0026#39;)-\u0026gt;times(3); $tiger-\u0026gt;poke; うーむ。\nTigerを定義してあるほうがしっくりきます。\nSYNOPSISに書いてあるとはいえ、この例だとわかりにくいというか、イベント駆動型プログラミングとしての特徴が活かされていない気がします。\n","date":"2014-03-08T17:09:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/08/170903/","title":"Mojoliciousでイベント駆動型プログラミングをやってみたが…"},{"content":"突然githubに繋がらなくなって泣いたことはないでしょうか？\n私は今日、泣きました。\nいつもと同じようにpushしようとしたら、妙に時間がかかってリポジトリが読めない、と言われてしまった。\n1 2 3 4 5 ssh: connect to host github.com port 22: Bad file number fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists. でも、そんな時でも大丈夫。\n1 ssh -T -p 443 git@ssh.github.com これでgithubが返事をしてくれればちゃんと使える。\n~/.ssh/configに以下の文言を追記して保存。\n1 2 3 Host github.com Hostname ssh.github.com Port 443 その後ちゃんと使えるか確認をしよう。\n1 ssh -T git@github.com 「本当につないでも良いか」と訊かれたらyesと答えること。\ngithubから返事が来たらめでたくpushできるようになる。\nめでたしめでたし。\nUsing SSH over the HTTPS port · GitHub Help ","date":"2014-03-07T16:04:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/07/160411/","title":"22番ポートが繋がらなくてもsshでgithubを使う方法"},{"content":"@nqounetです。\nWindowsは時々羨ましいことがありますね。\n時々ですけど。\nWindows版のChrome（バージョン 33.0.1750.117 m）でデベロッパーツールを使っている時、リロードボタンを長押ししていると、キャッシュをクリアするメニューが表示されるのだ。\nデベロッパーツールを出しているときは大体キャッシュしない設定にしているのですが、それでも時々心配になるのでこの機能は便利です。\n今も試していますが、MacOSXにはこの機能がついてないです。\n羨ましい。\n何故Mac版のChromeには付いてないのでしょうか。\n是非付けて欲しいです。\n","date":"2014-03-06T23:51:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/06/235102/","title":"Chromeでリロード時にキャッシュをクリアする"},{"content":"@nqounetです。\n数年（記事として最も古いのは、2000年なので14年！）分の集大成です。\nとは言っても、今の時点で683件しかないのですが。\n記事のようなものはこのくらいですが、これ以外にもサンプルを稼働させていたりしていました。\nCGIというヤツですね。\nXREAバンザイ 昔からお世話になっていたのは、XREAでした。\nサポートはほぼありませんが、PerlのCGIを動かすにはもってこいの環境でした。\nこの頃からMovableTypeでブログを書きはじめたと思います。\nCORESERVERバンザイ その後、CORESERVERに移っていきます。\nMovableTypeのバージョン4の頃です。\nXREAに置いていたものはそのままにしておいて（確か文字化けの問題があったような）、新しくインストールしました。\nさくらのVPSサイコー そして、さくらのVPSでサーバーごと管理できるようになって、徐々にCGIではなくアプリケーション・サーバーとしてプログラムを起動させるようになりました。\nそんな中でも、CORESERVERは旧コンテンツとだけでなく、実家のホームページもおいてあり、まだまだ現役でした。\nしかし、実家のホームページをWordpressで置き換えようとした時に、インストールが楽なサーバーで運用することにしたところ、気が付くとCORESERVERには旧コンテンツとガラクタしか置いていない状態になってしまいました。\nちなみに、こちらが新しくなった実家のホームページです。\n若林荘のホームページ | 石川県七尾市にある能登島の民宿、若林荘です。 VPSに馴染むまでは、それなりに苦労したのですが、今となっては不思議なもので、逆にサーバーを直接触れないことがむしろ苦労するようになってしまっています。\nとはいえ、既存のコンテンツを移動させるのはなかなか面倒なところもあり、久しぶりに覗いてみました。\ndevel.nqou.net ドメインはCORESERVERには向いていないので、サーバーのディレクトリ構造が丸わかりですが、スクリプトはちゃんと動きます。\nサーバーは今度の週末辺りで期限が来るので、それまでの限定公開です。短い期間ですがお楽しみください。\njQueryのプラグインも、結構面白いものを選んで実験していたんだな、と思います。\nまた、当時書いていた記事は、インポートしてこのシステムの中で生き返りました。\nあ、ちなみにWordpressです。\nVPSでも動かしやすいWordpress 当然、MovableTypeでと思っていたのですが、どうも仕組みが複雑でいけません。\nこのサーバーは、nginxを使っていて、Apacheは動かしていないので、mt.cgiを動かすのに専用のアプリサーバーを作る必要があります。\nバージョン5は以前試しに動かしてみたことはありますが、新しくシステムを導入するには、ある程度の手間もかかります。\n自分自身のためにその手間を割けるほど余裕が有るわけでもないので、もっと敷居の低いWordpressにしました。余裕があれば新しくなったMovableTypeも触ってみたいんですけどね…。DATA APIも面白そうですし。\nともかく、Wordpressであれば妻もある程度触ることができる（何故ならWordpressのサイトをいくつも運営しています）ので、テーマやプラグインの選定、そして固定ページのコンテンツの一部を作ってもらいました。\n本格的に使うにはなかなか大変なソフトだと思いますが、テーマを選んでプラグインを入れてサクッと運用、という用途にはとても便利だと思います。\nまあ、nginxで動かすのは慣れないと難しいかもしれませんが。\n取り留めもなく 偶然にもサーバーを移転するタイミングが来たわけですが、今回は大げさな意味でもなく一つの時代に幕を下ろす感じです。\n今後、CGIという形でPerlを使うことは殆ど無い（もちろん、仕事としてあれば別ですが）でしょう。\nちなみに、アプリとしてPerlのプログラムを起動させるほうが、CGIとして動作するよりも圧倒的に速いです。\nどのくらい速くなるかは、もしかするとMojoliciousでコンテンツを作成して公開するかもしれませんので、その時のお楽しみということで。\n","date":"2014-03-06T08:26:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/06/082635/","title":"各種サーバーをまとめました"},{"content":"@nqounetです。\n半年ほど前に良いよって書いていたVoxですが、改めて使ってみたらやっぱり良かったです。\nこの前，iTunesで再生していたら，心なしかバッテリーの減りが速いとか，CPUの温度がいつもより高いとか，どうでもよいところが気になってしまいました（現実逃避\n[軽くて音も良いという噂のVoxを使ってみたら結構良かった件 | IT Office Nishimiyahara]\nどうでもいいところにこだわってみるのもたまには良いかなと。\nこの2月にアップデートがあったようで、今日の時点でバージョンが2.0.1です。\n久しぶりに使ってみましたが、iTunesとの連携が更に強化された気がします。\nミュージックソースとして、最初からiTunesを選択できるようになっていて、切り替えると走査している感じもなくすぐに使えるようになっていました。\nプレイリストの管理が楽でよいです。\n私がVoxが良いと感じているところをいくつか挙げてみます。\nDockアイコンが素敵 コマンドキー＋タブキーでアプリの切り替えができるのは皆さんご存知だと思いますが、その時にVoxのアイコンが、アルバムのカバーになっているんですね。（まあ、設定で変更できるんですが。）\nアプリの切り替えの度にアイコンが目を楽しませてくれます。\nLast.fmにネイティブに対応 素晴らしいレコメンドをしてくれるLast.fm（個人の感想です）へ、楽曲の再生情報を送信する機能も付いているのが良いですね。\niTunes単体ならばVoxよりもメモリが少ないのですが、「Last.fm Scrobbler」は結構メモリを食うので、トータルするとVoxの方が省メモリです。\nLast.fmは、\bサイトにアクセスする度に聴いてみたいと思わせる曲に出会わせてくれます。\n再生情報を送信すればするほどレコメンドも核心をついてきます。\n超オススメです。\nHome – Last.fm（日本語サイト） ","date":"2014-03-03T23:02:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/03/230213/","title":"Voxがやっぱり良かった件"},{"content":"[@nqounet](https://twitter.com/nqounet)です。\nここのところWordpressばかりいじっているような気がします。 ということで、今日はその関係のネタです。\n今回、ブログを引っ越すに際して、過去記事をインポートしようと思っていました。 bloggerを使っていた前回で、すでに3つに点在していたので、一つに集めようと思いました。 一番古いMT3時代の記事が、出力後のHTMLファイルしかなくて困っていたんですが、それを解決してくれるプラグインがありました。\nHTML Import 2です。\nこれは、HTMLファイルからスクレイピングしてインポートしてくれるので、必要な部分をタグで示してやればうまくインポートしてくれます。 [html-import2](/wp-content/uploads/2014/03/html-import2.png) もともと機械的に出力したものなので、構造がしっかりしていて読み込みが簡単そうでした。 ただ、一番困ったのが時間です。 ファイルの更新時を取得する、という方法が示されていたのですが、さすがにそれは無理でした。 で、なにか情報がないかと思ってソースを眺めていたら、コメントの中に更新時間のメタ情報（`\u0026lt;dc:date\u0026gt;`）があったので、それを使うことにしました。 このプラグインはコメント部分は無視するのか、あるいは無効な文字があるのか スクリプトを書こうかと思ったのですが、1回しか使わないので、エディタを使っていくつか加工してからインポートしました。 加工したのは以下のとおり。 * コメントを外す（開始タグ（`\u0026lt;!\u0026ndash;`）のみを適当に置き換えました） * `\u0026lt;dc:date\u0026gt;`の部分を`\u0026lt;div id=\u0026ldquo;entry-date\u0026rdquo;\u0026gt;`で読めるように置き換え * moreを作るために、`\u0026lt;/div\u0026gt;`から`\u0026lt;div class=\u0026ldquo;entry-more\u0026rdquo;\u0026gt;`までのタグを削除 こうすることで、`\u0026lt;div class=\u0026ldquo;entry-body\u0026rdquo;\u0026gt;`を読み込むだけで綺麗にインポートできるようになりました。\n時間のかかる処理は控えめに インポートした記事数は全部で350弱だったと思いますが、さすがにHTTP越しでやるとブラウザが固まったようになります。 返ってきたと思ったら真っ白な画面だったので、インポートできていないのかと思いましたが、確認するとちゃんと出来ていました。 プラグインがどこまで可能なのかはわかりませんが、こういう処理の見せ方がもう少し丁寧に作りこまれるといいなぁ、と思いました。\n","date":"2014-03-02T23:46:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/02/234654/","title":"「HTML Import 2」は超便利でした"},{"content":"なるほど、そうだったのか。\nなかには頭の回転が速い子供がいる。言葉が達者で、口から先に生まれてきたような子供がいる。その一方で、ぼんやりしていて、何をするにもワンテンポ遅れてしまう子供がいる。けれど、どんな性格をしていようと子供は考えるのが好きだ。まこ先生は、そう言った。どんなにおっとりした子でも、その子なりに「自分で考える」のは楽しいのだ。頭を使うのはよろこびなのだ。\n[その子はなぜ大人の言うことを聞かないのか？ | Rootport]\n頭をつかうのは喜び、だなんて、いい事を言うね。\nしかし、子どもだけじゃなく、大人も頭をつかうことが好きなんだろうな、と思った。\nテレビとかラジオとかを視聴していても、何か考えている。\n見ているのがクイズ番組ならそのクイズに回答するし、見ていても全然別のことを考えていたりもする。\n小中学生の頃は勉強することが嫌だったけど、それは他のことを考えるのに忙しかったから、だったのかなと今は思う。\n授業の最中は、やってるゲームの続きのことを考えたり、そういえば、ゲームブックみたいなものを作ったりもしていた。\nあー、罫線を使ってウィザードリィみたいな3Dのダンジョンを書いていたりもしたなぁ。\n同じことばかりではつまらない いつも何かしら考えているとは思うけど、いつもいつも同じことを考えていると飽きてくるし、行き詰まる。\nでも、そんな時に休憩したり、話をしたり、何か別のことをしたりすると、ふと閃いたりすることがある。\nそんな時って、あまり関係ないんだけど話をしていた人に感謝の気持を持ったりする。\n映画やドラマとかでは、閃きを見せるのによく使われる手法だと思う。\n演出としては高度なものではないと思う（正直安っぽい演出だなと思う）けど、それでもそういうことはよく経験するからこそ理解されやすい。腑に落ちやすいってことだ。\n教える、ということ ここ1,2年は、Perl入学式の講師としてや、非常勤講師としてプログラミングについて話したりする機会があったけど、毎回どうやって伝えるのが良いのか、ということを考えている。\n前に立って喋るからには、やはり何かしら感じ取ってもらいたい。\n資料も結構時間をかけて用意した。\n何度か経験しているからこそ本当に教えるって難しいと思う。\n子供の頃、何度も言われたと思う。\n「大人になったら『学校でちゃんと勉強しておけばよかった』って思うよ」って。\n確かに思っている。\n思っているけど、どうせだったらもっと分かるように言って欲しかったな…とつくづく思う。\n無視して苦労しているのは、その時に言うことを聞かなかった私が悪いのだ。\n甥や姪には、こんなことをちゃんと伝えてくれる人がいるだろうか？\n","date":"2014-03-02T09:01:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/02/090138/","title":"子どもは考えるのが好き"},{"content":"@nqounetです。\n今やっている仕事の関係で、Windows7を使っています。\nインターネットを見るときは、Google Chromeを使っているのですが、テストのためにWindowsの標準ブラウザとして有名なインターネットエクスプローラーを使うこともあります。\n…仕方ないですね。\nその有名なブラウザ、IE11（バージョン：11.0.9600.16518）でパスワードを入力していたら、右の方になにか出てくるではありませんか！\nなんだろうと思ってクリックすると、なんとパスワードが確認できる！（ボタンを押している間だけですが）\nやろうとしていることはわからなくもないんですが、なぜ今更こんな機能を？\nパスワードの管理機能を持つソフトとかならいざ知らず、標準の機能として付けますかね？\nIEというかWindowsがこういうことをやりだすと、入力をマスクするようなフィールドは、今後こういう機能が要求されることになる、ってことですよね。\n","date":"2014-03-01T02:25:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/03/01/022524/","title":"Internet Explorer11は入力したパスワードが見える"},{"content":"「はじょうする」とかは言わなかったんですかね。\n麻生太郎財務相・金融相は28日の閣議後記者会見で、仮想通貨ビットコインの取引所大手「Mt.Gox」（マウント・ゴックス、東京）で取引が停止している問題について「こんなものは長く続かないと思っていた。どこかで破綻（はたん）すると思っていた」と述べた。そのうえで、仮想通貨に対する対応策を関係省庁で検討する考えを示した。\nビットコイン「破綻すると思っていた」 麻生財務金融相：朝日新聞デジタル\n過去のことなら誰でも言えますよ。\nとはいえ、水物には違いないと思います。\n〈ビットコインを使ったビジネス展開の相談にも応じているコンサルタント会社「シンク・イメージ」（東京都港区）の牛田智明社長の話〉 日本での換金をしていたマウント・ゴックスの問題で、ビットコイン自体の問題ではない。もともと日本国内ではビットコイン自体があまり受け入れられていないが、決済手段としては優れている。「ビットコイン自体が危険」との認識が広がらないか心配だ。\n「トラブル予想された」 ビットコイン取引停止、識者は：朝日新聞デジタル\nこの人の場合は、自社のサービスがビットコインと関係あるので真に受けられませんが、通貨自体は危険はないと思います。\n通貨は「信用」で成り立っているものです。\nビットコインにはビットコインなりの「信用」が形成されていますが、その信用が周囲の影響を受けやすいというところが問題にはなるのかもしれません。\n為替取引でも、偉い人の発言で価値が上がったり下がったりしますよね。\nそれは、偉い人の発言が、その国の通貨に対する「信用」に影響を与えている、ということです。\nそもそも国民国家が国家主権の一つとして通貨発行権を握ったのなんてここ2,3百年の歴史しかない。もともと通貨というのは人と人の信頼関係の上に成り立っているわけで、そこに国家の信用保証なんか実は無くたって皆が信用すればそれは成立するのだ。今回ビットコインの交換所が突然閉鎖に追い込まれたりしているのは、国民国家の通貨との交換が停止されただけの話であって、ビットコインそのものは存在しているし、それを信用する人がある一定数いるかぎりビットコインは成立する。\nビットコインが叩かれてるけど、はっきりいってマスコミの人全然理解してないな。。。 | ホリエモンドットコム\n名前には「通貨」が入っていますが、実質的には単なる「ポイント」です。\n今後しばらくは、ビットコインが叩かれて価値が下がると思いますが、いずれまた上がる…かもしれません。\n","date":"2014-02-28T14:13:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/02/28/141358/","title":"ビットコイン「破綻すると思っていた」 麻生財務金融相：朝日新聞デジタル"},{"content":"朝から激しく咳き込んでしまいました。\n咳で涙がでるなんてかなり久しぶりだと思います。\n各自治体は、国の暫定指針に基づき、PM2.5の1日の平均濃度が1立方メートル当たり70マイクロ・グラムを超える可能性がある場合、住民に外出などを控えるよう呼び掛ける注意喚起を出している。 環境省によると、25～27日で、山口、大阪、新潟、福島など延べ12府県が注意喚起を発出。注意喚起を出していない東京都でも27日、清瀬市で1日の平均濃度が67.5マイクロ・グラムに上るなど、全国的に上昇した。\n各地でPM2.5上昇…不要不急の外出控えて : 環境 : YOMIURI ONLINE（読売新聞）\n67.5/70ってギリギリじゃないですか。\nここ2,3日、景色がモヤモヤしている感じはしていましたが、喉で感じるとは思いませんでした。\n…まあ、それがPM2.5のせいかどうかはわかりませんが。\nPM2.5は燻煙剤みたいなもの 結構前になりますが、隣の部屋で燻煙剤を使ったことがありました。\nまあ、割と密閉された部屋なので大丈夫だろう、と、それほど深刻に考えてはいなかったのです。\nしかし、使い始めてからしばらくして、急に喉がイガイガし始めました。\n最初は気のせいかと思いましたが、そうではないことに気づき、窓を開けて換気しました。\nそのことを思い出すような出来事でした。\n思わず空気清浄機の電源を入れました。\n大気汚染物質広域監視システム 政府が大気汚染の監視システムを改善しているようです。\n残念ながら今は動作してないようですが。\n同省は3月中に、各地の濃度をウェブ上で公開する同省の「大気汚染物質広域監視システム」（http://soramame.taiki.go.jp/）を改善し、注意喚起を出している自治体の一覧を表示できるようにする。\n各地でPM2.5上昇…不要不急の外出控えて : 環境 : YOMIURI ONLINE（読売新聞）\n対策はまず監視からですね。\n何か良い対策が発見されることを期待しています。\n","date":"2014-02-28T13:27:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/02/28/132734/","title":"大気汚染を喉で感じました"},{"content":"@nqounetです。\nユーザー認証の新規格「OpenID Connect」をMicrosoftやGoogleがサポートしてくれるようです。\nデベロッパーはこの規格を利用して簡単なコードを書くだけでサインインのプロセスをMicrosoftやGoogleなどのIDプロバイダにアウトソースすることができる。つまり、OpenIDを利用すればデベロッパーは自らのサーバにパスワードを保管する必要がなくなる。\n引用元: サイトにパスワードを保存する必要なし― Microsoft、Google等がユーザー認証の新規格、OpenID Connectをサポート | TechCrunch Japan\n良いニュースではないでしょうか。\nうまく使えば、ユーザーのIDとパスワードを保管するリスクから解放されそうです。\nもちろん、私たちが解放される代わりにIDプロバイダ（OpenID Connectをサポートする企業などのこと）が負担する、という形にはなります。\nMicrosoftやGoogleは自社でサービスを展開していますし、多くの人はそれらのサービスを使っていることが期待できます。\nユーザーにとっても、多くのサービスがパスワードを必要とすると、管理するパスワードが増え、セキュリティのリスクが増えることになります。\n今回の新しい規格は、サービスを提供する側も享受する側もハッピーになれるものだと思います。\n","date":"2014-02-27T14:10:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/02/27/141019/","title":"ユーザー認証の新しい規格が！"},{"content":"@nqounetです。\n実家のホームページに引き続き、私の個人事業主としての顔でもある「IT Office 西宮原」のホームページもリニューアルしました。\nWordPressで。\n若林荘のホームページ | 石川県七尾市にある能登島の民宿、若林荘です。 IT Office Nishimiyahara | 個人用スマホから商用プログラミングまでなんでもお任せ下さい リニューアル後の事件 たまたまですがリニューアルした実家のサイトを確認したら、どうやら昨日がサーバーの更新日だったらしく、403エラーになっていてびっくりしました。\n即更新手続きをしました。\nメールを確認したら、普通に埋もれていました…。\n大事なメールは広告を送るメールとは別のアドレスから送って欲しいですよね。\nこれはあまり言ってはいけないことだとは思いますが、広告だらけのメールって誰が見るでしょうか？\nそんなメールと、更新のお知らせのような大事なメールとを同じメールアドレスから送るのは、とても挑戦的だと思います。\nおそらく立場上、広告メールは迷惑メールに入るから更新のお知らせは別のメールアドレスからが良いです、なんて誰も言えないと思います。\nでも、きっと、あなたもそう思っているはず。\nサーバーの死活監視 で、気づく少し前に、別のところからメールが来ていました。\nサーバーの死活監視の変化を示すメールです。\nレンタルサーバーで運用している4つほどのサイトがダウンしていたのですが、サーバーが同じだったので、まあ、しばらくすれば治るだろうと考えていました。\nお察しの通り、実家のサイトも含まれています。\n少し待っても回復の気配がなく変だなと思っていたら案の定。\nこんなところで死活監視が役に立つというのも、なんだか皮肉な感じです。\n","date":"2014-02-27T07:34:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/02/27/073448/","title":"ホームページをリニューアルしました"},{"content":"@nqounetです．\n昨年の2月に「QRコネクト用QRコードメーカー」なるものを作ったのですが，いつの間にか本家でもQRコードを作成できるサービスが開始していました．\nQRコネクト用QRコード 生成サイト 新大阪コワーキングを閉めてから自分自身でも使うことがなかったので気づきませんでした．\n本家で始まったらさすがに不要なので，今月いっぱいくらいでプログラムを止めることにします．\nまた一つの時代が終わりますね（意味不\nそれはそれとして，実際のところQRコネクトは便利ですよ．\n専用アプリは必要ですが，QRコードを読み取るだけで無線LANの設定ができるんですから．\n無線LAN設定アプリ「QRコネクト」｜無線LAN | IODATA アイ・オー・データ機器 これがあったおかげで，毎日暗号化キーを変更しても苦になりませんでした．\nもっと使えば良いと思います．\n","date":"2014-01-18T23:19:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/01/18/231900/","title":"QRコネクトは本当に便利ですよ"},{"content":"@nqounetです． MojoliciousでJSONを使う時は，renderメソッドにjsonを指定してやると変数をそのままJSONにして渡せるので簡単です．\n1 2 my $args = { a =\u0026gt; [1,2], b =\u0026gt; \u0026#39;c\u0026#39; }; $self-\u0026gt;render(json =\u0026gt; $args); しかし，この時に使用されるMojo::JSONはPurePerlなので，できればXSのモジュール（JSON::XS）を使って高速化したいですよね．\n計測 その前に，Mojo::JSONとJSON::XSではどのくらい速度が違うのかを調べてみます． ついでなので，便利に使えるJSONも一緒に測ってみます． ソースコードは最後に載せていますので適当にお使いください．\n1 2 3 4 5 6 7 8 # Benchmark: running json, mojo, xs for at least 3 CPU seconds... # json: 3.03104 wallclock secs ( 3.02 usr + 0.00 sys = 3.02 CPU) @ 173870.86/s (n=525090) # mojo: 3.19469 wallclock secs ( 3.17 usr + 0.00 sys = 3.17 CPU) @ 14308.83/s (n=45359) # xs: 3.16628 wallclock secs ( 3.15 usr + 0.00 sys = 3.15 CPU) @ 195861.27/s (n=616963) # Rate mojo json xs # mojo 14309/s -- -92% -93% # json 173871/s 1115% -- -11% # xs 195861/s 1269% 13% -- mojoはMojo::JSON，xsはJSON::XS，jsonは，JSONです． JSON::XSの方がMojo::JSONよりも10倍以上速いですね． JSONモジュールは，JSON::XSがあるとこれを使うのですが，若干差がありますね． インスタンスを作るときなどに多少のオーバーヘッドがあるのかもしれません． ちなみに，インスタンスを再利用するとこんな感じの結果になりました．\n1 2 3 4 5 6 7 8 # Benchmark: running json, mojo, xs for at least 3 CPU seconds... # json: 3.18115 wallclock secs ( 3.16 usr + 0.00 sys = 3.16 CPU) @ 285812.66/s (n=903168) # mojo: 3.26202 wallclock secs ( 3.22 usr + 0.00 sys = 3.22 CPU) @ 14538.20/s (n=46813) # xs: 3.19833 wallclock secs ( 3.18 usr + 0.00 sys = 3.18 CPU) @ 309832.39/s (n=985267) # Rate mojo json xs # mojo 14538/s -- -95% -95% # json 285813/s 1866% -- -8% # xs 309832/s 2031% 8% -- …さらに差がつきましたね． ここまで速いのであれば，使える環境なら使いたいですね．\nMojoliciousでJSON::XSを使う MojoliciousでJSON::XSを使う場合は，Mojo::JSON::XSが便利です．\nMojo::JSON::XS - search.cpan.org Mojo::JSONとメソッドの互換性があり，JSON::XSでは使えないtrueやfalseも使えます． 最近は更新がないのでどこまで互換性があるか心配ではありますが，少し使ってみた感じでは問題ありませんでした．\nプラグインを書いた 使い方としては，rendererのadd_handlerでjsonのハンドラを上書きする方法が安全ですが，render以外でもMojo::JSONを利用している部分があるので，大胆にMojo::JSON::newを（再）定義してやります． 使う時はいつもと同じようにpluginメソッドで呼び出すだけです．\n1 2 3 4 5 # Mojolicious::Lite plugin \u0026#39;JSON_XS\u0026#39;; # Mojolicious $app-\u0026gt;plugin(\u0026#39;JSON_XS\u0026#39;); 正直なところ，JSON部分だけが速くなってもあまり効果はない気がします． ただし，とてつもなく大きなJSONをやりとりする機会があるなら使えると思います． ハンドラーを書き換える方法はこちらをどうぞ．\nJSONの描画にJSON::XSを利用する方法 / Mojoliciousリファレンス - サンプルコードによるPerl入門 余談 こんなことを考えたのは，この記事がきっかけでした．\nPerl - Mojolicious＋jQueryで、getJSONでハマった - Qiita [キータ] JSON::XSを使いたい気持ちはわかるので．\nベンチマークのソース ということで，忘れかけていたベンチマークのソースです．\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/usr/bin/env perl use utf8; use v5.12; use App::Benchmark; use Mojo::JSON; use JSON::XS; use JSON; my $args = { hoge =\u0026gt; \u0026#39;hoge\u0026#39;, geho =\u0026gt; { geho =\u0026gt; \u0026#39;gehoge\u0026#39;, hoge =\u0026gt; 1, hum =\u0026gt; [ 1, undef, \u0026#39;hoge\u0026#39; ] }, foo =\u0026gt; [ \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;, 2 ], }; benchmark_diag(-3, { mojo =\u0026gt; sub { my $json = Mojo::JSON-\u0026gt;new; my $ret = $json-\u0026gt;encode($args); }, xs =\u0026gt; sub { my $json = JSON::XS-\u0026gt;new; my $ret = $json-\u0026gt;encode($args); }, json =\u0026gt; sub { my $json = JSON-\u0026gt;new; my $ret = $json-\u0026gt;encode($args); }, }); ","date":"2014-01-18T17:15:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2014/01/18/171500/","title":"Mojolicious::Plugin::JSON_XSを書いた"},{"content":"@nqounetです．\nPerlでHTMLの正当性（validかどうか）を確認するのにHTML::Tidyを使ってみたという話をします．\nHTML::Tidyを入れる前にAlien::Tidypを入れる HTML::Tidyは単独で動作するわけではありません．\n少なくとも今一番新しいバージョンでは，Alien::Tidypをいうモジュールを予めインストールしておくことで使えるようになります．\n依存情報が書かれていないためHTML::Tidyをインストールしても自動的にはインストールされません．\n試してみる方は以下の様な感じでインストールしてみてください．\n1 2 cpanm Alien::Tidyp cpanm HTML::Tidy 使い方は極々簡単．\n1 2 3 4 5 6 7 8 9 10 #!/usr/bin/env perl use v5.12; use HTML::Tidy; my $tidy = HTML::Tidy-\u0026gt;new; $tidy-\u0026gt;parse( \u0026#39;hoge.html\u0026#39;, \u0026#39;hoge\u0026#39; ); foreach my $message ( $tidy-\u0026gt;messages ) { print $message-\u0026gt;as_string, \u0026#34;\\n\u0026#34;; } 結果はこんな感じになります．\n1 hoge.html (1:22) Warning: discarding unexpectedhoge.html (1:16) Warning: inserting missing \u0026#39;title\u0026#39; element ほんとうに欲しかったもの 欲しかったのは，閉じタグがない，とか，閉じタグが多い，というような情報だったのですが，その辺はWarningレベルのようなので，どうしようかなと思案中です．\nHTMLの構造体を簡単にチェックできると良かったんですが…．\n実際にjQuery Mobileで作ったページを通してみると，\u0026lt;/code\u0026gt;\nのまえにがありません的なWarningが沢山あって戦々恐々としています．\nlistviewを作る時に，a要素の中にp要素を含んでいるのですが，その部分のことを警告されているようです．\nHTML5的にはa要素の中にp要素があっても問題ないのですが，以前はそうではなかったということで，その名残でしょうか．\nHTML::Tidy HTML::Tidyは，2010年から更新されていなかったのですが，何故か今年の9月頃に更新されていました．\n…とは言っても，Changesを見る限り，大きな変更点はなかったように思います．\nWebアプリを作る時に，それほどまじめにやらないのはHTMLのvalidationじゃないかなと思います．\n私は今までほとんどやったことがありませんでした．\nstaticなものであれば，W3CのHTML Validatorが使えますが，ログインしたり色々するのはこいつでは検証できません．\nThe W3C Markup Validation Service かと言って，APIを使ってテストするのも非常識かなと．\n便利なモジュールもあるんですけどね．\nStruan Donald / WebService-Validator-HTML-W3C - search.cpan.org CGI全盛期の遺産 MVCフレームワークのようなテンプレートを使ったものの場合，明らかにおかしい部分はすぐに分かります．\n…いや，すぐに分からなくても，少し調べればわかるのでHTMLのテストは必要性を感じなかったのです．\nというのも，昔はheaderファイルに開始タグを書いてfooterファイルに終了タグを書く，というような書き方もしていたのですが，いつの頃からかincludeするファイルごとにHTMLの構造を完結させるようになっていました．\nそのため，HTMLの構造が壊れても簡単に発見できました．\nしかし，過去の遺産というか負債というか，ちゃんとHTMLの構造を意識していないコードもあります．\nこの場合は，includeしているファイルを全部見ていく必要があるので面倒です．\nしかも，if文で，classやonclickの指定が違う部分を開始タグごと書いてあったり，条件によって開始タグがなくなるように書いていることもありました．\n我ながら酷いと思います．\n閉じタグを書くためのif文を見て泣けてきました．\nこういう部分は，後々を考えて書き直していきたいのですが，HTMLの構造体がどこでどう変わっているのかをソースレベルで追いかけるのは大変です．\nそこで，HTMLの構造のテストを追加することにしました．\nもう少しカジュアルにテストしたいですね…．\n","date":"2013-12-30T19:42:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/12/30/194200/","title":"HTMLの正当性を検査するのにHTML::Tidyを使ってみた"},{"content":"@nqounetです．\nこのSSHクライアントは惚れますね．\nChromeアプリの「Secure Shell」 Windowsの環境構築で色々と頑張った結果，大した成果もなかったのですが，SSHのクライアントに限って言えば，これで決まりですね．\nホストの情報もちゃんと保存できるし，日本語の表示も問題ないし，フォントも簡単に変更できました．\n1つだけ気になったのは，公開鍵認証用の秘密鍵の扱いです．\n普段使っている，~/.ssh/id_rsaの鍵については，importしても，defaultの表示のままなのでちゃんと読み込めているのかよくわかりません．\nログインできるので読み込めているのは間違いないのですが，importする前もdefaultになっているのが気になります．\nいくつも鍵を登録すれば変化があるのかもしれませんが，そこまでは試していません．\nしかし，そんなことは些細な事です．\nMac版にない機能として，Windows版では「ウィンドウとして開く」こともできます．\nこうなると，普通にアプリです．\nほんとうに素晴らしいですね．\n","date":"2013-12-21T01:47:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/12/21/014700/","title":"Windowsでは定番のSSHクライアント"},{"content":"@nouqnetです．\n今日は面白い話を見つけました．\nSSHの定番クライアント 「Google Chrome」が定番のSSHクライアントだったという話です．\n定番SSHクライアント「Google Chrome」 — 京大マイコンクラブ (KMC) …知りませんでした．\n試しにWindows機で試してみましたが，残念ながら公開鍵を置いてなくてサクッと試すのは無理だったのですが，帰ってきてから試してみると，なかなか良さそうです．\nさすがにMacでiTerm2を使っていれば必要ありませんが，Windows機なら重宝しそうですね．\n「Google Chrome」ってなんでも出来ますね．\nそりゃChromebookも出ますよ．\n$199というのは魅力ですね．\nGithubで使っている公開鍵はどこに居ても使える こっちも知らなかったのです．\nGitHub に登録した SSH 公開鍵は全世界に公開されている | 774::Blog Githubに使っているマシンの公開鍵をまとめておけば，このマシンを登録してなかった，なんて事がなくなります．\n今日の私のように，公開鍵がなくてSSHクライアントが手軽に試せない，ということもなくなりますね．\n早速，すでに登録済みの公開鍵もGithubに登録して，~/.ssh/authorized_keysを上書き，パーミッションをオーナーのみに変更してやりました．\nこれで明日は試せるはずです．\n","date":"2013-12-19T00:27:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/12/19/002700/","title":"Windowsに良さそうなSSHクライアントが！"},{"content":"@nqounetです．\nここのところ，MacでもリロードするのにF5を押したり（もちろん動きません）しています．\n私なりの結論 文字化けを解消するにはTest::Builder::_print_to_fhを再定義するのがいいのかなと思っています．\n変更したのはprintの部分で，encodeの処理を加えただけです．\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 use utf8; use strict; use warnings; use Test::More; use Encode; use Term::Encoding qw(term_encoding); my $charset = term_encoding; { no warnings \u0026#39;redefine\u0026#39;; sub Test::Builder::_print_to_fh { my( $self, $fh, @msgs ) = @_; # Prevent printing headers when only compiling. Mostly for when # tests are deparsed with B::Deparse return if $^C; my $msg = join \u0026#39;\u0026#39;, @msgs; my $indent = $self-\u0026gt;_indent; local( $\\, $\u0026#34;, $, ) = ( undef, \u0026#39; \u0026#39;, \u0026#39;\u0026#39; ); # Escape each line after the first with a # so we don\u0026#39;t # confuse Test::Harness. $msg =~ s{\\n(?!\\z)}{\\n$indent# }sg; # Stick a newline on the end if it needs it. $msg .= \u0026#34;\\n\u0026#34; unless $msg =~ /\\n\\z/; return print $fh $indent, encode($charset, $msg); } } ... # テストを書く いろいろ試しているうちにfind_encodingを消してしまったのすが，これだったらfind_encodingを使ったほうが速そうです．\n実際のスクリプトは，Test::Mojoを継承してゴニョゴニョしているものなので，この状態で動くかどうかはわかりません．\nいずれにしろ，プライベートな関数を再定義しているので行儀が良いわけではありません．\nTest::More-\u0026gt;builder 結論を書いたところで，試行錯誤をたどります．\n意図的に出力する分については，以前の記事で文字化けを解消できたのですが，テストが失敗した時に自動的に出してくれる出力が文字化けのままでした．\nどうにかしたいな〜と思いながらTest::Moreのドキュメントを読んでいて，今更ですがWide character in printについて書いてあるのを発見しました．\nTest::More - search.cpan.org Test::More-\u0026gt;builderを使って，各種ハンドルをbinmodeでencodeする方法です．\nこれは良さそうです，ということで試したのですが，どうもうまく行きませんでした．\n1 2 3 4 my $builder = Test::More-\u0026gt;builder; binmode $builder-\u0026gt;output, \u0026#34;:encoding($charset)\u0026#34;; binmode $builder-\u0026gt;failure_output, \u0026#34;:encoding($charset)\u0026#34;; binmode $builder-\u0026gt;todo_output, \u0026#34;:encoding($charset)\u0026#34;; どこかで変なミスをしたのかもしれないのですが，cp932にマッピングされていない文字がある！，というふうに文字ごとに警告がでました．\n正確な文字コードは忘れましたが，すべての文字に何かがくっついていた感じです．\nもしかすると，変数をやめてcp932を直打ちしたかもしれませんが，結果は同じだったと思います．\nメモってなくて記憶で書いているのでアレですが．\nuse open そして，もう一つの方法も試しましたが，こちらも残念ながら動きませんでした．\n1 2 use open \u0026#39;:std\u0026#39;, \u0026#34;:encoding($charset)\u0026#34;; use Test::More; これも直打ちしたかもしれませんが，（以下略\n念のためBEGINを使ってみましたが，同じだったような気がします．\nメモってなくて（以下略\nエラー（警告）の出力に注目 ここで，先に試した「cp932にマッピングされていない」という感じのエラーですが，全部同じ行で出ていました．\nそこにあったのが，Test::Builder::_print_to_fhでした．\n前後を見てみましたが，printしているのはここだけっぽいので，それじゃあって感じでencodeして出力するように再定義してみました．\n嫌なエラーも消え，文字化けも解消されました．\nめでたしめでたし．\nUTF-8のコマンドプロンプトが欲しい 高望みしているつもりはないんですけどね…．\nWindowsも内部的にはUTF-8を使ってるんじゃないんですかね？\n","date":"2013-12-13T01:02:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/12/13/010200/","title":"WindowsPowerShell+Test::Moreでテストの時の文字化けを解消する方法"},{"content":"@nqounetです．\nWindowsのHomeキーとEndキーが快適すぎて，Macで文字を打つのが辛いです．\nまたoptionキーとcommandキーを入れ替えようかと，考え中．\n今日はChromeのデベロッパーツールに感動した話です．\nユーザーエージェントを詐称する 結果から．\nデベロッパーツールのオプション（右下の歯車）を開いて「Overrides」の所で設定できる！\nデベロッパーツールを開くたびに有効になるようにしておくと便利ですね．\nChromeでユーザーを作って，そのユーザーでのアクセスはスマートフォン扱い，という風にして使っています．\nChromeのユーザーを増やす利点が最初はわからなかったのですが，まさに開発向けという感じです．\nさて，ユーザーエージェントの詐称，というと色々と悪い感じですが，結構需要はあると思います．\n拡張機能も色々とあったのですが，なんだかイマイチ感がありました．\nもうちょっと気の利いた感じのはないのかと思っていたら，Chromeの（デベロッパーツールの）標準機能にあるというではありませんか！\nなんということでしょう～．\nこれこれ，これです．こんな感じですよ．\nなんというか，さすが本体の機能は別格な感じがしますね．\n開発中は，ずっとこれを使っています．\nHTTP通信を覗き見る 結果から．\nHTTPで何を送受信しているのかを確認するのは，Chromeの標準機能（デベロッパーツール）で十分でした．\n十分というより，状況が正しく把握できたので，より適切でした．\n最近は，既存のサービスのスマートフォン対応をしています．\nただ，残念ながら，既存のサービスについて，しっかりとした仕様書がありません．\n…まあ，よくある話ですね．\n仕方ないので，本来はソースコードからパラメータを読み取るのがふさわしいのですが，実際の通信から読み解いていこう，という考えに至りました．\nそこで，Chromeの拡張機能でhttpのヘッダ（送受信）を確認したり（HTTP Headers），通信のトレースをしたり（HTTP Trace），していたのですが，モバイル版でselectをmultipleにして複数選択した時に，最初の項目しかアプリケーションに渡っていない，という状況で躓いた．\n「HTTP Trace」で見ていると，PC版と同じ項目を送信しているのです．\nなので，何か特殊な仕様でもあるのかと思い既存システムを良く知る担当者に確認してみたのですが，フレームワークで自動的に値を取得しているだけで，そんな特殊な仕様ではありませんでした．\nそれで，責任者の方に訊いてみると，どれどれ…という感じで，デベロッパーツールのNetworkを開いて，POSTしているPATHを選択して，Headersを見ているではありませんか！\nリクエストもレスポンスもフォームデータも丸見えですよ．\n拡張機能なんて要らんかったんや．\nそこで比べてみると，PC版は複数の値をカンマで区切って連結させていたのでした．\n私が作っていた方は，jQueryMobileで作ったフォームそのままだったので，項目と値を複数回送っていました．\n「HTTP Trace」はその状態をわかりやすいように解釈して見せてくれていたのです．\n確かにわかりやすいですよ．\nしかし，まさかフォームの送信データが原因だったなんて．\nというか，フレームワークってそういう所には対応してないのか…．\nともかく，原因はわかったので，送信する前にデータを整えて，余分なデータは消して送信することにしました．\nめでたしめでたし．\nクッキーを消したい 結果から．\nデベロッパーツールのResourcesのCookiesで全部丸見えですし，項目ごとに削除できます．\n全部消すのも簡単．\n選んで消すこともできる．\nこれ以上何が必要ですか？\n…まあ，さすがに編集は出来ないようなので，クッキーを編集する拡張機能は有用かもしれません．\n編集する場合は「Edit This Cookie」という拡張機能を使うと良さそうですね．\nChrome Web Store - Edit This Cookie ただ，あまり活躍してません．\nまとめ Googleは凄いね．\nブラウザはChromeだけで良いと思います．\n…まあ，Firefoxも使ってますよ．\n","date":"2013-12-06T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/12/06/083000/","title":"Chromeのデベロッパーツールが凄い"},{"content":"@nqounetです．\nここ数日，色々とWindowsのことをdisっている感じですが，気に入っている部分もあるんですよ．\nHomeキーとendキー Macに来て一番困ったのは，行頭や行末へのジャンプ，ファイルの一番最初や最後へのジャンプが使いづらいことでした．\nVimのようなエディタを使っていない限りは，行単位での選択はマウスを使うことが多くなります．\nそのような時に，homeキーで行頭へ飛んだり，endキーで行末へ飛ぶ，というショートカットは非常に手軽だったんですね．\n1 2 3 4 5 6 7 Windowsでの素敵なキー操作 home ：行頭 end ：行末 ctrl+home ：ファイルの先頭 ctrl+end ：ファイルの最後 ctrl+pageup ：タブの切替（左方向） ctrl+pagedown ：タブの切替（右方向） Macにも同じような機能はありますよ．\ncommandキー＋左で行頭，commandキー＋右で行末，commandキー＋上，下でそれぞれ先頭，最後に飛べますし，command＋option+左右でタブの切り替えもできます．\n1 2 3 4 5 6 7 Macでのイマイチなキー操作 command+左：行頭 command+右：行末 command+上：ファイルの先頭 command+下：ファイルの最後 command+option+左：タブの切替（左方向） command+option+右：タブの切替（右方向） …まあ，細かい話ですが，結局は慣れなんですよね．\n行削除にショートカットがあればそれを使えばよいし，そうでなくてもdeleteキーをずっと押し続けて消してもいい．\nもちろん，マウスで1行選択して削除すれば良いんですよ．\nそれでも，endキーで行末へ飛んで，shift+homeでその行を選ぶとか，homeで行頭へ飛んでshift+下で改行も含んで選ぶ，とか．\nついついそんな感じの操作をしています．\n久しぶり（2年半ぶり）にWindowsを長時間連続で触るのですが，homeとendを使ってる感が半端無いんですよね．\nhomeとendを使った操作感に懐かしさを感じてしまいます．とてもしっくりと来ます．\nさきほども，うっかりoption+sで「ß」を入力していました．\nほんとうに困ります．\n","date":"2013-11-30T02:17:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/11/30/021700/","title":"Windowsのここが良い，と思っているところ"},{"content":"@nqounetです．\n今日，PowerShellで使える環境を整えた（つもりの）WindowsマシンでPerlで書いたテストを実行してみたんですよ．\nそしたら文字化け！\nUTF-8のこの時代に，まだ文字化けで悩まなければならないことが本当に辛い．\n思ったよりも苦労した（思い出せなかった）のでメモ．\nTerm::EncodingとEncode さすがにEncodeは忘れませんが，Term::Encodingが出てこなくて困りました．\nTerm::Encodingはターミナルの文字コードを返してくれます．\nTatsuhiko Miyagawa / Term-Encoding - search.cpan.org Dan Kogai / Encode - search.cpan.org うまく行ったコードは，結局のところ超基本形でした．\n1 2 3 4 use Encode; use Term::Encoding qw(term_encoding); my $enc = Encode::find_encoding(term_encoding); print $enc-\u0026gt;encode(\u0026#34;ハローワールド！\u0026#34;); 実は，役に立ったのは自分の記事（というか，自分で書いた記事を意識して検索したんですが）でした．\nモダンPerl#32でTerm::Encodingを知った - 日曜プログラマのそゞろ事 基本はこれで，必要な出力に対して「encode」してやることで文字化けが解消されました．\nbinmodeがうまく使えなかった 結論が出たところで，思考を追っていきます．\n最初はPerl入学式でも使ったお約束を利用した方法で，自動的にEncodeとDecodeを行う方法を試したのですが，残念ながらテストの出力には効果がありませんでした．\n書き方がまずかったのかもしれませんが．\n1 2 3 binmode STDIN =\u0026gt; \u0026#39;:encoding(shiftjis)\u0026#39;; binmode STDOUT =\u0026gt; \u0026#39;:encoding(shiftjis)\u0026#39;; binmode STDERR =\u0026gt; \u0026#39;:encoding(shiftjis)\u0026#39;; shiftjisがcp932だったら違うのかもしれませんが後の祭り．\n何故うまくいかないのかを考えるよりは，さっさとWindowsのせいにして次に進むほうが良さそうだと思いました．\nfind_encodingが思い出せなかった 次の案としては，地道に出力時にencodeしてやる方法です．\nEncode::encodeは，通常，文字コードを指定してやる必要がありますが，予めfind_encodingしておくと，Encodeモジュール内で文字コードを調べる必要がなくなり，高速化が図れます．\n404 Blog Not Found:perl tips - Encodeを速く使う方法 ターミナルのコードは途中から変わることはないので，最初にterm_encodingで取得しておき，それを元にEncode::find_encodingでencodeするオブジェクトを作っておけば，文字化けせずに表示されるということです．\n","date":"2013-11-29T00:19:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/11/29/001900/","title":"WindowsはPowerShellを使ってもUTF-8が使えないのか…という諦め"},{"content":"@nqounetです．\n昨日書いた記事は，よく読んでみると途中が抜けていました．\n以前、WindowsからMacに乗り換えた時に、WindowsでいうControlキーの場所にCommandキーを差し替えて使っていたのですが、それにかなり慣れて来た所にWindowsマシンを使うことになってこのザマです。\nWindowsでもshift-keyなしで_（アンダースコア）を出す方法 - Kansai.pmで活動しているPerlプログラマのブログ\n差し替えて使っていたのを，元に戻して，素の状態で使ってかなり慣れたんですよ．\n今は，USB接続の純正キーボードを使っていますが，左下の方に，commandキーやoptionキーが並んでいるのですが，MacBookだとcapsもあるんですよ．\nキーボードの左下の方は，使うマシンによってまちまちなので，本当に困ります．\nApple Keyboard テンキー付き -JIS MB110J/B posted with amazlet at 13.11.27 アップル (2011-07-22) 売り上げランキング: 2,124 Amazon.co.jpで詳細を見る\nこのキーボードは薄くて，軽くてオススメですね．\n家ではずっとこれを使っています．\nMacのMarkdownエディタといえばMou 今，これを書いているのも，Markdownエディタです．\nMacでは，Mouがオススメです．\nMou - Markdown editor for web developers, on Mac OS X 動作が軽くて，HTMLへの出力ができて，プレビューもできます．\n難点といえば，画像を貼ると再描画がウザいところでしょうか．\n特に，インターネット上の画像を表示させていると，文字を打つたびに再描画されてかなりウザいです．\nまあ，そういう時は，「http:」までを取ってやると，ローカルで編集している時は無視してくれて，かつ，httpあるいはhttpsで見ているときは，適切にリンクしてくれる，というありがたいことが出来ます．\n例えば．\nこの画像の場合は，以下のように書いておくと再描画のストレスはありません．\n1 ![Mouのスクリーンショット](//copy.com/juncmBw273z6m0Ds) Mouとの出会い いつだったか覚えていませんが，Markdownを覚えようと思った時に検索していて，プレビューしながら書ける，という仕様に惚れて，あまり深く考えずに使っていたのですが，本当に使い勝手が良いです．\nOSXでも対応しているのはLion以降なので，わりと新しいソフトなのです．\nエディタとしてもシンプルで，あまりオプションはありませんが必要十分な感じで洗練されています．\nWindowsでMarkdownエディタを探す時に気をつけたこと 私はそんなに多くを求めていない，と思っているのですが，MouのようなアプリがWindowsにはないのかを探していた時には，1つも満足行くものがありませんでした．\nたかだか2つです．\nエディタ部分のフォントの種類や大きさが変えられること リストが連続で入力できること プレビューできること …3つでした．\nまあ，最近はプレビューがなくても大体はイメージできるので平気なのですが，プレビュー機能があると安心感が違います．\nまた，便利なショートカットもあれば使いますが，クリティカルなものではありません．リンク作成はよく使うのであったほうが嬉しいですが．\nこの基準で探してみたら，2つほどありました．\nMarkPad MarkdownPad - The Markdown Editor for Windows MarkPadはWindows8仕様（？）のアプリっぽいですが，blogの設定ができるようで記事を書いてアップするのが簡単にできそうです．…試してませんが．\nMarkdownPadの方は，細かいオプションがあって，馴染んでくればなかなか使いでがありそうです．すべての機能を使うにはPro版を購入する事になります．\nどちらも軽く触っただけですが，なかなか良いと思います．\n1年くらい前に探した時は，あまり良いソフトがなかった印象だったのですが，今はWindowsでもMarkdownは平気で書けますね．\n","date":"2013-11-28T02:33:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/11/28/023300/","title":"Windowsにも使えるMarkdownエディタがあった"},{"content":"@nqounetです． 最近、WindowsとMacを行ったり来たりして、Macでショートカットが使えなくなってきていますが、いかがお過ごしですか。 以前、WindowsからMacに乗り換えた時に、WindowsでいうControlキーの場所にCommandキーを差し替えて使っていたのですが、それにかなり慣れて来た所にWindowsマシンを使うことになってこのザマです。 常に両方使うにはもっと違う手段を考える必要があるのかもしれません。\nアンダースコアの憂鬱 Macを使っていて、何が嬉しかったって、アンダースコアがshift-keyを押していなくても打てることですよ。 もう、これが染み付いていて大変ですよ。 Windowsで不思議なのは、＼（バックスラッシュ、Windowsだと￥になる）のキーが2つもあることです。 下の方のキーはアンダースコアにしてくれればいいのに…。\nGoogle先生助けて！ なんとかshift-keyなしで打ちたいと、調べてみると探し方が悪いのかなかなか見つからなかったのですが、なんとか見つけました！\n秀まるおのホームページ(サイトー企画)－秀Caps 色々と機能はあるようですが、欲しい機能は一つだけ。 プログラムはタスクバーに常駐しますが、問題ありません。 Windowsのエキスパートだったらレジストリを書き換えて対応したりもできるのでしょうが、私にはこれが精一杯。\nそれにしてもショートカット… ショートカットは本当に参ってしまいます。 特にMacに戻ってからが大変。 今も、1行消そうと思ってshift+homeで全消ししてしまったり、コピーしようと思ってoption+cで別の文字を打っていたりしています。\n","date":"2013-11-26T23:12:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/11/26/231200/","title":"Windowsでもshift-keyなしで_（アンダースコア）を出す方法"},{"content":"@nqounetです．\n最近，Windowsで開発する（Perlじゃないけど）事になって，環境構築を色々と調べてみたので備忘録的に．\nターミナルが大問題 結局最後までどうしようもなかったのがターミナル（コンソール）だった．\nGitの状態がわかって，フォントをRictyにする，というのが，こんなに大変だと思ってなかった．\nもっと言うと，最初はVagrantを使って，仮想マシンからWindowsのファイルを編集しようと思っていたのだけど，とんでもない話だった．\nCygwinを入れたら負けかな，と思ってMinGWからMinTTYを使おうと思ったのだけど，Git Bashと相性がよろしく無いようで，併用するとlsで固まってしまった．\nリソースモニタで確認すると，ls.exeがいっぱい…．\n過程で色々インストールしたせいか，bash.exeとか幾つもあってなんとも言えない気分になった．\n素直にCygwinを入れればよかったのか？\nConsoleというソフトがオススメという話だったのだが，マルチバイトを表示するためにはコツが要るようだった．\nフォントをRictyにするにしても，cmdやWindows Power Shellは，使えるフォントが限られているのがひどい．自由にさせてくれればいいのに．\n結局リポジトリをイジって使えるフォントを増やす方法があったので，それでRictyを選べるようにした．\ncmd.exe（コマンド プロンプト）のフォントを変更する - poohSec そして，Windows Power ShellとPosh Gitの組み合わせが良いという話だったので，折角なのでChocolateyを使ってインストールして環境を整えた．\nPowerShell で Git : Developer @ ADJUST Chocolatey Gallery かなり妥協した結果だけど，数日使ってみて，そこそこ良かった気がしている．\nもう一歩進んでWPSで楽をする WPS（Windows Power Shell）のプロンプトで$profileと入力すると，設定ファイルがわかるので，そのファイルを編集して関数を直接書き込む．\nエイリアスを作成するのにset-aliasというコマンドがあるのだけど，引数は設定できないので，よく使うgst（git status -sbの短縮型）は関数にしてやらなければならない．\n1 function gst { git status -sb } そんなに難しくなかった．\nMacでは，ターミナルからopen .とする事も多かったので，explorer.exeも関数にしてやる．\n1 function open($file_or_dir = \u0026#34;.\u0026#34;) { explorer.exe $file_or_dir } 関数は引数も使える，かつ，初期値を入れておくこともできるので，openだけでもカレントディレクトリを開くように出来た．\nホームディレクトリも変えてやる WindowsではCドライブにデータを入れるなんて怖いです．\nソフトによっても，%system_drive%を指定してくる奴もいてヤダ．\nなのに，ホームディレクトリを別のドライブにするのは結構大変．\nユーザーを作る時には出来たのかもしれないけど，作りなおして…とはさすがに言えないので．\n「コンピューターの管理」だったかで，ユーザーのプロファイルの場所を変更することは出来たけど，それを実行してもマイドキュメントなどの場所が変わらない．\nマイドキュメントやダウンロードの「場所」は，それぞれのフォルダのプロパティで場所が変えられるので，それで対応した．\n全部一括で変えたいが，それも出来ない．\nフォルダを右クリックして，プロパティを選んで，場所タブを選んで，CをDに変更するだけの簡単なお仕事だけど，何回もやるのは飽きる．\n日本語入力 日本語入力は，Google日本語入力で．\n最近覚えた，無変換キーでIMEをオフにする技があるので，うっかりカタカナで入力してしまうことが減りました．\nGoogle日本語入力でIME ON/OFFを変換・無変換キーに割り当てる【ver 2.0】 | TeraDas－テラダス 一日ずっと触っててもミスが絶えないので，自力で考えて解決に至ったんだけど，調べてみたら結構前から知られていた技だった…．\n環境構築は楽しい！ …確かに楽しいんだけど，作業が進まなくて大変．\n","date":"2013-11-20T08:02:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/11/20/080200/","title":"Windowsの開発環境って難しい"},{"content":"@nqounetです。\n先日，機会に恵まれて，とあるWebプログラマー養成クラスでPerlについて6時間ほど講話してきました。\n話をいただいたときは大変恐縮しましたが，終わってみると生徒さんからの反応も上々でしたので，本当に良かったと思います。\n何を話そうか 最初にお話をいただいた時，6時間も何を話すのか思いつきもしませんでしたが，話をしている中で，対象はWebプログラマーということで，Perlにも触れてもらうことにしました。\nネタとしては，Perl入学式でも実施した，ファイルを使った簡易掲示板があったので，それを使うことにしました。\nガチガチのプログラミングではなくて，PerlというよりはMojolicious::Liteを使ったMVCのプログラミングに触れてもらう感じです。\n思いつきとしては，今でも良かったとは思っていますが，実際には予想したよりもハードルが高かったです。\n最初の敵はWindows Perl入学式では，OSがUNIX系でない場合は仮想マシンを入れて環境を整える，という回がある程なので，Windowsにいかにして早く環境を作るのかというところがポイントになりました。\n当初，plenvを使ってPerlをコンパイルする，というところから始めようと思ったのですが，gitは入っていませんでした…。\nなのでgitをインストールしてもらうことにしたのですが，その作業を見ていると，この調子だとPerlをインストールするだけで終わってしまいそうな気がしてきたので，途中で方針を変えてStrawberry Perlをインストールしてもらうことにしました。\nこれは偶然だったのですが，自動的にStrawberry Perlをインストールするとcpanminusもインストールされていたので，その点については助かりました。\ncpanmでMojoliciousもスムーズにインストールできていたと思います。\n環境構築で時間を掛けてしまうのはもったいないですからね。\nGit Strawberry Perl for Windows https://raw.github.com/miyagawa/cpanminus/master/cpanm エディタは改行コードと文字コードを気にして選ぶ PerlとMojoliciousも無事に入ったことで，いよいよプログラミング開始です。\nプログラムを書く時にはエディタが必須なのですが，改行コードと文字コードを選べるものであればなんでも良い，という話をしました。\n改行コードはLF，文字コードはUTF-8で保存しておけば当面は問題ありません。\n最近はWindowsを使ってないので，最近のものは知りませんが，英語で問題なければProgrammer\u0026rsquo;s Notepad，そうでなければサクラエディタをオススメしています。\nSublime TextもWindows版がありますので，それもよいですね。\nProgrammer\u0026rsquo;s Notepad サクラエディタ Sublime Text: The text editor you\u0026rsquo;ll fall in love with もっと学びたいならPerl入学式へ！ Mojolicious::Liteを使ったウェブアプリ作成は，Perlのことよりも，フレームワークの使い方の方がメインになります。\nウェブ系の開発なら，どの言語でもWAF（ウェブ・アプリケーション・フレームワーク）を使うことが多くなってきていると思いますので，この講話を通じて，最近のウェブ開発の様子が伝えられたんじゃないかと思っています。\nWAFに興味を持ったり，もっとPerlを学んでみたい，と思われたら，10月26日（土曜日）にPerl入学式in大阪#4があるので，是非ご参加ください。\n近々告知されますので，公式サイトをご確認ください。\nPerl Entrance 9月30日にも講話をします 機会に恵まれて，今度の月曜日（9月30日）にも講話をすることになりました。\nありがとうございます。\n","date":"2013-09-28T15:41:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/28/154100/","title":"講話してきました"},{"content":"@nqounetです．\n9月19,20,21日は，YAPC::ASIA Tokyo 2013に行ってきました．\n長い割には内容がありませんのでお気をつけください．\n一言で言うと，楽しかったです．\n時系列的にはその2の続きからです．\n2日目続き では，続きです．\nPerl入学式 ランチの後は，Perl入学式です．\nPerl入学式は，今やPerl界隈で有名なpapixさんが2012年から大阪を中心に開催している勉強会です．\n全くのプログラミング初心者からでも勉強できるように，開発環境の構築から，基本的なターミナルの操作なども含めた手厚いサポートが特長です．\n2013年の4月からは東京でも開催されるなど，精力的に裾野を広げる活動をしており，2014年からはさらに多くの地域で開催されるという噂もあり，今後ますます目が離せない勉強会になっています．\n次回の開催などは公式サイトをご確認ください．\nPerl Entrance YAPC::Asiaの会場で開催されるということで，サポート陣は全国から集った豪華なメンバーでした．\n私もサポートの一員としてお手伝いをしてきました．\nメインの講師はPerl入学式in大阪でも定評のある@bool_foolさんです．\n勉強会の内容は，Perlを使ってHTTPでYoutubeの動画データを取得して加工することを目的とし，それに必要な知識を少しずつ，実際にプログラミングしながら進められました．\nYAPCの会場で行うPerl入学式は，サプライズが沢山ありました．\nもともとPerlの著名な方が集まるイベントでもありますので，@dankogaiさんや@yoshiyuki_kondoさんや@yusukebeさんが，ふらっと勉強会の会場に入ってきたりするわけです．\nサポーター同士でも交流していたりしたので，参加者から「ちゃんとしたサポートが受けられなかった」というような苦情がなければよいのですが．\nスマフォアプリ開発を支える認証認可アーキテクチャ スピーカーは鈴木理恵子さん．\nスマフォアプリ開発を支える認証認可アーキテクチャ - YAPC::Asia Tokyo 2013 Perl入学式を途中で抜けて聴いてきました．\n簡単にまとめると，簡単にログインできるように同社製のアプリケーション間で認証情報を共有したいので保管するが，万一その情報が漏れたとしても，影響範囲を最小限に絞り込むことで対応する，という話でした．\nこういった話を考えるたびに，便利さと安全というのは相反することだなと思います．\n安全で便利な方法が発明されれば画期的だとは思うのですが，そもそも機械が個人をどのように特定するのかの問題になってくるので大変ですね．\nLightning Talks Day 2 2日目のライトニングトーク．\nLightning Talks Day 2 2日目も，ちゃんとメモれたかどうかも怪しいですが，気になったキーワードだけ書いておきます．自分自身でも消化できるのか怪しいですが．\ncoveralls DBIx::RecordFactory Haineko mroonga mysql-build netacpan.org Baran::*(DeNAオンリー) Method::Singnatures netacpan面白そう．\n環境に依存していて汎用性はないそうですが，隙間を埋める「ばらん」という考え方は素敵だと思います．\n汎用的に隙間を埋められるモジュールがあれば無敵ですね．\nKeynote スピーカーは@ikebeさん．\nKeynote - YAPC::Asia Tokyo 2013 LTの後，休憩をはさんで締めのトーク．\nこれまでは技術的な話題がほとんどだったのですが，マネジメントの話です．\n時代とともにプログラミングの仕方も変わってきているので，自分自身が作ってきた，今となっては負債となっているものを精算してもらっている，というような話に切ない気持ちになってきます．\nクロージング 年々規模が大きくなってきているYAPC::Asiaも，ついに1000人を超えるイベントになりました．\n参加者のひとりとして，主催されたJPAの方々，ボランティアの方々，ネットワークチームの方々に感謝の気持でいっぱいです．\nJPA代表理事の牧さんの，来年のYAPC::Asiaは（少なくとも牧さんは）やらない，という発言で，会場が一気に静まり返ったのは印象に残りました．\n会場にいる人達が何を考えてそうなったのかはわかりませんが，その瞬間は年に一度のPerlのお祭りに対しての思いが行き場を失っていたような気がします．\n規模は違いますが，Kansai.pmも誰かが開催しなければ開催されません．\n今のところ，私が代表になっていますが，家庭や仕事を放ったらかしてまでKansai.pmの活動はできません．\nコミュニティは，ドラゴンボールの元気玉みたいなもので，みんなの力を「ほんのチョットずつ」集めて作るものです．\n牧さんの挨拶でそんなことを改めて感じました．\n来年のYAPC::Asiaはどうなるのかわかりませんが，私は私に出来る範囲でPerlのコミュニティの活動をしていきたいと思います．\nもちろん，YAPC::Asiaが開催されれば参加したいと思っています．\n","date":"2013-09-26T17:52:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/26/175200/","title":"YAPC::ASIA Tokyo 2013に行ってきた（その3） #yapcasia"},{"content":"@nqounetです．\n9月19,20,21日は，YAPC::ASIA Tokyo 2013に行ってきました．\n長い割には内容がありませんのでお気をつけください．\n一言で言うと，楽しかったです．\n時系列的にはその1の続きからです．\nその前に その1では写真を付け忘れていたので，写真をば．\n前夜祭の様子です．\nオープニングの一幕です．（株）スカイアークさま，ありがとうございます．\n個人スポンサー特典のミニ提灯です．\nランチ交流会のお弁当です．（1日目）\n館内は原則飲食禁止なので，当初は飲食可能なイベントホールにしよう，と言っていたのですが，ランチセッションでかなり人が多かったので外で食べることにしました．\n他の方々も場所に困っていたようで，近くに同じお弁当を持った方がひしめいていました．\n1日目続き では，続きです．\nはてなのサーバ管理ツールの話 スピーカーは@y_uuk1さん．\nはてなのサーバ管理ツールの話 - YAPC::Asia Tokyo 2013 ざっくり言うと，サーバーの監視ツール，デプロイツール，環境構築ツールを統合して管理するソフトMackerel（和名は鯖）の紹介と構想の話．\nそれぞれのツールに，サーバーのIPアドレスなどを書くのはだるいので，一元管理したい，かつ，ツール自体は自由に選びたいので疎結合にできるツールがほしい，というモチベーションで開発した．\n各ツールの設定を自動的に生成できるようにしている．\nやはり，サーバー数千台というレベルになってくると，人間が直接管理するのは無理なので，人間で管理できるレベルまでまとめてくれる仕組みは必要ですね．\nLightning Talks Day 1 初日のライトニングトーク．\nLightning Talks Day 1 - YAPC::Asia Tokyo 2013 気になった言葉だけを列挙します．\nprove 便利 Tachikoma（rubyのgem） inspect-perl-proc Benchmark::Confirm Test::Power Power::Assert perl.js emscripten LLVM Spica（WebAPIの差異を吸収する） なかでも，感心したのは，Benchmark::Confirm．\n地味だけど，ベンチマークの各コードが本当に同じ出力なのかは確認が必要ですよね．\n懇親会！ 昨年に引き続き，今年も懇親会は無料！\nDeNAさん太っ腹ですね．\nYAPC::Asia Tokyo 2013 懇親会 - YAPC::Asia Tokyo 2013 イベントホールと，その隣の部屋（結局行きませんでしたが）も開放しての立食形式でした．\n立食形式だと，終盤どんどん料理の選択肢が減っていくのですが，終盤になっても料理が追加されてました．野球選手が集まるパーティじゃないので，多すぎだと思います．\n懇親会は人が多すぎて，ぼんやりしていると，ある程度の知り合い同士で固まってしまうのが何とかしたいところです．\n私のようなヘタレにとっては，スピーカーに話しかける（質問する）には懇親会は調度良いのですが，人気のスピーカーの近くにはライバル（？）が多くてなかなか話しかけるのも大変です．\n地方の.pmやPerl入学式などの小さな集まりでは競争率も減るので，人大杉で無理，という方は規模の小さい集まりから初めて顔見知りを増やすと良いと思います．\nさて，懇親会の最後のほうで，ようやく（株）スカイアークの@onagataniさんにご挨拶出来ました．なんだかんだで毎年名刺を頂いている感じがします．\n2日目（9月21日） Perlで書く結合テスト スピーカーは@ikasam_aさん．\nPerlで書く結合テスト - YAPC::Asia Tokyo 2013 結合テスト云々の前に，SWETあるいはSETと呼ばれるエンジニアの話やテストの概論がありました．\n後半は具体例をあげての説明で，とてもわかりやすかったです．\n単体テストは，テストする対象によって何をテストするのかが変わるので，依頼する場合は認識を合わせることが重要です．\n単体でテストする場合，他のモジュールに依存する入力はモックにする，のが良いそうです． そうしないとテストの対象がぶれてしまいますね．\nWeb APIをテストする場合，生のデータが取れるクライアントを使うとテストがしやすい．\n今のところは，LWP::UserAgentかFurlを使っておけば間違いなさそうです．\nCacheやDBのテストは，APIを経由せずに直接テストすることも必要っぽいです．\nウェブアプリの場合は，HTMLの出力を調べることになります．\nwww::MechanizeやSelenium，Wight，Brownieなどがなかなか使えるみたいですね．\nログインの情報をテストに直接書かなくても良いように，環境変数から持ってくるために，必要な環境変数名を定義しておく（Test::Requires::Env）とか，Config::Pitを使うとか，結構気を使っているんだなと．\n私の場合，テスト用のユーザーのログイン情報をそのままテストスクリプトに書いていた（公開しているわけではないので問題はないと思いますが）ので，今後は注意していきたいと思います．\nProgramming AWS with Perl スピーカーは@horiuchiさん．\nProgramming AWS with Perl - YAPC::Asia Tokyo 2013 当初はノーマークだったのですが，1日目のアレで興味が出たので聴いてみました．\n公式のツールとしては，Perl向けのものがないので，AWS::CLIWrapperを使うと捗るみたいです．\nで，これを使うためにはAWS CLIというPython製のツールをインストールします．より便利にするために補完スクリプトもあるようです．\nさすがエバンジェリストというか，スライドの作りが巧みですね．（公開している資料からは該当ページは削除されていますが）会場に笑いの渦を巻き起こしていました．\nWhat\u0026rsquo;s new in Carton \u0026amp; cpanm スピーカーは@miyagawaさん．\nWhat\u0026rsquo;s new in Carton \u0026amp; cpanm - YAPC::Asia Tokyo 2013 cpanmは，すでに無くてはならないほどの存在だと思うのですが，どこまでも控えめなところがむしろ凄いと思いました．\nかと思えば，次はランチだし少し長くてもいいよね，と言い放つというね．\nrebuildは，知っていたけど聴いたことがなくて手を挙げませんでした． 好きな音楽ばかりじゃなく，こういうのも聴いておこうと思っています．\nちょっと前に試したcpanmのconfigure-argsというオプションは，最近追加されていたものらしいです．\nこういう場で，自分自身が追っている情報を再確認できるのも良いですね．\nランチ 1日目につづいて2日目もランチくじをひきました．\n交流会というからには，交流を求めてきているはずなのですが，今日も集まりが悪いです．\nヘタレな人は，番号順に集めてくれればいいのに，と思うのだろうと思います．\nが，しかし，そういう事には時間がかかりますし，交流を求めるのであれば，その瞬間だけほんの少しの勇気を出せば良いのですよ（誰\n…まあ，プラカードみたいな小道具があると良かったかもしれませんね．声だけだとどこにいるのかよくわかりませんでしたし．\n誰でもいいので1人（そのくらい立候補しょう）が番号を書いて掲げていれば，集まりやすかった気がします．\nで，そんな奥手な方々を差し置いて2日目もお弁当をゲットしました．\nAWSからたまたま一緒だった@kiyotuneさん（番号違ってたけど）も巻き込むとか，何やってんだかわかりませんが．\nで，1日目とほぼ同じ場所へ．\n一緒になったのは結果的にほぼ関西勢（@koko_uさんも一緒だった）でした．\n学生でCPANAuthorの@narazakaさんは，レンタルサーバーでCGIが普通の環境，ということで，CGI.pmがなくなる話に嘆いていました．\n偶然ですが，ちょうど仕事で関わっている大学の学生さんでした．研究室は違いましたが．\nそれはおいておいて，VPSはいきなりはハードルが高いし，自前の開発環境はあっても公開するサーバーも手頃な価格でほしいところですよね…．\nMojoliciousは，CGIでも起動できますが，起動毎にモジュールを全部読み込む必要があるので結構重いし…とか，CGIで動かすならMentaとかNanoAとかが良いんじゃない，とか，Gitprepはレンタルサーバーでも動かせるようにやってるみたいですよ〜とか，ついつい話し込んでしまいました．\nレンタルサーバーで動かすのは，今はむしろ難しいんですよね．\nなので，Perl入学式でも自前で開発環境を用意して，公開する時はVPSを推奨している（公開の仕方とかはやってないけど）気がします．\nやはり，ある程度の層には，レンタルサーバーでCGIという需要はある…のかも．\nまだ続く この後はPerl入学式ですが，長くなりそうなのでまた後で．\n","date":"2013-09-23T12:33:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/23/123300/","title":"YAPC::ASIA Tokyo 2013に行ってきた（その2） #yapcasia"},{"content":"@nqounetです。\n9月19,20,21日は，YAPC::ASIA Tokyo 2013に行ってきました。\n1日目の途中までですが長いです。長い割には内容がありませんのでお気をつけください。\n一言で言うと，楽しかったです。\nトークの申し込みと遠方からの参加者支援制度 今年はトークを申し込んだのですが，トークの内容がクラウドに関するものでしたので，遠方からの参加者支援制度にも申し込んでいました。\n残念ながら，トークは落選したのですが，参加者支援制度の方は当選していました。\nトークが採択されていないので，辞退することも考えたのですが，トークの採択の成否にかかわらず支援いただけるという太っ腹な対応でしたので，ありがたく支援を受けることにしました。\nスカイアーク様，ありがとうございました。\nYAPC::Asia 2013 「遠方からの参加者支援制度」申し込み者募集のお知らせ | YAPC::Asia Tokyo 2013 スカイアーク 〜伝えるを、もっとかんたんに。〜 また，こういう支援を受けながらも，前日まで微妙に逡巡していた私の尻を蹴飛ばしてくれた妻にも感謝しています。\nそんなわけで，前夜祭から突入です。\n前夜祭（9月19日） 前夜祭は，LTソン（LT＋マラソン）を開催していました。\n非常に盛り上がっていました。\nLTを聴いているだけでなく，1年ぶりの再会を楽しんだり，ひたすらビールを飲んだり。\n前夜祭は3時間もあったはずなのですが，あっという間に過ぎてしまいました。\n前夜祭は，どちらかと言うと内輪の空気が強く，dankogaiさんへの雑ないじり方とかでも会場が沸くなど，初めて来た方にはついていけないところもあったと思います。\n私もそんな事情通というわけでもないのでアレですが。\nともかく，1年ぶりに再会する方が多いので，挨拶したり近況報告しあったりすると，前回のYAPCから1年経ったんだなと実感しました。\n1日目（9月20日） トークは4会場で並行して開催されるので，どれを聴きに行くか大いに悩みます。\nほとんどのトークは動画が撮影されていたり，資料が公開されているので，あとで確認もできるのですが，その場にいることで感じられることもある，と断言できます。\n選ぶときには理由付けをしていませんでしたが，結果的に，テストについてのトークをよく選んでいました。\n少なくとも，この領域は私にとってはまだ不足している部分なんだなと，改めて実感しました。\n聴いたトークについて簡単にまとめてみます。\nオープニング そういえば，この日はiPhone 5sの発売日ということで，朝から並んでいた方もいたようですね。\nそんな感じなので，会場側からはよくわかりませんでしたが結構空席が目立っていたようです。\nメインホールだけでなく，会場はWi-Fiが完備されていて，とても快適でした。\nPostcards from the Edge スピーカーは@rjbsさん。\nPostcards from the Edge: The State of Perl 5 Development - YAPC::Asia Tokyo 2013 オープニング後はこの1年のPerlの進展と今後の展望という感じのトークです。\n聴いていた時はフンフン頷いていたのですが，全くメモをとってなかったのであまり覚えていませんw\n私は新しい開発では使っていませんが，昔お世話になっていたCGI.pmは近いうちに標準からはずされることになるそうです。\n時代の流れを感じますね。\n今時のカジュアルなデータベース関連開発 スピーカーは@songmuさん。\n今時のカジュアルなデータベース関連開発 - YAPC::Asia Tokyo 2013 GitDDL::Migratorが便利そうだな〜，と，同じように思ってから，これはKyoto.pmで聴いた気がする，と思い出したのが恥ずかしいです。\n小さいシステムか改修がほとんどなので，大きなシステムのデータベースを0から設計するノウハウをもっと吸収したいと思いました。\nOpenID Connect スピーカーは@ritouさん。\nOpenID Connect ~ これが最新のOpenID仕様だッ！~ - YAPC::Asia Tokyo 2013 休憩なし，かつ，会場移動も伴ったので，途中からになりました。\n立ち見だったのでメモは取れませんでしたが，資料を見て思い出そうと思います。\n今後のウェブシステムは，IDとパスワードを発行するのではなく，OAuthやOpenIDを利用するのが主流になっていくと思います。\nユーザーにとっても，システム側にとってもメリットが有る，あるいはリスクが減るので，採用しない手はないと思います。\nランチ 昼時です。\n今年はぼっち対策として，強制的にグループになるランチくじが実施されました。\nくじを引いて，同じ番号の人同士でランチをする，という試みです。\n意外と集まりが悪く，4人チームになるはずが，3人や2人のチーム（私のチームもそうでした）もあるなど，波瀾万丈でした。\n一部（半分くらい？）の方にはお弁当がもらえる特典がついていたのですが，チーム同士をくっつけるなどして対応していて大変だったと思います。\n結局チームをくっつけて4人になり，お弁当ももらいました。\nタイからの留学生の方（女性ですよ）と一緒になったのですが，私の英語が不自由で円滑なコミュニケーションができなかったのが残念です。\n大規模Perl初心者研修を支える技術 スピーカーはDaisuke Tamadaさん\n大規模Perl初心者研修を支える技術 - YAPC::Asia Tokyo 2013 途中までしか聴いていませんでしたが，新卒70人以上の技術研修は大変！という事がよくわかりました。\nPerl入学式で最大20人ほどの参加者の対応をするだけでも苦労するところがあったので，あとで資料を確認しようと思います。\n「アレ」とPerlでAWSを スピーカーは@egoproさん。\n「アレ」と Perl で AWS を - YAPC::Asia Tokyo 2013 途中で抜けて何を聴いたかというと，これです。\n「アレ」が気になってw\n「アレ」は，バーコードバトラーの予定だったのですが，うまく行かなかったそうです。\n結果的に方向修正してスーパーファミコンのコントローラーで，波動拳コマンドと昇竜拳コマンド（しかも音声付き）でAWSを操作する，というLTのノリで20分間楽しませていただきました。\nアイディアとして，バーコードをスワイプすると特定の操作ができる，というのは，黒い画面を操作するよりもはるかにハードルが低いので，切り口はとても面白かったです。\nまあ，普通にバーコードリーダーを使ってやれば出来るような気はします。\nQRコードなら，文字列も格納できるので，いざという時のために一式作っておいても良いかもしれませんね。\nHerokuで学ぶ，初めてのPerl スピーカーは@akiymさん。\nHerokuで学ぶ、初めてのPerl - YAPC::Asia Tokyo 2013 HerokuでPerlが使えるとは知らなかったので，その辺をガッツリ聴こうと思ったのですが，そっちよりもむしろAmon2を使ったウェブアプリの作り方がメインでした。\nやはりというか，20分でウェブアプリ作成の説明は難しく，初心者向けのトークの難しさを感じました。\nで，肝心のHerokuの方は，油断して聴き逃したっぽいので，資料を見ながら実際に動かしてみようと思っています。\nSQLiteが使えず，かわりにPostgreSQLを使う必要が有ることはわかりました。\n私にとってはそれもハードルの一つです。\nTypes and Perl Language スピーカーは@hirataraさん。\nTypes and Perl Language - YAPC::Asia Tokyo 2013 私にとっては難しすぎました。\nそれと，時間が来たら途中でも終わります，というのが微妙だな〜と思いました。最終回が放送されないドラマみたいです。\n私は，40分なら40分で伝わる分だけ喋るように考えたいと思います。\nモダンPerlリファクタリング スピーカーは@naoya_itoさん。\nモダンPerlリファクタリング - YAPC::Asia Tokyo 2013 話が終わった瞬間にベルが鳴るという，時間配分が完璧すぎて鳥肌モノでした。\nざっくり言うと，スクリプトをCPANモジュールと同じようなディレクトリ構造にすることで，色々と捗るということでした。\n一つの処理，たとえばparseという処理をモジュールに追い出してやれば，それでテストが書ける。\nテストを書けるようにするのがリファクタリングの第一歩。\nある程度テストを書いたら，あれこれ考える前にリファクタリングに手を付ける。\n作業を始めると，リファクタリングの方法を思いついたりする。\nバグを発見したら，テストを書いて，そのテストを通す。\nコツとしては，テストを自動化してこまめにテストされるようにすることと，テストのカバレッジはほどほどにすること，です。\nとても20分とは思えないような濃縮された時間でした。\nperlなweb applicationのためのテスト情報 スピーカーは@soh335さん。\nperl な web application のためのテスト情報 - YAPC::Asia Tokyo 2013 ウェブアプリのテストを，どういう感じでやっているのか参考になりました。\n便利なモジュールもある程度把握したので，今後使っていきたいと思います。\n続きは後日 ちょっと疲れてきたので，続きはまた後で。\n","date":"2013-09-22T17:08:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/22/170800/","title":"YAPC::ASIA Tokyo 2013に行ってきた（その1） #yapcasia"},{"content":"@nqounetです．\n妻が前回のアメリカ旅行の記録を続々と書いています．\n大体は一緒に行動しているのですが，ちょうど別行動をしている時間帯の記事があったので，その時の私の行動を書いてみたいと思います．\nTravelers to go LA ダウンタウンにて その頃私は 7thのメトロステーションで別れたあと，そこからほど近いところにあるコワーキングスペースに行っていました．\n場所は事前に調べておいたのですが，距離感がよくわからず，まだかな〜，と心配になった頃にようやく到着しました．\nIndie Desk 到着したコワーキングスペースは，Indie Deskというところです．\nIndie Desk :: Coworking Space in Downtown Los Angeles 通常利用は18時までだったのですが，この時はすでに17時を過ぎていました． （スペースシャトルを見るのに思った以上に時間をかけてしまいました）\n普通にドロップインしたい，と言ったのですが，1時間くらいだから，ということで料金はサービスしていただきました． ありがとうございます．\nオーナー様は用事があるということで，すぐにお出かけになりました．\n1時間ほどで戻ってくる，ということでしたが，妻との待ち合わせもあり，私のほうが時間になってしまい，残念ながら再会はできませんでした．\nどんなスペースだったか このスペースは，間口は狭いですが，奥行きが深い造りになっています．\n奥の方は，天井までのパーティションで区切られていました．\n手前の方は，身長高のパーティションで目隠しされたデスク，もっと入り口側は一人用の椅子と簡易なテーブルがありました．\nスペースには4,5人くらいが仕事をしていたのですが，私はヘタレっぷりを発揮してしまい，声をかけることはできませんでした…．\nこういう時は，紹介してくれる方がいらっしゃると私のようなヘタレには嬉しいですね…．\n18時のシンデレラ 挨拶をしておこうと，オーナー様の帰りを少し待っていたので，約束の時間には少し遅れそうになったので，若干早足で待ち合わせ場所へ向かいました．\n往路は7thを東へ行き，Broadwayを南に向かったので，復路は8thを西へ行くことにしました．\n住所がわかりにくくなるのは勘弁して欲しいですが，道が座標になっているのはとてもわかりやすくて良いですね．\n大体の場所がわかれば道順を変更しても迷うことはありません．\nネットワーク依存の待ち合わせの怖さ 待ち合わせはシェラトンホテルのロビーでした．\nホテルのロビーは，無料で使えるWi-Fiが整備されていることが多く，シェラトンも例外ではなかった…はずでした．\nところが，どうやら宿泊者専用になっていたようで，パスフレーズが必要なネットワークしかありません．\nロサンゼルスに到着して，初日で迷子！？\nと思いながら，ウロウロしていると，買い物に埋もれていた妻がソファに座っていました．\nちなみに，私がいたところから，エスカレーターを挟んで反対の場所でした．\n","date":"2013-09-19T15:45:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/19/154500/","title":"LA ダウンタウンにて（夫編）"},{"content":"@nqounetです．\n少し前にもさらっと紹介したDropboxですが，開発版にはスクリーンショットを簡単に共有できる機能がついていたようです．\nDropboxの開発版 開発版は，フォーラムの方からダウンロードする必要があります．\nEverything Else « Dropbox Forums また，開発版でもExperimental BuildとStable Buildがありますが，この機能は今の時点ではExperimental Buildの方ですので，まだまだ実験的要素が強いと思われます．\nインストールして使うかどうかは自己責任でお願いいたします．\nMacOSXの場合は，dmgファイルをダウンロードして，開いてappをダブルクリックすればインストール完了です．\nこの機会に使い始めよう，という方は，こちらのリンクからアカウントを作ると少し容量が増えます．\nもしよろしければ，お使いください．\nhttp://db.tt/IOuF8DL 普通にスクリーンショットを撮ると，初回はダイアログが出ます．\n保存することにすれば，Dropboxのフォルダの中にスクリーンショットというフォルダが出来て，その中に画像ファイルが入るようになります．\nGyazo 同じようなことができるソフトとして，すでにGyazoというのがあります．\n存在は知っていましたが使ったことがなかったので，この機会に使ってみました．\nGyazoへようこそ : スクリーンショットの瞬間共有 単に共有するなら，アカウントの登録がなくても使える，というのが驚きです．\nインストールしたあと，アプリを起動するとスクリーンショットを撮るモードになります．\nこれは，通常のcommand + shift + 4を押した状態と同じになるので，操作性は変わりません．\nちなみに，この状態でスペースキーを押すと，ウィンドウをスクリーンショットの対象にできるので，ウィンドウ単位で撮るときには便利ですよ．\nまた，Finderで画像を右クリック（2本指タップ）してこのアプリケーションで開くで，このアプリを使って開くと，その画像を共有する事ができるのが便利ですね．\nちょっと待ってセキュリティ スクリーンショットをすぐに共有できるのは便利ですが，大事な個人情報が入っていないか確認は必要ですよね．\nDropboxの方は，画像を編集すると反映されるので，万一の時は安心かもしれません．\n画像への直リンク Gyazoの方は，画像を右クリックできるので，画像のURLを取得できます．\nURLは公開URLの最後に.png（jpgファイルも変換された）を付けるだけでいけるようですね．\nDropboxは右クリックが封印されていますので，直接リンクするのは難しそうです．\nどれを使うかはあなた次第です スクリーンショットを簡単に共有できるソフトは他にもあるかもしれません．\nどのソフトを使うかは，その人が使いやすいソフトを選べば良いと思います．\nうっかりすることが多い人ならばDropboxの方が安心です．あとで修正できます．\nDropboxは手元のファイルを削除すると公開されたファイルもなくなるので，シンプルに共有したいだけならGyazoが良いでしょう．Gyazoは手元のファイルは関係ありません．\nスクリーンショットをブログで使う場合は，これらのソフトよりもCopyの方が楽かな，と思います．画像への直リンクの取得が簡単な方が良いです．\nシチュエーションによってどのソフトが最適かは変わります．\n場合によっては複数のソフトを使い分けることもあるでしょう．\n似たようなソフトがあって，でもどれも捨てがたいことは沢山ありますが，それはそれで良いと思います．\n","date":"2013-09-10T20:55:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/10/205500/","title":"Dropboxの開発版にスクリーンショットをすぐに共有できる機能がついていた"},{"content":"@nqounetです．\nDBD::SQLiteと格闘して，なんとか勝利しました．\nインストールの方法 1 $ cpanm DBD::SQLite --configure-args=\u0026#34;-Wl,\u0026#34; 実際にこれでインストールできたのだけど，このあとperlbrew switch 5.16.3してインストールしたら，特にオプション無しで成功してしまった．\nさっきまでこっちにこそインストールできなかったのに！\nしかも，ログを見たら同じエラーもあるのに．\n不思議だ．\nインストールログを見よう 何度失敗したかわかりませんが，ログを見るとどうもこの辺にヒントがあるらしい．\n1 2 cc -c -I. -I/home/hoge/perl5/perlbrew/perls/perl-5.14.2/lib/site_perl/5.14.2/i386-freebsd/auto/DBI -DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H -fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include -Wl,-Bsymbolic -O -O2 -DVERSION=\\\u0026#34;1.40\\\u0026#34; -DXS_VERSION=\\\u0026#34;1.40\\\u0026#34; -DPIC -fPIC \u0026#34;-I/home/hoge/perl5/perlbrew/perls/perl-5.14.2/lib/5.14.2/i386-freebsd/CORE\u0026#34; -DSQLITE_ENABLE_FTS4 -DSQLITE_ENABLE_FTS3_PARENTHESIS -DSQLITE_ENABLE_RTREE -DSQLITE_ENABLE_COLUMN_METADATA -DSQLITE_ENABLE_STAT3 -DNDEBUG=1 -DHAVE_USLEEP=1 -DTHREADSAFE=0 -D_XOPEN_SOURCE SQLite.c cc: -Bsymbolic: linker input file unused because linking not done エラーメッセージでぐぐったところ，オプションの-Bsymbolicを消して実行するとどうよ，というような事が書いてあった．\nMarkus Deuling - [rfc] testsuite/lib/gdb.exp: Enable additional linker flags in gdb_compi 書き換えればOK，って言われても困るわけでして…．\nで，もしかすると，オプションで上書きができるかなと思ってやってみると，偶然うまくいきました．\nただ，ログを見たら，同じようなエラーになっていて，結局何故通ったのかわからない，という，腑に落ちない結果となりました．\ncpanmのconfigure-argsオプション cpanmのconfigure-argsオプションは，configureの引数にしてくれる感じかなぁ，と思うのですが，ログを見る限りでは，どこで作用したのかわかりませんでした．\nまとめ 紆余曲折はありましたが，ひとまず目的は達成出来ました．\nさくらのレンタルサーバーは，gitこそ使えない（ソースからインストールすれば使えるらしいですが）ものの，sshでログインできて，Perlもビルドできて，CPANモジュールもインストールできるので，レンタルサーバーにしては恵まれた環境です．\nただ，これから環境を作るのであれば，VPSのほうが何かと安心できる，というのが本音ですね．\nレンタルサーバーだと，CGIとして動かすことになるので動作も遅いです．\nメンテナンスを考えても，動作環境を考えても，Perlでサービスを開発するのであれば，レンタルサーバーは選択肢からは外すのが賢明です．\nデプロイもサーバーがVPSなどであれば，cinnamonを使えば毎回同じように更新できますしね．\n","date":"2013-09-10T11:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/10/113000/","title":"さくらのレンタルサーバーにDBD::SQLiteをインストールできた話"},{"content":"@nqounetです．\n以前から契約しているさくらのレンタルサーバーには，すでにPerlbrewやPerlが入っているのですが，ログインシェルをbashに変えたせいなのかPerlbrewがうまく動かなくなってしまいました．\nおそらくSSLの関係だと思うのですが，install-cpanmやinstall-patchperlなどが動作しません．\n1 2 $ perlbrew install-patchperl ERROR: Failed to retrieve patchperl executable. 以前はちゃんと動作したと思うのですが．\nで，そのせいで新しくPerlをインストールすることもできなくなりました．\nうまくいった方法 1 2 cpanm Devel::PatchPerl perlbrew install --notest perl-5.16.3 -D=usethreads ログインシェルを何故変えたのか さくらのレンタルサーバーは，ログインシェルがcshになっています．\nそのせいかどうかはわかりませんが，cronでPerlのスクリプトがうまく実行できません．\nどうやってもPerlbrewで使っているPerlで動作しないのです．\nCGIのように，起動したいPerlを直接指定してもモジュールがない，と言われてしまいます．\nCGIでは起動できるので，モジュールがない，というエラーが発生するのが何故なのか，さっぱりわかりません．\nということで，短絡的ですがシェルを変更してみることにしたのです．\n予めbashの場所を確認しておいて，それを設定すれば良いので簡単ですね．\n1 2 3 $ which bash /usr/local/bin/bash $ chsh -s /usr/local/bin/bash パスワードを訊かれるので入力すればOKです．\nPerlbrewを入れてみる ここまで来たら，いつものようにPerlbrewのインストールなのですが，インストール中にpatchperlがインストールできなかった，というメッセージが．\nSSLが関係しているようなのですが，オプションの渡し方がわからなかったので，他の方法を探したところ，cpanmでDevel::PatchPerlをインストールする，ということでした．\nハッピーエンド（？） とりあえず，Perlはちゃんと入りましたが，今度はDBD::SQLiteで躓いてます…orz\nVPSのような環境に慣れすぎて，不自由な中での環境構築作業が激しく苦痛です．\n","date":"2013-09-10T10:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/10/100000/","title":"さくらのレンタルサーバー（FreeBSD 7.1-RELEASE-p16）にPerlbrewでPerlをインストールした話"},{"content":"@nqounetです．\nTLに流れてきて「はぁ？」って思ったので読んでみたらなにか変．\nドコモ、ビッグデータ販売へ…基地局機能活用 : ニュース : ネット＆デジタル : YOMIURI ONLINE（読売新聞） 基地局が収集するデータには、位置情報だけでなく契約者の携帯電話番号や生年月日などの個人情報も含まれる。解析するデータには性別、年齢、大まかな住所は含まれるが、その他の情報は加工して個人が特定できないようにする。\n記事にはこのように書いてあるのだが，ドコモのプレスリリースを読むと，電話番号や生年月日については何も書いていない．\n前半部分は紛らわしいのではないか？\nドコモからのお知らせ : モバイル空間統計の実用化および携帯電話ネットワークの運用データ利用について | お知らせ | NTTドコモ 「モバイル空間統計」は、携帯電話サービスをお客様に提供する過程で必要となる運用データの一部（携帯電話の位置データおよびお客様の年齢、性別、住所）に非識別化処理、集計処理、秘匿処理をドコモ内部で実行し作成する、お客様のプライバシー保護に配慮した統計情報です。場所や時間による人口の変動を推計することができます。 「モバイル空間統計」は個人の個々の情報ではなく集計された人口の数値であり、個人を識別できない情報です。お客様のご希望により運用データを「モバイル空間統計」から除外する「利用停止手続」を行うことも可能です。\nただ単に，そのエリアに何人がいて，その人達について男女比，年代ごとの人数，現住所（都道府県レベル？）ごとの人数が把握できる，ということじゃないの？\nこういう紛らわしい記事で，ビッグデータの未来が閉ざされるのは心外です．\n","date":"2013-09-09T14:18:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/09/141800/","title":"ドコモのビッグデータ販売についての記事はなんだか作為的"},{"content":"@nqounetです．\nジーニアスバーに行ってきましたが，ロジックボードが壊れているようで手の施しようがない（というか，修理に出さないといけない）ということでした．\n本当はすぐにでも修理に出したいところですが，残念ながら今月はYAPCもあるし，何かと入り用で…．\nしょうがないので，Macbookを徐々に自分仕様にしているのですが，意外と細かいところがちゃんとできていないので，その辺を忘れないうちにメモしておきます．\nzshのgit補完 いつもの様に使っていたら何か足りないな，と思っていたら，zshの補完が違うんですね．\ngitにも何か入れたような気がしたのですが，すっかり忘れていましたので，検索して見つけたものを試してみました．\nzshでgitのコマンドやブランチ名を補完できるようにする - QNYP Blog これじゃなかったような気もしますが，そのうち慣れるでしょう．\nautojump papixくんに教えてもらったautojumpも，いつの間にか癖になっているようで，うっかりcommand not foundになってしまったのでインストールしました．\nzsh使いなら効率改善のため知っておきたいAUTOJUMP - Glide Note - グライドノート 検索で出てきたこちらを参考にしましたが，本家のほうが更新されていて，少し内容が古くなっていました．\njoelthelion/autojump 私もソースから入れたのですが，インストール時の--zshオプションがなくなっていました．\n今やるとすれば，以下の様な感じになりますね．\n1 2 3 4 5 mkdir ~/src cd ~/src git clone git://github.com/joelthelion/autojump.git cd autojump sudo ./install.sh 試していませんが，インストールのコマンドには--localオプションもあるようです．\nともかく，インストールがうまくいくと，.zshrcに以下の行を加えるように指示があるのでそのとおりにします．\n1 [[ -s /etc/profile.d/autojump.zsh ]] \u0026amp;\u0026amp; . /etc/profile.d/autojump.zsh また，タブでの補完を使う場合には，以下の行も追加しておきます．\n1 autoload -U compinit \u0026amp;\u0026amp; compinit -u この行については，gitの補完にも出てきましたが，何度も必要ないので最後に実行されるようにしたほうがよさそうです．\nそこまでやるとターミナルを再起動して，いつもどおり使えるようになります．\nまとめ ターミナルのコマンドは補完を使うとマウスを使うよりも速くてストレスもありません．\nバリバリ仕事をして修理代（できれば新しいマシン代）を稼がなくては！\nというわけで，ウェブシステム等のご依頼をお待ちしております！\n","date":"2013-09-03T19:42:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/09/03/194200/","title":"追加で設定した諸々のこと"},{"content":"@nqounetです。\nメインで使っていたMacBookProが起動しなくなって、妻のお下がりMacBookで必死に環境を復元中です。\n明日、ジーニアスバーに行ってきます。復活してほしい…。\nということで、普段よく使っていて、これが無いとどうしようもないソフトだけでも記録しておきます。\nGoogle Chrome Chrome ブラウザ 当たり前すぎて困るのがこれです。\nこれがないとインターネットができません。\nSafariを使うのは、ほぼこの時だけです。\nGoogleアカウントでログインして使うと、拡張機能も自動的に復元されるので便利です。\nGoogle日本語入力 Google 日本語入力 Windowsをメインにしていた頃から使っています。\nこれを選んでいるのは慣れとしか言えませんが。\nことえり？ナンデスカソレハ\niTerm2 iTerm2 - Mac OS Terminal Replacement ターミナル（俗に言う黒い画面）は標準のものを使っても良いのですが、微妙な違いが使っていて気になってしまうので、こちらを使います。\nXtraFinder XtraFinder adds Tabs and features to Mac Finder. Finderの機能を拡張するソフトです。\nタブブラウザが当然のこの時代に、Finderをタブで管理できるのが良いですね。\nタブの切替をコマンド＋オプション＋右（左）に変更して使っています。（Chromeに合わせた）\n設定の「新規ターミナルで開く」も便利です。\nMou Mou - Markdown editor for web developers, on Mac OS X Markdownのエディタです。\n最近は、ドキュメントなどはほぼMarkdownで書いてから変換する、という風にしているので、これがないと文章が書けないです。\nブログもこれでプレビューしながら書いています。\nSublime Text 2 Sublime Text: The text editor you\u0026rsquo;ll fall in love with コードを書くときに使っています。\n似非プログラマなので、マウスがないとコーディングもできません。\n設定ファイルはgitでサーバーにバックアップしてあったのですぐに環境も復元できました。設定ファイルのバックアップが簡単なのが一番嬉しいですね。\nこれには「Package Control」を入れないと始まりません。\nInstallation - Package Control Dropbox, Copy Dropbox Install App :: Copy 簡単に言うと、自動的にバックアップしてくれるソフトです。\n保存先はクラウドなので、インターネットに接続していることが条件になります。\n以前は色々と試していましたが、最近はこの2つに落ち着きました。\nDropboxは家族との共有で、Copyは個人的なものやブログ用の画像置きに使っています。\nこんな記事も書きました。\nDropboxっぽいアプリ、「copy」を使ってみた - Kansai.pmで活動しているPerlプログラマのブログ 今回のような、万が一の時に力を発揮してくれます。本当にオススメです。\n下のリンクから登録すると、普通に登録するよりも少し容量が増えますのでお得ですよ。\nDropbox用 → http://db.tt/IOuF8DL Copy用 → https://copy.com?r=2zEy7L Xcode, gitなどなど あとは開発ツールです。\nXcodeについては、それ自体よりもコマンドラインツール群が必要です。\nそして、gitが無いとソースコードの管理ができません。\nPerlやRubyはもちろんのこと、開発用のテスト環境を作っているvagrantも必須です。あ、ということはvirtualboxもですね。\n以前はXAMPPを使っていましたが、仮想環境を手軽に構築できるので、使う機会がなくなりました。\nまとめ やはりバックアップが大事ですね。\nバックアップといえばメールですが、Gmailを使っているので特に困りません。\n突然壊れることを考えると、メールはウェブで十分だと思います。\nまた、Dropbox, Copyなどの自動バックアップツールは必須です。\n使ったことがない、という方は本当に使ってみてください。Dropboxは日本語なので英語はチョットという方でも使えるソフトですよ。\nDropbox用 → http://db.tt/IOuF8DL Copy用 → https://copy.com?r=2zEy7L gitはソースコードの管理だけでなく、サーバーにバックアップしておけるツールとしても重要です。\n今回、ちょっと落とし穴だったのは、gitで管理しないファイル（.gitignoreで設定できます）が抜けていたことです。\n本番用に反映させたくないものなどは管理から外しておくのですが、その復元がちょっと面倒でした。\n今思ったのは、データ用のディレクトリを、Copyのディレクトリ内へのシンボリックリンクにしておけば良さそうかな、ということです。\nこの機会に、見直してみたいと思います。\n","date":"2013-08-31T14:32:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/08/31/143200/","title":"これがないと何もできないと感じたソフトウェア for MacOSX"},{"content":"@nqounetです。\nパソコンで音楽を再生する機会というのは、それなりにあると思います。\n特に、一人で作業している時などは、ヘッドフォンをしながらということも多いです。\nこの前、iTunesで再生していたら、心なしかバッテリーの減りが速いとか、CPUの温度がいつもより高いとか、どうでもよいところが気になってしまいました（現実逃避）。\nで、なにか軽いプレイヤーがないものかと調べてみました。\nGoogle先生教えて ちょっと調べただけで、Voxというのが良いらしい、という意見が見つかったので試してみました。\n公式サイトはこちら。\nVox Music Player by Coppertino Inc. ソフトはAppStoreからダウンロードできます。\n10.7以降のみ対応ということなので、まだ新しいソフトなのかもしれません。\niTunesのプレイリストを読み込んで使える 起動してみると、VOX Playlistの文字が見えます。\nここをクリックすると、ミュージックソースの切り替えが可能で、iTunesの情報も読み込むことができます。\n早速読み込んでみましたが、ちゃんと日本語も表示されました。\nここで、ウィンドウの左下の部分をクリックすると、プレイリストも選ぶことが出来ます。\n設定を見ると、起動する毎に更新するようにできるので、常に最新の状態に保つことができます。\nなかなか嬉しいですね。\nLast.fmにネイティブに対応 設定でもう一つ重要な事が。\nあのLast.fmへ、再生している曲の情報を送信することができます。\n設定も簡単です。\nLast.fmにログインしている状態で、Authorizeボタンをクリックすると、認証するかどうか確認されますので、了承すると認証が完了します。\nあとは、再生するだけでscrobbleされます。\niTunesの場合は別途scrobblerを起動しておく必要があるので、その辺りも嬉しいですね。\nHome – Last.fm しばらくは、このプレイヤーを使っていくことになりそうです。\n","date":"2013-08-31T10:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/08/31/100000/","title":"軽くて音も良いという噂のVoxを使ってみたら結構良かった件"},{"content":"@nqounetです。\nvagrantでchefを使って色々頑張っていたりするわけですが、疲れました。\n同じ仮想環境で良ければ、ひとつ作ったものを使い回せば良い、ということに、最近ようやく気づきました。\n仮想環境を自分自身で再利用する Vagrantのboxを使う時は、元になる仮想マシン（box）がローカルに保存されます。\n色々と試していたら、結構な数になっているかもしれません。\n保存されているboxはvagrant box listで見ることが出来ます。\n1 2 3 4 5 6 7 $ vagrant box list Berkshelf-CentOS-6.3-x86_64-minimal (virtualbox) CentOS-6.4-i386-plenv (virtualbox) CentOS-6.4-x86_64-plenv (virtualbox) base (virtualbox) base64 (virtualbox) centos64_64 (virtualbox) ここにあるboxは、Vagrantfileでbox_urlを指定しなくても利用できます。\n自分自身で使うだけなら、このリストに登録（ローカルに保存）しておけば良い、ということです。\nそれをするには、vagrant packageを使います。\n1 2 3 4 5 6 $ vagrant package [default] Attempting graceful shutdown of VM... [default] Clearing any previously set forwarded ports... [default] Creating temporary directory for export... [default] Exporting VM... [default] Compressing package to: /Users/nobu/sandbox/vm-plenv/package.box そうすると、カレントディレクトリにpackage.boxという名前で、現在のVMが保存されます。\nあとは、それをvagrant box addで名前をつけて追加してやれば良いです。\n1 $ vagrant box add new-box package.box こうすると、先ほどのVMがnew-boxという名前で保存され、vagrantから手軽に使えるようになります。\n1 2 3 4 $ mkdir ~/vagrant-new-box \u0026amp;\u0026amp; cd ~/vagrant-new-box $ vagrant init new-box $ vagrant up $ vagrant ssh ","date":"2013-08-30T11:34:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/08/30/113400/","title":"Vagrantで作った仮想環境を保存しておく"},{"content":"@nqounetです。\n最近，rubyで作られたツールを使うことも多くなってきたので，改めてrubyの環境を構築することにしました．\nwkpdfのように，OSXのシステムに依存しているツールもあるので，使うrubyを手軽に変更できるのは良いですね．\nrbenv，ruby-buildをインストールする 1 2 3 4 5 git clone https://github.com/sstephenson/rbenv.git ~/.rbenv echo \u0026#39;export PATH=\u0026#34;$HOME/.rbenv/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bash_profile echo \u0026#39;eval \u0026#34;$(rbenv init -)\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bash_profile exec $SHELL -l git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build ruby-buildを入れたrbenvの簡単な使い方 インストールできるrubyのバージョンを調べる 1 rbenv install --list rubyをインストールする 1 rbenv install 2.0.0-p247 情報を再構築する（rubyをインストールした後などに必要） 1 rbenv rehash インストールしているrubyを確認する 1 rbenv versions 通常使うrubyを設定する 1 rbenv global 2.0.0-p247 そのディレクトリで使うrubyを設定する 1 rbenv local system gemはどうやって入れるのだろう？ …と思って検索していたのですが，rubyをインストールすると（？）勝手に使えるようになっていました．\nPerlの話になると，cpanコマンドではなく，App::cpanminusを追加でインストール（plenvでもperlbrewでも，install-cpanmというコマンドがある）してcpanmコマンドを使うことがほとんどなので，勝手に使えるのが新鮮に感じました．\n","date":"2013-08-29T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/08/29/083000/","title":"今更rbenvでrubyを管理してみる"},{"content":"@nqounetです。\nmarkdownで書いたドキュメントを加工するのに色々と調べているのですが、その過程でwkpdfというツールを発見したので使ってみました。\n少し引っかかったので備忘録。\n結論 wkpdfを使うときは、systemのrubyを使う必要がある\nインストール rbenvでインストール済みのrubyで使おうと思ったらエラーになった。\n1 2 3 4 Cannot load RubyCocoa library wkpdf requires that RubyCocoa is installed, which is shipped by default since Mac OS X 10.5. If you use Mac OS X 10.4, you have to install RubyCocoa yourself from http://rubycocoa.sourceforge.net/HomePage google先生助けて 調べてみると、rbenvの人が親切に答えていた。\nrbenv and wkpdf · Issue #270 · sstephenson/rbenv ざっくり言うと、wkpdfはsystemのrubyを使え、ということでした。\n1 2 3 RBENV_VERSION=system gem install wkpdf rbenv rehash RBENV_VERSION=system wkpdf いちいちRBENV_VERSIONなんて指定してられないので、wkpdf用にディレクトリを作って、その中で実行するようにした。\n1 2 3 4 5 6 7 8 % cd ~ % mkdir wkpdf % cd wkpdf % rbenv local system % sudo gem install wkpdf % rbenv rehash % wkpdf --source http://www.apple.com --output apple.pdf % open apple.pdf 色々と欠けていたけど、とりあえず使えるようになったので色々と試してみようと思います。\n","date":"2013-08-28T15:49:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/08/28/154900/","title":"MacOSXでwkpdfを使ってみた"},{"content":"@nqounetです。\n気がついたらPerlのビルドにいつも失敗するようになっていました。\nで、検索するといつも同じ所にたどり着くのです。\n$GREP_OPTIONSが原因でperlのビルドが失敗した件 - masasuzu 技術メモ $GREP_OPTIONSを一時的に無効にすれば解決するのですが、色々なところからzshの設定を拝借していて、よくわかっていないオプションもあります。\nこの際そこの所を解決しようというわけです。\n何が悪かったか どのオプションが悪かったかというと、\n```default ### 拡張子が.tmpのファイルは無視する。 GREP_OPTIONS=\u0026quot;\u0026ndash;exclude=\\*.tmp $GREP_OPTIONS\u0026quot; ```\nズバリこれでした。\nこれを削除することで安心してPerlをビルドすることが出来ました。\n","date":"2013-07-27T14:05:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/07/27/140500/","title":"Perlのビルドに何度も失敗するので$GREP_OPTIONSを見なおした"},{"content":"@nqounetです。 結構前に@__papix__さんから教えてもらったvagrantですが、ふとした切っ掛けで、もう少し本格的に使いたいと思いはじめました。 ちなみに、「ベイグラント」と聞いてこれを思い出しました。 まあ、それは置いておいて。 vagrantで開発環境の自動構築というと、chef-soloの情報が多いと思う（というか、chefだけだと思っていました）のですが、今回はshellでやってみた事を書いてみます。\nその前にvagrantをインストール Vagrant - Downloadsからダウンロードしてインストールするだけです。 OSXならdmgファイルを、Windowsならmsiファイルを選びます。\nまずはshellでやってみた Vagrantfile\n1 2 3 4 5 6 7 Vagrant.configure(\u0026#34;2\u0026#34;) do |config| config.vm.box = \u0026#34;centos64_64\u0026#34; config.vm.box_url = \u0026#34;http://developer.nrel.gov/downloads/vagrant-boxes/CentOS-6.4-x86_64-v20130427.box\u0026#34; config.vm.network :private_network, type: :dhcp config.vm.hostname = \u0026#34;vm-perlbrew\u0026#34; config.vm.provision :shell, :path =\u0026gt; \u0026#34;bootstrap.sh\u0026#34; end このようにすると、Vagrantfileと同じディレクトリにあるbootstrap.shを自動的に実行してくれます。 今回調べていて知ったのですが、private_networkではこの例のようにDHCPを使って自動的にIPアドレスを割り当てるようにする事ができます。 これまではいちいちIPアドレスを重ならないように設定（重なると起動できない）していたのですが、これで変更する箇所が減って大分楽になりました。\nadded dhcp configuration option for private networks by janschumann · Pull Request #1466 · mitchellh/vagrant bootstrap.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/usr/bin/env bash # run once if ! [ -f \u0026#34;$HOME/perl5/perlbrew/etc/bashrc\u0026#34; ]; then # install Perlbrew curl -L http://install.perlbrew.pl | bash echo \u0026#39;source ~/perl5/perlbrew/etc/bashrc\u0026#39; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc # install Perl perlbrew install 5.16.3 perlbrew switch 5.16.3 # install App::cpanminus (cpanm) curl -L http://cpanmin.us | perl - App::cpanminus fi yum install -y git mysql-devel cpanm DBD::mysql Data::Model あちこちのブログでは、yumなどにsudoを付けて実行していましたが、そのような必要はありませんでした。 少なくとも「Vagrant version 1.2.2」では、rootとして実行されています。 で、これら2つのファイルを同じディレクトリに置いて、そのディレクトリで以下のようにコマンドを入力します。\n1 vagrant up 上手く行けばPerlのビルドまで実行されるので、結構時間がかかります。 構築が終わったら、仮想マシンにログインします。\n1 vagrant ssh これで、先ほど作成したマシンにログインできます。 初期ユーザーはvagrantです。 で、先ほどのスクリプトはroot権限なので、rootに変わってからPerlがインストール出来ているか確認してみます。\n1 sudo su - これでrootになれましたので、続けてPerlのバージョンを見てみます。\n1 perl -V 結果は以下のとおり、上手くいっています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 Summary of my perl5 (revision 5 version 16 subversion 3) configuration: Platform: osname=linux, osvers=2.6.32-358.el6.x86_64, archname=x86_64-linux uname=\u0026#39;linux vm-perlbrew 2.6.32-358.el6.x86_64 #1 smp fri feb 22 00:31:26 utc 2013 x86_64 x86_64 x86_64 gnulinux \u0026#39; config_args=\u0026#39;-de -Dprefix=/root/perl5/perlbrew/perls/perl-5.16.3 -Aeval:scriptdir=/root/perl5/perlbrew/perls/perl-5.16.3/bin\u0026#39; hint=recommended, useposix=true, d_sigaction=define useithreads=undef, usemultiplicity=undef useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef use64bitint=define, use64bitall=define, uselongdouble=undef usemymalloc=n, bincompat5005=undef Compiler: cc=\u0026#39;cc\u0026#39;, ccflags =\u0026#39;-fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64\u0026#39;, optimize=\u0026#39;-O2\u0026#39;, cppflags=\u0026#39;-fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include\u0026#39; ccversion=\u0026#39;\u0026#39;, gccversion=\u0026#39;4.4.7 20120313 (Red Hat 4.4.7-3)\u0026#39;, gccosandvers=\u0026#39;\u0026#39; intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678 d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16 ivtype=\u0026#39;long\u0026#39;, ivsize=8, nvtype=\u0026#39;double\u0026#39;, nvsize=8, Off_t=\u0026#39;off_t\u0026#39;, lseeksize=8 alignbytes=8, prototype=define Linker and Libraries: ld=\u0026#39;cc\u0026#39;, ldflags =\u0026#39; -fstack-protector -L/usr/local/lib\u0026#39; libpth=/usr/local/lib /lib/../lib64 /usr/lib/../lib64 /lib /usr/lib /lib64 /usr/lib64 /usr/local/lib64 libs=-lnsl -ldl -lm -lcrypt -lutil -lc perllibs=-lnsl -ldl -lm -lcrypt -lutil -lc libc=, so=so, useshrplib=false, libperl=libperl.a gnulibc_version=\u0026#39;2.12\u0026#39; Dynamic Linking: dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=\u0026#39;-Wl,-E\u0026#39; cccdlflags=\u0026#39;-fPIC\u0026#39;, lddlflags=\u0026#39;-shared -O2 -L/usr/local/lib -fstack-protector\u0026#39; Characteristics of this binary (from libperl): Compile-time options: HAS_TIMES PERLIO_LAYERS PERL_DONT_CREATE_GVSV PERL_MALLOC_WRAP PERL_PRESERVE_IVUV USE_64_BIT_ALL USE_64_BIT_INT USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF Built under linux Compiled at Jul 24 2013 17:17:04 %ENV: PERLBREW_BASHRC_VERSION=\u0026#34;0.64\u0026#34; PERLBREW_HOME=\u0026#34;/root/.perlbrew\u0026#34; PERLBREW_MANPATH=\u0026#34;/root/perl5/perlbrew/perls/perl-5.16.3/man\u0026#34; PERLBREW_PATH=\u0026#34;/root/perl5/perlbrew/bin:/root/perl5/perlbrew/perls/perl-5.16.3/bin\u0026#34; PERLBREW_PERL=\u0026#34;perl-5.16.3\u0026#34; PERLBREW_ROOT=\u0026#34;/root/perl5/perlbrew\u0026#34; PERLBREW_VERSION=\u0026#34;0.64\u0026#34; @INC: /root/perl5/perlbrew/perls/perl-5.16.3/lib/site_perl/5.16.3/x86_64-linux /root/perl5/perlbrew/perls/perl-5.16.3/lib/site_perl/5.16.3 /root/perl5/perlbrew/perls/perl-5.16.3/lib/5.16.3/x86_64-linux /root/perl5/perlbrew/perls/perl-5.16.3/lib/5.16.3 . とりあえず出来た感想 Perlbrewからcpanminusまでのインストール一式を、Perlbrewのファイルの存在で判定するのは微妙かもしれませんが、とりあえずこれはこれで良しとします。 ちなみに、DBD::mysqlを指定しているのは、MAMPが稼働中のOSXにこれがインストールできなくて泣いたからです。 とりあえず、DBD::mysqlがインストールできるかどうかを一つの指標にしていましたので、この結果は満足の行くものでした。 この調子で、今度はchef-soloで色々とやってみたいですね。\nSEE ALSO Vagrant Vagrant Documentation ","date":"2013-07-25T08:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/07/25/080000/","title":"vagrantで開発環境を自動的に作成する"},{"content":"@nqounetです。\n昨日、京都に行ってきました。\n祇園祭ではなく、Kyoto.pmです。\n雨降ってる！ 京都に着いたら雨だった。\n大阪は暑苦しいほどの晴天だったのに。\n会場のはてなさんに着いたらずぶ濡れだった。\nClutchのそこが聴きたかった 今回はJPAからnekokakさんが派遣されてくるということで、参加の申し込みの際のアンケートに「Clutchの使いドコロを聴きたい」と書いていたのですが、ズバリClutchの話だったので、スライドのタイトルを見ただけでこんな感じ。\nClutchだ！ #kyotopm — Nobutaka Wakabayashi (@nqounet) July 13, 2013\nLTの資料ができてなかったけど、ガッツリ聴きました。\nJob QueueとMessage Queueの違いは知らなかったので勉強になりました。ざっくり言うと、レスポンスを期待するのがJob Queue、しないのがMessage Queueです。\nClutchは基本的にJob Queueですが、request_backgroundを使うとMessage Queueのように動作するようになっています。\nTech Talks LTの資料を作りながらだったのでおぼろげな記憶ですが、他に面白そうというか使ってみたいと思ったのは、GitDDL、Exception::Tinyです。\n振り返ってみると全然聴いてなかった感じですね。\nLTしました nekokakさんが来るということで、Qudoを使ったものがあったので、そのネタを発表しました。\n「Perlで小銭稼ぎ」という感じのタイトルですが、中身が中身なので公開はしません。\n内容はかなり絞ったはずでしたが、時間がギリギリでした。もう少しProclet::Declareについて説明できるかと思っていたのですが、やはりマイクを持ちながらデモをするのは大変ですよね。マイクを持ってもらって、なんとか上手くいきました。ありがとうございます。\n懇親会！ LTが終わったあとは懇親会！\nピザを待ちつつみんなで乾杯！\n月並みだけど、色々な方とお話できて良かった。\n特にnekokakさんと、Qudoの意外な開発経緯とか、Clutchの疑問について直接話ができたりしたのが良かった。\nrequest_backgroundの謎が解けた 実は結構前にClutchを使って実験をしていて、request_backgroundしても処理が返ってこないのがわからなくて放置していました。\nその件を懇親会でnekokakさんに直接話してみました。\n期待通りに動かない私のスクリプトを見せたところ、workerの数がrequestの数よりも少ない場合は、workerの処理が終わるまで次のrequestが処理されない、ということがわかりました。\nmax_workersの値を増やして実行すると処理が一瞬で返ってきました。\nClutchはworkerを沢山作ってrequest_multiで一気に並列処理する、という感じで使うのが良さそうですね。\nまとめ Kyoto.pm良かった！\nSEE ALSO Clutch - search.cpan.org Proclet::Declare - search.cpan.org ","date":"2013-07-14T18:13:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/07/14/181300/","title":"「Kyoto.pm 05 Tech Talks」でLTしてきました"},{"content":"@nqounetです。\nタイトルを変更しました 2013年6月25日で新大阪コワーキングを閉めました。\nこのままだとタイトルが嘘になってしまうので変更しました。\n","date":"2013-06-26T13:32:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/06/26/133200/","title":"タイトルを変更しました"},{"content":"git diff でとった差分はこちらです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 diff --git a/app/controllers/milestones\\_controller.rb b/app/controllers/milestones\\_controller.rb index 25647f9..1b3d11b 100644 --- a/app/controllers/milestones\\_controller.rb +++ b/app/controllers/milestones\\_controller.rb @@ -12,9 +12,9 @@ class MilestonesController \u0026amp;lt; ProjectResourceController def index @milestones = case params\\[:f] -when \u0026#39;all\u0026#39;; @project.milestones.order(\u0026#34;state, due\\_date DESC\u0026#34;) +when \u0026#39;all\u0026#39;; @project.milestones.order(\u0026#34;state, due\\_date ASC\u0026#34;) when \u0026#39;closed\u0026#39;; @project.milestones.closed.order(\u0026#34;due\\_date DESC\u0026#34;) -else @project.milestones.active.order(\u0026#34;due\\_date DESC\u0026#34;) +else @project.milestones.active.order(\u0026#34;due\\_date ASC\u0026#34;) end @milestones = @milestones.includes(:project) diff --git a/app/helpers/issues\\_helper.rb b/app/helpers/issues\\_helper.rb index dc5aa6e..33a1cca 100644 --- a/app/helpers/issues\\_helper.rb +++ b/app/helpers/issues\\_helper.rb @@ -29,7 +29,7 @@ module IssuesHelper end def issues\\_active\\_milestones -@project.milestones.active.order(\u0026#34;id desc\u0026#34;).all +@project.milestones.active.order(\u0026#34;due\\_date ASC\u0026#34;).all end def url\\_for\\_project\\_issues GitlabのIssuesは使えますよ GitlabのIssuesは、シンプルなプロジェクト管理機能です。 ざっくりと私の使い方を書いてみます。 そのプロジェクトでやるべき事をIssueとしてどんどん登録していきます。 基本的には、このIssueをどんどん消化していくのですが、優先順位をおおまかに決めておく必要があります。 それを決めるのに便利なのがMilestonesです。 Milestoneは、Issueをグループ化でき、かつ締め切りを設定できるので、優先順位でグループ化して使うことができます。 大体一週間程度毎に締め切りを作って、どんな感じになっているかを想像しながら登録していきます。 登録したらIssueの画面に戻り、最初の締め切り（Milestone）に含めるIssueを選択してから、「Update selected issues with」の部分の「Milestone」から最初の締め切りを選んで「Save」します。 これを繰り返すことで、全てのIssueがMilestoneとひも付けされて、Milestoneの締め切り順で並んでいると、今何をするべきなのかが一目瞭然、という具合です。\nここで問題発生！ GitlabでIssueやMilestoneを登録していて気づいたのですが、Milestonesの並び方がイマイチなのです。 締め切りが遠い順に並んでいて、非常に気持ち悪い。 それと、「Update selected issues with」のMilestonesのドロップダウンの並び順が、Milestonesで見るのと違うので、多くなってくると見失ってしまいます。 このへんの並び順をどうにかしたいと思って、ソースを調べてみたら、意外と簡単そうだったのでやってみました。 直接ソースコードを触るのですが、事前にブランチを作成してその中で完結するようにやってみました。\nとりあえずMilestonesは満足！！ 締め切りが近い順に並んだことで満足です。\nGitLab(http://farm4.staticflickr.com/3794/9109976374_c2cdf3ac96.jpg)\n終了したMilestonesがどのように並べばいいのか思いつかないので、それはあえてそのままにしました。\n次はIssues！？ 一つ解決するともう一つ…って思いますよね。 Issuesの並び順もどうにかしたいですね。\n","date":"2013-06-23T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/06/23/083000/","title":"Gitlabでmilestonesの並び方が不満なので変更した"},{"content":"大きな理由 「Turbolink機能」に惹かれました。 結果としては期待しすぎた感じでしたが、転送量は確実に減っているので、アップデートする価値はあります。\nきっかけ 今日、新大阪コワーキングに来た方と話していて、gitlabが5.2になっている、という話を聞きました。 調べてみると、どうやら最新版はここ数日内で5.3になっていたようです。\nhttps://github.com/gitlabhq/gitlabhq/tree/master/doc/update\nさくらのVPSにインストールしていたのは5.1だった さくらのVPSにインストールしてすぐにバージョンアップさせた記憶があったのですが、確認してみると5.1でした。 最初にインストールしたのが5.0だったので、そんなものでしょうか。 それはともかく、5.2ではページ遷移が高速化したという話なのでアップデートすることにしました。\nそれ以外にもこんな感じのアップデートらしいです。\nGitLab 5.2は4月に公開されたバージョン5.1に続く最新版。新機能としては、ほかのリポジトリからのフォーク機能やプロジェクト内のコードを検索できるコード検索機能が加わっている。リクエストがページを再読み込みしないことで高速化を図るTurbolink機能も加わった。\n[Gitリポジトリ管理ツール「GitLab 5.2」リリース、フォーク機能などを追加 | SourceForge.JP Magazine]\nアップデート作業 アップデートは細かい手順書があるのでそちらを参考にします。\nhttps://github.com/gitlabhq/gitlabhq/blob/master/doc/update/5.1-to-5.2.md\n5.0から5.1にアップロードする際も、公式のドキュメントが一番わかり易かった記憶があります。 設定ファイル以外は書いてあるコマンドをそのまま打ち込みます。 設定ファイルは、5.1以降で追加された部分をチェックするようにしました。\ngitlab.ymlの変更 gitlab.yml 40行目あたりからの\n1 2 3 4 5 6 7 ## Default project features settings default_projects_features: issues: true merge_requests: true wiki: true wall: false snippets: false この部分と、同じく162行目あたりからの\n1 2 3 4 5 6 7 8 extra: ## Google analytics. Uncomment if you want it # google_analytics_id: \u0026#39;_your_tracking_id\u0026#39; ## Text under sign-in page (Markdown enabled) # sign_in_text: | # ![Company Logo](http://www.companydomain.com/logo.png) # [Learn more about CompanyName](http://www.companydomain.com/) こちらの部分が追加になっていました。 先の「default_projects_features」は、新しくリポジトリを作成した時に、SettingできるFeaturesの初期値です。 ほとんどのリポジトリではこれらの機能は使わないので、全部falseにしました。 後半の「extra」には、google analyticsのID指定や、サインインの画面のテキストが設定できるようですが、使っていないので詳細は不明です。\npuma.rbの変更 こちらは5.1から特に変更になった部分はありませんでした。\n/etc/init.d/gitlabの変更 新しい起動スクリプトがあるようなのでそれをそのまま使ったのですが、ソケットを削除するコマンドでエラーが出るのでその部分だけはコメントにしました。 起動自体は問題ないので、エラー表示が気にならないようであればそのままでも問題ないと思います。\nGitlabを使うようになった経緯 Issuesは、簡単なチケット管理システムです。 これがあったので、Alminiumを止めてgitlabを使うようになりました。 Alminiumは、インストールは簡単なのですが、アップデートがよくわからないのと、いつの間にかpush時にエラーが出る（push自体はできていますが、正常終了できない）ようになってしまって、サーバーのログを見たり、色々検索してみたりしたのですが、解決の糸口もつかめませんでした。 丁度そのころGitprepを見つけたのでそれも考えました。 インストールして試してみましたが、動作も軽快なので、Gitのリポジトリが欲しいならとても良い選択肢だと思います。 何と言ってもPerlで書かれていますし。 …ただ私にとっては、プロジェクト管理機能が必要だったのです。 そして、Gitlabを知って、今に至る。という感じです。\nコミットログに一工夫するだけでも便利に使える コミットのログに「#チケット番号」と書いておくと、そのチケットへのリンクが張られるので、後から確認するのも便利です。 git-flowとの相性も良いと思います。\ngit-flowのテストをやってみた\nこのへんの運用というか使い方の話は、ガッツリ使っている方に聞いてみたいところですね。 色々便利な方法があるんじゃないかと思っています。 ちなみに、私はfeatureのprefixを入力する際に「feature/\\#」としています。 入力が1文字減るだけですが、チケット番号だけで済むのはなかなか良いと思いますよ。 ## 5.2になりました さて、期待していたTurbolinkについては、劇的な体感はありませんでしたが、少し速くなった感じはします。 ただし転送量は大分違う（1/3くらい？）ので、転送量を減らしたい場合はかなり有効だと思います。 ただ、発生条件はよくわかりませんが、ある程度の時間放置していると上手くリンクしない現象が起きています。 詳しくは見ていませんが、JavaScriptのエラーが出ていました。 その辺は最新版に期待したいところです。\nバージョンはHelpを見ればわかります 最初に戻りますが、話をしている間、現在のバージョンが何だったかを調べていたのですが、簡単に調べられる方法があったのをすっかり忘れていました。 Helpを見ればそこにバージョンが書いてあります。\nこんなところにあったなんて！\nGitlabは便利なツールです インストールした時には、ここまで使えるとは思っていませんでした。 今は、手元に保管（放置？）していたファイルはすべてGitlabで管理しています。 Issuesもシンプルですが、機能としては十分すぎるほどです。 プライベートなプロジェクトを管理するのであれば、試してみる価値はありますよ。\n","date":"2013-06-22T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/06/22/083000/","title":"Gitlabを（まずは）5.1から5.2にアップデートした愛すべき理由"},{"content":"言いたいこと 画面（ターミナル）からの入力は「改行」が入っているので、 chomp してから使いましょう。\n画面（ターミナル）から文字を入力する 画面（ターミナル）から文字を入力するには、 \u0026lt;STDIN\u0026gt; を使います。\n1 2 my $x = \u0026lt;STDIN\u0026gt;; print $x; 実行すると、画面が止まってしまいますが、何が文字を入力して改行を押すと、入力した文字列がそのまま表示されると思います。\n改行はわかりづらい Perl入学式では、画面（ターミナル）からの入力値を計算するプログラムをサンプルで作ったりしていますが、画面からの入力には「改行」が含まれています。\n1 2 3 4 my $x = \u0026lt;STDIN\u0026gt;; my $y = \u0026lt;STDIN\u0026gt;; print \u0026#34;$x - $y = \u0026#34;; print $x - $y; 計算式を表示しようとして、これを実行すると、\n1 2 3 4 5 5[改行]（この行は入力） 1[改行]（この行は入力） 5 - 1 = 4 このように、改行が入って変な感じになってしまいます。\n改行を削除するにはchompを使う この改行を取り除くには、 chomp を使います。\n1 2 3 4 5 6 my $x = \u0026lt;STDIN\u0026gt;; chomp($x); my $y = \u0026lt;STDIN\u0026gt;; chomp($y); print \u0026#34;$x - $y = \u0026#34;; print $x - $y; 実行結果は以下のとおり。\n1 2 3 5[改行]（この行は入力） 1[改行]（この行は入力） 5 - 1 = 4 ちゃんと改行が取り除かれています。\nchompを使うときに注意すること 慣れてくると、変数に代入すると同時に改行を削除しようとして、こんな感じにやりたくなるんじゃないかと思います。\n1 2 3 4 my $x = chomp(\u0026lt;STDIN\u0026gt;); my $y = chomp(\u0026lt;STDIN\u0026gt;); print \u0026#34;$x - $y = \u0026#34;; print $x - $y; しかし、実行しようとするとエラーに。\n1 2 Can\u0026#39;t modify \u0026lt;HANDLE\u0026gt; in chomp at stdin.pl line 5, near \u0026#34;\u0026lt;STDIN\u0026gt;)\u0026#34; Execution of stdin.pl aborted due to compilation errors. これは、 chomp が渡された値（引数）自体を変更してしまうためです。\nchomp は引数の改行を削除して値を返す関数ではなく、引数そのものを変更します。\n代入と同時に改行を削除したい場合は、以下のように書くと良いです。\n1 2 3 4 chomp(my $x = \u0026lt;STDIN\u0026gt;); chomp(my $y = \u0026lt;STDIN\u0026gt;); print \u0026#34;$x - $y = \u0026#34;; print $x - $y; 画面からの入力はchompで処理しましょう 画面から \u0026lt;STDIN\u0026gt; で入力する時は、入力値に改行も含まれるので、 chomp で改行を取り除くようにしましょう。\n","date":"2013-06-19T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/06/19/083000/","title":"Perlで画面から入力された値を使うには？"},{"content":"言いたいこと Perl5.8以降であればScalar::Utilの「looks_like_number」を使えば良いです。\n数字かどうか判別したい Perl入学式でもよく質問されました。 特に数値かどうかを判定したい、というのが多かったように思います。\n「未定義」を計算させてみる 初期化されていない変数は未定義の状態になっています。\n例えばこんな感じで未定義の変数を引き算すると、\n1 2 3 4 5 6 7 8 #!/usr/bin/env perl use strict; use warnings; my $x; my $y; print $x - $y; こんな警告が出ます。\n1 2 3 Use of uninitialized value $y in subtraction (-) at warnings.pl line 8. Use of uninitialized value $x in subtraction (-) at warnings.pl line 8. 0 今の場合、未定義の変数を「0」として扱っているので、計算結果としては「0 - 0」となり、表示は「0」になります。\nしかし、「use warnings」をしていると、未定義の変数を引き算しようとしていますよ、という警告が出ます。\n文字列を計算させてみる また、文字列を計算しようとしても警告が出ます。\n1 2 3 4 5 6 7 8 #!/usr/bin/env perl use strict; use warnings; my $x; my $y = \u0026#39;1e\u0026#39;; print $x - $y; この場合、以下のような警告が出ます。\n1 2 3 Argument \u0026#34;1e\u0026#34; isn\u0026#39;t numeric in subtraction (-) at warnings.pl line 8. Use of uninitialized value $x in subtraction (-) at warnings.pl line 8. -1 この例の場合は「1e」を「1」として計算していますが、「1e」は数字じゃない、という警告が出ています。\n何が問題か コードの中で代入する場合はこのような問題は起きないと思います。\nしかし、サブルーチンで渡される引数やユーザーからの入力が適切かどうかはわかりませんので、思わぬエラーを防ぐためにも想定している値なのかを確認しておくのが良いでしょう。\n相手（今の場合はユーザーやサブルーチンを使う側）がどのような行動をするのかを見守るだけでなく、プログラム側から正しい入力を求めるようにする姿勢も大事ではないでしょうか？\nlooks_like_numberで判定する Perlのバージョン5.8以降であれば、Scalar::Utilが標準で使えるのでlooks_like_numberを使うと数値の判定が簡単です。\nコードを見てもわかりやすくて良いですね。\n以下のプログラムは、数値を入力するまで終了しません。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/usr/bin/env perl use strict; use warnings; use Scalar::Util qw(looks_like_number); my $x; while (1) { print \u0026#34;数値を入力してください \u0026gt;\u0026gt;\u0026gt; \u0026#34;; $x = \u0026lt;STDIN\u0026gt;; chomp $x; last if want_number($x); } print qq{入力された数値は `$x` です}; exit; sub want_number { my ($args) = @_; return 1 if looks_like_number($args); print \u0026#34;エラー：数値ではありません！\\n\u0026#34;; return; } このプログラムで定義したwant_numberは渡された値が数値であれば真、数値でなければ偽を返します。\n数値を判定するならlooks_like_numberを使おう looks_like_numberに限らず、Perlには標準モジュールにも便利なものがあるので、積極的に使うと良いと思います。\n","date":"2013-06-17T08:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/06/17/083000/","title":"looks_like_number（Scalar::Util）で数字を判定する"},{"content":"@nqounetです。\nGitPrepというgithubのクローンを試してみました。\n作者のインストール解説記事はレンタルサーバー向けということで、VPSにインストールしてみたい私としては、リポジトリの方を参考にしました。\nザックリみたところ、Mojoliciousを使ったシステムのようなので、細かい部分はドキュメントにしばられないようにやってみました。\nVPSにGitPrepをインストール とりあえず、任意のディレクトリに移動して、githubのリポジトリからソースコードを取ってきます。\n```default git clone git://github.com/yuki-kimoto/gitprep.git ```\nそのディレクトリ内に「gitprep」ができるので、そちらに移動し、セットアップスクリプトを実行。\n```default cd gitprep ./setup.sh ```\nここで動かそうとしてみると、モジュールが足りないと怒られたので、追加でインストール。\n```default cpanm Mojolicious::Plugin::INIConfig cpanm Mojolicious::Plugin::AutoRoute cpanm DBIx::Connector ```\ngitprep.confを開いて「Git command path」を適切に設定。\nとりあえず、動くかどうかを試してみる。\n```default morbo script/gitprep ```\n動くのが確認できたら、nginxとhypnotoadのポート番号を適切に設定すればOK。\n画面はこんなかんじです。\nちょっと使ってみた感想 レイアウトがよく似ているので、使えば使うほど欲が出てきそうです。\n例えば、表示するブランチの切替をブランチ名を表示しているボタンの方からやりたい、とか、リポジトリのURLはテキストボックスを選択すると全体が選択された状態になってほしい、とか。\nかなり無理をしているサーバーで試したのですが、動作が軽いので驚きました。\nこの手軽さは良いですね。\nSEE ALSO GitPrep - Githubのクローン。ポータブルなGithubシステムをUnix/Linuxにインストール - サンプルコードによるPerl入門 ","date":"2013-04-23T20:04:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/04/23/200400/","title":"GitPrepを動かしてみた"},{"content":"@nqounetです。\n「copy」というオンラインストレージアプリが出たということで、簡単に使ってみました。\nひとことで言うと、共有するのが簡単で、共有を止めるのが大変なアプリです。\nDropboxって何？ Dropbox使っていますか？\n私は使っています。\nDropboxは、インターネットがつながっている時に、手元のファイルをオンライン上にあるストレージ（ハードディスクみたいなものと思ってください）にも保管（同期）してくれます。\nざっくり言うと「自動的にバックアップをしてくれるアプリ」だと思って大丈夫です。\nDropboxは、無料で2GB使えるのですが、使いはじめると2GBだと物足りなく思ってくるんですよね。\nもちろん有料の契約をすれば100GBでも500GBでも使えるのですが。\nちなみに、使ってみたい場合はこちらから登録すると、アナタ（と私）の容量が少しだけ増えますよ。\nhttp://db.tt/IOuF8DL copy それで、「copy」の方ですが、このアプリは現在キャンペーンをしていて、以下のURLから登録すると、アナタ（と私）に5GBの容量がプレゼントされます。\nhttps://copy.com?r=2zEy7L 最初から5GBが使えて、かつ、上のリンクから登録すると5GB増えるということで、10GBが最初から使えます。\n適当にファイルを作ってみました。\nアイコンはちょっと寂しい感じですが、同期が終わっているかどうかはひと目で分かりますね。\nシェアします この「copy」は、共有することが簡単にできるようになっているようです。\nMacの場合ですが、Finderからファイルを右クリック（二本指でタップ）して「Copy Actions」から「Copy Public Link\u0026hellip;」を選択するだけです。\nあとは、それをTwitterやFacebookでつぶやけばOK。\n共有する、という意識をしなくても共有出来ます。\n写真は直接HTMLに埋め込むこともできるようです。（Dropboxは今のところ埋め込みには対応していません）\nこれは、ブログを書くときにも便利かもしれませんね。\nただ、共有を止める時は面倒臭い感じです。\n今のところFinderからは出来ないようで、ウェブサイトにアクセスして、該当ファイルを選択し「Stop Sharing」を選ぶ必要があります。\nしかも、共有リンクは毎回個別に作成するようで、それ毎に共有を止める必要があります。\n共有状態を管理するのは面倒ですが、簡単に共有できることを優先するならば使いやすいですね。\n容量の大きさと共有のしやすさでDropboxよりも一枚上手な感じですね。\nこれから使うのならば申し分なしです。\n折角なので、是非追加容量もゲットしてください。\nhttps://copy.com?r=2zEy7L SEE ALSO Copy ","date":"2013-04-17T19:26:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/04/17/192600/","title":"Dropboxっぽいアプリ、「copy」を使ってみた"},{"content":"@nqounetです。\nMovableTypeを使って稼ぐために、とりあえずローカル環境（Macでスミマセン）で動かしてみました。\nローカルの環境は色々とごちゃごちゃしているので、とりあえずPerlだけを使って動かしてみます。\nMovable Type 個人無償版ダウンロード とりあえず本体を取ってきます。\nhttps://www.sixapart.jp/inquiry/movabletype/personal_download.html zipファイルでダウンロードする感じになったので、Finderから展開しておきます。\n（Perlbrew利用の場合）.cgiファイルのshebangを書き換え ダウンロードしたCGIファイルのままだと、システムのPerlを利用するので、PerlbrewのPerlを使うようにshebangを書き換えておきます。\n1 $ find . -name \u0026#34;*.cgi\u0026#34; -print0 | xargs -0 perl -i.bak -pe \u0026#34;s|^#\\!/usr/bin/perl|#\\!/usr/bin/env perl|\u0026#34; 展開（解凍）したディレクトリ（アプリケーションのホームディレクトリ）に移動してから上記のワンライナーを実行すると、既存のCGIファイルをバックアップした上で、shebangを変更した新しいファイルを作成します。 問題なく動作するのを確認したら、.bakファイルは削除しても構いません。\nconfigファイルを作成 1 2 3 4 5 6 7 8 9 10 11 12 # mt-config.cgi CGIPath http://localhost:5000/mt/ StaticWebPath http://localhost:5000/mt/mt-static ObjectDriver DBI::mysql Database mt DBUser mt DBPassword passw0rd DBHost localhost DBSocket /Applications/XAMPP/xamppfiles/var/mysql/mysql.sock DefaultLanguage ja CGIPath、StaticWebPathはとりあえずローカル環境用に設定しておきます。 DBSocketは、指定しなくても構いませんが、XAMPPなどで楽をしている場合は適切に設定する必要があります。\nちなみに、SocketのPATHですが、PhpMyAdminを使っている場合は、ログインした上で「変数」のタブをクリックして「Socket」の項目を見ると書いてあります。\nMovableTypeをstarmanで起動 アプリケーションのホームディレクトリに移動してから以下のコマンドを実行すると、アプリケーションサーバーが起動します。\n1 $ starman mt.psgi この時点で何かエラーが出た場合は、そのメッセージに従って修正する必要があります。\nそこは自力で頑張りましょう。\nMovableTypeにアクセス！ CGIPathがhttp://localhost:5000/mt/の場合は、http://localhost:5000/mt/mt.cgiにアクセスします。\n次のような「アカウントを作成」する画面になっていれば成功です。\nアカウントを作成すると、ウェブサイトの設定の画面になります。\nURLと、ファイルを構築するPATHを指定して、インストール！\nインストールが完了するまでしばらく待ちましょう。\n待っている間に、ターミナルでファイルを構築するディレクトリに移動して、以下のコマンドを実行してサーバーを立てておきます。\n1 $ plackup --port 5001 -MPlack::App::Directory -e \u0026#39;Plack::App::Directory-\u0026gt;new(root =\u0026gt; \u0026#34;.\u0026#34;)-\u0026gt;to_app\u0026#39; 完了したらサインインします。\nサインインしたら、早速構築しましょう。サイト名の方をクリックします。\n再構築ボタンをクリックします。\n「すべてのファイル」になっているのを確認した上で、再構築ボタンをクリックします。\n再構築が終わったらサイトを見てみましょう。\nバッチリですね。\nアプリと公開用のサーバーが必要 mt.psgiは、アプリケーションのCGIファイル（mt.cgiとか）を動かすためのサーバー用です。\n構築したHTMLファイルを公開するには、別のサーバーが必要になります。\n今回は面倒だったので、plackupで簡単にサーバーを立てましたが、本番環境ではnginxなどを使うとよさそうです。\nmt-staticの場所を公開用サーバーに変えてやれば、さらに負荷も少なくなってよさそうですね。\n参考サイト MovableType 5.2b2 を nginx + PSGI/Plack @ Mountain Lion な環境で動かす | blog.remora.cx 簡単に手元でHTTPのファイルサーバ立てる方法 - かみぽわーる ","date":"2013-03-02T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/03/02/073000/","title":"MovableType5.2.3をPSGIで動かしてみた"},{"content":"@nqounetです。 Kansai.pmで@shiba_yu36さんが発表していた「Cinnamon」が便利そうだったので、使ってみました。\n「デプロイ」って何？ 「デプロイ」というのは、例えばローカル環境で開発しているウェブアプリやサービスを、実際に公開するサーバーにアップロードして、諸々の設定をして利用可能な状態にすることです。\nBefore Cinnamon 基本的にはgitを使って管理しているので、ローカルで変更をcommitしたあと、サーバーにpush。 そのあと、sshでサーバーにログインして、公開しているディレクトリに移動して、pullしてから、サーバーを再起動、という操作を行なっていました。 サーバーは1つなので、特に面倒でも無いですが、1分程度は張り付いて作業する感じではありました。\nSetup Cinnamon 実際にCinnamonを使ってみます。 まずはCinnamonをインストールします。 CinnamonはCPANに上がっているので、cpanmなどでインストールが可能です。\n1 $ cpanm Cinnamon 依存関係のモジュールも自動的にインストールしてくれるので、簡単です。 インストールが完了すると、「cinnamon」というコマンドが実行できるようになります。 このコマンドを実行すると、そのディレクトリから見て「config/deploy.pl」というファイルを自動的に読み込んでくれるので、gitで管理している場合は、プロジェクトのホームディレクトリからみて、「config/deploy.pl」になるように設定ファイルを作成すると便利です。 細かい書き方は、@naoyaさんのブログか、@shiba_yu36さんのスライド資料などを見ながら書くと良いでしょう。\n開発メモ#1 : Cinnamon によるデプロイ - naoyaのはてなダイアリー Cinnamon - simple deploy tool わかりにくかったところ、引っかかったことをいくつか書いておきます。\nRoleの指定 Roleを指定する時に、ホスト名を書くところがありますが、これは「.ssh/config」で指定しておいて、そのホスト名を書いておくのが正解です。 私は「.ssh/config」にusernameも指定してありますが、必須項目らしいのでuserもsetしておきます。\nsudoができない remoteでrunが可能なのに、sudoした時にエラーになる場合は、サーバーの設定を変更する必要があります。 そもそもsudoが出来ない場合はsudoできるようにする必要があります。 それでもエラーになる場合は、tty経由でしかsudo出来ないようになっている可能性があるので、その設定を解除します。 *TTY経由でないsudoの実行 - shibainu55日記 具体的には、rootになってからのvisudoで、\n1 Defaults requiretty になっている部分をコメント（先頭に「#」を入力）にして無効にします。\ncdしたはずなのに.gitがない 1行ずつ実行するイメージでrunやsudoを使っても、実際にはコマンド毎にログインとログアウトを繰り返しますので、cdしてからのコマンドは「\u0026amp;\u0026amp;」で繋げて1行にして実行する必要があります。\n1 2 3 4 5 6 7 8 9 10 11 # うまくいかない例 remote { sudo qq{cd /var/www/myapp}; sudo qq{git fetch origin}; sudo qq{git checkout -q origin/master}; } $host; # うまくいく例 remote { sudo qq{cd /var/www/myapp \u0026amp;amp;\u0026amp;amp; git fetch origin \u0026amp;amp;\u0026amp;amp; git checkout -q origin/master}; } $host; もしも、複雑な処理が必要であれば、シェルなどでスクリプトを作成して、そのスクリプトを実行するようにしても良いでしょう。\nhypnotoadが見つからない 「hypnotoad」にかぎらず、PATHが通っていない場合があります。 コマンドをフルパスで書くか、特にperlbrewについては、perlbrewのbashrcを読み込む必要があります。\nとあるdeploy.pl それらを踏まえて（sudoはありませんが）作成した「config/deploy.pl」がこちらです。 @argsは要らなさそうなのですが、とりあえずつけています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use utf8; use v5.12; use Cinnamon::DSL; set user =\u0026gt; \u0026#39;nqounet\u0026#39;; set application =\u0026gt; \u0026#39;myapp\u0026#39;; set deploy_to =\u0026gt; \u0026#39;/home/nqounet/www/myapp\u0026#39;; role production =\u0026gt; \u0026#39;sakura.nqounet\u0026#39;; task update =\u0026gt; sub { my ($host, @args) = @_; my $deploy_to = get(\u0026#39;deploy_to\u0026#39;); my $app = get(\u0026#39;application\u0026#39;); remote { run qq{. ~/perl5/perlbrew/etc/bashrc \u0026amp;amp;\u0026amp;amp; cd $deploy_to \u0026amp;amp;\u0026amp;amp; git fetch origin \u0026amp;amp;\u0026amp;amp; git checkout -q origin/master \u0026amp;amp;\u0026amp;amp; hypnotoad script/$app}; } $host; }; task restart =\u0026gt; sub { my ($host, @args) = @_; my $deploy_to = get(\u0026#39;deploy_to\u0026#39;); my $app = get(\u0026#39;application\u0026#39;); remote { run \u0026#34;. ~/perl5/perlbrew/etc/bashrc \u0026amp;amp;\u0026amp;amp; cd $deploy_to \u0026amp;amp;\u0026amp;amp; hypnotoad script/$app\u0026#34;; } $host; }; After Cinnamon 基本的にはgitを使って管理しているので、ローカルで変更をcommitしたあと、サーバーにpush。 そのあと、以下のコマンドを実行。\n1 $ cinnamon production udpate 席を立ってトイレに行って戻ってくると、サーバーの再起動まで終わっていました。 これは楽チンですね。\n","date":"2013-02-27T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/02/27/073000/","title":"デプロイツール「Cinnamon」を使ってみた"},{"content":"@nqounetです。\n2月23日（土）に、梅田（JR大阪駅周辺のこと）にあるヤフー株式会社さまのセミナールームで、Kansai.pmの第15回ミーティングを開催してきました。\nKansai.pm って何？ Kansai.pm（Kansai Perl Mongers）は、関西地区（実際は大阪を中心にした京阪神エリア）で活動する、プログラミング言語Perlのユーザーグループです。\nPerlに興味のある方ならどなたでも参加できます。\n会場はヤフー株式会社のセミナールーム 今回は縁があってヤフー株式会社さまより、大阪富国生命ビルの27Fのセミナールームをお借りすることが出来ました。\n改めてお礼申し上げます。\n27Fから見る景色は素晴らしかったのですが、写真を撮るのをうっかり忘れていました。\nゲストスピーカーは@yusukebeさん ゲストスピーカーとして、2012年のYAPC::ASIAでベストスピーカーに選ばれた@yusukebeさんを迎えることが出来ました。\n今回のKansai.pmが大盛況だったのも、@yusukebeさんのおかげだと思います。\n派遣を決めていただいたJPA（Japan Perl Association）さまにも、改めてお礼申し上げます。\n最近の動向を発表してきました フリーランスになってから、Kansai.pmの一員としてOSC（オープンソースカンファレンス）やKOF（関西オープンフォーラム）で出展したり、「Perl入学式（勉強会）」の補佐（取締役？）をしたり、「Perl鍋（勉強会）」を主催したりしてきましたので、それらを簡単に報告しました。\n個人的に気になったキーワード Dropdown（https://github.com/yusukebe/Dropdown） Dropboxと連携してMarkdownの文書を閲覧するツール。Markdownはエンジニア向けのツールと思っていたら、本の下書きにも使える万能ツールということに驚きました。\nCinnamon（http://search.cpan.org/dist/Cinnamon/） Cinnamonについては早速使ってみましたが、便利ですね。これについては、ちょっと引っかかった（サーバー的な意味で）こともあったので別で書きます。\nDBIx::Latency 計測は力なり。当てずっぽうよりも、計測してみる事が大事ですね。プロファイリングはあまりやらないので計測も意識したいと思います。\nコピペ検出器 他の人の感想を見ても注目されていました。ソースコードの品質管理は地味な仕事ですが、そこに必要な技術がこういう場で注目されるのは良いことだと思いました。\nMovableType MovableTypeはブログシステム、という頭しかありませんでしたが、話を聞いているとWAFなんだなと思いました。\nプラグインを書いてガッポリ儲けたいと思います。\nLTWiki LTWikiは、Kansai.pmのオフィシャルサイトに使えるかも、という期待を込めて注目したいと思います。\n全体の感想 全体的な感想は素晴らしいまとめがあるので、そちらを中心に見ていただいて、私は代表の特権を活かした記事を書いてみたいと思います。\nKansai.pm 第15回ミーティングのまとめ - Masteries 事前アンケートの結果について Zusaarで参加を募集した際に、アンケートをお願いしていました。\nPerlレベルの自己評価と、Perlについてどのようなことが知りたいか、の2点です。\nPerlレベルの自己評価 中間層がやや少なめでしたが、見事にバラバラでした。\nなお、自己評価にはこちらの記事を参考にしていただきました。\nPerlプログラマのレベル10 - Perlプログラミング救命病棟より - naoyaのはてなダイアリー\nレベル2未満：13 レベル2〜4：1 レベル4〜6：6 レベル6〜8：10 レベル8以上：5 どのようなことが知りたいか こちらについては、以下の様な結果になりました。\n初心者向けのトーク xpathの欲しい要素の取り方について OOPを使った効率よい開発、より良いコーディングについて Webアプリケーション、perl界隈、Kansai.pm、Kyoto.pmなど サーバ管理用ツールを作って使ってる人のお話 cool な CPAN モジュールなど モジュールのつくりかたとか テスト、継続的インテグレーション、大規模開発 自然言語処理など PurePerlでは実現できない様々なこと、XSについて レベルごとに分類してみると、初心者はWeb系や具体的なコーディングの話、中級者はテストやツール群などの手法の話、そして上級者はXSのような仕組みの話、が知りたい、というように分かれているようです。\nアンケートの結果、参加してくれるすべての人の要求をカバーするのは非常に難しいことがよくわかりました。\n仮に、Kansai.pmのミーティングを年に1回開催するとして、その1回だけですべてをカバーするのは非常に難しい、ということです。\n関西のPerlを取り巻く状況 関西の、というか京阪神エリアのPerl界隈の状況は、「棲み分け」が上手く出来つつある、と個人的には感じています。\n入門者、初級者向けの「Perl入学式」 初中級者向けの「Perl鍋」 中上級者向けの「Kyoto.pm」 懇親会中心の「Namba.pm」 ※ 棲み分けは個人の感想です\nKansai.pmは年に1回の「関西のPerlのお祭り」という位置づけかなと。\nPerlのコミュニティはもっと増えて良い Perlのコミュニティはもっともっと増えて良いと思います。\n大阪が特にそうなのかもしれませんが「初心者向け」の勉強会でも、明らかに初心者ではない方がいらっしゃるのです。\nなので、初心者からよく聴くのが、初心者向けの勉強会が怖い、と。\n勉強会が少ないと、参加したいと思っている人が行く場所がないので、（仕方なく）初心者向けの勉強会にも参加するのだと思います。\nちゃんと棲み分けようと思えば、沢山勉強会があれば良いのです。\n「Perl Casual」のように、勉強会やミーティングにそれっぽい名前があれば沢山コミュニティができるんじゃないか、という話を懇親会の時に@yusukebeさんと話しました。\n「Perl Casual」は@dankogaiさんとの会話から生まれた名前だそうですので、是非もっとゆるい感じの名前を発明してください！と、お願いをしました。是非よろしくお願いいたします。\nまとめ まとめ、と書いたところでまとまりませんが、ヤフーの方と話したことが印象的でしたので、引用してまとめたいと思います。\n「Perlのコミュニティ（Kansai.pm）は熱いですね」\n","date":"2013-02-26T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/02/26/073000/","title":"Kansai.pmを開催してきました #kansaipm"},{"content":"@nqounetです。\n無線LANの設定アプリ「QRコネクト」が便利なので紹介したのですが、毎回作るのが面倒になってきたので、簡単にQRコードを作成できるサービスを作ってみました。\nQRコネクト って何？ 「QRコネクト」は、スマートフォン用のアプリ（iOS、Android対応）です。\nこのアプリを使って、設定用のQRコードを読み込むと、無線LANの設定ができてしまいます。\n「QRコネクト」なら遠慮無く複雑なパスワードが設定できる - 新大阪でコワーキングスペースを主宰しているPerlプログラマのブログ このアプリ用にQRコードを作成する方法が少し面倒なので、そこを簡単にするサービスを作りました。\nQRコネクト用QRコードメーカー SSIDとパスワードを入力すれば、QRコネクト用のQRコードが作成できます。\nどしどしご利用ください。\n","date":"2013-02-12T14:48:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/02/12/144800/","title":"「QRコネクト用QRコードメーカー」を作ってみた"},{"content":"おはようございます。 若林（@nqounet）です。\n無線LANの設定アプリ「QRコネクト」が便利なので紹介したいと思います。\nQRコネクト って何？ 「QRコネクト」は、スマートフォン用のアプリ（iOS、Android対応）で、アプリを使ってQRコードを読みこむだけで無線LANが使えるようになります。\n無線LAN設定アプリ「QRコネクト」 | IODATA アイ・オー・データ機器 このアプリは、適切にQRコードを作成すれば、IO-DATA製のアクセスポイント、ルーターでなくても使えます。\nQRコネクトの仕様（非公式） 「QRコネクト」で使うQRコードは、単純なテキストです。 そのテキストの書式例は概ね以下のとおりです。\n1 2 3 4 WI: SS:[ssid] EN:WPA PA:[password] 「WI」は認識用のheaderと思われます。\n「SS」はSSIDです。ステルス状態のものでも問題ありません。\n「EN」は暗号化の方法です。WPA2でも設定は「WPA」で可能です。「WEP」は試していませんが、このアプリを使ってもらうのであれば「WPA」で良いと思います。\n「PA」はパスワードです。これまで設定が面倒なので短い設定にしていたかもしれませんが、遠慮無く複雑なパスワードが設定できます。\n最後に改行を入れてあっても問題なく読み取れます。 このテキストをQRコード作成できるサービスでQRコードにしておくと、「QRコネクト」で設定が可能になります。\n例えば QR Code Generator で作成する場合は、以下の様な感じです。 イベントなどで、多くの方に入力してもらう場合には、こういうのが便利ですね。\n新大阪コワーキングでは、この「QRコネクト」を利用できるようにしましたので、スマートフォンでも是非無線LANをお使いください！\n","date":"2013-02-12T12:24:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/02/12/122400/","title":"「QRコネクト」なら遠慮無く複雑なパスワードが設定できる"},{"content":"@nqounetです。\nNamba.pmに参加した時にもプレゼン作成ツールとして紹介したのですが、改めてブログ上でも紹介したいと思います。\nreveal.js って何？ 見ていただくのが一番早いです。\nreveal.js - The HTML Presentation Framework ひとことで言うと、HTMLで書けるプレゼンツールです。\n何と言ってもエフェクトがカッコイイ！\nここ2回ほどのPerl入学式のスライドも、このツールで書いています。\nperl-entrance-org.github.com/presentation/perlentrance10.html#/ perl-entrance-org.github.com/presentation/perlentrance11.html#/ これの元ネタは以下のMarkdownで書かれたファイルです。\nworkshop/markdowns/perl_entrance_10.md at master · perl-entrance-org/workshop · GitHub workshop/markdowns/perl_entrance_11.md at master · perl-entrance-org/workshop · GitHub HTMLのプレゼンツールは便利なのですが、いちいちタグを書いたりするのって面倒なので、Markdownで簡単にかけたらな〜、と思って作りました。\nMarkdownで書いたファイルをプレゼンテーションにする Markdownで書いたファイルをプレゼンテーションとして表示するにはいくつか必要なステップがあります。\nまずはMojoliciousです。\nPerlが入っていれば細かいことはいいので、以下の二行をターミナルを起動してコピペしましょう。\n1 2 curl -L http://cpanmin.us | perl - --self-upgrade cpanm Mojolicious Path::Class Text::Markdown うまくいかなかった人は、なんとかMojoliciousをインストールしてください。\nツールの本体はgithubで公開しています。\nnqounet/p5-md2reveal · GitHub とりあえず使ってみたい方は、以下のコマンド群をコピペしてください。\n1 2 3 4 5 6 7 8 git clone git://github.com/nqounet/p5-md2reveal.git cd p5-md2reveal mv md2reveal.conf.sample md2reveal.conf mv assets/example.md.sample assets/example.md mv assets/example.md.conf.sample assets/example.md.conf git submodule init git submodule update morbo md2reveal Server available at http://127.0.0.1:3000.みたいな文字が出たら、ブラウザでhttp://127.0.0.1:3000を開いてください。\nそれすら面倒な方はこちらのリンクをクリックしてください。\nhttp://127.0.0.1:3000/ すると、こんな感じに見えると思います。\nexample.mdはとりあえずの見本で、クリックするとプレゼンモードになります。\n二回目以降はp5-md3revealで以下のコマンドを実行すれば同じように起動します。\n1 morbo md2reveal ここで、おもむろにassetsディレクトリの中を見ていただくと、example.mdというファイルが見つかると思います。\nこのファイルと同じように、Markdownで書いたファイルをこのディレクトリの中に入れて起動するとあら不思議。\n新しく追加したファイルがメニューに表示されますので、同じようにクリックすればプレゼンができます。\nエフェクトを変更したい場合は、ファイル名の後ろに.confと書いた設定ファイルを作って、同じディレクトリにおくと自動的に読んでくれます。\nexample.mdはこのようにして設定を少し変更しています。\nファイルの中身は以下のような感じです。\n1 2 3 4 { transition =\u0026gt; \u0026#39;zoom\u0026#39;, theme =\u0026gt; \u0026#39;default\u0026#39;, }; transitionはcube、page、concave、zoom、linear、none、defaultから選べます。\nthemeはsky、beige、simple、serif、night、defaultから選べます。\n色々試してみてください。\n画像などを使いたい場合は、publicというディレクトリにimagesというディレクトリを作り、そこに例えばhoge.pngをコピーすると、というようにすれば表示されます。\nMarkdownだと![画像](/images/hoge.png)という感じですね。\nMarkdownを使うのが面倒な人は もっと簡単にreveal.jsを使ってみたい方は、便利なサービスがあります。\nrvl.io: Presentations Made Easy 作ったものをそのまま公開できるのも便利ですね。\nこんなツールがあれば、プレゼン資料は簡単に作れるので、LTも怖くないですね！\n初心者向けサバイバルLTイベント「べしゃれ」 on Zusaar このイベントは\nLTの内容に関しては技術系が望ましいですが，特に指定は致しません．自らの生い立ち，生活の悩み，生活の知恵，旅の体験記などなど\nという事なので、とりあえず作って発表してみてもいいんじゃないでしょうか？\n","date":"2013-02-09T16:22:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/02/09/162200/","title":"あの reveal.js でのプレゼンを Markdown で簡単に書けるようにした"},{"content":"@nqounetです。\ngitoliteをインストールするときに、ついついハマってしまうことがあって、今日もそこでハマったのでこの機会に書いておきます。\n公開鍵のファイルには改行を入れてはいけない gitoliteをインストールするときに、「gitolite setup -pk /path/to/admin.pub」で、admin.pubを登録します。\nその時にサーバー上のエディタを使ってコピペするのがそもそもの間違いという話もあるのですが、うっかり最後に改行を入れてしまうと、gitoliteに無視されてしまいます。\n1 WARNING: keydir/admin.pub does not contain exactly 1 line; ignoring gitoliteは何度かインストールしているのですが、毎回公開鍵の登録で躓いている気がします。\n今度インストールする時は、この記事にお世話にならないようにしたいですね…。\n","date":"2013-01-28T18:04:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/01/28/180400/","title":"gitoliteインストール時のうっかりハマりパターン"},{"content":"@nqounetです。 Mojoliciousで作っているアプリを、どうしてもindex.cgiで動かす必要があって、とりあえず、動くようになったのでメモしておきます。\nMojo::Server::CGI ちょっと前（というか、かなり前かもしれませんが）までは、こんな感じで書けば動いていました。 index.cgi（昔は動いていた版）\n1 2 3 4 5 6 7 8 9 10 #!/user/hoge/perl5/perlbrew/perls/perl-5.14.2/bin/perl use utf8; use lib \u0026#39;lib\u0026#39;; use Mojo::Server::CGI; $ENV{MOJO_APP} = \u0026#39;MyApp\u0026#39;; $ENV{MOJO_MODE} = \u0026#39;production\u0026#39;; Mojo::Server::CGI-\u0026gt;new-\u0026gt;run; 1行目は、環境によって違いますが、Perlbrewを使っている場合はこんな感じだと思います。 で、久しぶりに動かしてみると、Your Mojo is working!としか出ないようになっていました。 どうしても、index.cgiとして動かしたかったのですが、どうも情報が少なくて調べてもよくわかりませんでした。\nMojolicious::Commands 色々やってみてindex.cgiとして動かせるようになったので、それを書いておきます。 index.cgi（動いた版）\n1 2 3 4 5 6 7 8 9 #!/user/hoge/perl5/perlbrew/perls/perl-5.14.2/bin/perl use utf8; use lib \u0026#39;lib\u0026#39;; $ENV{MOJO_MODE} = \u0026#39;production\u0026#39;; require Mojolicious::Commands; Mojolicious::Commands-\u0026gt;start_app(\u0026#39;MyApp\u0026#39;); 結果だけを見れば、シンプルになりました。 Mojolicious::Commandsが万能になって、起動スクリプトと同じように書けるようになったようです。 Perl鍋の報告も近々書きます。たぶん。\n","date":"2013-01-24T00:23:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2013/01/24/002300/","title":"Mojoliciousをどうしてもindex.cgiとして動かしたい"},{"content":"@nqounetです。 「Perl鍋」は、少し前に宣言したPerl入学式の次のステップになりえるだろう勉強会です。\nPerlの勉強会ばかり必要ないのでは？ Perl入学式は来年も続けていく、という事なので、そうなると、来年はPerlの勉強会が毎月2回は開催されることになります。（補講を考えれば今年も2回だったわけですが） そんなに勉強会ばかりあっても…、と思うかもしれませんが、対象となる方が違います。 また、プログラミング言語は使えるようになってからが面白いので、集まって他の人と情報交換しながら、その面白さを経験してもらえるんじゃないか、と思っています。\n時代はPerlですか？ 時代としては、サーバーサイドの言語ではなく、フロントエンドやスマートフォンでの開発に使える言語、を使える人が多く求められているのだと思います。 また、便利なスクリプト言語は、Perl（パール）だけでなく、Ruby（ルビー）やPython（パイソン）などもあり、Perlを選ぶ理由も「テキストの処理が得意」とか「正規表現が便利」ではありえないようになりました。これらは他のスクリプト言語でも十分にできることだからです。 これからプログラミングを始めるに際して、あえてPerlを選ぶのは、ある意味酔狂でしょうね。 それでも、過去の資産を考えたり、限られた環境下で動作する言語を考えると、Perlもまだまだ使いどころが沢山あります。\n文法をマスターしてからが大変 私自身がPerlを勉強してきた中で、本を読んでいてもよくわからないことがあったり、検索して見つけたスクリプトが動かせなかったり、ということはよくありました。 Perlでもなんでもそうだと思いますが、文法を覚えたからといってすぐに使えるわけではありません。 例えば、ログデータを解析するスクリプトを作るとした場合、ログファイルの読み込み、解析、解析後のデータを保存、という流れになります。 ファイルの読み込み、保存は「open」がわかっていればなんとでもなります。 しかし、どのように「解析」するかは、文法ではどうにもなりません。 文法は誰にとっても同じように学ぶことができますが、それをどのように使うのかは、人によって様々です。 そうやって躓いた時に、気軽に質問できるような都合の良い勉強会は、ほとんど無かったと思います。\n勉強会がなければ作ればいいじゃない 私が「Perl入学式」をサポートしてきたり、Kansai.pmの代表になったり、という感じに行動しているのは、単純にPerlが好きというだけでなく、自分自身が躓いた時に必要だった「都合の良い勉強会」を作りたい、と思ったからです。 YAPCに行くと、Twitterとかで「#Perl」を付けてつぶやいたら、誰かが答えてくれる、というようなことも言われます。 実際その通りだと思うのですが、敷居が高い、と思う方も多いと思います。 そういう勉強会がなければ作ればいいじゃない、ということで、「CPANモジュールガイド」が出てからずっと考えていた、この本を使ったコーディング会みたいなのをやることにしました。\n何故「Perl鍋」？ 勉強会をやることは決めましたが、名前がなかなか大変です。 場所は新大阪コワーキングを使うとして「Shin-osaka.pm」だとザックリ過ぎてイメージがわきにくいし、「ゆるPerl」だと緩さの基準が難しいし、「Perlもくもく会」というほど黙々とやりたいわけでもないし。 私の中のイメージとしては、Perlの人達でコワーキングをしている感じの名前がいいなと思っていました。 で、妻に助けを求めたところ、色々と案を出してくれて、その中でピンときたのが「Perl鍋」でした。 そのせいか昨夜は鍋だったのですが、それは別の話。 お鍋というのは、みんなでワイワイと突っついたりするものだし、出汁と具材の組み合わせで色々な味が楽しめる料理です。 また、都合の良いことに、「べ」は勉強会のイニシャルとして使えることに気づいたので、「Perlで何か作る勉強会」の短縮形という後付の理由も出来ました。\nPerl鍋の告知 というわけで、「Perl鍋」第1回は1月17日（木）の夜7時から開催します。\n#Perl鍋 #1 - connpass 第1回なので、探りながらというのもありますが、教材としては「CPANモジュールガイド」を使い、各自が好きなモジュールをテーマにして何かを作って、それを（希望者が）最後に発表する、という感じでやってみたいと思います。 時間は9時までの2時間にしていますが、終電の時間などが大丈夫なら延長しても問題ありません。 また、時間も時間ですので、お腹が空いたらピザでもとって、お腹も満たしつつ交流もできたらな〜、と思います。\n","date":"2012-12-25T11:59:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/25/115900/","title":"#Perl鍋 という勉強会をやりますよ"},{"content":"@nqounetです。\n今、新大阪コワーキングではなく、スターバックスでこの記事を書いています。\n…と書いただけで、待ち合わせの相手が来たので、スターバックスではほとんど書けませんでしたが、ふと感じたことがあり、私の「コワーキング」観とも合致していたので、そのへんを書いてみたいと思います。\nなお、今年もコワーキング・アドベント・カレンダーに参加しています。\nコワーキング・アドベント・カレンダー 2012 12月25日（以降？）まで、参加者が毎日日替わりでブログを書いてリレーしています。\n当たり前 コワーキングを知ってから1年半、コワーキングスペースを運営してから1年と少し経ち、私にとっては「コワーキング」が当たり前のように存在しています。\nインターネットだけでなく、無線LANでさえ、うっかりしていると当たり前に感じていて、実家に帰った時や、旅先での宿泊でドギマギしたりします。\n私の例は極端にしても、携帯電話は、日本でもかなり普及していると思います。\n携帯電話をなくしたら、困る人は多いのではないでしょうか？\n待ち合わせするのも場所や時間をきっちり決めておかないと会えないかもしれませんよね？\n「当たり前」な事というのは、無くなると「依存していた」ことに気付かされてしまうと思います。\n私にとっては、新大阪コワーキングを中心にしたコミュニティが当たり前のように感じられるようになっていて、今、このコミュニティを取り上げられてしまうと、途方に暮れてしまうなぁ、というふうに思っています。\nスターバックスに来て、周りを見ながらそんなことを感じました。\n明日はMYCAFEさん 明日は「MY CAFE マイカフェ 名古屋 伏見」の田中さんです。\nよろしくお願いいたします。\n","date":"2012-12-19T23:43:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/19/234300/","title":"新大阪コワーキングとは一体何なのか"},{"content":"@nqounetです。\nフリーになってから、Perlのコミュニティに色々と参加してきましたが、ついに関西のトップになりました（ぉ\nKansai.pmというコミュニティ 何度かミーティングに参加してきましたが、Kansai.pmというのは、代表のいないコミュニティということで、やりたいなーと思った人が、メーリングリストに「やりましょう！」と言って音頭を取ってミーティングする、という感じでした。\nもちろん、それでも中心になるメンバーは何人か居たのですが、この1,2年の間に、一人また一人と東京へ旅立って（あるいは戻って）行ったのです。\n特に、私が初めて参加した頃からよく動いていた方が東京に行ってしまった時には、Kansai.pmはどうなるんだ、的な空気が関東の方からも聞こえてきました。\nやっぱり代表って必要ですよ やっぱり代表が必要だな〜、というふうに思ったのは、JPA（Japan Perl Association）からの連絡に、Kansai.pmとして答えられる人が居ない状態を見たのが大きいです。\nいくら関西でPerlが盛り上がっている、と言っていても、関西（と言ってもせいぜい近畿圏）を代表するPerlのコミュニティが機能していないのでは、寒々しい感じがしました。\n代表は何をする人 代表というと大げさですが、やっていることは今までとあまり変わりません。\n代表といっても、一人で全部抱えるのではなく、声を出して仲間を集めたり、窓口になったりしているだけです。\nそういう感じなので、代表というのもおこがましいですが、当面はこんな感じで活動したいと思います。\nKansai.pmのミーティングやりますよ！ 2月の土曜日に（今のところ16日で調整中）Kansai.pmのミーティングを開催しようと計画中です。\nゲストに、今年のYAPCでベストスピーカーに選ばれた @yusukebeさんをお迎えする予定です。\n近いうちに告知しますので、お楽しみに！\n","date":"2012-12-19T09:21:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/19/092100/","title":"Kansai.pmの代表になりました"},{"content":"@nqounetです。\nこの前の日曜日に、Perl入学式の第11回で講師役をやってきました。\nライブコーディング？ 当時は、なんとACアダプタを忘れてしまったため、急遽参加者からパソコンを借りてスライドを見せながらすすめることになりました。\nライブコーディングを期待していた方は申し訳ございませんでした。\n今回は、年末ということもあってか参加者も5人ということで、細かく行き届いた勉強会になったのではないかと思います。\n資料とサンプルコード 当日のテキストはgithubにあげてあります。\nhttp://perl-entrance-org.github.com/presentation/perlentrance11.html\nこのテキストから、サンプルコードへのリンクも張ってありますので、そちらを参考にしていただくと独学でもなんとかなるだろうという親切設計です。\nサンプルコードを表示しながら、書いてあることについて簡単に解説しながら、コードを書いてもらう、という感じで進めました。\nflashが動かない謎 参加者の方で、Mojolicious::Liteのflashが機能しなかった方がいらっしゃいました。\nソースコードは間違っていないように見えたのですが…。\n講義中にも言ったのですが、flashはクッキーを利用しているので、クッキーを受け取らないように（ブロック）していると機能しません。\n手元で念のため確認しましたが、やはりクッキーをブロックしていると何もおきませんでした。\nWebアプリでは、クッキーを利用することが多くあるので、クッキーが使えるかどうかを予め把握し、場合によっては「クッキーがブロックされている」という警告を出すようにしておくほうが良いですね。\n今回は、そこまで考えていなかったので、結局どこに問題があるのかを究明できませんでした。申し訳ございません。\nPerl入学式のこれからとKansai.pmと何か Perl入学式の #12 と、来年以降のPerl入学式について@__papix__さんから話がありました。\nPerl入学式は、大阪、福岡、東京の3箇所で開催される感じになります。\nKansai.pmについては、私の方から2月の土曜日にミーティングを予定しています、ということを伝えました。\nもう一つ、Perl入学式の次のステップになる勉強会を開催したいと思っています。\n折角覚えたのですから、使ってみたいですよね。\nPerlに入学したから満足、というだけでなく、Perlを使って色々と作ってみたりわからない所を訊いてみたりできる、そういう勉強会をやってみたいと考えています。\n時間帯についても、平日の夜にして、Perl夜間学校という感じの名前にしようかと思っています。\n1月から早速やってみようと思いますので、気になっている方は、次のアナウンスにご期待ください。\n","date":"2012-12-18T14:33:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/18/143300/","title":"#Perl入学式 #11 で講師役をしてきました"},{"content":"@nqounetです。\nNamba.pm開催おめでとうございます Perl入学式でお馴染みの@__papix__さんが、hachioji.pmをリスペクトして生まれたNamba.pmに行ってきました。\nNamba.pmについては、参加者募集ページ（募集はもちろん終了）を参考にしていただくとして、感想を書いてみようかと思います。\nLTまでの時間 大阪ネタによくなる「二度づけ禁止」でお馴染みの「串かつ」の店で大阪らしい感じ（？）で始まりました。\nいきなり懇親会というか、懇親会の中にLTを入れるというのがそもそものスタイルというゆるい集まりです。\n当初、1時間程度でLTという事でしたが、気がつくと2時間ほど経っていました。\nこのままLTなし？と思った頃に、ようやくLT開催です。\n1枚の枚数や1分の長さは人によって様々 事前の通知として「1枚1分LT」という事だったのですが、どうやら「1」という数字は不思議な数字のようで、ほとんどの人が長めでした。\nちなみに、私の資料はこちらです。スペースキーで進みますが、矢印でも進むので、一旦ショートカットしてしまい、はじめからやり直すというハプニングもありました。\nhttp://nqounet.github.com/presentation/20121201_nambapm.html 枚数こそ1枚ではありませんが、1分は意識したので、内容はほぼありません（言い訳）。\nLTソンで発表したとおり、markdownからスライドを簡単に作りたいという欲求があるので、それを満たしたという次第です。\n全員のLTが終わった頃には、1時間以上経っていました。\nLT後の時間 LTが終わった開放感からか、一気に懇親会ムード満載になって来ました。\n懇親会に始まり懇親会に終わる、なかなか面白い時間でしたね。\n結局、18時から始めて23時過ぎまでいたことになるので、延々5時間！\n皆さま、お疲れさまでした。\n","date":"2012-12-03T23:31:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/03/233100/","title":"Namba.pm #0 に参加してきました #nambapm"},{"content":"@nqounetです。\n設定はFeedBurnerにあった すっかり忘れていて検索してしまったので備忘録。\nブログを書いたらTwitterで通知しようと、随分前に設定していたのですが、少し変更したいと思って設定を見るも見当たらず。\nCrowyで見たところ、送信したアプリとしては「Google」となっているので、Googleのサービスのはずなのに分からない。\nそう思って検索したところ、FeedBurnerにあることを発見しました。\nブログの更新情報を Twitter に流してくれる FeedBurner の Socialize 機能 | クリボウの Blogger Tips 設定は「集客支援」の中にある「Socialize」にあります。\nFeedBurnerは便利ですよ FeedBurnerは、Googleになる前から便利に使っていました。\nブログを引越ししてもFeed（RSS）のURLが変わらないのは良いですね。\n","date":"2012-12-01T00:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/12/01/000000/","title":"Bloggerの記事を書いたらTwitterに流す方法"},{"content":"@nqounetです。\nNet::Twitter::Lite Perlで「Twitterでログイン」とか、そういうのを作るときに、Net::Twitter::Liteはとても便利です。\nMojoliciousで、Net::Twitter::Liteでの認証処理を書いていたのですが、OAuthで使うget_authorization_urlやrequest_access_tokenが遅すぎて（30秒ほどかかる）、nginx経由だと502エラーが出て困っていました。\nLWP::Protocol::Net::Curl そんな時に見つけたのがこのページ。\nlibcurl as LWP backend (or \u0026ldquo;all your protocol are belong to us\u0026rdquo;) Net::Twitter::Liteでは、内部的にLWP::UserAgentを使っているので、もしかしたら…と思ってやってみたら、上手くいきました。\n使い方は、Net::Twitter::Liteを使う前にuseしておくだけで良さそうです。\n1 2 3 use LWP::Protocol::Net::Curl; use Net::Twitter::Lite; ... 他には何も変えていないのに、認証がすぐに終わるようになった。\n30秒もかかるなんてなにかおかしい 認証が速く終わるようになったので問題はないのですが。\n結局何がおかしいのか全然わかりません。\n","date":"2012-11-30T20:13:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/30/201300/","title":"Net::Twitter::Liteでの認証が爆速になって生きるのがつらい"},{"content":"@nqounetです。\nPerl入学式 #10 で講師役をしてきました。\nイベントの募集ページを見ていたら、補欠参加もいるという盛況っぷりでした。\nあとで訊いたところによると、Web開発に関することだったり、MojoliciousというWAFを扱うということが興味をそそった感じでした。\nライブコーディングだったはずでは？ 事前の打ち合わせの時は「ライブコーディングかなー」と言っていたのですが、何もない状態で講師役をするのは難しそうだと思って資料を作成していたら、コードは参加した皆さんが書いて、私は1行も書かない、というスタイルになっていました。\n何を間違ったのでしょう？\n何もない状態から1行掲示板を作る 実際に何かを作る場合、何もない状態から作る、というのが普通（まあ、最初のうちだけでしょうけど）なので、新しくディレクトリを作ってからコーディングする、というのだけは決めていました。\nで、そういう感じにするには、ライブコーディングが良さそう、という安直な発想だったのです。\n最初はgitやテストも含めようと思っていた もともとライブコーディング、というスタイルで考えていたため、動かせるようになる度にgitでコミットしたり、簡単にテストを書いてから実装するTDDっぽい事もしようと思っていました。\nしかし、書いているうちに説明することが多くなりすぎる事に気づきました。\nかなり削った感はあったのですが、実際には、スライドを全部終えた時点で残り5分という、まるで緻密に計算され尽くした感じにはなりました。\nもちろん偶然ですが、かなり削った感があっただけに愕然としています。\nコードの書き方は同じではない あたり前のことですが、命令文を理解して書くのと、文字を書き写すのでは、書き方が変わります。\nファイルハンドルの後ろにカンマがあったりなかったり、とか、代入（=）なのかファットカンマ（=\u0026gt;）なのか、あるいは矢印（-\u0026gt;）なのかを意識できるかどうかで、同じコードが全く違うように見えるし、書き方も変わると思います。\n以前、プログラミングの練習で、コードをなぞっていく方式のものがあったのですが、入力の仕方が違うのでプログラミングというよりはタイピングの練習だな、と思ったことがあります。\n例えば、ちゃんと理解している人は、括弧やクォーテーションなんかは、先にセット（\u0026ldquo;\u0026ldquo;とか{}とか）で書いて、そのあと間を埋める、という人がほとんどじゃないかと思うわけです。\nしかし、書いてある物をそのまま転写する時は、おそらくそういう書き方はしないような気がします。\nレスポンスがほしい Perl入学式の特長としては、手厚いサポート（当社比）があります。\n全員が動作するまでは次のステップに進まない、ようにしているのですが、例えば、できた人は挙手、みたいなことをやったとして、できていてもあげない人がほとんどです。\nまあ、大体そんな感じなのは予想どおりなので、ざっと巡回して勝手に見てまわります。\n個別に訊くとちゃんと返事を返してくれるので、その辺は助かりますし、懇親会の席では色々と話をしてくれたりもするので、やり方次第で、もっと反応があるのかもしれません。\nもし、言えなかったこととか訊けなかったこととかがあったら、ブログなどでこっそり書いてほしいと思っています。\nまとまらない つらつらと書いていたら、何が言いたいのかよくわからなくなってきました。\n今回は、自分の中では思っていたところまでは進んだし、理解度はわからないけれども、全員がちゃんと動くものが出来ている、という事で、かなり満足のいく結果でした。\n初参加の人もかなり多かったのに、ほとんどの人が開発環境を用意できていたので、人数が多かった割にはスムーズでした。\n久しぶりにStrawberryPerlが活躍したり、サクラエディタの漢字コードがShift_JISになっていて文字化けしたのも、今では良い思い出です。\n次回へ向けて 次回は、今回の続きになるのですが、次回から参加される方を考慮して、今回の分をライブコーディング（まだ言うか）して、そこから続きを作成していく、という感じにしようかなと思っています。\n#Perl入学式 #11 on Zusaar なので、次回が初参加の方でも大丈夫です！\n","date":"2012-11-28T12:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/28/120000/","title":"#Perl入学式 #10 で講師役をしてきました"},{"content":"「nginx + WordPress + multisite」で、アップロードしたファイルをちゃんと表示できるようになったので、簡単に記録しておきます。\nぶち当たった問題 画像をアップロードして記事に埋め込んだが、画像が表示されない（404エラー） 原因 nginxの設定 解決方法 WordPressで「nginx-helper」というプラグインを入れて、適切に設定する nginxの設定ファイルを適切に設定する。 参考になったページ http://wiki.nginx.org/WordPress#Rewrite_rules_for_Multisite_using_subdomains 細かいこと 参考にしたページの設定は、「nginx-helper」というプラグインを利用するのが前提になっているようなので、忘れずに入れて設定しておきます。\nプラグイン設定方法は、以下のとおりです。\n「nginx-helper」をインストールする。 画面左側のメニューから「設定」→「Nginx Helper」とクリックして設定画面を出す。 「Enable Nginx Map.」にチェックを入れて「Save」します。 プラグインについては以上です。\nただし、このプラグインの情報にしたがって、nginxの設定を書きなおす必要があります。\n必要な情報は以下のとおりです。\n「save」した後、「Nginx Map」という設定が出てくるので、その中の「Nginx Map path to include in nginx settings」の右側の文字列をコピーして貼り付けます。 ```default map $http_host $blogid { default -999; include （ここに貼り付け）; }\n（中略）\n#WPMU Files location ~ ^/files/(.*)$ { try_files /wp-content/blogs.dir/$blogid/$uri /wp-includes/ms-files.php?file=$1; access_log off; log_not_found off; expires max; } ```\nマルチサイトにした場合、サイト（ブログ）をごとに$blogidが割り振られますが、サイトのホスト名とIDを紐付けておくことで、nginxで画像を処理できるようになります。\nこの設定は、PHPの起動回数を減らすことにつながるので、サーバーの負荷を減らしたり、高速化を目指す場合は必須です。\nで、問題は、この「WPMU Files」の設定なのですが、他の静的なファイルの設定は、この設定よりも前には書かないほうがよさそうです。\nconfファイル 最後に、ヴァーチャルホストの設定ファイルを晒しておきます。\n継ぎ接ぎだらけですが、何かのお役に立てば幸いです。\n```default map $http_host $blogid { default -999; include /var/www/soc/wp-content/plugins/nginx-helper/map.conf; }\nserver { listen 80; server_name .wp.nishimiyahara.net;\naccess_log /var/log/nginx/wp_soc.access.log; error_log /var/log/nginx/wp_soc.error.log;\nroot /var/www/soc; index index.php;\nlocation = /favicon.ico { log_not_found off; access_log off; }\nlocation = /robots.txt { allow all; log_not_found off; access_log off; }\nlocation / { try_files $uri $uri/ /index.php?$args; }\nlocation ~ \\.php$ { include /etc/nginx/fastcgi.conf; fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; }\n#WPMU Files location ~ ^/files/(.*)$ { try_files /wp-content/blogs.dir/$blogid/$uri /wp-includes/ms-files.php?file=$1; access_log off; log_not_found off; expires max; }\n#WPMU x-sendfile to avoid php readfile() location ^~ /blogs.dir { internal; alias /var/www/soc/wp-content/blogs.dir; access_log off; log_not_found off; expires max; }\nlocation ~* \\.(js|css|png|jpg|jpeg|gif|ico)$ { log_not_found off; expires max; } } ```\n","date":"2012-11-13T09:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/13/090000/","title":"「nginx + WordPress + multisite」で、アップロードしたファイルをちゃんと表示できるようになった"},{"content":"Mojoliciousを使っていて、時々ログが何処から書き出されたのかを把握したい場合があります、よね？\n私はあります。\nデバッグ情報を沢山出力していると、何処の情報だったのかを簡単に把握するのが難しくなります、よね？\nそれで、Mojoliciousにそんな機能がないかなー、と探っていたのですが、どうにも無さそうなので、作ってみました。\nと言っても、pluginではなく、startupの中にredifineしてやりました。\nとりあえず、パッケージ名と行数がわかれば見当はつくということで。テンプレートの中のエラーはわかりませんが。\n一応、debug仕様の時だけ実行するようになっています。\n以下のプログラムは、$ mojo generate app MyappPLという感じで作った後のlib/MyappPL.pmです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package MyappPL; use Mojo::Base \u0026#39;Mojolicious\u0026#39;; # This method will run once at server start sub startup { my $self = shift; # ここから if ($self-\u0026gt;log-\u0026gt;is_level(\u0026#39;debug\u0026#39;)) { no warnings \u0026#39;redefine\u0026#39;; *Mojo::Log::format = sub { my ($self, $level, @lines) = @_; my @caller = caller(4); my $caller = join \u0026#39; \u0026#39;, $caller[0], $caller[2]; return \u0026#39;[\u0026#39; . localtime(time) . \u0026#34;] [$level] [$caller] \u0026#34; . join(\u0026#34;\\n\u0026#34;, @lines) . \u0026#34;\\n\u0026#34;; }; } # ここまで追加 # Documentation browser under \u0026#34;/perldoc\u0026#34; $self-\u0026gt;plugin(\u0026#39;PODRenderer\u0026#39;); # Router my $r = $self-\u0026gt;routes; # Normal route to controller $r-\u0026gt;get(\u0026#39;/\u0026#39;)-\u0026gt;to(\u0026#39;example#welcome\u0026#39;); } 1; そうすると、development.logはこんな感じになります。\n1 2 3 4 5 6 7 [Thu Nov 8 17:31:14 2012] [info] [Mojo::Server::Daemon 198] Listening at \u0026#34;http://*:3001\u0026#34;. [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious 31] Your secret passphrase needs to be changed!!! [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious::Plugin::RequestTimer 42] GET / (Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11). [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious::Routes 136] Routing to controller \u0026#34;MyappPL::Example\u0026#34; and action \u0026#34;welcome\u0026#34;. [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious::Plugin::EPLRenderer 49] Rendering template \u0026#34;example/welcome.html.ep\u0026#34;. [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious::Plugin::EPLRenderer 49] Rendering template \u0026#34;layouts/default.html.ep\u0026#34;. [Thu Nov 8 17:31:25 2012] [debug] [Mojolicious::Plugin::RequestTimer 29] 200 OK (0.037642s, 26.566/s). 3001番なのは大人の事情ということで（何\nちゃんとログを取りたかったら、別のモジュールを使う方が良いのでしょうが、まあ、何かの役にはたつかもしれません。\n","date":"2012-11-09T08:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/09/080000/","title":"Mojoliciousのログにパッケージ名と行数も出力してみた"},{"content":"PHP+nginxが動いた！ 先日挫折した、PHP+nginxですが、無事動かすことができました。\n原因は、WordPressのドメインのドキュメントルートにあたるディレクトリの場所でした。\nもともと、ユーザーのホームディレクトリ内に置いていたのですが、どうもそれが原因だったようです。\n途中のディレクトリをすべて読みに行っているのかもしれません。\nエラーが何故「Permission denied」になっているのか、全くわかりませんでした。\n主語を省略するなという意味がよく分かる出来事でした。\nそんなわけで、ドキュメントルートを/var/wwwにしたらあっさりと動きました。\n…エラーメッセージも主語が大事ですね。\n助かりました 原因に気がついたのは、こちらのページを見つけたからです。\nさくらVPSでnginxをインストールしたときのメモ at HouseTect, JavaScriptな情報をあなたに いやいや、本当に助かりました。\nそんなわけでマルチサイト化しました 私のWordPress人生はこれから始まるわけです。\nとりあえずマルチサイトにしてみたのですが、普通に使うのと結構違ってて（プラグインとかテーマは個々でインストールができないっぽい？）いきなり面倒です…。\nWordPressの情報 検索しても本当に玉石混交ですね。\n自分自身がほんとうに必要な部分がよくわからないことが多いです。\nこのプラグインを使えば出来るよ〜、というのもありがたいのですが。\n先日のWordCampでは、googleで検索するよりもCodexがいいよ、という話だったのですが…。\nWordPress Codex 日本語版 うーむ。\nパーマリンクの設定で使える名称がわからなかった 初心者はそこを触らないのかもしれませんが。\nパーマリンク設定を「年月日時分(秒?)」にしたかったのですが、その名称がわからず。\n%hour%までは書いてありましたが、分秒がイマイチ。\n色々と調べた結果、それっぽいのを見つけました。\nこれが全て使えるかどうかは確認していませんが、「分」が使えたのと「monthnum」があるので、多分これが予約語的なものなのでしょう。\n1 var $public_query_vars = array(\u0026#39;m\u0026#39;, \u0026#39;p\u0026#39;, \u0026#39;posts\u0026#39;, \u0026#39;w\u0026#39;, \u0026#39;cat\u0026#39;, \u0026#39;withcomments\u0026#39;, \u0026#39;withoutcomments\u0026#39;, \u0026#39;s\u0026#39;, \u0026#39;search\u0026#39;, \u0026#39;exact\u0026#39;, \u0026#39;sentence\u0026#39;, \u0026#39;debug\u0026#39;, \u0026#39;calendar\u0026#39;, \u0026#39;page\u0026#39;, \u0026#39;paged\u0026#39;, \u0026#39;more\u0026#39;, \u0026#39;tb\u0026#39;, \u0026#39;pb\u0026#39;, \u0026#39;author\u0026#39;, \u0026#39;order\u0026#39;, \u0026#39;orderby\u0026#39;, \u0026#39;year\u0026#39;, \u0026#39;monthnum\u0026#39;, \u0026#39;day\u0026#39;, \u0026#39;hour\u0026#39;, \u0026#39;minute\u0026#39;, \u0026#39;second\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;category_name\u0026#39;, \u0026#39;tag\u0026#39;, \u0026#39;feed\u0026#39;, \u0026#39;author_name\u0026#39;, \u0026#39;static\u0026#39;, \u0026#39;pagename\u0026#39;, \u0026#39;page_id\u0026#39;, \u0026#39;error\u0026#39;, \u0026#39;comments_popup\u0026#39;, \u0026#39;attachment\u0026#39;, \u0026#39;attachment_id\u0026#39;, \u0026#39;subpost\u0026#39;, \u0026#39;subpost_id\u0026#39;, \u0026#39;preview\u0026#39;, \u0026#39;robots\u0026#39;, \u0026#39;taxonomy\u0026#39;, \u0026#39;term\u0026#39;, \u0026#39;cpage\u0026#39;);\u0026lt;br\u0026gt; いずれまた検索する自分のために書き残しておきます。\n","date":"2012-11-08T13:50:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/08/135000/","title":"VPSでWordPressデビューできました！"},{"content":"今日は、久しぶりにお気に入りのカレー屋さんに行きました。\nカレーハウス五番館 カレー通販 家からも近く、値段も良心的で何より美味しいのでよく行っていました。\n店が狭く、昼間は特に混んでいるので、機会を逃していたのですが、今日はタイミングよく空いていたので久しぶりに中に入りました。\n私は今日も「チキンカレー」を頼みましたが、久しぶりに見たカレーはどこか様相が違っていました。\n今日のチキンカレー 前のチキンカレー まあ、並べてみるとよくわかりませんが。\nただ、残念ながら味の方も首を傾げる事になりました。\nコクというか甘みがかなり控えめになっており、甘いけれども辛い独特の美味しさがどこかへ行ってしまっていました。\nなんというか、美味しい店がまた一つ減ったのか、と思うと残念でなりません。\nまた、昔の味を取り戻してほしいです…。\n","date":"2012-11-05T14:34:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/05/143400/","title":"ランチでの出来事"},{"content":"行ってきましたよ「WordCamp Osaka 2012」に。\n人が多かった、というのが第一印象。\nスタッフが多かった、というのが第二印象です。\n開場に間に合うように出たつもりだったのが、どこをどう間違ったのか結構時間ギリギリでした。\nゆるゆるカフェ 10時からは「ゆるゆるカフェ」に参加しました。\n文字面から、ゆる〜く交流が図れることを期待していたのですが、実際には交流を強制させる、かなりアクティブなセッションでした。\nコツを掴むまでは、なかなか大変だと思いますが、ちゃんと出来れば交流も図れて、かつ、頭の体操にもなる、面白い企画だと思います。\nこの時は、WordPressどころか、Twitterも初めて数週間というような方もいて、ブログツールとしての敷居の低さを目の当たりにしました。\nやってみて、このような手法をブログか何かで読んだことを思い出しました。\nデザイナーが本当に欲しかったオリジナルなテーマつくっちゃいました！解説とテーマお持ち帰り この時間帯は、本当は「企業向けWordPressサイトを運用しよう！」というセッションを聴講するつもりだったのですが、なんと満員。部屋に入ることもできない、ということで、仕方なく（失礼）テーマお持ち帰りを聴講しました。\n個人的なスタンスとしては、デザイン的な要素についてはあまり重要視していない（能力的な問題ですが）ということもあり、また、比較的CMS入門者向けの解説でしたので、軽く聞き流していました。\n作ったテーマは、5ページ程度の、シンプルな企業向けサイトのテーマ、ということで、多機能ではなく、必要最低限のテーマを作った、という事と、そのテーマがどんなファイルで作成されているのか、を入門者向けにわかりやすく（一部呪文もありましたが）お話されていました。\n奇しくも、Perl入学式での話し方についても考えさせられました。やっぱり呪文って言われるのは嫌だなと思いました。\nそれはともかく、最後のほうで、使えそうなプラグインの紹介もあって、それらはバッチリメモしておきました。\nテーマはまだ未完成ということでお持ち帰りはできませんでしたが、完成したら公式アナウンスがあるそうです。\nPHP-FPMの謎は解けませんでした 昨日諦めたnginx＋PHPの件については、さすがに口頭だけでは説明できず、一応訊いてはみましたが決定的な回答は得られませんでした。\nログの見方か、デバッグのやり方を探さないといけないようです。\nWindows AzureでWordPress構築 「Windows Azure」は事前にアカウント登録して、そのついでに触ろうと思っていたのですが、操作の仕方というか、メニューが直感的ではなく、ストレスが溜まったのですぐに諦めました。\nで、実際に説明を受けながらやってみると、不思議な事にスムーズに、アッという間にWordPressの構築が終わりました。\nメニューを観ていると、gitが使えるということで、即使おうと思ったのですが、その時はメニューが動きませんでした。（返ってきてからは動きましたが、cloneしても中身が空っぽで意味不明でした。WordPressはどこ行った？）\nFTPでも操作できるらしいのですが、まだ試していません。\nその後、Azureを使った例として、仮想マシン複数＋DB＋ストレージ（画像とか動画とか）、という組み合わせの構築方法の解説がありました。\n普通は面倒な構築ですが、プラグインを利用することで簡単に出来るということで、やはりWordPressはプラグインさまさまだと、改めて思いました。\n","date":"2012-11-04T03:11:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/04/031100/","title":"「WordCamp Osaka 2012」に行ってきましたよ"},{"content":"WordPressはプラグインがすごい 新大阪コワーキングで、松本 博樹さんを招いてWordPressの勉強会をした時に思ったのは、「プラグインが沢山あって便利そう」という事でした。\n特に「BackWPup」はDropboxへのバックアップも可能で、とても便利\nとはいえ、プラグインを沢山入れると動作が重くなるなどの弊害もあるようで、慣れている方はあまり入れないのだとか。\n「WordPress プラグイン」で検索すると、厳選された沢山のプラグインが出てくるので、それをさらに厳選するのは大変ですね。\n明日は、特にプラグインの実際のところとかを訊いてみたいなと思っています。\nワンクリックインストールとか簡単すぎておかしい フリーブログからのステップアップとして、レンタルサーバーで簡単に始められるのは、良いですね。\nこの手のツールで大変なのはインストールだと思いますが、そのインストールがワンクリックで可能であれば、初心者でも使えるツールとして人気なのはわかります。\n実際、リニューアルした「新大阪コワーキング」のサイトも、WordPress歴2週間程度の妻がほとんど作りましたので、Web制作に関する知識がほとんど無くてもここまでできてしまうのは、何かおかしい（良い意味で）と思います。\n「ゆるゆるカフェ」と「Windows Azure ＋ WordPress」に参加します 明日は、大きなイベントに参加するだけでなく、その中の参加型イベントにも顔を出す予定です。\n参加無料！来場者の交流コーナー「ゆるゆるカフェ」 on Zusaar 非エンジニアでも触ったら分かる! 企業サイトをクラウド＋WordPressで構築運用しよう！[ハンズオン形式] on Zusaar これらのイベントには間に合ったので参加します。\nお手柔らかにお願いいたします。\nAWSで高速なWordPressも体験してみたかったのですが、こちらは人気だったので諦めました。\nいま話題のAWS(アマゾンウェブサービス)でWordPress高速化を実体験！[ハンズオン形式] on Zusaar VPSにWordPressを入れるのは諦めました 今日はVPSでWordPressを動かそうと思っていました。\nがしかし、PHP自体はちゃんと動きましたが、nginxからPHP（中身はphpinfo）がちゃんと呼び出せません。\nPHP-FPMとか初めて知りました。\n「Hello World」すらできないのは恥ずかしいですが、nginxのエラーメッセージには「FastCGI sent in stderr: \u0026ldquo;Primary script unknown\u0026rdquo; while reading response header from upstream（以下略」とあるものの、どう調べていいのか検討もつかず、結局諦めました。\nALMiniumを入れていたり、Perlで作ったアプリのサーバーを立てていたりしていて、あまり変なこともできないので、また機会があれば挑戦してみようかと思っています。\nやっぱり、インフラって難しいです…。\nそんな感じですが、WordCampに乗り込みます というわけで、明日のWordCampは、IT系のイベントとしてもかなり大きめのイベントになりますが、乗り込んでみたいと思います。\nSEE ALSO WordCamp Osaka 2012 | 2012年11月03日(土／祝) 天満研修センターにて開催！ ","date":"2012-11-03T03:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/11/03/033000/","title":"PHP＋nginxに挫折したままWordCampに行ってきます"},{"content":"@nqounetです。\nYAPC::Asiaの感想ブログを書いたら、スポンサープレゼントに当選しました！\n【締め切りました】YAPC::Asia 2012 感想ブログを書く、参加者アンケートに答えてスポンサープレゼントに応募してください！ | YAPC::Asia Tokyo 2012 シックス・アパート賞だったらしく、中身は、トフのぬいぐるみ（中身はパウダービーズっぽいです）、トートバッグ、刺繍ロゴ入りTシャツでした！ （トフについてはトフトフ通信をご覧ください。）\n忙しい中、ありがとうございます。\n来年のYAPC::Asiaも参加します！\n","date":"2012-10-10T11:21:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/10/10/112100/","title":"YAPC::Asiaのスポンサープレゼントに当選した！"},{"content":"@nqounetです。\n今年のYAPC::Asiaでは、LT-THON（えるてぃそん（Lightning Talks Marathon））という企画が行われていました。\nえるてぃそんって？ LT-THONを説明する前に、LTというのは、5分程度の短い時間で発表をする、というスタイルのトークです。\nで、LT-THONは、そのLTを朝から晩まで行う、という企画です。\nYAPC::ASIA 2012 LT-THON 詳しくはこちらのスライドをご覧ください。\nLTthon in YAPC 2012 ちょこちょこ見ていました 初日の講演の合間や、見ようと思っていたけど、部屋の外まで人がいっぱいで入れなくて諦めた時に、イスを求めてLT-THONの場所で座っていました。\n初日は、LTがあったので、その資料を読み返したり修正したりするのに座りながら、と思っていたのですが、トークを聞いていると全然作業ができないのが想定外でした。\n二日目に発表しました 前夜祭の時に、早速雰囲気にあてられて、LT-THON参加しまーす、的なことを言った手前、初日のLTのあと、その失敗をネタに加えながらLT-THON用に資料を作りました。\n資料はこちらです。\nMarkdownでプレゼンしてみよう！ なんか、色々とスミマセン（何\nHachioji.pmのうずらさんは「Keynote」派だそうです。\n理由としては、\n万一自分のパソコンが壊れてしまっても、（発表を予定している）誰かが環境を持っている（意外（？）とKeynote使っている人が多い） ということでした。\nその他には、\nBeamer（これかな？） spork（調べましたが詳細不明） という意見もいただきました。\nご意見いただいた皆さま、ありがとうございました。\n発表して良かった トークすることが経験になる、とかそういうことではなく、何より、懇親会などで話すときにネタになることが良いです。\n聴いてくれていたかどうかは二の次で、どういう話をしたのかを話すことが出来る、YAPCで何かを実行した、ということが大事だと思います。\nLT-THONは、そうした舞台を作ってくれたので、非常に良かったと思います。\n予め参加する意思を示そう！ お前が言うな、という感じですが。\nLT-THONも、最初は参加予定者が少なくて、ちゃんと完走できるのか心配だったそうです。\n事前に申し込みのあった発表者の数は定員割れだった、というふうに聞いたと思います。\n結局は（私も含め）飛び入りが多く、大変な盛り上がりを見せたわけですが、定員割れの場合は開催が危ぶまれたかもしれないのです。\nもし開催されていなかったら、とても残念だったと思います。\nそういうことを防ぐためにも、ほんの少し勇気を出して行動することが大事だと思います。\n興味を持っているイベントがあれば、積極的に参加してみてください。\n","date":"2012-09-30T20:36:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/30/203600/","title":"「えるてぃそん」でも発表してきました"},{"content":"@nqounetです。\nYAPC::Asia Tokyo 2012 に参加しています（した）。\n開催中に下書きはしていたのですが、結局書ききれなかったので事後になっています。\nとりあえずYAPCでLTデビューしたので、そのことを書きます。\nYAPC::Asia Tokyo 2012に来ています YAPC::Asiaというのは、Yet Another Perl Conferenceのアジア版ということで、ここ数年東京で開催されています。\n私は昨年初めて参加し、今年で二回目です。\n前回も思いましたが、凄いことをしている人達というのは、自分自身のことを凄いと思っていない（発表している方からもそういう意見が出ていました）というのが面白いですね。\n今日の非公式後夜祭でも、以前参加したKyoto.pmの懇親会でも、懇親会の度にそう思うのですが、本を出版していたり、YAPCで何度も発表している方でも、普通に接することができる。\nこういうイベントに参加すると、有名人というのは、こちら側の人が勝手に線を引いている、ということを凄く意識します。\nLTに応募してみた 今回は、縁があってニフティクラウドC4SAに関わることが出来たので、そのことを発表しようと応募してみました。\nLTというのは「Lightning Talks」のことで、短い時間（おおよそ5分程度）で発表するスタイルの発表のことです。そして、時間になると銅鑼を鳴らして強制終了、というのがルールになっています。\nLTは人がいっぱい セッション（講演）は、3つの部屋で行なっていますが、LTの時は1箇所でしかやりません。\nつまり、聴衆が3倍になるのは当然ということですね。\nその3倍の人達の前で発表するというのは、初心者にはハードルが高いです。\n発表自体は、デモが失敗するなど散々な結果でしたが、その失敗自体をネタに出来るくらいには良い経験だったと思っています。\nYAPC::Asia Tokyo 2012 スペシャルレポート：YAPC::Asia Tokyo 2012, 1日目レポート［随時更新］｜gihyo.jp … 技術評論社 また、来週実施するハッカソンはこちらです。前日にアイデアソンも実施しますので、こういうのどう？というアイディアを既に持っていらっしゃる方は是非お越しください。\nMA8ハッカソン on Zusaar MA8アイデアソン on Zusaar ちなみに、パソコンが傾いているのは、ディスプレイのアダプタを保護するためです。15インチって意外と大きかった\u0026hellip;。\n資料はアップしておきましたので、興味がある方はご覧ください。\nニフティクラウドC4SAを使ってみた 私としては、デモを失敗したことよりも、YAPCのLTデビューということで妙なテンションを維持していて、そちらのほうがある意味危険な感じでした。\nこの後、懇親会にも参加しましたが、そのことはまた別に書きます。\n","date":"2012-09-30T11:15:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/30/111500/","title":"YAPC::Asia Tokyo 2012 でLTしてきた"},{"content":"@nqounetです。\nニフティクラウドC4SA勉強会を開催しました 順番が前後しますが、今日はShin-Osaka NewbiesでニフティクラウドC4SAの勉強会を開催しました。\n初体験！ニフティクラウドC4SA勉強会 縁あって、ニフティの上野さまと久保田さまにお越しいただき、サービスの紹介、デモをしていただいて、そのあと、実際にニフティクラウドC4SAを体験していただきました。\nWEBDAVが意外と手強い ニフティクラウドC4SAのウリは、ブラウザでアプリ開発環境が整う手軽さです。\n「黒い画面」を見ることなくWordPressがインストールされて使える状態になったり（これはWordPressをインストールした経験がある方には、かなり衝撃だったようです）、サービスの状態を監視するのもブラウザでできてしまう手軽さは、会場でもなかなか好評だったと思います。\n実際に操作していた中で、意外と手間取ったのがWEBDAVの設定でした。\nWEBDAVは、ネットワーク上のファイル、フォルダを、外付けのハードディスクのように扱える便利なものです。\nしかし、何故かWindows7をお使いの方で、WEBDAVに接続できないトラブルが発生しました。 これは、初期設定のままでは「WebClient」が実行されていないためだったのですが、この事に気づくまであちこちで呻き声が聞こえました。\nちなみに、Macの方は特に問題なく接続できていました。 実は私も、Finderで接続できるのは、先日教えていただくまで知りませんでした。\nというか、C4SAについてはGitを使って管理していたので、それほど不便は感じていなかったのですが。\n「黒い画面」の秘密 また、今日は「黒い画面」についてはあまり解説はありませんでしたが、ちょっとした（しかし重要な）裏技も教えていただきました。\nPerlのキャンバスでは、今までcpanmくらいしか使っていなかったのですが、今後色々と使ってみたいと思います。\n実務にも即戦力として使えそうな感触 金額的には個人向けですが、企業ユースでも十分使えるスペックのようです。\n信頼性についても、非常に高い（C4SAのサービスが止まってしまったときは、いろんな銀行のシステムも止まっているという話題も）ことを教えていただきました。\nVPSもよいですが、PaaSの機動性の良さは実用的ですね。\n","date":"2012-09-16T00:29:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/16/002900/","title":"ニフティクラウドC4SA勉強会を開催しました"},{"content":"@nqounetです。\nMA8 大阪Caravan and Meetup に行ってきました 今日は、ニフティクラウドC4SAの勉強会のあと、MA8（マッシュアップアワード8）のキャラバン＆ミートアップのイベントに行ってきました。\nMA8 お知らせブログ 9/15開催　#MA8 大阪Caravan\u0026amp;Meetup with WebCATStudio ～MA8史上初の大阪で仲間を募ろうミートアップ～ マッシュアップアワードを知ったのは昨年（MA7）でしたが、なにか作りたい！と思っただけで実行に移せませんでした…。\n今年こそ、ということで、MA8に作品を応募したい、と思い、まずはミートアップイベントに参加してみよう、という事にしました。\nAPIはいろいろある 前半戦は、協賛、後援（パートナー）のAPIの紹介、ということで、6社から様々なAPIやツールが紹介されました。\n画像認識から動画認識、電話、画像による検索などのAPI、携帯アプリを簡単に作れるフレームワークやウェブアプリ開発が捗るPaaSなど、素晴らしい技術が惜しげもなく披露されました。\n興味はあったものの、手を出せていなかった技術が目の前で披露されると、普段とは違うテンションになってくるのを感じました。\n自然と、このAPIを使ったらこんなことが出来るんじゃないか、というように考えているのが自分でも不思議です。\nデザイナーはミートアップイベントに参加したらいいと思う 後半戦は、アイディアソン、ということで、6チームに別れてサービスやアプリのプランニングとプレゼンテーションを行いました。\n入場するときに、エンジニア、デザイナー、その他、という風にざっくりと3種類に分かれて色違いのネックホルダーを身につけました。 後でわかりましたが、このネックホルダーに記号が書いてあり、その記号でチーム分けを行いました。\n今回は一般参加者でも20人ほど居ましたが、デザイナーの方は3名しかいませんでした。 主催者の方でも、この傾向は毎度のことのようで、苦笑いをしていました。 少なくともMAでは、デザイナー不足は深刻です。\nアイディアソン、そしてプレゼンテーション アイディアソンという事で、チームに分かれて、まずは簡単にご挨拶、そして、トイレ（たばこ）休憩を挟んで、スケッチブックと付箋を使ってアイディア出しを行いました。\n付箋に、キーワードを書いていく事で、発想が広がったり、あるいは収束させるために付箋を繋げたり、まとめたり、取り除いたりしていくうちに、アイディアがどんどん洗練されていくのがわかりました。\n普段、こういう経験があまりなかったので、とても刺激になりました。\nこういう場では、自分自身の得意分野で何か力を発揮したい、という欲が出て、私は簡素ですがウェブサービスの骨組みを作り始めました。\nそうした中でも、アイディアはどんどん形になっていき、最終的にはスケッチブック一枚にサービスの概要をまとめたものと、トップページとログイン画面（と言ってもbootstrapとクラウディアを使っただけの簡素なもの）だけのウェブサイトでプレゼンを行いました。\n今作っているウェブサービスを流用して作ったのですが、もっと雛形を洗練させたり、その場でさっと作るという技術をもっと磨きたいと思いました。 小さなウェブアプリを、いくつも作りこんでおくことが大事ですね。 残念ながら入賞は逃しましたが、今回の経験は活かしていきたいと思います。\n他のチームの皆さんの発表も面白かった（当初なかった特別賞まで出ましたw）です。 大阪と東京の、プレゼンに対する意気込み（というか姿勢）の違いを、一緒のチームになったニフティの方も感心していました。\nMA8に参加しましょう 正式には発表されてないようですが、来週末にもミートアップイベントがあるという話を聞きました。\nデザイナーの方や、APIを使ったウェブ開発、アプリ開発に興味のある方は、参加してみてはいかがでしょうか。\n少なくとも、私にとっては（ほんの数時間の短い時間ですが）良い経験になりました。\n","date":"2012-09-15T22:47:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/15/224700/","title":"MA8ミートアップイベントに参加してきました"},{"content":"@nqounetです。\niPad2のカバーを買い換えました …とは言っても、純正ではありません。\niPad Smart Cover、ケース、保護スリーブ - Apple Store (Japan) 良いとは思うのですが、値段を考えるとちょっと考えてしまいます。\n事の発端はアメリカ土産（自分用） アメリカでiPad2を買ってきた時に、その店にあった安いカバーを買ったのですが、かなり敗北感があった（コネクタなどの必要なスペースが微妙にずれていた）ので、あまり気にしないようにしていました。\n純正品を惜しげもなく買えるような暮らしをしたい、と思いながら。\nしかし、今週の月曜日くらいに、「DN-82646」の記事を発見して、これは！と思って早速注文しました。\n純正よりも安くて背面カバーも付いてくるオートスリープ対応iPadカバー:gizmodoチャンネル - ニコニコチャンネル：社会・言論 Made in China 中国製だからといって別に悪いわけではありません。\n注意書きに「商品のサイズ・重量はすべて実測ですので、商品により多少の誤差がある場合がございます」とあって、結構ビビっていたのですが、パチッという小気味よい音でピッタリとフィットしたので満足でした。\nただ、耐久性については若干心配です。\n長く使ってみないとわかりませんが、背面のカバーと前面のカバーのジョイント部分が、何となく貧相な気がします。\n見た目はなかなか 色は6種類（Black, White, Blue, Red, Gray, Pink）あるのですが、楽天市場でみた時には、2色しか残っていませんでした。\n目当ての赤はまだあったので、私にとっては無問題。\n（ちなみに、先ほど確認したところ、全色売り切れになっていました…）\n裏面は材質は違うので色は変わりますが、それほど悪くありません。\n立てた状態では不安定、というレビューがあったとおり、確かに不安定なのですが、意外と大丈夫でした。\n角度もちゃんとついていて、かつ、手前に倒そうとしてもなかなか倒れません。重心が後ろ気味なのかもしれません。\n見た目はやはり風呂の蓋ですが、スタンドにもなるのは便利ですね。\n","date":"2012-09-13T12:25:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/13/122500/","title":"iPad2のカバーを買い換えました"},{"content":"@nqounetです。\n11月17日（土）に開催される、「コワーキング・フォーラム関西 2012」のオフィシャルサイトがオープンしました。\nコワーキング・フォーラム関西 2012 実行委員として私も参加しています。\n新大阪コワーキングも、実行委員スペースとして参加しており、フォーラムへの意気込み（ほとんど紹介ですが）を書いておりますので、もしよろしければご覧ください。\nコワーキング・フォーラム関西 2012 » 新大阪コワーキング（大阪） イベント当日は、関西だけでなく全国各地のコワーキングスペースを主宰する方々も集まってくる（と思います）ので、「コワーキング」が気になる方は是非このイベントにご参加ください。\n11月17日（土）に、会場でお待ちしています。\nSEE ALSO コワーキング・フォーラム関西 2012 » イベント概要 コワーキング・フォーラム関西 2012 » アクセス ","date":"2012-09-04T13:01:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/09/04/130100/","title":"コワーキング・フォーラム関西のオフィシャルサイトがオープンしています"},{"content":"@nqounetです。\n今更な感じで、イベントアテンド（ベータ版ではない方）を使ってみたのですが、ツールが充実していて驚いたので、メモっておきます。\nイベントアテンド [ATND] でイベント作成・チケット販売・参加者の出欠管理 まず、気にいらないところですが。\nイベントを公開するには「じゃらん×ホットペッパー会員」になる必要がある Facebookのアカウントでログインして、イベントを作成してから公開しようとすると「じゃらん×ホットペッパー会員」になれと言われます。\n公開、あるいは非公開だとしても、他の誰かに知らせるために告知サイトを利用しているわけで、その最後のステップで会員になれというのは印象が悪いです。\n今回はもともとイベント用にmarkdownで記事を作成していたので、このサイトでの作業は殆ど無かったのですが、時間をかけて作ったイベントページを公開しないという選択肢を誰が選ぶでしょうか？\nベータ版が今でも盛況なのは、こういう背景があるのかなぁ、と漠然と思いました。\n…しかし、そんなことも一瞬で忘れてしまうほど便利なツールがあるではありませんか！\nもともと、こういうツールは告知したいから使うのです。\n今までは、作成した告知ページをTwitterやFacebookなどで宣伝したりしていたのですが、イベントアテンドでは埋め込みパーツを用意してくれています。\nその中の一つ「イベントカセット」はこんな感じです。\nセミナー・勉強会・講演会\n開催場所大阪府\n初体験！ニフティクラウドC4SA勉強会 2012\n09/15(土)11:00\n◆\n2012\n09/15(土)13:00\n##【初体験！ニフティクラウドC4SA勉強会】を開催します（特典付き）###開催概要*イベント名称*初体験！ニフティクラウドC4SA勉強会*開催日時*2012年9月15日（土）11:00～13:00*定員*10名*参加費*1000円（フリー…\nイベントの告知と運営ツール : イベントアテンド\n先ほど作成したイベントです。よろしくお願いします（ぉ\nSNSだけでなく、オフィシャルページがある場合は、このようなパーツは便利です。\u0026hellip;スタイルがガチガチなのが残念ですが。\nベータ版だけでなく正式版も使ってみてはいかがでしょうか？\nSEE ALSO イベントアテンド [ATND] でイベント作成・チケット販売・参加者の出欠管理 ","date":"2012-08-31T13:50:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/08/31/135000/","title":"イベントアテンドを（今更）使ってみた"},{"content":"@nqounetです。\nなんでも自分で作りたい病を刺激する、素敵なサービスを知ったのでメモっておきます。\nIFTTT / Put the internet to work for you. FacebookやTwitterなどのSNSをいくつも使っていると、それぞれを連携したくなります。\nで、それぞれのサービスには連携できる設定もあるのですが、細かいところが気になる（気にいらない）ことってありますよね。\nそんな連携が自分の手で設定できる、というのがIFTTTです。\n仕組みはとてもシンプルで、何かをしたら、それを引き金にして、何かをする、というもの。\n簡単な例では、Facebookに投稿したら、Twitterにも投稿する、とか。\n残念ながら、複数アカウントに対応していないようなので、例えば各Facebookページからの投稿を各アカウントに振り分けるには、IFTTTのアカウントを複数使わないと無理っぽい。\nそれはそれとして、ハッシュタグを自動でつけたりするのも簡単にできそうなので、痒いところに手が届く、通好みのサービスです。\n「Browse」で、誰かが作った「Recipe」を見つけることもできます（探すのにコツがいるかもしれません）ので、何かを試してみて、それをアレンジするところから始めるのも面白いと思います。\nやり始めると色々と作ってみたくなりますよ！\nSEE ALSO IFTTTが激烈便利な件 - mzdakr.com ","date":"2012-08-30T14:43:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/08/30/144300/","title":"なんでも自分で作りたい病を刺激する素敵なサービス"},{"content":"@nqounetです。\n今日（日付的には昨日）はPerl入学式#7補講でした。\n主な内容としては、\n復習問題 お約束 mapとgrep 正規表現を詳しく でした。\n資料について 資料はgithubで公開しています。\nPerl入学式#7資料（HTML版） workshop/07 at master · perl-entrance-org/workshop スライドは、カーソルの→、またはスペースキーで進みます。戻るときはカーソルの←をお使いください。\nまた、補講に際して一部資料を修正していますので、併せてご確認ください。\n相変わらず、資料はMarkdownで記述し、markdown2impressを改造したツールを使ってプレゼン資料にしました。 そのあたりは先日書いていますので、そちらもご覧ください。\n今回のイマイチだった点について 今回が、Perl入学式初参加、という方もいらっしゃったのですが、その方へのサポートが足りていなかったのがイマイチでした。 「プログラミング初心者大歓迎」がPerl入学式の売りでもあるので、もっと手厚いサポートが必要だったなぁ…と思いました。\nあと時間配分についても。 また、最後の問題を宿題にしてしまった…。\n今回の良かった点について 解説している時よりも実際にコーディングしてプログラムを動かしている時の方が集中している感が伝わって来ましたので、こういうのもアリかなと思いました。 …私が楽しかっただけなのかもしれませんが。\n今回の学び これは質問だったのですが、「qr」で正規表現をスカラー変数に代入して利用した場合と、普通の文字列を代入した場合の違い、を質問されました。\nその時は時間もなかったので、ある程度の知識を駆使して、「qr」を使うと「//」で囲わなくてもマッチングできるという風に説明しながら実際に書いて実行していたのです。\n1 my $input = \u0026#34;John is Great Man!\u0026#34;;\u0026lt;br\u0026gt;my $pattern = qr/(?:[jJ]ohn)/;\u0026lt;br\u0026gt;if ($input =~ $pattern) {\u0026lt;br\u0026gt; print \u0026#34;マッチした！\u0026#34;;\u0026lt;br\u0026gt;}\u0026lt;br\u0026gt; で、次に普通に代入した変数ではマッチングが実行できません…と説明しようとしたのですが。\n1 my $input = \u0026#34;John is Great Man!\u0026#34;;\u0026lt;br\u0026gt;my $pattern = \u0026#34;(?:[jJ]ohn)\u0026#34;;\u0026lt;br\u0026gt;if ($input =~ $pattern) {\u0026lt;br\u0026gt; print \u0026#34;マッチした！\u0026#34;;\u0026lt;br\u0026gt;}\u0026lt;br\u0026gt; これが動いてしまったので、言葉に詰まってしまいました。 迂闊な説明は禁物だなと。\nということで、帰ってからperldocをサクッと読みました。\nhttp://perldoc.perl.org/perlop.html#Regexp-Quote-Like-Operators http://perldoc.jp/docs/perl/5.14.1/perlop.pod#Regexp32Quote-Like32Operators 次回の予定 #8は9月23日（日）に、Joe\u0026rsquo;sクラウドコンピューティングで開催します。\n募集は「#Perl入学式 #8 on Zusaar」で行なっています。\n未成年の方や大学生は無料ですので、この機会に是非ご参加ください。\nお待ちしております。\n","date":"2012-08-27T02:50:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/08/27/025000/","title":"Perl入学式 #7補講で講師役をしてきました"},{"content":"@nqounetです。\nMojoliciousのファイルアップロードではまった。\nまた自分がやらかしそうなので記録。\n3時間くらいウンウン唸っていたけど、ちゃんと冷静に考えたら、データベースにリファレンスそのものを書き込もうとしていただけだった。\nMojoliciousを使ってファイルのアップロード機能を作成していた時、\n1 No references other than a SCALAR reference can use a update column というエラーメッセージが出るようになってしまった。\nschemaから情報を読み込んでフォームを作成したり、そのフォームの情報を確認して、問題なければ書き込む、という一連の処理を作成していた。\nMojoliciousでは、ファイルのアップロードをした時に、paramから値を取得するとオブジェクト（Mojo::Upload）が取れるようになっている。 最初に作成したときは、\n1 2 3 4 5 6 7 my $upload = $self-\u0026gt;param(\u0026#39;upload\u0026#39;); if (ref $upload eq \u0026#39;Mojo::Upload\u0026#39;) { if ($upload-\u0026gt;filename) { $upload-\u0026gt;move_to(file(\u0026#39;path\u0026#39;, \u0026#39;to\u0026#39;, $upload-\u0026gt;filename)); } $upload = $upload-\u0026gt;filename; } という感じで作っていたのだけど、例外処理をいくつか作っているうちに、$uploadを操作しないままオブジェクトを書き込むことになっていた。\nまあ、変数を兼用したのがそもそも良くないような気がするので、ファイルのアップロードをしたい時は、変数を別に作るというか、フォームを作成するときに名前を変更して作っておくほうが良いかもしれない。\n","date":"2012-07-21T12:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/07/21/120000/","title":"Mojoliciousのファイルアップロードではまった"},{"content":"@nqounetです。\n外部のハードディスクにデータを保存した時に、パーミッションの情報がなくなって困ったことはありませんか？\n私は困りました。\n外部ディスク上のファイルをターミナルで操作した時に気づいたのですが、chmodしても変更できないし、なんじゃこりゃ、という感じでした。\nこの状態で、サーバーにファイルをアップロード（ftpだけでなくscpでも）すると残念な感じになるので、ファイルシステムには気をつけないといけませんね。\nずっとWindowsな生活をしていた私にとって、このあたりの基礎的な知識が根本的に足りてないのだと思います。\nで、結局ファイルはちゃんとしたファイルシステムで管理することにしたのですが、いちいちパーミッションを変えるのが面倒で、せめてファイルだけでも一発で出来ないものかと調べてみたら、まあ、ちゃんとありました。\n1 $ find . -type f -print0 | xargs -0 chmod 0604\u0026lt;br\u0026gt; これは、現在のディレクトリ以下にあるファイルを「0604」（所有者のみ読み書き、その他大勢は読むだけ可能）にする。\n1 $ find . -type d -print0 | xargs -0 chmod 0705\u0026lt;br\u0026gt; こちらは、ディレクトリを一括で変更する場合です。\nfindの「-print0」と、xargsの「-0」は、「空白」をうまく処理してくれる連携技です。普段は「空白」を使わないので気が付きませんでしたが、このような備えは重要ですね。\n最初は空白が原因でエラーになっていて泣きそうになりましたが、xargsで解決できるのを知って大喜びです。\nxargsって便利ですね。\nSEE ALSO いまさらxargsの便利さを主張してみる — ディノオープンラボラトリ ","date":"2012-07-12T13:35:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/07/12/133500/","title":"ファイルシステムで困った話"},{"content":"@nqounetです。\nこの前の日曜日（5月27日）はPerl入学式#5でした。\n主な内容としては、\n前回までのおさらい コマンドラインからスクリプトを使おう ファイルを使おう 外部コマンド（シェル）を使おう 関数（サブルーチン）を使おう でした。\n予定では「@_と$_について」と「コンテキスト」についても実施する予定だったのですが、時間の都合で次回（#6）になります。\n資料について 資料はgithubで公開しています。\nPerl入学式#5資料 今回も、資料作成にあたっては、Learn Perl in about 2 hours 30 minutes、というページを参考にしました。\nまた、資料はMarkdownで記述し、markdown2impressを改造したツールを使ってプレゼン資料にしました。 そのあたりは先日書きましたので、そちらもご覧ください。\n今回の反省点について 反省点としては、（またしても）時間配分がかなり適当だったことです。 というよりも、後半の時間の過ぎ方は異常です。脳内ではまだ30分ほどあるような気がしていたのですが…。 自分でもショックです。\nおさらいについてはほぼ予定通りのつもりでしたが、説明（特にデリファレンス）の時点で迷いが出てしまったのも原因の1つかなと思います。\nDumperのおかげで、リファレンス自体は説明がしやすいのですが、デリファレンスがややこしいですね。 それと、$、@、%の使い分けですね。\nデリファレンスする際には、スカラーなら${...}で、配列全体なら@{...}で、ハッシュ全体なら%{...}でリファレンスを囲ってやることでデリファレンスできる、というふうに説明しています。\n1 ${$scalar_ref}\u0026lt;br\u0026gt;@{$array_ref}\u0026lt;br\u0026gt;%{$hash_ref}\u0026lt;br\u0026gt; しかし、例えばハッシュの中の1要素を$hash{key1}というように表現することが腑に落ちていない状態では、例えば\n1 # 良くない例\u0026lt;br\u0026gt;@{$array_ref}[0]\u0026lt;br\u0026gt;%{$hash_ref}{key1}\u0026lt;br\u0026gt; というようにやってしまいがちです。\nそのようなことがあると思ったので、逆に-\u0026gt;（矢印演算子）を使ったデリファレンスを中心にしてみたのです。\n1 $array_ref-\u0026gt;[0]; # ${$array_ref}[0] と同じ\u0026lt;br\u0026gt;$hash_ref-\u0026gt;{key1}; # ${$hash_ref}{key1} と同じ\u0026lt;br\u0026gt; それと、個人的には矢印演算子を使う方がわかり易かったので、こちらを推していきたいと思ったのもあります。\n今回は、おさらいを問題と解答例とすることで、単なる説明ではなく、少しでも「思い出す」または「考える」時間を作りたいと思っていました。\n目論見がうまく行ったかどうかはよくわかりませんが、実際にやってみると資料の細かい部分も見てくれている事はよくわかりました。 資料の作りこみは大事ですね。\n#6は今のところ7月1日（日）の方向で調整しています。 次回の講師はpapixさんの予定です。 お楽しみに。\n","date":"2012-05-30T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/05/30/073000/","title":"Perl入学式#5で講師役をしてきました"},{"content":"@nqounetです。\n今度の日曜日はPerl入学式#5です。\n参加の申し込みは「Perl入学式 #5 on Zusaar」でまだ受け付けています。\n今回も講師は私がやります。 緊張はもちろんしています。\n資料は今回も100ページ分ありますので、またもや時間が心配です。 おさらいの部分については、かなり説明を端折る予定なので、事前に資料を公開します。\nPerl入学式#5資料 会場は今回も Joe\u0026rsquo;sウェブホスティング さまをお借りしました。 ありがとうございます。今後ともよろしくお願いいたします。\nさて、今回の資料も markdown2impress を勝手に改造して Mojolicious::Lite な感じに仕上げたものを使っています。\n時間があれば markdown を shower 用に変換するツールを作りたいと思ったのですが、そんなに余裕はありませんでした。 いずれ、過去の資料もmarkdown化するかもしれない（？）構想もあるので、それっぽいツールは作りたいですね。\nもし、その手のツールを作る場合は、headingを自動的にヘッダかフッタにつけたいですね。 headingを残して中身だけ変わる、というのもカッコイイとは思うのですが、大変そうなので誰かが作ってくれるのを待ちます。\nhtml5のプレゼンツールは便利なのですが、markdownではsectionなどの要素がないので、sectionの分割を手前でやる必要があります。\nmarkdownのheadingは「#」を連ねるスタイル（atx-style）と「=」や「-」を連ねるスタイル（Setext-style）があるので、そのあたりが面倒だなと。 今回は、「———-」で区切るのをやめて、atx-styleのheadingが来たら分割するようにしました。\ngithubにもあげてありますので、もしよろしければご覧ください。\n","date":"2012-05-26T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/05/26/073000/","title":"今度の日曜日はPerl入学式#5です"},{"content":"@nqounetです。\nPerl入学式の#4は、かなり詰め込みすぎてしまい、練習問題のつもりが宿題になってしまいました。\nPerl入学式#4 練習問題（宿題）\n#4補講が終わってしばらく時間も経ったので、解答例（あくまで「例」です）を出してみたいと思います。\n身も蓋もない解答例 実は、Data::Dumper::ConciseのDumperで出力した結果は、そのまま代入すると元通りになります。\n```default use Data::Dumper::Concise;\nmy $brothers = { luigi =\u0026gt; { color =\u0026gt; \u0026ldquo;green\u0026rdquo;, initial =\u0026gt; \u0026ldquo;L\u0026rdquo; }, mario =\u0026gt; { color =\u0026gt; \u0026ldquo;red\u0026rdquo;, initial =\u0026gt; \u0026ldquo;M\u0026rdquo; } };\nprint Dumper $brothers; ```\nポイントは最後に「;（セミコロン）」を忘れずにつけることです…が、とりあえず、この解答例はスルーしてください。\n正攻法的な解答例 ```default use Data::Dumper::Concise;\nmy %luigi = ( color =\u0026gt; \u0026ldquo;green\u0026rdquo;, initial =\u0026gt; \u0026ldquo;L\u0026rdquo;, ); my %mario = ( color =\u0026gt; \u0026ldquo;red\u0026rdquo;, initial =\u0026gt; \u0026ldquo;M\u0026rdquo;, );\nmy %brothers = ( luigi =\u0026gt; \\%luigi, mario =\u0026gt; \\%mario, );\nprint Dumper \\%brothers; ```\nシンプルに考えれば、ほとんどの方はこのような感じになると思います。\nまずは個々の「color」「initial」の値を持つハッシュを作成します。 あとは、それらのリファレンスを値にするハッシュを作成すると出来上がりです。\nいかがでしょうか？\nこんなやり方でも出来た！という方は是非「#Perl入学式」をつけてツイートしてみてください。\n","date":"2012-05-18T19:55:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/05/18/195500/","title":"Perl入学式#4 宿題の答え合わせ"},{"content":"@nqounetです。\n先日の日曜日に「Perl入学式 #4補講」で講師役をしてきました。 場所は新大阪コワーキングで行いました。 ちょっと遅くなりましたが、振り返ってみたいと思います。\n今回は、開発環境がらみのトラブル（cpanmや、perlbrewからPerlがインストール出来ない）が発生して、それらが解決しないまま時間がズルズルと過ぎて行きました。 おかげで「リファレンス」についてはコーディングしながら覚える時間がなく、説明だけで終わってしまいました。\nなるべくこういった事がない様に環境を揃えているつもりですが、開発環境を整えるのは大変だと感じました。\n究極的には、開発環境を運営側で用意するほうがスムーズには行きますが、その場合、家での自習ができない事が難点です。 帰ってから自己解決した（必要なライブラリの場所が違っていたということでした）方もいらっしゃるので、情報を仕入れて開発環境整備の方法をきっちりと整理したいと思います。\nさて、資料は#4で作成済みだったので、全く準備をしていなかったのですが「追加で説明した事を追記していない」ということに、同じ所を説明した瞬間に気づきました。\nしかし、時間的にもかなり厳しい状態だったため、ハッシュの中身を「for」と「keys」で表示させるやり方は説明できませんでした。 ハッシュの使い方のおさらいの項でそれとなく使っているので参考にしてください。\n今回も改めて思いましたが、実際にコーディングしていると動かなくて質問されたりします。\nやはり、プログラミング言語を学習する場合は、写経する（テキストのコードを実際に書いて実行してみる）事が最も効果的だと思いました。\nそういう意味で、実際にコーディングする時間が作れなかったのは悔やまれます。\n#5の資料作りはまだこれからですので、今回の反省点を活かして作りたいと思います。\n#4ならびに#4補講に参加していただいた皆さま、ありがとうございました。 また、#5（申し込みはZusaarでどうぞ）に参加を予定している皆さま、ますますパワーアップするPerl入学式をよろしくお願いいたします。\n","date":"2012-05-16T17:32:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/05/16/173200/","title":"「Perl入学式#4補講」で講師役をしてきました"},{"content":"@nqounetです。\n今度の日曜日は「Perl入学式 #4補講」です。\n基本的な内容は変わりません。 事前に資料も公開してあるので、事前に予習いただければさらに理解が深まるものと思います。\n今回の補講は満員になっており、Perlへの興味がどんどん広がっていることがひしひしと感じられます。 やはり今年の関西はPerlが熱いですね。\n残念ながら#4（または補講）に参加できなかった方も、これまでの資料を元に自習の上、#5に参加していただければ大丈夫です。 Perlで難しいと言われている「リファレンス」については、#5からも実際に使いながら、何度も繰り返して学習していきますので、「リファレンス」で挫折した方もPerlへの再入学をお待ちしております。\n#5では以下の内容を予定しています。\nコマンドラインからスクリプトを使おう ファイルを使おう 外部コマンド（シェル）を使おう 関数（サブルーチン）を使おう Perlというと、多くの方にとってはCGIと同じだと思いますが、コマンドラインツールとしても便利に使えます。\nCGIの方が馴染みがあるとは思いますが、CGIとしてのPerlを勉強するには、言語以外にWebの基本的な部分を覚える必要があるため、余計に難しいと思います。\nPerl入学式では、CGIスクリプトとしてではなく、まずはプログラム言語としてのPerlを学習しています。 WebでPerlを使う場合は、Perlの基本的な部分を覚えてから徐々に覚えれば効率が良いと考えています。 CGIに挫折した方も、改めてPerlに入学してみましょう。\nPerl入学式 #4補講 on Zusaar Perl入学式 #5 on Zusaar ","date":"2012-05-09T07:30:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/05/09/073000/","title":"今度の日曜日はPerl入学式#4補講です"},{"content":"@nqounetです。\n最近、Google Chromeがよく固まってしまう。\n何が原因なのかはわからないけど、FacebookやCrowyなどを常駐させているのは負担なのかと感じています。\nなので、最近はFacebookを使う時は専用のソフトを使っている。\n「Social for Facebook」がそれです。\nなかなか使い勝手がよくて重宝しています。\nSEE ALSO Social - Index - Social Management Tool for multiple social network accounts 新しくなったSkypeの画面 …余計なお世話です\n最近、Skypeが新しくなって、Facebookと接続することができるようになっていた。\n何気なく接続すると、Facebookでのメッセージのやり取りがSkypeでできるようになっている。\nウォールを見る機能としては不十分だけど、メッセージとしてはかなりイケている。 これはこれで良いのですが、メッセージが来ると、両方のソフトからお知らせが来て嫌なので、Skypeの方の接続は切ることにしたのですが、実はこれがよくなかったようです。\nSkypeが新しくなってからくらいだと思うのですが、Social for Facebookが勝手にログアウトするようになりました。 Facebookでチャット可能な状態になっているのに、送信しようとするとオフラインになる、という苦情もありました。 何故使えなくなってきたのかよくわからず、アンインストールしてから再度インストールしたりしましたが、一向に良くなりません。 それで、Skypeの接続をもう一度試すことにしました。 しかし、結局思っているように使えないので接続を切ったところ、Social for Facebookがログアウトしてしまったのです。\n仕組みはわかりませんが、SkypeとFacebookの接続が他のソフトにも干渉していたようです。 Facebookに接続しないままSkypeを起動していると、ちょくちょくログアウトする事がわかりました。 微妙ですがしかたありません。 言い方は悪いですが、ChromeがフリーズしてしまうとOSを巻き込んでしまうので、強制的に再起動する必要があり、そうなれば10分以上ロスしてしまいます。 Social for Facebookを使い始めてからは調子も良いので、しばらくはこの方法で行きたいと思います。\nちなみに、Skypeのこのメッセージは余計なお世話だと思いませんか？\n","date":"2012-04-28T07:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/28/070000/","title":"Social for Facebookと新しくなったSkype"},{"content":"@nqounetです。\nPerlのスクリプトを書くときの「お約束」として、「use strict」などの色々を整理していたのですが、お約束として好ましくないことをしていた事がわかりました。\n:encoding(UTF-8) の代わりに単に :utf8 を使うことで、もしデータが 内部で既に UTF8 で表現されていれば、エンコードの手順を省略します。 これは、書き込むときにはよい振る舞いであると広く受け入れられていますが、 読み込むときには危険があります; なぜなら不正なバイト列を受け取ると 内部矛盾を引き起こすからです。 入力に :utf8 を使うとセキュリティ侵害を引き起こす可能性があるので、 どうか代わりに :encoding(UTF-8) を使ってください。\n[perlunifaq - Perl Unicode FAQ 【perldoc.jp】]\nずっと「:utf8」を好んで使っていたので、そちらをお約束にしていたのですが、入力に関しては「:encoding(UTF-8)」の方が良いようです。\n…とは言うものの、これはこれで微妙な気がします。\nここで言っている「不正なバイト列」というのは、具体的に何なのかがわかりません。\n言えることは、Perlの内部形式（あえて言うなら「utf8」）と文字コードの「UTF-8」は違うので、入力時には文字コードの「UTF-8」をdecodeするのがふさわしい書き方ということくらいです。\n本来ならば入り口でdecodeしなければならないのを、binmodeを使って簡略化している事が、そもそもお約束としては不適切なのかもしれません。\nPerl入学式でも文字コードの話題になると後回しにしているのですが、このあたりをどのように説明するのが良いのか悩みます。\n","date":"2012-04-27T07:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/27/070000/","title":"Perlのお約束"},{"content":"Bloggerは、カスタムドメインも使えるので便利ですね。 心機一転、これからもよろしくお願いいたします。\nhttp://blog.nishimiyahara.net ","date":"2012-04-26T23:18:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/26/231839/","title":"Bloggerに移転します"},{"content":"@nqounetです。\n一念発起して、ブログを移転することにしました。\n理由はいくつかあるけれども、大きな1つとしては、いつまでも「日曜プログラマ」ではイカンという事です。\n","date":"2012-04-26T15:01:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/26/150100/","title":"Bloggerを使うことにした"},{"content":" 今度のイベントで使うので、セッティングも含めて、ほんの少しだけ遊んでみましたよ。\n今日のところはセンサーバーの位置と音声が課題ですね。\n音声については本番時はいつものBGM用のを使うとして、センサーバーはもう少し何とかしたい所です。\n","date":"2012-04-26T11:02:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/26/110219/","title":"大画面でWiiをやってみた"},{"content":" 評価の中に「音楽についてはこれがあれば問題ない」という意見がありましたが、そのとおりだと思います。 私の好きな「ゴシック」についても数えきれないほどのチャンネルがありますしね。 http://itunes.apple.com/jp/app/rad.io/id402206359?mt=8\n","date":"2012-04-25T20:46:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/25/204654/","title":"本当に素晴らしい音楽アプリ「rad.io」"},{"content":"\n今まで知らなかったのが悔やまれる\n","date":"2012-04-25T19:52:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/25/195258/","title":"rad.ioがよい感じ"},{"content":"何故かよくわかりませんが、今日更新したXPERIAのFacebookアプリは、今までに比べてかなり良くなった感じです。 元が悪すぎという話もあるのですが、まず起動が速くなりました。通信も速くなった気がします。 カメラとも連動するようになったようで、Facebookに投稿するためのカメラアプリも付いています。しかし、タイミングによって「カメラがない」という意味不明なエラーも起こします。 ようやく、使ってもいいかも、という風に思いました。\n","date":"2012-04-25T14:42:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/25/144240/","title":"Android版Facebookアプリがかなり良くなった件"},{"content":" まあ、何にしても画像が簡単にアップ出来ればそれはそれで良いということで。\n","date":"2012-04-24T13:45:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/134516/","title":"なんか色々と失敗してますが"},{"content":" テンプレートを少し編集してやりました。 追記の部分も書くことができる（はず）です。 成功していれば、この部分が追記になっている予定です。\n","date":"2012-04-24T13:17:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/131718/","title":"何が何でもメールで画像を投稿する"},{"content":" 今更ながら、メールでブログを更新する方法を色々と試していました。\n最近は、写真のアップロードなどはTwitterにしろFacebookにしろとても簡単にできます。\nしかし、ブログに関しては意外と面倒です。\nということで、メールで添付した画像をサムネイル画像と共に表示してくれるようなものがないか探しました。\n結構あるのはあったのですが、ブログのシステム内に設置するタイプはうまく動かなかったり（設置しているサーバーの問題かもしれませんが）、ウェブサービスタイプのものも、画像がちゃんと入らなかったり、記事が更新されなかったり、思うように行きません。\nそんな中で、唯一私が使いたい機能をほぼ実現してくれたのが「ubicast Mail Blogger」でした。\n今のところウェブからGmailで送るのが最適です。シンプルなメーラーだとテンプレート機能もちゃんと動きます。\nHTMLメールだとそのまま表示できるようなので、iPhotoやMailで加工済みのものを送っても問題ないようです。\n複数の画像を添付するとどうなるのかをこの投稿で試してみます。\nSEE ALSO ubicast Mail Bloggerサービス ","date":"2012-04-24T12:52:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/125218/","title":"ubicastがなかなか良い感じ"},{"content":"\n","date":"2012-04-24T11:55:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/115517/","title":"桜の通り抜けに行ってきました"},{"content":"\n","date":"2012-04-24T11:25:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/112503/","title":"iPhotoから送ってみるテスト"},{"content":" さっきの記事は結局変だったので修正した。 Mailは余計なお世話をしてくれるソフトだな。\n","date":"2012-04-24T11:19:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/111908/","title":"Gmailから送ってみるテスト"},{"content":"テンプレートがちゃんと効いていなかった。 ブログの方を確認してみると、リッチテキストになっていた。 Mailの仕業なのか？\n画像\n","date":"2012-04-24T11:10:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/111054/","title":"勝手にリッチテキストになったのか？"},{"content":"この花の写真を何度投稿しただろうか？ ","date":"2012-04-24T11:00:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/110004/","title":"ubicastテスト"},{"content":"今更感満載ですが、モブログを使ってみる。\n","date":"2012-04-24T03:33:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/033307/","title":"モブログテスト"},{"content":"","date":"2012-04-24T01:36:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/24/013651/","title":"ちょいとテスト"},{"content":"@nqounetです。\n昨日（4月15日）はPerl入学式#4でした。\n主な内容としては、\n前回までのおさらい Perlの開発環境構築（perlbrewとcpanm）について CPANモジュールの紹介とインストールと実演と本の紹介（http://amzn.to/HaUNiS） 正規表現について（極簡単に） ハッシュについて リファレンスについて でした。\nスライドについて \u0026lt;\np\u0026gt;スライドはgithubで公開しています。\nPerl入学式#4 よく考えてみれば、正規表現とハッシュとリファレンスを一気にやってしまったというのは詰め込み過ぎだったかもしれません。参加された皆さんの理解が良くてほっとしました。\n今回、資料作成にあたっては、Learn Perl in about 2 hours 30 minutes、というページを参考にしました。\n特にPerlで難しいと言われている「リファレンス」をどのようにすれば理解してもらえるのかのヒントがありました。Perlのリファレンスの必要性を、複雑なデータ構造を実現するための手段として紹介したのは非常に良かったと思います。\n今回の反省点について 反省点としては、時間配分がかなり適当だったことです。\nやはり、問題を解いてもらう、というのは思っているよりも時間がかかります。解説にも時間がかかりました。おさらい問題をやったのですが、それが終わった時点で40分押し、という異常事態でした。\nしかし、他の部分で長く見積もっていたり、サンプルコードを書いてもらうつもりだった部分を省略したりして、なんとか時間内（と言っても最後の問題はできませんでした）におさめることが出来ました。\nまた、リファレンスの紹介として、スカラーのリファレンスや、矢印（-\u0026gt;）の省略の仕方も紹介したのですが、これらは別の機会にしたほうが良かったのかもしれません。スカラーのリファレンスには意味が無いのでは、というような話題にもなってしまったので。\n個人的な感想について 個人的には、プログラミング言語としてのPerlの魅力というよりも、Perl（特にCPAN）を使うことの利点について伝えることはできたんじゃないかと思います。\n最後の方は、自分で作ったスライドなのに読めなくて、思ったよりも消耗した感じでした。5時間は長いですね。次回からは3時間程度におさめる予定で考えたいと思います。\n","date":"2012-04-16T14:45:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/16/144551/","title":"Perl入学式#4で講師役をしてきました"},{"content":"@nqounetです。\n今回はMarkdownで書いてみようと思います。\nと言っても普通に見ている分にはわからないわけですが。\nさて、明日（4月15日）はPerl入学式#4です。今回の講師は私がやるということで、だんだん緊張してきました。\n会場は以前他の勉強会で行きましたので中の様子はわかっています。その勉強会に参加したお陰で、 今回は会場をお借りできることになりました。太っ腹ですね。\nレンタルサーバー｜Joe\u0026rsquo;sウェブホスティング ありがとうございます。今後ともよろしくお願いいたします。\n今回は、以前の資料作りを踏まえて、ちゃんとした（？）ツールを使っています。\nプレゼンをmarkdownで書いたらええやん - Clouder::Blogger yoshiki/markdown2impress こちらで紹介されているmarkdown2impressを使って作りました。\n資料を作っているうちに、変換作業が面倒になってきてMojolicious::Liteで動くように作り直しました。Markdownで作ったテキストデータを保存したらリロードすれば最新の状態で確認できるので便利に使いながら資料作りをしました。\n最初のうちはそれでよかったのですが、スライドを作っていると思わぬところでページが変わっていたりしたので、文書としては不自然でもプレゼン資料作りに特化するため、ページ区切りをわかりやすく（----------）にしました。\nコードをコピペして色々な部分を直接変更してしまったので、再利用とかあまり考えられなくなりましたが、とりあえず公開します。\n明日は、このツールを使ってやります。\nで、プレゼンツールとしてimpress.jsを使ってみたのも初めてなのですが、これはあまり長いプレゼンをするには不向きという感じがしました。今更ですが。\nmarkdown2impressは場所も自動で作ってくれて楽なのですが、impress.jsの特長を活かすには、ページごとに場所をきっちりと指定したほうが面白いです。なので、配置などは細かく設定するほうが良いと思います。このツールではHTMLのコメントでデータを書いておくと、そのデータで座標や倍率を設定してくれるので、カスタマイズは簡単にできます。よく考えられていると思いました。\nしかし、結局100ページ以上になってしまった（時間足りるのか心配）のですが、アニメーションがうざいです。このアニメーションが活かせるのはLTのように短時間で終わるようなプレゼンだと思います。数枚程度であれば凝った演出も面白い（特にz軸の指定は楽しい）でしょう。インパクトもあるし。\nあと、これはツールを使いこなしていないだけかもしれませんが、全体の確認が難しいです。この感じがするのはShower Presentation Templateを使った時に便利だと思った（escボタンで可能）からだと思いますが、枚数が多くなってくると全体を1画面に収めるのは不可能（というかちゃんと見えない）でoverviewのスライドを使っても俯瞰するのが難しかったです。俯瞰がちゃんと出来ないと特定のページにジャンプするのが難しいので、あのページどこ行った、みたいな時に困ります。\nということで、impress.jsは100ページ超のプレゼンツールとしては不向きだと思いました。今回は特定のページにジャンプするようなことがなければ良いのですが…。\n","date":"2012-04-14T14:55:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/04/14/145502/","title":"明日はPerl入学式#4です"},{"content":"@nqounetです。 この前の土曜日（3月17日）に、「Kyoto.pm Tech Talks」で、半年ほど前に書いたネタでしたがPJAXをMojoliciou::Liteで書いた件について発表してきました。 Perlのネタを話すのは初めてで、スライドも何で作ろうか、色々と探してみました。 その結果、わりとシンプルな「shower」というHTMLベースのスライドテンプレートを使うことにしました。 HTMLを書くのは面倒だったので、これもMojolicious::Liteでオレオレツールを作って、テキストからHTMLを生成しながら作るようにしました。 プレゼン資料 http://nqounet.github.com/presentation/20120317_kyotopm/index.html ソースコードを表示する部分が結局面倒でしたので、次はちゃんとMarkdownで書けるツールを使いたいなと思います。 Yappoさんが使っていたのですが、Markdownからimpress.js用に出力できるツールがある（ https://github.com/yoshiki/markdown2impress ）ので、次はこれを使おうと思います。\nSEE ALSO pepelsbey/shower プレゼンをmarkdownで書いたらええやん - Clouder::Blogger 最初のほうで発表が終わったので、後半はのんびりと聞いていました。 気になったキーワードとしては、\nAcmeのソースコードの技術力 markdown2impress Perlモジュールの共同開発（TengとかGuitaとか） Data::Mapper 正月発火村（温泉発火村） Acme::Nikuria perldoc.jpのデザイン です。 この他にも、業務が捗るツールの話題とか色々ありました。 特に、温泉発火村については、どこかでやってみたいというか、主催するなら実家を利用して企画したいと思いました。 モノづくりのモチベーションは、作ったものを使ってくれている、役に立っている、という周りの反応で維持できている部分もあります。 Perlモジュール（ソフトウェアと言ってもいいと思いますが）もそうです。 TengやGuitaもそうですが、使う人も作ることに参加できるようなコミュニティを、どんどん日本の中でも広めていきたい、という話にとても共感しました。 ソフトウェアを使っているならば、使っていることを積極的に発言していくのも良いことだと思います。 なので、私もどんどん発言（アウトプット）していこうと思います。\n","date":"2012-03-20T18:27:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/03/20/182754/","title":"「Kyoto.pm Tech Talks #01」でPJAXについて発表してきました"},{"content":"nqounetです。 最近Macの調子が悪く、頻繁にフリーズするようになりましたが、皆さまいかがお過ごしですか？ LibreOfficeでダイアログがうんともすんとも言わない状態になってハマったので、また、いつか困ったときのために書いておきます。 MacではLibreOfficeを使っているのですが、フリーズからの回復（というか強制再起動）のために、コマンド＋コントロール＋電源ボタンで再起動していたいました。 その時、どんなタイミングなのかよくわかりませんが、LibreOfficeを起動すると「復元中に強制終了しました。復元しますか？」とダイアログが出てくるのですが、復元しない、と、復元する、のどちらを選んでも無限ループ状態で何も起きない、という状態になっていました。 ファイルの閲覧くらいは問題ないのですが、起動するたびに強制終了（コマンド＋オプション＋escキー）を選択しなければならないので、かなり鬱陶しい感じになっていました。 ウェブで調べても探し方が悪いのか、欲しい記事には行き着きませんでしたので、途方にくれていたのですが、ふと気づいてアクティビティモニタから何かわかるかもしれないので、調べてみました。 すると、怪しげな（？）ファイルを開いているのを発見しました。 /Users/nobu/Library/Saved Application State/org.libreoffice.script.savedState/data.data 名前からして「アプリケーションの状態を保存」してそうなので、このファイルをさっくりと消しました。 そして、恐る恐るLibreOfficeを開いてみると、例のダイアログは出て来ません！ 勝ちました。\n","date":"2012-03-14T14:30:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/03/14/143010/","title":"MacのLibreOfficeで復元中の強制終了でハマった件"},{"content":"今日（もう昨日ですが）、新大阪コワーキングで「Perl入学式#2補講」を開催しました。 今回も、もちろんサポート役です。 講師はpapixさん（https://twitter.com/#!/__papix__）でした。 新大阪コワーキングはこじんまりしている分、あまり動きまわることもなかったのですが、なかなか鋭い質問が多く、タジタジになってしまいました。 質問の中には「既にインストールされているモジュールはどうやって調べるのか」という、前回と同じ質問が出ました。 私は、プログラムを実行してみてモジュールがなければインストールする、という風にしていて、前回も今回も同じ回答をしました。 そう答えてはみたのですが、それが何故なのかを考えてみました。 必要なモジュールはインストールして使うもの、という感覚が身についているから、なのかなぁ、と自問自答です。 インストールしてあろうがなかろうが、必要なモジュールがあれば、CPANを使ってインストールして使う、というのがPerlを使う、ということだと思っていますので、インストールされているかどうかは重要ではないのかな、と思います。\n","date":"2012-03-12T02:05:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/03/12/020527/","title":"Perl入学式#2補講に行ってきました"},{"content":"この前の土曜日、Perl入学式#2に行ってきました。 サポート担当ということで、Twitterのハッシュタグ「#Perl入学式」を監視したり、会場をウロウロしたり、会計っぽいことをやったりしました。\n1では、Perlの環境構築をしたり、YAPC::Asiaの紹介をしたりして、Perlの世界を感じてもらう感じでしたが、今回からはいよいよ文法に入りました。 今回の講師役は@kiyotuneさんでした。 1週間ほど前に、私が主宰している新大阪コワーキングに来て、ほぼ1日缶詰状態でテキストを作っていました。 色々と話をしながら最終的にまとまったものは、ものすごいボリュームで、これを入門者向けに伝えるのは難しいなぁ、と、改めて入門者向け勉強会の難しさを感じました。 それと同時に、その大量なテキスト作成をしていただいたkiyotuneさんには大変な負担をかけたと思います。 本当にありがとうございました。\nSEE ALSO Perl入学式 イベント/Perl入学式#2報告 - Kansai.pm シバン (Unix) - Wikipedia Perlでの複数行コメント リストと配列(Array)はPerlでは別物 - Togetter 特に難しいのはお約束の部分。 use strict;とかuse warnings;は、とりあえず書いとけ、くらいでも良いと思いますが、説明をするとオプションも含めて大変なことになります。 軽く流しながら解説をしていましたが、かなり難しかったのではないかと思います。 やはり最初は、とりあえず書いとけ、で良かったのでしょうね。 それと「動かない」という説明をしていても、実際には動いてしまうことがあります。 スクリプトファイルの1行目（Shebang）の「#!」と実行プログラムパスの間にはスペースをスペースがあると動かない、と説明していたのですが、実際には半角スペースがあっても動いてしまうのです（私の環境でも動きました）。 また、「\u0026quot;（ダブルクォーテーション）」の中で改行を入れるとエラーになる、という説明もしていたのですが、実際には改行していても動いたりしてます（私の環境でも動きました）。 同じPerlでも、環境によって若干の動作の違いがあるので、そういう部分の説明も難しいと思いました。\n1 2 3 4 5 #! /usr/bin/env perl use strict; use warnings; print \u0026#34;Hello, world!\\n\u0026#34;; 個人的には「自力で学習している時にわからないところ」を上手く伝えられたらなと思っています。 例えば、クォーテーションの種類。 「\u0026quot;（ダブルクォーテーション）」と「\u0026rsquo;（シングルクォーテーション）」の違いを説明した時に、ついでに「q」や「qq」によるクォーテーションもあることを説明しても良かったなと思いました。 検索でヒットしたコードには、おそらくこういう書き方をしていることがあると思います。 他にも、休憩時間に、複数行に渡ってコメントしたい時はどうするの？、ということを訊かれました。 なので、POD機能を使ったコメントを伝えてみました。 他言語の経験者は、既に知っている言語との比較で覚えるほうがわかりやすいと思いますので、この機能をPerlではどうやるの？、というような切り口も良いかもと思っています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #! /usr/bin/env perl use strict; use warnings; use utf8; =pod # binmode STDOUT, \u0026#34;:encoding(utf8)\u0026#34;; binmode STDOUT, \u0026#34;:utf8\u0026#34;; my $greeting = \u0026#34;\u0026lt;一度目の挨拶\u0026gt;\\n\u0026#34;; print $greeting; ここはコメント =cut print \u0026#34;#print\u0026#34;; # コメント; print qq{pr\u0026#34;int\\n}; print q{pri\u0026#34;nt\\n}; print qq/ds\\n/; また、配列とリストの違いについては、一応知っていたつもりでしたが、知らないこともあって勉強になりました（「ハッシュのキーにリストを渡す」ことが出来るのは知りませんでした。必要な時は事前にキーを作ってから渡していました）。\n1 2 3 4 5 6 7 8 9 10 #! /usr/bin/env perl use utf8; use 5.12.1; use Data::Dumper::Concise; my %hash; $hash{qw/1 2 3/} = \u0026#39;hoge\u0026#39;; say $hash{qw/1 2 3/}; say Dumper \\%hash; my $var = scalar (2,4,6,8); say $var; 最後に演習問題をやったのですが、その問題を解くのがなかなか面白かったですね。 実際の回答は、@__papix__さんがライブコーディングで実施したのですが、このやり方は面白いと思うので、続けていきたいですね。 まあ、問題を作るのは大変だと思いますが。 Perl入学式#2は収穫の多い勉強会になりました。 懇親会では、今回一緒にサポートをしてもらった@shiba_yu36さんや@hisaichi5518さんと意見交換をしたり、その場のノリでKyoto.pmで発表する事になったりしました。 Twitterでも何度もつぶやいていますが、今年の関西はPerlが熱いです。 個人的にはPerl入学式に深く関わったり、Kyoto.pmで発表することになったり、Kansai.pmのオフィシャルサイトの編集にも関わったりして、Perlコミュニティに少しでも貢献できているのを楽しんでいます。 そして、もっと関西をPerlで熱くしたいです。\n","date":"2012-02-27T03:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2012/02/27/030000/","title":"Perl入学式#2に行ってきました"},{"content":"毎年読むだけだった「Perl Advent Calendar Japan」に、今年は記事を書きました。 あくまでカジュアルにモジュールを使う感じで書いています。 「CGI=Perl」と思っている方はまだまだ多いと思いますので、少しでも最近のPerl（Modern Perl）を感じてもらえたらなぁ、という気持ちで書きました。\nSEE ALSO Perl Advent Calendar Japan 2011 Casual Trac\nData::Section::Simpleで__DATA__をカジュアルに使おう！ - Perl Advent Calendar Japan 2011 Casual Track ","date":"2011-12-24T13:30:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/12/24/133031/","title":"「Perl Advent Calendar Japan 2011」に記事を書きました"},{"content":"Mojoliciousで、必ずhttpsの状態でアクセスされるように、こんな感じのコードを書いていたのですが、思ったように動かなくて困りました。 schemeの部分がhttpsにならなくて、無限ループになっていました。\n1 2 3 4 5 6 7 8 # NG if ( $self-\u0026gt;req-\u0026gt;is_secure ) { $self-\u0026gt;redirect_to(\u0026#39;/login\u0026#39;); } else { my $url = $self-\u0026gt;url_for(\u0026#39;/login\u0026#39;)-\u0026gt;scheme(\u0026#39;https\u0026#39;); $self-\u0026gt;redirect_to($url-\u0026gt;to_abs); } schemeは属性（attribute）という風になっていたし、オブジェクトの中身を見ても、schemeは値を持っているように見えたので、何故変更できないんだろう、と思っていました。 色々試しているうちに、to_absが文字列を返すのではないことに気づきました。 なんとなく、文字列を返すメソッドだと思っていたのですが、実際にはオブジェクトを返しています。 文字列を返しているように見えたのは、実際にはto_stringが呼ばれていたからです。 敗因は、to_absが何を返すのかを理解できていなかった事です。 実は、to_absを呼んだ時点で、現在のbaseになるURLがcloneされるので、先に設定した（つもりの）schemeが無視されてしまうようです。 つまり、schemeを設定しようと思えば、まずto_absで絶対URLオブジェクト（？）にしておいてからやれば良い、ということですね。\n1 2 3 4 5 6 7 8 # OK if ( $self-\u0026gt;req-\u0026gt;is_secure ) { $self-\u0026gt;redirect_to(\u0026#39;/login\u0026#39;); } else { my $url = $self-\u0026gt;url_for(\u0026#39;/login\u0026#39;)-\u0026gt;to_abs-\u0026gt;scheme(\u0026#39;https\u0026#39;); $self-\u0026gt;redirect_to($url); } 思い込みって怖いですね。\nSEE ALSO Mojo::URL - search.cpan.org ","date":"2011-10-04T12:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/10/04/120000/","title":"Mojo::URLでschemeが変更できなくて困っていた話"},{"content":"つい最近知ったのですが、history.pushStateとAJAXを組み合わせた、PJAXというjQueryのプラグインがあるようです。 PJAXは、history.pushStateでヒストリーを作りながらAJAXでページを遷移させずに更新することで、従来のAJAXの問題点をクリアさせるものです。\n「戻る」もOK ソーシャルにも優しく クローラーへも対応 Javascript offのユーザもOK — 第19回html5とか勉強会 pjax\n問題点が解決できるのであれば、採用しない手はないですよ、って事で、Mojolicious::Liteで書いてみました。\nSEE ALSO pjax こそが pushState + Ajax の本命 - punitan (a.k.a. punytan) のメモ こてさきAjax:RESTfulなAjaxを実現する pjax - livedoor Blog（ブログ） pjax pjaxの本体は「defunkt/jquery-pjax - GitHub」からダウンロードして「public/js/jquery.pjax.js」に保存しておきます。 サンプルでは、PJAXでアクセスしているのかを確認する意味で、普通にアクセスした時に「layout is default.」という表示を出すようにしています。 サンプルコードはこちら\n","date":"2011-09-27T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/09/27/060000/","title":"うわさのPJAXをMojolicious::Liteで書いてみた"},{"content":"mixiページが始まってから、また、mixiを使うようになりました。 …少しだけですが。 で、コミュニティのトピックを見ていた時に、画像を一つ一つクリックして見るのが面倒になったので、どうにかならないかと思って書きました。\nSEE ALSO Kenichi Ishigaki / WWW-Mixi-Scraper - search.cpan.org WWW::Mixi::Scraperを使いました。 WWW::Mixi::Scraper::Plugin::ViewBBSを見てみたところ、トピックのサブジェクトの画像は取得しているのですが、コメントの画像は取得していないので、取得するように改造しました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- WWW-Mixi-Scraper-0.33/lib/WWW/Mixi/Scraper/Plugin/ViewBBS.pm\t2011-09-20 09:43:10.000000000 +0900 +++ lib/WWW/Mixi/Scraper/Plugin/ViewBBS.pm\t2011-09-18 00:07:30.000000000 +0900 @@ -53,7 +53,9 @@ name =\u0026gt; \u0026#39;TEXT\u0026#39;; process \u0026#39;dd\u0026#39;, description =\u0026gt; $self-\u0026gt;html_or_text; - result qw( link name description ); + process \u0026#39;dd\u0026gt;div.communityPhoto\u0026gt;table\u0026gt;tr\u0026gt;td\u0026#39;, + \u0026#39;images[]\u0026#39; =\u0026gt; $scraper{images}; + result qw( link name description images ); }; $scraper{list} = scraper { @@ -77,6 +79,7 @@ # incompatible with WWW::Mixi to let comment links # look more \u0026#39;permanent\u0026#39; to make plagger/rss readers happier + $comment-\u0026gt;{images} = WWW::Mixi::Scraper::Plugin::_images( $comment-\u0026gt;{images} ) if defined $comment-\u0026gt;{images}; $comment-\u0026gt;{name_link} = _uri( $comment-\u0026gt;{link} ); $comment-\u0026gt;{link} = $stash-\u0026gt;{link} ? _uri( $stash-\u0026gt;{link} . \u0026#39;#\u0026#39; . $comment-\u0026gt;{subject} ) その上で、画像に直接アクセスするように、Pluginを2つほど追加しました。 lib/WWW/Mixi/Plugin/ShowBBSPicture.pm\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package WWW::Mixi::Scraper::Plugin::ShowBBSPicture; use strict; use warnings; use WWW::Mixi::Scraper::Plugin; use WWW::Mixi::Scraper::Utils qw( _uri ); validator {qw( id is_number comm_id is_number number is_number )}; sub scrape { my ($self, $html) = @_; my %scraper; $scraper{picture} = scraper { process \u0026#39;img\u0026#39;, link =\u0026gt; \u0026#39;@src\u0026#39;; result qw( link ); }; # bbs picture my $stash; $stash-\u0026gt;{link} = _uri($scraper{picture}-\u0026gt;scrape(\\$html)); return $stash; } 1; lib/WWW/Mixi/Plugin/ShowBBSCommentPicture.pm\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package WWW::Mixi::Scraper::Plugin::ShowBBSCommentPicture; use strict; use warnings; use WWW::Mixi::Scraper::Plugin; use WWW::Mixi::Scraper::Utils qw( _uri ); validator {qw( bbs_id is_number id is_number comm_id is_number number is_number )}; sub scrape { my ($self, $html) = @_; my %scraper; $scraper{picture} = scraper { process \u0026#39;img\u0026#39;, link =\u0026gt; \u0026#39;@src\u0026#39;; result qw( link ); }; # bbs picture my $stash; $stash-\u0026gt;{link} = _uri($scraper{picture}-\u0026gt;scrape(\\$html)); return $stash; } 1; これらを踏まえた上で、以下が本体です。 ./get_mixi_photo.pl http://mixi.jp/view_bbs.pl?id=38584544\u0026amp;comm_id=6896\u0026amp;page=all という感じに使います。 Config::Pitについては「パスワード設定をコードに書かない(Config::Pit) - モダンなPerl入門 - モダンなPerl入門」を参考にしてアカウント情報を入力してください。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 #!/usr/bin/env perl #ｕｔｆ８ use utf8; use 5.12.1; use WWW::Mixi::Scraper; use lib \u0026#39;lib\u0026#39;; use Digest::MD5 qw( md5_hex ); use Encode; use Config::Pit; my $config = pit_get( \u0026#39;nqounet@mixi.jp\u0026#39;, require =\u0026gt; { email =\u0026gt; \u0026#39;username@domain.com\u0026#39;, password =\u0026gt; \u0026#39;password\u0026#39;, }, ); use Log::Handler; my $log = Log::Handler-\u0026gt;new( file =\u0026gt; { filename =\u0026gt; \u0026#39;log/app.log\u0026#39;, utf8 =\u0026gt; 1, maxlevel =\u0026gt; \u0026#39;info\u0026#39;,# \u0026#39;debug\u0026#39;, timeformat =\u0026gt; \u0026#39;%Y/%m/%d %H:%M:%S\u0026#39;, message_layout =\u0026gt; \u0026#39;[%T][%L] %m (%C)\u0026#39;, }, ); my $mixi = WWW::Mixi::Scraper-\u0026gt;new( mode =\u0026gt; \u0026#39;TEXT\u0026#39;, %{$config}, ); my $topic = shift(@ARGV); $log-\u0026gt;die(\u0026#39;Usage: ./get_mixi_photo.pl topicURL\u0026#39;) unless $topic; my @list = $mixi-\u0026gt;parse( $topic ); $log-\u0026gt;dump( debug =\u0026gt; \\@list ); # トピックのタイトル my $dir = md5_hex( Encode::encode_utf8( $list[0]{subject} ) ); mkdir $dir; open my $fh, \u0026#39;\u0026gt;:utf8\u0026#39;, qq{$dir/info.txt} or $log-\u0026gt;die( qq{Can not open $dir/info.txt.} ); print $fh $list[0]{subject}; close $fh; # トピックのトップ画像 for my $item ( @{$list[0]{images}} ) { $log-\u0026gt;dump( debug =\u0026gt; $item-\u0026gt;{link} ); my @urls = $mixi-\u0026gt;parse( $item-\u0026gt;{link} ); for my $url ( @urls ) { save_url_image( $url, $dir ); } } # 各コメントの画像 for my $comment ( @{$list[0]{comments}} ) { for my $item ( @{$comment-\u0026gt;{images}} ) { $log-\u0026gt;dump( debug =\u0026gt; $item-\u0026gt;{link} ); my @urls = $mixi-\u0026gt;parse( $item-\u0026gt;{link} ); for my $url ( @urls ) { save_url_image( $url, $dir ); } } } # 保存一式 sub save_url_image { my ($url, $dir) = @_; my $link = $url-\u0026gt;{link}-\u0026gt;as_string; $log-\u0026gt;dump( debug =\u0026gt; $url-\u0026gt;{link} ); my ($ext) = $link =~ /(\\.[a-zA-Z]+)$/ms; $log-\u0026gt;dump( debug =\u0026gt; $ext ); $ext = \u0026#39;.jpg\u0026#39; unless $ext; my $filename = md5_hex( $link ) . $ext; return if -f qq{$dir/$filename}; my $content = $mixi-\u0026gt;{mech}-\u0026gt;get_content( $url-\u0026gt;{link} ); $log-\u0026gt;dump( debug =\u0026gt; $content ); open my $fh, \u0026#34;\u0026gt;:raw\u0026#34;, qq{$dir/$filename} or $log-\u0026gt;die( qq{Can not open $dir/$filename.} ); print $fh $content; close $fh; } ","date":"2011-09-20T08:56:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/09/20/085657/","title":"mixiのコミュニティのトピックから画像をダウンロードするスクリプトを書いた"},{"content":"sakuraサーバーのプレミアムプランを契約したので、早速cpanmをインストールしようと、以前まとめた内容でやってみました。 1行目からアウトでした。 ということで、curlを使ったやり方に変更し、2行目までを同時に実行しようとしました。\n1 curl -L http://cpanmin.us | perl - --local-lib=~/perl5 local::lib App::cpanminus ところが、local::libが上手く入りません。 幸い、cpanmは入ったので、コレでいいかと思っていたのですが、シェルで使ったときに何かと不便な（PATHが通っていなかったり、「-l ~/perl5」を毎回指定しなければいけなかったり、@INCに「/home/username/perl5/lib/perl5」が追加されなかったり）ので、まずはそれらの設定を手作業でやりました。 ホームディレクトリの「.cshrc」を開いて、 set path = (/sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin) となっていた部分に「$HOME/perl5/bin」を追記して、以下のようにしました。\n1 set path = ($HOME/perl5/bin /sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin) で、あとは適当な所に以下の2行を追記しました。「username」は適宜読み替えてください。\n1 2 setenv PERL_CPANM_OPT \u0026#34;-l ~/perl5\u0026#34; setenv PERL5LIB \u0026#34;/home/username/perl5/lib/perl5\u0026#34; その状態だと、local::libがすんなりと入ったので、実際にはこうすればよかったのでは？というのを次回のために書いておきます。 うまくいくかどうかはわかりません。\n1 2 curl -L http://cpanmin.us | perl -I$HOME/perl5/lib/perl5 - --local-lib=~/perl5 local::lib App::cpanminus echo \u0026#39;eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)\u0026#39; \u0026gt;\u0026gt; ~/.cshrc どうでしょうね、コレ。\n","date":"2011-09-10T14:28:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/09/10/142843/","title":"sakuraサーバーでcpanmを快適に使うまでにしたこと、あるいは、2行でcpanmを使う方法"},{"content":"先日購入したばかりのMacBookProですが、妻曰く、無償アップデートの対象の可能性があるということでオフィシャルに行って確認してみました。 購入日と購入した店舗、シリアルナンバー等を入力してチェックしてみると、対象になっていました。 促されるまま、Appストアを起動すると、コードの入力画面になり、入力後ダウンロードが開始しました。 そんなこんなでダウンロード完了（これが、結構かかりました\u0026hellip;）し、インストールも無事完了（これは40分弱くらいでした）しました。\n事前に調べたところ、トラックパッドのスクロールが逆になったということで、早速変更しました。 しかし、Launchpadを起動させると、雰囲気がまるでタブレットだったので、結局元に戻しました。 トラックパッドではなく、タッチパネルなのだと思うようにしたのです。\n","date":"2011-07-23T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/07/23/060000/","title":"MacOSX Lionにアップデートした"},{"content":"デジカメや携帯で写真を撮ったのをパソコンに取り込むのって、結構面倒です。 まあ、MacだとiPhotoに任せてやればいいのかもしれませんが、正直なところiTunesに曲の管理を任せるのも微妙に思える今日この頃。 写真の管理くらいは自分でやっておきたい、と思うわけです。 なので、自力で（というかiPhotoを使わずに）整理するために必要なソフトを探していました。 で、ようやく使い方にフィットしたソフトを見つけることができたので、書いておこうと思います。 今の時点で使っているのは、「Shupapan」と「Th-MakerX」です。 どちらも結構気に入っています。 以下は暇な方だけどうぞ。 デジカメで撮った写真をパソコンに取り込むと、次に写真を撮ると番号がリセットされる場合があります。 今使っているもので言うとXPERIAがそうです。 なので、そのままコピーすると、上書きしてしまうので名前を変えてやる必要があります。 名前は撮影日時にしておくのが重複しなくて良いかなと。 今のところ、毎秒何枚というような高速撮影はできないので、「年月日時分秒」で、14桁の名前にしています。 そして、最近は特にそうですが、ブログなどにアップロードするのに画像のサイズを縮小したい。 一時は、縮小した後の画質にも（わからないなりに）こだわっていたのですが、よほど変でなければ問題ない、と思えるようになりました。 簡単にまとめて処理したいので、操作のシンプルさの方を優先したい。 それらの条件を踏まえて、Windowsで使っている（いた？）のは、「Flexible Renamer」と「縮小専用」です。 「Flexible Renamer」は、なによりEXIF情報から撮影日時を拾ってくれるのが良いですね。 あと、その名のとおり、結構細く設定もできる（正規表現も使えます）ので、他の用途にも使ってます。 「縮小専用」はフィット機能（任意のボックスサイズ内に収める）が気に入って使っています。 色々ソフトを使ってきましたが、この機能は見かけなかったと思います。 フリーソフトに慣れてしまっている私は、Macを使い始めて、色々と探しました。 リネームソフトの「Shupapan」の方は早い段階で見つかりました。 プリセットを作れるのが良いですね。 画像の縮小はなかなか気に入ったのがありませんでした。 Windowsで使っている「縮小専用」のMac版（Adobe AIR版）も使ってみたのですが、いまいち不安定でした（特に大きいサイズのもの）。 で、Vectorで「Th-MakerX」を見つけました。 Vectorも最初に見ていたと思うのですが、見落としていたのでしょう。 このソフトは、フィット機能があるのはもちろん、プリセットを設定できるのが良いですね。 サムネイル用と画面表示用で切り替えて使えて便利です。 Macはフリーソフトが少ないイメージでしたが、探せば良いものがありますね。\nSEE ALSO Sunskysoft - Shupapan｜Shupapan Th-MakerX Flexible Renamer 縮小専用。 - i-section.net ","date":"2011-07-06T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/07/06/060000/","title":"写真の整理に使っているMacOSXのフリーソフト"},{"content":"以前、CORESERVERにconcrete5をインストールしたわけですが、ちょっと前に、同じサーバー（しかし、ドメインは別）にconcrete5で新しくウェブサイトを作りました。 で、新しいサイトを作るとき、プログラムのファイルを一式まるごとインストールしたんですが、ソースコードを眺めたり色々と触っているうちに、プログラムファイルを使いまわせそうな感じがしたので、もともとインストールした方で試してみました。 ちなみに、この記事は「concrete5.4.1.1.1.ja」について書かれています。 他のバージョンでは違うかもしれません。\nやり方は、元あったconcreteディレクトリ以下を削除し、concreteという名前で別のconcreteディレクトリにリンクさせるだけです。 おそらく、httpd.confまたは.htaccessでFollowSymLinksな環境は必要だと思います。\n1 2 $ rm -rf concrete/ $ ln -s /path/to/concrete_dir concrete まだ、簡単な動作確認しかしていませんが、今のところ問題なく動作しているように見えます。 concrete5自体の設定は、完全にインストールした状態で行い、後から上記の操作をしています。 もちろん、データベースの設定はそれぞれ違います。 なお、試してみる場合は自己責任でお願いします。 以下、経緯です。 使い回しができるような気になったのは「concrete/config/base.php」に、\n1 2 3 4 # if \u0026#34;concrete/\u0026#34; does NOT exist in DIR_BASE then we set multi_site to on if (!is_dir(DIR_BASE . \u0026#39;/\u0026#39; . DIRNAME_APP)) { define(\u0026#34;MULTI_SITE\u0026#34;, 1); } このようなコードがあったからです。 それでググってみたのですが、マルチサイト運営はできるような記述はありました。\nまた、 concrete5 は、複数のサイトを運営出来るマルチサイトの機能が備わっております。 Concrete CMS, inc. では、「ホスティングパートナープログラム」に加入していただく事により、マルチサイト運営のためのサーバー設定の情報などを提供しています。また英語のみになりますが、コアー開発チームから、直接サポートを受ける事が出来ます。 はじめにお読み下さい :: concrete5日本語公式サイト\nまあ、レンタルサーバーでconcrete5を簡単インストールする、というようなサービスをやる場合、マルチサイトで運営できるのは非常に便利ですよね。 閑話休題。 今まで色々見たり聞いたりしている中でconcrete5は、カスタマイズする場合、プログラムは直接触らずに、ルートディレクトリにある各種ディレクトリにプログラムファイルをコピーして、そのファイルを触る、というように、スクリプトの優先順位がつけられているようです。 つまり、プログラム一式は全く変更せずにカスタマイズできる、ということです。 まあ、たぶん。 それと、上記のソースから判断すると、メインとなるプログラム一式が入っているディレクトリがない場合に「MULTI_SITE」が1に設定される。 ということで、（片方は実験サイトなので）思い切ってconcreteディレクトリを消し、index.phpには別のプログラム一式にあるdispatcher.phpへのパスを書いたのです。\n1 2 \u0026lt;?php require(\u0026#39;/path/to/concrete_dir/dispatcher.php\u0026#39;); 実行してみると、エラーにはならないのですが、ログインしている状態なのにメニューが出ません。 画像ファイルなどを参照する場所もどうもおかしい。 単純に消すだけではなく、何らかの設定をする必要があるのでしょう。 と、ここまでやってから、シンボリックリンクで出来るんじゃないかと思ったのです。 そこで、上記のようにconcreteというシンボリックリンクを作って実行してみると、元の通り実行できました。 concreteディレクトリは、ローカルでサイズを見てみると25MB以上あります。 最近は、レンタルサーバーの容量も大きいので大したことはないですが、ちょっとした節約にはなりますね。\n","date":"2011-07-05T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/07/05/060000/","title":"concrete5のプログラムファイルを使い回す方法"},{"content":"WindowsでずっとPerlをやってきたわけですが、Mac（OSX）になって大きく違いを感じるのが、改行コードとパーミッションです。 改行コードの問題については分かっていたはずなのですが、FFFTPの設定によってテキストモード（ASCIIモード）でアップロードされるので、あまり意識していませんでした。 昔は、エディタの改行コードをUNIXタイプ（LF）という風に設定していたのですが、いつの間にかWindowsタイプ（CRLF）になっていたようです。 で、Macになってローカル環境で実行したときに、こんなエラーが出たので、改行コードの違いに気づきました。\n1 /usr/bin/perl^M: bad interpreter: No such file or directory そこで思い出したのが、改行コードを変更するワンライナーでした。 と言っても、ワンライナー自体を思い出したのではなく、そういうワンライナーがある、という記憶を思い出しただけです。 ググって調べた結果に、少しの知識を加えてできたのが、以下のワンライナーです。\n1 $ find . -name \u0026#34;*.cgi\u0026#34; | xargs perl -i.bak -pe \u0026#34;s/\\x0d\\x0a/\\x0a/g\u0026#34; ググッてみると、最後の「g」がなかったり、\\x0dと\\x0aの事を「\\r」「\\n」という風に書いていたり、という、ちょっと残念な感じのワンライナーもしばしば見受けられました。 本文のすべての改行を変更するので、置換処理の繰り返し「g」は必要だろうし、\\rや\\nは改行コード自体を置換するのには不向き、という話があったと思うので。 また、0d0aは時々8進数で（\\015\\013とか。）書いてあったりするのですが、私の中では16進数で覚えていることもあって、とっさに8進数では出てこないです。 で、このワンライナーを実行すると、バックアップファイルを作成してもらえるので、もし何かあっても安心ですね。 バックアップファイルを消すときは、こんな感じで。\n1 $ find . -name \u0026#34;*.cgi.bak\u0026#34; | xargs rm あと、ローカル環境で戸惑うのが、パーミッションです。 今まで、あまりにも意識しなさ過ぎたということがよくわかります。 サーバー一式は、結構頑張って設定していたのですが、結局上手くいかなくて、最終的にはXAMPPに落ち着きました。 Apacheの設定は難しいですね。 で、そのローカルサーバーにアクセスすると、500エラーなわけです。 それで、XAMPPのサーバーのログを見ることになるわけですが、大体が「Permission denied」という事になっていて、ガックリです。 例えば「*.cgi」なファイルは、自動的に実行可能状態で保存するようなソフトはないんでしょうかね。\n","date":"2011-07-04T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/07/04/060000/","title":"Windowsでテキストを扱う時も改行コードはLFにしようと思った話と、パーミッションの変更が面倒な話"},{"content":"試したのは4つ。\njquery.crypt.js MD5とSHA1等を計算するプラグイン MD5 hash algorithm function | jQuery Plugins MD5を計算するプラグイン Identicon5 | jQuery Plugins MD5の計算結果を画像に変換するプラグイン Chroma-Hash | jQuery Plugins パスワード入力等で入力された値をハッシュ化して画像で表示するプラグイン 面白かったのは、Identicon5ですね。 文字列よりも画像のほうが違いがよくわかります。 そういう意味では、Chroma-Hashも違いはわかるのですが、ちょっと地味な感じでした。 プラグインとしては、使い方が非常にシンプルなので、使ってみても面白いと思います。 計算のプラグインですが、機能的にはjquery.crypt.jsの方が多機能ですが、プラグインとしては、妙に使いにくい感じでした。 「MD5 hash algorithm function」は、機能はシンプルで、普通の関数のように扱えるのは便利ですね。\n","date":"2011-07-03T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/07/03/060000/","title":"ハッシュ系jQueryプラグインをいくつか試してみた"},{"content":"「複数のFeedを読み込んで、時系列に並べて表示させる」ということをやりたかったわけですが、意外なことにgoogleリーダーで簡単にできることがわかりました。 細かいやり方は参考ページを見ていただければよくわかるので割愛。 グループを作るとFeedをまとめてくれるのはさすがです。\nSEE ALSO mixiやfacebookに。複数ブログを一つのRSSにまとめる技 | [b] bizMode｜世界のデジタルトレンドを読む（@shinojapan） 最初は、Facebookに書き込んだ内容と、いくつかのブログ、そしてTwitterのFeedをすべてまとめようと考えました。 で、昨日の時点では、Facebookを中心にして、FacebookのFeedを読み込む、ということにしたのですが、Facebookが出すFeedはあまり親切ではありませんでした。 Facebook内での写真のアップロードにタイトルをつけてくれないのです。 ブログに写真をアップしてアルバム化するよりも、はるかに簡単に出来る（ファイル名は考えなくていい、リンクを作らなくていい、）ので、これから使っていこうと思ったのですがちょっと残念です。 その点、googleリーダーの場合は、本文から持ってくるのか、適当にタイトルをつけてくれます。 ということで、今のところはgoogleリーダーから読み込むようにしています。 ただ、理想としては、Facebookを中心にしたいんですよね…。 そうなると、写真をアップするのは、それ専用のサービス（instagramとかpicplzあたり？）を使ったほうが良いのかもしれません（ちゃんと使ったことがないのでよくわかりませんが）。 そして、そのFeedをFacebookにまとめて…という風に考えています。 Facebookは色々なアプリと連携しているので、使っていると面白いのですが、絶妙な組み合わせ、というのが難しいと感じています。 Facebook自体が中途半端に多機能なので、非常に困るのです。 どの機能にどのアプリを使うか。 もう少し整理して使いたいですね。\n","date":"2011-06-29T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/29/060000/","title":"Feedをまとめるのはgoogleリーダーが便利らしい"},{"content":"Feedをまとめて時系列に並べて表示したいと思って色々とやってます。 PerlerならPlaggerを使ってやればいいんですが、そういうウェブサービスをさがすのも必要だと思って…。 あと、Perlが自由に使えない環境とかもあるし…。 で、NetworkedBlogsというサイトがそういう事をやってそうなのを見つけて、Facebookを経由して試しています。 それと同時に、PostToTwitterプラグインの使用をやめました。 最近は、色々なサービスを連携させることができるので、取捨選択が大変ですね。 そういったサービスの恩恵を受けるのには、（少なくとも）Feedを用意することが必要になってきますね。\nSEE ALSO Networked Blogs - NetworkedBlogs.com ","date":"2011-06-28T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/28/060000/","title":"ブログとTwitterの連携をFacebook経由にしてみた"},{"content":"10.6.8へアップデート、と言っても、結局のところWindowsと同じで、自動的にアップデートされました。 まあ、Windowsと同じ、というと、色々な意味で反感を買いそうですが。 まあ、こんな感じです。 ちなみに、このスクリーンショットは、標準の機能で撮ったものです。 command＋shift＋4を押した後に、spaceキーを押すと、ウィンドウ単位でスクリーンショットが撮れるモードになります。 Windowsでも、アクティブなウィンドウを撮るソフトはありましたが、その機能が標準で付いてくるのは凄いと思います。\n","date":"2011-06-27T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/27/060000/","title":"MacOSX10.6.8へアップデート"},{"content":"無職になってから新しいマシンを買うというのも贅沢な話ではありますが。 「MacBook Pro」を買いました。 明日で、購入してから2週間になります。 通販で買ったのですが、日曜日に手続きをして、月曜日に現品が到着しました。 驚きの速さですね。\nキーボードの感覚の違いが、未だにあります。 特に、カーソルキーが小さいのと、home、end、pageup、pagedownがないのと、deleteがWindowsでいうBackspaceで、deleteキー自体はない、というようなことです。 特にdeleteキーの違いは痛いです。 control＋Dキーのショートカットキーはあるようですが、いまいち使いづらい。 そういうのがストレスで、持っていたUSBのキーボード（安物です）を使ってみたのですが、それもイマイチ。 というのも、今度はトラックパッドが使いづらいのでした。 どうも、中途半端な状況になってしまったようです。 何故、そんな中途半端な状況になったかというと、トラックパッドが便利すぎるからでしょう。 特に二本指での操作感が素晴らしい。 スクロールも速いし。 pageup、pagedownは、これのおかげで問題なくなりました。 トラックパッド依存症になりかけなので、これがないと困ってしまいます。\n","date":"2011-06-26T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/26/060000/","title":"そういえば、Macを買いましたよ"},{"content":"Mojolicious::Liteネタですが、もう周回遅れ気味ですね。\n6月3日にversion1.41になっています。\nこのスクリプトは、 devel.nqou.netを作ったとき に、ソースを見るビューアとして書いたものを、Mojolicious::Liteで書きなおしたものです。\nサンプルばかりではなく、実際に使うもの（使えるものかどうかはともかく）を作ってみるのも良いものですね。\n","date":"2011-06-09T06:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/09/060000/","title":"sourcereader.cgiをMojolicious::Liteで書きなおした"},{"content":"去る2011年5月31日。 学校を卒業してからずっと勤めていた会社を辞めました。 これまで、このブログでも愚痴っぽいことを書いたこともありましたが、辞める事を決意するのは大変でした。 妻に相談を持ちかけたのは、確か2月の中頃だったと思います。 一人で色々と考えて行き詰ってしまったので、吐き出すように話した記憶があります。 生活を考えれば、サラリーマンでいることが最も堅実なわけで、当然反対されるだろうと思いました。 ところが、意外にも妻のほうがノリ気になってしまって、逆に色々とアイディアを考えてくれるほどでした。 実際に退職するには、他にもクリアしなければいけない問題はあったのですが、なんとかクリアできました。 ということで、今のところ無職です。 2,3年前に趣味プログラマとしてPerlの集まりに参加したのですが、その時に言われたことを思い出しました。 「プログラミングが好きなんだったら、何故そういう仕事をしてないの？」 一瞬言葉に詰まりました。 そして、色々と（自分に対しても）言い訳をしていました。 今はプログラマとして就職しているわけではないので、本職ではありませんが、そのうちちゃんと言いたいと思います。 「プログラミングが好きなので、プログラマをやっています。」\n","date":"2011-06-07T04:28:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/06/07/042848/","title":"もう日曜プログラマではなくなった"},{"content":"設定がちゃんと出来ているのか不安なのでテスト。\n","date":"2011-05-19T19:55:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/05/19/195524/","title":"FacebookにRSSを流すテスト"},{"content":"経路案内も簡単に実装できる、ということで気になって使ってみようと思ったのですが、途中で挫折してしまいました。\nSEE ALSO\njgmaps - jGmaps - jQuery Gmaps Plugin - V3.0 - Google Project Hosting Googleマップを使った経路案内も一瞬で実装できるjQueryプラグイン「jGmaps」:phpspot開発日誌 jGmaps - NanoA@d.n.n Google Maps JavaScript API V3 - Google Maps JavaScript API V3 - Google Code 表示がずれたりするのは、もう少し頑張れば、なんとかなるのかもしれませんが、あえてjQueryを使う必要があるのかも疑問に思ってきました。 本家を見てみると、半年ほど更新されていないようなのも気になりました。 使っているGoogle Maps APIもV2のようですし、深く調べてもしょうがないかなと。 それにしても、jQueryの進化は速いですね。 この前1.5になったと思ったのですが、もう1.6.1が出ています。\n","date":"2011-05-14T13:16:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/05/14/131657/","title":"jGmapsプラグインがいまいちだった件"},{"content":"「concrete5」というCMSをOSC2011Kobeで知って、面白そうだったので、インストールしてみた。\nSEE ALSO\nオープンソースカンファレンス2011 Kobe - オープンソースの文化祭！ concrete5日本語公式サイト by Usagi Project ありがたい事に「Xrea/Coreserver インストールガイド :: concrete5日本語公式サイト」というページがあるので、そちらを参考にしながらインストールします。 ポイントになるのは「5. 「.htaccess」と「php.ini」ファイルの設置」でしょう。 PHPをCGIとして動かす設定がないと、セーフモードで動くらしいので。 で、ちゃんとtmpディレクトリも作成します。 使ったバージョンは「concrete5.4.1.1.1.ja」です。 ディレクトリも同じ名前になりますので、とりあえず名前を変えておきたいところですが、なんとなくシンボリックリンクにしておきます。\n1 $ ln -s concrete5.4.1.1.1.ja c5 とりあえず「c5」という名前にしておきます。 さて、ここまで来たら今度はブラウザの出番です。 アップロードした先にアクセスしてみます。 今回は、「devel.nqou.net」の中に作ったので、「http://devel.nqou.net/c5/」にアクセスします。 オールグリーンになっていました。 好調ですね。 さて、フォームを入力していきます。 サイト名とメールアドレスは適切に、サーバーの欄については「localhost」、DB名欄とユーザー名欄はメモしている「DB/ユーザー名」を、パスワード欄にはパスワードを入力します。 全て入力したら、いよいよインストールです。 しばらく待つと、無事インストール終了のようです。 管理IDとパスワードが画面上にでました。 そのまま、ホームを表示すると管理モードになっています。 ついでなので、管理画面→ユーザー・グループ管理→admin→ユーザー編集、と画面を推移させて、すぐにパスワードを変更しました。 また、これは既知の問題らしいですが、スタイルシートがうまく反映されていません。 「10. スタイルシート非表示問題の応急処置法」に書いてあるようにしても良いのですが、この場合テーマを変えるたびに対応する必要がありそうなので、スクリプトの方を直しましょう。 httpヘッダを見てみると、「Expires」が「Date」と同じ時間になっているのが原因らしいのがわかります。 本来なら、ココを適切に直したいところですが、そこはよく分からないので消してしまいましょう。 「/concrete/tools/css.php」を開いて、29行目の\n1 header(\u0026#34;Expires: \u0026#34;. gmdate(\u0026#34;D, j M Y H:i:s\u0026#34;, time() + DAY) .\u0026#34; GMT\u0026#34;); の行をコメントにしていまいます。 ブラウザをリロードすると、スタイルシートが反映されていました。 テーマを変えても問題ありません。 さて、これでとりあえずはうまく動いています。 しばらく弄ってみることにします。 ↓これです。 concrete5.nqou.net :: ホーム\n","date":"2011-04-17T11:26:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/04/17/112650/","title":"CORESERVERでconcrete5を動かしてみた"},{"content":"AutoInstall.pmはそのままでは動きません。 lib::xiの方は、cpanmではインストール出来ません。 まあ、どうせWindowsなんて。 …と、言っていても仕方ありません。 なんとかしようではありませんか。 AutoInstallが動かないのは、Windowsに「/usr/bin/env」が無いだけなので、ちょっと書き換えれば普通に使えます。 重宝していました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package AutoInstall; # perl -MAutoInstall pl.pl use strict; use warnings; BEGIN { push @INC, sub { my ($self, $filename) = @_; my ($modulename) = ($filename =~ /^(.*)\\.pm$/m); return unless $modulename; $modulename =~ s{/}{::}g; # system(\u0026#39;/usr/bin/env\u0026#39;, \u0026#39;cpanm\u0026#39;, $modulename); system(qq{cpanm $modulename}); my $result; foreach my $prefix (@INC) { ref($prefix) and next; my $realfilename = \u0026#34;$prefix/$filename\u0026#34;; if (-f $realfilename) { open my $fh, \u0026#34;\u0026lt;\u0026#34;, $realfilename; return $fh; } } }; } 1; 一方、lib::xiの方は、生のファイルをそのまま使えば動きます。 生のファイルを「xi.pm」という「名前を付けて保存」して、script.plと同じフォルダにある「lib」という名前のフォルダの中にコピーします。\n1 2 3 - script.pl - lib - xi.pm lib::xiはcpanmに対してオプションを設定できるのがいいですね。 最初にフォルダ名を書くと、自動的に「\u0026ndash;local-lib」オプションのフォルダ名として認識してくれます。 なので、スクリプトに以下のように書いておくと、\n1 use lib::xi qw/extlib/; そのスクリプトを実行するごとに、足りないモジュールがあれば、スクリプトと同じフォルダにある「extlib」というフォルダの中にインストールされていきます。 しかも、別途「use lib」しなくても良いので、スクリプトもすっきりです。 ただし、この場合に注意が必要なのは、「extlib」をあらかじめ作っておく必要がある、ということです。 「extlib」以下のフォルダは自動的に作ってくれますので、「extlib」という名前のフォルダだけは作っておきましょう。\nSEE ALSO\n自動CPAN祭 AutoInstall.pm - 冬通りに消え行く制服ガールは、夢物語にリアルを求めない。 - subtech lib::xi - installs missing libraries on demand - Islands in the byte stream ","date":"2011-03-26T10:38:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/03/26/103813/","title":"AutoInstall.pmとlib::xiとWindows"},{"content":"未だにNanoAを使ってみたりしています。 Mojoliciousも面白いのですが、ファイルの操作(Mojo::Asset::File)に慣れないため、ついついPath::Classとか使ってしまうのですが、それだとMojoliciousを使っている意味が無いような気がして\u0026hellip;。\n閑話休題。 NanoAで使うテンプレートを書いていて、今更気づいたというか、見かけていたはずなのに理解できていなかったことがようやく理解できたので、恥を晒してみます。\n2年以上前に失敗していた時は、普通にifブロックを使って対処したのです。\n今のところ原因はわかりませんが、普通にifブロックを使う、ということで回避はできるので大きな問題はありません。 後置型のifとMENTAとjQueryFileTree、そしてPHP - 日曜プログラマのそゞろ事\nしかし、今の私は条件演算子を使うことを覚えました。 つまり、\n1 \u0026lt;title\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;menta.nqou.net\u0026lt;/title\u0026gt; 上記のような場合は、\n1 \u0026lt;title\u0026gt;\u0026lt;?= $title ne \u0026#34;\u0026#34; ? \u0026#34;$title - \u0026#34; : \u0026#34;\u0026#34; ?\u0026gt;menta.nqou.net\u0026lt;/title\u0026gt; このようにすれば良いのです。 後置のifを使った場合、評価が「偽」だった場合に表示されるべき値が不明瞭になります。(調べてみたのですが、よくわかりませんでした) templateエンジン次第でしょうが、例えば「$_」の値が表示されるかもしれません。 なので、評価が「偽」だった場合でも、何を表示するかを明確にしてやれば、問題ないということですね。 \u0026hellip;何を今更。\n","date":"2011-03-24T02:59:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/03/24/025901/","title":"NanoAのtemplateでは条件演算子を使おう"},{"content":"XREAからCORESERVERに引越ししました。 「XREA+（2400円/1年）」と「CORE-MINI（2500円/1年）」は、一年契約で100円しか違わないのに、サービス内容（サーバーの性能、容量等）は格段に違います。 サーバーの移転は面倒ですが、価値はあると思います。\nサーバーを変えるにあたって、さっそくcpanmを導入しました。 レンタルサーバーでPerlを満足に使おうと思えば、cpanmは必須となりました。 CORESERVERではSSHが使えるので便利です。 また、一時期local::libと組み合わせて使う方法も色々と書かれていましたが、情報がかなり整理されていたので、改めてここにまとめておきます。\n1 2 3 wget http://cpanmin.us perl cpanm --local-lib=~/perl5 local::lib App::cpanminus echo \u0026#39;eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)\u0026#39; \u0026gt;\u0026gt; ~/.bashrc 1行目は、cpanmをダウンロードしています。 2行目は、ダウンロードしたcpanmを使って、local::libとcpanmをインストールします。 3行目は、local::libのセットアップです。 念のため、この後一度ログアウトしてから再度ログインすると良いでしょう。 これを行うことで、cpanmを普通に使うだけでホームディレクトリ内にインストールすることが可能になります。\n1 cpanm Path::Class とか、\n1 cpanm Text::MicroTemplate とか、やりたい放題なわけです。 で、SSHからはこのままで良いのですが、CGIからだと少し工夫が必要です。 CORESERVERのホームディレクトリは「/virtual/ユーザー名」となっているので、簡単に書く場合は以下のような書き出しになります。\n1 2 3 4 #!/usr/bin/perl use lib qq{/virtual/ユーザー名/perl5/lib/perl5}; use Path::Class; ... 他に、環境変数（$ENV{HOME}）や、モジュール（FindBin等）を使う方法も考えられます。 とにかく、インストールされるディレクトリを「use lib \u0026ldquo;\u0026hellip;\u0026quot;;」として指定すればよいだけです。 これでレンタルサーバーでもPerlが楽しめますね。\n","date":"2011-02-12T23:18:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/02/12/231809/","title":"サーバーの引越しとlocal::libとcpanm"},{"content":"ということで、まずは結果から。\n1 2 3 4 5 6 7 8 9 10 11 12 Benchmark: timing 10000 iterations of Dumper, JSON, MsgPack, Storable, YAML... Dumper: 5 wallclock secs ( 4.02 usr + 0.00 sys = 4.02 CPU) @ 2485.09/s (n=10000) JSON: 1 wallclock secs ( 1.37 usr + 0.02 sys = 1.39 CPU) @ 7199.42/s (n=10000) MsgPack: 1 wallclock secs ( 0.72 usr + 0.00 sys = 0.72 CPU) @ 13927.58/s (n=10000) Storable: 2 wallclock secs ( 1.53 usr + 0.05 sys = 1.58 CPU) @ 6349.21/s (n=10000) YAML: 40 wallclock secs (40.19 usr + 0.06 sys = 40.25 CPU) @ 248.45/s (n=10000) Rate YAML Dumper Storable JSON MsgPack YAML 248/s -- -90% -96% -97% -98% Dumper 2485/s 900% -- -61% -65% -82% Storable 6349/s 2455% 155% -- -12% -54% JSON 7199/s 2798% 190% 13% -- -48% MsgPack 13928/s 5506% 460% 119% 93% -- SEE ALSO\nYuji Shimada / Data-Encoder - search.cpan.org にひりずむ::しんぷる - Data::Encoder っていうのを書いた 以下ベンチマークのソースです。 「use 5.12.1;」は、うっかりレンタルサーバーなどで実行しないようにする意味でも重要です。 まあ、私にとっては。 あと、せっかく「Data::Encoder」を使うので、encodeとdecodeは共通化して使ってみることにしました。 メソッドが共通化されるとソースが読みやすくて良いですね。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #!/usr/bin/env perl #ｕｔｆ８ use utf8; use 5.12.1; # use Acme::PerlTidy; use Benchmark qw(:all); use Data::Dump qw/dd/; use Data::Encoder; sub run { my $encoder = shift; my $enc = $encoder-\u0026gt;encode([qw/foo bar/]); my $data = $encoder-\u0026gt;decode($enc); # dd $data; } cmpthese( timethese( 10000, { # Data::Encoder::JSON JSON =\u0026gt; sub { my $encoder = Data::Encoder-\u0026gt;load(\u0026#39;JSON\u0026#39;); \u0026amp;run($encoder); }, # Data::Encoder::Data::Dumper Dumper =\u0026gt; sub { my $encoder = Data::Encoder-\u0026gt;load(\u0026#39;Data::Dumper\u0026#39;); \u0026amp;run($encoder); }, # Data::Encoder::Data::MessagePack MsgPack =\u0026gt; sub { my $encoder = Data::Encoder-\u0026gt;load(\u0026#39;Data::MessagePack\u0026#39;); \u0026amp;run($encoder); }, # Data::Encoder::Storable Storable =\u0026gt; sub { my $encoder = Data::Encoder-\u0026gt;load(\u0026#39;Storable\u0026#39;); \u0026amp;run($encoder); }, # Data::Encoder::YAML YAML =\u0026gt; sub { my $encoder = Data::Encoder-\u0026gt;load(\u0026#39;YAML\u0026#39;); \u0026amp;run($encoder); }, } ) ); ","date":"2011-01-19T01:22:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/19/012232/","title":"Data::EncoderでBenchmarkしてみた"},{"content":"色々と駆使して今更チャットを作ってみたわけですが、適当に追加していると、本当に追加されているのかよく分からない場合があります。 元々はこんな感じです。\n1 2 3 var add_log = function(text){ $(\u0026#39;#for_ajax\u0026#39;).prepend(\u0026#34;\u0026lt;p\u0026gt;\u0026#34; + text + \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;); }; で、それを以下のようにやってみました。\n1 2 3 var add_log = function(text){ $(\u0026#39;#for_ajax\u0026#39;).hide().prepend(\u0026#34;\u0026lt;p\u0026gt;\u0026#34; + text + \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;).fadeIn(); }; fadeInだけだと、エフェクトがかからないので一旦hideしてやらないといけないようです。 ただ、これだと今までに書いてある記事もすべて消えてから、全体にfadeInがかかるのでいまいちな感じです。 新しく追加する部分だけにエフェクトが欲しいと思って調べてみたところ、ありました。\n1 2 3 var add_log = function(text){ $(\u0026#34;\u0026lt;p\u0026gt;\u0026#34; + text + \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;).hide().prependTo(\u0026#39;#for_ajax\u0026#39;).fadeIn(); }; すでにある要素に新しい記事を挿し込む、という順序ではなく、新しい記事をすでにある要素に挿し込む、という順序でやれば、新しい記事だけにエフェクトを掛けてやることが可能でした。 どちらを主体にするかでエフェクトの範囲を決めることができます。 リファレンスを見ていると、appendToとかprependToとかをどういう風に使うのか不思議だったのですが、ようやく使い方を発見した感じです。 これは、なかなか良いですね。\n","date":"2011-01-15T16:04:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/15/160436/","title":"jQueryで追加する部分だけにエフェクトをかける方法を覚えた"},{"content":"JSONを返すスクリプトの記事で、リストを作るときに以下のようにしていたのですが。\n1 2 3 4 5 6 7 8 9 10 my @json; for my $msg (@{$messages}) { push @json, { id =\u0026gt; $msg-\u0026gt;id, msg =\u0026gt; $msg-\u0026gt;msg, ts =\u0026gt; $msg-\u0026gt;ts, }; } $self-\u0026gt;render(json =\u0026gt; [@json]); レコードの情報は、get_columnsで取得できることがわかった。 それをふまえて書くと、上の処理に相当するコードは以下のようになります。\n1 2 3 4 5 my @json; for my $msg (@{$messages}) { push @json, $msg-\u0026gt;get_columns; } $self-\u0026gt;render(json =\u0026gt; [@json]); ここまで来たら、mapを使って書いてみたいですよね。\n1 2 my @json = map { $_-\u0026gt;get_columns } @{$messages}; $self-\u0026gt;render(json =\u0026gt; [@json]); で、これだけだったら、直接書いても良さそうです。\n1 $self-\u0026gt;render(json =\u0026gt; [map { $_-\u0026gt;get_columns } @{$messages}]); ただ、本当なら、$messagesから直に変換出来れば便利ですけどね。\n","date":"2011-01-11T20:42:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/11/204258/","title":"Data::Modelで$row-\u003eget_columnsを覚えた"},{"content":"Mojoliciousが1.01になりましたね。 まあ、それとは関係ないですが、jQueryを使ってAJAXなチャットを作ってみたので晒してみようかと思います。 AJAX自体、やった事が無いので、もっと良いやり方があるとは思います。 値の受け渡しはJSONを使ったのですが、Mojolicious側の受け取り方法がよく分からなくて$self-\u0026gt;req-\u0026gt;jsonとか、Mojo::JSON-\u0026gt;newとかやっていたのですが、結果的に普通に$self-\u0026gt;paramで受け取れるのがわかって、凄いと思いました。 JavaScript側では、Perlからのtime値をどうやって渡すのかが、調べていてもよく分からなかったので、正解に行き着くのが大変でした。 ミリセカンドで渡す、というのは気づきませんでした。 常識すぎてあまり書かれないんでしょうか…。\nSEE ALSO\nJavaScript Reference jQuery 日本語リファレンス jQuery API 1.4.4 日本語リファレンス - StackTrace 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 #!/usr/bin/env perl #ｕｔｆ８ # use Acme::PerlTidy; use utf8; package DataModel; use base \u0026#39;Data::Model\u0026#39;; use Data::Model::Schema; use Data::Model::Driver::DBI; my $dbfile = qq{$0.db}; my $dsn = qq{dbi:SQLite:dbname=$dbfile}; my $driver = Data::Model::Driver::DBI-\u0026gt;new( dsn =\u0026gt; $dsn, connect_options =\u0026gt; { sqlite_unicode =\u0026gt; 1 }, ); base_driver($driver); install_model messages =\u0026gt; schema { key \u0026#39;id\u0026#39;; column id =\u0026gt; int =\u0026gt; { auto_increment =\u0026gt; 1 }; column msg =\u0026gt; char =\u0026gt; { required =\u0026gt; 1 }; column ts =\u0026gt; char =\u0026gt; { required =\u0026gt; 1 }; }; unless (-f $dbfile) { my $dbh = DBI-\u0026gt;connect($dsn, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, { RaiseError =\u0026gt; 1, PrintError =\u0026gt; 0 }) or DBI-\u0026gt;errstr; for my $sql (__PACKAGE__-\u0026gt;as_sqls) { $dbh-\u0026gt;do($sql) or die $dbh-\u0026gt;errstr; } $dbh-\u0026gt;disconnect; } package main; use Mojolicious::Lite; use Mojo::Util qw/md5_sum/; app-\u0026gt;secret(md5_sum $0)-\u0026gt;log-\u0026gt;level(\u0026#39;debug\u0026#39;)-\u0026gt;path(qq{$0.log}) -\u0026gt;debug(app-\u0026gt;secret); app-\u0026gt;helper(model =\u0026gt; sub {my $dbh = DataModel-\u0026gt;new}); get \u0026#39;/\u0026#39; =\u0026gt; \u0026#39;index\u0026#39;; get \u0026#39;/json\u0026#39; =\u0026gt; sub { my $self = shift; my $model = $self-\u0026gt;model; my $messages = [ $model-\u0026gt;get( \u0026#39;messages\u0026#39; =\u0026gt; { where =\u0026gt; [ id =\u0026gt; { \u0026#39;\u0026gt;\u0026#39; =\u0026gt; $self-\u0026gt;param(\u0026#39;from_id\u0026#39;) } ], order =\u0026gt; [ { id =\u0026gt; \u0026#39;ASC\u0026#39; } ], } ) ]; my @json; for my $msg (@{$messages}) { push @json, { id =\u0026gt; $msg-\u0026gt;id, msg =\u0026gt; $msg-\u0026gt;msg, ts =\u0026gt; $msg-\u0026gt;ts, }; } $self-\u0026gt;render(json =\u0026gt; [ @json ]); } =\u0026gt; \u0026#39;json\u0026#39;; post \u0026#39;/json\u0026#39; =\u0026gt; sub { my $self = shift; my $time = time; my $model = $self-\u0026gt;model; $model-\u0026gt;set( \u0026#39;messages\u0026#39; =\u0026gt; { msg =\u0026gt; $self-\u0026gt;param(\u0026#39;msg\u0026#39;), # jsonもparamで取れる ts =\u0026gt; $time, } ); }; app-\u0026gt;start; __DATA__ @@ index.html.ep % layout \u0026#39;main\u0026#39;; %= javascript begin jQuery(function($) { $(\u0026#34;#message\u0026#34;).focus(); var params = $.extend({ refresh: 5, timer: 0, latest: 0 }, params); var add_log = function(text) { $(\u0026#39;#for_ajax\u0026#39;).prepend(\u0026#34;\u0026lt;p\u0026gt;\u0026#34; + text + \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;); }; var format_date = function(d) { var yyyy = d.getFullYear(); var mm = \u0026#39;0\u0026#39; + (d.getMonth() + 1); var dd = \u0026#39;0\u0026#39; + d.getDate(); var hh = \u0026#39;0\u0026#39; + d.getHours(); var nn = \u0026#39;0\u0026#39; + d.getMinutes(); var ss = \u0026#39;0\u0026#39; + d.getSeconds(); return yyyy + \u0026#39;/\u0026#39; + mm.slice(-2) + \u0026#39;/\u0026#39; + dd.slice(-2) + \u0026#39; \u0026#39; + hh.slice(-2) + \u0026#39;:\u0026#39; + nn.slice(-2) + \u0026#39;:\u0026#39; + ss.slice(-2); }; var reload_json = function() { $.getJSON( \u0026#34;\u0026lt;%= url_for \u0026#39;json\u0026#39; %\u0026gt;\u0026#34;, { \u0026#39;from_id\u0026#39;: params.latest }, function(json) { $.each(json, function(i, val) { params.latest = val.id; var latest = new Date(); latest.setTime(val.ts * 1000); add_log(val.id + \u0026#34;. \u0026#34; + val.msg + \u0026#34; \u0026lt;small\u0026gt;\u0026#34; + format_date(latest) + \u0026#34;\u0026lt;/small\u0026gt;\u0026#34;); }); clearTimeout(params.timer); // 念のためタイマーをリセット params.timer = setTimeout(reload_json, params.refresh * 1000); // 次回の実行はparams.refresh秒後 } ); }; params.timer = setTimeout(reload_json, 0); // 一回目実行 $(\u0026#34;#msg_form\u0026#34;).submit(function() { if ($(\u0026#34;#message\u0026#34;).val().length \u0026gt; 0) { $.post( \u0026#34;\u0026lt;%= url_for \u0026#39;json\u0026#39; %\u0026gt;\u0026#34;, { \u0026#39;msg\u0026#39;: $(\u0026#34;#message\u0026#34;).val() }, function(json) {}, \u0026#39;json\u0026#39; ); $(\u0026#34;#message\u0026#34;).val(\u0026#39;\u0026#39;); } return false; }); }); % end \u0026lt;div\u0026gt; \u0026lt;%= form_for \u0026#39;/\u0026#39; =\u0026gt; (method =\u0026gt; \u0026#39;post\u0026#39;, id =\u0026gt; \u0026#39;msg_form\u0026#39;) =\u0026gt; begin %\u0026gt; \u0026lt;%= text_field \u0026#39;msg\u0026#39; =\u0026gt; (id =\u0026gt; \u0026#39;message\u0026#39;) %\u0026gt; \u0026lt;%= submit_button \u0026#39;発言する\u0026#39; %\u0026gt; \u0026lt;% end %\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;for_ajax\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; @@ layouts/main.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;\u0026lt;%= app-\u0026gt;renderer-\u0026gt;encoding %\u0026gt;\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Mojolicious\u0026lt;/title\u0026gt; %= javascript \u0026#39;https://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js\u0026#39; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;%= content %\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","date":"2011-01-10T01:43:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/10/014314/","title":"Mojolicious::LiteとData::ModelとjQueryでAJAXなチャットを作ってみた"},{"content":"Mojolicious::Liteの記事でORLiteが日本語には対応できていません、と書いていたところ、スクリプト側で対応させる方法を教えていただきました。 私はsqlite_unicodeを、createやpackageの最後で設定してみたりしていたのですが、どれもうまくいかず諦めていました。\nそこで、以下のように package Model のところで connect メソッドを上書きすることで、日本語文字列のポスト・表示にも対応することができました。 Mojolicious wikiにあるORLiteの例をUnicode対応にする - 徒書\nこの程度の追記で対応できるのであれば、なかなか使い出がありそうです。\nSEE ALSO Adam Kennedy / ORLite - search.cpan.org ","date":"2011-01-04T23:20:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/04/232046/","title":"ORLiteを日本語に対応させるテクニック"},{"content":"基本的には前記事と同じです。 私の観測範囲ではData::ModelよりもDBIx::Skinnyの方がよく使われているような気がしますが、テーブルとschemaを両方作る必要があるのがちょっと微妙に感じます。 DBIx::Skinny::Schema::Loaderというschemaを自動的に設定してくれるモジュールもあるので、それを使えば問題ないわけですが。 ORLiteの記事を見て「いいな」と思ったのは、テーブルの定義をするだけで使えるところでした。 あと、テーブル毎にクラスを自動的に作ってくれるようで、それも面白い機能だと思います。 しかし、Skinnyなどで言うconnect_optionsが設定（簡単に言えばsqlite_unicodeを有効に）できないため、日本語には対応できていません。 ORLite.pmのソースコードを書き換えてやればうまく動くのは確認済みですが、パッチを書いたりテストを書いたりまでは面倒で…。 まあ、そんなわけで和製のORMの代表格であるDBIx::Skinnyも使っておこうかと、そんな感じです。\nSEE ALSO\nKazuhiro Osawa / Data-Model - search.cpan.org Atsushi Kobayashi / DBIx-Skinny - search.cpan.org Ryo Miyake / DBIx-Skinny-Schema-Loader - search.cpan.org DBIx::Skinny - JPerl Advent Calendar 2009 Adam Kennedy / ORLite - search.cpan.org カラムの細かい定義方法が分からなかったので、適当に設定してますが、とりあえず動きます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 #!/usr/bin/env perl #ｕｔｆ８ # use Acme::PerlTidy; package DBIxSkinny; use utf8; use DBIx::Skinny connect_info =\u0026gt; +{ dsn =\u0026gt; qq{dbi:SQLite:dbname=$0.db}, connect_options =\u0026gt; +{sqlite_unicode =\u0026gt; 1,} }; package DBIxSkinny::Schema; use utf8; use DBIx::Skinny::Schema; install_table motorcycles =\u0026gt; schema { pk \u0026#39;id\u0026#39;; columns qw/id type brand color/; }; package main; use utf8; use Mojolicious::Lite; use Mojo::Util qw/md5_sum/; app-\u0026gt;log-\u0026gt;level(\u0026#39;debug\u0026#39;)-\u0026gt;path(qq{$0.log}); app-\u0026gt;secret(md5_sum $0 )-\u0026gt;log-\u0026gt;debug(app-\u0026gt;secret); app-\u0026gt;helper(model =\u0026gt; sub { my $dbh = DBIxSkinny-\u0026gt;new }); app-\u0026gt;model-\u0026gt;do( \u0026#39;CREATE TABLE IF NOT EXISTS motorcycles ( id INTEGER PRIMARY KEY, type TEXT NOT NULL, brand TEXT NOT NULL, color TEXT)\u0026#39; ); get \u0026#39;/\u0026#39; =\u0026gt; sub { my $self = shift; my $model = $self-\u0026gt;model; my $motorbikes = [$model-\u0026gt;search(\u0026#39;motorcycles\u0026#39;, {}, {order_by =\u0026gt; [{type =\u0026gt; \u0026#39;ASC\u0026#39;}]},)]; $self-\u0026gt;stash( motorbikes =\u0026gt; $motorbikes, debug =\u0026gt; $self-\u0026gt;dumper([$self, $model]), ); } =\u0026gt; \u0026#39;index\u0026#39;; post \u0026#39;/\u0026#39; =\u0026gt; sub { my $self = shift; $self-\u0026gt;model-\u0026gt;create( \u0026#39;motorcycles\u0026#39;, { type =\u0026gt; $self-\u0026gt;param(\u0026#39;type\u0026#39;), brand =\u0026gt; $self-\u0026gt;param(\u0026#39;brand\u0026#39;), color =\u0026gt; $self-\u0026gt;param(\u0026#39;color\u0026#39;) } ); $self-\u0026gt;redirect_to(\u0026#39;/\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt;\u0026lt;title\u0026gt;Motorcycles\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;table\u0026gt; % foreach my $cycle (@{$motorbikes} ) { \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;id %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;type %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;brand %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;color %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; % } \u0026lt;/table\u0026gt; \u0026lt;p\u0026gt;バイクを登録してください。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; \u0026lt;%= form_for \u0026#39;/\u0026#39; =\u0026gt; (method =\u0026gt; \u0026#39;post\u0026#39;) =\u0026gt; begin %\u0026gt; % foreach (qw/type brand color/) { \u0026lt;%= uc($_) %\u0026gt;: \u0026lt;%= input_tag $_, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;text\u0026#39; %\u0026gt;\u0026lt;br /\u0026gt; % } \u0026lt;%= submit_button \u0026#39;Submit motorcycle\u0026#39; %\u0026gt; \u0026lt;% end %\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;pre\u0026gt;\u0026lt;%= $debug %\u0026gt;\u0026lt;/pre\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","date":"2011-01-03T04:10:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/03/041042/","title":"Mojolicious::LiteでDBIx::Skinnyを使ってみた"},{"content":"先日1.0にバージョンアップしたMojolicious（::Lite）を本格的に触ってみようとアレコレやってみた。 MojoliciousのWikiにORLiteを使ったサンプルがあったのですが、残念ながらそのままでは日本語には対応していないので、他のORMを使ってみようという、そんな感じです。\nSEE ALSO Data::Model - model interface which had more data sources unified, a.k.a data/object mapper - metacpan.org Data::Model Track - JPerl Advent Calendar 2009 Mojolicious::Lite - Micro real-time web framework - metacpan.org Home · mojolicious/mojo Wiki ほとんどが元ネタのパクリですが。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 #!/usr/bin/env perl #ｕｔｆ８ # use Acme::PerlTidy; package DataModel; use utf8; use base \u0026#39;Data::Model\u0026#39;; use Data::Model::Schema; use Data::Model::Driver::DBI; my $dbfile = qq{$0.db}; my $dsn = qq{dbi:SQLite:dbname=$dbfile}; my $driver = Data::Model::Driver::DBI-\u0026gt;new( dsn =\u0026gt; $dsn, connect_options =\u0026gt; {sqlite_unicode =\u0026gt; 1,}, ); base_driver($driver); install_model motorcycles =\u0026gt; schema { key \u0026#39;id\u0026#39;; column id =\u0026gt; int =\u0026gt; {auto_increment =\u0026gt; 1}; column type =\u0026gt; char =\u0026gt; {required =\u0026gt; 1}; column brand =\u0026gt; char =\u0026gt; {required =\u0026gt; 1}; column color =\u0026gt; char =\u0026gt; {required =\u0026gt; 0}; }; unless (-f $dbfile) { my $dbh = DBI-\u0026gt;connect($dsn, \u0026#39;\u0026#39;, \u0026#39;\u0026#39;, {RaiseError =\u0026gt; 1, PrintError =\u0026gt; 0}) or DBI-\u0026gt;errstr; for my $sql (__PACKAGE__-\u0026gt;as_sqls) { $dbh-\u0026gt;do($sql) or die $dbh-\u0026gt;errstr; } $dbh-\u0026gt;disconnect; } package main; use utf8; use Mojolicious::Lite; use Mojo::Util qw/md5_sum/; app-\u0026gt;log-\u0026gt;level(\u0026#39;debug\u0026#39;)-\u0026gt;path(qq{$0.log}); app-\u0026gt;secret(md5_sum $0 )-\u0026gt;log-\u0026gt;debug(app-\u0026gt;secret); app-\u0026gt;helper(model =\u0026gt; sub { my $dbh = DataModel-\u0026gt;new }); get \u0026#39;/\u0026#39; =\u0026gt; sub { my $self = shift; my $model = $self-\u0026gt;model; my $motorbikes = [$model-\u0026gt;get(\u0026#39;motorcycles\u0026#39; =\u0026gt; {order =\u0026gt; [{type =\u0026gt; \u0026#39;ASC\u0026#39;}],})]; $self-\u0026gt;stash( motorbikes =\u0026gt; $motorbikes, debug =\u0026gt; $self-\u0026gt;dumper([$self, $model]), ); } =\u0026gt; \u0026#39;index\u0026#39;; post \u0026#39;/\u0026#39; =\u0026gt; sub { my $self = shift; my $model = $self-\u0026gt;model; $model-\u0026gt;set( \u0026#39;motorcycles\u0026#39; =\u0026gt; { type =\u0026gt; $self-\u0026gt;param(\u0026#39;type\u0026#39;), brand =\u0026gt; $self-\u0026gt;param(\u0026#39;brand\u0026#39;), color =\u0026gt; $self-\u0026gt;param(\u0026#39;color\u0026#39;), } ); $self-\u0026gt;redirect_to(\u0026#39;/\u0026#39;); }; app-\u0026gt;start; __DATA__ @@ index.html.ep \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;\u0026lt;%= app-\u0026gt;renderer-\u0026gt;encoding %\u0026gt;\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Motorcycles\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;table\u0026gt; % foreach my $cycle (@{$motorbikes} ) { \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;id %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;type %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;brand %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;%= $cycle-\u0026gt;color %\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; % } \u0026lt;/table\u0026gt; \u0026lt;p\u0026gt;バイクを登録してください。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; \u0026lt;%= form_for \u0026#39;/\u0026#39; =\u0026gt; (method =\u0026gt; \u0026#39;post\u0026#39;) =\u0026gt; begin %\u0026gt; % foreach (qw/type brand color/) { \u0026lt;%= uc($_) %\u0026gt;: \u0026lt;%= input_tag $_, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;text\u0026#39; %\u0026gt;\u0026lt;br /\u0026gt; % } \u0026lt;%= submit_button \u0026#39;Submit motorcycle\u0026#39; %\u0026gt; \u0026lt;% end %\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;pre\u0026gt;\u0026lt;%= $debug %\u0026gt;\u0026lt;/pre\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","date":"2011-01-02T20:55:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2011/01/02/205559/","title":"Mojolicious::LiteでData::Modelを使ってみた"},{"content":"未だにNanoAを触っているわけですが、ずっと悩んでいたchecked問題を、解決させることが出来ました。\nchecked=\u0026gt;1にしても、チェックが入っていない状態になる。 HTML::AutoFormのtディレクトリにあるコードと同じように書いているのだけど。 何故だ…。\n[NanoAでデータベースを使ってみる - 日曜プログラマのそゞろ事]\nリファレンスの真偽判定の仕方がまずかったようです。 HTML::AutoFormのtディレクトリにあるテストコードを単純にCGIに置き換えてレンダリングしたところ、checkedの設定が生きませんでした。 テストコードを見てみると、formのrenderではなく、fieldのrenderでテストをしていました。 ということは、formのrenderに問題がある、という事になります。 しかし、追いかけていったところ、結果的にはHTML/AutoForm/Field/InputCheckable.pmに問題がありました。 formのrenderは、ポストしているデータがあれば、そのデータを配列のリファレンスで渡すことにしています。 こうすることで、初期値（プログラムに書いている値）ではなく、ポストされた値でレンダリングされるようになります。 InputCheckable.pmのrenderをよく見ると、リファレンスを受けている変数を真偽判定して、真ならば配列のリファレンスとみなして処理しています。\nしかし、ここに問題がありました。\n初期値のcheckedが生きないのは、ここが必ず真で判定される（リファレンスは真です）からです。 初期値の（formのrenderで空の配列のリファレンスが渡された）場合は、偽で判定して欲しいので、一度配列に入れてから、その配列を真偽判定（配列が空ならば偽になります）してやれば問題ないと思います。 これで、初期値の場合も、ポストした場合も、問題なさそうでした。 元々のテストも問題なく通っています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Index: InputCheckable.pm =================================================================== --- InputCheckable.pm\t(リビジョン 38673) +++ InputCheckable.pm\t(作業コピー) @@ -19,6 +19,8 @@ sub render { my ($self, $values) = @_; + my @values; + @values = @$values if ref $values eq \u0026#39;ARRAY\u0026#39;; my %base = ( %{$self-\u0026gt;{parent}}, %$self, @@ -35,8 +37,8 @@ { type =\u0026gt; $self-\u0026gt;parent-\u0026gt;type, value =\u0026gt; $self-\u0026gt;{value}, - ($values - ? grep { $_ eq $self-\u0026gt;{value} } @$values + (@values + ? grep { $_ eq $self-\u0026gt;{value} } @values : $self-\u0026gt;{checked}) ? (checked =\u0026gt; \u0026#39;checked\u0026#39;) : (), }, ","date":"2010-11-15T03:56:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/11/15/035633/","title":"HTML::AutoFormのchecked問題が解決できた"},{"content":"WWW::MechanizeとWeb::ScraperでLast.fmからfreemp3をダウンロードするスクリプトを久しぶりに動かしてみたら、エラーになった…。 確認したところ、どうやらコンフィグ（Config::YAML）の使い方に問題があったようだ。 なんとも恥ずかしい。 そこで、最近使い方を覚えた小技をいくつか加えてグレードアップすることにした。 Config::Pitを使ってみたり、autodieを使ってみたり。 Config::PitはWindowsでは使えないと勝手に思い込んでいたけど、普通に使えた。 スクリプトにアカウント情報を入れなくても済むので、ブログで公開するときにも気を使わなくて済むのが良いです。 Config::Pitは、getとsetが組になっていて、まずはsetでアカウント情報を記録しておきます。 やり方は幾つかあるのですが、とりあえず今回のスクリプトに合わせて作ったスクリプトを晒しておきます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 # ｕｔｆ８ # use Acme::PerlTidy; use strict; use warnings; use Config::Pit; # 設定 Config::Pit::set( \u0026#34;last.fm\u0026#34;, data =\u0026gt; { username =\u0026gt; \u0026#34;username\u0026#34;, password =\u0026gt; \u0026#34;password\u0026#34;, } ); usernameとpasswordの値を、実際のアカウント情報に変更してから実行すると、私の環境では\n1 C:\\Users\\\u0026lt;username\u0026gt;\\.pit の中に、YAMLファイルで入力した情報が保管されていました。 あとは使うときにsetで使ったキー（今の場合は「last.fm」）で引いてやると、このアカウント情報がちゃんと使えます。 便利ですね。 autodieは、Fatalの自動版という感じでしょうか。 use autodieとしておくだけで、色々なエラーを捕まえてdieしてくれます。 例えば以下のようなスクリプトでは、ファイルがなかった時にはdieします。\n1 2 3 4 5 # ｕｔｆ８ use strict; use autodie; open my $fh, \u0026#39;\u0026lt;:utf8\u0026#39;, \u0026#39;autodie.dat\u0026#39;; close $fh; 便利ですね。\nSEE ALSO\nパスワード設定をコードに書かない(Config::Pit) - モダンなPerl入門 - モダンなPerl入門 cho45 (さとう) / Config-Pit - search.cpan.org 適当なscriptでは use autodie; する - TokuLog 改メ tokuhirom’s blog Paul Jamieson Fenwick / autodie - search.cpan.org ということで、本題。 Web::ScraperとWWW::Mechanizeの合わせ技です。 今回は、このスクリプトでちゃんと動かして確認しているので、問題ない。…はずです。 mechでリンクをたどっていく場合もそうですが、HTMLのソースを確認したいので、都度保存して解析に使っていました。 そのへんの名残もそのまま置いてあります。 ひょっとすると、将来の自分のため…かもしれませんが。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 # ｕｔｆ８ # use Acme::PerlTidy; use strict; use warnings; use autodie; use utf8; use Perl6::Say; use FindBin; use Encode; use Config::Pit; my $config = pit_get( \u0026#34;last.fm\u0026#34;, require =\u0026gt; { username =\u0026gt; \u0026#34;username\u0026#34;, password =\u0026gt; \u0026#34;password\u0026#34;, } ); use Web::Scraper; use WWW::Mechanize; use File::Basename; use List::MoreUtils qw(uniq); my $uri = q{http://www.last.fm/}; my $mech = WWW::Mechanize-\u0026gt;new( autocheck =\u0026gt; 1, ); # my $history_dir = $FindBin::Bin . q{/lastfm.test}; # スタート $mech-\u0026gt;get($uri); say $mech-\u0026gt;uri; # ログイン画面へ sleep 1; $mech-\u0026gt;follow_link( id =\u0026gt; \u0026#39;loginBtn\u0026#39; ); my $fh; say $mech-\u0026gt;uri; # open $fh, \u0026#39;\u0026gt;:utf8\u0026#39;, $history_dir . q{/get1.html}; # print $fh $mech-\u0026gt;content; # $mech-\u0026gt;dump_all($fh); # close $fh; # ログイン sleep 1; $mech-\u0026gt;submit_form( form_number =\u0026gt; 2, fields =\u0026gt; { username =\u0026gt; $config-\u0026gt;{username}, password =\u0026gt; $config-\u0026gt;{password}, }, ); say $mech-\u0026gt;uri; # open $fh, \u0026#39;\u0026gt;:utf8\u0026#39;, $history_dir . q{/logined.html}; # print $fh $mech-\u0026gt;content; # close $fh; # フリーMP3のページ sleep 1; $mech-\u0026gt;follow_link( url_regex =\u0026gt; qr/freemp3s/ ); # open $fh, \u0026#39;\u0026gt;:utf8\u0026#39;, $history_dir . q{/freemp3s.html}; # print $fh $mech-\u0026gt;content; # close $fh; # MP3リンクを取得 sleep 1; my ( $scraper, $result ); $scraper = scraper { process \u0026#39;a[href=~/\\.mp3$/]\u0026#39;, \u0026#39;hrefs[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; result \u0026#39;hrefs\u0026#39;; }; $result = $scraper-\u0026gt;scrape( $mech-\u0026gt;content, $mech-\u0026gt;uri ); # mp3ファイルを取得 foreach my $mp3 ( uniq @{$result} ) { my $filename = basename($mp3); print \u0026#34;try fetch : $mp3 : \u0026#34;; say $mech-\u0026gt;mirror( $mp3, sprintf( \u0026#34;%s/%s\u0026#34;, \u0026#39;DownloadFiles\u0026#39;, $filename ) ) -\u0026gt;message; sleep 1; } ","date":"2010-08-31T21:50:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/08/31/215014/","title":"昔書いたスクリプトをグレードアップした"},{"content":"8月15日のエチカの鏡を見ていて、ハーバード大学で活躍している日本人（名前は失念）の言葉が記憶に残った。\n自らの手で科学を推し進めている感覚がある。 この計算が解ければ世界が変わる。\n細かいニュアンスは覚えていないが、最先端にいる人の感覚が、その発する言葉から伝わってきた。 何のためらいもなく「世界を変えている」と言えることが、素直に素晴らしいと感じた。 そういう事を考えていたときに、ふと思い出したことがあった。 昨年参加したKansai.pmで話していた（というか聞いた）ことを思い出したのだ。\n最先端を行っている人は、そのまま突っ走って欲しい。 色々なソフトウェアを開発したり、モジュールを作ったりする人は、初心者にわかるような詳細なドキュメントを作るよりも、もっと開発に時間をかけて欲しい。 ドキュメント作成は、ソースコードを読んでソフトウェアやモジュールを使える人がやっていくほうが、全体としてプラスになる気がする。\nそんな想いを聞いたのだ。 その時に、オレもPerlの入り口に立った人に何かできることをしよう、と思ったことを同時に思い出した。 うまく文章にはまとめられないけど、書きたい、という気持ちが熱いうちに言葉にしたいと思った。 まとめようと思えば思うほど、書こうとした言葉がどこかに行ってしまうのが悔しい。\n","date":"2010-08-17T01:41:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/08/17/014133/","title":"推し進める事と裾野を広げる事"},{"content":"しばらく前に、POSIXにstrftimeという便利なコマンドがあるのを発見した。 DateTime等とのベンチマークだったと思う。 はてブしたハズなのだが、見つからず。 タグのつけ方が安定しない。 ともかく。 日付時刻を表示するときは、localtimeをスカラーコンテキストで表示することが多いのだが、日本風に表示しようとすると、それなりに面倒。\n1 2 3 4 my @now = localtime; $now[5] += 1900; $now[4]++; printf qq{%04d/%02d/%02d %02d:%02d:%02d}, reverse(@now[0..5]); そこで便利なのが、POSIXのstrftimeですよ。\n1 2 use POSIX; print POSIX::strftime \u0026#39;%Y/%m/%d %H:%M:%S\u0026#39;, localtime; これで同じ出力を得ることが出来る。 しかも、手元の環境では、strftimeを使ったほうが速い。\n生のコードは2種類。 先ほどのスライスを使ったものと、配列を展開したもの。 それらとstrftimeを比較してみた。 結果は以下のとおり、POSIXを使ったほうが2割程度速かった。\n1 2 3 4 5 6 7 8 Benchmark: running coding1, coding2, posix for at least 3 CPU seconds... coding1: 4 wallclock secs ( 3.10 usr + 0.00 sys = 3.10 CPU) @ 75042.20/s (n=232931) coding2: 4 wallclock secs ( 3.15 usr + 0.00 sys = 3.15 CPU) @ 84113.30/s (n=265041) posix: 4 wallclock secs ( 3.14 usr + 0.00 sys = 3.14 CPU) @ 103140.63/s (n=323449) Rate coding1 coding2 posix coding1 75042/s -- -11% -27% coding2 84113/s 12% -- -18% posix 103141/s 37% 23% -- ソースコードも見た目にわかりやすいので、今後は重宝しそうです。 ベンチマークに使ったソースは以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #ｕｔｆ８ use strict; use warnings; use utf8; use Benchmark \u0026#39;:all\u0026#39;; use POSIX; use Perl6::Say; say posix(); say coding(); say coding2(); cmpthese(timethese( -3, { \u0026#39;posix\u0026#39; =\u0026gt; \\\u0026amp;posix, \u0026#39;coding1\u0026#39; =\u0026gt; \\\u0026amp;coding, \u0026#39;coding2\u0026#39; =\u0026gt; \\\u0026amp;coding2, })); sub posix { POSIX::strftime \u0026#39;%Y/%m/%d %H:%M:%S\u0026#39;, localtime; } sub coding { my @now = localtime; $now[5] += 1900; $now[4]++; sprintf qq{%04d/%02d/%02d %02d:%02d:%02d}, reverse(@now[0..5]); } sub coding2 { my @now = localtime; sprintf qq{%04d/%02d/%02d %02d:%02d:%02d}, $now[5] + 1900, $now[4] + 1, $now[3], $now[2], $now[1], $now[0]; } ","date":"2010-08-17T00:05:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/08/17/000531/","title":"POSIXのstrftimeが生perlcodeよりも速い件について"},{"content":"ここのところ、CGIを書く場合は、NanoAのようなフレームワークばかり使っていたので知らなかったのだが、単純なCGIを書くときに、ど派手なデバッグスクリーンをだすモジュールがあった。 CGI::ExceptionManagerの原型とも言えるか。 PerlでCGIを作成するときに、殆どの人がお世話になるであろうモジュールは、CGI::Carpだろう。 このモジュールは、一般的に500エラーと言われている「Internal Server Error」からあなたを救ってくれる。\nSEE ALSO\nCGI::Carp::DebugScreen - search.cpan.org CGI::ExceptionManager - search.cpan.org 普通なら500エラーになってしまう以下のスクリプトを、ブラウザから実行してみると、どのように救われるのかがよくわかるだろう。\n1 2 3 4 #!/usr/bin/perl use strict; use CGI::Carp qw/fatalsToBrowser/; die; で。 この魔法を進化させたのが「CGI::Carp::DebugScreen」なのだ。 使い方は非常に簡単。 オプションは色々あるが、とにかく恩恵を受けるなら、先程のスクリプトの4行目を入れ替えるだけで良い。\n1 2 3 4 #!/usr/bin/perl use strict; use CGI::Carp::DebugScreen ( debug =\u0026gt; 1 ); die; もしも、あなたが500エラー（Internal Server Error）で困っているのなら、是非試してみて欲しい。 ちなみに、このモジュールはCPANにあるので、インストールはcpanやcpanmコマンドで。 ActivePerlな方は、コマンドプロンプトから「ppm」を実行して、GUIの検索窓で「DebugScreen」とすれば幸せになれます。 運悪く「CGI::Carp::DebugScreen」がエラーになる人でも「CGI::Carp」は使えます。 それが使えないPerlは古すぎます。\n","date":"2010-07-23T03:22:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/07/23/032243/","title":"今さらだけどCGI::Carp::DebugScreenを覚えた"},{"content":"普段、MovableTypeのプラグインでお世話になっている「小粋空間」さんが、意外なところで躓いていた。\n以上です。色々調べてこれが最適解と思ったのですが、より適切な解決方法がありましたらコメントください。 XML::Simpleで取得したデータが引き起こす文字化けの対処方法: 小粋空間\n「より適切」かどうかは分かりませんが、よりモダンな感じの解決方法を考えてみます。\n考え方としては、XML::SimpleのXMLinが内部文字列を返すのであれば、スクリプトを内部文字列化してやれば解決するのでは、という感じです。 まずは、スクリプトを「use utf8;」してしまいます。 そうすると、スクリプトに書かれている文字はPerlの内部空間と同じ状態（内部文字列）になります。 で、このまま出力すると「Wide Character」の問題が出ますので、出力時にはutf8でエンコードしてやります。 それを踏まえて書きなおすと以下のようになります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/usr/bin/perl use strict; use utf8; binmode STDOUT =\u0026gt; \u0026#34;:utf8\u0026#34;; use CGI; use XML::Simple; my $q = new CGI; print $q-\u0026gt;header(-charset=\u0026gt;\u0026#39;utf-8\u0026#39;); print $q-\u0026gt;start_html; my $xml = XMLin(\u0026#39;foo.xml\u0026#39;); my $name = $xml-\u0026gt;{name}; print \u0026lt;\u0026lt;EOF; \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;hoge.cgi\u0026#34;\u0026gt; 名前:\u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;hoge\u0026#34; name=\u0026#34;hoge\u0026#34; value=\u0026#34;$name\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;submit\u0026#34; value=\u0026#34;送信\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; EOF print $q-\u0026gt;end_html; これで文字化けはしません。\n","date":"2010-06-18T23:04:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/06/18/230449/","title":"XML::Simpleで文字化けしない方法"},{"content":"さっきの記事を書きながら、トピックスの取得だったらRSSで良いよね、と思ってしまったので、ついでに書いてみた。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # utf8 use 5.8.1; use strict; use warnings; use utf8; use Encode; use Term::Encoding qw(term_encoding); my $enc = Encode::find_encoding(term_encoding); use Data::Feed; use URI; # urlを指定する my $url = URI-\u0026gt;new(\u0026#39;http://dailynews.yahoo.co.jp/fc/rss.xml\u0026#39;); # サイトにアクセスし、Feedを取得する my $feed = Data::Feed-\u0026gt;parse($url); print $enc-\u0026gt;encode($_-\u0026gt;title).\u0026#34;\\n\u0026#34; for ($feed-\u0026gt;entries); RSSの解析をするモジュールは色々とあるけれども、今回はData::Feedを使ってみた。\nSEE ALSO Data::Feed - search.cpan.org 結果 1 2 3 4 5 菅新首相の支持率62.4% NNN エース級種牛、生き残り容認へ 回転ずし店に車 14人が重軽傷 茨城・上海チャーター便就航へ 「イカロス」帆の展開8日以降に 「昨日の記事」とか「一覧」とかも省かれているし、シンプルですね。 Web::Scraperも良いですが、この手の物は、RSSがあればそっちを利用するのがいいですね。\n","date":"2010-06-07T03:05:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/06/07/030528/","title":"Yahooのトピックスを取得する他の手段"},{"content":"「簡単！たった13行のコードでHTML取得＆解析をするPerlスクリプト - DQNEO起業日記」が面白そうだったので、コードをコピペしたけど、文字化けしたので、Windowsでも動くように書き直してみた。 …かなり行数は増えましたが。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # utf8 # インスパイア：[Perl]簡単！たった13行のコードでHTML取得＆解析をする - DQNEO起業日記 \u0026lt;http://dqn.sakusakutto.jp/2010/06/perlhtml.html\u0026gt; use 5.8.1; use strict; use warnings; use utf8; use Term::Encoding qw(term_encoding); my $encoding = term_encoding; binmode STDOUT =\u0026gt; \u0026#34;:encoding($encoding)\u0026#34;; use LWP::UserAgent; use HTML::TreeBuilder; # urlを指定する my $url = \u0026#39;http://yahoo.jp\u0026#39;; # IE8のフリをする my $user_agent = \u0026#34;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)\u0026#34;; # LWPを使ってサイトにアクセスし、HTMLの内容を取得する my $ua = LWP::UserAgent-\u0026gt;new(agent =\u0026gt; $user_agent); my $res = $ua-\u0026gt;get($url); my $content = $res-\u0026gt;decoded_content; # HTML::TreeBuilderで解析する my $tree = HTML::TreeBuilder-\u0026gt;new; $tree-\u0026gt;parse($content); # DOM操作してトピックの部分だけ抜き出す。 # \u0026lt;div id=\u0026#39;topicsfb\u0026#39;\u0026gt;\u0026lt;ul\u0026gt;\u0026lt;li\u0026gt;....の部分を抽出する my @items = $tree-\u0026gt;look_down(\u0026#39;id\u0026#39;, \u0026#39;topicsfb\u0026#39;)-\u0026gt;find(\u0026#39;li\u0026#39;); print $_-\u0026gt;as_text.\u0026#34;\\n\u0026#34; for @items; SEE ALSO HTTP::Response - search.cpan.org LWP::UserAgent - search.cpan.org HTML::TreeBuilder - search.cpan.org 文字化けしないようにするには、以下の三つが大事です。\nスクリプトをutf8で書いて、「use utf8」する 入り口でdecodeする 出口でencodeする まずはutf8で書いて「use utf8」します。 で、次は入り口でdecodeです。 今の場合、ウェブから取ってきたページをdecodeしてやる必要があります。 それをするには「$res-\u0026gt;content」としているところを、「decoded_content」にします。 ただし、「decoded_content」しても文字化けする可能性はあるので、その時は別途対策が必要になります。 とりあえず、Yahooのトップページはうまく行くので、そのままにしておきます。 ということで、$contentには、decodeされてPerlの内部形式になったYahooのトップページが保管されています。 出口のencodeについては、binmodeで宣言しているので、print時に自動的にencodeされます。 と、そんな感じに修正すると、文字化けなく表示されるようになりました。\n1 2 3 4 5 6 7 8 9 10 菅新首相の支持率62.4% NNN写真 エース級種牛、生き残り容認へ写真 回転ずし店に車 14人が重軽傷写真 茨城・上海チャーター便就航へ写真 「イカロス」帆の展開8日以降に写真 他チーム故障 ブラジルは複雑写真 全仏男子 ナダル5度目の優勝NEW 古瀬アナが絵本作家デビュー写真 昨日の話題（42件） 一覧 ","date":"2010-06-07T02:48:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/06/07/024813/","title":"HTML::TreeBuilderでHTMLの解析をするモダンなPerlスクリプト"},{"content":"モダンPerlの記事を読んで、Term::Encodingを知った。\nときには外からどのような入力がくるかわからない場合もありますが，コンソールアプリケーションであれば宮川達彦氏のTerm::Encodingというモジュールを利用すれば標準入出力のエンコーディングを判定できます。\n[モダンPerlの世界へようこそ：第32回　Encode：日本語だけ扱えればよいのではなく｜gihyo.jp … 技術評論社]\n今まで、手動で「cp932」と入力していたのだが、Term::Encodingを使ってやれば自動的に文字コード（エンコーディング）を判別できるではないか、というわけです。\nSEE ALSO\nTerm::Encoding - search.cpan.org とりあえずやってみました。\n1 2 3 4 5 6 7 8 9 # ｕｔｆ８ use 5.8.1; use strict; use warnings; use utf8; use Data::Dumper; use Term::Encoding qw(term_encoding); my $encoding = term_encoding; print Dumper $encoding; 実行結果は以下のとおり。\n1 $VAR1 = \u0026#39;cp932\u0026#39;; 文字コード（エンコーディング）を示す文字列が得られました。 というわけで、文字コード（エンコーディング）を直接書かずにTerm::Encodingを使って「ハローワールド」を表示してみると以下のようになりました。\n1 2 3 4 5 6 7 8 9 # ｕｔｆ８ use 5.8.1; use strict; use warnings; use utf8; use Term::Encoding qw(term_encoding); my $encoding = term_encoding; binmode STDOUT =\u0026gt; \u0026#34;:encoding($encoding)\u0026#34;; print \u0026#34;ハローワールド！\u0026#34;; binmodeを使わずに書くと、\n1 2 3 4 5 6 7 8 9 # ｕｔｆ８ use 5.8.1; use strict; use warnings; use utf8; use Encode; use Term::Encoding qw(term_encoding); my $enc = Encode::find_encoding(term_encoding); print $enc-\u0026gt;encode(\u0026#34;ハローワールド！\u0026#34;); な感じです。\n","date":"2010-06-02T01:37:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/06/02/013759/","title":"モダンPerl#32でTerm::Encodingを知った"},{"content":"CPANのモジュールの履歴を眺めていたら、面白そうなものがあったので試してみた。\nApp::Genpass - Quickly and easily create secure passwords\n[App::Genpass - search.cpan.org]\ncpanmでさくっとインストール。 と思ったら、minicpanでミラーできていなかったのでインストール失敗。 そういう事もあるのか。 環境変数でmirror設定しているので、変更するのが面倒だったので、アーカイブファイルを直接指定するやり方でインストールした。\n1 cpanm http://search.cpan.org/CPAN/authors/id/X/XS/XSAWYERX/App-Genpass-0.08.tar.gz 依存しているモジュールが結構あってそこそこ時間がかかったが、インストールは成功。 実行したスクリプトはSYNOPSISそのままだったのだが、Mooseに依存しているせいか動作も重い。 流石に20文字は長いが、眺めてみてもパスワードとしては遜色ない感じ。\n1 2 3 4 5 6 7 8 9 10 1\u0026amp;3XXFXAQG8tIzAi0eC2 9Ukqb!t02bGWPyj#N\u0026amp;uZ %oywF%)(#*gU%QUA9w2f #7%A7w)RQoZGEfb$16uh ifU91Ls2S^KzD#h$tOdu jGIl2oc9$lTX#6MHVhwV uiAU*uVszyxsQKY6@#Z\u0026amp; z3z)%hfffgbYTqflC0rU XGeR10#pD9g#AZ^HEXrj Os6c4$MNlSn6XUcIzL6^ 色々と細かく設定もできるけれど、すべてデフォルトでも問題はなさそう。 まあ、すべてデフォルトだったら、ここまで重いスクリプトを使うまでも無いか。\nSEE ALSO\nThe CPAN Search Site - search.cpan.org App::Genpass - search.cpan.org ","date":"2010-05-31T00:41:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/31/004108/","title":"App-Genpassを試してみた"},{"content":"Accessorの比較は、App::Benchmark::Accessorsが有名ですよね。 しかし、NanoAで使われている、Class::Accessor::Lite等、比較されていないモジュールもあります。 Accessorとして使う分には十分な機能を持っているLiteを比較してみたかったので、いくつかのモジュールを選んでベンチマークを取ってみました。\n選んだのは、Liteを含めて5つのモジュール。\nClass::Accessor::Fast Class::Accessor::Faster Class::Accessor::Lite Object::Tiny::RW Object::Simple アクセサをあらかじめ定義しておき、ベンチマークの中でnewしてsetしてgetしてsetする、という事をやりました。 まずは結果を。\n1 2 3 4 5 6 7 8 9 10 11 12 Benchmark: timing 100000 iterations of caf, cafr, cal, os, otrw... caf: 4 wallclock secs ( 5.09 usr + 0.00 sys = 5.09 CPU) @ 19661.82/s (n=100000) cafr: 5 wallclock secs ( 4.63 usr + 0.00 sys = 4.63 CPU) @ 21584.29/s (n=100000) cal: 4 wallclock secs ( 3.51 usr + 0.00 sys = 3.51 CPU) @ 28490.03/s (n=100000) os: 3 wallclock secs ( 3.71 usr + 0.00 sys = 3.71 CPU) @ 26932.40/s (n=100000) otrw: 3 wallclock secs ( 3.67 usr + 0.00 sys = 3.67 CPU) @ 27277.69/s (n=100000) Rate caf cafr os otrw cal caf 19662/s -- -9% -27% -28% -31% cafr 21584/s 10% -- -20% -21% -24% os 26932/s 37% 25% -- -1% -5% otrw 27278/s 39% 26% 1% -- -4% cal 28490/s 45% 32% 6% 4% -- 上位3モジュールは僅差ですが、Class::Accessor::Liteが最も速かったです。 Liteは、use baseを使った継承ではなく、モジュールを使うようにして定義します。 Class::AccessorやFastに慣れた人は戸惑うかもしれません。 また、継承を使わないため、newメソッドなどは別で実装する必要があります。 スピードは次点ですが、Object::Tiny::RWはアクセサの定義が簡単でした。 useする時に、アクセサをインポートするように宣言すればよいだけで、アクセサの作成を意識しません。 ソースは読んでいないので仕組みはわかりませんが、newメソッドも使えるので便利です。 ただ、名前が惜しいです。 Object::TinyがReadOnlyのアクセサを作成するモジュールなのでしょうがないのでしょうが、付け足した感が満載です。 Object::Simpleは、他の4つのモジュールと違う動作をする箇所があります。 他のモジュールはsetの時に、その値を返しますが、Object::Simpleはオブジェクトそのものを返します。 慣れもあるのでしょうが、この挙動は不思議に感じました。 また、メソッド作成で複数のアクセサが指定出来ないのも不便に感じます。 まあ、このモジュールは、アクセサじゃなくアトリビュートという扱いっぽいので、狙うところが違うのかもしれません。 独断と偏見でまとめると、NanoAで使うならClass::Accessor::Lite、それ以外で使うならObject::Tiny::RWが良いと思いました。 ベンチマークのソースは以下のとおりです。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 # ｕｔｆ８ use 5.8.1; use strict; use warnings; use utf8; package Bench::CAF; use base qw(Class::Accessor::Fast); __PACKAGE__-\u0026gt;mk_accessors(qw(foo hoge)); package Bench::CAFr; use base qw(Class::Accessor::Faster); __PACKAGE__-\u0026gt;mk_accessors(qw(foo hoge)); package Bench::CAL; use Class::Accessor::Lite; Class::Accessor::Lite-\u0026gt;mk_accessors(qw(foo hoge)); sub new { bless {}, $_[0] } package Bench::OTRW; use Object::Tiny::RW qw(foo hoge); package Bench::OS; use base qw/Object::Simple/; __PACKAGE__-\u0026gt;attr(\u0026#34;foo\u0026#34;); __PACKAGE__-\u0026gt;attr(\u0026#34;hoge\u0026#34;); package main; use Benchmark qw(:all); use Perl6::Say; # use Data::Dumper; sub confirm { # say @_; } cmpthese(timethese( 100_000, { # Class::Accessor::Fast caf =\u0026gt; sub { my $ac = Bench::CAF-\u0026gt;new; confirm($ac-\u0026gt;foo(\u0026#34;bar\u0026#34;)); confirm($ac-\u0026gt;foo); confirm($ac-\u0026gt;hoge(\u0026#34;fuga\u0026#34;)); }, # Class::Accessor::Faster cafr =\u0026gt; sub { my $ac = Bench::CAFr-\u0026gt;new; confirm($ac-\u0026gt;foo(\u0026#34;bar\u0026#34;)); confirm($ac-\u0026gt;foo); confirm($ac-\u0026gt;hoge(\u0026#34;fuga\u0026#34;)); }, # Class::Accessor::Lite cal =\u0026gt; sub { my $ac = Bench::CAL-\u0026gt;new; confirm($ac-\u0026gt;foo(\u0026#34;bar\u0026#34;)); confirm($ac-\u0026gt;foo); confirm($ac-\u0026gt;hoge(\u0026#34;fuga\u0026#34;)); }, # Object::Tiny otrw =\u0026gt; sub { my $ac = Bench::OTRW-\u0026gt;new; confirm($ac-\u0026gt;foo(\u0026#34;bar\u0026#34;)); confirm($ac-\u0026gt;foo); confirm($ac-\u0026gt;hoge(\u0026#34;fuga\u0026#34;)); }, # Object::Simple os =\u0026gt; sub { my $ac = Bench::OS-\u0026gt;new; confirm($ac-\u0026gt;foo(\u0026#34;bar\u0026#34;)); confirm($ac-\u0026gt;foo); confirm($ac-\u0026gt;hoge(\u0026#34;fuga\u0026#34;)); }, })); この記事を書きながら、何度か実行しましたが、上位3モジュールの順位は入れ替わることもありました。\n","date":"2010-05-26T22:02:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/26/220207/","title":"軽い系（？）のAccessorを比較してみた"},{"content":"cpanmを快適に使っていますが、毎回minicpanをミラー指定するのも疲れたので、ちょっと考えてみました。 helpによると、「PERL_CPANM_OPT」という環境変数にパラメータを入れておけば良いようなので、「\u0026ndash;mirror file:///C:/strawberry/minicpan」を指定します。 Windowsの場合、マイコンピュータのプロパティあたりから環境変数の設定ができると思います。\nこれで、ミラー指定をしなくてもminicpanを使ってくれるようになりました。 めでたしめでたし。\n","date":"2010-05-23T20:59:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/23/205912/","title":"cpanminusでminicpanと仲良くする方法（Windows編）"},{"content":"ちょっと前に作ったプログラムを見ていて、悪い習慣だなぁ、と思ったので、改めるためにメモ。 Perlを覚えていく中で、関数の返り値を偽として判定させたいときは「undefを返す」という事をやっていた。\n1 return undef; しかし、これは返り値を配列で受け取るときに微妙になり、わかりにくいバグを発生させてしまう原因にもなる。 どういう場合に問題になるかを、実際にコードを書いて試してみる。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # ｕｔｆ８ use 5.8.1; use strict; use warnings; use utf8; use Perl6::Say; use Data::Dumper qw/Dumper/; my $charset = \u0026#39;cp932\u0026#39;; binmode STDOUT =\u0026gt; \u0026#34;:encoding($charset)\u0026#34;; sub return_less { my $a = 1; } sub return_undef { my $a = 1; return undef; } sub return_only { my $a = 1; return; } # return_less if (my @result = \u0026amp;return_less) { say \u0026#39;return_less : true\u0026#39;; print Dumper \\@result; } else { say \u0026#39;return_less : false\u0026#39;; print Dumper \\@result; } # return_undef if (my @result = \u0026amp;return_undef) { say \u0026#39;return_undef : true\u0026#39;; print Dumper \\@result; } else { say \u0026#39;return_undef : false\u0026#39;; print Dumper \\@result; } # return_only if (my @result = \u0026amp;return_only) { say \u0026#39;return_only : true\u0026#39;; print Dumper \\@result; } else { say \u0026#39;return_only : false\u0026#39;; print Dumper \\@result; } このスクリプトを実行すると結果はそれぞれどうなるでしょうか？ しばらく考えてみて下さい。 答えは以下のようになります。\n1 2 3 4 5 6 7 8 9 10 return_less : true $VAR1 = [ 1 ]; return_undef : true $VAR1 = [ undef ]; return_only : false $VAR1 = []; いかがでしょうか？ undefを返したのに、分岐で「真」になっていますね。 これは、if文が@resultを要素数で判定したためです。 undefを返すと、見ての通り@resultに「undef」が代入されます。 そのため、@resultの判定が1となり、真となります。 期待したのは「return_only」のような動作ではないでしょうか？ return undef;は悪癖です。 理解してやる場合は別ですが、殆どの場合は単独のreturnが良いでしょう。\n","date":"2010-05-22T07:52:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/22/075233/","title":"Perlのreturn"},{"content":"試行錯誤してきましたが、ようやく正解にたどり着きました。 これで、cpanmとcpan-outdatedの組み合わせでも、minicpanを有効に使うことができます。 minicpanの場所（minicpanを実行する時のlオプションの場所）が「C:\\strawberry\\minicpan」の場合は、以下のように書きます。\n1 cpan-outdated --mirror file:///C:/strawberry/minicpan | cpanm --mirror file:///C:/strawberry/minicpan 考えてみれば、fileプロトコルでちゃんとアクセスすることを考えればよかったのです。\n","date":"2010-05-20T07:12:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/20/071210/","title":"cpan-outdatedも使ってみた（完結編）"},{"content":"ミラー指定がちゃんと動いてなさそうな件については、ソースを見たところ、cpan-outdatedだけでミラー指定しても意味が無いことがわかった。 cpan-outdatedは取得するファイルは「02packages.details.txt.gz」だけなのでした。 つまり、ミラー指定をするのであれば、cpanmでも指定する必要があるので、以下のように書いて試してみた。\n1 cpan-outdated --mirror file:///strawberry/minicpan | cpanm --mirror file:///stwawberry/minicpan しかし、結果的にはうまくいかなかった。 ダウンロードに失敗している。 ミラーの指定方法が間違っているのだろうが、どう指定すればよいか。 ちょっと考えてみよう。\n","date":"2010-05-19T07:29:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/19/072906/","title":"cpan-outdatedも使ってみた（続き2）"},{"content":"先ほどのコマンドが動き始めました。 画面のログを見る限りでは、httpから取ってきています。 タスクマネージャでも確認しましたが、fetchingの時にネットワークが動いたので、ミラー指定は効いていないのかも。\n","date":"2010-05-19T00:18:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/19/001830/","title":"cpan-outdatedも使ってみた（続き）"},{"content":"cpanm（cpanminusのコマンド名）と共によく使われているのを見るのだが、何をしているのかよくわかっていなかった。 で、ちゃんと検索したらあっさりと見つかった。 要するに\n1 cpan -r のminusバージョンという感じのアプリケーションでした。 で、これとcpanmを組み合わせることで、古いモジュールを楽に更新できる、という仕組みです。 Windowsではxargsがないので、以下のように試してみました。\n1 cpan-outdated | cpanm 今、実施中ですが、upgradeをかなりサボっていたので結構時間がかかっています。 途中でミラーも設定できそうなことに気がついたので、minicpanの保存先を使って試してみました。\n1 cpan-outdated --mirror file:///strawberry/minicpan | cpanm …が、今度はなかなか動きません。 何かがいけないのかもしれません。\nSEE ALSO\ncpan-outdatedを使うとメモリ制限のきついレンタルサーバーでもCPANモジュールが楽に更新できる - TokuLog 改メ tokuhirom’s blog MATSUNO★Tokuhiro / App-cpanoutdated - search.cpan.org ","date":"2010-05-19T00:00:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/19/000024/","title":"cpan-outdatedも使ってみた"},{"content":"Twitterデビューしたので、こういうのも試してみる。\n最近はやりのTwitterに、エントリーのタイトルとパーマリンクのTinyURLを投稿するプラグインを作ってみました。\nエムロジック放課後プロジェクト: PostToTwitter アーカイブ\nちゃんと投稿出来るかどうか、テストも兼ねて。\nSEE ALSO\nPostToTwitter | Movable Type プラグインディレクトリ ","date":"2010-05-18T21:44:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/18/214438/","title":"PostToTwitterを入れてみた"},{"content":"これまた今更な感じですが。 Twitterデビューしました。\nnqounet (nqounet) on Twitter 気が向いたら、フォローしてやって下さい。\n","date":"2010-05-18T00:31:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/18/003101/","title":"Twitterデビュー"},{"content":"乗り遅れも甚だしいですが。 cpanminusを使ってみました。\nTatsuhiko Miyagawa / App-cpanminus - search.cpan.org CPANの環境がすでにあるので、インストールはCPANから。 strawberryperl v5.10.1ですが、全く問題なくインストール出来ました。 使い勝手も上々です。\n","date":"2010-05-12T06:50:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/05/12/065013/","title":"cpanminus"},{"content":"何かで使えそうな気がして、Feed（RSSとかAtomとか）をウェブから取ってきてどうにかする、というのをNanoAでやってみた。\nRSSShow - NanoA@d.n.n nanoa/app/RSSShow/template/start.mt nanoa/app/RSSShow/start.pm レンタルサーバというのを考慮して、Feedの解析はXML::FeedPPを使った。 あと、ウェブから取ってくるところは、とりあえずLWP::Simpleのmirror関数を使った。 NanoAは、テンプレートにもコードがガリガリかけるので、モジュール側に変にタグを書くよりは、変数ごと渡してしまったほうがスッキリ書ける。 今回は、解析したFeedオブジェクトをそのままテンプレートに渡して、テンプレート側で展開しているのだけど、こういうのもありだなぁ。 それにしても、Feedの解析は何を使うのが一番いいのかなぁ。 RSSやAtomに特化して調べたことはあったけど。 流行っているのかもしれないけれど、parseする時に、引数の型で動作が変わるモジュールが多い。 JPA代表理事が作ったData::Feedでもそういうのが採用されている。\nData::Feed can parse files, URIs, raw strings, and file handles. All you need to do is to pass an appropriate parameters.\n[Data::Feed - search.cpan.org]\nこういうのは扱いやすいですよね。 今回は、FeedのcharsetがUTF-8前提なので、他のcharsetでも対応出来るように、もう少し柔軟に書いても良いかなと思います。 まあ、いずれ。\nSEE ALSO\n[Perl] XML::FeedPP - RSS・RDF・Atomフィードの解析・生成・変換・結合 Yusuke Kawasaki / XML-FeedPP - search.cpan.org ","date":"2010-04-25T00:15:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/04/25/001501/","title":"Feedをウェブから取ってきてタイトルのリストを表示してみた"},{"content":"どうにかなるものです。\nNanoAのデータベースハンドルを使えればよかったのだが、生憎とそんな機能はついていなかった。\nNanoAのconfigを使えば、NanoA本体に影響を及ぼさずにデータベースハンドルを入れ替えることが可能でした。\nアプリケーション（今の場合はLightBBS）用のdbメソッドを作ることによって、NanoA::Config::db を上書きしています。\nこっちはなんとかできたのですが、 Crypt::SaltedHash を利用するのはちょっと難しそうです。\nAuthen::Users でnewした後に、プロパティを入れ替えればいけそうな気がしたのですが、認証の仕組みが違うので単純には行きませんでした。\nAuthen::Users はデータベースから取ってきたsha変換済みのパスワードと、入力したパスワードをsha変換したモノとを比較しています。 そこまでがセットになっているのです。\nしかし、 Crypt::SaltedHash は、普通に変換するとsaltを自動的に入れてしまうので、単純に比較しても合わないのです。（元々それが特徴なわけですが） 比較するときは、変換済みのパスワードと入力したパスワードを Crypt::SaltedHash のvalidateメソッドに渡してやる必要があります。 すると、内部でsaltを解析して照合ができるようになります。 まあ、仕組みはわかりましたが。 さて、どうしたもんでしょう。\n","date":"2010-04-24T13:52:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/04/24/135255/","title":"Authen::UsersのデータベースハンドルをNanoAで使えた話"},{"content":"画像の切替で、ちょっと毛色の違うプラグインを見つけたので、試してみた。\nサンプルページ 設置の仕方が悪かったのか、手元の環境ではDoorのエフェクトがイマイチだが、それ以外は申し分ないです。 Fadeinは綺麗だし、Flipin(out)のように画像がカードのように送られるのは面白い。\nSEE ALSO\nImageSwitch | HieuUK 驚きの画像切り替え！jQueryプラグイン「Jquery.ImageSwitch」｜skuare.net 様々なエフェクトで画像置換/画像表示/SolidStateEveryday - Ajax,javascript,UIサンプルとチュートリアル - ","date":"2010-04-24T04:35:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/04/24/043518/","title":"jQueryのプラグイン「ImageSwitch」を使ってみた"},{"content":"これでもかッ、ってほど聴いている曲がある。 これだ。 キッカケは家にあったCDでした。\nKeeps Gettin\u0026rsquo; Better: A Decade of Hits\nposted with amazlet at 10.02.27\nChristina Aguilera 株式会社ソニー・ミュージックエンタテインメント (2008-11-11) 売り上げランキング: 85705\nAmazon.co.jp で詳細を見る\n妻が生徒から借りたとかなんとか言っていた気がします。 Christina Aguileraの曲は好き嫌いが激しいのですが、この曲は激しく好きです。\nSEE ALSO\nYouTube - Ricky Martin ft. Christina Aguilera - Nobody Wants to be Lonely (17) Ricky Martin \u0026amp; Christina Aguilera - Last.fm ","date":"2010-02-27T12:10:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/27/121059/","title":"最近ツボな曲"},{"content":"Crypt::SaltedHashを知ったのは、Casual Track - JPerl Advent Calendar 2009でした。 MD5の逆引きについては、一応知っていたのですが、対応については深く考えていませんでした。 でも、手軽に出来るのであればやらない理由はありません。 あ、cpanが使えない場合でも、ファイルをコピーするだけで使えます。 素晴らしいですね。\nSEE ALSO\nパスワード保存のお供に Crypt::SaltedHash - JPerl Advent Calendar 2009 Sascha Kiefer / Crypt-SaltedHash - search.cpan.org ","date":"2010-02-27T11:22:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/27/112218/","title":"何故Crypt::SaltedHashを使いたかったのか"},{"content":"データベースを使った簡単な掲示板もできたので、ユーザー登録出来る掲示板を作ろうと思った。 折角なので参考になるようなモジュールをCPANで探してみようと思った。 そうしたら出るわ出るわ。 Catalystのプラグインが多いこと。\nとはいえ。 CatalystではなくNanoAでAuthenticationしたいわけで。 少し探してみたら、便利そうなモジュールがあった。\nAuthen::Users - DBI Based User Authentication - metacpan.org SQLiteかMySQLを使って、ユーザー情報の保管や認証を助けてくれるモジュールのようだ。 NanoAのデータベースハンドルを使えればよかったのだが、生憎とそんな機能はついていなかった。 newすると、自動的にデータベースハンドルを作ってしまうので、認証システムは単独で使ってみることにした。 …これは楽だ。\n結構簡単にユーザー登録はできた。 本当は、ハッシュの作成にCrypt::SaltedHashを使いたかった。 ソースを読んでも仕組みが理解できなかったが、同じ文字列でも毎回結果がちがうので、逆引きが不可能になるしろものだ。 しかし、Authen::Usersは、パスワードの保存方法を選べない。 というか、結構ガチガチに仕様が決まっているようで、応用は難しそうだった。 ということで、NanoAでどうにかしないと。 というか、どうにかしたいなと。\n","date":"2010-02-24T09:35:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/24/093546/","title":"NanoAでAuthenticationしたい"},{"content":"小さな事からコツコツと。 ということで、nopasteのデータベース使用版とログイン不要の一行掲示板を作ってみた。\nSEE ALSO\nNoPaste(Database) - NanoA@d.n.n picoBBS - NanoA@d.n.n データベースを使うにあたって、はじめは素のDBIを使っていたのだが、折角なのでプラグインを作ってみた。 …と言っても、MENTAのプラグインをNanoA用に書き直しただけなんだけど。 やはりページネーションが便利ですよ。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 package plugin::sql; use strict; use warnings; use utf8; use base qw(NanoA::Plugin); sub init_plugin { my ($klass, $controller) = @_; no strict \u0026#39;refs\u0026#39;; no warnings \u0026#39;redefine\u0026#39;; # Usage: $app-\u0026gt;sql_do($statement); *{$controller . \u0026#39;::sql_do\u0026#39;} = sub { my ($app, $sql) = @_; my $dbh = $app-\u0026gt;db; $dbh-\u0026gt;do($sql) or die $dbh-\u0026gt;errstr; }; # Usage: $app-\u0026gt;sql_prepare_exec($statement, \\@params); *{$controller . \u0026#39;::sql_prepare_exec\u0026#39;} = sub { my ($app, $sql, $params) = @_; my $dbh = $app-\u0026gt;db; $params = [] unless ref $params eq \u0026#39;ARRAY\u0026#39;; my $sth = $dbh-\u0026gt;prepare($sql) or die $dbh-\u0026gt;errstr; $sth-\u0026gt;execute(@{$params}) or die $dbh-\u0026gt;errstr; $sth-\u0026gt;finish; undef $sth; }; # Usage: my $rows = $app-\u0026gt;sql_select_all($statement, \\@params); # $rows : foreach my $row (@{$rows}) { $row-\u0026gt;{field} } *{$controller . \u0026#39;::sql_select_all\u0026#39;} = sub { my ($app, $sql, $params) = @_; my $dbh = $app-\u0026gt;db; $params = [] unless ref $params eq \u0026#39;ARRAY\u0026#39;; my $sth = $dbh-\u0026gt;prepare($sql) or die $dbh-\u0026gt;errstr; $sth-\u0026gt;execute(@{$params}) or die $dbh-\u0026gt;errstr; my @res; while (my $row = $sth-\u0026gt;fetchrow_hashref) { push @res, $row; } $sth-\u0026gt;finish; undef $sth; return \\@res; }; # Usage: my ($rows, $pager) = $app-\u0026gt;sql_select_paginate($statement, \\@params, { page =\u0026gt; num_of_page, rows =\u0026gt; num_of_rows }); # $rows : foreach my $row (@{$rows}) { $row-\u0026gt;{field} } # $pager-\u0026gt;{page} : page number # $pager-\u0026gt;{has_next}: has next page # $pager-\u0026gt;{has_prev}: has prev page *{$controller . \u0026#39;::sql_select_paginate\u0026#39;} = sub { my ($app, $sql, $params, $paging) = @_; my $dbh = $app-\u0026gt;db; $params = [] unless ref $params eq \u0026#39;ARRAY\u0026#39;; $sql .= \u0026#39; LIMIT ? OFFSET ?\u0026#39;; my $sth = $dbh-\u0026gt;prepare($sql) or die $dbh-\u0026gt;errstr; $sth-\u0026gt;execute(@{$params}, $paging-\u0026gt;{rows}+1, ($paging-\u0026gt;{page}-1)*$paging-\u0026gt;{rows}) or die $dbh-\u0026gt;errstr; my @res; while (my $row = $sth-\u0026gt;fetchrow_hashref) { push @res, $row; } $sth-\u0026gt;finish; undef $sth; my $has_next = 0; if ( @res == $paging-\u0026gt;{rows} + 1 ) { pop @res; $has_next++; } return (\\@res, {page =\u0026gt; $paging-\u0026gt;{page}, has_next =\u0026gt; $has_next, has_prev =\u0026gt; ($paging-\u0026gt;{page} != 1) ? 1 : 0}); }; } # initialize myself __PACKAGE__-\u0026gt;init_plugin(__PACKAGE__); 1; ついでに、それ用のテンプレートも作ってみた。 まあ、MENTAの（以下略\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ? my $pager = $c-\u0026gt;{pager}; ? my $action = $c-\u0026gt;{action}; ? my $page_n = $pager-\u0026gt;{page}; ? if ($pager-\u0026gt;{has_prev}) { \u0026lt;a href=\u0026#34;\u0026lt;?= $app-\u0026gt;uri_for($action, { page =\u0026gt; $page_n - 1 }) ?\u0026gt;\u0026#34; rel=\u0026#34;prev\u0026#34;\u0026gt;前\u0026lt;/a\u0026gt; ? } else { \u0026lt;span class=\u0026#34;disabled\u0026#34;\u0026gt;前\u0026lt;/span\u0026gt; ? } |（現在：\u0026lt;?= $page_n ?\u0026gt;ページ）| ? if ($pager-\u0026gt;{has_next}) { \u0026lt;a href=\u0026#34;\u0026lt;?= $app-\u0026gt;uri_for($action, { page =\u0026gt; $page_n + 1 }) ?\u0026gt;\u0026#34; rel=\u0026#34;next\u0026#34;\u0026gt;次\u0026lt;/a\u0026gt; ? } else { \u0026lt;span class=\u0026#34;disabled\u0026#34;\u0026gt;次\u0026lt;/span\u0026gt; ? } formプラグインを通じてHTML::AutoFormを使っているが、checkboxのcheckedが思ったように動かない。 checked=\u0026gt;1にしても、チェックが入っていない状態になる。 HTML::AutoFormのtディレクトリにあるコードと同じように書いているのだけど。 何故だ…。\n","date":"2010-02-14T21:30:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/14/213041/","title":"NanoAでデータベースを使ってみる"},{"content":"Yacafiのソースを読んでいたら気づいてしまった。\n1 my $CRLF = \u0026#34;\\r\\n\u0026#34;; CRLFの定義って重要だね。\n","date":"2010-02-10T23:58:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/10/235803/","title":"CRLFって重要！"},{"content":"CGIのヘッダーを自力で出力していたときに気にした記憶があった。\n\\nは環境依存なので、\\015\\012とか使った方がいい\n[はてなブックマーク - Charsbar::Bookmark]\nCharsbarさんの言うとおりでしょうね。 NanoAのextlibにも入っているCGI::Simpleでは、改行コードをOSに応じて定義しているようです。\nSEE ALSO\nCGI::Simple - search.cpan.org 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Define the CRLF sequence. You can\u0026#39;t use a simple \u0026#34;\\r\\n\u0026#34; because of system # specific \u0026#39;features\u0026#39;. On EBCDIC systems \u0026#34;\\t\u0026#34; ne \u0026#34;\\011\u0026#34; as the don\u0026#39;t use ASCII sub crlf { my ( $self, $CRLF ) = @_; $self-\u0026gt;{\u0026#39;.crlf\u0026#39;} = $CRLF if $CRLF; # allow value to be set manually unless ( $self-\u0026gt;{\u0026#39;.crlf\u0026#39;} ) { my $OS = $^O || do { require Config; $Config::Config{\u0026#39;osname\u0026#39;} }; $self-\u0026gt;{\u0026#39;.crlf\u0026#39;} = ( $OS =~ m/VMS/i ) ? \u0026#34;\\n\u0026#34; : ( \u0026#34;\\t\u0026#34; ne \u0026#34;\\011\u0026#34; ) ? \u0026#34;\\r\\n\u0026#34; : \u0026#34;\\015\\012\u0026#34;; } return $self-\u0026gt;{\u0026#39;.crlf\u0026#39;}; } NanoAはともかく、CGI::ExceptionManagerのようにCPANにアップしてあるものは、この辺もしっかり修正してもらう方が良いでしょうね。\n","date":"2010-02-10T01:23:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/10/012344/","title":"HTTPの改行について"},{"content":"パスワードの要求画面では相変わらずエラーが出ているのだが、パスワードを入れると（XREAの環境では）ログイン出来るようになっていた。 しかし、ローカル環境では、未だにログインできず。 ローカル環境では、パラメータを直接書き込んでログインしたことにすれば、$app-\u0026gt;is_adminはちゃんと認識してくれる。 それと、何故かログアウトはちゃんと動く。 sessionまわりの挙動がかなり謎。 admin.pmの中では同じようにredirectしているように見えるんだけど…。 何が違うんだろうか？\n","date":"2010-02-09T23:59:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/09/235928/","title":"気がつけばログイン出来るようになっていた"},{"content":"NanoAの話ですが。 オフィシャルのcompile_errorはちゃんと動作するのだが、XREAではcompile_errorは動かない。 まあ、XREAはよいとしても、ローカル環境でも動かないのがとてもつらい。 CGI::ExceptionManagerがちゃんと働いていれば、コンパイル時のエラーも補足してくれるはずなのだが…。 と、思ってソースを見ていると、原因っぽいところがわかりました。\nCGI::ExceptionManagerのoutputで、HTTPステータス500を出力していますが、そこの改行コードに問題があったようです。 「\\r\\n」になっているところを「\\n」に変えてやるとちゃんとローカル環境でも動きました。 ただ、これがHTTP的に正しいのかどうかが少し疑問です。 …と、思ったのですが。 先日変更したステータス302の出力は「\\n」でやっていました。 とりあえず、extlibにあったCGI::ExceptionManager::StackTrace::CGIは以下のように変更しました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 Index: CGI.pm =================================================================== --- CGI.pm (リビジョン 36612) +++ CGI.pm (作業コピー) @@ -8,9 +8,9 @@ warn $err-\u0026gt;{message}; - print \u0026#34;Status: 500\\r\\n\u0026#34;; - print \u0026#34;Content-type: text/html; charset=utf-8\\r\\n\u0026#34;; - print \u0026#34;\\r\\n\u0026#34;; + print \u0026#34;Status: 500\\n\u0026#34;; + print \u0026#34;Content-type: text/html; charset=utf-8\\n\u0026#34;; + print \u0026#34;\\n\u0026#34;; my $body = $args{renderer} ? $args{renderer}-\u0026gt;($err, %args) : $err-\u0026gt;as_html(%args); utf8::encode($body); うーん。 ちゃんと動くようになって、なんだか、とってもスッキリしました。\n","date":"2010-02-09T04:06:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/09/040629/","title":"続々・色々と動かなかった話"},{"content":"NanoAについては、ローカル環境で色々と試行錯誤しているわけだが、元々のサンプルを参考にしたいので、できるだけ元の状態を保っておきたいと思っているのだが、なかなか思うように行かない。\nで、ソースを読んでいたら、appディレクトリの下にindexというディレクトリを作ってやれば、そちらを読んでくれそうだったので試してみた。\nローカル環境では、サーバーポートは80以外でやっているのだが、元々のDispatch.pmではポートのことを考慮していないようだった。\n修正したらうまくいったので参考までに。\n1 2 3 4 5 6 7 8 9 10 11 12 13 Index: Dispatch.pm =================================================================== --- Dispatch.pm (リビジョン 36612) +++ Dispatch.pm (作業コピー) @@ -9,7 +9,8 @@ my $handler_path = substr($ENV{PATH_INFO} || \u0026#39;/\u0026#39;, 1); if ($handler_path eq \u0026#39;\u0026#39; \u0026amp;\u0026amp; -d \u0026#39;app/index\u0026#39;) { - print \u0026#34;Status: 302\\nLocation: $ENV{SCRIPT_NAME}/index/\\n\\n\u0026#34;; + my $uri = NanoA::nanoa_uri; + print \u0026#34;Status: 302\\nLocation: $uri/index/\\n\\n\u0026#34;; CGI::ExceptionManager::detach(); } $handler_path =~ s{..}{}g; これで、nanoa.cgiにアクセスしても、nanoa.cgi/index/にリダイレクトされるようになった。\nこのおかげで、トップページがアプリケーションの一つとして管理できるので、headerやfooterを含め、スタイルシートを使ったレイアウトの切り替えが簡単になった。\nこんなところまで考えてあったんだなぁ。\nあと、nanoa.cgiと同じ場所にstaticディレクトリを作って、スタイルシートをそっちにおくようにした。\napp以下のアプリケーションディレクトリにそのまま入れて使うことで、アプリケーションごとに管理するのが普通だろうけど、systemに入っているスタイルシートを共通で使うのではなく、共通で使うスタイルシートや、JavaScript等を置いておく場所を作りたかったので。\nあと、オリジナルをそのままの状態で運営することで、NanoAが急激に進化したときでも入れ替えをスムーズに出来るかなぁと。\n","date":"2010-02-07T20:05:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/07/200515/","title":"NanoAでインデックスページを作ると良いことがあった"},{"content":"NanoAで便利だと思ったのは、フォームを作成するときに使っているHTML::AutoFormだ。 CPANにあるのかと思ったら、なかった。 codereposで管理されているモジュールだった。 フォームの定義をしておくと、HTMLを生成したり、投稿された内容をチェックしたりできる。 その定義が簡単に出来るのがすごい。\nSEE ALSO\n/lang/perl/HTML-AutoForm/trunk - CodeRepos::Share - Trac HTML::AutoForm (フォームビルダー＆バリデータの話) - kazuhoのメモ置き場 ","date":"2010-02-06T13:53:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/06/135301/","title":"NanoAのextlibにあるHTML::AutoFormについて"},{"content":"一年と少し前にブームになったMENTA、NanoA、Yacafiの軽量WAFのなかで、今の時点で最も動かしやすそうなNanoAを少しずつ触ってみることにした。\nNanoA - devel.nqou.net とりあえず、プラグインがちゃんと動いてくれるのかを確かめようと思ったのだが、なかなかうまく動かない物がある。 Windows上でもサーバー上でも動かないのは、管理モードだ。 サーバ上では以下のようなエラーが発生する。\nyou should call HTTP::Session-\u0026gt;finalize method manually\n[devel.nqou.net]\nちゃんと追えばわかるのかもしれないが、とりあえず放置。 （HTTP::SessionのDESTROYの時にstoreされていない、というのが原因っぽいのだけど…。） パスワードは合っているのに、「ログインしています」に変わらない。 なので、perl-nanoa-managerも使えない。 あとは、細々としたことだが、例えば、モバイルモード。\n実行例: 「あなたのブラウザは NonMobile です」\n[Mobile プラグイン - devel.nqou.net]\nこれは、サブルーチンのredefinedで警告される。 まあ、これについては、一行目の\n1 ? use plugin::mobile; を削除すれば警告は消えるのだが。 ちゃんと動いているのかは不明。 （まあ、プラグインから解説ページを呼び出しているので二重読みになっているのだろうと推測） あと、podについては、raw_stringになっていない箇所があった。 等々。 時代はPSGI/Plackだというのに、今更何をやっているのかとも思いますが。 まずは、軽量WAFというハードルを超えていかなければ！ …と、目の前の断崖絶壁を見て途方にくれている今日この頃です。 NanoA等のほぼ一年前にはやった和製軽量WAFについては、初心者向けの資料があまりありません。 一年ほど前に、kansai.pmに出席したときから状況があまり変わっていませんが、そんな中で非常に参考になるNanoAについての情報を見つけましたので、自分のためにもおいておきます。 これを参考にして、生きたプログラムを作ろう。\nSEE ALSO\nPerlメモ/NanoA - Walrus, Digit. ","date":"2010-02-06T00:06:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/06/000612/","title":"続・色々と動かなかった話"},{"content":"MENTAの新バージョンをインストールして、動いていたと思ったのだが、ちゃんと動いていなかったようだ。 app/controller/nanochat/main.plを実行するときにエラーが発生するようになっていた。 原因は今のところ、不明。 バージョンを0.14に下げても同じエラーになっているので、ひょっとして、最初から動いていなかったのではないかと打ちひしがれてみる。 で、NanoAといえば、サーバー上では動作するものの、手元のWindows上のローカルサーバーでは真っ白な画面になるだけで動かない。 過去の記事を見てうんうん唸っていたがヒントはない。 仕方が無いので、コマンドラインで実行してみると、どうやら一時ファイルを作れていないようだった。 ルートディレクトリに「tmp」というフォルダを作ってやって実行すると、動いた。 …まあ、Windows仕様ではないから仕方が無いよね。 「mt_cache_dir」の設定を変えてやれば良いんだろうけど。 で、今更ながら「Yacafi」に手を出してみた。 またもや、サーバーでは動くが、手元のローカルサーバーでは動かない。こちらはアクセスがキャンセルされたような反応。 コマンドラインで実行してみると、ちゃんとHTMLが表示されている。 うーむむむむむ。何がいけないのか不明。\n","date":"2010-02-04T01:32:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/02/04/013212/","title":"色々と動かなかった話"},{"content":"手元にあるPerlでは、UTF-8のBOM（Byte Order Mark）を付けていてもスクリプトがちゃんと実行される。 なので、最近は（文字コードの自動認識を手助けする意味でも）BOMをつけて保存していた。 ところが。 Perl::Tidyの系列（Acme::PerlTidyとか）でBOM付きのスクリプトを整形しようとすると、残念ながらエラーが返ってきて整形できないのだ。 …気づくのが遅かったか。\nまあ、Programmer\u0026rsquo;s Notepadは、BOMの有無がわかるし、外すのも簡単なので、あまり問題はないけど。 Programmer\u0026rsquo;s Notepadの機能を活かして、PerlTidyを適用している。 OptionのToolsにPerlTidyを登録して、いつでも使えるようにしてある。 まあ、実際のところ、めったに使わないわけだが。\n","date":"2010-01-29T00:39:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/29/003929/","title":"UTF-8のBOMとPerl::Tidyの関係について"},{"content":"devel.nqou.netでは、jqueryFileTreeを使って作ったDirectory Listから、Faceboxを使ってソース表示や画像表示をしていた。 jqueryのコールバックを使って実現していたのだが、今思えばややこしいことをしていた。 今回、ColorBoxで実現するに際しては、iframeで表示することにした。 試行錯誤はしたが、結果的にとてもシンプルになった。 start_colorbox.js しばらくはこれで行こう。\n","date":"2010-01-28T23:42:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/28/234246/","title":"FaceboxでやっていたことをColorBoxで出来るようになった"},{"content":"jQueryのプラグインで、LightBoxのようなエフェクトが使えるプラグインである「ColorBox」を導入してみた。\nA light-weight, customizable lightbox plugin for jQuery 1.3 and 1.4\n[ColorBox - customizable lightbox plugin for jQuery 1.3 \u0026amp; 1.4]\nprettyPhotoでは、sourcereader.cgiを使ったソース表示が無理っぽかった（iframeはhrefにwidthやheightのサイズを入れるような）ので、とりあえず、別のものを探そうかと。 探せばいくらでも見つかるので、できるだけ新しいものを探した。 それがたまたま「ColorBox」だったわけだが。\nということで、本来の目的であるソース表示とか。 miscellaneous/learn_wide_character/print.pl 最近お気に入りのTaylor SwiftのPVとか。\nYouTube - Taylor Swift - You Belong With Me\nお馴染みの石原さとみとか。 Satomi-Ishihara\nしかし、本当にどれかに統一したいなぁ。\n","date":"2010-01-25T23:53:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/25/235350/","title":"LightBoxライクなColorBoxを使ってみた"},{"content":"データベース関係のモジュールというと、今までDBIしか使ったことがなかったのです。 CDBIとかDBICとか話には聞いているけれど、イマイチよく分からないので、手を出していなかったのです。 まあ、DBIを使い始めた頃に作った、オレオレモジュールで間に合うくらいしかデータベースを使っていないので、別に不便でもなかったので。 しかし、JPerl Advent Calendar 2009で、DBIx::SkinnyとData::Modelの紹介があってO/Rマッパーも試してみたいと思ってきました。 で、まずは身近なところから入門しようかということで、DBIx::Simpleです。\nSEE ALSO\nuse DBIx::Simple; - 今日のCPANモジュール DBIx::Simple::Examples - search.cpan.org DBIと違って、データベースへのアクセスを意識せずに使えるのは気分的に楽です。 特にselect、insert、update、deleteは、直接メソッドとして扱えるのは良いです。 オレオレモジュールでは、引数の一つとして入れていましたが、これはわかりやすい。 背後にSQL::Abstractというモジュールが働いているらしいのですが、意識しないで使えるのが素晴らしいです。 queryメソッドで生のSQL文も発行できるので、面倒なことが省けて、かつ、かゆい所に手が届く、なかなか良いモジュールです。 …まあ、レンタルサーバーには入っていませんけども。\n","date":"2010-01-23T15:11:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/23/151116/","title":"たまにはDBIx::Simpleを使ってみる"},{"content":"普段は「binmode STDOUT =\u0026gt; \u0026lsquo;:encoding(cp932)\u0026rsquo;;」とやっているので、Wide characterとは無縁なわけです。 が、データベースとのやりとりを整理する上で気になったので、printとsayを標準出力とファイルで実験してみました。 使用したのはStrawberry Perlの5.10.1.0のmsi版。 結果を先に書くと、Perl6::Sayのsayコマンドは、STDOUTに出力するときは、内部形式から変換してくれるらしい事がわかりました。\n普通、use utf8した状態で、Perlの内部形式のまま出力すると「Wide character in print ~~~」というようなエラーメッセージがでる。 しかし、Perl6::Sayのsayコマンドだとエラーにならない。 それなら、と思って「use Modern::Perl」してsayコマンドを試してみたのだが、こっちは「Wide character」になるのだ。 当然、「use feature ’say’」しても「Wide character」だった。 ソースはdevel.nqou.netのDirectory Listのmiscellaneous以下にあります。 まとめると以下のような感じ。 OKは問題なし。NGはWide character。 それ以外はエラー。\nprint Perl6::Say feature \u0026lsquo;say\u0026rsquo; Modern::Perl (print) Modern::Perl (say) STDOUTNGOKNGNGNG FILENG(syntax error)NGNGNG FILE(OO)(no method)NG(no method)(no method)(no method)\nsayを使うときには気を付ける必要がありそうだ。\n","date":"2010-01-23T10:22:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/23/102213/","title":"PerlのWide characterについて実験してみた"},{"content":"はじめのうちは、USBメモリに入れてPerl自体を持ち歩こうと思っていたのだが、ネットブックごと持ち歩くことになりつつあるので、Portable版はやめることにした。\nSEE ALSO\nStrawberry Perl for Windows ","date":"2010-01-16T07:03:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/16/070350/","title":"Strawberry PerlのPortable版をやめた"},{"content":"ウロウロしていたら、MENTAがバージョンアップしているのを発見した。 しかも、オフィシャルサイトのアドレスも変わっていた。\nMENTA とりあえず、適用。\n","date":"2010-01-07T23:05:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/07/230550/","title":"MENTAがバージョンアップしていた"},{"content":"StrawberryPerlでminicpanを使う時に設定でハマったのでメモ。 ネットブックを買ったので環境整備。StrawberryPerlはportable版を選んでみた。 折角なのでminicpanを使ってみようとしたら、ダウンロード自体は問題ないが、cpanからインストールする時にうまく動かず。 portable版だけかもしれないけど、minicpanのローカル保存の場所が実行時のパラメータに関係なく固定されていた。 それと、Cpan::Config.pmに、オフライン時にminicpanがあれば使うようなコードが書いてあったのだが、どうも、その設定が違っていたようだ。 なんか、fileプロトコルで使っているスラッシュが一つ多いみたい。 ×　file:///C:/strawberry/minicpan ○　file://C:/strawberry/minicpan スラッシュをひとつ消したことで、ちゃんとインストールできるようになった。 ただ、これはこれで微妙な気がする。 参考リンク\nCPAN::Mini で CPAN のミラーをローカルに: blog.bulknews.net use CPAN::Mini; - 今日のCPANモジュール ","date":"2010-01-07T21:51:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/07/215103/","title":"Strawberry Perlでminicpanを使えるようになるまで"},{"content":"なんとか上手くいく方法はないものかと。\n定石では、標準出力は『binmode STDOUT, \u0026lsquo;:encoding(shiftjis)\u0026rsquo;;』でutf8からshiftjisに変換できるはずですが、なぜか上手く行かず…。\nSQLiteを使ってみる！ - 燈明日記\n普段から「binmode STDOUT =\u0026gt; \u0026ldquo;:encoding(cp932)\u0026quot;;」をよく使うので、なんとかならないかやってみました。やってみればちゃんと出来るものです。\n基本的には、Perlの内部形式の考え方をおさらいする形になった。プログラムで扱う前にdecode、出力するときはencodeする。それは、標準入出力だろうが、データベースだろうが、同じ扱い、ということ。SQLiteはutf8の入出力が（少なくともver3.6.13では）可能のようだ。\nまずは出力の時、データベースに渡すステートメントは「Encode::encode_utf8」してから出力する。そして入力の時、つまり、データベースからデータを取る時は、とって来た後に「Encode::decode_utf8」する。\nイメージは下の図。今回は出力だけなのでSTDINは使っていないが、binmode STDOUTをencodingで使う場合は、あわせて指定しておくのが定石だと思われる。\n1 2 3 ｜ ｜→（binmode STDIN ）→｜ ｜→（encode_utf8）→｜　｜ ｜DOS画面｜　｜Perl内部｜　｜データベース｜ ｜ ｜←（binmode STDOUT）←｜　｜←（decode_utf8）←｜　｜ 「binmode STDOUT =\u0026gt; \u0026ldquo;:encoding(cp932)\u0026quot;;」とやる場合、printする時は内部形式のまま出力するように書けばいいので、他には何もすることがない。\n他にも挙動を調べたかったので、中身は少し変えた。\nスクリプト 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 # utf8 use 5.8.1; use strict; use warnings; use utf8; use DBI; use Encode; my $lang_code = \u0026#39;cp932\u0026#39;; binmode STDOUT =\u0026gt; \u0026#34;:encoding($lang_code)\u0026#34;; my $database = \u0026#39;:memory:\u0026#39;; # DBD::SQLite ver1.27以降 my @dsn = (\u0026#34;dbi:SQLite:dbname=$database\u0026#34;,); my $dbh = DBI-\u0026gt;connect(@dsn); printn(\u0026#34;ver\u0026#34; . $dbh-\u0026gt;{sqlite_version}); my $create_table = \u0026#39;CREATE TABLE IF NOT EXISTS books (\u0026#39; . \u0026#39;タイトル,\u0026#39; . \u0026#39;著者\u0026#39; . \u0026#39;);\u0026#39;; sub_do($dbh, $create_table); # insert文の実行 my $statement; $statement = qq/insert into books (タイトル, 著者) values (\u0026#39;Perl\u0026#39;, \u0026#39;啓仁\u0026#39;);/; sub_do($dbh, $statement); $statement = qq/insert into books (タイトル, 著者) values (\u0026#39;C++\u0026#39;, \u0026#39;成憲\u0026#39;);/; sub_do($dbh, $statement); $statement = qq/insert into books (タイトル, 著者) values (\u0026#39;C#\u0026#39;, \u0026#39;☺鳳☻\u0026#39;);/; sub_do($dbh, $statement); $statement = q/insert into books (タイトル, 著者) values (\u0026#39;Python\u0026#39;, \u0026#39;☻鳳☺\u0026#39;);/; sub_do($dbh, $statement); $statement = q/insert into books (タイトル, 著者) values (\u0026#39;Java\u0026#39;, \u0026#39;Keva\u0026#39;);/; sub_do($dbh, $statement); # update文の実行 $statement = q/update books set タイトル = \u0026#39;Ruby\u0026#39; where 著者 = \u0026#39;成憲\u0026#39;/; # 著者が\u0026#39;成憲\u0026#39;のタイトルを「Ruby」に更新 sub_do($dbh, $statement); # delete文の実行 $statement = q/delete from books where 著者 = \u0026#39;☻鳳☺\u0026#39;;/; sub_do($dbh, $statement); # select文の実行 my $sth = $dbh-\u0026gt;prepare(\u0026#34;select * from books;\u0026#34;); $sth-\u0026gt;execute; # 各行のフェッチ while (my $row = $sth-\u0026gt;fetchrow_arrayref) { # 各行を出力 my $str = $row-\u0026gt;[0] . \u0026#34;:\u0026#34; . $row-\u0026gt;[1]; $str = Encode::decode_utf8($str); printn($str); } undef $sth; # データベースの切断 $dbh-\u0026gt;disconnect; sub sub_do { my ($dbh, $statement) = @_; $statement = Encode::encode_utf8($statement); $dbh-\u0026gt;do($statement); } sub printn { print @_; print \u0026#34;\\n\u0026#34;; } 実行結果 1 2 3 4 5 6 7 \u0026#34;\\x{263a}\u0026#34; does not map to cp932. \u0026#34;\\x{263b}\u0026#34; does not map to cp932. ver3.6.13 Perl:啓仁 Ruby:成憲 C#:\\x{263a}鳳\\x{263b} Java:Keva SQLiteは手軽に使えるので、使い方をちゃんと考えてみるのも良いもんだ。\n","date":"2010-01-04T23:19:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/04/231901/","title":"DBD::SQLiteの入出力をちゃんと考えてみる"},{"content":"成田空港に到着。 この後、伊丹空港行きまで少し時間があるので、ラウンジで休憩中。 すぐ休憩終わりだけど。\n","date":"2010-01-03T17:42:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2010/01/03/174205/","title":"帰国"},{"content":"ヤフーカフェin成田。 ということで、ポチッと。\n","date":"2009-12-23T12:50:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/12/23/125045/","title":"恒例のヤフーカフェにて"},{"content":"またアメリカに行ってきます。 ということでポチッと。\n","date":"2009-12-23T07:49:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/12/23/074919/","title":"恒例のラウンジオーサカにて"},{"content":"国内最後のアクセスということで、ポチッと。\n","date":"2009-05-04T13:35:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/05/04/133549/","title":"ヤフーカフェにて"},{"content":"成田空港のラウンジから。 ブースがあるのは知っていたけれど、パソコンの貸出しまでしているとは知らなかった。 ということで、記念に書き込んでみた。\n","date":"2009-05-04T10:52:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/05/04/105221/","title":"IASS in 成田"},{"content":"今からアメリカに向けて出発です。 相変わらず空調が効きすぎです。 寒いです。 改めてショックだったのは、Firefoxを使おうと思ったら、バージョン1.0だった、ということです。 なので、久しぶりにIEを使っています。\n","date":"2009-05-04T07:39:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/05/04/073948/","title":"（恒例の）ラウンジオーサカにて"},{"content":"Vectorを久しぶりに使ったら面白そうなゲームが広告に出ていたので試してみた。 1日5分からでも楽しめる、というのが、どういうことなのかも気になった。 そのゲーム：シミュレーションRPG! ドラゴンクルセイド: Vector オフィシャルの説明は以下のとおり。\n1日5分からでも楽しめる! 『ドラゴンクルセイド』は、オフライン状態のときもゲームが進行するシステムを採用しているため、プレイヤーの時間負担をかけません。隙間時間にキャラクターに指示を出したり、生産の設定などをしておいて、結果を後でじっくり確認するといった遊び方も可能です。\n実際に遊んでみての感想。 このゲームでは、ダイヤというアイテムが課金アイテムとなる。 このダイヤを使うことで、時間を買うことができる、というのが今の印象。 このゲームでは、何か行動すると時間がかかる。 建物を建てるのに30分とか1時間とか。 例えば、ダイヤを使うと、その建物を瞬時に完成させることができる。 オンラインゲームの課金システムはアイテムに課金というのをよく見たが、時間を買うというのはなかなかいいアイデアだと思った。\nもう一つ秀逸だと思ったのは、毎日アクセスさせるための仕組み。 プレイヤーは城主になって、内政もしていくのだが、税金の徴収は1日1回、手動で行う必要がある。 本当の序盤は、チュートリアルクエストによってそこそこにお金は手に入るが、すぐに足りなくなる。 お金はかなり重要なのだが、この税収がなければやっていけない。 一般的なゲームなら、この程度のことは自動で行われるのだが、そこをあえて手動にすることでアクセスさせるように作っているのだろう。 これはプレイヤーにとっては面倒だが、なかなかいい仕組みだ。\n","date":"2009-04-26T12:38:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/04/26/123837/","title":"ドラゴンクルセイドというゲームについて"},{"content":"面白そうなネタを見つけたので、便乗してみた。\n1 my @update = grep { my $a = 1; foreach my $b (@key) { $a = 0 if $_ eq $b; } $a; } @items; Perlで配列Aから配列Bにある要素を取り除くには？ 1 2 my %key = map { $_ =\u0026gt; 1 } @key; my @update = grep { not exists $key{$_} } @items; Re: Perlで配列Aから配列Bにある要素を取り除くには？ 上の二つでは、ハッシュを使うほうが段違いに速い。\nその傾向は大きい配列になるほど顕著になる。\nでも、配列が大きくなると、mapの部分が結構時間がかかるようなので、ハッシュスライスにしてみた。\n1 2 3 my %hash; undef @hash{@key}; my @update = grep { not exists $hash{$_} } @items; その結果、さらに速くなった。\nしかも、配列が大きくなればなるほど効果も上がっている。\nやはり、スライスは使えるテクニックだ。\n参考ベンチの結果とソースは以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #!/usr/bin/env perl use strict; use warnings; use Benchmark qw(:all); use Data::Dumper::Names; $Data::Dumper::Indent = 1; sub p (@) { print Dumper(@_) } use List::Util qw(shuffle); use Perl6::Say; our @items = shuffle(\u0026#34;a\u0026#34; .. \u0026#34;z\u0026#34;); our @key = shuffle(\u0026#34;f\u0026#34; .. \u0026#34;zz\u0026#34;); say join \u0026#39; \u0026#39;, \u0026#39;@items = qw(\u0026#39;, @items, \u0026#39;);\u0026#39;; say join \u0026#39; \u0026#39;, \u0026#39;@key = qw(\u0026#39;, @key, \u0026#39;);\u0026#39;; cmpthese( timethese( 0, { Linear =\u0026gt; sub { my @update = grep { my $a = 1; foreach my $b (@key) { $a = 0 if $_ eq $b; } $a; } @items; }, Hash =\u0026gt; sub { my %key = map { $_ =\u0026gt; 1 } @key; my @update = grep { not exists $key{$_} } @items; }, Hash2a =\u0026gt; sub { my %hash; @hash{@key} = (1) x @key; my @update = grep { not exists $hash{$_} } @items; }, Hash2b =\u0026gt; sub { my %hash; @hash{@key} = (1) x @key; my @update = grep { !$hash{$_} } @items; }, Hash3 =\u0026gt; sub { my %hash; undef @hash{@key}; my @update = grep { not exists $hash{$_} } @items; }, } ) ); 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @items = qw( b t m e d k w r c s j z n v h g l q o y a u f x i p ); @key = qw( b c d a f e ); Benchmark: running Hash, Hash2a, Hash2b, Hash3, Linear for at least 3 CPU seconds... Hash: 3 wallclock secs ( 3.22 usr + 0.00 sys = 3.22 CPU) @ 30791.86/s (n=99119) Hash2a: 3 wallclock secs ( 3.13 usr + 0.00 sys = 3.13 CPU) @ 38859.88/s (n=121476) Hash2b: 3 wallclock secs ( 3.16 usr + 0.00 sys = 3.16 CPU) @ 38478.30/s (n=121476) Hash3: 3 wallclock secs ( 3.19 usr + 0.00 sys = 3.19 CPU) @ 40126.10/s (n=127922) Linear: 3 wallclock secs ( 3.17 usr + 0.00 sys = 3.17 CPU) @ 14515.13/s (n=46042) Rate Linear Hash Hash2b Hash2a Hash3 Linear 14515/s -- -53% -62% -63% -64% Hash 30792/s 112% -- -20% -21% -23% Hash2b 38478/s 165% 25% -- -1% -4% Hash2a 38860/s 168% 26% 1% -- -3% Hash3 40126/s 176% 30% 4% 3% -- 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @items = qw( y f n m b k l x w e p t a z o r q h u g j i s c d v ); @key = qw( bs uy we bq kg cn vq ap ue zr ot hh u ss cq s mv bf qi at ly yv sq hf jw ph yd rb yw wm he br lz lg kd uf ik lh hj rw gs ox xj qo tf ky kf lt pe zg lw ac er el ao sg jd v gl mz my sj sl xa ws lk iu cr xz gy bm ui k cj h yt ez gz rh oh ep gx de md aw gv tn vm hu mm ti m pk ry vi cb rg mt zv uq ew qw no cm wz nk gd nl ut ng vr vf rd au w rt vo pc fu ix xk xw mq px wu ef bk kb jp z li tg ka bp fw sn nr mj af vx vc ff zk zu o ni vy rv dr kr bj zi cw tb fb su fx fd tm zy ob vn iw uc pi xs bu fe qf wv zc uk hz do qg mb wx kp op dk zm aj kc oe ip cx ey jy pr wo bc sx um fl if fz jq yu in tv lb mw rf mx ha nx zd ea vl xb wt gp kh rx gr te py fj uv zx fg eb yb im ge qr ed bx ad aa hx wd lq ii du sp mi yl ud ru ie nj wf qk jt sa ee gi ij fm yz wb je lv pq wa is nt ej st qs tk pn it xh uu y ro gu gt sc pa sh bh vs et cs dh ne rj ku ze wl mp rn pd ai oq tj xu ga yy us un gc ck hs xr bg r ch vu oy to fa tu va oa td eu hg ki rp tc fy gk nn q qm eq dw yc za nm jr zf dq ct uj nz ft pz ba ym nq ub ib mu cd aq so bw eg i tz fo wk qu rq wh kw bb hr xy qd lu ln vg lf dn iq p dj zn zq pv bl tt or pg sd qp az mo uz kx xt an es fc ug xf jb kz pj nv ca ya mr ml pp fk hp al rl sf xm ae ig wj sr ei hq wg io nd kv ce as qe tl tp vp n sk tq x cc rs ev hb sw nb dm mk ko lj jk xx da ds qa wn vt js zh ar sv ma kl ul pl en re be xi wq xp os wr yf hk jg lc lr cz di ci hv od ux yp em iy cp qt vd bi bv am qq gq ps om vk qz np ov ho oz kj oo tx xl gf gh bt up hc dz po ic oi ou yn ht hd se ir mc ld fh la ec lx ia pt rk ol yr dl rr id cu dd dv go xo rc ay nu wi og il kn ra rz cl iv by yx ek xv qx f nf gw bz fv kk cv yo ql ag ke jo jl me ye jj qh ty fq yk ks sy zs ak sb kq yq ns mn hw vb jx vw rm mh ms ur vh gg on jz hl oc pm co vz fp jf ow tr av hm df cf gn ja ta ax qc fi l ri dy ts gm le of ah t nw sz ua jm zz ls fn xn jc zj zo ju ll qv dg cg lp nh g dc wc eo xg ji fr jh pb ys dp ok xq zw wy yg uo wp pf mg uw xe zl tw vv ww bd th gb iz yi bo pw ab yh bn hy oj zp lo gj zb xc jn ih si qj j lm hn fs zt sm pu db xd jv cy nc na ve mf hi dt ex uh qy kt eh vj qb yj dx km ny qn ); Benchmark: running Hash, Hash2a, Hash2b, Hash3, Linear for at least 3 CPU seconds... Hash: 3 wallclock secs ( 3.17 usr + 0.00 sys = 3.17 CPU) @ 681.90/s (n=2163) Hash2a: 3 wallclock secs ( 3.26 usr + 0.00 sys = 3.26 CPU) @ 1994.49/s (n=6512) Hash2b: 3 wallclock secs ( 3.25 usr + 0.00 sys = 3.25 CPU) @ 1997.23/s (n=6491) Hash3: 3 wallclock secs ( 3.23 usr + 0.00 sys = 3.23 CPU) @ 2299.63/s (n=7437) Linear: 3 wallclock secs ( 3.17 usr + 0.00 sys = 3.17 CPU) @ 557.06/s (n=1767) Rate Linear Hash Hash2a Hash2b Hash3 Linear 557/s -- -18% -72% -72% -76% Hash 682/s 22% -- -66% -66% -70% Hash2a 1994/s 258% 192% -- -0% -13% Hash2b 1997/s 259% 193% 0% -- -13% Hash3 2300/s 313% 237% 15% 15% -- ","date":"2009-04-09T00:20:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/04/09/002019/","title":"配列Aから配列Bの要素を取り除いた配列Cを作る方法"},{"content":"前にインストールした時は適当に強制インストールしたので、今回はテストに失敗する様子をログにしてみた。 で、まずはModule::Collectに失敗した様子をとったのだが、すでにレポートされていた。 FAIL Module-Collect-0.05 MSWin32-x86-multi-thread 5.1 - nntp.perl.org 意気消沈。 結局強制的に入れたので、Module::Setupの方も強制的に入れた。\n","date":"2009-03-31T20:54:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/31/205402/","title":"性懲りもなくModule::Setupをインストールしてみた"},{"content":"面白そうなスクリプトを見つけたので試してみた。 はてなブックマークのお気に入り候補を見つけるPerlスクリプト/楽 …が、途中でエラーになった。\n1 2 Not Found Can not parse [http://b.hatena.ne.jp/entry/rss/http://d.hatena.ne.jp/amatubu/20090322#p1]. ソースを見たら、XML::Feedでエラーになったら死ぬ事になっていたが、まあ、飛ばすだけでいいだろうと言うことで、適当に改造して使った。 結果はこんな感じ。\n1 2 3 4 5 6 7 8 9 10 001 : 017 : otsune : http://b.hatena.ne.jp/otsune/ 002 : 017 : lapis25 : http://b.hatena.ne.jp/lapis25/ 003 : 015 : typewhite : http://b.hatena.ne.jp/typewhite/ 004 : 013 : charsbar : http://b.hatena.ne.jp/charsbar/ 005 : 012 : miyagawa : http://b.hatena.ne.jp/miyagawa/ 006 : 011 : naoya : http://b.hatena.ne.jp/naoya/ 007 : 011 : hide-K : http://b.hatena.ne.jp/hide-K/ 008 : 010 : jazzanova : http://b.hatena.ne.jp/jazzanova/ 009 : 009 : bayashi_net : http://b.hatena.ne.jp/bayashi_net/ 010 : 009 : tomisima : http://b.hatena.ne.jp/tomisima/ 少し新しい世界が見えた気がします。 パッチは以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 Index: early-hatena-bookmarkers.pl =================================================================== --- early-hatena-bookmarkers.pl (リビジョン 31631) +++ early-hatena-bookmarkers.pl (作業コピー) @@ -68,8 +68,11 @@ my @my_bookmarks; for my $rss_url (@my_rss) { - my $feed = XML::Feed-\u0026gt;parse( URI-\u0026gt;new($rss_url) ) - or die XML::Feed-\u0026gt;errstr. \u0026#34;\\nCan not parse [$rss_url].\\n\u0026#34;; + my $feed; + unless ($feed = XML::Feed-\u0026gt;parse( URI-\u0026gt;new($rss_url) ) ) { + warn XML::Feed-\u0026gt;errstr. \u0026#34;\\nCan not parse [$rss_url].\\n\u0026#34;; + next; + } for my $item ($feed-\u0026gt;entries) { push @my_bookmarks, \u0026#39;\u0026lt;http://b.hatena.ne.jp/entry/rss/\u0026gt;\u0026#39;. $item-\u0026gt;link; @@ -90,8 +93,11 @@ my %users; for my $url (@bookmarks) { - my $rss = XML::Feed-\u0026gt;parse( URI-\u0026gt;new($url) ) - or die XML::Feed-\u0026gt;errstr. \u0026#34;\\nCan not parse [$url].\\n\u0026#34;; + my $rss; + unless ( $rss = XML::Feed-\u0026gt;parse( URI-\u0026gt;new($url) ) ) { + warn XML::Feed-\u0026gt;errstr. \u0026#34;\\nCan not parse [$url].\\n\u0026#34;; + next; + } my $me = 0; for my $item ($rss-\u0026gt;entries) { ","date":"2009-03-28T08:43:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/28/084306/","title":"はてブのお気に入りを見つけるスクリプトを使ってみた"},{"content":"昔に作ったファイルを見ていて、よくわからないコードが出てきたので調べた。 それは、ハッシュのスライスだった。 未だに覚えられないのは、やはりあまり使わないからだろうなぁ。 で、なんとなく思いついたので、ハッシュを作成するベンチマークを取ってみた。 何も考えずに書くとループして作るだろうなぁ、という感じのループと、そのループを展開したもの、そしてスライス代入と直接代入の4種類。\n1 2 3 4 5 6 7 8 9 10 Benchmark: running Unroll, direct, for, slice for at least 3 CPU seconds... Unroll: 2 wallclock secs ( 3.16 usr + 0.00 sys = 3.16 CPU) @ 264160.01/s (n=833689) direct: 2 wallclock secs ( 3.15 usr + 0.00 sys = 3.15 CPU) @ 287373.38/s (n=906663) for: 3 wallclock secs ( 3.13 usr + 0.00 sys = 3.13 CPU) @ 174892.19/s (n=546713) slice: 3 wallclock secs ( 3.00 usr + 0.00 sys = 3.00 CPU) @ 282924.03/s (n=849055) Rate for Unroll slice direct for 174892/s -- -34% -38% -39% Unroll 264160/s 51% -- -7% -8% slice 282924/s 62% 7% -- -2% direct 287373/s 64% 9% 2% -- ハッシュを直接書くよりはさすがに遅かったが、それにしても2%しか差がないのは驚き。 これは使わない手はないね。 で、ソースは以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 use strict; use warnings; use Benchmark qw(:all); our @la = (1 .. 5); our @lb = (\u0026#39;one\u0026#39;, \u0026#39;two\u0026#39;, \u0026#39;three\u0026#39;, \u0026#39;four\u0026#39;, \u0026#39;five\u0026#39;); cmpthese( timethese( 0, # 0 is auto { direct =\u0026gt; sub { my %hash = ( 1 =\u0026gt; \u0026#39;one\u0026#39;, 2 =\u0026gt; \u0026#39;two\u0026#39;, 3 =\u0026gt; \u0026#39;three\u0026#39;, 4 =\u0026gt; \u0026#39;four\u0026#39;, 5 =\u0026gt; \u0026#39;five\u0026#39;, ); }, for =\u0026gt; sub { my %hash; for my $i (0 .. 4) { $hash{$la[$i]} = $lb[$i]; } }, Unroll =\u0026gt; sub { my %hash; $hash{$la[0]} = $lb[0]; $hash{$la[1]} = $lb[1]; $hash{$la[2]} = $lb[2]; $hash{$la[3]} = $lb[3]; $hash{$la[4]} = $lb[4]; }, slice =\u0026gt; sub { my %hash; @hash{@la} = @lb; }, } ) ); ","date":"2009-03-28T00:29:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/28/002919/","title":"二つの配列からハッシュを作成するベンチマーク"},{"content":"Windowsのコマンドプロンプトは使いにくいので、最近は使っているエディタからスクリプトを起動することが多いのだが、utf8で書いたコードは文字化けして読めない。 まあ、設定があるのかもしれないけど。 あと、同じく設定があるとは思うのだけど見つからないのが、新規ファイルの文字コードの指定。 新規ファイルを作るとANSIになってしまって、うっかり保存すると日本語が化けた状態で保存されてしまう。 で、今のところ、そのどちらもカバーするようなひな形を作って、そこからスクリプトを書いていくようにしている。 そのひな形は以下のとおり。\n1 2 3 4 5 6 7 # utf8 use strict; use warnings; use YAML qw (Dump); sub p (@) { print Dump(@_); } use utf8; binmode STDOUT =\u0026gt; \u0026#39;:encoding(cp932)\u0026#39;; とりあえず、1行目は全角文字で書いてある「utf8」によって、開いた時にファイルの文字コードを「BOMなしのutf8」として認識してくれる。 strictとwarningsは、ないと気持ち悪いので、とりあえず書いておく。 で、データの確認用としてYAMLを使っている。 以前はData::DumperをIndent=1して使っていた。 YAMLは、慣れるまでは配列とハッシュの階層の感覚がよくわからない事もあるが、記号が少なくて見やすいのでこっちにした。 なにより、文字がエスケープされないのが良い。 で、binmodeに引数を加えることで、標準出力へ出す文字列はすべてcp932（機種依存ありのShift_JIS？）に変換してから出力する。 こうすると、エディタの出力ペインにも文字化けせずに表示される。 使ってみた例がこれ。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # utf8 # http://wiki.bit-hive.com/tomizoo/pg/Perl%20%BD%CB%C6%FC%CC%BE%A4%CE%BC%E8%C6%C0 use strict; use warnings; use YAML qw (Dump); sub p (@) { print Dump(@_); } use utf8; binmode STDOUT =\u0026gt; \u0026#39;:encoding(cp932)\u0026#39;; use Calendar::Japanese::Holiday; # 祝日一覧の取得 my $holidays; p $holidays = getHolidays(2008, 5); p $holidays = getHolidays(2008, 5, 1); foreach my $month ( 1 .. 12 ) { $holidays = getHolidays(2009, $month, 1); p { month =\u0026gt; $month, holidays =\u0026gt; $holidays }; } # 祝日かどうかの判定 p my $name = isHoliday(2007, 5, 5); ","date":"2009-03-27T00:03:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/27/000358/","title":"最近使っているPerlスクリプトのひな形"},{"content":"先日のKansai.pmで発表されていた、ループアンローリングを試してみた。 発表のスライド:Cell Challenge 2009 参加記 Wikipedia:ループ展開 - Wikipedia ループアンローリング自体はWikipediaによればループ展開ということだが、目的としてはデータハザード（データ依存のために計算の並列処理が不可能になること）をなるべく回避するのが目的であった。 スライドの30枚目に展開の方法が書いてるので、それを実際に試してみた。 以下、ベンチマークの結果\n1 2 3 4 5 6 7 8 Benchmark: running Unrolling1, Unrolling2, normal for at least 3 CPU seconds... Unrolling1: 3 wallclock secs ( 3.00 usr + 0.00 sys = 3.00 CPU) @ 429810.06/s (n=1289860) Unrolling2: 4 wallclock secs ( 3.05 usr + 0.00 sys = 3.05 CPU) @ 444432.88/s (n=1354187) normal: 3 wallclock secs ( 3.01 usr + 0.00 sys = 3.01 CPU) @ 210117.41/s (n=633504) Rate normal Unrolling1 Unrolling2 normal 210117/s -- -51% -53% Unrolling1 429810/s 105% -- -3% Unrolling2 444433/s 112% 3% -- Unrolling1は普通に展開したもの。 Unrolling2が展開後に計算順序を入れ替えたもの。 normalは普通のforループ。 計算の順序を入れ替えると、ほんの少しだが速くなった。 多少なりともデータハザードがある、ということなのだろう。 ソースは以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 use strict; use warnings; use Benchmark qw(:all); our @la = (1 .. 5); our @lb = (4 .. 8); cmpthese( timethese( 0, # 0 is auto { normal =\u0026gt; sub { my (@lc, @ld); for my $i (0 .. 4) { $lc[$i] = $la[$i] + $lb[$i]; $ld[$i] = $lc[$i] * $lc[$i]; } }, Unrolling1 =\u0026gt; sub { my (@lc, @ld); $lc[0] = $la[0] + $lb[0]; $ld[0] = $lc[0] * $lc[0]; $lc[1] = $la[1] + $lb[1]; $ld[1] = $lc[1] * $lc[1]; $lc[2] = $la[2] + $lb[2]; $ld[2] = $lc[2] * $lc[2]; $lc[3] = $la[3] + $lb[3]; $ld[3] = $lc[3] * $lc[3]; $lc[4] = $la[4] + $lb[4]; $ld[4] = $lc[4] * $lc[4]; }, Unrolling2 =\u0026gt; sub { my (@lc, @ld); $lc[0] = $la[0] + $lb[0]; $lc[1] = $la[1] + $lb[1]; $lc[2] = $la[2] + $lb[2]; $lc[3] = $la[3] + $lb[3]; $lc[4] = $la[4] + $lb[4]; $ld[0] = $lc[0] * $lc[0]; $ld[1] = $lc[1] * $lc[1]; $ld[2] = $lc[2] * $lc[2]; $ld[3] = $lc[3] * $lc[3]; $ld[4] = $lc[4] * $lc[4]; }, } ) ); ","date":"2009-03-26T23:10:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/26/231021/","title":"ループアンローリングとデータハザードのデモをPerlでやってみた"},{"content":"Text::MicroTemplateのソースを見ててわかりましたが、CPANオリジナル版とCodeRepos版では仕様が違うようです。バージョン表記は同じですが。 前の記事でraw_stringの書き方が変わった、と書いていますが、それはCodeRepos版のText::MicroTemplateです。 CPAN版は、以前の書き方でも問題なく書けます。 勝手に作ったアーカイブはCodeRepos版なのでご注意ください。 個人的にはCodeRepos版の方がいいかな、とは思います。 コードを実行するだけの時は「?」、出力が必要な時は「?=」、という具合に、シンプルに覚えられます。\n","date":"2009-03-24T22:30:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/24/223056/","title":"Text::MicroTemplateの秘密"},{"content":"細かい内容については、Kansai.pmのページから誰かがアップしてくれているページが見れるので、個人的な感想とか気になったこととかをメモ。\nイベント/第11回ミーティング報告 - Kansai.pm 開始前 集合場所についたら、すでにそれらしき人たちがいた。 オフ会は久しぶりだったので、なんかそういう空気に懐かしさを覚えた。まあ、知らない人が見たら怪しい集団だっただろうなぁ。 あまりミーハーではないと思っていたが、はてなオフィスとか、生naoyaさんを見ると、なんだか妙に嬉しくなってにやけてきた。 発表 Cell Challenge 2009の規定問題（文字列の編集距離計算）について。 PS3にはとんでもないCPUが使われている、ということを初めて知った。 高速化にはアルゴリズムによって単純計算にする事がとても重要。 ビット並列化とループアンロールが鍵。何かで使えるかな？\nHTML::ExtractContentについて。 「本文らしさ」をヒューリスティックにスコアリング。 本文の解析が苦手なページもあるが、その辺は補いながら使うのが吉。\nコルーチン コルーチンというのは、中断や再開ができるサブルーチンのこと。 Perlでコルーチンを使うならCoroだが、色々と足りないのでFiber.pmを作った。 使いどころが思いつかなかったけど、ジェネレータのコードを見て、そういう使い方か、と思った。\nスペルミス修正プログラム キーワードは編集距離とNグラムインデックスとJaro-Winkler。 辞書にははてなキーワードを使える。\nPerlMol 馴染みのない分野なので？だらけ。 化学式の原子モデル（？）から3Dモデルで表現することもできそうな感じのソフトウェア？\n名札メーカー 名刺メーカーではない。 名札から文字がはみ出ないように縮小しているのが特徴的。サンプルは文字が小さすぎて線のように見えたのが面白かった。\nPOPFile 単純ベイズ法によるメールの自動振り分けソフトウェア。結構使っている人がいた。私は知らなかった。 4人チームのうち唯一の日本人メンバーだそうで日本語担当だとか。\nKansai.pm活動報告とStrawberryPerl 活動報告は写真が少なかった。今年はもっと活動したいね。 Windowsなら、やっぱりStrawberryPerlはオススメ。\nSocial SKK SKKは知らないのですが、カスタム辞書にPerlのスクリプトが指定できるのか？ 発表が終わったあとにshipitでCPANに登録。登録後、会場の拍手が暖かかった。\n発表後～懇親会 最初は様子を見ながら喋ってましたが、徐々に徐々に打ち解けてきたというか。 Perlの話なかりになるかと思ったけど、そんなことはなかった。 気がついたら3時間くらい過ぎていた。 Perlライセンスのモダンな掲示板スクリプトが欲しいなぁって言われた。作るかどうかは知らない。 帰り lapis25さんと方向が同じだったので、途中まで（と言っても1時間くらいなので結構）話し込んだ。 こっちが一方的に知ってるのがフェアじゃないなぁ、とか思いながら。 Perlの話がほとんどでした。というか、結構意図的だったんだけど。 MENTAやNanoAはドキュメントが足りないよね～とか。で、その辺をCodeReposのコミッターが支えるような構造になっていけばいいな、とか。 まあ、最先端を行ってる人は教育とかドキュメントの整備よりも、新しいモジュールやアプリを開発するほうがコミュニティのためだろう、とかそんな話。 Perlへの愛を感じた。 家に着いて 感想を書きかけたけど、酔いと眠気で全然書けなかった。 まあ、そんな感じでした。 ","date":"2009-03-24T00:30:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/24/003011/","title":"Kansai.pm第11回ミーティングに行ってきました"},{"content":"MENTAを追いかける絡みでNanoAにも手を出しましたが、もし、今からこれらのフレームワークに入門（あるいは再入門）するのであれば、とりあえず最新版（MENTAは0.14、NanoAは0.17）にしたほうが良いでしょう。 というのは、これらの最新版で使われているテンプレートエンジンはText::MicroTemplateですが、それ以前のものはMENTA::Templateが使われています。 それに伴って、若干ですが文法にも違いがあります。 なので、古いMENTAやNanoAで作ったプログラムは、最新版ではエラーによって動かない場合があります。\n文法の大きな違いは、HTMLエスケープについてです。 テンプレートファイルに埋め込んだPerlの出力は、デフォルトでHTMLエスケープされることになっています。これは、セキュリティと利便性が大きく関与しています。 参考：Kazuho@Cybozu Labs: Text::MicroTemplate - テンプレートエンジンのセキュリティと利便性\nエスケープしないようにするには、以前は次のようにしていました。（タグ形式の場合）\n1 \u0026lt;?=r $hoge ?\u0026gt; しかし、Text::MicroTemplateを使用している最新版のMENTAやNanoAでは以下のようにします。\n1 \u0026lt;?= raw_string($hoge) ?\u0026gt; ただ、これは正式にアナウンスされていない（？）ようですし、また、最新版のアーカイブもオフィシャルからは案内されていません。 もちろん、最新のソースを手に入れることはできます。 MENTAはGitHubから「Download」できますし、NanoAは以前の記事のとおりCodeReposからチェックアウトして手に入れます。 とはいえ、なかなか面倒だと思いますので、勝手にアーカイブを用意しました。\nまずはextlibです。 extlib-20090320.zip これは、最新のMENTAとNanoA共通で使えます。 これは、GitHubでtokuhiromさんが「cgi-extlib-perl」として管理しているようですが、CodeReposでもMENTA内にextlibが以前のまま存在しており、現在のところ二重管理のような状況になっています。 近いうちにどちらかにまとめてもらった方がありがたいですが…。 とりあえず、このファイルは、CodeRepos版にGitHub版を上書きして作っています。\n次にMENTAです。 menta-20090320.zip これは、GitHubにある最新版を取ってきて、それを解凍し再度zipしたものです。 extlibは入っていません。\n最後にNanoAです。 nanoa-20090320.zip これは、前回の記事で作った配布用の「nanoa.cgi」と最新版の「appフォルダ」、「.htaccess」、無いと怒られる「nanoa-conf.cgi」を入れました。\n","date":"2009-03-21T04:24:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/21/042458/","title":"MENTA::TemplateとText::MicroTemplate"},{"content":"前回は失敗したが、CodeReposにあるNanoAで再挑戦してみる。\nNanoAの配布元は0.16が最新だったが、CodeReposの最新版は、バージョンが0.17であった。\nCodeRepos版は開発版ということで、そのまま使えるはずだったのだが、Windows上で使うには少し工夫が必要だった（詳しい説明は「lib/NanoA/Config.pm」に書いてあるので、そちらを読もう）ので、将来のため（？）に手順をメモしておく。\nまず、CodeReposからsvnで外部参照ごとチェックアウトする。\n1 svn co http://svn.coderepos.org/share/lang/perl/NanoA/trunk NanoA 次に「nanoa.cgi」と同じフォルダに「nanoa-conf.cgi」という名前のファイルを作成する。その中身はとりあえず以下のとおりにしておく。\n1 data_dir = var ついでに、同じフォルダに新しく「var」というフォルダを作っておく。\nここまでやってから、nanoa.cgiにブラウザでアクセスすると、管理用パスワードの設定画面になる（はず）。\n開発版のまま使うのならこれでOK。\nNanoAには、配布版を作成する機能があるのだが、Windows上では簡単には動かない。\nが、とりあえず、nanoa.cgiを作ればあとは何とかなるので、それもついでにメモしておく。\nnanoa.cgiと同じフォルダの「Makefile.PL」を少し変更する。\n1 2 3 4 5 6 7 8 9 10 11 12 13 Index: Makefile.PL =================================================================== --- Makefile.PL (リビジョン 31380) +++ Makefile.PL (作業コピー) @@ -38,8 +38,8 @@ NANOA_CGI_FILES = MENTA/extlib/Class/Accessor/Lite.pm MENTA/extlib/CGI/ExceptionManager.pm lib/NanoA/Config.pm lib/NanoA/Dispatch.pm lib/NanoA/Plugin.pm lib/NanoA/TemplateLoader.pm lib/NanoA.pm nanoa.pl nanoadir: - $(NOECHO)$(RM_RF) $(NANOADIR); - $(NOECHO)$(MKPATH) $(NANOADIR); + $(NOECHO)$(RM_RF) $(NANOADIR) + $(NOECHO)$(MKPATH) $(NANOADIR) nanoacgi: $(NANOA_CGI_FILES) $(FULLPERLRUN) tools/concat.pl -s -n strict,warnings $(NANOA_CGI_FILES) \u0026gt; $(NANOADIR)/nanoa.cgi この状態で、いつものように「perl Makefile.PL」→「dmake」としたあと「dmake nanoa」とする。\n途中で「tar」がない、あるいは、tarコマンドに失敗した、とか言われるが、「dist-cgi」の中にバージョン名（今回は「0.17」）のフォルダがあり、さらにその中に配布版「nanoa.cgi」ができています。\nあとは、その新しくできた「nanoa.cgi」と同じフォルダに「appフォルダ」と、MENTAから「extlibフォルダ」をコピーしてやれば、ほぼ配布版ができあがり。\n必要なら「.htaccess」や「nanoa-conf.cgi」、「varフォルダ」もコピーすれば使える。\nちなみに、現在のCodeRepos版は、extlibをMENTAと共有して使えるので、devel.nqou.netではextlibをルートにおいてNanoAとMENTAで共有しています。\n","date":"2009-03-20T03:42:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/20/034244/","title":"CodeRepos版NanoAをWindowsで動かす方法"},{"content":"cpanから普通に入れようとしたが、失敗した。 で、色々と調べていたのだが、どうやらStrawberryPerlでは「ppm」も使えるらしいということで、ppmからGDをインストールしてみた。 参考: 覚書 strawberryperl - てきとーにやる\nコマンドプロンプトからppmとして、install GDでEnterすると、本当にインストールするか訊かれるので、yを入力してEnter。 \u0026hellip;結果、あっという間にインストール完了。\n今まで苦労したのは何だったんだ、と思わずむかついてしまうほどに簡単にインストールできた。 あまりにむかついたので、Net-SSLeayも入れてやった。\nせっかく手順を記録していたのに\u0026hellip;ppmでこんな簡単にインストールできるなんて\u0026hellip;。なんか泣けてきた。 ただ、バージョンが古い場合もあるので、注意は必要。\n","date":"2009-03-19T23:54:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/19/235450/","title":"StrawberryPerlにGDをインストールするならPPMを使え"},{"content":"NanoAを使ってみようと思って、最新版の0.16を入れてみたのだが、Windows上ではうんともすんとも反応しない。 install.cgiを試してみたが動かなかったので、tarballを取ってきて解凍。 nanoa.cgiにアクセスするも反応がない。 ANHTTPDを使ってるからかもしれないので、cgi版を取ってきて共用サーバー（ちなみにxrea）で実行してみたが、system/setupにアクセスした時点でエラーになった。 デバッグモードにしてどうにかエラーメッセージを見たら、pluginのsession.pmが犯人らしい（？）のだが…。\nエラーメッセージ。\n1 Modification of a read-only value attempted at app/plugin/session.pm line 38. 検索していたら、同じように困っていた人を発見した。 bulkitem Diary - NanoAをインストールしてみた。 うーむ。\n","date":"2009-03-18T04:09:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/18/040942/","title":"NanoAの最新版がインストールできなくて困った件"},{"content":"日テレアプリで石原さとみを検索しようとしたら文字化けして困ってしまった。 どうにかURIモジュールを使ってやろうと思って調べたら、実はブックマークしていた記事にたどり着いた。 参考:URIモジュールにutf8フラグつきの文字列を食わせたらquery_formのエンコードが化けたでござるの巻 - とあるモバイル系エンジニアの日々 この記事を踏まえた結論としては、query_formを使うときは、「no utf8」のスコープでやるのが良い、ということ。 この記事の中では、utf8フラグを落としてからURIモジュールを使う、ということをしているのだが、今回、日テレアプリで使うAPIは、Shift_JISのURIエスケープで渡してやる必要があるので、少しだけ変更する。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Webpage: http://appli.ntv.co.jp/appli/api/program/index.html use strict; use warnings; use utf8; use YAML;sub p (@) { print Dump(@_) } use LWP::UserAgent (); use URI (); use Encode (); my $ua = LWP::UserAgent-\u0026gt;new; my $cast = Encode::encode(\u0026#39;cp932\u0026#39;, q{石原さとみ});# %90%CE%8C%B4%82%B3%82%C6%82%DD my $key = \u0026#39;your api key\u0026#39;; my $uri = URI-\u0026gt;new(\u0026#39;http://appli.ntv.co.jp/ntv_WebAPI/program/\u0026#39;); { no utf8; $uri-\u0026gt;query_form( key =\u0026gt; $key, cast =\u0026gt; $cast, ); } p $uri; # __END__ my $res = $ua-\u0026gt;mirror($uri, \u0026#39;ntv-apikey.pl.xml\u0026#39;)-\u0026gt;message; p $res; まず文字列をencodeしてcp932のバイト列へ変換します。 で、これを「use utf8」のスコープ内でquery_formへの代入を実行すると、keyやらcastという裸のワードに文字列フラグが付くのか、「%90%CE%8C%B4%82%B3%82%C6%82%DD」となってほしいところが「%C2%90%C3%8E%C2%8C%C2%B4%C2%82%C2%B3%C2%82%C3%86%C2%82%C3%9D」という風になってしまう。 そこで、「no utf8」のスコープを作って、その中で代入を行うと、あら不思議。 ちゃんと望んだとおりの変換をしてくれました。 これで一件落着です。\n","date":"2009-03-17T00:19:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/17/001931/","title":"URIモジュールのquery_formを上手く使う方法"},{"content":"先日、結果的にクリーンインストールしてしまったPerlに、モジュール群を入れているのだが、Plaggerをインストールする際に必要な「Net-SSLeay」のインストール記事が我ながらわかりにくかったので、もう一度今後のために書いてみる。\nNet-SSLeayの前にOpenSSLをインストールします。 まずはOpenSSLのソースを手に入れる。（OpenSSL: Source, Tarballs） そのソースを解凍する。 コマンドプロンプトを起動して解凍したフォルダ（ここでは仮に「D:\\Downloads\\openssl-0.9.8j」としておく）へ移動し、そのディレクトリで以下のように実行する。\n1 D:\\Downloads\\openssl-0.9.8j\u0026gt; ms\\mingw32 すると、コンパイルが始まるのでしばらく待つ。 コンパイルが終了したら、今度は「out」というフォルダに移り、テストを実行する。\n1 2 D:\\Downloads\\openssl-0.9.8j\u0026gt;cd out D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;..\\ms\\test すると、テストが始まるのでしばらく待つ。 テストが終わって、エラーがなさそうなら各種フォルダを作る。\n1 2 3 4 5 D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;md c:\\openssl D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;md c:\\openssl\\bin D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;md c:\\openssl\\lib D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;md c:\\openssl\\include D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;md c:\\openssl\\include\\openssl フォルダができたら、ファイル群をコピーする。\n1 2 3 4 5 6 7 D:\\Downloads\\openssl-0.9.8j\\out\u0026gt;cd .. D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b outinc\\openssl\\* c:\\openssl\\include\\openssl D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b out\\libssl32.a c:\\openssl\\lib D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b out\\libeay32.a c:\\openssl\\lib D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b libssl32.dll c:\\openssl\\bin D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b libeay32.dll c:\\openssl\\bin D:\\Downloads\\openssl-0.9.8j\u0026gt;copy /b out\\openssl.exe c:\\openssl\\bin とりあえずopensslについての操作は以上です。ひとまずコマンドプロンプトは閉じます。 次に、Net-SSLeayです。 cpanからNet-SSLeayの最新版を取ってくる。 Florian Ragwitz / Net-SSLeay - search.cpan.org それを解凍して、コマンドプロンプトを起動し、そのフォルダ（今回は「D:\\Downloads\\Net-SSLeay-1.35」としておく）へ移動する。 そして、以下のように実行する。\n1 D:\\Downloads\\Net-SSLeay-1.35\u0026gt;perl Makefile.PL perl.exeにパスが通っていない場合は、perl.exeへのフルパスで実行してやる必要があります。 ともかく、perl.exeでMakefile.PLを実行してやるということです。 手元の環境では以下のようなメッセージが出ました。\n1 2 3 4 5 6 7 Cannot determine perl version info from lib/Net/SSLeay.pm Cannot determine license info from lib/Net/SSLeay.pm *** Found OpenSSL-0.9.8j installed in C:\\OpenSSL *** Be sure to use the same compiler and options to compile your OpenSSL, perl, and Net::SSLeay. Mixing and matching compilers is not supported. Do you want to run external tests? These tests *will* *fail* if you do not have network connectivity. [n] 「C:\\OpenSSLになにかインストールされてますよ。同じコンパイラやオプションでNet-SSLeayをコンパイルしてください。」的な意味です。 あと、接続テストをするかどうかを訊かれていますが、ここではテストを飛ばします。 その後、いくつかライブラリが見つからない、というメッセージが出ますが、Makefileが作成されますので、makeします。\n1 D:\\Downloads\\Net-SSLeay-1.35\u0026gt;dmake 実行が終わるまでしばらく待ちます。 終わったら、opensslでコンパイルしたDLLを作業フォルダにコピーします。\n1 D:\\Downloads\\Net-SSLeay-1.35\u0026gt;copy /b c:\\openssl\\bin\\*.dll blib\\arch\\auto\\Net\\SSLeay おそらく2個のファイルがコピーされると思います。 あとは、インストールです。\n1 D:\\Downloads\\Net-SSLeay-1.35\u0026gt;dmake install 念のためperldocでインストールできているか確認します。\n1 D:\\Downloads\\Net-SSLeay-1.35\u0026gt;perldoc Net::SSLeay エラーが出なければインストール完了です。 お疲れさまでした。\n","date":"2009-03-15T04:12:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/15/041224/","title":"StrawberryPerlにNet-SSLeayをインストールする"},{"content":"StrawberryPerlのサイトに行ったらバージョンアップしていたことに気がついて（遅いけど）、上書きインストールをするつもりでそのままインストールした。 その時、やたらと時間がかかるなぁと思っていたら、インストールしていたモジュール群がきれいさっぱりなくなっていた。 つまり、自動的にアンインストールしたあと、インストールされていたのだ。 苦労して入れたモジュールもあったのに、失敗したなぁ。 次からはzipでインストールするようにしよう。\n","date":"2009-03-08T22:05:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/08/220551/","title":"StrawberryPerlを上書きのつもりでクリーンインストールしてしまった"},{"content":"メーリングリストで活発に準備の様子が伝わってきていて、いきたい気持ちがクライマックスに達した時に、告知がありました。 イベント/第11回ミーティング告知 - Kansai.pm こういうミーティングに行くのは初めてで、今から楽しみです。 周囲にPerl(というか、プログラム自体)に詳しい人がいないので、良い刺激になるんじゃないかと、とても期待しています。\n","date":"2009-03-06T01:02:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/06/010229/","title":"Kansai.pm第11回ミーティングに行ってきます(予定)"},{"content":"自分のブログをブックマークしてくれた人のはてなダイアリーのリストを返すスクリプトがあった。 Web::Scraperではてブスクレイピング しかし、リニューアル後のはてなには対応していなかったので、勝手に改造して使うことにした。 …まあ、ダイアリーやってない人も多いんだけどね。 ソースコード。\n1 2 3 4 5 6 7 8 9 10 11 12 use strict; use warnings; use URI; use Web::Scraper; use List::MoreUtils qw/uniq/; my $uri = URI-\u0026gt;new(\u0026#39;http://b.hatena.ne.jp/bookmarklist?url=http://weblog.nqou.net\u0026#39;); my $scraper = scraper { process \u0026#39;//ul[@class=\u0026#34;comment\u0026#34;]/li/a[1]\u0026#39;, \u0026#39;users[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; result \u0026#39;users\u0026#39;; }; my $res = $scraper-\u0026gt;scrape($uri); print join \u0026#34;\\n\u0026#34;, map { s/b.hatena/d.hatena/;$_} uniq(@{$res}); ","date":"2009-03-05T23:05:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/05/230522/","title":"勝手に改造-Web::Scraperではてブスクレイピング"},{"content":"最近からかもしれないけど、Last.fmでmp3の無料ダウンロードをやっているようだ。 参考：Last.fm からのおすすめ無料mp3 - Last.fm ちょうどWWW::Mechanizeを試していたので、それとWeb::Scraperを組み合わせてダウンロードするスクリプトを作った。 アカウントを持っているのが前提です。 アカウント情報は以下のように、YAMLで記述しておきます。 ソースコードをこのまま使う場合は、スクリプトのあるディレクトリに「lastfm.freemp3.yaml」という名前で保存しておきます。\n1 2 3 4 --- config: id: xxxxxxxx pw: ******** 最後は改行で終了しておく必要があります。たぶん。 ソースコードをこのまま使う場合は、スクリプトのあるディレクトリに「lastfm」というディレクトリが必要です。 実行すると、そのディレクトリにダウンロードしていきます。 また、保存する時に「mirror」を使うと、通常はファイルの比較をして再ダウンロードを防いでくれるのですが、Last.fmのサーバーの仕様なのかわかりませんが、その機能が効いていません。 その辺はもう少しどうにかしたいですね。 結構ダウンロードに時間がかかるので…。 ソースコード。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 use strict; use warnings; use utf8; use Perl6::Say; use Encode; use Config::YAML; my $config = Config::YAML-\u0026gt;new( config =\u0026gt; \u0026#39;./lastfm.freemp3.yaml\u0026#39; ); use Web::Scraper; use WWW::Mechanize; use File::Basename; use List::MoreUtils qw(uniq); my $uri = q{https://www.last.fm/login}; my $mech = WWW::Mechanize-\u0026gt;new( autocheck =\u0026gt; 1, agent =\u0026gt; q{Mozilla/5.0 (Windows; U; Windows NT 5.1; ja; rv:1.9.0.6) Gecko/2009011913 Firefox/3.0.6 (.NET CLR 3.5.30729)}, ); # スタート $mech-\u0026gt;get($uri); # ログイン sleep 1; $mech-\u0026gt;form_number(2); $mech-\u0026gt;set_fields( username =\u0026gt; $config-\u0026gt;{id}, password =\u0026gt; $config-\u0026gt;{pw}, ); $mech-\u0026gt;submit; # フリーMP3のページ sleep 1; $uri = q{http://www.last.fm/home/freemp3s}; $mech-\u0026gt;get($uri); # MP3リンクを取得 sleep 1; my ( $scraper, $result ); $scraper = scraper { process \u0026#39;a[href=~/\\.mp3$/]\u0026#39;, \u0026#39;hrefs[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; result \u0026#39;hrefs\u0026#39;; }; $result = $scraper-\u0026gt;scrape( $mech-\u0026gt;content, $mech-\u0026gt;uri ); foreach my $mp3 ( uniq @{$result} ) { my $filename = basename($mp3); print \u0026#34;try fetch : $mp3 : \u0026#34;; say $mech-\u0026gt;mirror( $mp3, sprintf( \u0026#34;%s/%s\u0026#34;, \u0026#39;lastfm\u0026#39;, $filename ) )-\u0026gt;message; sleep 1; } ","date":"2009-03-02T03:48:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/02/034817/","title":"WWW::MechanizeとWeb::ScraperでLast.fmからfreemp3をダウンロードする"},{"content":"わかってしまえば単純なことでした。\n1 process \u0026#39;a[href=~/\\.jpe?g$/]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; XPathでも同じようにできます。\n1 process \u0026#39;//a[@href =~ /\\.jpe?g$/]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; Web::Scraperにはフィルタの概念があって、取得してからごにょごにょできるので、そっちのほうばかり調べていました。 例えば以下のようなHTMLの場合、そのまま取得すると、前後に改行が入ってしまいます。\n1 2 3 \u0026lt;title\u0026gt; タイトルなのだ \u0026lt;/title\u0026gt; で、それを取得する時に、前後の改行を削除してやることができます。\n1 process \u0026#39;title\u0026#39;, \u0026#39;title\u0026#39; =\u0026gt; [\u0026#39;TEXT\u0026#39;, sub { s/^\\s+//o; s/\\s+$//o; } ]; こういう機能をフィルタと呼んでいます。 その機能を先に知ったので、取得したあとに拡張子を調べてマッチした場合だけ追加する、という方法を探していたのですが、考えてみれば、取得してからきれいにするよりも、最初からきれいに取るほうがいいですね。 以上を踏まえて書き直したのが以下のコード。 ついでだったので、Acme::PerlTidyを使って、自動的にコードの整形をしてもらいました。 実行時には不要なので、削除して使ってもまったく問題ありません。 CPAN：☼ 林永忠 ☼ / Acme-PerlTidy - search.cpan.org\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use Acme::PerlTidy; use strict; use warnings; use Web::Scraper; use URI (); use LWP::Simple qw(mirror); use File::Basename qw(basename); my $uri = URI-\u0026gt;new(\u0026#34;http://weblog.nqou.net\u0026#34;); my $scraper = scraper { process \u0026#39;a[href=~/\\.jpe?g$/]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; result \u0026#39;urls\u0026#39;; }; my $result = $scraper-\u0026gt;scrape($uri); foreach my $link (@{$result}) { my $filename = basename($link); mirror($link, \u0026#39;./images/\u0026#39; . $filename); sleep 1; } ","date":"2009-03-01T14:07:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/03/01/140728/","title":"Web::Scraperで正規表現を使って必要なリンクだけを取得する方法"},{"content":"かなーり今更感がありますが。 モジュール自体は、大分前にウェブにあったスクリプトをコピペして使ったときにインストール済みでしたが、なんとなく難しそうで敬遠していたところもありました。 が、やってみると簡単かつパワフルなモジュールであることがわかりました。 参考：use Web::Scraper; - 今日のCPANモジュール XPathがなかなかわからないのですが、CSSセレクタでもいけるのが超絶簡単です。 例えば、aタグのhref属性を取得する場合のprocessは以下のとおり。\n1 process \u0026#39;a\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; で、この場合だと、href属性がないaタグも対象になってしまうので、未定義（undef）が入る場合があります。 なので、href属性があるものだけを対象としたのが以下のprocessです。\n1 process \u0026#39;a[href]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; 同じものをXPathで書くと以下のとおり。\n1 process \u0026#39;//a[@href]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; で、リンクをたどる場合は画像を取得するのが基本（？）なので、そういうスクリプトを書いてみました。 …何番煎じかわかりませんが。 ソースコード。 このスクリプトを使う場合は、画像の保存用に、スクリプトと同じディレクトリに「images」というディレクトリをあらかじめ用意する必要があります。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use strict; use warnings; use Web::Scraper; use URI (); use LWP::Simple qw(mirror); use File::Basename qw(basename); my $uri = URI-\u0026gt;new(\u0026#34;http://weblog.nqou.net\u0026#34;); my $scraper = scraper { process \u0026#39;a[href]\u0026#39;, \u0026#39;urls[]\u0026#39; =\u0026gt; \u0026#39;@href\u0026#39;; result \u0026#39;urls\u0026#39;; }; my $result = $scraper-\u0026gt;scrape($uri); foreach my $link (@{$result}) { if ($link =~ /\\.jpe?g$/) { my $filename = basename($link); mirror($link, \u0026#39;./images/\u0026#39; . $filename); sleep 1; } } 理想を言えば、scraperで取得する時に、正規表現で必要なリンクだけ取得できればいいんですが。 やり方はありそうなんですよね…。\n","date":"2009-02-28T02:45:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/28/024557/","title":"Web::Scraperに入門した"},{"content":"RSSもいいけど、今後のことを思えばAtomも欠かせません。 ざっくりとCPANを漁っていくつか見繕ってベンチマークしました。 ついでにXPathでAtomを解析してみました。 いまいち納得はいきませんが、とりあえず同じ出力を得ることができたので良しとします。\n1 2 3 4 5 6 7 8 9 10 11 12 Benchmark: running Data::Feed, XML::Atom, XML::Feed, XML::FeedPP, XML::LibXML for at least 3 CPU seconds... Data::Feed: 3 wallclock secs ( 3.14 usr + 0.00 sys = 3.14 CPU) @ 413.88/s (n=1300) XML::Atom: 3 wallclock secs ( 3.20 usr + 0.00 sys = 3.20 CPU) @ 525.76/s (n=1684) XML::Feed: 3 wallclock secs ( 3.28 usr + 0.02 sys = 3.30 CPU) @ 415.23/s (n=1369) XML::FeedPP: 3 wallclock secs ( 3.19 usr + 0.00 sys = 3.19 CPU) @ 120.49/s (n=384) XML::LibXML: 3 wallclock secs ( 3.16 usr + 0.05 sys = 3.20 CPU) @ 1105.81/s (n=3543) Rate XML::FeedPP Data::Feed XML::Feed XML::Atom XML::LibXML XML::FeedPP 120/s -- -71% -71% -77% -89% Data::Feed 414/s 243% -- -0% -21% -63% XML::Feed 415/s 245% 0% -- -21% -62% XML::Atom 526/s 336% 27% 27% -- -52% XML::LibXML 1106/s 818% 167% 166% 110% -- Atomは「Perl - Google ブログ検索」な感じの10件です。 結果から見ると、やはりXML::LibXMLの一人勝ち。XPathさえきっちり書くことができるなら、これを使うのが良いでしょうね。 XML::Atom（実際はXML::Atom::Feedですが）は、PPを除いた他の二つよりは少し速いです。これはAtomに特化しているからかもしれませんが。 XML::FeedとData::Feedはほぼ同じ程度でした。 また、XML::FeedPPは残念な結果でした。しかし、Atomだから遅いというわけではなく、LibXMLとの比較だと同じ程度なので、単に比べたモジュールが高速なものが多かった、ということでしょう。 ソースは以下のとおり。 ソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 use strict; use warnings; use Data::Dumper; use Benchmark qw(:all); use FileHandle; use XML::LibXML; use XML::Atom::Feed; use Data::Feed; use XML::Feed; use XML::FeedPP; my $feed_file = q{../atom.xml}; my $fh = FileHandle-\u0026gt;new($feed_file) or die \u0026#34;cannot open $feed_file: $!\u0026#34;; local $/; # slurp mode our $content = $fh-\u0026gt;getline; $fh-\u0026gt;close; cmpthese(timethese(0, { \u0026#39;XML::Atom\u0026#39; =\u0026gt; \\\u0026amp;with_xml_atom, \u0026#39;Data::Feed\u0026#39; =\u0026gt; \\\u0026amp;with_data_feed, \u0026#39;XML::Feed\u0026#39; =\u0026gt; \\\u0026amp;with_xml_feed, \u0026#39;XML::FeedPP\u0026#39; =\u0026gt; \\\u0026amp;with_xml_feedpp, \u0026#39;XML::LibXML\u0026#39; =\u0026gt; \\\u0026amp;with_xml_libxml, })); sub with_xml_libxml { my @links =(); my $parser = XML::LibXML-\u0026gt;new; my $doc = $parser-\u0026gt;parse_string($content); my @nodes = $doc-\u0026gt;findnodes( qq{//*[name()=\u0026#39;entry\u0026#39;]/*[name()=\u0026#39;link\u0026#39;]} ); for my $node (@nodes) { push @links, $node-\u0026gt;getAttribute(\u0026#39;href\u0026#39;); } # print Dumper \\@links; } sub with_xml_feedpp { my @links = (); my $feed = XML::FeedPP-\u0026gt;new($content); foreach my $item ( $feed-\u0026gt;get_item() ) { push @links, $item-\u0026gt;link; } # print Dumper \\@links; } sub with_xml_feed { my @links = (); my $atom = XML::Feed-\u0026gt;parse(\\$content); for my $entry ($atom-\u0026gt;entries) { push @links, $entry-\u0026gt;link; } # print Dumper \\@links; } sub with_data_feed { my @links = (); my $atom = Data::Feed-\u0026gt;parse(\\$content); for my $entry ($atom-\u0026gt;entries) { push @links, $entry-\u0026gt;link; } # print Dumper \\@links; } sub with_xml_atom { my @links = (); my $atom = XML::Atom::Feed-\u0026gt;new(\\$content); for my $entry ($atom-\u0026gt;entries) { for my $link ($entry-\u0026gt;link) { push @links, $link-\u0026gt;href; } } # print Dumper \\@links; } ","date":"2009-02-28T01:46:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/28/014616/","title":"Atomのパース速度の比較"},{"content":"ソースだけでなくタイトルもパクリですが。 実行結果は環境によって変わるんでしょうか。 それとも、何らかの速度改善が行われたのかもしれません。 参考：XML::Simple におけるパーサーの実行速度比較 - naoyaのはてなダイアリー\n1 2 3 4 5 6 7 8 9 10 11 12 Benchmark: running XML::LibXML::SAX, XML::Parser, XML::SAX::Expat, XML::SAX::ExpatXS, XML::SAX::PP for at least 3 CPU seconds... XML::LibXML::SAX: 3 wallclock secs ( 3.03 usr + 0.00 sys = 3.03 CPU) @ 20.79/s (n=63) XML::Parser: 3 wallclock secs ( 3.11 usr + 0.01 sys = 3.12 CPU) @ 57.30/s (n=179) XML::SAX::Expat: 3 wallclock secs ( 3.27 usr + 0.00 sys = 3.27 CPU) @ 18.38/s (n=60) XML::SAX::ExpatXS: 3 wallclock secs ( 3.30 usr + 0.00 sys = 3.30 CPU) @ 67.33/s (n=222) XML::SAX::PP: 3 wallclock secs ( 3.25 usr + 0.00 sys = 3.25 CPU) @ 4.00/s (n=13) Rate XML::SAX::PP XML::SAX::Expat XML::LibXML::SAX XML::Parser XML::SAX::ExpatXS XML::SAX::PP 4.00/s -- -78% -81% -93% -94% XML::SAX::Expat 18.4/s 360% -- -12% -68% -73% XML::LibXML::SAX 20.8/s 420% 13% -- -64% -69% XML::Parser 57.3/s 1333% 212% 176% -- -15% XML::SAX::ExpatXS 67.3/s 1584% 266% 224% 18% -- 使ったRSSファイルは前回と同じです。 なんともコメントしにくいです。 参考にした記事は、3年前半ほど前のものなので色々と変わっているとも言えるし、Windowsという環境のせいとも言えるし。 まあ、それにしても、XML::Parserが無難に速いことは間違いなさそうですね。 ソースコードは以下のとおり。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 use strict; use warnings; use Benchmark qw(:all); use Perl6::Say; use FileHandle; use XML::Simple; use Data::Dumper; my $rss_file = \u0026#34;../satomi.xml\u0026#34;; my $fh = FileHandle-\u0026gt;new($rss_file) or die \u0026#34;cannot open $rss_file: $!\u0026#34;; local $/; # slurp mode our $content = $fh-\u0026gt;getline; $fh-\u0026gt;close; sub parse { my $xml = XML::Simple-\u0026gt;new-\u0026gt;XMLin($content); # say Dumper $xml; } cmpthese(timethese(0, { \u0026#39;XML::Parser\u0026#39; =\u0026gt; \\\u0026amp;with_xml_parser, \u0026#39;XML::LibXML::SAX\u0026#39; =\u0026gt; \\\u0026amp;with_xml_libxml_sax, \u0026#39;XML::SAX::ExpatXS\u0026#39; =\u0026gt; \\\u0026amp;with_xml_sax_expatxs, \u0026#39;XML::SAX::Expat\u0026#39; =\u0026gt; \\\u0026amp;with_xml_sax_expat, \u0026#39;XML::SAX::PP\u0026#39; =\u0026gt; \\\u0026amp;with_xml_sax_pp, })); sub with_xml_parser { $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::Parser\u0026#39;; parse(); } sub with_xml_sax_pp { $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::SAX::PurePerl\u0026#39;; parse(); } sub with_xml_libxml_sax { $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::LibXML::SAX\u0026#39;; parse(); } sub with_xml_sax_expatxs { $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::SAX::ExpatXS\u0026#39;; parse(); } sub with_xml_sax_expat { $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::SAX::Expat\u0026#39;; parse(); } ","date":"2009-02-23T23:10:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/23/231043/","title":"XML::Simple におけるパーサーの実行速度比較"},{"content":"色々と触発されてやってみた。 参考： Perl で XML の処理はどれが速いかベンチ : NDO::Weblog iandeth. - XML::Simple は遅い説における意外な落とし穴 XML::Simple におけるパーサーの実行速度比較 - naoyaのはてなダイアリー\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 Benchmark: running XML::FeedPP, XML::LibXML, XML::RSS, XML::RSS::LibXML, XML::RSS::Parser, XML::RSSLite, XML::Simple, regexp for at least 3 CPU seconds... XML::FeedPP: 2 wallclock secs ( 3.02 usr + 0.00 sys = 3.02 CPU) @ 55.37/s (n=167) XML::LibXML: 3 wallclock secs ( 3.25 usr + 0.02 sys = 3.27 CPU) @ 496.02/s (n=1620) XML::RSS: 4 wallclock secs ( 3.27 usr + 0.00 sys = 3.27 CPU) @ 2.76/s (n=9) XML::RSS::LibXML: 4 wallclock secs ( 3.25 usr + 0.00 sys = 3.25 CPU) @ 49.54/s (n=161) XML::RSS::Parser: 3 wallclock secs ( 3.19 usr + 0.00 sys = 3.19 CPU) @ 3.76/s (n=12) XML::RSSLite: 3 wallclock secs ( 3.14 usr + 0.00 sys = 3.14 CPU) @ 112.10/s (n=352) XML::Simple: 3 wallclock secs ( 3.14 usr + 0.00 sys = 3.14 CPU) @ 61.13/s (n=192) regexp: 4 wallclock secs ( 3.28 usr + 0.00 sys = 3.28 CPU) @ 6340.14/s (n=20802) Rate XML::RSS XML::RSS::Parser XML::RSS::LibXML XML::FeedPP XML::Simple XML::RSSLite XML::LibXML regexp XML::RSS 2.76/s -- -27% -94% -95% -95% -98% -99% -100% XML::RSS::Parser 3.76/s 37% -- -92% -93% -94% -97% -99% -100% XML::RSS::LibXML 49.5/s 1697% 1216% -- -11% -19% -56% -90% -99% XML::FeedPP 55.4/s 1909% 1371% 12% -- -9% -51% -89% -99% XML::Simple 61.1/s 2118% 1524% 23% 10% -- -45% -88% -99% XML::RSSLite 112/s 3967% 2878% 126% 102% 83% -- -77% -98% XML::LibXML 496/s 17894% 13078% 901% 796% 711% 342% -- -92% regexp 6340/s 229906% 168336% 12698% 11350% 10272% 5556% 1178% -- 読み込んだRSSファイルは、「はてなブックマーク - タグ - 石原さとみ（タグ「石原さとみ」を含む新着エントリー）」な感じの20件です。 正規表現はパターンがちがちで応用は利きませんが、速さはピカイチ。 XML::LibXMLはXPathがよくわからないのでアレですが、使いこなせれば速さも申し分なしです。 XML::RSSLiteが結構頑張っている印象ですね。関数呼び出しなのが、この中では違和感ありますが。 XML::Simpleのパーサーは、無難にXML::Parserを指定することでそれなりに速いです。ただ、手元の環境だとXML::SAX::ExpatXSが最速だったのですが。 ま、環境によるんでしょうね…。 XML::FeedPPがかなり健闘していると思います。ファイル構成もシンプル（1枚だけ）だし、汎用性もあるし、レンタルサーバーにも最適でしょうね。 これからRSSなどを扱うならXML::FeedPPが便利でしょうね。 ソースコードは以下のとおり。 使う場合はRSSファイルを適宜用意してください。 ソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 use strict; use warnings; use Data::Dumper; use Benchmark qw(:all); use FileHandle; use XML::LibXML; use XML::RSS; use XML::Simple; $XML::Simple::PREFERRED_PARSER = \u0026#39;XML::Parser\u0026#39;; use XML::RSS::LibXML; use XML::RSS::Parser; use XML::FeedPP; use XML::RSSLite; my $rss_file = \u0026#34;../satomi.xml\u0026#34;; my $fh = FileHandle-\u0026gt;new($rss_file) or die \u0026#34;cannot open $rss_file: $!\u0026#34;; local $/; # slurp mode our $content = $fh-\u0026gt;getline; $fh-\u0026gt;close; cmpthese(timethese(0, { \u0026#39;regexp\u0026#39; =\u0026gt; \\\u0026amp;with_regexp, \u0026#39;XML::Simple\u0026#39; =\u0026gt; \\\u0026amp;with_xml_simple, \u0026#39;XML::RSS\u0026#39; =\u0026gt; \\\u0026amp;with_xml_rss, \u0026#39;XML::LibXML\u0026#39; =\u0026gt; \\\u0026amp;with_xml_libxml, \u0026#39;XML::RSS::LibXML\u0026#39; =\u0026gt; \\\u0026amp;with_xml_rss_libxml, \u0026#39;XML::RSS::Parser\u0026#39; =\u0026gt; \\\u0026amp;with_xml_rss_parser, \u0026#39;XML::FeedPP\u0026#39; =\u0026gt; \\\u0026amp;with_xml_feedpp, \u0026#39;XML::RSSLite\u0026#39; =\u0026gt; \\\u0026amp;with_xml_rsslite, })); sub with_xml_rsslite { my @links = (); my %result; parseRSS(\\%result, \\$content); for my $item (@{$result{item}}) { push @links, $item-\u0026gt;{link}; } # print Dumper \\@links; } sub with_xml_feedpp { my @links = (); my $feed = XML::FeedPP-\u0026gt;new($content); foreach my $item ( $feed-\u0026gt;get_item() ) { push @links, $item-\u0026gt;link; } # print Dumper \\@links; } sub with_xml_rss_parser { my @links = (); my $parser = XML::RSS::Parser-\u0026gt;new; my $feed = $parser-\u0026gt;parse_string($content); foreach my $item ( $feed-\u0026gt;query(\u0026#39;item\u0026#39;) ) { push @links, $item-\u0026gt;query(\u0026#39;link\u0026#39;)-\u0026gt;text_content; } # print Dumper \\@links; } sub with_regexp { my $pattern = \u0026#34;\u0026lt;item .*?\u0026gt;.*?\u0026lt;link\u0026gt;(.*?)\u0026lt;/link\u0026gt;.*?\u0026lt;/item\u0026gt;\u0026#34;; my @links = ($content =~ m/$pattern/smg); # print Dumper \\@links; } sub with_xml_simple { my @links = (); my $parser = XML::Simple-\u0026gt;new; my $data = $parser-\u0026gt;XMLin($content, ForceArray =\u0026gt; 1); for my $item (@{$data-\u0026gt;{item}}) { push @links, $item-\u0026gt;{link}[0]; } # print Dumper \\@links; } sub with_xml_rss { my @links = (); my $rss = XML::RSS-\u0026gt;new; $rss-\u0026gt;parse($content); for my $item (@{$rss-\u0026gt;{items}}) { push @links, $item-\u0026gt;{link}; } # print Dumper \\@links; } sub with_xml_libxml { my @links =(); my $parser = XML::LibXML-\u0026gt;new; my $doc = $parser-\u0026gt;parse_string($content); my @nodes = $doc-\u0026gt;findnodes( \u0026#34;//*[local-name()=\u0026#39;item\u0026#39;]/*[local-name()=\u0026#39;link\u0026#39;]/text()\u0026#34; ); for my $node (@nodes) { push @links, $node-\u0026gt;nodeValue; } # print Dumper \\@links; } sub with_xml_rss_libxml { my @links = (); my $rss = XML::RSS::LibXML-\u0026gt;new; $rss-\u0026gt;parse($content); for my $item (@{$rss-\u0026gt;{items}}) { push @links, $item-\u0026gt;{link}; } # print Dumper \\@links; } ","date":"2009-02-23T22:43:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/23/224328/","title":"RSSのパース速度の比較"},{"content":"名前付けに困っていたところに、CPAN 長いネームスペース大会 - にぽたん研究所やCPAN 階層の深いモジュール王選手権 - id:kazuhookuのメモ置き場をみて、CPANモジュールからアイデアをもらおうと思ってやってみた。 とりあえず1000回以上使われていたのは以下の名前。 （2009/02/20時点）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 3060 times: Net 2581 times: XML 2287 times: Plugin 1964 times: Bio 1743 times: Data 1696 times: HTML 1427 times: API 1346 times: WWW 1310 times: Test 1296 times: Class 1176 times: eBay 1140 times: Apache 1105 times: DateTime 1083 times: Text さすがに、Net,XML,HTML,WWWなど、ウェブ関係が多いようです。 あと、Textが多いのはPerlの面目躍如でしょうか。テキスト処理は十八番ですからね。 ちなみに、200回以上使われている名前は、138個。 100回以上200回未満は、171個。 10回以上100回未満は、2109個。 5回以上10回未満は、1686個。 2回以上5回未満は、5803個。 1回だけは、21289個でした。 ソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/usr/bin/perl use strict; use warnings; use CPAN::Config; use IO::Uncompress::Gunzip qw($GunzipError); use constant PRINT_TIMES =\u0026gt; 1000; my $package_file = sprintf \u0026#34;%s/modules/02packages.details.txt.gz\u0026#34;, $CPAN::Config-\u0026gt;{keep_source_where}; my %ranking = (); my $z = IO::Uncompress::Gunzip-\u0026gt;new($package_file) or die \u0026#34;$GunzipError\\n\u0026#34;; while (my $line = $z-\u0026gt;getline) { my($package) = split /\\s+/, $line, 2; my @names = split /::/, $package; foreach my $name (@names) { $ranking{$name}++; } } $z-\u0026gt;close; my $number = 1; for my $name (sort { $ranking{$b} \u0026lt;=\u0026gt; $ranking{$a} } keys %ranking) { last if $ranking{$name} \u0026lt; PRINT_TIMES(); printf \u0026#34;%5d times: %s\\n\u0026#34;, $ranking{$name}, $name; } 200回以上1000回未満の名前は以下のとおり。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 988 times: File 956 times: DBIx 943 times: Object 927 times: CGI 861 times: Template 850 times: POE 820 times: Mail 818 times: TimeZone 763 times: App 746 times: DataType 742 times: Catalyst 732 times: Locale 702 times: Config 700 times: Component 658 times: Meta 635 times: Simple 620 times: Perl 611 times: Filter 609 times: DBI 599 times: Server 593 times: DB 591 times: Search 582 times: HTTP 573 times: Base 561 times: Tools 545 times: Devel 544 times: Parse 530 times: Model 524 times: Parser 513 times: Games 507 times: Acme 500 times: Lingua 498 times: Math 489 times: Tk 489 times: Module 469 times: Engine 465 times: Amazon 462 times: Util 458 times: Win32 453 times: Client 452 times: Image 450 times: ICal 442 times: WebService 441 times: Session 439 times: UMMF 434 times: Call 432 times: Yahoo 428 times: Run 426 times: IO 409 times: Schema 381 times: Log 365 times: Jifty 357 times: SQL 355 times: Tie 353 times: Wx 348 times: View 333 times: Google 333 times: Command 330 times: Pod 324 times: Business 320 times: Response 315 times: PDF 315 times: Marketing 312 times: Cache 311 times: Graph 307 times: Request 306 times: Crypt 306 times: Apache2 305 times: Widget 305 times: Message 304 times: Driver 304 times: Backend 292 times: Paper 291 times: Specs 291 times: Utils 288 times: Element 284 times: Node 281 times: Protocol 281 times: Web 281 times: PiseApplication 278 times: Geo 278 times: MooseX 274 times: Tree 274 times: Graphics 273 times: DRI 273 times: SOAP 272 times: Audio 270 times: RDF 268 times: Email 268 times: America 268 times: Validate 267 times: Field 267 times: Date 264 times: Application 263 times: Kwiki 263 times: Query 260 times: Controller 260 times: Enum 258 times: Info 256 times: Language 255 times: Form 255 times: Exception 251 times: Algorithm 250 times: Encode 249 times: Critic 245 times: Action 243 times: Plagger 236 times: Agent 235 times: Bundle 232 times: Rose 223 times: Store 222 times: Finance 219 times: Type 218 times: Chart 218 times: Storage 217 times: String 217 times: Value 217 times: UI 215 times: Core 207 times: AFP 206 times: Handler 206 times: Error 204 times: Gtk2 200 times: Policy ","date":"2009-02-22T00:11:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/22/001127/","title":"CPAN よく使われるネーム王選手権"},{"content":"メールマガジンの「Perlで書く」を読んでいたら、なんとなく試してみたくなったので、実行してみた。 continue構文は使ったことない。 使いどころがわからないというか、意識したこともなかった。\n参考\nPerlで書く 2008.10.19 Vol.220 [まぐまぐ！] continue - perldoc.perl.org ついでに、普通だったらこう書くよね、という感じのforeachも入れてベンチマークをとってみた。\n結果\n1 2 3 4 Rate sub_while_continue sub_for sub_foreach_normal sub_while_continue 75245/s -- -1% -9% sub_for 76220/s 1% -- -8% sub_foreach_normal 83126/s 10% 9% -- 結果はforeachがやはり速い。 foreach以外はループするかどうかの判断をしている分、遅くなるのはしょうがないのだろう。 ベンチマークコードは以下のとおり。 ベンチマークコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #!/usr/bin/perl use strict; use warnings; use Benchmark qw(:all); use Perl6::Say; sub confirm ($) { # say shift; } cmpthese( 100000, { sub_foreach_normal =\u0026gt; sub { my $sum = 0; foreach my $i (1 .. 100) { $sum += $i; } confirm $sum; }, sub_while_continue =\u0026gt; sub { my $sum = 0; my $i = 1; while ($i \u0026lt; 101) { $sum += $i; } continue { $i++; } confirm $sum; }, sub_for =\u0026gt; sub { my $sum = 0; for (my $i = 1; $i \u0026lt; 101; $i++) { $sum += $i; } confirm $sum; }, } ); ","date":"2009-02-21T00:23:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/21/002319/","title":"continue構文とやらを使ってみた"},{"content":"相変わらず「モダンPerl入門」を読み進めている。 「2.3 Composite」まで進んだが、ここのサンプルソースが結構間違っていた。 カンマが抜けていたり、関数名が違っていたり。 そのあたりは簡単に予想できたのだけど、大変だったのは「Shape::Composite」に 「use MooseX::AttributeHelpers」がなかったために、わけのわからないエラーに悩まされたことだ。 気づいてみれば、この章の始めのほうにもMooseX::AttributeHelpersを多用するとは書いてあるのだが、以下のようなエラーからはとても思いつかなかった。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Could not load class (Moose::Meta::Attribute::Custom::Collection::Array) because : Can\u0026#39;t locate Moose/Meta/Attribute/Custom/Collection/Array.pm in @INC (@INC contains: lib C:/strawberry/perl/lib C:/strawberry/perl/site/lib .) at C:/strawberry/perl/site/lib/Class/MOP.pm line 153. Could not load class (Collection::Array) because : Can\u0026#39;t locate Collection/Array.pm in @INC (@INC contains: lib C:/strawberry/perl/lib C:/strawberry/perl/site/lib .) at C:/strawberry/perl/site/lib/Class/MOP.pm line 153. at C:/strawberry/perl/site/lib/Class/MOP.pm line 135 Class::MOP::load_first_existing_class(\u0026#39;Moose::Meta::Attribute::Custom::Collection::Array\u0026#39;, \u0026#39;Collection::Array\u0026#39;) called at C:/strawberry/perl/site/lib/Moose/Util.pm line 143 Moose::Util::resolve_metaclass_alias(\u0026#39;Attribute\u0026#39;, \u0026#39;Collection::Array\u0026#39;) called at C:/strawberry/perl/site/lib/Moose/Meta/Attribute.pm line 97 Moose::Meta::Attribute::interpolate_class(\u0026#39;Moose::Meta::Attribute\u0026#39;, \u0026#39;provides\u0026#39;, \u0026#39;HASH(0x1160f6c)\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;default\u0026#39;, \u0026#39;CODE(0x1041e44)\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose/Meta/Attribute.pm line 86 Moose::Meta::Attribute::interpolate_class_and_new(\u0026#39;Moose::Meta::Attribute\u0026#39;, \u0026#39;shapes\u0026#39;, \u0026#39;provides\u0026#39;, \u0026#39;HASH(0x1160f6c)\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;default\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose/Meta/Class.pm line 510 Moose::Meta::Class::_process_new_attribute(\u0026#39;Moose::Meta::Class=HASH(0x104fb9c)\u0026#39;, \u0026#39;shapes\u0026#39;, \u0026#39;provides\u0026#39;, \u0026#39;HASH(0x1160f6c)\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;default\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose/Meta/Class.pm line 503 Moose::Meta::Class::_process_attribute(\u0026#39;Moose::Meta::Class=HASH(0x104fb9c)\u0026#39;, \u0026#39;shapes\u0026#39;, \u0026#39;provides\u0026#39;, \u0026#39;HASH(0x1160f6c)\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;default\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose/Meta/Class.pm line 202 Moose::Meta::Class::add_attribute(\u0026#39;Moose::Meta::Class=HASH(0x104fb9c)\u0026#39;, \u0026#39;shapes\u0026#39;, \u0026#39;provides\u0026#39;, \u0026#39;HASH(0x1160f6c)\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;default\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose.pm line 89 Moose::has(\u0026#39;Shape::Composite\u0026#39;, \u0026#39;shapes\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;is\u0026#39;, \u0026#39;rw\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;auto_deref\u0026#39;, ...) called at C:/strawberry/perl/site/lib/Moose/Exporter.pm line 201 Moose::Exporter::__ANON__(\u0026#39;shapes\u0026#39;, \u0026#39;metaclass\u0026#39;, \u0026#39;Collection::Array\u0026#39;, \u0026#39;is\u0026#39;, \u0026#39;rw\u0026#39;, \u0026#39;isa\u0026#39;, \u0026#39;ArrayRef\u0026#39;, \u0026#39;auto_deref\u0026#39;, 1, ...) called at lib/Shape/Composite.pm line 15 require Shape/Composite.pm called at p051.pl line 8 main::BEGIN() called at lib/Shape/Composite.pm line 0 eval {...} called at lib/Shape/Composite.pm line 0 Compilation failed in require at p051.pl line 8. BEGIN failed--compilation aborted at p051.pl line 8. 最終的なShape::Compositeのソースは以下のとおり。\nlib/Shape/Composite.pm\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package Shape::Composite; use Moose; use MooseX::AttributeHelpers; with \u0026#39;Shape\u0026#39;; has \u0026#39;shapes\u0026#39; =\u0026gt; ( metaclass =\u0026gt; \u0026#39;Collection::Array\u0026#39;, is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;ArrayRef\u0026#39;, auto_deref =\u0026gt; 1, default =\u0026gt; sub { [] }, provides =\u0026gt; { push =\u0026gt; \u0026#39;shape_add\u0026#39;, }, ); no Moose; no MooseX::AttributeHelpers; sub resize { my ($self, $factor) = @_; foreach my $shape ( $self-\u0026gt;shapes ) { $shape-\u0026gt;resize( $factor ); } } sub print { my $self = shift; foreach my $shape ( $self-\u0026gt;shapes ) { $shape-\u0026gt;print; } } 1; ","date":"2009-02-15T02:16:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/15/021645/","title":"「use MooseX::AttributeHelpers」が抜けているとわけがわからないエラーになる件"},{"content":"どこで読んだか忘れましたが、Perlのコミュニティの中では中堅クラスが少ない、という話がありました。\n私としては、CPANによる自由拡張性が、そもそも裾野を広げる障害ではなかったか、と思います。\nこれは、MENTAを使っていく中で色々と読んでの感想ですが、軽量フレームワークが誕生した背景にも同じことがあったと思います。\nPerlでウェブアプリケーションを開発する時にCPANモジュールを多く使っていると、公開する時点でサーバーを選んでしまいます。\nつまり、Perlを学んでいけばいくほど公開する場所に制限がかかっていきます。CPANが自由に使えるサーバーは自前で用意する必要があるでしょう。\n例えばMooseを使ってスクリプトを作っても、公開できるレンタルサーバーとなると、サクラサーバーくらいしかないのではないでしょうか？\n私は使ったことがないのでわかりませんが、ユーザー領域にインストールする方法があるようですし。\n参考 otsune\u0026rsquo;s FreeBSD memo :: ユーザー領域にCPANをインストールする方法\nその問題を解決するには、Perlで作られたプログラムを公開するためのレンタルサーバーを用意する、というのが良いのではないでしょうか？\nBundle::JPAという構想もあるようですし、そのBundle::JPAがインストールされたサーバーを用意すればPerlの普及に寄与することができるのではないか、と思います。JPAというPerlの団体が発足しましたが、その動きに期待したいところですね。\n","date":"2009-02-14T22:04:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/14/220450/","title":"Perlの裾野が広がらない問題について"},{"content":"「モダンPerl入門」相変わらずゆっくりと読んでます。 別名というか、英語表記で「PRAGMATIC Perl」と書いてあります。 Pragmaticというのは「実際的な」とか「実用的な」「実利的な」といった意味のようです。 で、ようやく第一章を読み終わりました。 近代的なオブジェクト指向ということで、主にMooseの紹介でした。 その中で、Moose::Roleが出てきましたが、この考え方が面白いです。 面白いというか、すっと腑に落ちたという感じです。 基本的考え方として、役割を定義するクラスを作って、それを継承することで別のクラスに意味づけをする、という風に理解しています。 Moose::Roleでは継承の仕組みが拡張されていて、指定したメソッドを必ず備えるように縛ることができます。 MovableTypeでも、最近はカテゴリーとタグがありますが、従来の継承はカテゴリー、Moose::Roleで拡張される「役割」はタグ、というイメージでしょうか。 CPAN:Moose::Role - The Moose Role で、例としてキャッシュのアダプターが紹介されていましたが、CPANに同等の機能を持つMooseX::Role::WithCacheというモジュールがある、ということでしたが、名前が違っていました。 正しくはMooseX::WithCacheでした。 いきなりcpanコマンドでインストールしようとしたら、存在しないというエラーが返ってきてビックリしました。 CPAN:Daisuke Maki / MooseX-WithCache - search.cpan.org ただ、問題なのは、この辺を勉強してもレンタルサーバーでは使えない、ということなんですね…。\n","date":"2009-02-14T10:59:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/14/105950/","title":"Moose::Roleが興味深い"},{"content":"Mooseをuseすると自動的にstrictになる、というのが不思議だったのだが、その解説が見つかった。\nプラグマをimportするとuseしたクラスにもプラグマが効くようになる プラグマをimportするとuseしたクラスにもプラグマが効くようになる - 僕ト云フ事＠はてな出張版\n…ということです。 useすると、自動的にimport関数が実行されるわけですが、この機能を利用してstrictなどのプラグマもimportさせることができる、ということのようです。 ふと気づいてMENTAのソースも見ましたが、同じような仕組みになっていました。 なので、importをしないようにuseすると、当然プラグマもimportされません。\n1 2 3 use Moose (); $n = 999; print $n; ↑だとエラーが出ません。\n1 2 3 use Moose; $n = 999; print $n; で、こうした場合は、以下のようなエラーが出ます。\n1 2 3 4 Moose does not export its sugar to the \u0026#39;main\u0026#39; package. Global symbol \u0026#34;$n\u0026#34; requires explicit package name at D:\\WebApp\\copal\\copal.tmp line 2. Global symbol \u0026#34;$n\u0026#34; requires explicit package name at D:\\WebApp\\copal\\copal.tmp line 3. Execution of D:\\WebApp\\copal\\copal.tmp aborted due to compilation errors. Mooseからのメッセージは謎ですね。 sugarってどういう意味なんでしょう？ ちなみに、この手のちょっとしたコードは、Copal 2を使って書いています。 エディタ機能はそれほどでもありませんが、保存しなくても一時ファイルを使って実行してくれるので、手軽で便利です。\n","date":"2009-02-12T23:36:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/12/233629/","title":"自動的にstrictが有効になる理由"},{"content":"…というようなエントリーをちらほら見かけた。 で、今日、Amazonからうちにも届いた。\nモダンPerl入門 (CodeZine BOOKS)\nposted with amazlet at 09.02.12\n牧 大輔 翔泳社 売り上げランキング: 210\nAmazon.co.jp で詳細を見る\nMooseが面白そうなので、最初からソースを自分で入力してみることにした。 自分で書くほうがソースを何度も見る（読む）事にもなるし、実際に動くところを見るのもよさそうだったから。 「use Moose」で自動的にstrictになる、というのが不思議。 とはいえ、「use strict」を書かないのも気持ち悪く、微妙な気持ちだが、慣れればそんなものかも。 ちなみに既に正誤表が用意されているようです。 『モダンPerl入門』正誤表 そういえば、一つ動かないソースがありました。 p14\n1 2 3 4 5 sub write_response { my ($self, $client, $request) = @_; print $client scalar(localtime), \u0026#34; \u0026#34;; $self-\u0026gt;SUPER($client, $request); } これを実行すると、クライアントからリクエストを打つとエラーで止まりました。\n1 Can\u0026#39;t locate object method \u0026#34;SUPER\u0026#34; via package \u0026#34;TimestampedEchoServer\u0026#34; at TimestampedEchoServer.pm line 11, \u0026lt;GEN1\u0026gt; line 1. この間違いは単純なもので、正しくはSUPERの先に関数名が必要です。\n1 2 3 4 5 sub write_response { my ($self, $client, $request) = @_; print $client scalar(localtime), \u0026#34; \u0026#34;; $self-\u0026gt;SUPER::write_response($client, $request); } まあ、Mooseを使うのであれば、before等を使うほうが良いでしょうね。\n","date":"2009-02-12T00:46:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/12/004653/","title":"モダンPerl入門が届いた"},{"content":"Perlをツール的に使っていて、コードの中で複数の階層にあるファイルをディレクトリごと再帰的にコピーしたくなった。 以前、ファイルのコピーについて何か書いた気がして調べてみたのだが、大したことが書いていなかった…。\nファイルのコピーをする場合は、File::Copyというモジュールを使うのが良い。\n[ファイルのコピー＠のぶろぐ]\nということで、他の方法を調べてみたところ、「File::Copy::Recursive」を使うのがよさそうだ、というところに行き着いた。 標準モジュールではないのでcpanからインストールする必要があったが、特に問題はなくスムーズにインストールできた。 現在のディレクトリ以下のファイルを、絶対パスの「/temp」へコピーする場合は、以下のようにする。\n1 2 3 4 5 6 use strict; use warnings; use File::Copy::Recursive qw(rcopy); my $from_dir = \u0026#34;.\u0026#34;; my $to_dir = \u0026#34;/temp\u0026#34;; rcopy($from_dir, $to_dir); 参考： Daniel Muey / File-Copy-Recursive - search.cpan.org\nちなみに、「Path::Class」のオブジェクトも引数で渡すことができるようだ。 ナイス連係プレー。\n1 2 3 4 5 6 7 use warnings; use strict; use File::Copy::Recursive qw(rcopy); use Path::Class; my $from_dir = dir(\u0026#34;.\u0026#34;); my $to_dir = dir(\u0026#34;\u0026#34;, \u0026#34;temp\u0026#34;); rcopy($from_dir, $to_dir); ","date":"2009-02-11T01:11:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/11/011102/","title":"Perlでファイルをサブディレクトリごとコピーする"},{"content":"今までに加えて、下記の点でパワーアップした。\n最新の検索がいつ頃だったかも抽出できる。 検索回数が指定回数以下のものについては無視できる。 クラウドにしやすいように検索回数をランク付けできる。 以上によって2回以上検索された語句のような物が生成できます。 今のスタイルシートでは、古い検索ほど色を暗い感じに、検索回数が多いほどフォントサイズを大きめに、ということにしています。 一部のブラウザでは意図したようには見えていないかもしれません（特に明暗について）が、Firefoxでは確認済みです。\n","date":"2009-02-08T03:10:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/08/031034/","title":"Zeitgeistをパワーアップ"},{"content":"検索された語句リストを見ていると、「まほでんわーるど」「攻略」で来てる人が多いようだ。 クラスチェンジの条件や強そうなクラスなどは、「まほでんわーるど Wiki*」が詳しいのでそちらに譲るとして、私が思うコツを一つだけ書いてみます。 そのコツとは「死なないこと」です。 当たり前と思われるでしょうが、まあ聞いて下さい。 まほでんわーるどでは、冒険中にキャラクターが死ぬと、そのときの冒険でキャラクターが得た経験値が0になってしまいます。 死なずに帰ってくる事を繰り返せば、それだけで効率よくレベルアップさせることができるというわけです。 強くなってくれば、敵を早く倒せる→お金が早く手に入る→仲間を早く増やせる、という良い循環になっていきます。 冒険に出発してしまうと、退却しか命令できないので、いかにタイミングよく退却するかが重要です。 特にクレリック等の回復スキルを持つキャラクターが居ない序盤に関しては、監視を怠ることは死を意味します。 放っておく事ができるゲームですが、放っておくといつまで経っても強くなれないことを覚えておきましょう。 最低レベルクラスチェンジに関しては、さほど気にすることはありません。 まずは回復キャラクターを作ることを意識すれば良いくらいです。 ちなみに巫女はあまり強くならない、かつ、それ以上クラスチェンジできないのでお奨めしません。あくまで好みで。 続きはネタバレがメインです。\nネタバレです。 しかし、博物館を見てニヤニヤしたい方向けではありません。 「クリア済み」になってない方は、まずは「ドラゴンの巣跡」に全力を尽くしましょう。 ここをクリアすると本当の楽しみが始まります。 Wikiはクリア前に限定したことがあまり書かれていないのですが、上位のクラスの一部（侍、フェンリル、ゴールドナイト、オーディン、ディアナ、ハイエロファント、バハムート、ティアマット、ロード、アトラス）は実質的にクリア後にしかクラスチェンジできません。（と思います。一応、ライセンスの項にそれっぽくは書いてあります。） 私は侍を作りたくて仕方なかったのですが、結局、作れたのはかなり後でした。 それはともかく、ドラゴンの巣跡をクリアするのは結構大変です。 クリア前になれる上位のクラスを駆使して強くなっておくほうがいいでしょう。 アーチャー系はモンクやウィッチ、プリーストはずっと使えるクラスですのでお奨めです。 ファイター系は忍者マスターがいいでしょう。ただし、セカンドスキルの「忍術」がクリア後しか出てこないので重用はできないです。 で、クラスチェンジにこだわる必要がない、というのは、クリア後にはレベルが3桁を超えるわけですが、早いキャラクターだとレベル600くらいでパラメーターが全て999になってしまうので、それ以上の成長が見込めなくなります。 なので、レベル40で転職できても、レベル100で転職したキャラクターよりも強くなる、というわけではないのです。 その辺はこだわりのなせる業でしょう。\n","date":"2009-02-04T02:49:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/04/024901/","title":"まほでんわーるどの攻略法"},{"content":"Amazonで、「モダンPerl入門」を注文した。 Amazonから荷物が届くたびに、妻に「今度は何買ったの」と言われるのですが、妻はよく通販を利用しているのでどっちもどっちだと思っています。 思いついたときに予約・購入できるというのは強みだと思います。 まあ、買うのを忘れているほうが財布には優しいのですが。\nモダンPerl入門\nposted with amazlet at 09.02.03\n牧 大輔 翔泳社 売り上げランキング: 132\nAmazon.co.jp で詳細を見る\n","date":"2009-02-04T00:06:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/04/000625/","title":"「モダンPerl入門」を注文した"},{"content":"面白い記事を読んだので、早速試してみた。\nそこで使ってみたいのがBlackbirdだ。Google Code上で公開されているオープンソースのJavaScriptアラートだ。\n[MOONGIFT: » 必見！JavaScriptのalert処理にさよならを「Blackbird」:オープンソースを毎日紹介]\nJavaScriptでコーディングするときに、alertで中身を確認するのは基本中の基本。\njGrowlもalertの代替な感じでしたが、jGrowlはお知らせ的な使い方が似合っている。\nそれに対して、このBlackbirdはログの要素が強い。 ロギングユーティリティを名乗るだけはある。 色々と書こうかと思っていたが、すでに色々と書かれているのでサンプルを適当に作ってお茶を濁すことにした。\n色々と書かれている記事： プログラマだって生きている:Javascript Logging Utility Blackbirdを試してみる オフィシャル： Blackbird - Open Source JavaScript Logging Utility\n","date":"2009-02-02T20:45:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/02/204500/","title":"Blackbirdとやらを使ってみようじゃないか"},{"content":"まあ、流れ的に試してみようかと。 結果からすると、こちらもforeachの方が速いようだ。 今回のベンチマークはstrawberryperlでやった。 -Vした結果はこんな感じ。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 Summary of my perl5 (revision 5 version 10 subversion 0) configuration: Platform: osname=MSWin32, osvers=5.1, archname=MSWin32-x86-multi-thread uname=\u0026#39;\u0026#39; config_args=\u0026#39;undef\u0026#39; hint=recommended, useposix=true, d_sigaction=undef useithreads=define, usemultiplicity=define useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef use64bitint=undef, use64bitall=undef, uselongdouble=undef usemymalloc=n, bincompat5005=undef Compiler: cc=\u0026#39;gcc\u0026#39;, ccflags =\u0026#39; -s -O2 -DWIN32 -DHAVE_DES_FCRYPT -DPERL_IMPLICIT_CONTE XT -DPERL_IMPLICIT_SYS -fno-strict-aliasing -DPERL_MSVCRT_READFIX\u0026#39;, optimize=\u0026#39;-s -O2\u0026#39;, cppflags=\u0026#39;-DWIN32\u0026#39; ccversion=\u0026#39;\u0026#39;, gccversion=\u0026#39;3.4.5\u0026#39;, gccosandvers=\u0026#39;\u0026#39; intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234 d_longlong=undef, longlongsize=8, d_longdbl=define, longdblsize=12 ivtype=\u0026#39;long\u0026#39;, ivsize=4, nvtype=\u0026#39;double\u0026#39;, nvsize=8, Off_t=\u0026#39;long long\u0026#39;, lseek size=8 alignbytes=8, prototype=define Linker and Libraries: ld=\u0026#39;g++\u0026#39;, ldflags =\u0026#39;-s -L\u0026#34;C:\\strawberry\\perl\\lib\\CORE\u0026#34; -L\u0026#34;C:\\strawberry\\c\\li b\u0026#34;\u0026#39; libpth=C:\\strawberry\\c\\lib libs= -lmsvcrt -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 perllibs= -lmsvcrt -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdl g32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lw inmm -lversion -lodbc32 -lodbccp32 libc=-lmsvcrt, so=dll, useshrplib=true, libperl=libperl510.a gnulibc_version=\u0026#39;\u0026#39; Dynamic Linking: dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=\u0026#39; \u0026#39; cccdlflags=\u0026#39; \u0026#39;, lddlflags=\u0026#39;-mdll -s -L\u0026#34;C:\\strawberry\\perl\\lib\\CORE\u0026#34; -L\u0026#34;C:\\st rawberry\\c\\lib\u0026#34;\u0026#39; Characteristics of this binary (from libperl): Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT PERL_IMPLICIT_SYS PERL_MALLOC_WRAP PL_OP_SLAB_ALLOC USE_ITHREADS USE_LARGE_FILES USE_PERLIO Built under MSWin32 Compiled at Oct 19 2008 15:47:04 @INC: C:/strawberry/perl/lib C:/strawberry/perl/site/lib . 結果\n1 2 3 4 Rate sub_each sub_foreach sub_for sub_each 28.4/s -- -9% -10% sub_foreach 31.2/s 10% -- -2% sub_for 31.6/s 11% 2% -- ベンチマークコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/usr/bin/perl use strict; use warnings; use Benchmark qw(:all); use Digest::MD5 (); # use Data::Dumper; my %hash; for my $i (1 .. 10000) { my $digest = Digest::MD5::md5($i); $hash{ $digest } = $i; } cmpthese( 100, { sub_for =\u0026gt; sub { my @array; for my $key (keys %hash) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $hash{$key} }; } # print Dumper(\\@array); }, sub_foreach =\u0026gt; sub { my @array; foreach my $key (keys %hash) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $hash{$key} }; } # print Dumper(\\@array); }, sub_each =\u0026gt; sub { my @array; while ( my ($key, $value) = each %hash) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $value }; } # print Dumper(\\@array); }, }); …ちなみに、ハッシュの数をもう一桁増やしたベンチマークの結果\n1 2 3 4 Rate sub_each sub_foreach sub_for sub_each 2.68/s -- -11% -14% sub_foreach 3.00/s 12% -- -3% sub_for 3.11/s 16% 3% -- 念のため、前回のベンチマークをstrawberryperlでやった結果\n1 2 3 4 Rate sub_each sub_for sub_foreach sub_each 21692/s -- -19% -20% sub_for 26896/s 24% -- -1% sub_foreach 27233/s 26% 1% -- ","date":"2009-02-02T19:56:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/02/195625/","title":"hashの全ての要素に何かするベンチマーク　その２"},{"content":"あまり意識したことがなかった。\nいや、Perlの人も特段理由がなければwhile(my($key, $value) = each %hash)を使用する。 ハッシュのループについて - 枝葉末説@ことのはぐるま\nPerlの人を自称しているけど、foreachでループしてたなぁ。 実は、勝手にそう思っているだけでPerlの人ではないのかも？（ぉ 気になったのでベンチマークをとってみたら、foreachが速かった。 もしかして、以前もやったことあるのかも。 それでeachをあまり使わない、とか。 いや、記憶にないけど。 ついでに、forとforeachで何か違うかと思ってやってみたが、そうでもなかった。\nちなみに、eachに関しては以下のような記事もある。\neach関数のメモリ消費量は、ごくわずか。keys関数のように、キーのすべてをメモリに読み込まない。 ハッシュのすべての要素をeach関数を使って処理する。 - Perl入門～サンプルコードによるPerl入門～\nメモリを節約するのに、速度を犠牲にしているのかも？ 今回は、小さなハッシュしか試していないが、大きなハッシュだと結果が違うのかも？\n結果 1 2 3 4 Rate sub_each sub_for sub_foreach sub_each 17928/s -- -27% -27% sub_for 24710/s 38% -- -0% sub_foreach 24710/s 38% 0% -- ベンチマークコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/usr/bin/perl use strict; use warnings; use Benchmark qw(:all); # use Data::Dumper; my %hash; for my $key ( \u0026#34;a\u0026#34; .. \u0026#34;z\u0026#34; ) { $hash{$key} = int rand 100; } cmpthese( 100000, { sub_for =\u0026gt; sub { my @array; for my $key (keys %hash) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $hash{$key} }; } # print Dumper(\\@array); }, sub_foreach =\u0026gt; sub { my @array; foreach my $key (keys %hash) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $hash{$key} }; } # print Dumper(\\@array); }, sub_each =\u0026gt; sub { my @array; while ( my ($key, $value) = each %hash ) { push @array, { -key =\u0026gt; $key, -val =\u0026gt; $value }; } # print Dumper(\\@array); }, }); ","date":"2009-02-02T12:45:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/02/124539/","title":"hashの全ての要素に何かするベンチマーク"},{"content":"開発（実験）スクリプト用にバーチャルホストを作ったので、以前作っていたサンプルをそちらに移した。 その際、メニューが味気ないと思い、jQueryを使って階層メニューを作った。 試行錯誤はあったものの、結果的にはシンプルに実装できた。と思う。 参考にしたサイト\nStyled Css Menus - High Quality Web Based Professional Css Menus: allmenus jQueryを使ったプルダウンのナビゲーション | CSS Lecture 伸び縮みはjQueryで。 start.jsから一部抜粋\n1 2 3 4 5 6 7 8 // for menu $(\u0026#34;#menu ul.list-item-list\u0026#34;).css({ display:\u0026#34;none\u0026#34; }); var effect_speed = \u0026#39;fast\u0026#39;; $(\u0026#34;#menu ul.list li.list-item\u0026#34;).hover( function () { $(this).children(\u0026#34;ul.list-item-list\u0026#34;).slideDown(effect_speed); }, function () { $(this).children(\u0026#34;ul.list-item-list\u0026#34;).slideUp(effect_speed); }); hoverの挙動はスタイルシートで、それぞれ実装した。 devel.cssから一部抜粋\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 /* for menu */ #menu, #menu ul, #menu ul li { margin: 0; padding: 0; } #menu { height: 40px; position: relative; } #menu ul { list-style:none; } #menu ul.list { float:left; position: absolute; top: 0; left: 0; } #menu ul li.list-item { color: #192a33;/* HSV 201 50 20 */ background-color: #e6d7c3;/* HSV 34 15 90 */ float:left; position: relative; text-align: center; width: 260px; height: 40px; line-height: 40px; } #menu ul li.list-item p { font-weight: bold; margin: 0; padding: 0; } #menu ul li.list-item:hover { color: #e6d7c3;/* HSV 34 15 90 */ background-color: #665f57;/* HSV 34 15 40 */ } #menu ul.list-item-list li.list-item { color: #192a33;/* HSV 201 50 20 */ background-color: #e6d7c3;/* HSV 34 15 90 */ } ","date":"2009-02-02T01:20:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/02/02/012000/","title":"実験スクリプトの移植"},{"content":"NANOChatをMENTA化する時に「menta.nqou.net」というヴァーチャルホストを作ったが、NanoAとかYacafiにも興味が出てきたので、何でも突っ込めるように「devel.nqou.net」というヴァーチャルホストに変更した。\nそのうち、mentaの方は消します。\nとりあえず、ソースを簡単に公開できるようにソースビューアを作った。名前はsourcereaderだけど。\n一応ソースのハイライトもするようにした。\n作りかけて思ったけど、フレームワークを使って作るのがいかに簡単かというのがわかった。\n大したスクリプトでもないのに、結構時間がかかった。\nついでに、jqueryFileTreeからソースを見ることができるようにした。\n単純にリンクしても良かったが、折角なので何かを使うことにした。\nその何かはfaceboxという名前のjQueryのプラグイン。\nとりあえず動くようにはなったけど、そのうち変えるかも。\n今さっき気づいたけど、prettyPhotoのシリーズにprettyPopinというのがあった。\n使えるかどうかはわからないけど、そのうち試してみよう。\njQuery popin solution - prettyPopin - by Stephane Caron ","date":"2009-01-29T03:09:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/29/030933/","title":"開発（という名の実験）スクリプトを公開するバーチャルホストを作った"},{"content":"さりげなくメッセージを出すのが、こんなに簡単にできるとは！\nGrowlはMac OSXをお使いの方であれば知っているであろう、通知を行うためのフレームワーク的アプリケーションだ。Firefox、Cyberduck、Skypeなどなど、大抵のソフトウェアで利用されている。通知メッセージは画面の右上に表示され、時間が経過すると自動で消えていく、非常に使い勝手の良いアプリケーションだ。\nMOONGIFT: » Growl風の通知をJavaScriptで行うjQueryプラグイン「jGrowl」:オープンソースを毎日紹介\nそれが「Growl」らしい。 妻は今現在Mac使いだが、私のMac歴はSystem7で止まっているので、何のことかはわからない。 が、WindowsXPの場合はバルーンがこれに当たるだろうなぁと想像したが、ほぼ正解だった。 で、それをjQueryを使って実現したのが「jGrowl」です。\njGrowlはそんな仕組みをJavaScriptで実現している。さらにjQueryプラグインとして提供することで、とても簡単に呼び出すことができる。Ajaxを使う場合はもちろん、様々な場面で利用できそうだ。\nMOONGIFT: » Growl風の通知をJavaScriptで行うjQueryプラグイン「jGrowl」:オープンソースを毎日紹介\nただ使うだけなら本当に簡単です。 jqueryとjquery.jgrowl.jsを読み込んだ後、「$.jGrowl」で（それこそalertのように）使えます。 当然スタイルシートも忘れずに。 オフィシャル：stanlemon.net : jgrowl\nメッセージを出してみる\n1 $.jGrowl(\u0026#39;Hello World!\u0026#39;); 1 $.jGrowl(\u0026#39;これがメッセージです\u0026#39;); こんなに簡単なら何にでも使えそうですね。 少し練習してみました。\n","date":"2009-01-21T02:36:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/21/023639/","title":"さりげなくメッセージを出すjQueryのライブラリ「jGrowl」"},{"content":"調べ物をしていたら、画像の表示方法が格好良いサイトがあった。 いいなと思って調べてみたら、それは「LightBox」というライブラリらしかった。 prototype.jsをベースにしているらしい。 このブログではjQueryを使ってコードのハイライトをしているので、できればjQueryベースで似たような画像表示のライブラリがないかと思って調べてみたら、簡単に三つほど見つかった。\njQueryベースのLightBoxクローン「prettyPhoto」:phpspot開発日誌 jQueryでLightBoxを実現するjavascript「jQuery lightBox plugin」｜skuare.net jQuery版のLightBox「ThickBox」[to-R] 三つとも試してみて、最も気に入ったのが「prettyPhoto」だった。 角丸は柔らかい感じで良いですね。 ただ、ブログで画像ファイルをアップロードするのは面倒だ。 もっと簡単にできればいいのに。\n","date":"2009-01-20T00:06:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/20/000627/","title":"jQueryを使ってブラウザ上でスライドショー"},{"content":"なんだこれは！！\n「Enter」キーを押すことでゲームが開始される。左右の矢印「←」「→」キーで前進と後退ができる。「A」キーがダッシュ、「S」キーがジャンプ。くれぐれもお家に帰ってから遊ぼう。仕事中に夢中になってるのを上司に見つかってリストラされても責任は取らないからね！\nJavaScript版スーパーマリオブラザーズがすごすぎ :教えて君.net\n画像はともかく、操作も普通にできるのはビックリ。 多少ぎこちない感はあるけれど、ほとんど気にならない。 ブラウザだけで遊べるスーパーマリオは暇つぶしにはもってこいだね。\n","date":"2009-01-19T23:42:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/19/234259/","title":"JavaScript版スーパーマリオブラザーズがすごすぎ :教えて君.net"},{"content":"ふとplaggerを使いたくなってインストールした。 StrawberryPerlはCPANは簡単に使えるが、plaggerのように依存モジュールの多いプログラムをインストールするのは手間がかかる、というのが今の感想。 ActivePerlの場合は、有志が必要なモジュールをppmにしてくれているのでインストールしやすくなっている。 モジュールのインストールで一番困ったのは、メールを送るのに必要なNet::SMTP::TLSの依存モジュールのNet::SSLeay。 これが入らないとGmailからメールを送ることができない。（まあ、他にもやり方はあるかもしれないけど） 検索して色々と調べてみたが、一番有用な情報はモジュールのドキュメントに書いてあった。 コンパイル済みのバイナリを使うのではなく、自分でコンパイルしたファイルを使う、というのがうまくいく秘訣のようだ。 README.Win32 本文中で出てくるバージョンは、 Strawberry Perl 5.8.8-alpha-2 OpenSSL 0.9.8e source openssl-0.9.8e.tar.gz だが、それぞれ、 strawberry-perl-5.10.0.3.exe（Strawberry Perl） openssl-0.9.8j.tar.gz（OpenSSL: The Open Source toolkit for SSL/TLS） で、問題なくインストールできた。\n```default 4. Windows XP SP2 Strawberry Perl 5.8.8-alpha-2 OpenSSL 0.9.8e source openssl-0.9.8e.tar.gz - Install Strawberry Perl by running the installer (strawberry-perl-5.8.8-alpha-2.exe in this example) - Unpack openssl-0.9.8e.tar.gz - cd openssl-0.9.8e - ms\\mingw32 - cd out - ..\\ms\\test (if you have trouble getting to this stage, consult INSTALL.W32) - md c:\\openssl - md c:\\openssl\\bin - md c:\\openssl\\lib - md c:\\openssl\\include - md c:\\openssl\\include\\openssl - copy /b inc32\\openssl\\* c:\\openssl\\include\\openssl - copy /b out\\libssl32.a c:\\openssl\\lib - copy /b out\\libeay32.a c:\\openssl\\lib - copy /b libssl32.dll c:\\openssl\\bin - copy /b libeay32.dll c:\\openssl\\bin - copy /b out\\openssl.exe c:\\openssl\\bin - cd Net-SSLeay-xxxx - c:\\strawberry-perl\\perl\\bin\\perl Makefile.PL - dmake - copy c:\\openssl\\bin\\*.dll blib/arch/auto/Net/SSLeay - dmake install ```\u0026lt;/blockquote\u0026gt;\n[README.Win32]\n一部、コピー元のファイルの場所が違っていたので、メモしておく。 「inc32\\openssl\\」は「outinc\\openssl\\」になっていた。 それ以外はバージョンの数字やperlの場所が違う程度で、特に問題はなかった。\n","date":"2009-01-18T15:52:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/18/155218/","title":"Net-SSLeayのWindowsXPへのインストール"},{"content":"しばらくサクラエディタを使っていたが、今回もう一ついいソフトを見つけた。それが「Programmer\u0026rsquo;s Notepad」です。\n参考記事\nNotepadについている基本機能の上にコードアウトライン、ドッキングツールバー、タグ、インタラクティブエラー検索、出力されたエラーをクリックするとそれを生成したコードへジャンプ、簡易検索、シンタックスハイライト、xmlファイル経由でエクスポートできるカスタマイズ可能なインターフェース。日々コードを操っている方はちょっと試してみては？\nコードを書くために設計された『Programmer\u0026rsquo;s Notepad』 : ライフハッカー［日本版］, 仕事も生活も上手くこなすライフハック情報満載のブログ・メディア\nオフィシャル：Programmer\u0026rsquo;s Notepad » Home\n気に入った理由は、Tagsウィンドウに関数一覧が出ること、という単純なことだけど。これ重要。\nシンタックスハイライトも、ある程度自動で適用されるし、MENTAのテンプレートファイルのように、関連付けが不明な場合でも、簡単にタイプを変更できます。\nただ、フォントの設定で「MS UI Gothic」などの等幅フォントにしても、設定がうまくいかなくて困った。色々と試した結果、「FixedSys」が一番きれいに表示できるようだ。\nあと、エディタからコマンドを実行できるのも便利。とりあえず、文法チェックと実行はショートカットも登録して使っている。\n今までは「CopalPro」とエディタをセットで使っていたが、これでエディタ単体でできるようになった。\n","date":"2009-01-18T03:40:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/18/034041/","title":"最近のお気に入りエディタ「Programmer's Notepad」"},{"content":"NANOChatのMENTA化がようやく完成しました。 いらっしゃいなの。 - NANOChat ようやくMENTAの使い方がわかった感じです。ほんの少しですが。\nMENTA化するに際して、色々と妥協しました。妥協というか、フレームワークを使うんだから、そこは自力じゃダメだろ、みたいな事を感じたので。 例えば、ログファイルの読み方とか。というか、そもそもメインのログはSQLiteを使うことにしたので、そこら辺はバッサリ。 コードを移植するんじゃなく、コンテンツを移植するのだと。\nJSONの時はわかったフリをした感じだったけど、その辺を理解し、納得するのに結構時間がかかりました。 ログファイルの最後から読んだり、がちがちのHTMLで出力したり等、色々意味不明なこだわりがありましたが、生産性を上げるという観点から考えると、MENTAにあるフレームワークの機能は使っていかないと、それこそMENTAを使う意味が薄れてくる。\nフレームワークに慣れていきたいですね。NanoAやYacafiにも手を出してみようかな。 もともと、MENTAに手を出したのは、事前にコンパイルのような作業をして最適化する、という話があったから、だったのだけれど。 実際に使ってみて、（たぶんだけど）その辺はどっかにいってしまったのかなと。\n参考 Perlの軽量ウェブアプリケーションフレームワーク最新事情 - はてな#hide-k\n","date":"2009-01-15T23:49:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/15/234943/","title":"NANOChatのMENTA化、その4（一応完成）"},{"content":"またゲームにはまっています。 流行ったのは、2007年の7月くらいらしいですが。 参考 中毒性が高いとウワサの「Desktop Tower Defense」に、ばっちりはまってしまった どんなゲームなのかと、ちょっとやってみたのが運の尽き。 久しぶりにゲームで徹夜しました。\nDesktop TD is a fun flash based puzzle / strategy game where you have to protect your desktop from invaders by spending money on attacking pieces and building a maze for them to follow. A strangely addictive yet stress relieving game\u0026hellip; how many levels can you survive? For further details on how to play the game see the Instructions. Played before? Check out the latest updates. — Desktop Tower Defense\n最初は敵が左から右へ流れていくのを邪魔しないように砲台を置いて、固まった敵を打ち落とし損ねたり、早い敵に逃げられたりして、何がそんなに面白いのかわからなかったのです。 敵に当たったら砲台が壊れると思っていたので、通路に砲台を並べるしかないし。 しかし、そんなことはなかったのです。 実は砲台で迷路を作って、敵を誘導することができるのでした。 それがわかってから、迷路をどういうふうに作っていくかを、あーでもないこーでもない、と試行錯誤しながら、気がつけば夜が明けていたという。 なんとかHardモードでもクリアできるようになりましたが、まだノーミスでクリアできていない…。 まずは、ノーミスでクリアできるようになりたいです。\n","date":"2009-01-12T00:01:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/12/000155/","title":"Desktop Tower Defenseが面白い"},{"content":"NANOChatのMENTA化がなかなかうまくいかない。 なんというか、グローバル変数が多いのでスクリプトがわかりづらいです。 誰だ？こんなスクリプト書いたのは？ ということで、またまた気分転換に。 MENTAの標準添付モジュールを触ってみるコーナー。 第一弾はClass::Accessor::Fastです。 これだけで簡単にOOPな気分が味わえますね。 値の出し入れができるアクセサーを提供してくれます。 今回の例では「Point」というクラスに「x」と「y」というアクセサーを作った事になります。\n参考 MENTA標準添付モジュールについて - MENTA 404 Blog Not Found:perl - B::Deparse あと、MENTAは関係ありませんが、面白そうだったので「B::Deparse」を試してみました。 Perlがどのように解釈しているかを表示してくれるのは、なかなかためになります。\npoint.pl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #utf8 use strict; use warnings; use utf8; use Data::Dumper; sub p ($) { print Data::Dumper::Dumper(shift); } package Point; use base qw/Class::Accessor::Fast/; __PACKAGE__-\u0026gt;mk_accessors(qw/x y/); package main; my $p = Point-\u0026gt;new; p $p; $p-\u0026gt;x(128); $p-\u0026gt;y(256); eval { $p-\u0026gt;z(32); }; warn $@ if $@; p $p-\u0026gt;x; p $p-\u0026gt;y; p $p; 実行結果 1 2 3 4 5 6 7 8 Can\u0026#39;t locate object method \u0026#34;z\u0026#34; via package \u0026#34;Point\u0026#34; at D:\\devel\\test\\point.pl line 18. $VAR1 = bless( {}, \u0026#39;Point\u0026#39; ); $VAR1 = 128; $VAR1 = 256; $VAR1 = bless( { \u0026#39;y\u0026#39; =\u0026gt; 256, \u0026#39;x\u0026#39; =\u0026gt; 128 }, \u0026#39;Point\u0026#39; ); perl -MO=Deparse point.pl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 use utf8; use Data::Dumper; sub p ($) { use warnings; use strict \u0026#39;refs\u0026#39;; print Data::Dumper::Dumper(shift @_); } package Point; sub BEGIN { use warnings; use strict \u0026#39;refs\u0026#39;; require base; do { \u0026#39;base\u0026#39;-\u0026gt;import(\u0026#39;Class::Accessor::Fast\u0026#39;) }; } use warnings; use strict \u0026#39;refs\u0026#39;; \u0026#39;Point\u0026#39;-\u0026gt;mk_accessors(\u0026#39;x\u0026#39;, \u0026#39;y\u0026#39;); package main; my $p = \u0026#39;Point\u0026#39;-\u0026gt;new; p $p; $p-\u0026gt;x(128); $p-\u0026gt;y(256); eval { do { $p-\u0026gt;z(32) } }; warn $@ if $@; p($p-\u0026gt;x); p($p-\u0026gt;y); p $p; ","date":"2009-01-07T01:45:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/07/014534/","title":"Class::Accessor::Fastを触ってみる"},{"content":"flickrfetcherに気をとられて気づきませんでしたが、他にも面白いサービスをやっていました。\n参考 ゆーすけべー日記: 今聴いている曲の歌詞が見れる「LastLyrics」を作ってみた\n今聴いている曲もしくは最近聴いた曲の歌詞が見れるサイトです。メジャーな曲のみ対応しています。 LastLyrics\nAPIを組み合わせたマッシュアップサイトですが、こういうサービスをさっくり作れるのは凄いですね。\n","date":"2009-01-06T21:38:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/06/213841/","title":"最近聴いた曲の歌詞が見れるサイト「LastLyrics」"},{"content":"flickr_fetcher.plは、元々は引数でキーワードを入れるという、とてもフレキシブルなスクリプトです。 元ネタ ゆーすけべー日記: Flickr からキーワードにマッチした写真を一括ダウンロードする Perl スクリプト「flickr_fetcher.pl」 が、前エントリーでは、プログラムの中に直接書き込む事を選んだので、別のキーワードで画像を探すときにはその部分を変更してやる必要が出てきます。 ローマ字や英語でキーワードを入れる場合はかまいませんが、日本語の検索は標準のコマンドプロンプトでは無理なのです。 本来なら配布されているプログラムの中身を変えるのは、配布元で更新があったときに、それに対応するのが面倒なので、できれば変えたくない。 実際、このスクリプトの場合はページの最大値を求める計算方法が変わった。 勝手に改造した部分には変更はなかったが、こういうのは精神衛生上良くない。 \u0026hellip;と思いながらソースを見ていると、モジュールとスクリプトを分けて記述してあることに気づいた。 実際の実行部（スクリプト部分）はたったの2行（宣言と空白を入れて4行）だった。\n1 2 3 package main; my $fetcher = FlickrFetcher-\u0026gt;new_with_options(); $fetcher-\u0026gt;run(); ここだけを別のファイルに切り分けて、FlickrFetcherモジュールを使うようにすれば、スクリプトファイルを別で用意すればいいので、それほどややこしくない。 今回は、スクリプトファイルの中身は簡単でしたが、keywordとdirのデータを沢山揃えてfor文でfetchに流してやれば、かなり収集が便利になるでしょう。 というところで、モジュール化したFlickrFetcherですが、現時点で二つほど改善点があります。 どちらも、fetchルーチン内です。 一つは「Transfer truncated」で止まってしまう事がある問題です。 細かく調べてはいませんが、止まらなければ良いので、evalで括ってしまいました。 本来ならリトライを頑張るところでしょうが、そのあたりは誰かにおまかせです。 もう一つは、検索結果が1枚だけの時にループで「Not an ARRAY reference」と言われてしまいます。 parse_responseメソッドの親切心（？）が仇になっているのでしょうか？ ともあれ、ARRAY referenceでない場合はARRAY referenceに変換するようにしました。 あと、モジュールにはしましたが、podは変更してません。\nFlickrFetcher.pm 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 package FlickrFetcher; use Moose; use Moose::Util::TypeConstraints; use Params::Coerce (); use Digest::MD5 qw(md5_hex); use Encode; use LWP::UserAgent; use Path::Class; use POSIX qw(ceil); use WebService::Simple; use WebService::Simple::Parser::XML::Simple; use XML::Simple; use Perl6::Say; our $VERSION = \u0026#39;0.01\u0026#39;; with \u0026#39;MooseX::Getopt\u0026#39;; subtype \u0026#39;Dir\u0026#39; =\u0026gt; as \u0026#39;Object\u0026#39; =\u0026gt; where { $_-\u0026gt;isa(\u0026#39;Path::Class::Dir\u0026#39;) }; coerce \u0026#39;Dir\u0026#39; =\u0026gt; from \u0026#39;Str\u0026#39; =\u0026gt; via { Path::Class::Dir-\u0026gt;new($_) }; MooseX::Getopt::OptionTypeMap-\u0026gt;add_option_type_to_map(\u0026#39;Dir\u0026#39; =\u0026gt; \u0026#39;=s\u0026#39;); has \u0026#39;keyword\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Str\u0026#39;, required =\u0026gt; 1); has \u0026#39;dir\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Dir\u0026#39;, required =\u0026gt; 1, coerce =\u0026gt; 1); has \u0026#39;api_key\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Str\u0026#39;); has \u0026#39;license\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Int\u0026#39;); has \u0026#39;_perpage\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; \u0026#39;Int\u0026#39;, default =\u0026gt; 500); has \u0026#39;_flickr\u0026#39; =\u0026gt; (is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;WebService::Simple\u0026#39;); has \u0026#39;_ua\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;ro\u0026#39;, isa =\u0026gt; \u0026#39;LWP::UserAgent\u0026#39;, default =\u0026gt; sub { LWP::UserAgent-\u0026gt;new(keep_alive =\u0026gt; 1) } ); sub BUILD { my ($self, $args) = @_; unless ($self-\u0026gt;api_key) { if (my $api_key = $ENV{FLICKR_API_KEY}) { $self-\u0026gt;api_key($api_key); } else { die \u0026#34;api_key is required\\n\u0026#34;; } } my $xs = XML::Simple-\u0026gt;new(KeepRoot =\u0026gt; 1, keyattr =\u0026gt; []); my $parser = WebService::Simple::Parser::XML::Simple-\u0026gt;new(xs =\u0026gt; $xs); my $flickr = WebService::Simple-\u0026gt;new( base_url =\u0026gt; \u0026#34;http://api.flickr.com/services/rest/\u0026#34;, param =\u0026gt; { api_key =\u0026gt; $self-\u0026gt;api_key }, response_parser =\u0026gt; $parser, ); $self-\u0026gt;_flickr($flickr); } __PACKAGE__-\u0026gt;meta-\u0026gt;make_immutable; no Moose; sub run { my $self = shift; mkdir $self-\u0026gt;dir-\u0026gt;relative if !-d $self-\u0026gt;dir-\u0026gt;is_absolute; say \u0026#34;search keyword : \u0026#34; . $self-\u0026gt;keyword; my $photo_total = $self-\u0026gt;photo_total($self-\u0026gt;keyword); say \u0026#34;total count : \u0026#34; . $photo_total; my $pages = ceil($photo_total / $self-\u0026gt;_perpage); for my $current_page (1 .. $pages) { say \u0026#34;search page : $current_page\u0026#34;; $self-\u0026gt;search($self-\u0026gt;keyword, $current_page, $self-\u0026gt;_perpage); } } sub search { my ($self, $keyword, $page, $perpage) = @_; my $response = $self-\u0026gt;_flickr-\u0026gt;get( { method =\u0026gt; \u0026#34;flickr.photos.search\u0026#34;, text =\u0026gt; $keyword, per_page =\u0026gt; $perpage, sort =\u0026gt; \u0026#39;date-posted-desc\u0026#39;, extras =\u0026gt; \u0026#39;date_upload\u0026#39;, page =\u0026gt; $page, license =\u0026gt; $self-\u0026gt;license || \u0026#34;\u0026#34;, } ); my $xml = $response-\u0026gt;parse_response; $self-\u0026gt;fetch($xml-\u0026gt;{rsp}-\u0026gt;{photos}-\u0026gt;{photo}); } sub fetch { my ($self, $photo_ref) = @_; $photo_ref = ref $photo_ref eq \u0026#39;ARRAY\u0026#39; ? $photo_ref : [$photo_ref]; # 要素が一つのとき対策 for my $photo (@$photo_ref) { my $url = $self-\u0026gt;photo_url($photo-\u0026gt;{id}); my $file = $self-\u0026gt;dir-\u0026gt;file(md5_hex($url) . \u0026#34;.jpg\u0026#34;); my $res; eval { $res = $self-\u0026gt;_ua-\u0026gt;mirror($url, $file); }; # 「Transfer truncated」対策。ここから if ($@) { say $@; } else { say \u0026#34;try to fetch : \u0026#34; . $res-\u0026gt;status_line . \u0026#34; : $url\u0026#34;; } # ここまで } } sub photo_url { my ($self, $photo_id) = @_; my $response = $self-\u0026gt;_flickr-\u0026gt;get( { method =\u0026gt; \u0026#34;flickr.photos.getSizes\u0026#34;, photo_id =\u0026gt; $photo_id } ); my $xml = $response-\u0026gt;parse_response; my $largest_ref = pop @{$xml-\u0026gt;{rsp}-\u0026gt;{sizes}-\u0026gt;{size}}; return $largest_ref-\u0026gt;{source}; } sub photo_total { my ($self, $keyword) = @_; my $response = $self-\u0026gt;_flickr-\u0026gt;get( { method =\u0026gt; \u0026#34;flickr.photos.search\u0026#34;, text =\u0026gt; $keyword, per_page =\u0026gt; 1, license =\u0026gt; $self-\u0026gt;license || \u0026#34;\u0026#34;, } ); my $xml = $response-\u0026gt;parse_response; return $xml-\u0026gt;{rsp}-\u0026gt;{photos}-\u0026gt;{total}; } 1; __END__ =head1 NAME flickr_fetcher.pl - Fetch Flickr photos by keyword =head1 SYNOPSIS ./flickr_fetcher.pl --keyword hoge --dir hoge --api_key yourflickrapikey =head1 AUTHOR Yusuke Wada E\u0026lt;lt\u0026gt;yusuke (at) kamawada.comE\u0026lt;gt\u0026gt; =head1 LICENSE This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself. =cut flickr_fetcher.pl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/usr/bin/perl # utf8 use strict; use warnings; use FlickrFetcher; fetch({ keyword =\u0026gt; \u0026#39;石原さとみ\u0026#39;, dir =\u0026gt; \u0026#39;satomi_ishihara\u0026#39;, }); sub fetch { my $rh_arg = shift; my $fetcher = FlickrFetcher-\u0026gt;new_with_options(%{$rh_arg}); $fetcher-\u0026gt;run(); } ","date":"2009-01-06T00:47:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/06/004716/","title":"flickr_fetcher.plをモジュールにしてみました。"},{"content":"画像を集めるのは結構大変だったりするわけですが。 Yahoo!Pipesで複数のソーシャルブックマークから情報を収集していて面白いスクリプトを見つけました。 ゆーすけべー日記: Flickr からキーワードにマッチした写真を一括ダウンロードする Perl スクリプト「flickr_fetcher.pl」 最初は記事に書いてあるとおり使ってみようとしたのですが、コマンドプロンプトがShift_JISのせいなのか、キーワードを入れてもヒットしないのです。 Windowsを呪ってみても仕方がないので、スクリプトの中にキーワードを入れて使うことにしました。 どのように入れるか迷いましたが、とりあえず、BUILDに直接書き込みました。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 sub BUILD { my ( $self, $args ) = @_; unless ( $self-\u0026gt;api_key ) { if ( my $api_key = $ENV{FLICKR_API_KEY} ) { $self-\u0026gt;api_key($api_key); } else { die \u0026#34;api_key is required\\n\u0026#34;; } } unless ( $self-\u0026gt;keyword ) { $self-\u0026gt;keyword(\u0026#39;石原さとみ\u0026#39;); } unless ( $self-\u0026gt;dir ) { $self-\u0026gt;dir(\u0026#39;satomi_ishihara\u0026#39;); } my $xs = XML::Simple-\u0026gt;new( KeepRoot =\u0026gt; 1, keyattr =\u0026gt; [] ); my $parser = WebService::Simple::Parser::XML::Simple-\u0026gt;new( xs =\u0026gt; $xs ); my $flickr = WebService::Simple-\u0026gt;new( base_url =\u0026gt; \u0026#34;http://api.flickr.com/services/rest/\u0026#34;, param =\u0026gt; { api_key =\u0026gt; $self-\u0026gt;api_key }, response_parser =\u0026gt; $parser, ); $self-\u0026gt;_flickr($flickr); } これに伴い、keywordとdirのrequireをとりました。\n1 2 3 4 has \u0026#39;keyword\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Str\u0026#39; ); has \u0026#39;dir\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Dir\u0026#39;, coerce =\u0026gt; 1 ); has \u0026#39;api_key\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Str\u0026#39; ); has \u0026#39;license\u0026#39; =\u0026gt; ( is =\u0026gt; \u0026#39;rw\u0026#39;, isa =\u0026gt; \u0026#39;Int\u0026#39; ); （わかったようにやっていますが、雰囲気でやってみて、結果としてうまくいっただけです。） で、結果は以下のとおり。\nいやいや。 便利なスクリプトをありがとうございます。\n","date":"2009-01-05T22:38:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/05/223856/","title":"「flickr_fetcher.pl」を勝手に改造して活用してみた"},{"content":"MENTAで行き詰っているので、気分転換に。 - Pipes: Rewire the web どんなことをするのか、というのは、解説するよりも実際に見てみるほうが良いかもしれません。 - Browse Pipes: Browse Pipes 私は各種ソーシャルブックマークからperlタグがついている記事を集めたりしています。\n","date":"2009-01-03T23:28:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/03/232820/","title":"Yahoo.comのPipesが便利"},{"content":"私は寝てましたが。\n日本標準時の維持・管理を行っている、NICT 独立行政法人情報通信研究機構の小金井本部にて、2009年1月1日に行われたうるう秒実施の様子を見てきました。NICT小金井本部の研究本館には、現在の日本標準時を示す電光掲示板があります。この掲示板を撮影し、うるう秒実施時の様子収めています。動画中でも言及していますが、今年は見学者の人数が多かったそうで。\nうるう秒の瞬間を見てきた‐ニコニコ動画(ββ)\nうるう秒の瞬間って見れるのか？と思って興味深く見ました。\nあと、こんなのも。\nうるう秒のNTT時報\nありえないと思いながら、パソコンではどうなってるのかやってみたくなったので、実際にやってみた。\n1 2 3 4 5 6 7 use strict; use warnings; use Perl6::Say; my $time = 1230767999; for ( 0 .. 2 ) { say scalar localtime $time++; } 結果は\u0026hellip;やってみてください。\ntimeの値ですが、以下のように計算できます。\n1 2 use Time::Local; print scalar timelocal(59,59,8,1,0,109); それにしても、Perl6::Sayは便利ですね。\u0026quot;\\n\u0026quot;が不要というのはとても使い勝手が良いです。\n","date":"2009-01-02T00:55:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/02/005540/","title":"うるう秒の瞬間"},{"content":"Module::Starter(::PBP)を試したが、残念な結果に終わったので、次に手を出すことにした。 Module::Setupです。\n参考 YappoLogs: Module::Setup - pmsetupをモジュール化した\nStrawberryPerlをインストールしているので、cpanからさっくりとインストールを試してみます。\n1 C:\\\u0026gt; cpan -i Module::Setup 依存モジュールのModule::Collectのテストでこけました。 が、とりあえず強制的に入れました。\n1 C:\\\u0026gt; cpan -f Module::Collect この後、もう一度試しましたが、結局テストでこけたので、またも強制インストール。\n1 C:\\\u0026gt; cpan -f Module::Setup 本来はあまりよくないでしょうが、Windowsという環境下でもあるので、ある程度は気にしません。 C:\\strawberry\\perl\\binにmodule-setup.batができていましたので、おそらく問題ないでしょう。 無事（？）インストールできたということで、開発者のブログの解説を見ながら簡単に使ってみます。 まずは、Module::Setupならではのflavor機能を使ってみます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 C:\\home\\nqou\u0026gt; module-setup --init Creating *****\\.module-setup\\flavors\\default\\template\\Makefile.PL Creating *****\\.module-setup\\flavors\\default\\template\\t\\00_compile.t Creating *****\\.module-setup\\flavors\\default\\template\\xt\\01_podspell.t Creating *****\\.module-setup\\flavors\\default\\template\\xt\\02_perlcritic.t Creating *****\\.module-setup\\flavors\\default\\template\\xt\\03_pod.t Creating *****\\.module-setup\\flavors\\default\\template\\xt\\perlcriticrc Creating *****\\.module-setup\\flavors\\default\\template\\Changes Creating *****\\.module-setup\\flavors\\default\\template\\lib\\____var-module_path-var____.pm Creating *****\\.module-setup\\flavors\\default\\template\\MANIFEST.SKIP Creating *****\\.module-setup\\flavors\\default\\template\\README Creating *****\\.module-setup\\flavors\\default\\template\\.shipit Creating directory *****\\.module-setup\\flavors\\default\\additional Dump config *****\\.module-setup\\flavors\\default\\additional\\config.yaml Creating directory *****\\.module-setup\\flavors\\default\\plugins Creating directory *****\\.module-setup\\flavors\\default\\template Do you use SVN? [yN] [n] y You chose version control system: SVN Do you use SVK? [yN] [n] Do you use Git? [yN] [n] Your name: [Default Name] Your email: [default {at} example.com] Dump config *****\\.module-setup\\flavors\\default\\config.yaml module-setupのオプションに「\u0026ndash;init」をつけることでホームディレクトリ（ここでは消しましたが、C:\\Documents and Settings\\ユーザー名）に.module-setupというフォルダができ、その中のflavorsフォルダの中にflavor名で展開されます。 途中、名前と電子メールとバージョン管理に関するいくつかの設定を訊かれます。 名前や電子メールは作成するモジュールの雛形に書き込まれます。 バージョン管理は、今のところsvnだけは使って（というか、使おうとして）いるので、svnだけyにしました。 flavorができたところで、これに基づいてモジュールのスケルトンを作っていきます。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 C:\\home\\nqou\u0026gt; module-setup My::Module [1]: default [2]: dmake [3]: xs Select flavor: [1] 1 You chose flavor: default Subversion friendly? [Yn] [y] Creating directory My-Module\\trunk Creating directory My-Module\\tags Creating directory My-Module\\branches Creating directory My-Module\\trunk Creating My-Module\\trunk\\.shipit Creating My-Module\\trunk\\Changes Creating My-Module\\trunk\\Makefile.PL Creating My-Module\\trunk\\MANIFEST.SKIP Creating My-Module\\trunk\\README Creating My-Module\\trunk\\lib\\My\\Module.pm Creating My-Module\\trunk\\t\\00_compile.t Creating My-Module\\trunk\\xt\\01_podspell.t Creating My-Module\\trunk\\xt\\02_perlcritic.t Creating My-Module\\trunk\\xt\\03_pod.t Creating My-Module\\trunk\\xt\\perlcriticrc Check Makefile.PL? [Yn] [y] n flavorがいくつかある場合は、どのflavorを使うか選択画面が出ます。 svnを使う設定にしていると、subversionと相性がいいようにディレクトリを作ってくれます。 最後に、Makefile.PLをチェックするか聞いてきますが、defaultだと、makeコマンドが「make」になってしまうので、チェックはスキップします。 このあたりはプラグインでどうにかなります。 makeコマンドをStrawberryPerl仕様の「dmake.exe」に変更するためにpluginを作成しました。 そうやって作ったflavorが（既に出てきましたが）「dmake」です。 .module-setup\\flavors\\dmake\\plugins\\Test\\Dmake.pm\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package Module::Setup::Plugin::Test::Dmake; use strict; use warnings; use base \u0026#39;Module::Setup::Plugin\u0026#39;; sub register { my($self, ) = @_; $self-\u0026gt;add_trigger( check_skeleton_directory =\u0026gt; \\\u0026amp;check_skeleton_directory ); } sub check_skeleton_directory { my $self = shift; return unless $self-\u0026gt;dialog(\u0026#34;Check Makefile.PL? [Yn] \u0026#34;, \u0026#39;y\u0026#39;) =~ /[Yy]/; !$self-\u0026gt;system(\u0026#39;perl\u0026#39;, \u0026#39;Makefile.PL\u0026#39;) or die $?; !$self-\u0026gt;system(\u0026#39;dmake\u0026#39;, \u0026#39;test\u0026#39;) or die $?; !$self-\u0026gt;system(\u0026#39;dmake\u0026#39;, \u0026#39;manifest\u0026#39;) or die $?; !$self-\u0026gt;system(\u0026#39;dmake\u0026#39;, \u0026#39;distclean\u0026#39;) or die $?; } 1; pluginを作ったら、configも変更する必要があります。 .module-setup\\flavors\\dmake\\config.yaml\n1 2 3 4 5 6 7 8 9 --- author: Default Name email: \u0026#39;default {at} example.com\u0026#39; plugins: - Config::Basic - Template - Test::Dmake - Additional - VC::SVN まあ、スケルトンはこんな感じでうまくいきました。 問題は中身ですが、それはこれから。 ちなみに、「xs」のflavorは以下のページの物を使いました。 作るわけではありませんが、flavorの使い方に慣れるためにやってみました。\n参考 XSモジュール用のModule::Setupのflavorを作った - Clouder::Blogger\n","date":"2009-01-01T22:12:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2009/01/01/221252/","title":"Module::Setupを試してみる"},{"content":"PHPやRubyのソースを見ながら、試行錯誤で作ってみた。 Perlということでplにしたけど、実際にはMENTAディレクトリ内での実行のため、拡張子はcgiに変更した。 久しぶりにモジュールを使わずに一から作ったらなかなか大変だった。 古いソースを引っ張り出して基本的な変換（アンエスケープ）をしたり、ファイルやディレクトリの一覧を得るのに、readdirを使ったり。 調べないと全然覚えてない。 しかし、セキュリティ的に微妙な気がする。 とりあえず、「.」から始まるファイルやディレクトリは見せないようにはした。 さりげなく使っているけど、最近覚えたData::Dumperの技。\n1 use Data::Dumper;sub p { print Data::Dumper::Dumper(shift) } こうすることで、デバッグするときは\n1 p(\\@args); というふうに簡単に出力することができる。 便利だね。\njqueryFileTree.pl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 #!/usr/bin/perl # jQuery File Tree Perl Connector # Version 0.01 # https://www.nqou.net # 31 Dec 2008 # Output a list of files for jQuery File Tree use strict; use warnings; use utf8; # use Data::Dumper;sub p { print Data::Dumper::Dumper(shift) } print \u0026#34;Content-type: text/html;\\n\\n\u0026#34;; my @args = \u0026lt;\u0026gt;; # p(\\@args); my %params = (map { split /=/ } @args); # p(\\%params); foreach my $value (values %params) { uri_unescape(\\$value); } # p(\\%params); my $target = $params{dir} || \u0026#39;./\u0026#39;;# 省略時は現在のディレクトリ（元々の仕様は最上位ディレクトリ） die \u0026#34;Error!\u0026#34; if $target =~ /\\.\\./;# さかのぼり禁止 die \u0026#34;Error!\u0026#34; unless -d $target;# ディレクトリ以外禁止 our @files; search_dir($target); # p(\\@files); print qq{\u0026lt;ul class=\u0026#34;jqueryFileTree\u0026#34; style=\u0026#34;display: none;\u0026#34;\u0026gt;}; foreach my $file (@files) { if (-d $file) { my ($dir) = $file =~ m!/([^/]*?)$!o; print qq{\u0026lt;li class=\u0026#34;directory collapsed\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34; rel=\u0026#34;$file/\u0026#34;\u0026gt;$dir\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;}; } elsif (-f _) { my ($ext) = $file =~ /([^\\.]+)$/o; my ($filename) = $file =~ m!/([^/]*?)$!o; print qq{\u0026lt;li class=\u0026#34;file ext_${ext}\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34; rel=\u0026#34;$file\u0026#34;\u0026gt;$filename\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;}; } else { print \u0026#34;Error!\u0026#34;; } } print qq{\u0026lt;/ul\u0026gt;}; # ディレクトリを走査 sub search_dir { my $dir = shift; my @f; opendir my $dh, $dir or die \u0026#34;can not open `$dir`: $!\u0026#34;; foreach my $file (sort {$a cmp $b} readdir $dh) { next if $file =~ /^\\./o; my $path = qq{$dir$file}; if (-f $path) { push @f, $path } elsif (-d _) { push @files, $path; } } closedir $dh; push @files, @f;# ディレクトリ、ファイルの順にする } # アンエスケープ sub uri_unescape { my $str = shift; $$str =~ s/%([0-9a-fA-F]{2})/pack(\u0026#34;H2\u0026#34;, $1)/eg; } ","date":"2008-12-31T01:08:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/31/010856/","title":"jqueryFileTree.plを作ってみた"},{"content":"MENTAを触りはじめた時に、テンプレート内で後置型のifがちゃんと使えたのだが、少なくとも「static_file_path」と同時に使うことで、不具合が発生するようです。\nローカルでMENTAのインデックスにスタイルシートを適用しようとしたところ、タイトルがおかしくなっていました。\nスタイルシートへのパスが入ってしまうようになりました。\n今のところ原因はわかりませんが、普通にifブロックを使う、ということで回避はできるので大きな問題はありません。\nで、コードにも書いていますが、MENTAのインデックスにjQueryを使ってファイルとディレクトリをツリー表示するライブラリである「jQueryFileTree」を使ってみました。\nいずれ、ここからソースコードを見ることができるようにしようと思っています。\nこのライブラリはjQueryから（デフォルトでは）PHPを利用してファイルとディレクトリを取得して、その結果をjQueryで表示するものです。\n参考 jQueryを使ってファイルツリーを表示できる『jQuery File Tree』 | IDEA*IDEA jQuery File Tree jQuery File Tree Demo オフィシャルでは「jQuery Easing Plugin」というのが必要ということになっているので入れていますが、読み込んでなくても動いているようではあります。\nDependencies jQuery File Tree requires jQuery 1.2 or above. For easing effects, you will need the jQuery Easing Plugin or another jQuery easing plugin of your choice. jQuery File Tree\nローカルにPHPが入ってなかったので、それを入れるのがなかなか面倒でした。\nPerlで書かれたファイルがあればそれを使ったのに\u0026hellip;と思いながら。\nまた、ローカルのテスト環境では微妙なエラーメッセージが出ているので、それもどうにかしたい\u0026hellip;と思いながら。\nPerlで書いてみようかなぁ。\n1 PHP Notice: Undefined variable: root in *****/jqueryFileTree.php on line 21 app/controller/header.mt\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ? my $title = shift; \u0026lt;!doctype html\u0026gt; \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34; xml:lang=\u0026#34;ja\u0026#34; lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;menta.nqou.net\u0026lt;/title\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;./jquery.easing.1.3.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;./jqueryFileTree.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;\u0026lt;?= static_file_path(\u0026#34;default.css\u0026#34;) ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;./jqueryFileTree.css\u0026#34;\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; $(document).ready(function () { $(\u0026#39;#fileTree\u0026#39;).fileTree({ root: \u0026#39;./\u0026#39;, }, function(file) { alert(file); }); }); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;menta.nqou.net\u0026lt;/h1\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; if $title ?\u0026gt;menta.nqou.net\u0026lt;/h1\u0026gt; ","date":"2008-12-30T20:29:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/30/202942/","title":"後置型のifとMENTAとjQueryFileTree、そしてPHP"},{"content":"MENTAを追いかけ始めてからPerlだけじゃなく、Web開発に関して色々と資料を読んでいる。 資料といっても、はてなブックマークの注目エントリーや人気エントリーを中心にあれこれと読んでいるだけだが。 その中で、JavaScriptのライブラリとして最近ホットなのがjQueryだ。 それはそれとして、先ほどのエントリーで参照した先のソースを見てみると、preタグにもcodeタグにも「prettyprint」が書いてなかった。 不思議に思ってソースを見てみると、prettyfy.jsを読んだ後に別のスクリプトを読んでいて、その中でどうやらクラス名を操作して、その後にprettyPrint()している事がわかった。 それと同じ事をjQueryでやってみよう、と思ってやってみた。 書いた場所は、テンプレートのフッター。 先ほどのスクリプトを読み込んだ後にjQueryを読み込んで、さらにその後にクラス名を変更するコードを書いた。 このブログでは、コードはpreの後にcodeで括っているので、その条件にあったタグにクラス名を設定することにした。 そのあたりのコードは「続き」で。\n1 2 3 4 5 6 7 8 \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; $(document).ready(function(){ $(\u0026#39;pre code\u0026#39;).addClass(\u0026#34;prettyprint\u0026#34;); prettyPrint(); }); \u0026lt;/script\u0026gt; ちなみに。 JavaScriptのライブラリについては、ネット全体でのキャッシュ効果を期待して、googleの「The AJAX Libraries API」を使っている。 prettifyについては微妙だが、参考にしたサイトでもやっていたのでのってみた。\n参考 Google人気JavaScriptライブラリ配布開始、ネット全体でキャッシュ効果 | エンタープライズ | マイコミジャーナル\n","date":"2008-12-30T01:42:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/30/014223/","title":"jQueryを使ってgoogle-code-prettifyを自動的に適用してみた"},{"content":"Perlのソースをブログに書くために色々と調べてみた。 参考 あなたのソースコードを彩る、Syntax Highlighterまとめ - Blog.37to.net で、今の状況で導入が比較的簡単そうな「google-code-prettify」を試してみることにした。\nA Javascript module and CSS file that allows syntax highlighting of source code snippets in an html page.\n[google-code-prettify - Google Code]\nREADME（Javascript code prettifier）のsetupをいい加減に訳すと、\nファイル一式をダウンロードします。 適用するドキュメントに、スタイルシートとJavaScriptをインクルードします。linkタグやscriptタグで指定します。 bodyタグのonloadに\u0026quot;prettyPrint()\u0026ldquo;を書きます。 スタイルシートをお好みで変更します。 という感じです。 MovableTypeに適用する場合、色々と面倒なので、テンプレートのヘッダーのスタイルシートを読み込んでいるあたりに、新しいスタイルシートを直接読み込みました。 で、スクリプトのほうは、テンプレートのフッターのbodyの閉じタグの前で読み込み、その後prettyPrint()をそのまま実行することにしました。 あとは、実際のコードを書いた部分のpreタグかcodeタグのclassを「prettyprint」に指定すれば、その部分をハイライトしてくれるようです。 とあるスクリプトを改造して使っているのですが、それをソース表示してみます。\ndl.pl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/usr/bin/perl use strict; use LWP::Simple; use File::Basename; use Digest::MD5 qw(md5_hex); use Perl6::Say; my $uri = shift or die \u0026#34;uri please!. \u0026#34;; my $content = get($uri); my @l = $content =~ m{\u0026lt;a.*?href=\u0026#34;?(http://[^ ]+?\\.jpe?g)\u0026#34;?}gi; # 苦肉の策 # my @l = $content =~ m{\u0026lt;a.*?href=\u0026#34;(http://[^\u0026#34;]+\\.jpe?g)\u0026#34;}gi;# オリジナル my $dir = md5_hex($uri); mkdir $dir or die unless -d $dir; say \u0026#34;make dir \u0026gt; \u0026#34; . $dir; foreach (@l) { my $filename = basename($_); mirror($_, sprintf(\u0026#34;%s/%s\u0026#34;, $dir, $filename)); say \u0026#34;save image \u0026gt; \u0026#34; . $filename; sleep 1; }; open my $fh, \u0026#34;\u0026gt;\u0026#34;, \u0026#34;$dir/uri.txt\u0026#34; or die; print $fh $uri; close $fh; ","date":"2008-12-29T22:48:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/29/224836/","title":"google-code-prettifyを試してみた"},{"content":"遅々として進みませんが。 JSONを使って読み書きをすることにしたのですが。 そもそも、アプリケーションの設定をどう呼ぶか、とか、テンプレートからJSON等のモジュールをどうやって使うか、とかいう根本的なところで悪戦苦闘してました。 menta.cgiには、「あなたのアプリの設定」とされている部分があるのですが、それをどのようにして呼ぶのかをソースを見ながら試してみました。 どのように呼ぶのを想定しているのかは不明ですが、とりあえずの解決策としては、\n1 ? my $self = MENTA-\u0026gt;config-\u0026gt;{application} として、$selfに入れてから使うようにしました。 設定を以下のようにした場合、\n1 2 3 4 5 # あなたのアプリの設定 application =\u0026gt; { limit =\u0026gt; 30, member_filename =\u0026gt; \u0026#39;member.cgi\u0026#39;, }, それぞれ以下のようにして使えます。\n1 2 $self-\u0026gt;{limit} # 30 $self-\u0026gt;{member_filename} # member.cgi で、JSON等のモジュールをどうやって使うかですが。 とりあえず安直に考えて、\n1 ? use JSON としてから、関数形式で使うことにしました。 しかし、ここで一つ罠がありました。 JSONで使おうとした関数は「to_json」と「from_json」なのですが、単純に書いてしまうと、それぞれ、「to.pl」と「from.pl」というプラグインを探しにいってしまうのです。 まあ、関数をそのまま呼び出せないのであれば、パッケージ名をつけてやればよい、ということで、それぞれ「JSON::to_json」と「JSON::from_json」というように呼び出して解決できました。 解決したので、それはそれでよかったのですが、なんとなくプラグイン化してみました。 関数名を「json_to」と「json_from」という名前にして、「json.pl」を呼び出すようにしました。 プラグインというには微妙ですが、とりあえず機能的には問題ないということで。\napp/controller/nanochat/enter.mt\n1 2 3 4 5 6 ?= render(\u0026#39;nanochat/header.mt\u0026#39;, \u0026#39;名前を教えてほしいの。\u0026#39;) ?= render(\u0026#39;nanochat/member.mt\u0026#39;) \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;工事中なの。\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ?= render(\u0026#39;nanochat/footer.mt\u0026#39;) app/controller/nanochat/member.mt\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ? my $self = MENTA-\u0026gt;config-\u0026gt;{application} ? my $datafile = MENTA-\u0026gt;data_dir() . $self-\u0026gt;{member_filename} ? my $members = json_from(file_read($datafile)) ? my @new_members \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;今は、 ? foreach my $member (sort {$b-\u0026gt;{now} \u0026lt;=\u0026gt; $a-\u0026gt;{now}} @{$members}) { # 更新時間の新しい順でソート ? if (time - $member-\u0026gt;{now} \u0026lt; $self-\u0026gt;{limit} * 60) { # タイムアウトしていない場合 ? push @new_members, $member \u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;\u0026lt;?= $member-\u0026gt;{name} ?\u0026gt;\u0026lt;/strong\u0026gt; さんと ? } ? } \u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;なの\u0026lt;/strong\u0026gt;\u0026lt;?= @new_members ? \u0026#34; \u0026#34; : \u0026#34; だけ\u0026#34; ?\u0026gt;がいるの。\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ? file_write($datafile, json_to(\\@new_members)) plugins/json.pl\n1 2 3 4 5 6 7 package MENTA::Plugin::JSON; use MENTA::Plugin; # JSONを使う用 use JSON; sub json_to { to_json(shift) } sub json_from { from_json(shift) } 1; ","date":"2008-12-29T07:27:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/29/072702/","title":"NANOChatのMENTA化、その3"},{"content":"はてなスターは、ずっと不思議に思っていた機能なのだが、ブックマークにスターをもらったので調べてみた。\n日々ブログを読んでいていいなと思っても、コメントを書いたりトラックバックを送るのは敷居が高く、気持ちが十分に書き手に伝わらずに終わってしまうことも多いでしょう。はてなスターは既存のブログにワンクリックで☆がつけられます。あなたのいいなと思った気持ちを☆に変えて、世界のブログに☆をつけよう！\n[はてなスターはじめてガイド - Hatena Star]\n全然不思議な機能ではなかった。 私自身はこういうものをクリックするのに何故か抵抗があったのですが。 でも、自分がもらってみると嬉しいものですね。 まあ、ちょっと共感したので、さらに調べてみるとMTのプラグインに「はてなスター」を使えるようになるものがあったので導入してみました。 さて、うまくいくかな。\n参考： MTHatenaStar作った - Kickstart my heart\n","date":"2008-12-17T01:07:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/17/010753/","title":"プラグイン「MTHatenaStar」を入れてみた"},{"content":"ほんの少し進んだ。 「入口」では、今現在滞在中のメンバーを出力するわけですが、そのデータはファイルに保存しておく必要があります。 ファイルの読み書きは標準のプラグイン「file.pl」にあるので、それを使ってデータをやり取りすれば良さそうです。 さっくりとソースを見ると、ファイルの中身は一度に読み書きしているようです。 MENTAではextlibにJSONが入っているので、そいつを使う事にします。 JSONを使うとオブジェクトを文字列に変換できるので、データを保存するのが非常に簡単になります。 昔は色々と考えながらデータを書いていましたが、そんな作業からも開放されました。 今までは割と標準モジュールしか使えないという縛りがありましたが、今後はそれもなくなりますね。 ま、とりあえず簡単にサンプルを書いてみました。\nサンプルコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use strict; use warnings; use JSON; print $JSON::VERSION; print \u0026#34;\\n\u0026#34;; my $obj = { a =\u0026gt; 1, b =\u0026gt; [2, 3], c =\u0026gt; {c1 =\u0026gt; 4, c2 =\u0026gt; 5}, d =\u0026gt; 6, }; my $json_text = to_json($obj); print $json_text; print \u0026#34;\\n\u0026#34;; my $r_obj = from_json($json_text); use Data::Dumper; print Dumper($r_obj); 実行結果\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 4.02 {\u0026#34;b\u0026#34;:[2,3],\u0026#34;a\u0026#34;:1,\u0026#34;d\u0026#34;:6,\u0026#34;c\u0026#34;:{\u0026#34;c1\u0026#34;:4,\u0026#34;c2\u0026#34;:5}} $VAR1 = { \u0026#39;a\u0026#39; =\u0026gt; 1, \u0026#39;b\u0026#39; =\u0026gt; [ 2, 3 ], \u0026#39;c\u0026#39; =\u0026gt; { \u0026#39;c2\u0026#39; =\u0026gt; 5, \u0026#39;c1\u0026#39; =\u0026gt; 4 }, \u0026#39;d\u0026#39; =\u0026gt; 6 }; ","date":"2008-12-16T03:47:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/16/034725/","title":"NANOChatのMENTA化、その2"},{"content":"Perlといえば、何はなくともCPANです。 で、そのCPANには沢山のモジュールがあります。 で、そのモジュールはおおよそ決まった様式にのっとって記述されています。 そのあたりのフレームワークがPerlには用意されています。 まあ、受け売りですが。 参考： はじめてのPerlモジュール開発メモ/楽 Part1 正しいPerl/CGIの書き方：ITpro で、この記事にしたがって、正しい作成手順でモジュールを作ってみようということで試してみました。 …が、結果的には微妙なことになってしまいました。 Module::StarterとModule::Starter::PBPのインストール、そして、Module::Starter::PBPのセットアップまでは無事終了しました。 いざ、モジュールの作成です。 サンプルどおりモジュール名だけを入力してみると「authorが必須ですよ」というエラーが出た。\n1 2 3 C:\\nqou\u0026gt;module-starter --module=My::First Must specify an author at C:/strawberry/perl/site/lib/Module/Starter/App.pm line 97 Module::Starter::PBPのセットアップをするとホームディレクトリに「config」というファイルができて、起動時にそれを読み込んでくれるはずなのだが。 まあ、仕方なく、authorとemailを指定して実行した。 ファイルやディレクトリができたようなので中身を確認すると、なんだか数が足りない。 …Build.PLが無いですよ。 現在入っているPerlはActivePerlではないですが、念のため「Clone」をインストールしようとしましたが、すでに入っていました。 うーむ。 Module::Starterのバージョンが1.50でしたので、記事の当時（1.42とか1.47とか）からバージョンがあがっているのが原因なのかもしれません。 試してみたかったのに、残念。\n","date":"2008-12-16T00:58:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/16/005815/","title":"Module::StarterとかPBPとか"},{"content":"一応は宣言どおり手をつけました。 最初の画面だけですが…。\nインデックス - menta.nqou.net\nサンプルを見ながらの手探りですが、少しは作り方がわかりました。 ソースコードを見れば、作り方も自ずとわかるのでしょうが…。 今のところ拡張子は.mtの物しか使っていません。 このファイルはテンプレート扱いになるようです。 今回のポイントは主に3つ。\nひとつめ テンプレート内では、「?」から始まった行は、Perlのコードとして解釈するようです。\nheader.mt line 1.\n1 ? my $title = shift ふたつめ テンプレート内では、「?=」から始まった行は、Perlのコードとして解釈したあと、結果を埋め込むようです。\nindex.mt line 1.\n1 ?= render(\u0026#39;header.mt\u0026#39;, \u0026#39;インデックス\u0026#39;) みっつめ 行の一部で変数やコードを使うには、埋め込みが不要な場合は「\u0026lt;?」、必要な場合は「\u0026lt;?=」とで囲うようです。 また、これらは囲われた部分毎に、改行を含むような扱いになるようです。\nheader.mt line 6.\n1 \u0026lt;title\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;menta.nqou.net\u0026lt;/title\u0026gt; この上の文のコード部分は、すなわち、\n1 2 3 if ($title) { print \u0026#34;$title - \u0026#34; } のように解釈できるということです。 また、if文は後ろに置くことでブレースを省略できるので、\nheader.mt line 9.\n1 \u0026lt;h1\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; if $title ?\u0026gt;menta.nqou.net\u0026lt;/h1\u0026gt; このように書いても問題なく実行されました。 アップロードの仕方ですが、基本はオフィシャルのディレクトリ構造に書いてあるファイルをアップすればよいようです。\ntディレクトリをアップするかどうかは微妙です。 私はアップしていませんが、ちゃんと動いています。\n最終的にmentaというディレクトリを作って、その中の構成を、\n.htaccess menta.cgi app/ extlib/ lib/ plugins/ という感じにしました。 以下、ソースです。 app/controller以下のファイル構成で表記しています。\nheader.mt 1 2 3 4 5 6 7 8 9 ? my $title = shift \u0026lt;!doctype html\u0026gt; \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34; xml:lang=\u0026#34;ja\u0026#34; lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;menta.nqou.net\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; if $title ?\u0026gt;menta.nqou.net\u0026lt;/h1\u0026gt; footer.mt 1 2 3 \u0026lt;p\u0026gt;Powered by MENTA \u0026lt;?= $MENTA::VERSION ?\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; index.mt 1 2 3 4 5 ?= render(\u0026#39;header.mt\u0026#39;, \u0026#39;インデックス\u0026#39;) \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a name=\u0026#34;menta.nanochat\u0026#34; href=\u0026#34;\u0026lt;?= uri_for(\u0026#39;nanochat/index\u0026#39;) ?\u0026gt;\u0026#34;\u0026gt;NANOChat\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; ?= render(\u0026#39;footer.mt\u0026#39;) nanochat/header.mt 1 2 3 4 5 6 7 8 9 10 11 ? my $title = shift \u0026lt;!DOCTYPE html PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;\u0026lt;?= static_file_path(\u0026#39;nanochat.css\u0026#39;) ?\u0026gt;\u0026#34; title=\u0026#34;Default\u0026#34; media=\u0026#34;screen\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;ROBOTS\u0026#34; content=\u0026#34;NOINDEX\u0026#34;\u0026gt; \u0026lt;title\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;NANOChat\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body onload=\u0026#34;obj = document.forms[0];if(obj)obj.elements[0].focus();\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;nano\u0026#34;\u0026gt;\u0026lt;? if ($title) { ?\u0026gt;\u0026lt;?= \u0026#34;$title - \u0026#34; ?\u0026gt;\u0026lt;? } ?\u0026gt;NANOChat\u0026lt;/h2\u0026gt;\u0026lt;hr\u0026gt; nanochat/footer.mt 1 2 3 4 5 6 ? my $cost = sprintf \u0026#34;%.2f\u0026#34;, times \u0026lt;hr\u0026gt; \u0026lt;p class=\u0026#34;nano\u0026#34;\u0026gt;このお仕事に \u0026lt;?= $cost ?\u0026gt; 秒くらいかかったの。\u0026lt;/p\u0026gt; \u0026lt;address\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;?= uri_for(\u0026#39;#nanochat\u0026#39;) ?\u0026gt;\u0026#34; title=\u0026#34;このスクリプトの最新版はこのリンク先にあるの。\u0026#34;\u0026gt;NANOChat Ver0.12\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; nanochat/index.mt 1 2 3 4 5 6 7 8 9 10 ?= render(\u0026#39;nanochat/header.mt\u0026#39;, \u0026#39;いらっしゃいなの。\u0026#39;) \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;ここの入退室管理を任されてる \u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;なの\u0026lt;/strong\u0026gt; なの。よろしくなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;この部屋へ入るにはクッキーが必要なの。退室するときにちゃんと消してあげるから、名札だと思ってつけてほしいの。今つけた人は、ついてるかどうかわからないから1回読みなおしてほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;JavaScriptが使えると、マウスを使わなくてもチャットできるの。とってもおすすめなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;あと、$limit分くらい何も発言しないと部屋から追い出されちゃうの。気をつけてほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;あ、ホームページ（http://から書くの）とかメールアドレス（mailto:から書くの）とかを書くと、リンクしてあげるの。よくわからないから発言を全部リンクしちゃうけど、そのくらいは許してほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;準備ができたら\u0026lt;a href=\u0026#34;\u0026lt;?= uri_for(\u0026#39;nanochat/enter\u0026#39;) ?\u0026gt;\u0026#34;\u0026gt;入口\u0026lt;/a\u0026gt;で名前を教えてほしいの。\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ?= render(\u0026#39;nanochat/footer.mt\u0026#39;) ","date":"2008-12-14T03:25:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/14/032517/","title":"NANOChatのMENTA化、その1"},{"content":"（20090321追記：0.12は古いので、最新版を使いましょう。その理由）\nzipファイルは、lang_perl_MENTA_tags_release-0.12-r26594.zipになっていました。\n最近、オフィシャルにアクセスしても繋がらない事が多いです。\nで、珍しく繋がったと思ったら、今度はファイルをダウンロードするのにうまく繋がりません。\n何度もアクセスして悪いなぁ、と思ったらようやくダウンロード完了。\n誰かのために置いておきます。\nlang_perl_MENTA_tags_release-0.12-r26594.zip\nしかし、このMENTAですが、容量のほとんどがextlibに入っているモジュール群です。\n全体が3,098,390バイトに対して、extlibの中身は2,920,326バイト。\nまあ、そうやってMENTAの中ばかり見てないで、さっさと作っていきましょう。\nまた明日にでも…。\n","date":"2008-12-13T03:47:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/13/034732/","title":"今日のMENTA、3回目"},{"content":"ゴールデンロア以来、久々に面白いゲームを見つけて、今現在はまってます。\n様々なクラスにクラスチェンジできるユニットを6人までのパーティにまとめ、さらにそのパーティを同時に最大8パーティ、ひたすらダンジョンに潜らせて、キャラ育成・アイテム収集を行うゲームです。ダンジョンではパーティは自動で探索を行い、敵に出会うと自動で戦闘を行います。\n超魔宝電脳 [soft03] まほでんわーるど\nプレイヤーは最初のキャラクターでもありますが、実際にはキャラクターに指示を出すブルジョアみたいな感じです。もっとも、最初はまったくお金を持っていない状態からのスタートですが。この手のタイプのゲームだと、クラスチェンジできるレベルできっちりとクラスチェンジしたいので、ついつい頑張ってあーでもないこーでもない、と試行錯誤するのですが、その試行錯誤がとても楽しいです。\nで、プレイするのも楽しいのですが、ゲームを作っている私にとっては、このゲームのアイディアに感心しました。\n一つはもちろん、全体的なシステム。プレイヤーはキャラクターの指示係という位置づけです。サッカーの監督ゲームの様な感じでしょうか。キャラクターには「退却」以外の命令ができませんので、ダンジョンを進んだり戦闘したりするのは全て自動です。このゲームはオンラインゲームではありませんが、プレイヤーがキャラクターに命令して、キャラクターがリアルタイムで動く、というのは、オンラインゲームでも使える手法です。ゴールデンロアも、方針を入力しておけば、あとは自動で冒険に出発してくれるオンラインゲームでした。\nもう一つはダンジョンのシステム。ダンジョンのエリアは「広さ」と「敵の多さ」という二つのパラメータで表現しています。この二つのパラメータと「エリアの数」でダンジョンのバリエーションが驚くほど豊富になります。「広さ」は、次のエリアに行く「階段」を見つける確率に影響します。最後のエリアで「階段」を見つけると、そのダンジョンをクリアした事になります。「敵の多さ」は、敵に遭遇する確率で、敵を倒すとそのエリアで敵に遭遇する確率が下がっていきます。そして、ダンジョンをクリアすると「敵の多さ」が少し回復します。\nこの単純なことで、\nクリアするまでは徐々に難易度が下がっていき、 クリアすればするほど難易度の高い状態に維持される、 のです。面白い仕組みです。\nこのダンジョンのシステムは何かの機会で使ってみたいですね。\n","date":"2008-12-13T00:46:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/13/004647/","title":"まほでんわーるどが面白い"},{"content":"WindowsでPerlというと、ActivePerlしか知らなかったのですが、今日、もう一つのPerlを知りました。\nそれが、StrawberryPerlです。\n「perl -V」した結果は続きのほうに書いておきます。\n「Win32 Perl Wiki」によれば、Cコンパイラも一緒についているので、CPANが余裕で使えるとのこと。\nそれを知った瞬間に乗換確定でした。\nIf you are already experienced with Perl on Unix and it\u0026rsquo;s just Windows you aren\u0026rsquo;t comfortable with, then you are almost certainly going to want to use Strawberry Perl which is the closest thing you will find to Perl on Unix, and is being used on a daily basis by a number of major CPAN authors and Perl personalities when they need to work on Windows. Strawberry Perl also installs a C compiler and make (software build tools), so you can download and build all 10,000 of the latest and greatest modules from the CPAN Main Page - Win32 Perl Wiki\n勝手にpathが通ってしまうので、コマンドラインからcpanすれば、すぐに使えます。\nスタートメニューにも「CPAN Client」ができるので、そちらからも使えます。\nあれだけ苦労したのは何なのかと思うほどですが、好きな場所にインストールできないのは少し残念です。\n今まではスクリプトの1行目は「#!/usr/bin/perl」でよかったのですが、「#!perl」に変更する必要がありました。\nまあ、それでもCPANが普通に使えるというのは、変えがたい魅力です。\n…と書いたところで、ふと思いついて「AN HTTPD」のPerlへのパスをショートネームで入れなおしてみたところ、この問題も無事解決できました。\n1 C:\\strawb~1\\perl\\bin\\perl.exe 「#!の行を調べる」のチェックは、忘れずにはずしておきましょう。\nこれで、心置きなく乗換ができますね。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 Summary of my perl5 (revision 5 version 10 subversion 0) configuration: Platform: osname=MSWin32, osvers=5.1, archname=MSWin32-x86-multi-thread uname=\u0026#39;\u0026#39; config_args=\u0026#39;undef\u0026#39; hint=recommended, useposix=true, d_sigaction=undef useithreads=define, usemultiplicity=define useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef use64bitint=undef, use64bitall=undef, uselongdouble=undef usemymalloc=n, bincompat5005=undef Compiler: cc=\u0026#39;gcc\u0026#39;, ccflags =\u0026#39; -s -O2 -DWIN32 -DHAVE_DES_FCRYPT -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -fno-strict-aliasing -DPERL_MSVCRT_READFIX\u0026#39;, optimize=\u0026#39;-s -O2\u0026#39;, cppflags=\u0026#39;-DWIN32\u0026#39; ccversion=\u0026#39;\u0026#39;, gccversion=\u0026#39;3.4.5\u0026#39;, gccosandvers=\u0026#39;\u0026#39; intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234 d_longlong=undef, longlongsize=8, d_longdbl=define, longdblsize=12 ivtype=\u0026#39;long\u0026#39;, ivsize=4, nvtype=\u0026#39;double\u0026#39;, nvsize=8, Off_t=\u0026#39;long long\u0026#39;, lseeksize=8 alignbytes=8, prototype=define Linker and Libraries: ld=\u0026#39;g++\u0026#39;, ldflags =\u0026#39;-s -L\u0026#34;C:\\strawberry\\perl\\lib\\CORE\u0026#34; -L\u0026#34;C:\\strawberry\\c\\lib\u0026#34;\u0026#39; libpth=C:\\strawberry\\c\\lib libs= -lmsvcrt -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 perllibs= -lmsvcrt -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 libc=-lmsvcrt, so=dll, useshrplib=true, libperl=libperl510.a gnulibc_version=\u0026#39;\u0026#39; Dynamic Linking: dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=\u0026#39; \u0026#39; cccdlflags=\u0026#39; \u0026#39;, lddlflags=\u0026#39;-mdll -s -L\u0026#34;C:\\strawberry\\perl\\lib\\CORE\u0026#34; -L\u0026#34;C:\\strawberry\\c\\lib\u0026#34;\u0026#39; Characteristics of this binary (from libperl): Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT PERL_IMPLICIT_SYS PERL_MALLOC_WRAP PL_OP_SLAB_ALLOC USE_ITHREADS USE_LARGE_FILES USE_PERLIO Built under MSWin32 Compiled at Oct 19 2008 15:47:04 @INC: C:/strawberry/perl/lib C:/strawberry/perl/site/lib . ","date":"2008-12-12T22:11:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/12/221128/","title":"さようなら、ActivePerl。こんにちは、StrawberryPerl。"},{"content":"zipファイルは、lang_perl_MENTA_tags_release-0.09-r25814.zipになっていました。 マニュアルとデモとが分かれています。 マニュアルのほうには、実際のサーバーで使うためのアップロード方法だけでなく、ディレクトリ構造も紹介されています。 デモのほうは、（個人的に必須な）Session管理のデモもありました。 そろそろ何か作りたくなってきました。 今見るととても恥ずかしいですが、Perlを覚えたての頃に作った、HTMLの出力にこだわったチャットがあります。 今となっては、スタイルシートでレイアウトするのは当たり前ですが、この当時はスタイルシートもブラウザの実装が中途半端で使う人も少なかったんじゃないかと思います。 まあ、そんな遺物をMENTAを使って書き直してみようかなと、ふと思いました。 使い道があるのかと訊かれれば、まずないでしょうが。 そんな昔に書いたソースコードを、恥ずかしげもなく「続き」に書いてみました。 perltidyで味付けはしましたが。 コメントが痛々しいですが、当時はこういうテーマも面白いなという思い付きだったので大目に見ましょう。 ファイル構成 nanochat.cgi (705) : メインスクリプト main.log (606) : 会話記録用ファイル member.log (606) : メンバー記録用ファイル nanochat.css (604) : スタイルシート main.logとmember.logは空ファイルでOK（のはず）。 サンプル nanochat.cgi\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 #!/usr/bin/perl # ↑は「#!/usr/local/bin/perl」が一般的みたいなの。 # 動かないときはプロバイダに訊くの。 #BEGIN{ # print \u0026#34;Content-type: text/plain\\n\\n\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); # $|=1; #} # ↑はエラーが出て困った時にコメントを外すの。 require 5.005; use strict; # ↑はさわったらだめなの。 # いくつか設定することがあるの。 my @max_list = qw(10 20 30 40 50); # 入口では表示する件数を選べるの。 # ここに書いたのがドロップダウンに表示されるの。 # でも、あんまり大きい数はいやなの。 # 数字以外も書けるけど、書いたらいやなの。 my $return_uri = \u0026#39;../nanochat.htm\u0026#39;; # 「戻るの。」でリンクする場所を決める事ができるの。 my $ss_uri = \u0026#39;./nanochat.css\u0026#39;; # スタイルシートの場所なの。 # このファイルはスクリプトと同じ場所だと効かない事があるらしいの。 # そういう人はスタイルシートを他の場所において、ここを変えるの。 # その時は「http://」から書いたほうが確実なの。 my $timeout = 1800; # 書込みしてない人はクッキーの期限が切れるの。 # その時間を決める事ができるの。単位は秒なの。 my $main_log = \u0026#39;./main.log\u0026#39;; # 会話の中身を記録するファイルの名前なの。 # 最初はこの名前だから、そのまま使うときは変えなくてもいいの。 my $member_log = \u0026#39;./member.log\u0026#39;; # 誰が居るかを記録するファイルの名前なの。 # 最初はこの名前だから、そのまま使うときは変えなくてもいいの。 my $nano = \u0026#39;なの\u0026#39;; # これを変えたらなのじゃなくなるの。でもべつにいいの。 my $script_uri = $ENV{SCRIPT_NAME} || \u0026#39;./nanochat.cgi\u0026#39;; # このファイルの名前を変えたら、右側の方にその名前を書くの。 # ここから・・・ my $msg_max = ( sort { $b \u0026lt;=\u0026gt; $a } @max_list )[0]; my $msg_min = ( sort { $a \u0026lt;=\u0026gt; $b } @max_list )[0]; my $script_name = \u0026#39;NANOChat\u0026#39;; my $print_str = \u0026#39;\u0026#39;; my $print_header = \u0026#39;\u0026#39;; my %members = (); my %ip = (); my @logs = (); my @logs_now = (); # ここまでは変えたらいやなの。 # お仕事できなくなるの。 check_env(); # ↑はうまく動くか試してるの。ちゃんと動いたら消してもいいの。 # 心配な人は消さなくてもいいの。 # ここから最後までは細かい事をやってるの。 # わからない人はさわったらダメなの。 main(); print_exit(); sub main { my $cookie = get_cookie(); # HTMLのチェック用なの。 # $cookie = \u0026#39;,10\u0026#39;; # $cookie = \u0026#39;61,10\u0026#39;; # $ENV{QUERY_STRING} = \u0026#39;logout=1\u0026#39;; # ここまでなの。でも、下のほうにもう少しあるの。 if ( defined $cookie ) { my ( $name, $tmp ) = split /,/, $cookie, 3; if ($name) { $name = pack( \u0026#34;H*\u0026#34;, $name ); check_max($tmp); } my %form = (); # (ua =\u0026gt; $ENV{HTTP_USER_AGENT}); foreach ( split /[\u0026amp;;]/, $ENV{QUERY_STRING} ) { my ( $key, $value ) = split /=/, $_, 2; if ( $value =~ /[%\\+]/ ) { my $space = \u0026#34;(?:\\xA1\\xA1)\u0026#34;; $value =~ tr/+/ /; $value =~ s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;H2\u0026#34;, $1)/eg; $value =~ s/\u0026amp;/\u0026amp;amp;/g; $value =~ s/\u0026lt;/\u0026lt;/g; $value =~ s/\u0026gt;/\u0026gt;/g; $value =~ s/\\t/ /g; $value =~ s/^(\\s|$space)+//o; $value =~ s/(\\s|$space)+$//o; $value =~ s/ / \u0026amp;nbsp;/g; $value =~ tr/\\x0D\\x0A//d; } $form{$key} = $value; } member_read(); # HTMLチェック用なの。 # $members{\u0026#39;a\u0026#39;} = time; $ip{\u0026#39;a\u0026#39;} = \u0026#39;127.0.0.1\u0026#39;; # これだけなの。 if ( exists $form{logout} ) { ref_logout( \\%form, $name ); print_exit(); } elsif ( exists $form{login} and $name eq \u0026#39;\u0026#39; ) { ref_login( \\%form ); $name = $form{n}; check_max( $form{max} ); } log_read(); if ($name) { $form{msg} ne \u0026#39;\u0026#39; and ref_make_log( \\%form, $name ); my $cname = unpack( \u0026#34;H*\u0026#34;, $name ); $print_header = \u0026#34;Set-Cookie: $script_name=$cname,$msg_max; expires=\u0026#34; . gmtime( time + $timeout ) . \u0026#34;\\n\u0026#34;; reload($name); } else { stock_header(\u0026#39;名前を教えてほしいの。\u0026#39;); stock_member(); my $sel = qq(\u0026lt;select name=\u0026#34;max\u0026#34;\u0026gt;); my $sd = qq( selected); foreach (@max_list) { $sel .= qq(\u0026lt;option value=\u0026#34;$_\u0026#34;$sd\u0026gt;$_ 件\u0026lt;/option\u0026gt;); $sd = \u0026#39;\u0026#39;; } $sel .= \u0026#39;\u0026lt;/select\u0026gt;\u0026#39;; $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;form method=\u0026#34;get\u0026#34; action=\u0026#34;$script_uri\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;n\u0026#34; size=\u0026#34;20\u0026#34; maxlength=\u0026#34;20\u0026#34; tabindex=\u0026#34;1\u0026#34;\u0026gt; ←ここに名前を書いてほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;書いたら、表示するメッセージ数を $sel にして \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;部屋に入るの。\u0026#34; tabindex=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;login\u0026#34; value=\u0026#34;1\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;logout\u0026#34; value=\u0026#34;やっぱり帰るの。\u0026#34; tabindex=\u0026#34;3\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/form\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;hr\u0026gt; EOM stock_log($msg_min); stock_footer(); } } else { $print_header = \u0026#34;Set-Cookie: $script_name=,10; expires=\u0026#34; . gmtime( time + $timeout ) . \u0026#34;\\n\u0026#34;; stock_header(\u0026#39;いらっしゃいなの。\u0026#39;); my $limit = int( $timeout / 60 ); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;ここの入退室管理を任されてる \u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$nano\u0026lt;/strong\u0026gt; なの。よろしくなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;この部屋へ入るにはクッキーが必要なの。退室するときにちゃんと消してあげるから、名札だと思ってつけてほしいの。今つけた人は、ついてるかどうかわからないから１回読みなおしてほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;JavaScriptが使えると、マウスを使わなくてもチャットできるの。とってもおすすめなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;あと、$limit分くらい何も発言しないと部屋から追い出されちゃうの。気をつけてほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;あ、ホームページ（http://から書くの）とかメールアドレス（mailto:から書くの）とかを書くと、リンクしてあげるの。よくわからないから発言を全部リンクしちゃうけど、そのくらいは許してほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;準備ができたら\u0026lt;a href=\u0026#34;$script_uri\u0026#34;\u0026gt;入口\u0026lt;/a\u0026gt;で名前を教えてほしいの。\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; EOM stock_footer(); } } sub member_read { open IN, $member_log or die; my $member = \u0026lt;IN\u0026gt;; my $ip = \u0026lt;IN\u0026gt;; close IN; chomp $member; chomp $ip; %members = split /\\t/, $member; %ip = split /\\t/, $ip; foreach ( keys %members ) { if ( $timeout \u0026lt; time - $members{$_} ) { delete $members{$_}; delete $ip{$_}; } } } sub member_write { my $member = join( \u0026#34;\\t\u0026#34;, %members ); my $ip = join( \u0026#34;\\t\u0026#34;, %ip ); open OUT, \u0026#34;\u0026gt; $member_log\u0026#34; or die; print OUT $member . \u0026#34;\\n\u0026#34;; print OUT $ip . \u0026#34;\\n\u0026#34;; close OUT; } # ファイルを最後の方から読むの。 # Perlメモ（http://www.din.or.jp/~ohzaki/perl.htm）を参考にしたの。 # でも、ほとんどそのままなの。 sub log_read { my $bufsize = 1024; my $pos = 0; open IN, $main_log or die; binmode(IN); my $size = ( -s IN ) / $bufsize; $pos += $size \u0026lt;=\u0026gt; ( $pos = int($size) ); my $buf_tmp = \u0026#39;\u0026#39;; while ( $pos-- ) { my $buf = \u0026#39;\u0026#39;; my @lines = (); seek( IN, $bufsize * $pos, 0 ); read( IN, $buf, $bufsize ); $buf .= $buf_tmp; ( $buf_tmp, @lines ) = $buf =~ /[^\\x0D\\x0A]*\\x0D?\\x0A?/g; pop(@lines); unshift( @logs, @lines ); next if @logs \u0026lt; $msg_max; last; } close IN; unshift( @logs, $buf_tmp ) if $buf_tmp; # 最後まで読んでる事も多いから必要なの。 # @logs = @logs[-$msg_max .. -1] if @logs \u0026gt; $msg_max; # 本当は余ったら切らないといけないの。 # でも、表示する時に切るから放っておくの。 } sub log_write { open OUT, \u0026#34;\u0026gt;\u0026gt; $main_log\u0026#34; or die; seek OUT, 0, 2; print OUT \u0026#34;$_\\n\u0026#34; foreach reverse @logs_now; close OUT; return if %members; $msg_max = ( sort { $b \u0026lt;=\u0026gt; $a } @max_list )[0]; @logs = (); log_read(); open OUT, \u0026#34;\u0026gt; $main_log\u0026#34; or die; foreach (@logs) { tr/\\x0D\\x0A//d; $_ or next; print OUT \u0026#34;$_\\n\u0026#34;; } close OUT; } sub ref_login { my ($f) = @_; $f-\u0026gt;{n} or error_exit(\u0026#34;名前を教えてほしいって言ってるの。名無しさんはいやなの。\u0026#34;); $f-\u0026gt;{n} eq $nano and error_exit( qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$f-\u0026gt;{n}\u0026lt;/strong\u0026gt; はわたしなの。同じ名前はいやなの。) ); exists $members{ $f-\u0026gt;{n} } and $ip{ $f-\u0026gt;{n} } ne $ENV{REMOTE_ADDR} and error_exit( qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$f-\u0026gt;{n}\u0026lt;/strong\u0026gt; さんはもういるの。名前を変えてほしいの。) ); $members{ $f-\u0026gt;{n} } = time; exists $ip{ $f-\u0026gt;{n} } and return; $ip{ $f-\u0026gt;{n} } = $ENV{REMOTE_ADDR}; ref_make_log( { msg =\u0026gt; qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$f-\u0026gt;{n}\u0026lt;/strong\u0026gt; さんが入室したの。仲良くしてなの。), }, $nano ); } sub ref_logout { my ( $f, $name ) = @_; $print_header = \u0026#34;Set-Cookie: $script_name=,0; expires=Sat Jan 1 00:00:00 2000\\n\u0026#34;; if ( delete $members{$name} and delete $ip{$name} ) { ref_make_log( { msg =\u0026gt; qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$name\u0026lt;/strong\u0026gt; さんが退室したの。ちょっと淋しいの。), }, $nano ); %members or ref_make_log( { msg =\u0026gt; \u0026#39;誰もいなくなったの。淋しいの。\u0026#39;, }, $nano ); stock_header(\u0026#39;ばいばいなの。\u0026#39;); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$name\u0026lt;/strong\u0026gt; さん、ありがとうなの。また来てほしいの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;そういえば、ブラウザに履歴がいっぱいあると思うの。ごめんねなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;$return_uri\u0026#34;\u0026gt;戻るの。\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; EOM log_write(); member_write(); stock_footer(); } else { stock_header(\u0026#39;残念なの。\u0026#39;); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;今度はちゃんと入ってほしいの。また来てなの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;$return_uri\u0026#34;\u0026gt;戻るの。\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; EOM stock_footer(); } } sub get_cookie { return undef unless my $http_cookie = $ENV{HTTP_COOKIE}; $http_cookie =~ tr/ //d; foreach ( split( /;/, $http_cookie ) ) { my ( $key, $value ) = split( /=/, $_, 2 ); next if $key ne $script_name; return $value; } return undef; } sub ref_make_log { my ( $f, $name ) = @_; my $str = \u0026#39;\u0026#39;; my @date = localtime; if ( index( $f-\u0026gt;{msg}, \u0026#34;http://\u0026#34; ) == 0 or index( $f-\u0026gt;{msg}, \u0026#34;mailto:\u0026#34; ) == 0 ) { $f-\u0026gt;{msg} = qq(\u0026lt;a href=\u0026#34;$f-\u0026gt;{msg}\u0026#34;\u0026gt;$f-\u0026gt;{msg}\u0026lt;/a\u0026gt;); } $f-\u0026gt;{msg} .= sprintf \u0026#34; \u0026lt;small\u0026gt;(%ld/%02d/%02d %02d:%02d:%02d)\u0026lt;/small\u0026gt;\u0026#34;, $date[5] + 1900, $date[4] + 1, @date[ 3, 2, 1, 0 ]; if ( $name eq $nano ) { $str = qq(\u0026lt;p class=\u0026#34;nano\u0026#34;\u0026gt;); } else { $str = \u0026#34;\u0026lt;p\u0026gt;\u0026#34;; $members{$name} = time; } unshift @logs_now, qq($str\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$name\u0026lt;/strong\u0026gt; ： $f-\u0026gt;{msg}\u0026lt;/p\u0026gt;); } sub reload { stock_header( $nano . \u0026#39;チャットなの。\u0026#39; ); stock_member(); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;form method=\u0026#34;get\u0026#34; action=\u0026#34;$script_uri\u0026#34;\u0026gt; \u0026lt;p\u0026gt;あなたは \u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$_[0]\u0026lt;/strong\u0026gt; さんなの。改行するとたぶん送信するの。何も書いてない時は再読込になるの。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;msg\u0026#34; size=\u0026#34;80\u0026#34; value=\u0026#34;\u0026#34; tabindex=\u0026#34;1\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;送信するの。\u0026#34; tabindex=\u0026#34;2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;logout\u0026#34; value=\u0026#34;退室するの。\u0026#34; tabindex=\u0026#34;3\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/form\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;hr\u0026gt; EOM stock_log($msg_max); stock_footer(); if (@logs_now) { log_write(); member_write(); } } sub stock_member { my $cnt = 0; $print_str .= qq(\u0026lt;p class=\u0026#34;nano\u0026#34;\u0026gt;今は、 ); foreach ( sort { $members{$b} \u0026lt;=\u0026gt; $members{$a} } keys %members ) { $print_str .= qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$_\u0026lt;/strong\u0026gt; さんと ); ++$cnt; } my $only = $cnt ? \u0026#34; \u0026#34; : \u0026#34; だけ\u0026#34;; $print_str .= qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$nano\u0026lt;/strong\u0026gt;$onlyがいるの。\u0026lt;/p\u0026gt;\\n); } sub stock_log { my $cnt = 0; @logs_now or @logs or return; $print_str .= qq(\u0026lt;div class=\u0026#34;logs\u0026#34;\u0026gt;); foreach ( @logs_now, reverse @logs ) { $_[0] \u0026lt; ++$cnt and last; tr/\\x0D\\x0A//d; $print_str .= $_; } $print_str .= \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } sub stock_header { $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;!DOCTYPE html PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$ss_uri\u0026#34; title=\u0026#34;Default\u0026#34; media=\u0026#34;screen\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;ROBOTS\u0026#34; content=\u0026#34;NOINDEX\u0026#34;\u0026gt; \u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body onload=\u0026#34;obj = document.forms[0];if(obj)obj.elements[0].focus();\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;nano\u0026#34;\u0026gt;$_[0]\u0026lt;/h2\u0026gt;\u0026lt;hr\u0026gt; EOM } sub stock_footer { my $cost = sprintf \u0026#34;このお仕事に %.2f 秒くらいかかったの。\u0026#34;, times; my $copy = qq(\u0026lt;a href=\u0026#34;http://www.age.ne.jp/x/nobu3/perl/nanochat.htm\u0026#34; title=\u0026#34;このスクリプトの最新版はこのリンク先にあるの。\u0026#34;\u0026gt;$script_name Ver0.12\u0026lt;/a\u0026gt;); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;hr\u0026gt; \u0026lt;p class=\u0026#34;nano\u0026#34;\u0026gt;$cost\u0026lt;/p\u0026gt; \u0026lt;address\u0026gt;$copy\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOM } sub error_exit { $print_str = \u0026#39;\u0026#39;; stock_header(\u0026#39;そんな事したらダメなの。\u0026#39;); $print_str .= \u0026lt;\u0026lt;EOM; \u0026lt;div class=\u0026#34;nano\u0026#34;\u0026gt; \u0026lt;p\u0026gt;$_[0]\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;お仕事の邪魔しないでほしいの。\u0026lt;a href=\u0026#34;$script_uri\u0026#34;\u0026gt;入口まで戻るの。\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; EOM stock_footer(); print_exit(); } sub print_exit { $print_str =~ tr/\\x0D\\x0A//d; print \u0026#34;Content-Type: text/html; charset=euc-jp\\n\u0026#34;; print \u0026#34;Content-Language: ja\\n\u0026#34;; print \u0026#34;Content-Script-Type: text/javascript\\n\u0026#34;; print \u0026#34;Content-Style-Type: text/css\\n\u0026#34;; print \u0026#34;Pragma: no-cache\\n\u0026#34;; print \u0026#34;Cache-Control: no-cache\\n\u0026#34;; $print_header and print $print_header; printf \u0026#34;Content-Length: %ld\\n\u0026#34;, length $print_str; print \u0026#34;\\n\u0026#34;; print $print_str; exit; } sub check_max { my ($num) = @_; $num = $msg_min if $num =~ /\\D/; $msg_max = $msg_max \u0026lt; $num ? $msg_max : $num \u0026lt; $msg_min ? $msg_min : $num; } sub check_env { my $str = \u0026#39;\u0026#39;; -r $main_log or $str .= $main_log . \u0026#39;が読めないの。\u0026lt;br\u0026gt;\u0026#39;; -w $main_log or $str .= $main_log . \u0026#39;に書けないの。\u0026lt;br\u0026gt;\u0026#39;; -r $member_log or $str .= $member_log . \u0026#39;が読めないの。\u0026lt;br\u0026gt;\u0026#39;; -w $member_log or $str .= $member_log . \u0026#39;に書けないの。\u0026lt;br\u0026gt;\u0026#39;; ord(\u0026#39;漢\u0026#39;) == 0xb4 or $str .= qq(\u0026lt;strong class=\u0026#34;name\u0026#34;\u0026gt;$nano\u0026lt;/strong\u0026gt; は、eucが好きなの。変えてほしいの。\u0026lt;br\u0026gt;); $str and error_exit($str); } __END__ Ver 0.10 (2000/12/27) 公開版。 Ver 0.11 (2001/04/19) 入室時の２重投稿チェックをして入室ミスをなるべく防ぐようにした。 ログの表示件数を正確にした。 URIとMailに自動リンク。ただしとっても手抜き。 出力するHTMLをHTML4.01Strict相当にした。 Ver 0.12 (2001/04/26) 名前の変更ができてしまうのを修正。 最大表示件数のチェックを強化。 ロボット対策をつけた。 スタイルシートを若干変更。 nanochat.css\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 /***********************/ /* for NANOChat */ /* Designed by NANO(?) */ /***********************/ body{ color: #642; background-color: #fed; } a:link{ color: #c36; } a:visited{ color: #63c; } a:active, a:hover{ color: #f63; text-decoration: none; } .nano{ color: #862; } .name{ color: #621; } h2, form{ margin: 1px 5px; } p{ margin: 1px 5px; text-indent: 0.6em; } input{ margin: 0; text-indent: 0; } div.logs p{ padding: 1px 5px; border-width: 0px 0px 1px 0px; border-style: solid; border-color: #9cf; } small{ font-size: 80%; color: #ac8; } address{ text-align: right; font-size: 80%; font-family: \u0026#34;Times New Roman\u0026#34;, Times, serif; } ","date":"2008-12-04T03:19:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/12/04/031935/","title":"今日のMENTA、2回目"},{"content":"zipファイルは、lang_perl_MENTA_tags_release-0.05-r24525.zipになっていました。 ぱっと見では、リンクの仕方が変わったような？ \u0026hellip;と思ったのですが。 今のところ、変わったのはオフィシャルだけのようです。 cgi-serverで起動したところ、どちらも同じ挙動でした。 しかし、結構warningが出ているようです。\nコマンドプロンプトが文字化けしていたので、一旦ctrl+cで止めて、コマンドプロンプトの文字コードの変更を参考にして「chcp 65001」とタイプして、utf-8を表示できるようにしました。 うちの環境では、コマンドプロンプトを「MS ゴシック」に設定したあとは、コマンドプロンプトを立ち上げて、すぐに「chcp 65001」とすると「MS ゴシック」のまま切り替わるようです。 レジストリの「HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Console\\TrueTypeFont」のあたりを色々といじって試してみましたが、うまくいかず、断念。\nま、それはそれとして。 エラーの正体は以下のとおり。\n1 static/menta-logo.png/ を処理する方法がわかりません at lib/MENTA.pm line 96, \u0026lt;DATA\u0026gt; line 16. ということで、app/tmpl/header.mtの6行目にゴミ（後ろにスラッシュの文字）が入っていたようです。 以下のように直したら上記のエラーはなくなりました。\n1 \u0026lt;img src=\u0026#34;\u0026lt;?= static_file_path(\u0026#39;menta-logo.png\u0026#39;) ?\u0026gt;\u0026#34; alt=\u0026#34;Web Application Framework - MENTA\u0026#34; title=\u0026#34;Web Application Framework - MENTA\u0026#34; /\u0026gt; ","date":"2008-11-21T03:00:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/21/030015/","title":"今日のMENTA"},{"content":"MTでつけたタグを管理するのにも丁度良いので、HatenaBookmarkerプラグインを使って、ブログ記事をはてなブックマークに登録しているのだが、最近、余計な仕事もしてくれているようだ。 トラックバックを受け取ったときに、その記事をブックマークしにいくのだ。 しかも、なぜかパーマリンクが間違って（ファイル名が日付と時間になって）いる。\n解決できないかとソースを見ているのだが、さっぱりわからない。 トラックバックを受け取ったときに動作しないようにできればまったく問題ないとは思うのだが\u0026hellip;。 お手上げ。\n","date":"2008-11-21T01:14:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/21/011411/","title":"MTのプラグイン(hatenabookmarker)で困ったことが起きている"},{"content":"Perlでもなんでも、ソースをブログに載せるときは気をつけたいもの。 ファイルを見ると、2年前から使っている自分用のツールがある。\n「\u0026lt;」や「\u0026gt;」など、HTMLでそのまま表示できないものを実体参照に変更したり、preとcodeで括ってソースとして表示しやすくするためのものだ。 少し前に、perltidyを覚えたのだが、ブランクがあいていたのと、パソコンを変えていたので、改めてインストールすることにした。 自分の記事も役に立つものです。\nただ、以前と違っていたのは、perlと同じbinフォルダではなく、site/binのほうに入っていた。 で、ソースがきれいにハイライトされているページをちらほら見かけたので、色気づいて調べてみた。\nとりあえず簡単にできそうだったのが、Quick Highlighterというサイト。 というわけで。 euc2utf8.plをperltidyで整形して、Quick Highlighterでハイライトさせてみた。\n\u0026hellip;しかし、スタイルシートが競合するのか、ブログ上で見るといまいちかなぁ\u0026hellip;。 もう少し調べてみよう。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 #!/usr/bin/perl use strict; use warnings; use Fatal qw/open close/; use Encode; use Encode::Guess qw/euc-jp shiftjis 7bit-jis/; use File::Find::Rule; my $rule = File::Find::Rule-\u0026gt;new; $rule-\u0026gt;file; $rule-\u0026gt;name(\u0026#39;\\*.cgi\u0026#39;, \u0026#39;\\*.pm\u0026#39;); my @files = $rule-\u0026gt;in(\u0026#39;.\u0026#39;); foreach my $file (@files) { print $file . \u0026#34;\\n\u0026#34;; euc2utf8($file); } sub euc2utf8 { my $filename = shift; if (-f $filename) { my $fh; open $fh, \u0026#34;\u0026lt;\u0026#34;, $filename; my $doc; { local $/ = undef; $doc = \u0026lt;$fh\u0026gt;; } close $fh; my $enc = guess_encoding($doc); ref($enc) or die \u0026#34;Can\u0026#39;t guess: $enc\u0026#34;; open $fh, \u0026#34;\u0026gt;\u0026#34;, $filename . \u0026#34;.utf8\u0026#34;; Encode::from_to($doc, $enc, \u0026#34;utf8\u0026#34;); print $fh $doc; close $fh; } } ","date":"2008-11-21T00:52:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/21/005233/","title":"Perlのソースをブログに書くために"},{"content":"久しぶりに知的活動（？）をしていたら、面白そうなものを見つけた。\nMENTA は CGI で気軽につかえるウェブアプリケーションフレームワークです\nCGI でも高速に動作 レンタルサーバーでもつかえます(ロリポとかXREAとか) Object 指向がわからなくてもつかえます 正しいプログラミングスタイルが自然と身につきます [MENTA]\n数日間追いかけていたのだが、今日、zipファイルでダウンロードできるようになっていたので、早速ダウンロードしてWindows上で使ってみた。 使ってみた、というか、デモをそのまま動かしてみた、というか。 まあ、久しぶりにPerlな気分の時に見つけたので、しばらく追いかけてみようかと。 XREAでも使えそうなので損はなさそうです。\nこのフレームワークは、日々更新されているようです。 リンク先もオフィシャルかどうかは不明です。\n開発者による発表：MENTA というウェブアプリケーションフレームワークをかいてみた - TokuLog 改めB日記\nさて、では使えるようになるまでの手順。 とりあえず、Perlは必須です。私はActivePerlを入れています。 説明が面倒なので、Perl.exeへのパスが通っているものとして書いていきます。 この辺の意味がわからない人は、おそらくパスは通っていると思いますので問題ないでしょう。 最初にダウンロードです。 Linux等ではsubversionというソフトを使って最新の状態にすることも出来ますが、あくまでWindowsの人っぽく行きましょう。 オフィシャルと思われるサイトからインストール方法のページへ行きます。\n開発版スナップショットのダウンロード\n[インストール方法 - MENTA]\nそして、開発版スナップショットをダウンロードします。 今日の時点では「こちら」というのがリンクになっています。 ダウンロードすると「lang_perl_MENTA_tags_release-0.03-r24357.zip」というファイルができました。 今度はこれを解凍します。 解凍がわからない人は適当に調べてください。 解凍したあとは実行あるのみ。 コマンドプロンプトを開いて（ファイル名を指定して実行…で「cmd」とか）、先ほど解凍したフォルダの中へ入っていきます。 lang\\perl\\MENTA\\tags\\release-0.03 ここまで来ると、binフォルダやmenta.cgi等が見えてきますが、とりあえず我慢して、開発用のサーバを起動させます。\n1 ...lang\\perl\\MENTA\\tags\\release-0.03\u0026gt;perl bin/cgi-server.pl そうすると、しばらくして、\n1 HTTP::Server::Simple: You can connect to your server at http://localhost:5555/ という状態になると思います。\nそうなったら、今度はブラウザを立ち上げて、「http://localhost:5555」にアクセスします。 すると、そこにはオフィシャルと同じような画面が出てきます。 簡単ですね。 しかし、まだ環境ができただけで開発は一つもやってません。 そもそも、この手のフレームワークでプログラミングをやったことがないので、一から覚えることになるでしょう。 Catalystの時も、本に載っていたとおりやったら、気がついたらできていたという感じでした。 何故できたのかが理解できなくて、結局調べようもなく、使ってもいないまま今に至る感じです。 MENTAに関しては、そうならない様に追いかけて「正しいプログラミングスタイル」を身に着けたいと思います。\n","date":"2008-11-20T01:33:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/20/013321/","title":"Perlの超軽量フレームワーク「MENTA」を追っかける"},{"content":"スクリプトのutf8化計画に役立つであろうコードを書いた。 スクリプトのあるディレクトリ以下のファイルを走査して、ファイルの文字コードをeuc-jpからutf8に変換するスクリプトだ。 それにしても、作るのに妙に時間がかかった。 徐々に勘を取り戻せればいいのだけど…。\nで、色々と調べながら書いていたら、面白いモジュールを色々と見つけた。\nFatal が、渡されたサブルーチン（上の例だと open と close）をくるんで、自動で or die してくれます。 open や close がだいぶすっきりしました。あとついでに先ほどの例に対してファイルハンドルを変数にしたり open を3引数にと今風に変更してみてあります。 use Fatal; - 今日のCPANモジュール\nまずはFatal。使いどころは結構あると思う。 ついでに、今までファイルを扱うときは、FileHandleを使っていたのだが、「今風」にしてみた。\nFile::Findの使いやすいインターフェイス File::Find::Rule File::Findの使いやすいインターフェイス - あじゃぱー\n次はFile::Find::Rule。標準モジュールではないのが残念だけど。 File::Findをうまく使えればいいんだけど、いまいち使い方がよくわからない。 ファイル一覧を作って、それを順番に処理する、という感覚なので、File::Findの\u0026amp;wantedの考え方がいまいちしっくりこない。\nperl5.8では文字コード自動判別も用意されており、Encode::Guessがそれです。 perl5.8のUnicodeサポート\nあとは、Encode関係で、Encode::Guess。文字コードの推測です。 guess_encodingという関数が自動的にインポートされるようです。 それ以外に、Encode::Guess-\u0026gt;guessとする方法もあるようですが、メンテナーは404 Blog Not Found:ruby|perl - 文字コードのちょっと高度な判定でguess_encodingを使っていました。 Encodeは、安定性重視から速度重視まで、色々なメソッドが用意されているようなので、404 Blog Not Found:perl tips - Encodeを速く使う方法も参考にしようと思っています。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 #!/usr/bin/perl use strict; use warnings; use Fatal qw/open close/; use Encode; use Encode::Guess qw/euc-jp shiftjis 7bit-jis/; use File::Find::Rule; my $rule = File::Find::Rule-\u0026gt;new; $rule-\u0026gt;file; $rule-\u0026gt;name(\u0026#39;*.cgi\u0026#39;, \u0026#39;*.pm\u0026#39;); my @files = $rule-\u0026gt;in(\u0026#39;.\u0026#39;); foreach my $file (@files) { print $file . \u0026#34;\\n\u0026#34;; euc2utf8($file); } sub euc2utf8 { my $filename = shift; if (-f $filename) { my $fh; open $fh, \u0026#34;\u0026lt;\u0026#34;, $filename; my $doc; { local $/ = undef; $doc = \u0026lt;$fh\u0026gt;; } close $fh; my $enc = guess_encoding($doc); ref($enc) or die \u0026#34;Can\u0026#39;t guess: $enc\u0026#34;; open $fh, \u0026#34;\u0026gt;\u0026#34;, $filename . \u0026#34;.utf8\u0026#34;; Encode::from_to($doc, $enc, \u0026#34;utf8\u0026#34;); print $fh $doc; close $fh; } } ","date":"2008-11-17T00:27:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/17/002723/","title":"久しぶりにPerlのコードを書いた"},{"content":"iTunesをバージョンアップしたら新機能ができていた。 というのも2ヶ月前の話。 自分自身のライブラリの中で、聴いていない曲というのもかなりあって、ライブラリの再発見というか、聴いていない（あるいは、iTunesでは聴いてないことになっている）曲から優先的聴く曲を選ぶツールとして役立っている。 まあ、曲自体が似通っているのか、好きな曲を数曲選んでGeniusにかけると、同じ曲がそれぞれのリストに入ってくるのだが。 それでも、無作為に聴くよりも好みの曲が聴ける精度は高いです。 最近は、新しい曲を聴くよりも、好きな曲ばかりを再生するようになっていますが。\n","date":"2008-11-16T17:45:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/11/16/174517/","title":"iTunes8の新機能「Genius」を使ってみた"},{"content":"先日ラスベガスに行ったときに、ラジオでかかっていて耳についた曲が「I Don\u0026rsquo;t Wanna Be In Love (Dance Floor Anthem)」だった。 オフィシャル Good Charlotte 試聴サイト MySpace.com - Good Charlotte - Waldorf, MARYLAND - Rock / Rock / Powerpop - www.myspace.com/goodcharlotte 車で移動して、もうすぐ目的地…というタイミングでよくかかっていた。 誰の曲かさっぱりわからないのだが、気になって気になって仕方なかった。 ラスベガスを離れる前に、なんとか放送局と時間から曲を探り当てたときの達成感はなんともいえなかった。 ちなみにその放送局 Mix 94.1 Today’s Best Music Mix // Las Vegas - Homepage\n","date":"2008-09-17T23:01:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/17/230104/","title":"Good Charlotte"},{"content":"長旅から帰ってきました。 とりあえず、気分も新たにデザインを変えてみました。 こういうことが簡単にできるのも、ブログシステムがあるからこそですね。 感謝です。\n","date":"2008-09-14T23:58:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/14/235855/","title":"帰着"},{"content":"公衆トイレの落書きもインターナショナルだった。 ハングルあり、英語あり、日本語あり。 英語で「独島は日本じゃない」という落書きがあった。 その下に日本語で「竹島は日本だ」という落書きがあった。 言葉だけで言えばどちらも正しい。 日本では「竹島」と呼んでいる島が、韓国では「独島」と呼ばれているのだから。 問題はそういうことではない、というのは分かっているが、もう少し頭のいい落書きはないものかと思った。\n","date":"2008-09-06T14:42:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/06/144214/","title":"トイレの落書き in NRT"},{"content":"成田空港のヤフーカフェにいます。 ラウンジオーサカに比べて、ネット環境は大分マシです。 ただ、使用頻度がかなり多いのでしょう。 キーボードの文字がかすれてしまったのか、一部に文字のシールが貼ってあります。 日本にいるのは（というか、すでに出国はしているので日本にいるのか微妙ですが）あと2時間弱となりました。 いつも思いますが、気がつくとあまり時間がなくなっている。 出国までにかなり時間がかかっているはずですが、そんなに経っているように感じないというか。 人間の感覚というのは、結構いい加減なものなのかなと。 特に時間に関しては。 改めてそう思いました。\n","date":"2008-09-06T14:15:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/06/141505/","title":"YAHOO! CAFEにて"},{"content":"ただいま伊丹空港内ラウンジオーサカ。 ここのネット環境はあまりよくないのだろうか？ 以前はそれほど感じなかったのだが、かなり遅い。 まあ、それだけです。 では、まずは羽田に向けて出発です。\n","date":"2008-09-06T08:52:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/06/085206/","title":"ラウンジオーサカにて"},{"content":"この前、作曲家の坂本龍一が出演しているテレビ番組を見た。 相変わらず番組名はわからない。 で、その中でカーボンオフセットについての話題があった。 例えば、コンサートを開くのに使った分のCO2（二酸化炭素）を吸収する分の緑を育成する費用を募金する。\n森林温暖化の防止にはCO2の排出を抑えることと同時に、森を守り育てることも重要です。森林カーボンオフセットキャンペーンは、日常生活で排出したCO2を一時的に貯蔵してもらうための森林を育てることを目的としています。\n[カーボンオフセット]\nその時に、ひとつの例としてコンサートを開く、という事に対して具体的に数字を出していたのだが、それが思った以上に安かった。 まあ、それだけ「コンサート」からは二酸化炭素が排出されない、という事なのでしょうけど。 しかし、私にはそれが釈然としなかったのです。\nそれは、お金さえ出せばいいのか？という疑問。 この言葉が私の口から出ることに違和感を持つ人もいるでしょう。 私は、お金で解決できることはお金で解決すればよい、と公言して憚らないので。\nしかし、この問題はお金で解決できる問題なのでしょうか？\nむしろ、お金を出す、という事によって、二酸化炭素を排出することの意味をすり替えるだけなのではないか？ お金を出すことで、二酸化炭素を排出することを正当化させることになるのではないか？ 排出した分はお金払ってるんだから問題ないでしょ？という意識が芽生えてしまうのではないか？ 最初に思ったのはそういうことでした。\nあと、例えばコンサートを開く場合、使うのは電気だけではありません。 機材を運んだりするのに使うトラックもその対象に含めるべきではないでしょうか？ そして、コンサートを見に来るお客さんの交通手段。 また、人間は呼吸するだけで酸素を消費し、二酸化炭素を排出します。 それらも含めると、とんでもなく大きな金額になるのではないか。\nカーボンオフセット自体を否定するつもりはありません。 まったく募金しないよりははるかにましでしょう。\nしかし、カーボンオフセットが、自然エネルギー使用することの免罪符として存在しているようで危険だなと思いました。\n","date":"2008-09-02T00:41:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/09/02/004112/","title":"カーボンオフセットへの懸念"},{"content":"コレジャナイロボは、少し前（？）にテレビで見た。 そのコレジャナイロボの商品説明には以下のようなことが書いてあるらしい。 テレビで見たときは少し違っていたと思うのだが、記憶違いもよくあることなので、あまり気にしない。\n欲しい物が何のリスクもなしに手に入るなんて話はそうはありません。 欲しい物を手に入れる為には努力も必要だという事を何らかの機会に知っておくのも良いでしょう。\n[「私が欲しかったのはコレじゃなーい！」 :: INSIGHT NOW!]\nのほほ～んと読んでいたのだが、徐々にそうもいかなくなってきた。 なかなか深い教訓があったのだ。 「コレじゃない」がわかれば、コレ以外を求める努力をしようよ。 与えられたものに不満を言うだけじゃなく、自分で手に入れることを覚えようよ。 そういうメッセージも込められているようだ。\n「何かしたいんだよねー。でも何からはじめていいか分かんないんだよねー。」 と言い続けて、何年経ちますか？\n[「私が欲しかったのはコレじゃなーい！」 :: INSIGHT NOW!]\nこのメッセージを見て、改めて考えてみた。\nなんというか、理想をずっと探していた。 現実から目をそむけて、現実ではない理想と比較しようとしていた。\nでも、形にならない理想を探しても見つかるはずもない。\nでも、それを見つかるものと信じて。\nこんな現実は間違っている、何が理想なのかはうまく言えないけど、とにかく間違っている。 って感じで。\nとにかく、今、自分の置かれている状況に不満ばかり言って、自分ができることを考えることをしなかった。\n若い頃は理想っぽい何かを語る自分自身に酔いしれていたと思う。\nでも、そうやって不満を言っていても、状況が変わるわけではない。 飲んだ席で会社に対して不満を言っていれば、誰かがその不満を解消してくれるわけでもない。 飲んだ席で社長に直談判しても、それで会社が変わったりするわけでもない。 現実というのは、そんなに簡単にはいかない。 少なくとも、うちの会社は、そんな簡単な会社ではなかった。\nそれにようやく気づいて、転職しようと思ってそういう情報を仕入れたり、転職サイトに登録してみたり。\nでも、今度は世間の現実を目の当たりにした。 理想っぽい何かを語っているうちに現実に置き去りにされていた。 一般的な転職市場は、未経験は27歳程度が上限で、経験者で35歳くらいまでというのが大半だった。 辞めても行く先がなければ、今の会社で働くしかない。\nある意味開き直ってみると、今のポジションでもやろうと思えばできること、というのは、意外と多いことに気づいた。 今は、その「できること」に力を注いでいる。 ここ最近の自分の身の回りにあったこと。 それが、コレジャナイロボの思想にあった。\n","date":"2008-08-27T23:54:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/27/235418/","title":"コレジャナイロボに深い思想を見た"},{"content":"なんというか、変な出来事があるものですね。\n最後に、消費者センターに聞いてみたところ、「こういう相談は毎年ある。大阪ガスにはこの件に関して申し入れを行うが、改善はしないだろう。事実、この件についてFAXで報告するように伝えたが8月27日現在、返答はない、無視されている」とのことです。\n[大阪ガスサービスショップを家の中に入れてはいけない - GIGAZINE]\nCMじゃないけど、オール電化にしてよかったわ～、です。\nただ、この種の問題は十分起こる可能性はあります。 関西電力でも、エコキュートや電気温水器などの販売促進のために、街の電気屋さんを使うこともあるでしょう。 このような行き過ぎた販売促進活動はやめてほしいものですね。\n","date":"2008-08-27T23:08:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/27/230806/","title":"オール電化にしてよかったと思った瞬間"},{"content":"うちのチャンネル権は常に妻が持っている。 私はテレビをあまり見ないからだ。 あまりにも頻繁に変えるので、時には文句をいうこともあるが。\n先日、いつものようにテレビを見るともなく見ていたら、普段はほとんど見ない映画を、わりと長く見ているようだった。 途中で気づいたのだが、確か少し前にテレビでこの話を見ていたような記憶があった。 たぶん、主人公である「エリン・グルーウェル」のドキュメンタリーだったのだろう。 それに気づいたあたりから、テレビのほうに集中することにした。 まあ、名前はあとで調べたのだが。 その映画番組は「フリーダム・ライターズ」だった。\n序盤のストーリーは以下のとおり。\nそんな203教室に理想に燃えた国語教師がやって来る。彼女の名はエリン・グルーウェル、23歳。弁護士になるはずが、「法廷で子供を弁護するのでは遅過ぎる。教室で子供を救うべきだ」と教師になった変り種だ。しかし、支配階級である白人の女教師など、生徒たちには別世界の住人でしかない。彼らの拒絶にショックを受けつつも、エリンは夫スコット（パトリック・デンプシー）に支えられ、詩の教材にラップを取り入れるなど努力を重ねていく。\n[映画『フリーダム・ライターズ』／\u0026ldquo;FREEDOM WRITERS\u0026rdquo;]\nそして、クラスの中で人種の違いを基にしたちょっとした事件が起こり、それをきっかけにエリンは生徒たちのことを知りたいと感じるようになった。 ある日、ラインゲームというゲームを行った。 教室の中央にテープで線を引き、質問をして当てはまるなら線の近くまで進み、そうでないなら壁際にとどまる、という単純な仕組みのゲームだ。 質問は、最初は単純なものだったが、徐々に生徒たちの生活の範囲へと及んでいく。 銃口を向けられたことがあるか、友人をギャングに殺されたことがあるか、それは二人以上か、三人以上か…。 その質問の中で、先生が生徒のことを知るだけでなく、生徒同士がお互いを見る目を変えていく。 肌の色や人種が違っていても、育った環境に大きな違いはないのだと。\nこうして人種差別がなくなったクラスの生徒と、それを成し遂げた先生が設立したのがフリーダム・ライターズ基金(Freedom Writers Foundation)だそうです。\nこのクラスが大きく方向転換したのは、ラインゲームで生徒たちがお互いのことを理解した時からだと思う。 今までの先生は、生徒を理解しようとしなかったし、生徒同士の交流については意に介さなかった。 1対多の交流は難しいのだろうが、それ以上に、その「多」同士の交流が難しい。\n後は、月並みだけど、誠意を持って人と向き合えば通じる、というか。 そういうのが、大事なんだな、と思った。\nそれにしても、この映画を見て感じたことを記録しようと思って書き始めたのだが、ぜんぜん言葉が出てこない。 自分自身が感じた事を言葉で表現できない、というのは、うまく書こう、というような気持ちがあるからかもしれない。 そういえば、昔から読書感想文とか苦手でした。 感想文じゃなくて、作者に手紙を書いてみる、というのもいいかもしれない。\n","date":"2008-08-27T00:52:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/27/005222/","title":"「フリーダム・ライターズ」を見て思ったこと"},{"content":"気づけば4.21にアップデートされていたのでアップグレード。 折角なので、前に書いた記事を検証するのも兼ねてみた。 途中、そういえば「mt-config.cgi」をコピーしていた事が抜けていた。 が、mt-wizard.cgiで自動的に設定できるので大きな問題ではない。 まあ、特殊な設定をしているのであればコピーするに越したことは無いのだが。 しかし、あいかわらずスタイル変更スクリプトはエラーになっている。 以前と同じようにStyleCatcherを入れなおして解決。 早々に修正してほしいものですね。\n","date":"2008-08-25T23:38:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/25/233836/","title":"MTOS4.21にアップグレード"},{"content":"ずっとPerlEditorを使っていたが、これからの開発はUTF-8に対応していく必要があるので、新たなエディタ探しをした。 以前から思うが、Perlで開発をする人というのは、環境にこだわらないというか、あまり特殊な環境を必要しないというか。 そんなイメージがあった。 でも、それは、私があまり環境探しをしていなかったから、ということに気づかされた。 まあ、それほどPerlEditorで十分満足していた、ということです。 で、そんなわけにもいかなくなり、探してみると、環境を探している人はいるものですね。 3年前の記事に探すものがありました。\nperl ハッカーの方々にお聞きします。近頃ますます良い感じなperlですが、どのような開発環境で開発していますでしょうか。(エディタ、そのほか) perl ハッカーの方々にお聞きします。近頃ますます良い感じなperlですが、どのような開発環境で開発していますでしょうか。(エディタ、そのほか) またお気に入りのperlモジ.. - 人力検索はてな\nというか、皆さんこのころからutf8を視野に入れていたんですね…。\nで、私がPerlEditorに惚れ込んで使っていたのは、変数エクスプローラがあるからです。 特にサブルーチンをリスト化して表示される機能は今では欠かせません。\n特にオススメなのは「変数エクスプローラ」。Perlスクリプトはテキストファイルなので、ちょっとしたプログラムでもサブルーチンの定義先や変数の使用先などが迷子になりがち。そんな時は「変数エクスプローラ」をダブルクリックするだけで、そのサブルーチン・変数を使用している場所へジャンプ!! いちいち「検索」したりする必要も無くスピーディに開発が出来るようになります。 K-COLLECT\n正直なところ、このソフトがutf8に対応してくれれば全く無問題なのですが、もう7年もソフトは更新されていませんし、掲示板もあまり管理されていないようなので、対応は期待薄だったので、そこは一応諦めました。 ということで、私が目をつけたのは「サクラエディタ」でした。 unicode版も開発されているということで、折角なのでそちらを試してみることに。\nサクラエディタUNICODE版の開発に関する主な情報を発信・管理していきます。 FrontPage - サクラエディタUNICODE化プロジェクト\n少し試してみましたが「アウトライン解析」が秀逸です。 Perlスクリプトを書いているときは、この解析でサブルーチンの一覧が表示できます。 贅沢を言えば、この解析ウィンドウが画面の左端にくっつけばいいのですが、その辺はウィンドウの大きさを変えたりすれば問題なさそうです。 しばらくは、この「サクラエディタ」を試してみようかなと。\n","date":"2008-08-25T01:21:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/25/012151/","title":"Perlスクリプトを書くエディタを探して三千里"},{"content":"とあるメールマガジンの中で、記憶に留めておきたい事が書いてあったので引用。\n言わば、“事あれ主義”です。\n[“事あれ主義”たれ - ビジネス発想術 - 転職のまぐまぐ！]\nこれを実践するためのポイントは以下の二つである、と書いています。 - 失敗を恐れないこと - 考えないこと\n以上のように、成果を求める人にとって、最も大切なことは、 『失敗を恐れずに、リスクを背負ってでも行動すること！』なのです。\n[“事あれ主義”たれ - ビジネス発想術 - 転職のまぐまぐ！]\n私には「失敗するのではないか、ということを言い訳にして行動しない」ということもあります。 行動することが面倒な場合は、特にそうです。 行動する前に、言い訳を考え始めてしまうのです。\n“考え”過ぎることは、自分の行動を制限してしまう。 リスクを背負い、“行動”をベースに、成果を生み出そう。\n[“事あれ主義”たれ - ビジネス発想術 - 転職のまぐまぐ！]\n時には考える前に行動（しかも、面倒がらずに）することも大切かもね。\n","date":"2008-08-22T02:36:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/22/023612/","title":"「事あれ主義」に感じたこと"},{"content":"コロンブスの卵の逸話は有名だと思う。 小山 昇氏：こころ豊かで安全な経営とは何か / SAFETY JAPAN [小山 昇氏] / 日経BP社 この人のコラムをコメントも含めて読んでいると、まさにコロンブスの卵の現代版のように感じる。 いくつかのコラムは、ある特定のパターンがある。 ひょっとすると小山氏の発想のパターンなのかもしれない。\nその発想というのは、大胆に言ってしまうと次のようなことだ。\n人は弱い生き物である。だから、その弱い部分を補完するような仕組みを作ればよい。\n例えば、 上司が見ていないところではサボりたくなる、という人がいる。 サボりたくなるのは人の弱さである。 だから「サボれなくなる仕組み」を作る。\n人間がそういうものである以上、大切なのは、そもそも不正をさせない仕組みをつくる。それでも不正が発生する。その場合は、早期に発見できる体制を整えておくことです。我が社には、定期的な人事異動がある。人事異動は、一義的には「社内をリフレッシュし、活性化させる」「業務を体験させることで、仕事のダブルキャスト化を図る」といった目的で実施しているが、結果として不正をさせない仕組みにもなっている。 「社員の不正」を止める社長の責任 / SAFETY JAPAN [小山 昇氏] / 日経BP社\n久しぶりにコラムを読んで、こういう「仕組み」の話が多いなぁ、と思って、まとめエントリーを書こうとしたら、それもそのはず。 コラムの最初の方に、まとめに近いものが書いてありました。\n人間は、言ってもやらない／従わないものなのです。だから、社員に実行させたいと思ったら、嫌でもせざるを得ない状況をつくることです。それが「仕組み」です。 「言っても聞かない人」の操縦法 / SAFETY JAPAN [小山 昇氏] / 日経BP社\nそういう「仕組み」を作るのはとても難しい。 しかし、その「仕組み」を作る発想法は、知ってしまえばなるほどな、と思える発想法だ。\n人間は、面倒なことはしたがらない動物です。だから、こと中小企業の社長は社員の自主性に期待してはいけない。「自発的」とは、「必ずせざるを得ない」仕組みがあり、そして社員は嫌々ながらもやるということに他ならないのです。 「飲みニケーション手当」を支給、さぼる上司には\u0026hellip; / SAFETY JAPAN [小山 昇氏] / 日経BP社\nそれをいろいろな形に応用するのも発想次第なのです。\n社長からパートタイマーまで「それなり」の人材しかいない中小企業では、社員の自主性を期待してはいけません。中小企業にとっての「自発的」とは「いやでもやらざるを得ない」仕組みがあり、それで成果が上がることです。 「面談してください」と社員に言わせる仕組み / SAFETY JAPAN [小山 昇氏] / 日経BP社\n発想法自体は単純ですが、その発想法を活かせるかどうかは、仕組み作りの難しさを理解できるかどうか、にかかっている気がする。\n","date":"2008-08-22T02:09:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/22/020928/","title":"「仕組み」を作る発想法とその活かしかたについての思いつき"},{"content":"MT4.1の時にテンプレートにタグの閉じ忘れがあった件を思い出したので、クリーンインストールしたMTOS4.2のテンプレートをのぞいてみた。 そしたら、中身が全然変わっていた。 ずいぶんと項目が少なくなったようだ。 バージョンアップしたから変わったのか、それとも、オープンソースにしたから変わったのか。 MTOS4.2のテンプレートで以前の部分に相当するのは「ブログ記事の概要」でしょうね、たぶん。 タグの閉じ忘れは治っていました。 オープンソース版を折角選んだのだから、以前のテンプレートは捨ててしまったほうが良かったかなぁ、と少し後悔しました。 そのうち、テンプレートを初期化したくなるかもしれません（ぇ\n","date":"2008-08-21T01:43:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/21/014303/","title":"MTOSをクリーンインストールしてわかったこと"},{"content":"MTOS4.2でスタイルの変更がエラーになっていた件の続報。 結果から言うと今のところ問題なく動くようになった、という感じです。 ただ、再構築はかなり時間がかかりました。 ちなみに、もうすぐラスベガスに行くのでそれっぽいデザインにしてみました。 で、どのようにしたか、ですが。 とりあえず英語サイトでstylecatcherのコードが無いか探してみたところ、発見できました。\nProvides a simple interface for browsing and selecting styles for a published blog\n[6A Plugins - MovableType | wiki.movabletype.org]\nとりあえず、ここからzipファイルをダウンロードします。 で、適当に解凍するとtrunkというディレクトリ（フォルダ）ができます。 その深い階層部分に目指すファイルがあります。 深さはこれくらい。\n1 trunk\\StyleCatcher\\plugins\\StyleCatcher\\lib\\StyleCatcher あとは、それ以下にあるファイル（CMS.pm、L10N.pmとL10Nフォルダの中身全部）を、今現在のstylecatcherのファイルと入れ替えてしまうだけ。\n1 MTOS-4.2-ja\\plugins\\StyleCatcher\\lib\\StyleCatcher この対策が正しいかどうかは別にして、とりあえずうちでは動いています。\n","date":"2008-08-21T01:09:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/21/010953/","title":"MTOS4.2の「デザイン」-「スタイル」のスタイル変更に成功"},{"content":"タイトル長すぎ。 で、結果としてはアップグレードしたのと同じで、エラーになった。 検索してみたが、今のところ情報は無いようだ…。 探し方が悪いのか？ さて、どうしたものか。\n","date":"2008-08-20T23:45:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/20/234553/","title":"MTOS4.2のクリーンインストールで「デザイン」-「スタイル」を試してみた"},{"content":"アップデートを適当にやったせいなのか、「デザイン」－「スタイル」でのスタイルの変更時にスクリプトエラーが出るようになった。 画像とかは切り替わるのだが、カラムの配置変更ができなくなっているようだ。 むむむむむ。 ログを見ると以下のアクセスで500エラーになっている。\n1 POST /mt/mt.cgi?.r=0.11949529833798522 HTTP/1.1 「.r」の数値はほかにも色々。 結局POSTの中身が問題なのか。 ただ、エラーがダイアログで出てくるので、デバッグ情報を仕込んだとしても、そこから原因を探求するのはなかなか面倒そうだ。 と、いきなり弱気。 とりあえず、クリーンインストールして試してみたいね。\n","date":"2008-08-19T01:13:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/19/011350/","title":"スタイルの変更ができなくなった"},{"content":"毎度の事ながら、シンボリックリンクを使ったアップデートの仕方を忘れる。 以前からMovable Type 備忘録 - シンボリックリンクでMovableType3.32アップグレードを参考にしてアップグレードをしていたのだが、シンボリックリンクを更新するやり方とかをすぐに忘れるので備忘録ということで書いておく。 まずはファイルを取ってきます。\nMovable Type (Open Source) 4.2 (MTOS-4.2-ja.zip)\n[MTOS のダウンロード | MovableType.jp]\nで、それをそのままアップロードします。 xreaは、SSHが使えるのでとりあえずSSHでログイン。 telnetでも問題ないはず。 で、zipファイルをそのまま解凍（展開）します。\n1 $ unzip MTOS-4.2-ja.zip ディレクトリ付になっているはずなので、中身はすべて「MTOS-4.2-ja」というディレクトリに展開されるはず。 手元で解凍してからアップロードするととてつもなく時間がかかります。 なので、サーバ上でunzipできる場合は、サーバには圧縮したままアップロードしたほうがいいでしょう。 で、現在のシンボリックリンクを削除する。 仮にシンボリックリンクが「mt」だとすると、以下のコマンドで削除できる。\n1 $ rm mt もちろんだが、その「mt」が置いてあるディレクトリに行ってから実行する必要がある。 で、新しくシンボリックリンクを作成する。 今回は「MTOS-4.2-ja」というディレクトリにインストールしているので、以前と同じく「mt」という名前でシンボリックリンクを作成する。\n1 $ ln -s MTOS-4.2-ja mt とりあえず、ここまでできたところでmt.cgiにアクセスして、mt-upgradeからアップグレードする。 それが完了したら再構築してみる。 いきなりエラーだったが、よく考えてみるとプラグインを全然入れていなかった。 今まで使っていたプラグインは、あえて手元でバックアップしてあるので、それを丸ごとアップロードする。 そして今一度再構築してみる。 テンプレート「ヘッダー」で引っかかった。 「atomやrssのリンクが見つからない」というエラーだった。 ここのrss類はフィードバーナーを使っているので、行儀悪いけどテンプレート内にURLを直書き。 三度目の正直で再構築してみる。 無事終了。 …と、一応流れを記録してみた。 これが、次のアップグレードの時に自分自身に対して役立つといいのだが。 今回は、サーバ上で展開する、という技を忘れていて、解凍後にアップロードしたのだが、ファイル数がとんでもないことになっていて、かなり時間がかかった、というのは秘密だ。\n","date":"2008-08-19T00:19:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/19/001917/","title":"MTOS4.2をインストール（にアップグレード）した"},{"content":"今まで、googleのサイトマップに対応したサイトマップを生成していた。 しかし、世の中の検索エンジンはgoogleだけではない。 日本ではyahooが多いし、windowsを標準で使っている人はmsnも多いだろう。 しかし、今のままだとその二つには対応していないことになる。 mt-search.cgiとrobots.txt関係で調べていた中で、sitemapsに対する記事を幾つか見つけた。\n検索エンジン大手3社であるGoogle、Yahoo!、Microsoftは16日(米国時間)、Sitemaps 0.90のサポートを発表した。Web管理者はSitemapsを使うことで検索エンジンに対して包括的でかつ効率のよい自サイトの情報を提供できる。\n[Googleなど3社、Sitemapsをサポート - サイト管理者は要注目 | エンタープライズ | マイコミジャーナル]\n検索エンジンで共通のsitemapが使えるという話です。 世の中は色々な標準化がどんどん進んでいたんですね。\nサイトマップ 0.90 はアトリビューション シェアアライク クリエイティブ コモンズ ライセンスの利用条件のもとで提供されており、Google、Yahoo!、Microsoft を含む企業で幅広くサポートされます。\n[sitemaps.org - ホーム]\nしかも、もう一年以上前の話なんですが…。 ひょっとしたら、改めて変更するまでも無くgoogle用のサイトマップを読むようになっているかもしれませんが、折角知ったので対応してみることにしました。 sitemaps 0.90の仕様はオフィシャルにあります。\nサイトマップの XML 形式\n[sitemaps.org - プロトコル]\nとはいうものの、ちょっと検索してみると実はすでにMT4用のテンプレートがいくつかのサイトに載っていました。\nSitemaps 0.90 に対応した情報を公開することで、Google、Yahoo、Microsoft の各検索エンジンにサイト情報を適切に通知できるようになります（検索エンジンのインデックスにウェブページのすべてを含むことを保証するものではありません。クロールを補完するための仕組みです）。\n[小粋空間: Sitemaps 0.90 用テンプレート（MT4対応）]\nMoavble Typeでサイトマップを作成するメリットは多い。理由は、一度しっかりしたテンプレートを作成してしまえば、半永久的にブログの記事を書いたときに自動的に記事のURLをサイトマップに明記してくれるからだ。今回公開するテンプレートを使えば、年別、月別アーカイブページのURLも、自動的に書き出すことができる。新しく年、月等が変わった場合も同様だ。\n[Movable Typeで最強サイトマップ - SCREAMO CREATIVE]\nとりあえず小粋空間: Sitemaps 0.90 用テンプレート（MT4対応）のほうで作成してみました。 あとは、robots.txtにサイトマップのアドレスを書き加えるだけです。\nSitemap:\n[sitemaps.org - プロトコル]\n簡単ですね。 それにしても、ウェブの紳士協定が徐々に機能するようになってきたんでしょうか。 昔は、当時2大ブラウザといわれたIEとNNの、標準を無視するような独自拡張（当時はそういうのが売りだったのでしょう）をはじめとして、ホームページを作る側にとって非常に難しい問題が沢山ありました。 web製作者側からすれば良い時代になりましたね。\n","date":"2008-08-18T00:36:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/18/003623/","title":"sitemaps0.90に対応したmovabletypeのテンプレート"},{"content":"前々からサーバに対する負荷が気になっていた。 movabletype自体の負荷だと思っていたのだが、実際にはある特定のファイルが原因ということが調べていく過程でわかった。\nMovable Typeの検索機能を担うmt-search.cgiですが、これがまた激しく検索が遅くて重い。サーバーにもかなりの負荷が掛かってる模様。サーバーやさんに申し訳ないのでmt-search.cgiを止めることにしました。\n[mt-search.cgiを削除した (KUMA TYPE)]\nようするに、mt-search.cgiが激重ということなんですね。\nこのブログで使っているMovable Typeのサーチ機能を提供するのがmt-search.cgi。単にPerlのパターン・マッチングを使っているだけなんで、非常～に低速で重たいサーチ機能なんですよ。いくらうちの環境が「どん亀」とはいえ、CPUパワーの9割以上を持っていかれますヽ(;´д｀)ノ\n[SPV = Nightmare: Google様がmt-search.cgiを狙い討ちなんですけど]\n「mt-search」で調べると「mt-search.cgiを捨てて簡単メタサーチにしてみよう - Ogawa::Memoranda」とか「mt-search.cgiの代替プログラム。 (Junnama Online (Mirror))」というように、プログラム自体を変更するという話題が多いです。 もちろん、プログラム自体の負荷を軽くしてやるのも効果はあるわけですが、アクセスログとかを追っていくと、結局のところ、人間様じゃなくロボットが大量に収集していくのが問題なんですね。 ロボットに収集をやめさせるほうが効果が高いのではないかと思ってやってみました。\n検索ロボットに指示するには「robots.txt」を使います。 昔はあまり意味が無かったようですが、最近は大手のロボットは解釈するようになったらしいです。\nASY!Yahoo,Google,Microsoft(Live Search)の3社は、自身の運用するクローラーがRobots.txtを承認するという取り決めを行っています。これによりrobots.txtの信用力は格別のものとなり、安心して使えるようになりました。（参考サイトYahoo Search Blog）\n[robots.txtの正確な書式,ロボット対策,noindex,nofollow | ASY! - エイジー]\nなので、その効果を体感するためにも、「robots.txt」での対応をしてみました。\nとりあえず、過去のブログに対してはプログラムが入っているディレクトリへのアクセスを禁止しました。\nhttp://blog.nqou.net/robots.txt\nその結果、対策前のある一日のxreaでいう負荷ポイントが557だったのが、ここ最近は0から86になっていました。 同じ日の「mt-search.cgi」へのアクセス数は284でしたが、少し負荷のあったこの前の木曜日のアクセス数は10未満でした。 mt-search.cgiを置き換えるまでも無く、十分に効果を得ることができました。\n","date":"2008-08-17T13:19:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/17/131943/","title":"mt-search.cgiの負荷に対するrobots.txtの効果"},{"content":"昨夜、久しぶりにビールを飲んだ。 薬を飲んでいたのでずっと控えていたのだが、ようやく喉の痛みを感じなくなってきたのでアルコール解禁。 大量の焼肉と共に大量にビールをいただいてきた。 健康っていいね。\n","date":"2008-08-17T11:27:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/17/112735/","title":"完全復活"},{"content":"不摂生をしているつもりはあまりないのだけど、微熱状態がずっと続いている。 まあ、治ったと思ってビールを飲んだのは確かだが。 喉の痛みが昨日よりも悪化している。 昨夜からは下唇に水膨れ（口唇ヘルペス？）もできた。 漢方薬を飲んだおかげか痰は出るのだが、その痰が半固形な感じで唾液と分離している。 我ながら気持ち悪い。 今日一日も用事があるのだが、なるべく養生しておかないとね。\n","date":"2008-08-03T09:19:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/03/091946/","title":"長引く体調不良"},{"content":"木曜日は朝から元気に出勤したのだが。 といっても、喉の痛みは若干あって、時々咳き込む感じ。 喉の奥に何か引っかかっているような感じがしていた。 まあ、でも、そのうち治ると思っていた。 明けて金曜日。 また微熱と頭＆喉の痛みが。 熱は微熱なのだが、頭の痛みが結構ひどい。 喉のほうも木曜日の夜に薬を服用したおかげで痰が出るようにはなったのだが、咳き込むと頭に響いて痛い。 結局会社を休むことに。 バファリンの効き目って24時間くらいあるんですかね？ 木曜日に元気だったのは、バファリンの効能だったんじゃないかと。\n木曜日のうちに資料作りは終わっていたので、休む連絡だけをとりあえずした。 しかし、進捗が心配で途中で連絡すると、追加で私に作ってほしい資料があるということで月曜日まで書類が進まないことが判明した。 ここで追加ですか。 まあ、仕方ないですが。 で、それが気になったわけではないだろうけど、時間がたつにつれて体調がどんどん悪化していった。 熱は微熱のまま下がらないし、喉の痛みも治まらない、咳も止まらない、頭の痛みはひどくなってくる。 結局晩御飯のあと、冬用毛布をかぶって寝た。 3時間くらいで起こされた時、体中が汗でびっしょり。 特に、腕からは玉のような汗で、妻に気持ち悪がられた。 しかし、頭と喉の痛みがぜんぜん取れていなくて、またバファリンを飲むことに。相変わらずポカリスエットで。 あと、麦門冬湯（ばくもんどうとう）という漢方薬も。 おかげで今、こうやってブログを書いているわけですが。 今日もはやめに寝ないと、また明日が大変なことになりそう。\n","date":"2008-08-02T23:30:24+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/08/02/233024/","title":"バファリンの効き目"},{"content":"昨日、夕方あたりから急に体調が悪化して、気がつけば39度近い熱が。 とりあえず、キリのいいところまで仕上げて、家に帰った。 あとで考えてみれば、朝からのどが変だった。 帰ってからはとりあえず晩御飯を食べたが、おなかがすいているのに食べるのが思った以上にしんどくてだんだん食欲が無くなっていった。 ともかく、食べられるだけ食べたあと、両脇とおでこと首裏にひえピタを貼って、冬用の毛布をかぶって寝た。\n目が覚めると、3時間くらい経っていた。 汗だくだったので着替えて水分補給。 ポカリスエットがうすく感じる。 頭ががんがんしたが、テレビがついていたのでつい見てしまう。 レッドカーペットだった。笑うと頭が痛かった。 キリのいいところで（というか結局最後まで見たが）また寝た。\nそういえば、バファリンをポカリスエットで飲んだ。 次に目が覚めると2時過ぎ。 着替えて水分補給。相変わらずポカリスエットがうすい。 熱を測ると36.9度。 微妙な熱。薬が効いている感じ。 大分元気になってきていたのでシャワーを浴びて汗だけは流す。 おなかがすいていたのでカップめんと551のぶたまんを食す。かなり食欲が戻っていた。 というか、むしろおなかが一杯になって苦しかった。 で、おでこと首裏にひえピタを貼って寝た。 一応目覚ましをいつもの時間より早めに（お風呂に入りたかったので）セットした。 目覚ましで起きた。 熱を測ると36.6度。それにしてもポカリスエットがうすい。 少し頭は痛かったが、熱も下がったし、会社を休んでも仕事が後にずれるだけなので、シャワーを浴びて出勤。 不安だったので、会社近くのコンビニで2リットルのポカリスエットを購入。 やっぱりうすかった。 どれだけ塩分が足りなかったのかと。 実は今ものどが少し痛いが、ポカリスエットの飲みすぎじゃないのかと思うほど飲んだ24時間だった。\n","date":"2008-07-31T23:13:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/31/231300/","title":"体調不良とポカリスエット"},{"content":"TagSupplementalsプラグインは最近入れたばかりだが、ちゃんと使ってみようとドキュメントを見に行ったら、新しくなっていた。\n0.10(2008-07-23 00:56:57 +0900):\nMT 4.0以降のバージョンのみをサポートするようにしました。MT 3.3ユーザは古いバージョンを使ってください。 MTTagLastUpdated/MTRelatedEntries/MTRelatedTags/MTArchiveTagsタグで、\u0026ldquo;blog_ids\u0026rdquo;、\u0026ldquo;include_blogs\u0026rdquo;、\u0026ldquo;exclude_blogs\u0026quot;オプションが使えるようになりました。 Fix: encode_urlplusモディファイアが正常に動作するようにしました。 MTRelatedEntriesタグに\u0026quot;offset\u0026quot;オプションを追加しました。 [TagSupplementals_Plugin.ja_JP - Ogawa::Code - Trac]\nとりあえず、以前のブログでもやっていた「タグによる関連記事」を表示するようにしてみた。 まずテンプレートで表示部分を作ります。 デザイン→テンプレートとして、画面右側のクイックフィルタから「テンプレートモジュール」を選び、「モジュールテンプレートを作成」します。 タイトル部分にはわかりやすいように「タグによる関連記事」と入れておきましょう。 このタイトルはインクルードする時に使います。 中身は以下のとおり。\n1 2 3 4 5 6 7 8 9 10 \u0026lt;div class=\u0026#34;trackbacks\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;trackbacks-header\u0026#34;\u0026gt;タグによる関連記事\u0026lt;/h2\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;MTRelatedEntries lastn=\u0026#34;10\u0026#34; weight=\u0026#34;idf\u0026#34;\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;$MTEntryPermalink$\u0026gt;\u0026#34;\u0026gt; \u0026lt;$MTEntryTitle$\u0026gt; \u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/MTRelatedEntries\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; 本当は、classとかちゃんと作りたいところですが、面倒なので見栄えをトラックバックに合わせると言うことでお茶を濁しておきます。 lastnとかweightとかはマニュアルを見てお好みで。 次に、作ったテンプレートをインクルードします。 クイックフィルタから「アーカイブテンプレート」を選び、テンプレートの一覧から「ブログ記事」を選びます。 あまり深く考えずに「ブログ記事の詳細」と「トラックバック」の間に、先ほど作ったテンプレートをインクルードします。\n1 2 3 4 5 6 \u0026lt;$MTInclude module=\u0026#34;ヘッダー\u0026#34; $\u0026gt; \u0026lt;$MTInclude module=\u0026#34;ブログ記事の詳細\u0026#34; $\u0026gt; \u0026lt;$MTInclude module=\u0026#34;タグによる関連記事\u0026#34; $\u0026gt; \u0026lt;$MTInclude module=\u0026#34;トラックバック\u0026#34; $\u0026gt; \u0026lt;$MTInclude module=\u0026#34;コメント\u0026#34; $\u0026gt; \u0026lt;$MTInclude module=\u0026#34;フッター\u0026#34; $\u0026gt; 大体こんな感じです。\n","date":"2008-07-30T00:50:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/30/005000/","title":"TagSupplementalsプラグインが更新されていました"},{"content":"管理規約というのは読んでもよくわからない。 わからないから守れない。 逆に考えて、守るため、守ってもらうためにはわかるようにすれば良い。\nでは、わかるようにするにはどうすればよいか？ 勉強会に参加してもらうようにすれば良い。\nでは、勉強会に参加してもらうにはどうすればよいか？ 参加して良いことがあれば良い。\nでは、どのようなことが「良いこと」か。 短絡的だが、プレゼントがもらえるとか。 子供連れでもOKにするとか。 なかなか難しいね。\n勉強会に行かない理由なんて、いくらでも出てきそうな気がする。\n","date":"2008-07-29T23:27:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/29/232744/","title":"管理規約の勉強会"},{"content":"というか、こういうのがモジュールにあるのを知らなかった。\n1 2 3 4 5 6 7 8 9 10 11 #!/usr/bin/perl use strict; use warnings; use POSIX; my @vars = (1, 0.999, 0.9, 0.1, -0.1, -0.9, -0.999, -1); foreach my $var (@vars) { print \u0026#34;Target is $var\\n\u0026#34;; print \u0026#34;ceil : \u0026#34;, ceil($var), \u0026#34;\\n\u0026#34;; print \u0026#34;floor : \u0026#34;, floor($var), \u0026#34;\\n\u0026#34;; print \u0026#34;int : \u0026#34;, int $var, \u0026#34;\\n\u0026#34;; } use POSIX; とすることで、ceilとfloorが使えるようになる。 便利だね。\n","date":"2008-07-29T00:46:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/29/004604/","title":"Perlで切り上げ（ceil）と切り捨て（floor）を使う"},{"content":"Firefoxがバージョン3（今日の時点で3.0.1）になったので、アドオンとかプラグインとか少しずつ探していたところ、ブログに便利なアドオンを見つけました。 Make Linkというアドオンです。\nコンテキスト (右クリック) メニューから、HTML、Wiki 記法、あるいはプレーンテキストなどの形式で、リンクをクリップボードへコピーできるようにします。独自のリンク形式を作成することも可能です。\n[Mozilla Japan - Firefox 用アドオン - 拡張機能 - ニュース＆ブログ]\nこの「独自のリンク形式」で、引用部分を作ってみました。 今回の引用は「[楽々引用](/2008/03/07/003250/)」ではなく、以下の設定で「Make Link」を使ったものです。\n1 2 3 4 \u0026lt;blockquote cite=\u0026#34;%url%\u0026#34; title=\u0026#34;%title%\u0026#34; class=\u0026#34;blockquote\u0026#34;\u0026gt; \u0026lt;p\u0026gt;%text%\u0026lt;/p\u0026gt; \u0026lt;/blockquote\u0026gt; \u0026lt;div class=\u0026#34;cite\u0026#34;\u0026gt;[\u0026lt;cite\u0026gt;\u0026lt;a href=\u0026#34;%url%\u0026#34;\u0026gt;%title%\u0026lt;/a\u0026gt;\u0026lt;/cite\u0026gt;]\u0026lt;/div\u0026gt; なかなかうまくいった。 ページのタイトルやURLを簡単に組み合わせて色々と作れるようなので、使い方次第で色々とできそうだ。 しばらくFirefoxを使ってみることにしようか。\n","date":"2008-07-27T01:57:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/27/015708/","title":"勝手にブラウザ選択、Firefoxが大きく前進"},{"content":"何年も前から使っている自分フレームワーク（というか自分モジュール集？）があるのだが。 スクリプトの漢字コードが「euc-jp」前提で書いてあるので、それに愕然としている。\n…まあ、自分がやってきたことだけど。\nPerl5.8になってEncodeが標準で搭載されるようになってからも過去の遺産を使っていたわけですが。 ウェブまわりがどんどんUTF-8標準になっていくにしたがって、色々と限界を感じてきた。 「Perl 5.8.x Unicode関連」とか見ながらやってきましたが、そろそろ限界です。 MT3時代のブログで文字コードまわりがうまくいかなかった事もあるし、最近ぶち当たった「MySQLで文字化けする」問題もある。 もうね。\nスクリプトも基本は「utf8」ですってよ。 MTも生成するHTMLは「utf8」がデフォルトだし。 MySQLもバージョン5（？）から「utf8」が基本みたいだし。\nEncodeには他にもうんざりするほどいろいろな機能がありますが、上記の基本で日常業務の9割5分はカヴァーされているかと思います。「decodeしていじってencode」、この基本をお忘れなく。\n[404 Blog Not Found:perl - Encode 入門]\nまとめだけを引用しましたが、この「上記の基本」はすべて「use utf8」です。 基本からやり直し。\n","date":"2008-07-24T00:20:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/24/002019/","title":"最近Perlスクリプトを書いていて愕然とすること"},{"content":"現実逃避？ いえ、息抜きです。 The Golden Lore（ゴールデンロア） ここ最近、本業が忙しくてまとまった時間が取れなかったのだが、息抜きに何かゲームがしたいと思った。 直接操作するのではなく、簡単な行動指針を入力するようなゲームならそんなに時間もかからないし面白そうだと。 そんなゲームがないのかなと思って探したら、…ありました。 それが「ゴールデンロア」というゲーム。 今現在、βテスト中ということで肝心の「簡単な行動指針」が入力できないので、キャラクターを作るだけで、あとは称号を変更するくらいしかすることがない。 それでもゲームなのかと思うのだが、思ったよりは楽しめる。 一日に1回、勝手に冒険に出て、その結果がメールで送られてくる。 最初のキャラクターは2回目の冒険で息を引き取った。 最初の戦いで即死なんて、明らかに敵が強すぎる。 色々と調べてみると、よくキャラクターが死ぬゲームらしい。 今日、二人目のキャラクターも2回目の冒険で死んだ…。 無念だが、それをバネにして（？）三人目のキャラクターを登録した。\n","date":"2008-07-23T23:37:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/23/233714/","title":"ゲームらしからぬゲーム：The Golden Lore（ゴールデンロア）"},{"content":"そういえば、この前入れたプラグインの「InsertLink」だが、オフィシャルからのリンク先にあったバージョン1.21は、MT4.1では動かなかったらしい。 ブラウザを立ち上げなおしても機能が動いていないので配布元で調べてみるとMT4.1対応版が出ていた。\n先日公開した「リンクの挿入をより便利にするプラグイン(MT4.1/MTOS専用版）」に不具合がありました。 プラグインをお使いの方は、新しいバージョンをダウンロードして差し替えてください。 お手数をおかけして申し訳ありません。\n[リンクの挿入をより便利にするプラグイン(MT4.1/MTOS専用版・不具合修正) - The blog of H.Fujimoto]\n早速使ってみたけど、過去記事へのリンクを作るのに、対象の記事をリストから選ぶことができるのは便利かも。\n","date":"2008-07-23T01:58:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/23/015814/","title":"オフィシャルからのリンク先が不具合ありのまま放置ってどうよ？"},{"content":"しばらく前から認識はしていたのだけど、サーバの仕様ということで放ってある問題がある。 携帯向けにShift_JISに変換して出力する、EUC-JPで書かれたスクリプトがあるのだが、それでMySQL5.1.11と今までのようにDBIを通じて書き込みを行うと、文字化けする、という問題だ。 しかし、CGI::Sessionを通じて同じデータベースの別テーブルに書き込んでいるほうは文字化けしないのだ。 漢字コードを指定するためには「SET NAMES ujis」というSQLを入れるといいらしいので、それをやってみたら、そこはうまくいった。 しかし、今度はもともと文字化けしていなかったほうが文字化けする。 データベースハンドルは同じものを使っているのだけど。 何がどうなんだろうねぇ。\n普通に考えて、CGI::Sessionのほうは、漢字コードを変換してデータベースに書き込んでいるんだろう。 でも、どこでそうなってるのか、ソースを読もうとして挫折。 で、今に至ると。\n","date":"2008-07-23T01:29:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/23/012951/","title":"EUC-JPで書き込むとMySQLで文字化けする？"},{"content":"相変わらず女性ボーカルなメタルバンドを狙って聴いています。 クリプテリア\nクリプテリア (Krypteria)は、ドイツ出身のパワー・メタル／オルタナティヴ・メタル・バンド。ヘヴィ・メタルを基にグレゴリオ聖歌の合唱を組み合わせるなど独自のドラマティックな楽曲を演奏している[1]。2004年より参加したリード・ボーカリストが在独韓国人二世だったことが韓国で話題になった[2]。\n[クリプテリア - Wikipedia]\n全曲を聴いたわけではありませんが「BLOODANGEL\u0026rsquo;S CRY」の「The Promise」がなかなか良い感じです。 ディレイン\nディレイン (Delain) は、オランダのシンフォニック・メタル・バンド。キーボーディストのマタイン・ウェスターホルト（元ウィズイン・テンプテーション）を中心に2002年に結成された。\n[ディレイン - Wikipedia]\nこれまた全曲聴いたわけではありませんが「Lucidity」の「Sever」や「No Compliance」がなかなか良いです。 高音域の声色がゾッとするほど心に刺さります。\n","date":"2008-07-22T00:52:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/22/005239/","title":"ここ最近気になっているアーティスト"},{"content":"これってクリッカートレーニングのことですよ。\nどのようにイルカに芸を教えるのか。\n[プロコーチによるコラム　|　coach21]\n上記のページで書かれているイルカの例は、おそらく「うまくやるための強化の原理」でも紹介されていることでしょう。\n初めて犬を飼う時に、しつけについて色々と調べていた時期があって、クリッカートレーニングはそのときに見つけて知りました。 マロンにこのトレーニングをやっていた時は、私がクリッカーを手に持つだけで、走って寄ってきたものでした。 動物の学習能力と、それを利用したトレーニング方法を編み出した著者をすごいなと思いました。\nしかし、このトレーニング方法は、トレーニングする側の能力も要求されます。 犬を相手にする場合は、犬の動作を集中して見ておかなければなりません。 そして、常に学習させなければなりません。 同じ事を何度もしていると、すぐにマンネリ化してしまい新しい行動をおこなさなくなります。 そうなる前に、難しすぎず簡単すぎずという微妙な難易度の事をトレーニングするのはとても大変でした。\nちなみに、キキはクリッカーの音を怖がってしまってトレーニングになりませんでした。 ショコラには試したことがありません。\n","date":"2008-07-21T23:48:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/21/234823/","title":"コーチングとクリッカートレーニング"},{"content":"なんとなくプラグインを3つほど入れてみた。 - InsertLink - RelatedEntries - TagSupplementals といっても、とりあえずは導入だけ。 使ってみた感想はあとで書く予定。 ここのところあまり触っていなかったのだけど、ちょっと中身を見たら気分が乗ってきたというか。 そんな感じなのでどこまで使うかわからないけど。 まずは、「InsertLink」。\nブログ記事やウェブページ作成画面にある、リンク追加機能を拡張するプラグインです。 リンク先を開くウィンドウの指定を行ったり、過去のブログ記事一覧からリンク先を指定するなど、リンクの入力を支援する機能を追加します。\n[InsertLink | Movable Type プラグインディレクトリ]\n標準のリンクアシストはしょぼいので、機能を追加してみたいなと。 続いて「RelatedEntries」。\nブログ記事間の関連付けを行い、「このブログ記事に関連する他のブログ記事」のような出力を行えるようにするプラグインです。\n[RelatedEntries | Movable Type プラグインディレクトリ]\nこれは以前挫折したプラグインかもしれないなと、今思った。 感想は追々。 最後に「TagSupplementals」。\nタグ関連のテンプレートタグを拡張するプラグインです。\n[TagSupplementals | Movable Type プラグインディレクトリ]\nタグはバージョン4になって大分こなれてきた感じはするけど、拡張できるものなら拡張して活用したいという感じ。\n","date":"2008-07-21T23:00:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/21/230030/","title":"久しぶりにプラグインでも触ってみる"},{"content":"むき出しの正義感は、一般的に考えられているよりも迷惑であることが多いです。\n生活ルールを定めた細則や生活協定のルールを守らない人、関心を持たない人はもちろん問題です。改善を求めるのは当たり前です。ただし、個人間でこれをやるとカドが立ちます。誰しも自分の住むマンションが荒んでほしくはないはずです。管理組合という組織の力でやんわり忠告するほうが無難です。 快適なマンションライフを継続させるためには、「自分の考え方が絶対に正しい」と思い込んで他人に強要することを躊躇（ちゅうちょ）しない人のほうが、むしろ頭の痛い存在なのかもしれません。 “自転車投げ込みおじさん”の正義感｜マンション管理新時代（ケンプラッツ）\n…というか、理事長という立場としては、気持ちはありがたいけれど、もう少しやり方を考えてほしいな～、と思うことが多いです。 先日の総会のときでもそうですが、細かい指摘事項は軽く流すことで、大きな指摘事項がより印象に残ると思うのです。 事の大小を区別せずに同じ調子で指摘されると、文句を言いたいだけなんじゃないかと思うのです。 それが、ものすごくもったいない、と思います。 私も含め、多くの人は「うるさい人だな」と思うだけで、心に届かないのではないかと思います。 管理会社の人ともそういう話になってしまいます。 もっとやり方、言い方を考えればいいのに…ってね。\n本当に、気持ちはわかるんですが、まだこのマンションには土壌ができていない。 正義感という種をまくのはまだ早いのです。\n私もそうでしたが、役員（しかもできれば理事長等の役職）を経験しないと、マンションの問題というのはなかなか実感できない。 管理会社がちゃんとやってくれている、という言葉も未だに聞きます。 （まあ、お金のやり取りを含めた事務手続きなどはきっちりとやってくれますが。） 管理会社としては、マンションの中から苦情が来ない限り、マンションを良くしようとかそういうことは思わないものです。 フロントの方は物件をいくつも抱えているわけですから、マンションごとに一つずつ問題点があれば物件数分の仕事が増えるわけです。 ノープレイノーミス。 それが管理会社のフロントとしては最も無難なすごし方です。\n一方、マンションの住民も気づいていても何も言わないものです。 ただ、こちらの方は多少意味が違います。 そもそも、管理組合とか理事会とかの存在自体を知らないか、あるいは自分とは関係のない別世界のことのように感じている人が多いです。 だから意見があったとしても誰に言っていいのかわからない人が多いのではないかと思うようになりました。 何かの席で同席したときに「そういえば理事長なんですよね？」という問いかけから、実は…というふうに何かを聞くことが時々あります。 前のマンションでもそうでしたが、意見箱を用意していても、気づいたことを紙に書いて投函してくれる方は非常に少ない。 でも、だからといって不満がないわけではないし、マンションに問題がないわけではない。 「書く」という事が非常に高いハードルになっているだけです。\n感じたことを紙に書いて投函する、というなんでもない事がなんでもないようにできる様になるにはまだまだ時間がかかりそうです。\n","date":"2008-07-21T01:13:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/21/011353/","title":"マンションに対する正義感と土壌"},{"content":"Windowsでエラーを無視してファイルをコピーするには結局これしかないんでしょうか。\nファイルのコピーには、エラーを無視してコピーすることができるxcopyコマンドを使うとよい。\n[＠IT：Windows TIPS \u0026ndash; Tips：エラーを無視してファイルをコピーする方法―壊れかけたディスクからのファイルの救出―]\nまあ、定型文みたいなものでしょうけど、頻繁に使うコマンドでもないので、とっさには出てこないですね。\n1 C:¥backup\u0026gt;xcopy /s /e /c /h g:¥*.* c:¥backup ディレクトリの構造ごとコピーするのは、GUIのエクスプローラのほうが秀でているわけですし、エラーを無視するオプションを（例えば右ドラッグ＆ドロップで）選択できたりすることは可能だと思うのですがね…。\nで、エラーがあったファイルはあとで画面に表示して、かつ、そのリストは名前をつけて保存できるようにする。 その程度のことはできると思うのですけどね。\n","date":"2008-07-21T00:18:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/21/001806/","title":"Windowsでエラーを無視してファイルをコピーするには"},{"content":"ActivePerl5.10.0Build1003をインストールしてから、どうもcpanがうまく動かなくて困っていた。 色々と試したところ、cpan.orgからIO::Compress::Zlibの最新版を落として入れなおすとうまく動くようになった。\n","date":"2008-07-20T16:03:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/20/160338/","title":"ActivePerl 5.10.0Build1003の不具合"},{"content":"テンプレートモジュールの「ブログ記事のメタデータ」でabbrタグの閉じ忘れがあるのを何気なく発見。 4行目\n1 \u0026lt;address class=\u0026#34;vcard author\u0026#34;\u0026gt;\u0026lt;$MTEntryAuthorLink show_hcard=\u0026#34;1\u0026#34;$\u0026gt;\u0026lt;/address\u0026gt; (\u0026lt;abbr class=\u0026#34;published\u0026#34; title=\u0026#34;\u0026lt;$MTEntryDate format_name=\u0026#34;iso8601\u0026#34;$\u0026gt;\u0026#34;\u0026gt;\u0026lt;$MTEntryDate format=\u0026#34;%x %X\u0026#34;$\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;/abbr\u0026gt;\u0026lt;/strong\u0026gt;) \u0026lt;strong\u0026gt; が追加部分。 標準のテンプレートから変えた記憶が無いので、最初から抜けていたのかも。 もうすぐバージョンが4.2になるようなので、それでなおってなければ報告しようかな。\n","date":"2008-07-14T01:55:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/14/015558/","title":"タグの閉じ忘れを発見"},{"content":"今日は、妻が、どうしても関空に行きたい、というので仕方なく行ってきた。 バスで展望ホールに向かうと、そこで飛行機とは関係ないとは思うが、イベントをやっていた。 なにやら好みの絵が飾ってあったので、妻が飛行機と戯れている間に一通り見てまわった。\n銀河鉄道の夜 \u0026amp; KAGAYAアートの世界展　in関空 関西サマーフェスタ in Sky View 2008\n[KAGAYA イベント]\nう～ん。満足。 帰ってきてから調べてみると、ちゃんとオフィシャルサイトがあった。\nKAGAYA Gallery\nここのところ携帯の待受画像は「石原さとみ」ばかりなのだが、ちょっと変えてみようかなと。 どれにしようか悩むね。\n","date":"2008-07-14T01:16:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/07/14/011625/","title":"関空で銀河鉄道の夜"},{"content":"タバコを吸う人は面倒くさいことが嫌い、という証なのか。 それとも、その特徴は日本人全体に通じるのか。 タスポ関係の記事を何気なく見て、ふとそういうことを思った。\n","date":"2008-06-08T13:22:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/06/08/132200/","title":"日本人の特性？"},{"content":"成果目標ということで、色々な標準化、マニュアル化を目標に設定している。 今の上司がそういう系の仕事が好きなので（と推定）、そういう系の目標を立てているのだが…。\n「仕組み作り」は良いことです。しかし、仕組みを作り出す立場の人は、『仕組みにより動かされていく人のモチベーションを考慮した仕組み作り』というコンセプトを肝に銘じて、取り組んでいく必要があると思います。「論理的にパーフェクトな仕組み」だけでは、「人を巻き込んだ仕組み」は作る事ができないのです。\n[仕事の仕組み化は万能か？仕組み化の副作用 - モチベーションは楽しさ創造から]\n転勤して現在の勤務地になったとき、前任者からの引継ぎ事項の中に「建物点検チェック表」の作成というのがあった。 引継ぎといっても潤沢に時間があるわけでもなく、実質「引継書」の説明だけで、あとは棚に保管してある書類を調べ、わからないところは電話で訊く、というのが我が社のスタイル（？）だ。\nその引継の中で「建物点検チェック表」については、法定点検をベースにして作る、というはなしだったので、法定点検の点検結果報告書を元にチェック表を作った。\n作る前に、方向性を上司と相談したつもりだったが、話がかみ合わない。 あとで気づかされるが、この上司は放任主義で、詳細な指示をしないタイプだった。 ともかく、こうして建物点検の仕組みが一つ出来上がった。 その仕組みが自分の首を絞めることになるとは思ってもいなかった。\n点検チェック表は、誰が点検しても点検項目に漏れが無いように作るものだと理解している。 しかし、出来上がったチェック表は専門知識が無いと使えない代物だ。 それだけならまだ良いのだが、このチェック表は点検方法からすると、現場に持っていっても全く使えない代物になってしまった。\n…何のためのチェック表を作ったのか？\nとはいえ、作ったものは使うしかしょうがなくて、点検から帰ってきてから報告書とともに作成することになった。 それだけではなく、チェック表（と呼ばれるもの）だけでは不具合がわかりにくいので、不具合一覧表も別で作成することになった。\n…何のためのチェック表を作ったのか？\nもともと、清書のための書類は作りたくない、という上司の指導の下で作成したチェック表だったはずなのに、結果としては、報告書用に新しく書類を作ることになっている。 点検時に使用したチェック表を添付資料としてつけて報告する、という目的もあったのだが…。\n結局作成する書類が増えただけだった。 残念。\n","date":"2008-06-02T19:40:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/06/02/194014/","title":"作った仕組みに縛られている"},{"content":"第33期の定期総会が終わりました。\n建物の裏口に当たる部分にスロープをつける、という共用部の変更は否決されました。 賛成票が4分の3に満たなかったためです。 しかし、それ以外はなかなか有意義な総会だったと思います。 なにより、集まった議決権の数が前回の総会よりも多くなったこと。これは重要だと思います。 当然目指すのは100%ですが、今後どんどんそれに近くなっていくように広報活動を続けていく必要があるでしょう。 それにしても、積極的に権利を放棄する方もいらっしゃるのが不思議です。 面倒だ、とか、うっかりして、とかではなく、出さない、と主張する方がいらっしゃる。 何が彼（彼女）たちをそうさせるのでしょうか。 理解に苦しみます。\nあと、議事進行は今回もまずい点がありましたが、前回よりはマシになったと思います。 私にも多少は会を御する力がついてきているのかもしれません。 総会に出席される方の中には、マンションを良くしよう、という思いが強すぎるせいか、理事会や管理会社に文句ばかり言っている方もいらっしゃいます。 仰っている内容は正論なのですが、一言二言多いので会場の雰囲気が険悪になります。 非常にもったいないことです。 誤字脱字の一つや二つには目をつぶってこそ、大きな指摘事項に効果があるのではないか、と思います。 それとも、単に私のことを嫌っているから小姑のように指摘されるのでしょうか？ また、過去の因縁関係があるらしく、非常に仲の悪い方々がいらっしゃいます。 お互いを暗に攻撃するような発言が時々見られました。 もっと紳士淑女らしい振る舞いも必要なのではありませんか、と言いたい。\nま、ともかく一仕事は終了しました。\n","date":"2008-06-01T17:41:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/06/01/174158/","title":"定期総会終了"},{"content":"仕組みとしての成果主義はわかるのだが、なかなかうまくいかないようだ。 私の勤め先では、数年前から成果主義の評価制度を試験実施している。\nしかしそれ以前に重要なことがあります。その成果主義賃金制度を導入した会社は社員の成長を促す努力をしてきたか、ということです。\n[裁判以前の問題｜人事制度 は 社員を成長させる 仕組み]\n社員の成長を促すのは当然だと思っていましたが、中にはそうでない会社もあるのでしょうか。 幸いにも私の勤め先では、何かあるとすぐに「OJT（On-the-Job Training）」という言葉を出してきます。 社員を集めての教育もありますが、通常は仕事をしながら先輩が後輩を教育、指導する事になっています。 しかし、評価制度の中には、指導する後輩がいても、ある一定の役職にならないと「指導」に対しての配点がありません。 つまり、後輩を指導しても、その指導に対しては成果が認められないのです。 成果主義という割には仕事内容を把握していなさすぎです。 さらに不思議なことに「指導」の配点がある役職には「知識」の配点がありません。 会社の考え方としては「ある役職になるためには、一定の知識があることが前提である」というのが理由らしいのですが、なんともがっかりな話です。 とてもそのレベルをクリアしているとは思えない方もいらっしゃるというのに。\nもちろん、「公平な評価」というものに全く気を払わないというのは問題ですが、評価を行う人にはこれまでに培ってきた価値観というものが根強くあり、人事評価にも必ずそれが反映するものです。マネージャー達の全てが全く同一の価値観を持っていない限り、100％公平な評価というものはありえないのです。\n[日経ベンチャーonline　ニッポンの社長へ: 人事評価に「公平」などありえない]\n評価される側としては「公平」に評価されることを望みます。 つまり、絶対的な評価基準が不可欠です。 しかし、残念ながら「評価の指標をあえて曖昧にしている」のが我が社の制度です。 評価基準は評価者の裁量に任されていて、まず自己評価した結果を提出し、それによって面談をして、その結果により最終の評価をされることになります。 面談では「評価される人が納得いくまで、評価する人が理由を説明する」というのが趣旨です。 評価者と被評価者の間に信頼関係があれば非常によい制度ともいえます。 そして、それが狙いであることも、また、理解できます。 しかし、残念ながら、私たちの部門ではその信頼関係を築こうとすらしない（あるいは、築き方がわからない）方もいます。 もっと前にこの制度になっていれば、その方は評価側にはなれなかっただろう、というのが、共通の見解です。 また、その延長として、成果だけでなくプロセスも評価する、というのが、従来の成果主義とは違うところだというのですが。 極端な話、結果が出なくても残業を沢山していれば「頑張っている」として評価されるのであれば、結果的に成果主義というのは名前だけで、評価方法は変わっていないことになります。 その名前だけ成果主義は、この4月から正式に実施されることになりました。\n人事評価システムの目的は、個人の業績を向上させることにより会社の業績を向上させることであり、給与や賞与を決めるというのは評価システムの機能であって、目的ではない。 いくら詳細な評価基準を作成しても、評価における主観性を完全に排除することはできない。 重要なことは「公平な評価」を行うことではなく、「公正な評価」を行うことである。 評価を行うことはマネージャーにとっての責任であると同時に権限でもある。 被評価者や周囲に対して評価についての合理的な説明が行えれば、マネージャーとしての責任は果たしており、多少の評価のズレはマネージャーの裁量権の範囲の内である。 [日経ベンチャーonline　ニッポンの社長へ: 人事評価に「公平」などありえない]\n未来に向けて、評価する際のポイントを引用しておきます。 私自身、いつ必要になるかはわかりませんが。\n","date":"2008-05-31T09:00:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/31/090053/","title":"名前だけ成果主義"},{"content":"次世代といいながら、実は既に実用化されている次世代のブラウザがある。 それは、一度アンインストールしたブラウザだった。\n以上を踏まえて言うと、ブラウザーでこれだけ速度が改善されるのだから、スペックで劣る古いマシンを使っているユーザーほど、次世代ブラウザーを導入するメリットが大きいと言えるだろう。テスト結果も表しているとおり、世代間の差は歴然としている。\n[速度で選ぶ次世代ブラウザー IE 8だけじゃない]\n「Apple Software Update」で、ついインストールしていた「Safari」が、現存する安定版の次世代ブラウザなのだ。 使わないのでアンインストールしていたのだが、先ほどインストールしなおした。\nただし、ベータ版はあくまでテスト用で動作が不安定なこともあり、日常の使用に向いているとは言えない。今すぐ使えて安定しているという点から言えば、Safariが現時点では最も有効な選択肢になるだろう。Opera 9.5もFirefox3も遠からず正式版がリリースされるので、これらのブラウザーを使っているユーザーは待ってみるのも手だ。\n[速度で選ぶ次世代ブラウザー IE 8だけじゃない]\n確かに言われてみれば表示が速い。 ただ、あくまでMacのスタイルを貫いているからなのか、色使いやフォントに違和感がある。 まあ慣れだろうが。 しかし、速いとは言っても使っている機能が使えないのは困る。\n引用する時に適切にHTML化してコピーできる「楽々引用」を使うことにした。\n[「楽々引用」を使ってみた - 日曜プログラマのそゞろ事]\nブログ用に「楽々引用」を使っているのだが、これはコンテキストメニューから使うものなので、なんとかIE系にも頑張ってもらって、Sleipnirを使うか。 Safariの右クリックを拡張するツールか何かがあればいいのだけど…。\nだがIE8の場合、次期Windowsと同時リリース予定のため、2009年末～2010年まで待たなければならない。JavaScriptを活用したサイトは今後も更に増えていくことが予想されるだけに、IEユーザーには厳しい状況だろう。IE7でJavaScript処理系を改善するという計画は聞かないので、ウェブアプリケーションを頻繁に利用するIEユーザーは、ほかのブラウザーへの乗り換えや併用を検討してみるのが良いかもしれない。\n[速度で選ぶ次世代ブラウザー IE 8だけじゃない]\n記事によると、次世代IEはかなり先になりそうだ…。 とりあえず、この記事はSleipnirで引用しながらSafariで書いてます。\n","date":"2008-05-18T03:07:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/18/030730/","title":"速度で選ぶ次世代ブラウザ"},{"content":"ブログ上のサンプルをウェブサービスというのもどうかなとは思うけど。 十分にサービスです。\nちょっと個人的なはっく。車輪の再発明の公算大ですが。favicon.icoを作るプログラムの書き方です。\n[404 Blog Not Found:perl - Imagerでfaviconを作る]\nfaviconを新しく作るのって面倒なんですよね。 ソフトを入れるところからやらないといけないし。 かなり便利です。\n","date":"2008-05-18T02:13:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/18/021330/","title":"faviconを作るウェブサービス"},{"content":"理事会で議長を務めながら、いつも考えていた。 もっとうまく会議を進める方法が無いのかと。\nミーティングをするときはいつもホワイトボードを用意してもらっています。これがあるとないとでは参加者のストレスレベルが全然違う、と個人的に思っていますです。\n[ストレスフリーのホワイトボード術 | IDEA*IDEA]\n応急処置的にホワイトボードを使おうと思ったが、あいにく小さなものしかなく、結局この技は使えなかった。 そこで、紹介されていた本「すごい会議－短期間で会社が劇的に変わる！」を読んでみる事にした。 そして、その本でコーチングという手法を知ることになる。\n…といっても、会議ですぐに使えたわけではないけれど、その中で一つだけインストールされたことがある。 「何故○○と思う？」ではなく「どのようにすれば○○と思う？」というように質問をすることだ。 それ以来、コーチングという手法に興味が出てきて、色々と見て回るようになった。\n双方向のコミュニケーションであること（インタラクティブ） 継続的にコミュニケーションを交わすこと（オンゴーイング） 相手にあったコミュニケーションスタイルをとること（テーラーメイド）\n[コーチングの3原則　|　coach21]\nコーチングされてみたいと思った。\n","date":"2008-05-10T19:57:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/10/195757/","title":"コーチングとコミュニケーション"},{"content":"答えから言うと意識したことがありません。 むしろ全てにおいて逆行している気がしました。\n京セラの創業者　稲盛和夫さんの名言に「楽観的に構想を練り、悲観的に計画し、楽観的に実行する」という言葉があります。\n[楽観思考と悲観思考を上手に使い分けていますか？ - モチベーションは楽しさ創造から]\n構想を練るときにあーだこーだ言われ計画倒れどころか構想倒れになってしまうこともよくあります。 で、計画段階では、詳細は実施してから考えよう、という甘い言葉に詰めの甘い計画のまま見切り発車をしてしまう。 そして、いざ実施してみると色々と問題が発生してくる。 まあ、当然といえば当然。 自分自身が反面教師であります。\n今後はこの思考の切り替えを周囲に植えつけるように行動するようにしたいですね。\n","date":"2008-05-10T18:53:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/10/185301/","title":"思考の使い分け"},{"content":"読んでいて共感した。 逆の意味で。\nしかし、技術は顧客に使われてこそ初めて生きるものだ。単にスペックがいくらすごくても、それを使いこなせるユーザーがほとんどいないような技術に意味はない。\n[答えは顧客が教えてくれる :: INSIGHT NOW!]\nハードウェアだけでなくソフトウェアもそう。 使えてこそ便利な道具なのだ。\nしかし、WordやAccessくらい使えてもよいのではないか？ 目の前にパソコンがあっても、Excelとゲームにしか使わないのなら意味が無い。\n私が勤める会社は、パソコンの導入はそれなりに早かった。 しかし、それはワープロの代用品という位置づけのようだった。 大半の人は従来からのスプレッドシートの代用であるExcelを使うのが精一杯。 一部でWordで文書を作る人もいたが、文書はワープロ、表などはExcelというのがほとんどだった。\nそれがほぼ10年前の話。\n3年ほど前に労務管理をネットワークを介して行うようになった。 その後も総務や経理に関係する一部だけIT化が急速に進んだ。 しかし、他の状況は昔とほとんど変わらない。 大半の人はExcelは使えるがWordは難しいと言っている。 ワープロが無いので、そういう人たちはExcelで議事録や報告書を作っている。\n先日、文書の様式が（改めて？）制定されたが、報告書や議事録はExcel用も用意されていた。 Word用も罫線だらけで、印刷してから手書きするのかと思うほどだった。レイアウトを変えるなといわれるのなら、Excel用で作ったほうが遥かにマシだ。 Wordで書く文書に、何故罫線が必要なのか？\nデータベースにしてもそう。\nExcelを万能ソフトと思っているからか、それとも単純にExcelしか使えないからか、データベースをExcelで作ろうとしている。 話を聞けば顧客データベースで、いずれ全社で情報を共有したいとのこと。 他の支店で同じ会社と取引があってもわからないので、それを解消したい、という話なのだが。 Excelはファイルの共有に向いていない。 全社で使うとした場合、対象は300人程度だろうが、同時に使用する可能性はかなり高いはずだ。\n少し前（？）にExcelをベースにした予算管理のシステムが作られていた。 予算入力の時期はみんな忙しい。 そんな時期に「保存できない」という問題が頻発していたのは誰もが知っているはずなのに。 本格的に実施してから使い物にならないシステムだったことがわかっても遅い。\n素直にプロに頼むか、Accessで作るように提案してみたが、無駄でした。\nそんな出来事があったので、私は情報システム部門へ職種変更を希望しました。\n","date":"2008-05-10T18:41:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/10/184116/","title":"技術の意味"},{"content":"目の付け所がいいですよね。\nWebサイトの上部が“一等地”ならば，ケータイの待ち受け画面も相当な一等地なはずだ。こうした待ち受け画面の使い方は，パーソナルな情報入手という側面がまだまだ強い。しかし，ケータイを開く（見る）だけで最新情報を得られるならば，利用法は個人にとどまらない。BtoCでの利用はもちろんだが，BtoBでも大いに活用できるインタフェースではなかろうか。\n[ケータイの“一等地”を企業が活用する日：ITpro]\nWindowsのデスクトップにはWebを表示することができます。 携帯がパソコン化してきているのでしょう。 携帯はiモードをはじめとする携帯仕様のページばかりでなく、フルブラウザも使えるようになっています。 パソコンに既にあるものをどんどん取り入れるのはそれはそれでいいと思います。\nしかし、パソコンでも軽量重視のモバイルノートがあるわけですから、携帯電話には携帯電話独自の何かを考えていくのも一つの方向性ではないでしょうか？\n","date":"2008-05-10T17:20:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/10/172028/","title":"携帯の待受画面の活用"},{"content":"「知らぬが仏」という言葉がありますが、知らないからこそ平気なこともあります。\n人間とは不思議な行動を起こします。何不自由なく満足している状態から、もっと上の良いものを見せられるとついそこまで自分の欲求度が高まり、現状に不満を持つ。これが単なる機械だけの世界であれば問題ありませんが、人間の世界ではどこでも同じです。\n比較の罠｜人事制度は社員を成長させる仕組み\nマンション管理を考えた時、管理会社のフロントは大切です。 そのフロントの対応の良し悪しは、これまでどんなフロントに会ってきたかで印象はずいぶんと違うものになるでしょう。 担当によって能力が違うのは仕方がありません。 しかし、同じ管理会社に委託しているわけですから、担当者が変わったとしても同じ質を求めるのは当然のことです。 逆に、同じ管理会社に敏腕のフロントがいるという噂を聞いたとき、そのフロントに変わってほしいという思いを抱くのもしかたないことでしょう。\nただ、会社の場合はそう割り切れるものでもありません。\n会社の中でも同じです。優秀な社員がいても、もっと優秀な社員がいると今までの優秀な社員は優秀でないように見える。そうやって比較することによって大切なものを失って生きています。\n比較の罠｜人事制度は社員を成長させる仕組み\n絶対値をクリアしていても、一番でない限り評価は低くなってしまいがちです。 比較をするなら、自分自身の中に基準を持っておき、それと比較するようにしたいですね。\n","date":"2008-05-10T12:08:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/10/120858/","title":"知識と欲求の関係"},{"content":"基本的には「Perlメモ/モジュールのインストール(CPAN) - Walrus, Digit.」にある情報に従っていきます。 現時点で変わっている部分を中心に補足します。 しかし、結果的に挫折しましたので、試行錯誤の記録になっています。 個人的にはモジュールを自分の環境に合わせて変更することで落ち着きました。\nActivePerlがインストールされた状態からスタートします。\nActivePerl配布場所からダウンロードできます。 名前などを入れる場所がありますが、全てオプションなので、入力しなくてもダウンロードできます。\n「tarとgzip」は問題ないでしょう。\n「texinst756.zip」 [Index of /pub/text/TeX/ptex-win32/current] あるいは、その最新版を手に入れます。\n続いて「makeとCコンパイラ」です。 「Visual C++」 [Visual Studio 2008 Express Editions] をインストールします。 （最小限でインストールしても概ねOKのようですが、msvcr90.dllが見つからないエラーの関係でオプションをつけて改めてインストールしたため検証は出来ていません（詳細は後述）。）\nここまできたらcpanをセッティングします。 最近のActivePerlでは、binフォルダにcpan.batがあるので、コマンドプロンプトでbinフォルダ（デフォルトなら\u0026quot;C:\\Perl\\bin\u0026quot;）に移動して「cpan」とタイプすれば起動できます。 （pathが通っていれば「ファイル名を指定して実行\u0026hellip;」（ショートカット：windowsボタン＋R）から「cpan」とかも可能。）\nコマンドプロンプトですが、プログラムメニューから「Visual Studio 2008 コマンド プロンプト」を使うとpathの設定が少ないのでよいと思います。 （スタート→すべてのプログラム→Visual C++ 9.0 Express Edition→Visual Studio Tools→Visual Studio 2008 コマンド プロンプト）\n起動すると、以下のような画面になると思います。\n1 2 Setting environment for using Microsoft Visual Studio 2008 x86 tools. C:\\Program Files\\Microsoft Visual Studio 9.0\\VC\u0026gt; 私はActivePerlのインストール先を「D:\\usr」に変更していますので、そちらに移動し、cpanを起動します。\n1 2 3 4 5 6 C:\\Program Files\\Microsoft Visual Studio 9.0\\VC\u0026gt;d: D:\\\u0026gt;cd usr\\bin D:\\usr\\bin\u0026gt;cpan cpan shell -- CPAN exploration and modules installation (v1.9205) ReadLine support enabled cpan[1]\u0026gt; （ブログを書く前にセッティングをしているので多少の違いはあるでしょうが、あまり細かい部分は気にしないでいきましょう。）\ncpanの初期設定は、cpanが起動した状態から「o conf init」と入力します。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cpan[1]\u0026gt; o conf init Use of uninitialized value $_ in transliteration (tr///) at D:/usr/lib/File/Spec /Win32.pm line 141. Use of uninitialized value $_ in pattern match (m//) at D:/usr/lib/File/Spec/Win 32.pm line 143. Use of uninitialized value $_ in transliteration (tr///) at D:/usr/lib/File/Spec /Win32.pm line 141. Use of uninitialized value $_ in pattern match (m//) at D:/usr/lib/File/Spec/Win 32.pm line 143. CPAN is the world-wide archive of perl resources. It consists of about 300 sites that all replicate the same contents around the globe. Many countries have at least one CPAN site already. The resources found on CPAN are easily accessible with the CPAN.pm module. If you want to use CPAN.pm, lots of things have to be configured. Fortunately, most of them can be determined automatically. If you prefer the automatic configuration, answer \u0026#39;yes\u0026#39; below. If you prefer to enter a dialog instead, you can answer \u0026#39;no\u0026#39; to this question and I\u0026#39;ll let you configure in small steps one thing after the other. (Note: you can revisit this dialog anytime later by typing \u0026#39;o conf init\u0026#39; at the cpan prompt.) Would you like me to configure as much as possible automatically? [yes] 「Use of uninitialized value」というエラーが出ることがあります（ここでは出ています）が、一応は無害なのでここでは無視します。 最後の質問は「できるだけ自動的に設定しますか？」と訊かれています。 [yes]は、省略してEnterを押したときに「yes」と入力されたことにする、という程度の意味です。 ここでは、ひとまず、プログラムに任せて設定してもらいます。\n1 2 3 4 Autoconfigured everything but \u0026#39;urllist\u0026#39;. Please call \u0026#39;o conf init urllist\u0026#39; to configure your CPAN server(s) now! commit: wrote \u0026#39;D:\\usr\\lib/CPAN/Config.pm\u0026#39; cpan[2]\u0026gt; 「urllist」以外は設定されているはずです。 ついでなので「urllist」も設定しておきましょう。 設定するときは「o conf init urllist」です。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 cpan[2]\u0026gt; o conf init urllist Use of uninitialized value $_ in transliteration (tr///) at D:/usr/lib/File/Spec /Win32.pm line 141. Use of uninitialized value $_ in pattern match (m//) at D:/usr/lib/File/Spec/Win 32.pm line 143. Use of uninitialized value $_ in transliteration (tr///) at D:/usr/lib/File/Spec /Win32.pm line 141. Use of uninitialized value $_ in pattern match (m//) at D:/usr/lib/File/Spec/Win 32.pm line 143. Found D:\\usr\\cpan\\sources\\MIRRORED.BY as of Tue May 6 10:14:04 2008 I\u0026#39;d use that as a database of CPAN sites. If that is OK for you, please answer \u0026#39;y\u0026#39;, but if you want me to get a new database now, please answer \u0026#39;n\u0026#39; to the following question. Shall I use the local database in D:\\usr\\cpan\\sources\\MIRRORED.BY? [y] Now we need to know where your favorite CPAN sites are located. Push a few sites onto the array (just in case the first on the array won\u0026#39;t work). If you are mirroring CPAN to your local workstation, specify a file: URL. First, pick a nearby continent and country by typing in the number(s) in front of the item(s) you want to select. You can pick several of each, separated by spaces. Then, you will be presented with a list of URLs of CPAN mirrors in the countries you selected, along with previously selected URLs. Select some of those URLs, or just keep the old list. Finally, you will be prompted for any extra URLs -- file:, ftp:, or http: -- that host a CPAN mirror. (1) Africa (2) Asia (3) Central America (4) Europe (5) North America (6) Oceania (7) South America (8) (edit previous picks) Select your continent (or several nearby continents) [8] 2 (1) China (2) Hong Kong (3) Indonesia (4) Israel (5) Japan (6) Korea (7) Pakistan (8) Republic of Korea (9) Russia (10) Saudi Arabia (11) Singapore (12) Taiwan (13) Thailand (14) Turkey (15) (edit previous picks) Select your country (or several nearby countries) [15] 5 (1) ftp://ftp.dti.ad.jp/pub/lang/CPAN/ (previous pick) (2) ftp://ftp.jaist.ac.jp/pub/CPAN/ (previous pick) (3) ftp://ftp.kddilabs.jp/CPAN/ (previous pick) (4) ftp://ftp.nara.wide.ad.jp/pub/CPAN/ (previous pick) (5) ftp://ftp.ring.gr.jp/pub/lang/perl/CPAN/ (previous pick) (6) ftp://ftp.u-aizu.ac.jp/pub/CPAN (previous pick) (7) ftp://ftp.yz.yamagata-u.ac.jp/pub/lang/cpan/ (previous pick) (8) http://ppm.activestate.com/CPAN (previous pick) (9) http://cpan.perl.org (previous pick) Select as many URLs as you like (by number), put them on one line, separated by blanks, hyphenated ranges allowed e.g. \u0026#39;1 4 5\u0026#39; or \u0026#39;7 1-4 8\u0026#39; (or just hit RETURN to keep your previous picks) [1 2 3 4 5 6 7 8 9] 1-9 Enter another URL or RETURN to quit: [] New set of picks: ftp://ftp.dti.ad.jp/pub/lang/CPAN/ ftp://ftp.jaist.ac.jp/pub/CPAN/ ftp://ftp.kddilabs.jp/CPAN/ ftp://ftp.nara.wide.ad.jp/pub/CPAN/ ftp://ftp.ring.gr.jp/pub/lang/perl/CPAN/ ftp://ftp.u-aizu.ac.jp/pub/CPAN ftp://ftp.yz.yamagata-u.ac.jp/pub/lang/cpan/ http://ppm.activestate.com/CPAN http://cpan.perl.org Please remember to call \u0026#39;o conf commit\u0026#39; to make the config permanent! cpan[3]\u0026gt; Asia→Japan→すべて（「1-9」など）としておき、それ以外の質問にはデフォルトで問題ないでしょう。 仕上げに、変更したurllistを保存するためにコミットしておきます。\n1 2 3 cpan[3]\u0026gt; o conf commit commit: wrote \u0026#39;D:\\usr\\lib/CPAN/Config.pm\u0026#39; cpan[4]\u0026gt; cpanはこれで設定完了です。 多くはこの状態でインストールが可能でしょう。 しかし、実行時に「msvcr90.dllが見つからない」というエラーが出る場合があります。 当初は「Visual C++」をインストールする際に、最小限（オプションを全てはずして）でインストールしましたが、このエラーが出たため、改めてオプションを全てチェックして再インストールしました（結果的に「Microsoft Silverlight runtime」はインストールに失敗）が、それでもエラーは出たままでした。 念のため「vcredist_x86.exe」 [ダウンロードの詳細 : Visual C++ 2008 再頒布可能パッケージ (x86)] をダウンロードしてインストールしてみましたが、解決しませんでした。 その後、msvcr90.dllと同じフォルダにあるファイルをすべてpathの通ったところにおいて実行してみましたが、今度はランタイムエラー（R6034エラー）になってしまいました。\nいろいろ調べたところ、原因が「ExtUtils::MakeMaker」にあるのではないかという記述を見つけました。\nExtUtils::MakeMaker モジュールが Windows 版 ActivePerl 向けに生成する Makefile は、Windows XP (および Windows Server 2003) + Visual C++ 2003/2005 の環境 (いや、実際、VC++ 2003 では試したことないので知らんのですが、システム DLL に Manifest の概念が導入されたのがどうやらこいつかららしいので、多分間違いないかと) で nmake → nmake install しても、use する際に R6034 エラーが発生してモジュールのロードに失敗してしまうという問題があります。\n[Visual C++ 2003/2005 で perl モジュールを nmake できるようにするためのパッチ: 国民宿舎はらぺこ 大浴場]\n1年以上前の記事なので、不思議に思いながらソースを見てみました。 結果からすると原因はおそらく「$Config{ccversion}」です。 「perl -V」でperlがどのようにコンパイルされたのか等の細かい情報が出てきますが、ActivePerl(5.10.0 Build 1002)は、この「ccversion」が「12」なのです。 おそらくこの数字が使われているのでしょう。 manifestの概念が導入されたccversionは14以降らしく、ExtUtils::MM_Win32のソースコードにもその記述がありました。 本来であれば、perl本体に使用したCコンパイラを使う、という想定でしょうから、ソースコードとしてもおかしくは無いと思います。 現在の環境のccやccversionを設定する処理をどこかにいれておけばいいのでしょうかね？\nExtUtils::MakeMakerは、最新版(ExtUtils::MM_Win32が 1.15のやつ)を入れれば、パッチを当てなくても大丈夫でした。\n[Windowsのフリーウェア、フリーソフトを紹介 - KOCのブログ | Windowsで、CPANからモジュールを入れる方法（補足）]\n気になったので1.15のソースも見てみましたが、処理の仕方は同じでした。 とりあえず、自分の環境だけなら問題ないので、バージョン判定の部分を削除して使うことにしました。\n1 2 # if ($Config{ivsize} == 4 \u0026amp;\u0026amp; $Config{cc} eq \u0026#39;cl\u0026#39; and $Config{ccversion} =~ /^(\\d+)/ and $1 \u0026gt;= 14) if ($Config{ivsize} == 4 \u0026amp;\u0026amp; $Config{cc} eq \u0026#39;cl\u0026#39;) 何か良い方法を思いついたら書くことにします。\n","date":"2008-05-06T20:28:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/06/202852/","title":"ActivePerl(5.10.0 Build 1002)でcpanを本気で使いたかった"},{"content":"記事を見て「ん?」と思った。\nUSBメモリに限らず、外付けHDDでもFAT32でフォーマットされていればWin/Macでの両用が可能だ。大容量で大量のファイルを一気に移動したい場合などはHDDのほうが有利だろう。\n高橋敦の「Macでいいじゃん!」第14回：いまさらですが、Mac\u0026amp;Winでフォルダ共有を行うには? - ITmedia +D PC USER\niTunesのデータ移行をしたときにNTFSでも共有が出来ていた。 Windows (XP) でUSBの外付けHDDをNTFSでフォーマットし、そのHDDにデータをコピー。 で、それをMac (10.5.2) で普通に読み込めた。 Intel Macだから? データの移行自体はPeace Pipe: Windows から Mac へ iTunes のデータ移行 [mac]を参考にした。\n","date":"2008-05-05T13:07:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/05/130701/","title":"NTFSでもMacとWindowsの共有ができた"},{"content":"何かを始めるとき、心構えがすべての始まりです。\nここで、参考になるのが、プレゼン直前の心構えの部分。大事なプレゼンの直前、どうしても緊張してしまい、肝心な事を忘れてしまいます。そんな時、私はこの本で学んだプレゼンの心得をマインドマップにしており、それを講演10分前に読んで、ステージに上がるようにしています。これを読まずにプレゼンに望むのと、読んで望むのとでは、プレゼンの力強さが自分でも違っていると思います。プレゼン直前、自分のモチベーションアップにも繋がります。\n人を惹き付け力強いプレゼンを実現する～プレゼン直前7つの心得 - モチベーションは楽しさ創造から\n人前で話をするプロでも本番前は微妙に緊張するのでしょう。 しかし、物事にはコツがあるのですね。\n大胆にプレゼンしろ 全ての人を感心させる事は諦めろ プレゼンの成功を信じろ 自分を信じろ 重要人物として振る舞え 断固とした口調で話せ 3回繰り返せ 人を惹き付け力強いプレゼンを実現する～プレゼン直前7つの心得 - モチベーションは楽しさ創造から\nある意味開き直りの部分もありますが、ちょっとしたコツでうまくいくようになるのはよくわかります。 プレゼンテーションだけでなく、いろいろな人と話すときにも役立つようなコツですね。\n","date":"2008-05-05T01:00:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/05/010007/","title":"プレゼンの心構え"},{"content":"脇役よりも主役が良いに決まっている。 多くの人がそう思っているのではないでしょうか？\n「主役」と違い、「名脇役」でよければいろんな個性で大丈夫。\n主役だけが際だつ時代から、脇役が大事にされる時代に - モチベーションは楽しさ創造から\n思っていても脇役に徹するというのはなかなか難しいと思う。 しかし、しばらく前に流行ったSMAPの有名な歌にもあるように「世界でひとつだけの花」が必要な時代になってきているのかもしれない。\n","date":"2008-05-04T23:19:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/04/231959/","title":"名脇役の時代がやってきた"},{"content":"モチベーションを維持するのはスポーツには欠かせない。 そのテクニックを仕事にも活かすやり方。\n自分がカッコイイと思うスポーツ選手（監督などでもOK）を一人選ぶ そのスポーツ選手を「なぜ、自分はカッコイイ」と思うのか？を具体的に書き出す その具体的にカッコイイ所」を自分の役割に当てはめてみると、どういう事になるかを書き出す（自分の目標像づくり） 目標像を見直す時に、そのスポーツ選手のカッコイイプレーも同時に思い出す。 出典: スポーツを楽しみながら、自分のモチベーションを掻き立てる仕組みを - モチベーションは楽しさ創造から\n私自身はスポーツにはあまり興味が無いのでそれほどでもないですが、他人に説明するときにわかりやすい。\n","date":"2008-05-04T23:09:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/04/230915/","title":"モチベーションを掻き立てる仕組みをスポーツから考える"},{"content":"私の場合は、プログラムを共同で作ることはないので実感はないが、大勢で作る場合は、まさに建物工事と同じだろう。\nちなみに、私はちょうど家を建てているところだが、必ずしも私が図面から想定した通りに建つとは限らないのが難しい。まあ、私がちゃんと図面を読みこなせていないのも悪いのだが、「あ、ここ思ったのと違うんで少し変えてくれませんか」と頼むと、「できるけど、やり直しになるからお金かかるよ」と言われるので我慢をしたりしている。\n[Life is beautiful: 建物と違って、一見簡単に修正が利きそうなのがソフトウェアの問題点かな、と]\n建物の工事で問題なのは、結構な確率でやったもの勝ち、な感があるところ。 やはり、この分野も説明責任というのが必要なのではないかと。 工事する側としては工事する側の常識というのがありますので、適当に端折るわけです。 ちゃんと説明していないのに工事をやってしまい、発注者から変えてほしいと言われた時に「やり直しだからお金がかかる」というのは、結果的に、工事する側の常識を発注者に押し付けている、という事になりますよね。 決して悪意があってやっているわけではないでしょうが、もう少しどうにかしないといけないでしょうね。\n図面だけではどうしてもわかり辛い所がある。 なので、細かい図面を作ってもらってそれを確認するわけですが、図面というのは作るのにも結構手間がかかるものなので、現場の代理人がしっかりとした人じゃないと図面が後手にまわります。 図面が手元に来たころには、すでに完成している、ということもあったり、また、完成していなくても部品ができてしまっていて変更ができない、ということもあります。 つまり、やり直しになるので製作時間とお金がかかります。 まあ、そういうことが無いように、事前に厳しく言って（通知して）おく必要があるのですが。 発注するすべての人がそれが出来るわけではないですよ。\n","date":"2008-05-02T20:39:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/02/203958/","title":"簡単に修正がきかない事の問題点"},{"content":"6月の最初の日曜日に現在住んでいるマンションの定期総会を実施する予定です。 その前に、3月末に以前住んでいたマンションの定期総会に出席しました。 輪番制にして5期目になるでしょうか。 総戸数が31で、役員は5人、その内1人が留任するわけですから、毎年4人が新しく役員になるわけです。 輪番制になる前の役員を除けば、7期で一周する計算です。 手元の資料によると、今期の役員を除いて未経験の家は後5軒です。 来期は現状のままいけますが、来期のうちにシステムを考えないと、2010年の3月に行われるであろう定期総会で役員のなり手がいなくなってしまいます。\nこのマンションでは、私が理事長をやっていた時にした約束があります。\n以前理事長をやっていたマンションは、31戸で役員が5人。 候補者に困って輪番制を導入したものの、うまく稼動しているのかよくわからない。 先日、総会に出席したが、新旧役員以外は私とあと一人だけ。 ただ「理事長は、監事として次期役員に再選するよう努める」という条件は守られているようです。 マンション管理についての情報収集\n今期もきっちりと守られていました。一応は機能しているようです。\nしかし、実際には少しずつほころびが出来ています。 2年ほど前にフロントマンが変わりました。 丁度フロントマンが変わってから3年が経ったでしょうか。 今の管理会社になってから3人目になります。\nオブザーバー制度ということで、役員経験者には理事会の開催案内を送付していましたが、それがいつの間にかなくなりました。 前期の理事会でそういう決定があったのだと思うことにしました。 議事録を全戸に配布することにしていましたが、それがなくなりました。 特に個人情報の関係で管理会社も神経質になっていることもあり、これも前期の理事会で決まったのだと思うことにしました。 しかし、総会で確認したところ、そのような事実は無く、ただ単にフロント同士の引継ぎが不足していたことに尽きます。 先日の総会でそれが発覚しました。\nやはり、「管理会社の価値は担当者で決まる」なのです。\n管理会社変更のときは、決して手を抜いて管理をするような会社ではありませんでした。 しかし、担当者が変わるごとに担当者（管理会社）の熱意は薄れていきました。 結局、建設当時からの問題である「自転車置き場」についてもいまだ解決できていません。 管理費、修繕積立金の値上げについても、何も変わっていません。値上げしなければいざという時に一時金として支払うしか方法がないのに、です。\nそして気づきました。 「外部の目」でみると、こんなにもよく見えるものかと。 理事長に対して問い詰めたくなるものなのかと。\n私も、今のマンションでは色々と叩かれています。 自分勝手で強引だ、口ばっかりで行動が伴わない、など。\n前者の例だと、NPO法人に加入したい、という話を理事にちゃんと理解を得られないまま総会に諮ったことがありました。 そのNPO法人は、略称で「NPO集改センター」といい、管理組合会員となることで、顧問を雇うよりは安く知恵を借りることが出来ます。 また、管理会社に対しては根拠を持った提案・指示が出来るようになる、という利点もあります。 説明してもあまりピンと来ないのは、管理会社がいるのに「知恵のある第三者」が必要な理由がわからないからだと思います。 しかし、総会で反対意見が多かったため、希望者を募った上で説明会を開き、その上で改めて理事会で決議をすることにしました。 結果的に、「管理会社には専門家が沢山いるのだから、そちらを活用したらどうか」という、私からすれば根本的に論点の違う意見に賛同者が多く、加入は（しばらくは）見送ることになりました。\n後者の例では、コミュニティ便りという名前の管理組合報を発行したことがありました。 毎月発行していましたが、第6号を未だに（前号から半年ほど経っています）発行していません。 あと、皆の意見を募集しておきながら、その意見書に回答をしない、という事もありました。 管理組合への意見に対して、書いた本人宛に回答する必要性を感じていないため、私からすれば当然のことでした。 回答は管理組合全体に対して、理事会の活動として回答するものだと思っています。 しかし、書いた本人は「書いた本人宛に回答しないと、名前を書いた意味が無い」という意見を書いてきました。 意見には部屋番号と氏名を明記することを条件としていましたが、それは不明な部分があった場合に質問を行うことと、変な意見を防止することが大きな目的であり、回答する先を考慮したものではありません。 結局、最初の質問から半年後に本人宛に回答しました。 その間、回答が無いという苦情が頻繁に寄せられていました。 私としては理事会の活動としてでなく、回答書を作るためだけの検討が必要になったのは不本意でした。\n私自身、この状況と、そう言いたくなる気持ちを理解できます。 それは、冒頭にも書いた、私自身が以前住んでいたマンションで、私が行っている事とあまり変わりません。 第三者の立場で見ると、私だったらもっとうまく出来た、という気持ちを抱いてしまうのだと思います。\n","date":"2008-05-02T19:48:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/05/02/194841/","title":"近づく定期総会"},{"content":"トランス脂肪酸の危険性については何度も聞くのですが、それでも食べてしまうのは何故でしょうか？\nアメリカの自然派労働家のフレッド・ロー氏がある実験でマーガリンとバターを窓の外に同じ条件で置いておきます。バターにはハエや他の虫がたかり、カビが生え、その姿が変わっていきました。ところが、マーガリンはと言えば、虫1匹寄り付かず、カビもはえません。そのまま融けることもなくホコリがかかって黒くなっていったのです。なんと2年もそのままだったそうです。結果、彼は「マーガリンは食べ物ではなく、食べられる形をしたプラスティックなのだ」と結論づけています。\nマーガリンは今すぐ捨てなさい！ :: INSIGHT NOW!\n脂肪専門の化学者たちは現に水素添加することを「オイルをプラスティック化する」というそうです。\nマーガリンは今すぐ捨てなさい！ :: INSIGHT NOW!\n記事を探せばいろいろと出てきます。\n「フレッド・ローのマーガリン大実験」・「腐らないフライドポテト」・「常温保存のショートニング」。これらに共通するのは、トランスファットを含む油脂を使っているということです。 水素添加した油脂は、変質しにくく日持ちするという特性から多くの加工食品に使用されていますが、これは防腐剤の代わりのプラスチックコーティングであると言っては言い過ぎでしょうか。\nトランスファット注意報-バーガリンのススメ-/トランスファットとは？/「狂った油」は腐らない！\n摂取に伴うリスクとして指摘されているのは、主として虚血性心疾患の発症と認知機能の低下[9]である。\nトランス脂肪酸 - Wikipedia\nプラスチックを食品として売っていれば、いずれ製造者責任を問われる事になると思うのですが、どうなのでしょう？ いくら規制されていないとはいえ、多くの国で使用禁止に向かっているものを「飽食」と言われている日本で使う必要があるのでしょうか？ …という風に思うのですが。 冷静に考えると、実験に使ったマーガリンと、普段口にしているマーガリンがまったく同じものなのか、という疑問もあります。 家庭ではこの手の実験はしたくはありませんが、普段使っているものがどのくらいプラスチックなのか確かめてみたくなります。\n","date":"2008-04-15T00:36:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/15/003627/","title":"マーガリン=おいしいプラスチック"},{"content":"「一期一会」という言葉はふさわしくはないかもしれないが、その言葉を感じずにいられない。\n「上司のたまたまは、部下の日常である」こと忘れちゃいけない。\n出典: 同行巡回が終わって（第112回）｜上司として知っておきたい、いくつかの事柄 ～\n部下から上司を見ていると、確かにそういう風に見える。 私自身が上司と接している間が、私にとって上司のすべてなわけで。 まあ、逆もまた真なり、とは思います。 たまたま部下がサボっているときに上司に見つかったりすると「いつもサボっている」と思われるわけです。 \u0026hellip;いや、別に私のことってわけでは\u0026hellip;。\n","date":"2008-04-15T00:07:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/15/000744/","title":"上司と部下と偶然"},{"content":"書評を読んでいて気になったので。 まだ読んではないけれど。\nどんな仕事も楽しくなる3つの物語 福島 正伸 きこ書房 売り上げランキング: 20\n仕事が感動に変わる、五つの心構え\n仕事の意味を考える ものごとを前向きに受け止める 自己原因で考える 自分の可能性を信じて、自分らしくやる 目指すことを、あきらめない 「心構えが変わると人生が変わる。」という言葉がある。 時には考えることをやめて、人生が変わると信じて、心構えを変えてみよう。\n","date":"2008-04-14T23:51:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/14/235134/","title":"仕事が感動に変わる、五つの心構え"},{"content":"ここ最近、エスプレッソマシンを手に入れたこともあって、コーヒーネタに少し敏感になっている。\nおいしいお店の見つけ方は、ネット時代では簡単で、「住んでいる地域 自家焙煎」でググれば近くのお店が出てきます。自分の足で探しても良いですね。\n2008-03-19 - reponの日記#1205879484\nこの記事を見て、ミルで挽くのもいいなぁってことでコーヒーミルを買った。 手で挽くのは結構大変だが、引き終わった後の粉の香りは格別です。 自家焙煎の店も探してみたくなります。 こういったものにも「刷り込み」があるのか、初めて自宅のエスプレッソマシンで使った豆である、成城石井の「カフェイタリアーノ」がかなりおいしい。 この時はレジで挽いてもらったのだが、挽いている間の香りはなかなか癖になる。 問題は、時々蒸気が注水口からあがって(逆流して)くること。 マシン自体が安物のせいか、それとも粉が詰まっているのかは不明だが。\n","date":"2008-04-08T20:14:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/08/201414/","title":"思わず淹れてみたくなるコーヒー"},{"content":"人は成長する。 そして、ある程度成長すると思考などがある程度固まって安定（あるいは成熟）する。 それは会社も同じ。\nだが、それまで授業料が高額だった英会話業界において、数量割引でグループや個人のレッスンの値段を下げるなど革新的な企業でもあった。実際に不祥事が起きる直前までは順調に成長しており、ビジネスモデルに不当性を感じるものの、経営では成功を収めていたといえる。根来氏は、「えげつない企業が業界の競争を促したり、業界の常識を破り新たな市場を作り出すことがある」と強調した。\n悪とは言い切れない経営の「えげつなさ」 - ITmedia エグゼクティブ\nNOVAは成長を目指した会社といえる。 携帯電話の事業でいうとsoftbankも同じだろう。 後から参入するには、それにふさわしい方法がある。 その賛否はともかくとして、だが。\n一方でDCECは、2003年3月にさいたま市で開校した英会話スクールだ。講師すべてがフィリピン女性という特徴を持つ。入会金は一律2万円とし、授業料は月払いベースで1回当たり2500円～7000円。ボリュームディスカウントなど価格競争をせず、中途解約者には1レッスンずつの金額を再計算して返還するシステムである。PR活動はほとんど行わないほか、収益の一部を寄付金に回すなど利益を追求することはない。「（中途解約金においてはNOVAと比べ）誠実だが、成長が望めないビジネスモデル」（根来氏）という。\n悪とは言い切れない経営の「えげつなさ」 - ITmedia エグゼクティブ\n一方こちらは安定した、おそらく収支もバランスの取れている会社。 地味だが、講師は今も安心して働いているだろう。 しかし、このスクールもはじめからバランスが取れていたわけではないだろう。 はじめのうちは生徒数も少なかったに違いない。 ある程度生徒が集まるようになってから「成長が望めない」状態に落ち着いたのではないだろうか？ 教育についての考察がある。\nこの間、日本は成長社会から成熟社会に変わりました。本来、この社会変化は当然であり、人々が目指していたことのはずでした。\n宋文洲のメルマガの読者広場: 日本の教育に思うこと\n成長社会には成長社会に適した教育があった。 ということは、成熟社会には成熟社会に適した教育があるのではないか。 普遍的に良い教育というのはなくて、その時々に応じてふさわしい教育がある。 十分成熟しているのに、無理に成長しようとするから歪みが出てくる。 成熟しているかどうかを見極めることが肝要だと思った。\n","date":"2008-04-08T19:55:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/08/195525/","title":"成長と安定（あるいは成熟）"},{"content":"しばらく前から、外部へのリンクにマウスをあわせると、リンク先のサムネイルを表示するようにした。 それが「リンク先チラ見サービス」だ。\nリンク先チラ見\nSource: HeartRails | A new flavor for your digital life; Accessed Date: 3/17/2008\nインストールはJavaScriptを書くだけなのでとても簡単。 このサイトは、以前「ブラウザの画面をキャプチャする方法」でも紹介したサイトだった。\n","date":"2008-04-08T00:53:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/08/005323/","title":"リンク先チラ見サービス"},{"content":"わかっているつもりになっているが出来ていない事、だと思った。 未だに。\n「下足番を命じられたら、日本一の下足番になってみろ。 そうしたら、誰も君を下足番にしておかぬ」 (小林一三)\n出典: 新人社員に贈る言葉「下足番を命じられたら日本一の下足番に！」 :: INSIGHT NOW!\nはじめはこのタイトル「下足番を命じられたら、日本一の下足番になってみろ。」だけを見て、妙にムカッとして意気込んでやってきた。 しかし、引用している後半部分を見てはっとした。 今まで似たようなことを言われていたはずだったが、今回はこの言葉が意外なほど素直に腑に落ちた。 誰にでもできるような簡単な仕事ばかりやっても面白くない、とか、あんな仕事やこんな仕事がやりたいのにどうして雑用ばかりさせられるのか、とか。 働き始めのころは手が動く前に頭が拒否してしまっていた。 そういうことが続いていると、いざあんな仕事やこんな仕事をできるようになっても、その仕事に対する不満を見つけるようになっていた。 気がつけば仕事が嫌いになっていた。 文句ばかり言うようになっていた。 悪循環だ。 悪循環を断ち切るために、理不尽なことに対してもグッと耐えていきたいと思う。\n","date":"2008-04-08T00:40:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/04/08/004012/","title":"理不尽への対応策"},{"content":"タイトルとURLを取得するだけとはいえ、件数によっては面倒な作業ですが、ブラウザ(Firefox)を使えば意外と簡単にHTML化できるようです。\nちなみに、このリンク集のやり方を不思議に思う人が多いようなので、Tipsですが簡単に説明しますと Firefoxのブックマークに登録→ブックマークの管理→ブックマークをエクスポート→bookmark.htmlの中から、テキストエディターでコピペしたい部分をカット→ブログにペースト→連番をつける くらいの手順で、さほど手間はかかりません。\n出典: 私的なことがらを記録しよう!!: 新インディ感想 その3\nここからは応用編。 リストにするのなら、HTML的にもリストの方がいいでしょうね。\nやりかたは、例によってfirefoxでhtmlファイルを出してから、DTタグをliタグに置換しています。\n出典: 私的なことがらを記録しよう!!: 新インディ感想リンク集 その4\nこういった応用も、プラグインか何かで機能を追加・改良できるようになるといいですね。 Firefoxも使いこなせばいいブラウザだと思うのですが、今のところSleipnirのちょっとした機能が便利で離れられずにいます。 アドレスに入れたURLを新しいタブで開く、という単純なことなのですが、Firefoxの設定にはこれがない。 まあ、新しくタブを開いてからアドレスにURLを入れれば済む話なのですが\u0026hellip;。\n","date":"2008-03-16T13:26:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/16/132606/","title":"リンク集HTMLの手軽な作り方"},{"content":"仕事の関係で、最近完成したマンションを見に行って発見しました。 最近のエレベーターはペットにも対応していたんですね。\n三菱エレベーター・エスカレーター かご操作盤に設けられた「ペットボタン」を操作することにより、各階乗場に「ペット」表示され、エレベーターにペットが乗っていることを他階からのエレベーター利用者にお知らせします。 三菱エレベーター・エスカレーター\nペットと共存できるマンションでは、こういった配慮も必要でしょうね。 ちなみに、ペットボタンはかご内にしかないので、エレベーターを呼ぶときはペット専用ではなく、車イス用の呼び出しボタンを押すようです。\n","date":"2008-03-14T00:27:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/14/002712/","title":"エレベーターのペットボタン"},{"content":"そもそもの出会いは、新婚旅行のときに妻が買ったCDアルバムの「Deep Blue」であった。 その中でもタイトル曲はやはり良い。 オフィシャル\nKeiko Matsui\nMySpace\nMySpace.com - Keiko Matsui - Jazz / Nu-Jazz / Ambient - www.myspace.com/keikomatsuimusic\nピアノって弾く人によって、何故ここまで音が違うのだろうか？ 家のピアノを弾いても感じることがある。 妻が弾くのと私が弾くのとでは、本当に同じ楽器なのか疑いたくなる。 最近気になった曲。 まあ、タイトルが意味するところはよくわからないのだが。 Keiko Matsui - 1942, from Russia\n","date":"2008-03-09T00:39:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/09/003911/","title":"Keiko Matsui"},{"content":"かなり前にTVで見て、気になったのだが、調べるのを忘れてしまっていた。 それが、たまたま見たニュース番組のBGMを聴いて思い出した。 という事で調べてその曲が「Sky!Sky!Sky!」ということを突き止めた。\nDEPAPEPE official website depapepe on Myspace ギターってこんなことができるのかと思ったわけです。 後ろに何人か隠れているんじゃないかと。\nとにかく衝撃の「Sky!Sky!Sky!」を。 1:39あたりから曲が始まります。\n","date":"2008-03-08T23:40:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/08/234051/","title":"DEPAPEPE"},{"content":"引用する時に適切にHTML化してコピーできる「楽々引用」を使うことにした。\n簡単に引用を行えるIE右クリック拡張ツール。\nFreeware - パソコン遊戯\nこのソフトは、性質上インストーラを使ってインストールすることになります。 が、しかし、一部の不幸な環境の方（あるいは、将来的に困ってしまう私）のために、インストーラを使わなくても使用できるようにする方法を記録します。\n使うのは、「IE MenuExt」というソフトです。\nIE MenuExt\nIE4/5のコンテキストメニューをカスタマイズするためのソフトです。 IEにはスクリプトの書かれたHTMLファイルをコンテキストメニューから呼び出す機能がありますが、その管理を容易にするためのソフトです。 ※カスタマイズできるのはメニューのうち、ユーザによって変更可能な部分(MenuExt以下)のみです。 注意 このソフトはレジストリの HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\MenuExt\\ に対して操作を行うアプリケーションです。ご利用前には必ずレジストリのバックアップを取ることをお勧めします。\nIE MenuExt\nまずは、「RakuRakuInyou.exe (222KB)」を Freeware - パソコン遊戯 からダウンロードします。 次に、ダウンロードしたものを適当に解凍ソフトを使って解凍します（「IE MenuExt」が使えるならわかるはず）。 あとは、「IE MenuExt」を起動して、解凍されてできたquote.htmlとblockquote.htmlを登録するだけ。名前は自分自身がわかりやすいものでOK。 登録する時は「テキスト選択時」だけにチェックを入れておきます。 レジストリを更新したあとは、ブラウザを一度終了させる必要があります。心配な人はパソコン後と再起動でもOK。 以上で、インストールしたのと同じように使用できます。 必要に応じて、「4.1. quote.htmlの改造案」や「4.2. blockquote.htmlの改造案」を XHTMLでの引用方法 を参考にして改造してみると良いでしょう。\n","date":"2008-03-07T00:32:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/07/003250/","title":"「楽々引用」を使ってみた"},{"content":"そうだったのか、というのはこういう事に気づいた時に出る言葉だと思った。\nとりあえず、MT4のスタイルシートの基本になるのは、「/mt-static/themes-base/blog.css」という事が「テンプレート」にある「スタイルシート」からわかるので、それを変更することにした。 preとblockquoteのスタイル変更\nMT3の時からこの手を使っていたのだが。 実は、style.cssに追記するだけでまったく問題なかったらしい。\n■StyleCatcherでのカスタマイズのしかた テンプレートのスタイルシートを開いて、テーマ用CSSの下の空いている部分に変更したい箇所を好きなだけ追加していきます。カスタマイズも簡単です。 WingMemo: StyleCatcher　テーマ配布サイト （3.2～3.3用）\n実際に試してみたが、ちゃんと有効になったし、スタイルを変更しても消えずに残っていた。 これからは、普通に変更しよう。\n","date":"2008-03-05T22:22:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/05/222251/","title":"スタイルシートの変更についてもっと良い方法"},{"content":"StyleCatcherの後継として、MT4で標準装備されたと思われる機能だが、MT3時代とは互換性がないようで、以前使っていた http://syoboi.com/movabletype/styles/library にあるスタイルはMT4には対応していませんでした。 とりあえず、今後に期待を込めて、配布サイトをまとめたサイトを見つけたのでメモっておきます。 WingMemo: StyleCatcher　テーマ配布サイト あと、MT4に対応するためのメモも。 MT4 で StyleCatcher を使うための覚え書き - M+KBOX Weblog\n","date":"2008-03-05T00:23:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/05/002333/","title":"デザイン－スタイルの変更"},{"content":"もうひとつ気になったのが、コードを書くための「pre」と「code」のコンボと、「blockquote」の表現方法。 とりあえず、MT4のスタイルシートの基本になるのは、「/mt-static/themes-base/blog.css」という事が「テンプレート」にある「スタイルシート」からわかるので、それを変更することにした。 まずは、現在の「blog.css」を「blog.css.org」とかに変更してバックアップしておく。\nあとは、以前使っていたpre、code、blockquoteのcssを移植。 背景によっては色を変更したほうがいい場合もあるが、とりあえずよしとする。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 blockquote { color: #000; background-color: #eee; border: 1px solid #999; padding: 10px; } pre { color: #000; background-color: #ddd; padding: 20px 10px; width: 400px; border: 1px solid #888; overflow: scroll; } code { } 環境が変わると色々と面倒だね。\n","date":"2008-03-04T23:45:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/04/234532/","title":"preとblockquoteのスタイル変更"},{"content":"先ほど導入したBMQuoteプラグインのドキュメントを読んでみた。 変数の値を変更するだけで、拡張フォーマットでの引用ができるらしい。 が、そこで参考にしている「XHTMLでの引用方法」のリンクが切れていたので、検索してみた。\nXHTMLでの引用方法\n御覧のように、《cite属性+title属性》では、かなり詳しい情報を書くことができます。本の場合、機械向けには、《cite属性+title属性》で厳密な引用を行い、人間向けには、cite 要素で、読者の利便性を優先した簡潔な引用をするというような差別化をすると有意義かもしれません。\nなかなか勉強になる。 が、とりあえずは拡張フォーマットではなく、スタンダードで使うことにした。\nさて、BMQuoteのソースを見てみると、簡単に改造できそうだったので、少し変更することにしました。 変更するのは、「_make_html_std」というサブルーチン。 元のソースでは、テキストを選択していなくても「引用」を示す「blockquote」でマークアップされますが、それがいまいち気に入らなかったので。\n1 2 3 4 5 6 7 8 9 10 sub _make_html_std { my ($title, $url, $sel_text) = @_; my $html = \u0026lt;\u0026lt;\u0026#34;HTML\u0026#34;; \u0026lt;div class=\u0026#34;quotetitle\u0026#34;\u0026gt;\u0026lt;a title=\u0026#34;$title\u0026#34; href=\u0026#34;$url\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;$title\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; HTML $html .= \u0026lt;\u0026lt;\u0026#34;HTML\u0026#34; if $sel_text ne \u0026#34;\u0026#34;; \u0026lt;blockquote\u0026gt;$sel_text\u0026lt;/blockquote\u0026gt; HTML $html; } とりあえず、これで私は満足。 ただ、テスト中に問題が。 HTMLソースを記述している部分を引用すると、HTMLとして引用されてしまうので、そのあたりは実体参照に変更したほうが良いのかもしれません。 ということで、やっつけで手直し。\n1 2 3 4 5 6 7 8 9 10 11 12 13 use HTML::Entities; sub _make_html_std { my ($title, $url, $sel_text) = @_; my $html = \u0026lt;\u0026lt;\u0026#34;HTML\u0026#34;; \u0026lt;div class=\u0026#34;quotetitle\u0026#34;\u0026gt;\u0026lt;a title=\u0026#34;$title\u0026#34; href=\u0026#34;$url\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;$title\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\\n HTML $sel_text = encode_entities($sel_text, \u0026#39;\u0026lt;\u0026gt;\u0026amp;\u0026#34;\u0026#39;); $html .= \u0026lt;\u0026lt;\u0026#34;HTML\u0026#34; if $sel_text ne \u0026#34;\u0026#34;; \u0026lt;blockquote\u0026gt;$sel_text\u0026lt;/blockquote\u0026gt;\\n HTML $html; } これでとりあえず安心です。 まあ、あまりHTMLソースを引用することは無いとは思いますが\u0026hellip;。\n","date":"2008-03-04T23:15:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/04/231507/","title":"「BMQuoteプラグイン」を改造してみた"},{"content":"これも以前から使っていたプラグイン。\nHatenaBookmarker.ja_JP - Ogawa::Code - Trac Movable Typeのブログ記事やウェブページをはてなブックマークにポストするプラグイン。MT4専用。はてなのアカウントが必要です。\nはてなにしろGoogleにしろ、このサイトで検索するよりは便利になるので。\n","date":"2008-03-04T21:41:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/04/214102/","title":"HatenaBookmarker.ja_JP - Ogawa::Code - Trac"},{"content":"先ほどの記事のプラグインと同時に使うことでメモから記事にする時に便利。\nブログ記事/ウェブページの日付を公開日時に自動変更するプラグイン(MT4.1/MTOS用) - The blog of H.Fujimoto\n「ブログ記事の日付を公開日時に自動変更するプラグイン(ReleaseDate)」のMT4.1/MTOS用を公開します。 また、バージョンアップに伴って、ブログ記事とウェブページとで、日付を自動変更するかどうかのデフォルトを別々に設定できる機能を追加しました。\nMT4にアップした時に「しまった」と思ったのだが、ちゃんと最新バージョンに対応するプラグインが出ていた。 どんどん環境が整っていきます。\n","date":"2008-03-04T21:31:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/04/213117/","title":"ブログ記事／ウェブページの日付を公開日時に自動変更するプラグイン（MT4.1／MTOS用） - The blog of H.Fujimoto"},{"content":"これでMT4でも手軽にメモができるようになりました。\nエムロジック放課後プロジェクト: BMQuote アーカイブ\nMovableType用BMQuote Plugin Ver.0.61\nMovableType用BMQuote Plugin が、MovableType 4に対応しました。\nMT4をお使いの方は、ぜひ、お試しください。\n","date":"2008-03-04T21:13:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/04/211347/","title":"エムロジック放課後プロジェクト: BMQuote アーカイブ"},{"content":"MySpace大活躍です。\nLunatica - ホーム Lunatica | Listen and Stream Free Music, Albums, New Releases, Photos, Videos 貪るように色々と試聴中。\nボーカルがちょっと「アレ？」と思う事もあるのですが、声色は好きだし、曲がカッコイイ。 少々長いですが。\nLunatica - Elements - Final Fantasy VII Advent Children Trib\n","date":"2008-03-03T20:43:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/03/204346/","title":"Lunatica"},{"content":"気がついたら見つけていた、という雰囲気。\nオフィシャル Official Kamelot Website – www.kamelot.com 試聴サイト KAMELOT | Listen and Stream Free Music, Albums, New Releases, Photos, Videos 昔の曲よりも、最近の曲の方が好み。 オフィシャルが出している（と思われる）動画。 最新アルバムのタイトル曲のPV（と思われる）。\nKamelot - Ghost Opera\nオーケストラというか、ストリングスとメタルって相性が良いよね。\n","date":"2008-03-02T16:46:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/02/164612/","title":"Kamelot"},{"content":"何かと便利そうなサイト。\nFile2HD.com ウェブに埋め込まれているファイルをダウンロードできるようにしてくれる。 特にMyspaceでは重宝する。\n","date":"2008-03-01T00:35:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/03/01/003527/","title":"File2HD.com"},{"content":"Mobable Typeのバージョン4にトライする事にした。 まあ、何事もやってみないと何もわからないし。 それと、今回は記事の引越しはしないことにした。 気分的に、クリーンインストールをしてみたかったから。 というわけで。\n","date":"2008-02-28T01:39:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/28/013921/","title":"バージョンアップならびに引越し"},{"content":"簡単に手に入ったならここまで欲しいとは思わなかったかもしれない。 というのが、今のところの感想だけど。\n試聴サイト\nGothica | Listen and Stream Free Music, Albums, New Releases, Photos, Videos The Cliff of Suicide\nposted with amazlet on 08.02.27\nGothica Cruel Moon (2003/04/07) 売り上げランキング: 321335\nおすすめ度の平均: 孤高なるアート 暗黒の歌姫\nAmazon.co.jp で詳細を見る\nレビューを見て気になったのだが、よく見ると中古だけしかなく、しかも値段が3万円。 むむむむむ。 iTunesで検索するもアルバムが見つからない。 困ったなぁ。 とりあえずYouTubeで見つけた動画。 しばらくはこれで我慢するしかないか。\n","date":"2008-02-27T16:40:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/27/164048/","title":"Gothica"},{"content":"試聴しかしていませんがなかなか良いです。\n試聴ができるサイト\nALL ENDS | Listen and Stream Free Music, Albums, New Releases, Photos, Videos オール・エンズ BMG JAPAN (2008/02/20) 売り上げランキング: 503\nおすすめ度の平均: ★★★★☆\nなかなか格好いいですよ 待望と希望 Amazon.co.jp で詳細を見る\n強烈な印象を与える感じではないのですが、程よく染み込むというか、聴いていて安心できるというか。\nとりあえずメモ。\n","date":"2008-02-25T22:07:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/25/220717/","title":"All Ends"},{"content":"「ひたすらgiveする事」の実例の一つ。\n浦田健の『金持ち大家さん』になるスーパーブログ:ベトナム旅行記2\n外国人相手の市場での最強の武器とは、語学力と的確な情報を与えつづけることです。\nこういう話を聞くとほっとします。\nしかし、私が感じるこの世の中は、与え続けられても何も感じない人、も多いです。 もしかすると、与え続けられている事に気づかない人、かも知れませんが。\n特に社会的な恩恵などは、当たり前だと感じてしまっている。 どちらかというと、私もまだそちらに近いですが。\n","date":"2008-02-20T17:55:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/20/175547/","title":"与え続ける事がもたらす事"},{"content":"すごくシンプルでわかりやすい。\nなぜ、請求書処理が苦手か- 勝間和代公式ブログ: 私的なことがらを記録しよう!! したがって、 ・送付先の住所氏名 ・請求先の名称 ・請求の理由・内訳 ・金額 が1カ所に管理されていると、簡単なのだと言うことがわかりました。また、なるべく近いうちにエクセルのCSVをつくって、差し込み印刷ですむようにしたいと思います。\n結果だけを見ると、当たり前のようにも見えますが、この過程が単純でわかりやすいため、根底の部分が見えやすい。 日常の苦手な事に気づくこと、がまず第一。\n","date":"2008-02-20T17:41:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/20/174116/","title":"苦手を克服する手順"},{"content":"OpenIDが改めて気になったので、資料になりそうなサイトを検索してみた。\nとりあえずは公式サイト（？）と開発用のWiki。\nOpenID Foundation website Developers | OpenID OpenID Wiki / FrontPage OpenID Wiki / Libraries 対応サービスのまとめサイトが作られているようなので、そちらも。\nおぷん: 日本語OpenID対応サービスまとめ 物は試しという事で、Yahoo JapanのOpenIDを作って試してみました。 YahooはOpenID2.0を採用しているということで、まだ未対応のサイトもあるようですが、上記のまとめサイトでは無事認証ができました。\n","date":"2008-02-17T01:40:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/17/014034/","title":"OpenIDについて些細なメモ"},{"content":"全然知らなかったよ。\nここに来て話題の新技術3つ（第14回） | 日経クロステック（xTECH）\nOpenID\nGoogle Social Graph API\n顔認識技術のWeb API\nついこの前、マッシュアップという言葉を覚えたのに、本当に色々なWebAPIが出てきているんですね。\n特にOpenIDなんかは、ゲームの登録に使ったりもできそうだし。 ちょっと興味あるね。\n","date":"2008-02-16T18:32:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/16/183249/","title":"話題の新技術"},{"content":"もう先週の話になるが、名古屋に行った時に妻の趣味に付き合ってセントレアに行ってきた。\n中部国際空港 セントレア その時に、偶然やっていたのが、「源氏物語 千年紀」というアートキルトミュージアム。\n「源氏物語」をテーマにしたキルト作品を展示ー中部国際空港セントレア - 名駅経済新聞 気になったのが「墨色（すみいろ）」という作品。\n31文字の言葉にこめられた心の結晶。かぎりなく豊潤で奥深いイメージを墨色で表現しました。\nミュージアムと言っても、センターピアガーデンという名前の廊下（それは言いすぎか）の中央部にある、分離帯のごとく建てられた柱状の物に、ポスターのように展示してあっただけだ。 「墨色」という作品を見て「源氏物語 千年紀」というイベントの存在を知ったのだが、そこが既にイベント会場だった。 最初はどこか別の場所でイベントをやっているのかと思った。\nこの「墨色」はデザイナーが「請井 且恵」さん、キルト製作者が「小高 紀子」さん。\n一応調べてみたけれど、あまりウェブでは活動してないようで。 おそらく請井さんのだと思われるサイトは見つけたが工事中。\nKATUE UKEI design office\n小高さんについても、キルト教室を開いているような先生、という程度でウェブではよくわからない。\n…まあ、キルトに興味があるわけではないので特に問題はないとは言うものの。 「アートキルトミュージアム」と謳うのであれば、本物のキルトを展示してほしかったなとは思います。 少なくともポスターとは質感も違うはず。\n目に止まった作品があっただけに少し残念に思いました。\n","date":"2008-02-16T14:17:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/16/141736/","title":"続・インスピレーション"},{"content":"普通にポップスなのだけど。 コンピレーションを聴いていて耳に止まった（？）曲。\nシュガーハイ\nposted with amazlet on 08.02.16\nジェイド・アンダーソン ソニー・ミュージックジャパンインターナショナル (2001/12/19) 売り上げランキング: 328029\nおすすめ度の平均: ”素直な心”\nAmazon.co.jp で詳細を見る\n声がすごく魅力的。\n","date":"2008-02-16T04:35:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/16/043503/","title":"Jade Anderson"},{"content":"ゴシックメタル、もしくは、シンフォニックメタルつながり。\nウィズイン・テンプテーション - Wikipedia Within Temptation ウィズイン・テンプテーション (Within Temptation)は、オランダのシンフォニックメタル・ゴシックメタルバンド。\nThe Silent Force（商品情報）\nアーティスト: Within Temptation レーベル: Sony (2005/01/25) 売り上げランキング: 47703 posted with amazlet on 08.02.16 Amazon.co.jp で詳細を見る おすすめ度（レビュー抜粋）:\n平均: 2.5 2: 彼らにもそういう時代があっただけ、ならいいのだけど。 1: エヴァネッセンス大好きですが\u0026hellip;\u0026hellip;. 5: 全ゴシックメタラー必聴! このアルバムに関しては、2曲目の「See Who I Am」や4曲目の「Stand My Ground」が気に入っています。\n","date":"2008-02-16T04:19:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/16/041927/","title":"Within Temptation"},{"content":"「ど忘れ」と言ってしまっていいのかわからないが、JavaScriptを久しぶりに使うと、色々と忘れていることに気がつく。 JavaScript でゼロパディングするときは slice を使う - p4lifeのメモ ここ最近、MovableTypeをブックマーク代わりに使うことにしている。 はてなブックマークも良いのだが、コメント欄が少ない。 あと、引用というか、どの部分をブックマークしたかったのかを記録するのが面倒。 MovableTypeの場合、クイック投稿をブックマーク代わりに使うと便利な事がある。 ウェブページを見ながら気になった部分を選択して、その文字列上から右クリック→「QuickPost」とすれば、その選択された部分の文字列がエントリー部分に転写されるのだ。 もちろん、URLやページのタイトルも自動的にリンクするように入力される。 公開の状態のデフォルトを「未公開（下書き）」にしておけば、うっかり投稿してしまうこともない。 ただ、問題は記事を公開しようとした時に、投稿日時がブックマークしたときの日時になっていること。 この入力が面倒でJavaScriptにお世話になるか、と思ったのだが、MovableTypeの日付の様式がきっちりしているのでゼロパディングが必要になった。 まあ、この問題を本質的に考えるのであれば、「現在の日時で投稿時間を更新する」というようなチェックボックスを作ってやればいいのだが。 なかなかそこまでするのは大変そうだし、しかも、アップグレードするたびに改造することになるのはいただけない。 かといって、プラグインを書こうと思ったら仕様から勉強しないと…。 と、ここまで書いて、ふと検索してみるとまさにその機能のプラグインがありましたとさ。 - エントリーの投稿日を公開日に自動変更する（MT3.3対応版） - The blog of H.Fujimoto しかも、未公開から公開に変えた場合は自動で変更される、という願ってもない機能つき。 いやはや、頭が下がります。\n","date":"2008-02-14T15:24:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/14/152400/","title":"JavaScriptのゼロパディング"},{"content":"航空機をゲーム的に設計してみたい、という感じでメモをしたこと。\n推進力 旋回 武装 などなど メインはもちろん戦闘ってことで。\n作って戦わせる、というゲームも好きだね。\n新潟にいる航空機マニア（他にも電車やスヌーピーのマニアでもある）と話をした時に、ふと思いついて質問をした。\n「航空機をパラメータで表現するとしたら、どんな項目があると思う？」\nしかし、残念ながら意味不明な質問だったようで、大した回答は得られなかった。 それよりもイーグルのエンジン音や、整備士とコックピットとの通信を録音したCDを聞かせたくてうずうずしていたようだった。 お互いに新しい世界へ引っ張り込もうとしていたようだが、お互いに失敗したようだ。\nこのメモはその後に思い出して書きとめたのだが、本当に役に立たなさそうだ。 そんな時はWikipedia。\n航空機 - Wikipedia いや、むしろこっちか。\n戦闘機 - Wikipedia よし、戦闘機を作ろう。\n「戦闘機の性能を計る際、注目すべき点」\n速力、上昇力、航続力、運動性・安定性・操縦性、推力重量比、パワーウェイトレシオ、翼面荷重、翼幅荷重、火力、探知能力、隠密性、乗員\n…見れば見るほどマニアに訊かないとわからないことばかりだ。 ま、質問の答えとしては、こういうのを期待してたんだけどね。 これらの能力を決めるのは、戦闘機の構造であろう。\n「構造」\n素材、エンジン、主翼、主翼前縁延長 (LEX)、カナード、胴翼融合、兵装、電子機器、列線交換ユニット (LRU)\n素材やエンジンはともかく、主翼をデータ化するのはかなり難しそうだ。 主翼の選び方で、運動性・安定性・操縦性が大きく変わるようなので、主翼で機体の性格を決めることができる。 主翼さえうまくデータ化すれば、素材（重量）を選んで全長、全幅を設定（重量や翼面荷重、翼幅荷重）し、主翼を選んで（運動性・安定性・操縦性など）エンジンを積めば（速力）大まかに機体の性能が決まるね。\nあとは構造というか、オプションという雰囲気が強い。 兵装は火力に直接的に影響する。 カナードは上昇力や運動性が向上するが、隠密性が下がる。などなど。\n項目には無いけど、燃料タンクの容量を増やせば航続力と重量に影響がある。 重量は速力に影響を与えるし、速力はそのまま運動性や操縦性に影響を与える。 このように一つの値が、複雑に組み合わさっていく過程が楽しみだね。\n…完成すればね。\n","date":"2008-02-12T15:57:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/12/155723/","title":"ゲームネタ：航空機を作ろう"},{"content":"ゲームを作っていると、なんとなくゲームのネタを思いついたりする。 作っているゲームのシステムと相容れないことも思いついてしまうので、どうしようかと悩んで、とりあえずメモしてあったものを記事にしてみる。\n装備するものによって成長する項目が変化する。 装備することで強くなっていく。 イベントなどを進めていくと高い成長力を持った装備が手に入る。\nイメージはFF6の魔石システムに近い、というか、これだけだと物が違うだけでそのままかも。\n大体のRPGでは、クラス（職業）によって装備品に制限をかけられたりする。 戦士は重い鎧も装備できるが、魔法使いはローブなどの軽い装備しか装備できない、とか。 あと、僧侶は刃物を装備できない、とか。\nそれを逆に考えてみる。\nなんでも装備できるが、魔法使いのような格好をしていたら、魔法使いのように成長する、というように。 重い鎧と長い刃物を装備して戦えば力や体力が上がり、軽い装備と杖を装備して戦えば魔法の力や精神力が上がる、とか。\n具体的には、装備品ごとにパラメータの成長値を設定しておく。隠しステータスにするほうが面白そうだが、その場合は防御力や攻撃力から想定されるような値にするほうが良いだろう。 成長の仕方は、装備品の値とキャラクターのステータスの値を比べて、その差が大きければ大きいほど成長する確率が上がる、というのが自然かなと。\n例えば銅の剣と皮鎧を装備していたとする。\n1 2 3 4 5 6 成長値 腕力：25 体力：20 現在のステータス 腕力：5 体力：10 上記のような条件の場合、何らかの経験をした時（戦闘に勝利したり、イベントを制覇したり、かな）に、ステータスが上がる確率を以下のような計算式にする。\n1 （成長値-現在値）/成長値 先ほどの装備の場合の計算は以下のようになる。\n1 2 腕力：(25-5)/25 → 80% 体力：(20-10)/20 → 50% 現在のステータスが成長値に近づくほど成長しにくくなる、ということになる。 そして、成長値とステータスが同じになると成長が止まる。\nまあ、そんな感じです。\n","date":"2008-02-11T14:43:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/11/144347/","title":"ゲームネタ：装備によって成長する"},{"content":"ターン制のほかにもう一つ納得いかない事がある。 隙が無いことだ。 格闘ゲームでは、当たり判定や技を出した後の硬直時間は、技ごとに細かく設定されているはずだ。 しかし、RPGでは、大技を出す時でも隙が無い。 タイミングが無理なら防御力が下がるとかでも面白いと思うのだが、そんなRPGは見たことが無い。 ゲームの小説やマンガなどでは、大技のあとの硬直を狙って起死回生の一撃を入れて大逆転、という展開もあるのにね。 ウェイトターンシステムでゲームを作るのならば、そのウェイトを操作して「隙」を演出することも可能だ。 今（というか、かなり前から）作っているゲームでは、大技を出した後は、次に行動するまでに通常よりも時間がかかる、という具合になっている。 もちろん、技ごとにデータを作る必要はあるのだが。 ついでにもう一つ。 別のゲームだが、ファイナルファンタジータクティクス（獅子戦争）では、呪文の詠唱時間という考え方があって、呪文はすぐには発動しない。 - ファイナルファンタジータクティクス - Wikipedia 獅子戦争では、スピードとチャージタイムで行動順などを管理している。 カウント毎にスピードの分だけチャージタイムが溜まっていき、チャージタイムが100になったら行動できる、という仕組みだ。 スピードが4なら25カウント、スピードが5なら20カウントで行動できる、というわけだ。 スピードは、キャラクターだけではなく、ほとんどの呪文にも設定されている。 当然強い呪文は詠唱時間も長くなるようにスピードが遅く（値が小さく）なっている。 この仕組みは、ウェイトターンシステムをわかりやすくしたものだと思うのだが、正直なところ改悪だと思う。 最も気に入らないのは、同時に動けるようになるキャラクターが多い、ということ。 しかし、それらのキャラクターは何らかの法則で行動できる順序が決まっている。 反面、良いと思うこともある。 スピードを上げるときは、現在のスピードが遅いほど効果がある。 逆に、スピードが十分速い時にはあまり効果が無い。 例えばスピードが3から4に上がったとき、カウント数は34から25に短縮される。効果は9カウント。 5から6に上がった場合は、カウント数は20から17に短縮される。効果は3カウント。 という具合だ。 閑話休題。 呪文の詠唱などの特殊なことをするのには時間が必要だということです。 呪文だけでなく、力をためる、などの行動も「力をためる時間」が必要なのです。 そして、大概の場合、そういった瞬間というのは無防備なものです。 今（というか、かなり前から）作っているゲームでは、大技を出す態勢に入ってから、実際に出す瞬間までの時間が設定できます。 そして、その間は無防備なので、タイミング悪く攻撃を受ければ通常よりも大ダメージを食らうことになっています。\n","date":"2008-02-08T17:02:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/08/170242/","title":"RPGにも硬直時間を入れてみよう"},{"content":"RPGなどをやっていて納得いかないのがターン制。 考えてみてほしい。 いくら素早くても、遅い敵と同じ回数しか動けないなんて変じゃないか？ 素早さの値が4倍違うのなら4回動けてもいいじゃないか、と。 私がナリナリクラブのThe Wars of Rosesを改造しようと思った時に、まず思い出したのは、SRPGのタクティクスオウガだった。 - タクティクスオウガ - Wikipedia このウェイトターンシステム（もしくはNATSシステム、いずれにしろ結局はターンという言葉なのだが）が画期的で印象に残ってしまい、それ以来、普通のターン制のものに対しては違和感を覚えるようになってしまった。 しかし、タクティクスオウガもそうだが、私の改造したWoRも、おそらくは似たような理由でゲームのバランスが悪くなった。 詳しくは覚えてないが、ウェイトターンを1にする裏技（？）があった、はず。（ちょっと調べたがわからなかった） WoRのほうも、重さがマイナスの装備品を許容してしまったために、それに近い状態になった。 プログラム的には、最も小さい値を指定してあるので1にはならないが。いや、ならないはずだが。 今となってはどうなっているのか。 今（というか、かなり前から）作っているゲームも基本はこれ。 やっぱり素早いキャラクターが好きですね。\n","date":"2008-02-05T15:41:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/05/154126/","title":"かのゲームでこだわったこと"},{"content":"さすがに「ニヤニヤ笑い」とは違います。 本物のリーダーはいつも笑いを絶やさない (伊東 乾の「常識の源流探訪」)：NBonline(日経ビジネス オンライン) 確かに、笑顔というのは人をリラックスさせる効果がありますね。 笑顔の素敵な人を見ると、心が温かくなります。 笑顔といえば、笑顔がとても素敵なスケーターがいるのを知った。 昨年の暮れに、フィギュアスケートのカナダ大会をテレビで見ていたときのことだった。 ↓の動画だと3:33くらい。 この笑みにやられました。 4:35あたりにもリプレイがあります。 - 武田奈也 - Wikipedia フィギュアスケートのことはさっぱりわかりませんが、競技として見ていても綺麗だなぁと思いました。 テレビで見ていた時は他にも色々と思ったのですが、既に記憶が風化していてダメですね。 でも、この「ナナスマイル」は簡単には忘れないでしょう。 技の名前も少しは覚えたいですね。 とりあえず、ジャンプの違い（フリップとかルッツとかトウループとか）が全然わからない。 そもそも、この時までジャンプにそんな種類があったことも知らなかったし。 今まではただ眺めていただけでしたが、今後は見方も変わるような気がします。\n","date":"2008-02-05T14:39:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/05/143933/","title":"武田奈也"},{"content":"意外にも「あぁ、そうだなぁ」と思った。 仕事ができる人の意外な特徴ランキング - goo ランキング 特にトップの「年代の違う友人・知人が多い」という項目が。 あらゆる年代を受け入れる、というのは、偏見を持たない、というイメージがある。 偏見を持たない、というのは、物事を正しく判断する時には、必要な能力だと思う。 そういう意味で、年代の違う友人・知人が多い、というのは「仕事ができる」という限られたものではなく、人間として「できる人」なんだと思う。\n","date":"2008-02-02T15:17:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/02/151719/","title":"仕事ができる人の意外な特徴"},{"content":"先日読んだ、効率が10倍アップする新・知的生産術―自分をグーグル化する方法の影響を少しずつ感じている。 手始めとしてというわけでもないが、「グーグル化」の中で知った「MECE」について深く知りたかったので、本の中で紹介されていた本を読んだ。\nロジカル・シンキング―論理的な思考と構成のスキル (Best solution)\nposted with amazlet on 08.02.02\n照屋 華子 岡田 恵子 東洋経済新報社 (2001/04) 売り上げランキング: 58\nおすすめ度の平均: ロジカルシンキングでおススメしてみます。 ロジカルシンキングの入門書 ありがちな内容だけどコンパクトにまとまっている\nAmazon.co.jp で詳細を見る\nハードカバーの本を読んだのはいつ以来だろうかと。 もともと分類するという事に苦手意識があった。 例えばファイルを分類するのにフォルダを作って、何度も整理しようとしているのだが、いつの間にかどこに分類していいのかわからなくなってきて、結局フォルダが意味の無いものになってくる。 そういうこともあって、MECEという考え方を身につけて、ファイルだけではなく頭の中も整理したい、と思った。 とりあえず、わからないところでも、そのまま放っておいて一通り目を通した。 その後、特にわかりにくかった（というか、理解できたとは思えなかった）「So What?/Why So?」の部分を読み直してみた。 すると、最初に読んだ時は脳が受け付けなかった感じだったのに、「あぁこういうことか」という風に感じる程度には理解できた。 今まで、学校でも会社でも教育という名前のものを受けてきたが、今、初めて教育されているような気分になった。 教育というと押し付けられている感じがして嫌だったのだが、こういう感じは悪くない。 「理解できた」ということが快感になって、ますます勉強したい、学びたい、という気持ちを生むんだな、と今は思う。 理解できてから思うのだが、この本に書いてあることは教育の中でもやっている。 少なくとも3Cや4C、4Pについては、会社の教育でもやっているのだ。 でも、身についていなかった。理解できていなかった。 それはたぶん、教育の内容が、仕事に直接関係の無いことだと思っていたからだ。 しかし、こんなところで昔受けた教育の内容が出てくるとは。 今は理解できている気になっているだけかもしれないが、それでも、自分自身の考え方が前よりも深く、広くなっているような感じがしている。 この感覚は、今までの教育では感じたことが無かった。 自分自身が気づかないと、教育というのは意味が無いのだと思う。 少なくとも私にとってはそうだったようだ。\n","date":"2008-02-02T14:48:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/02/02/144810/","title":"自分自身を教育している感覚"},{"content":"積読していたFrontMission4の本を読むきっかけとなった「とある本」というのは、この本。\n効率が10倍アップする新・知的生産術―自分をグーグル化する方法\n勝間 和代 ダイヤモンド社 (2007/12/14) 売り上げランキング: 8\nおすすめ度の平均: ★★★★☆ ★★★☆☆ ゆとりを楽しむ余裕もない？ ★★★★☆ 出来たらすごいけど、、、 ★★★☆☆ ギスギス女も愛煙家だった！\nAmazon.co.jp で詳細を見る\n色々な意味で刺激になった。\n読むきっかけとなったことは色々とあるけど、読んでみよう、というか、読みたいと思ったのは、限られた時間を有効に使いたい、と思ったから。\n色々と費用が掛かることもあるけど、読んだ瞬間から出来ることも沢山ある。\n実際に、読んだ瞬間から意識し始めたこともある。\nやっぱり、物事にはコツがあるんだなと思った。\n","date":"2008-01-31T15:46:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/31/154622/","title":"とある本"},{"content":"まあ、求められたからといって与えるかと言えばわからない。 …というか、与えるものがあるかどうかもわからないが。 日経BP社の総合情報ポータル nikkei BPnet 〈日経BPネット〉で、経営者としての心構えであったりとか、管理職のあり方であったりとかのコラム等を読んでいると、上司や会社に対して不満が増えてくる。 健康カウンセリングを受けた時に、「上司や会社に対して不満とか、ありますか？」と訊かれて、思わず言葉に詰まった。 具体的には言わなかったけれど、不満はあることを正直に言った。 なんというか、不満も溜まればストレスから体調不良になるということで、そういうことも訊くらしい。 ま、それはともかく。 経営者視点ばかりではなく、部下の視点の本なども読んだほうが良いのかもしれない。 部下であっても、上司をうまく使えばよいのだ。\n","date":"2008-01-31T13:55:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/31/135546/","title":"上司をもつ身として"},{"content":"今回のロサンゼルス-ラスベガスではレンタカーを多用した。\nはじめてラスベガスに行った時も驚いたのだが、ホテルの構内道路（と思われる道）に入ると、所々にものすごい盛り上がりがある。 かなり減速しないと飛び跳ねてしまいそうなほどの盛り上がりだ。\n最初は何故そんなものがあるのかすごく不思議だった。\nしかし、しばらくして、その盛り上がりがある場所の共通点がわかってきた。 それは、ホテルの駐車場の出入り口の近くであったり、信号の無い交差点の手前であったり。 つまり「止まれ」の代わりなのだ。\nそれに気づいた時には目からうろこが落ちた。 そういう手段があったんだ、と。\nルールを守ってくれない、と嘆く前に、守らないと危険な目にあう（or損をする）、ような仕組みを考えればいいのだ。\n","date":"2008-01-30T13:35:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/30/133539/","title":"ルールの守らせ方"},{"content":"公園で犬の散歩ができないのは、ごく一部のマナーの悪い人たちのせい。 という言い訳をしたくなる時がある。\nそういう人たちは、散歩禁止、という看板があっても散歩させるのだろう。\nルールを守る人たちや、マナーの良い人たちがとても困っています。\n","date":"2008-01-30T11:32:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/30/113204/","title":"遊べない公園"},{"content":"まだ40歳代ではないけれど。\nbpspecial ITマネジメント：コラム?桑田、イチローに学ぶ40歳代からの仕事術\n自分の得意とする今のスタイルを変え、今よりもさらに仕事を絞り込みながら、老いを楽しみながら活躍できているだろうか。 「昔の自分じゃないことを受け入れられている」――このイチローの言葉は、すべての40歳代ビジネスマンにとって重い言葉ではないかと、僕には思えるのである。\n出来なくなった自分自身を受け入れる、というのは大変です。\nそうなった時に、代わりに何が出来るのか、を考えておくのは大切なことだと思います。\nもう、大分前になりますが、垂直跳びでショックを受けたことがあります。\n元々、そんなに運動神経が良かったわけではなかったものの、中学時代の半分しか跳べなくなっている、という結果は到底受け入れられるものではありませんでした。 もう一度挑戦して、計測間違いではないことを知って、さらに落ち込みました。\n","date":"2008-01-29T11:14:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/29/111441/","title":"昔の自分じゃないことを受け入れること"},{"content":"先日テレビで見たのだが、その理由というのは「どちらの面もサラサラの面にするため」だそうだ。\n紙は製造工程でどうしてもサラサラの面とそうでない面ができる。 私たちがティッシュを使う時に、意識しなくてもサラサラの面が使えるのは、開発者がティッシュを使う人のことを考えた結果なのだとしみじみ思った。\nおそらく、開発した当時はそれが売り文句だったのではないかと想像した。 「どちらを使ってもサラサラ」とか「裏の無いティッシュペーパー」とか。\n今となってはあまりにも当たり前すぎて、その理由でさえも雑学扱いにされている。 ある意味誇らしいと思うが、少しさびしい感じがした。\n","date":"2008-01-29T10:43:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/29/104346/","title":"ティッシュが二枚重ねになっている理由"},{"content":"とある本を読んでから、通勤時間中に本を読もう、という風に決めて、その時に買ったまま放置（積読）していた本を読んでいる。\nフロントミッション4〈1〉エルザ(1) フロントミッション4〈1〉エルザ(1)\n秋津 透 PS2ソフト「フロントミッション4」 スクウェアエニックス (2004/09) 売り上げランキング: 493884\nおすすめ度の平均: ★★★★★ ノベル版フロントミッション。ゲームをプレイしてもしていなくても楽しめる。\nAmazon.co.jp で詳細を見る\nフロントミッション4〈2〉エルザ(2) フロントミッション4〈2〉エルザ(2)\n秋津 透 PS2ソフト「フロントミッション4」 スクウェアエニックス (2004/09) 売り上げランキング: 495677\nおすすめ度の平均: ★★★★★ 2を買うなら1とセットで。\nAmazon.co.jp で詳細を見る\n全2巻なのだが、今は2巻目の途中。 実はゲームも途中で放ってある。\nフロントミッションの世界観が好きなことと、この作家の小説を好んで読んでいた時期があったことから買ってあったのだが、自分に言い訳をして読んでいなかったのだ。\n読んでみると、ゲームをしている時にはまったく考えなかった、現実味のある世界がそこにあった。\nゲームに登場するのは、ヴァンツァーと呼ばれるロボットのようなもの。 このヴァンツァーを操って敵を倒していく、シミュレーションRPGだ。 全身は4つのパーツ（体、右腕、左腕、両足）からなり、それぞれのパーツは自由に組み合わせが出来る。 ヴァンツァーは、同じ機種のパーツを使えば、通常のロボットのような仕様の物になるのだが、その組み合わせを考えるのが、このゲームの醍醐味でもある。\nで、小説の中では、異なる機種を寄せ集めて作ったヴァンツァーのことを「キメラ」と呼んでいる。 そして、その「キメラ」のヴァンツァーは、調整が難しくバランスも崩れるため、操作性が落ちる、というのだ。\n考えてみればそのとおりなのだが、これには目からうろこが落ちた。\nいくら規格を統一しているとはいえ、他社製品がうまく全能力を発揮できるとは限らない。 現実を考えれば、パソコンもそうだ。 規格に従ってさまざまなものが出回っているが、俗に言う「相性」の問題で動作が不安定になったりする。\nゲームの醍醐味だからこそ、まったく違和感無く受け入れてきたことだが、よく考えれば不思議なことだった。 その発想に脱帽です。\n","date":"2008-01-23T16:16:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/23/161641/","title":"FrontMission4"},{"content":"今日は会社で健康カウンセリングを受けてきた。\n先生は、なんと20年間もうちの会社でカウンセラーをやっているらしい。 私は14年くらいいるわけですが、今日、初めてカウンセリングを受けた。 健康カウンセリングを受けようと思ったのは、特に深い考えがあったわけでもなく、言ってしまえば、なんとなく、という感じ。 先週、コナミスポーツで「ボディスキャン」を受けたのだが、なかなか不本意な結果だったのも理由にはなったかもしれない。\nカウンセリングを受けていて感じたのは、どんな些細なことであれ、ちゃんと聞いてくれて、褒めてくれたり同意してくれたりしてくれているな、と。 もっと事務的な感じを想像していたので、何を喋ろうかと色々と考えていたのだが、結果的に心配する必要は無かった。 無理に話をするつもりも無いのに、気がついたら色々なことを喋っていた。 血圧を測る時にも話しかけながらだったので、つられて喋っていたら、聴診器をひじにあてて真剣に聞いているところだった。\n時間にして30分弱だったが、自分でも驚くほど短く感じた。 話しているだけでもケアされている気になってくる。 これは次回も是非受けようと思った。\n","date":"2008-01-23T14:05:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/23/140557/","title":"健康カウンセリング"},{"content":"今までウェブで翻訳というと、エキサイト翻訳しか使っていなかったのだが、ふとしたきっかけでYahoo!翻訳が存在するのを知った。 折角なので、同じものを翻訳して性能を調べてみることにした。 調べたのは、以下の文章。 \u0026gt; Sign up for a free membership to MindMeister to manage and share your mind maps online and hold online real-time brainstorming sessions with friends and colleagues. MindMeister - think togetherというサイトのサインアップ時のアナウンスの一部。 MindMeisterのことはとりあえず置いておき、まずは結果から。 エキサイト翻訳 \u0026gt; 管理して、オンラインであなたの思考地図を共有して、友人と同僚とのオンラインリアルタイムのブレーンストーミングセッションを開催するMindMeisterへの無料会員資格に申し込みをしてください。 Yahoo!翻訳 \u0026gt; MindMeisterへの無料のメンバーシップがあなたの思考地図をオンラインで管理して、共有して、友人と同僚とオンラインリアルタイムブレーンストーミンングのセッションを開くために、登録してください。 単語の翻訳はそれほど違わないのだが、文章全体を見るとYahooのほうが日本語として自然な感じがする。 エキサイト翻訳はかなりお世話になっていたが、そろそろ乗り換え時かもしれない。\n","date":"2008-01-21T14:19:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/21/141901/","title":"翻訳対決"},{"content":"先に紹介した携帯動画変換君もそうだが、いくつか試してみた動画変換用のソフトは、大体ffmpegというソフトを使っていた。 で、携帯動画変換君は、ソフトとしてはわりと古い（2005年12月）のですが、プログラムとしては設定ファイルをもとに外部のプログラムを使う仕組みになっています。 つまり、ffmpegだけを最新に変更してもこのソフトを使いまわすことが出来るのです。 しかし、ここで一つ問題が。 最新のffmpeg（入手方法紹介ページ）を落として、ファイルを入れ替えてみたのだが、どうもオプションでエラーになるようでちゃんと変換できない。 エラーになっている部分を切り落としてやり直すこと数回。 しかし、ffmpegの使い方を見ても問題のなさそうなオプションばかりが引っかかっている。 結局あきらめて、もともとついていたffmpegに戻した。 最新FFmpegを、今日見てみたら、何日か前に更新されていたようだ。 近いうちにもう一度試してみようかな。\n","date":"2008-01-20T12:58:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/20/125842/","title":"ffmpegが難しい話"},{"content":"冬場になると肌が乾燥する。\n特に食器を洗う時に洗剤＋お湯でやっていると、タオルで手を拭く時点で痛く感じることがある。 ひび、あかぎれ、とかいうやつだ。 グーにするだけで、手の甲や指の関節の表面が切れたように痛む。\nもう1年以上経つかもしれないが、妻にそういう話をしたら、ある薬を紹介された。 それがユースキンだった。\nユースキン製薬株式会社 薬ってすごいなと思った瞬間だった。\n塗った瞬間から皮膚が柔らかくなった感じがして、実際に痛みも引いていった。 その時まで、そういう薬品は気休めだと思っていた。\nなんというか、研究している人に頭が下がります。 こんな薬を作ってくれてありがとう。\n","date":"2008-01-17T14:40:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/17/144040/","title":"ユースキンに感動"},{"content":"MTがセキュリティ対策でバージョンをあげたので追従。 ついでにデザインも変更してみた。 といっても、StyleCatcherで変えただけなので簡単。 今回は、野良（？）デザインから選んでみた。Movable Type 3.2用無料テンプレート for StyleCatcher:MovableType幼稚園 はてなにも同じようなデザインがあったような…。 少し変えたところがある。 文字の大きさを変更したのだ。 スタイルシートの中でフォントサイズを指定している箇所があるのだが、そこの単位がpxになっていたのを、すべてptに変更した。 それにしても、大きさを直接指定している箇所がかなり多くて変更が面倒だった。 最近、スタイルシートを設計していないので感覚を忘れてしまったが、継承を使って考えれば、bodyに基本的な大きさを指定したあとは、単位をemにして相対指定にするほうがメンテナンスが簡単で、かつ、理にかなっている。はずだ。 …とはいえ、デザインを考えるのは大変なことなので、ありがたく使わせていただいている。 StyleCatcherに対応しているデザインのテンプレートを配布するサイトがもっと増えてほしいと思う。\n","date":"2008-01-16T14:19:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/16/141926/","title":"デザイン変更"},{"content":"iTunesとiPodをはじめて同期した時、再生できない形式、ということで拒否されたものがあった。 それはムービーファイルだった。 しかも、全部。 拒否されると余計に気になってしまい、どうでもいい動画だがiPodで見てやろうと思い、動画の変換について調べてみた。 いくつか試したなかで、とりあえず落ち着いたのが、「携帯動画変換君」です。 名前にもかかわらず、iPod用にも変換が出来る。\nMobileHackerz - [携帯向けに簡単に動画を変換してみよう] 使い方もシンプルだし、ソフトの構造もシンプル。 しかし、最初はエラーがでて変換できなくて困った。 どうやら、QuickTimeのバージョンによって動かないことがあるらしいのだ。 原因はQT3GPPFlatten.exeらしいのだが、7.2以前にすれば問題ないらしい。 色々と調べていくと、別のソフトを介する事で最新のQuickTimeでも無事に変換することが出来るようになった。 それを実現するためにはNicMP4Boxというソフトを使う。\n参考 iPod - MobileHackerz Knowledgebase Wiki NicMP4Box.zipをダウンロードして（入手先）、zipファイル中のNicMP4Box.exeをあらかじめcoresフォルダの中に入れておく。 あとは、設定ファイル（Transcoding_iPod.ini）を変更してやればOK。\n1 2 3 4 5 6 7 [Item*] Title=H.264 QVGA(384kbps/128kbps) FileNameMax=59 Command0=\u0026#34;\u0026#34;\u0026lt;%AppPath%\u0026gt;coresffmpeg\u0026#34; -y -maxfr 30 -i \u0026#34;\u0026lt;%InputFile%\u0026gt;\u0026#34; -title \u0026#34;\u0026lt;%Title%\u0026gt;\u0026#34; -bitexact -hq -vcodec h264 -vprofile baseline -vlevel 30 -fixaspect -s 320x240 -b 384 -maxrate 700 -qmin 18 -qmax 51 -bufsize 1024 -g 250 -acodec aac -ac 2 -ar 48000 -ab 64 \u0026#34;\u0026lt;%TemporaryFile%\u0026gt;.mp4\u0026#34;\u0026#34; Command1=\u0026#34;\u0026#34;\u0026lt;%AppPath%\u0026gt;coresNicMP4Box\u0026#34; -add \u0026#34;\u0026lt;%TemporaryFile%\u0026gt;.mp4\u0026#34; \u0026#34;\u0026lt;%OutputFile%\u0026gt;.mp4\u0026#34;\u0026#34; Command2=\u0026#34;rm \u0026#34;\u0026lt;%TemporaryFile%\u0026gt;.mp4\u0026#34;\u0026#34; Command3=\u0026#34;\u0026#34;\u0026lt;%AppPath%\u0026gt;coresAddiTunes\u0026#34; \u0026#34;\u0026lt;%OutputFile%\u0026gt;.mp4\u0026#34;\u0026#34; 細かい設定値はとりあえず置いておいて、この設定でほとんどの動画がiPodで再生できるように変換される。\n","date":"2008-01-16T14:07:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/16/140702/","title":"携帯動画変換君"},{"content":"ビデオも見れるiPodにしてから、音楽だけじゃなくビデオも持ち歩くようになった。\n動画と言えばYouTubeやニコニコ動画が有名だが、これらのサイトから簡単に動画が保存できるソフトを見つけたので使ってみた。\nArea61 ビデオダウンローダー\nこのソフトからでもYouTubeは検索できるのだが、細かく検索すると遅いので、そういう場合はサイトで検索してURLをコピペするほうがいいと思う。 IEと連動させれば、IEで見た動画が履歴から選択できるので、そちらもなかなか便利かも。\nただ、ダウンロードは多少時間が掛かるので出来ればリストなどで一括DLしたい。 そうすれば、パソコンを放置できるのだが…。\n","date":"2008-01-15T09:50:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/15/095031/","title":"Area61 ビデオダウンローダー"},{"content":"アメリカでの旅行中にiPod classicを手に入れた。\n一年近く前にiPod shuffleを買ってそれを使っていた。 そのまえもCDRを使うタイプのCD・MP3プレイヤーを使っていた。 一時期、携帯電話をプレイヤー代わりに使っていたこともある。\n通勤時間が暇なのだ。 往復2時間超のうち1時間くらいは歩いている。\nそういう間に音楽を聴くのは、時間の有効活用をしている気分になる。 旅行前は英語の学習ソフトを聞き流したりしている。\nそんな感じで日常生活に音楽が入り込んでいるのだ。\n半年ほど前からmixiミュージックやLast.fmで再生履歴を残すようになってからは、聴き方も少し意識している。 好きな曲を何度も聴いて、再生履歴が自分の好みを映し出すようになると、似たような再生履歴の人や、よく聴いている曲に似たような曲をお奨めしてくれるからだ。\nしかし、shuffleだと、曲を確認することが出来ないというのが困っていた。 追加する曲が多い時など曲を覚えきれないので、「あ、この曲良いな」と思っても、どの曲なのかがわからない。 ヤフオクなどをにらみながら、古いのでもいいからディスプレイ付のがほしい…、と思っていたものの、今ひとつ踏み切れず。\nそんなこんなで迷っている時に、アメリカの電気屋でiPodを発見。 値段がドルで書かれていると安く感じるのが不思議だ。\nということで、第6世代にあたるiPod classicを手に入れた。 これからは、音楽だけではなくビデオや写真なども持ち歩ける。\n","date":"2008-01-13T13:14:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/13/131451/","title":"iPod classicを手に入れた"},{"content":"久しぶりにゲームのスクリプトの続きを作っていたら、変なところで引っかかった。 ラジオボタンである箇所を選択不可能に設定していたはずなのに、それが効いていないのだ。\nXHTMLで書くと\n1 2 \u0026lt;label\u0026gt;\u0026lt;input type=\u0026#34;radio\u0026#34; name=\u0026#34;new_class\u0026#34; value=\u0026#34;1\u0026#34; disabled=\u0026#34;disabled\u0026#34; tabindex=\u0026#34;1\u0026#34; /\u0026gt;1\u0026lt;/label\u0026gt; \u0026lt;label\u0026gt;\u0026lt;input type=\u0026#34;radio\u0026#34; name=\u0026#34;new_class\u0026#34; value=\u0026#34;2\u0026#34; tabindex=\u0026#34;2\u0026#34; /\u0026gt;2\u0026lt;/label\u0026gt; この1番のようになってほしいわけです。\nCGI.pmが3.10のサーバで動かしてみるとちゃんと認識する、ということは確認したのだが、手元の3.33ではdisabledが認識されない。\n調べていくと、どうも仕様が変わったらしい。 …というよりも、-disabledオプションが正式に採用されたと言うべきなのか。\nCGI.pmは、HTMLの拡張に対応するために、属性値は勝手に作成できる仕様になっている。 で、3.10当時は以下のように書いて実装していた。\n1 2 3 4 5 6 7 8 9 10 11 12 13 $cgi-\u0026gt;radio_group( -name =\u0026gt; \u0026#34;new_class\u0026#34;, -value =\u0026gt; 1, -labels =\u0026gt; {1 =\u0026gt; 1}, -default =\u0026gt; \u0026#34;none\u0026#34;, -disabled =\u0026gt; \u0026#34;disabled\u0026#34;, ), $cgi-\u0026gt;radio_group( -name =\u0026gt; \u0026#34;new_class\u0026#34;, -value =\u0026gt; 2, -labels =\u0026gt; {2 =\u0026gt; 2}, -default =\u0026gt; \u0026#34;none\u0026#34;, ), ラジオボタンの考え方からするとおかしな使い方だったが。\nで、今後はdisabledにする項目を指定するようになったようだ。\n1 2 3 4 5 6 $cgi-\u0026gt;radio_group(-name=\u0026gt;\u0026#39;group_name\u0026#39;, -values =\u0026gt; [\u0026#39;eenie\u0026#39;,\u0026#39;meenie\u0026#39;,\u0026#39;minie\u0026#39;,\u0026#39;moe\u0026#39;], -default =\u0026gt; [\u0026#39;moe\u0026#39;], -linebreak =\u0026gt; \u0026#39;true\u0026#39;, -disabled =\u0026gt; [\u0026#39;moe\u0026#39;], ), このサンプルコードは3.33のチェックボックス用のコードをラジオボタン用にアレンジしたもの。\n使い方がわかれば難しいことでもないのだが、勝手に追加できるからといって先走るのもほどほどにしないといけないのかもなぁ。\n","date":"2008-01-13T07:09:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/13/070945/","title":"CGI.pmでdisabledが効かなくなった？"},{"content":"今週の初めにラスベガスから帰国。 ラスベガス銀行への預金の総額はいくらになっただろう？\nで、帰ってきてから微妙に早起き早寝が続いている。 まだ日付変更線の近くで生活しているような時間帯の生活だ。\n幸いにも休みぼけはあまりない、と自分では思うのだが、そこはどうかわからない。 とりあえず、仕事は順調だが、会議では眠さに負けることもある。\n帰国してから妙に咳が出る。 初めて海外旅行した時は、帰りの飛行機の中から喉がおかしくて、家に着いたらいきなりの高熱で、翌日の仕事は休んで養生することになった。 今回は、そこまでではないが、喉の奥のほうが詰まるような感じで、どうしようもなく咳が出てくる。\nとりあえず、妻が持っている咳に効く漢方薬を飲んでいる。\n","date":"2008-01-11T12:28:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2008/01/11/122855/","title":"時差ぼけと休みぼけと咳"},{"content":"ここは、成田空港のYahoo! Cafe。\nキーボードの音が結構うるさい。\n","date":"2007-12-28T05:43:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/12/28/054351/","title":"旅の途中"},{"content":"ここはラウンジオーサカ。 これより、国外へ逃亡します。 まずは東へ。\n","date":"2007-12-27T23:29:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/12/27/232907/","title":"出発の挨拶"},{"content":"この汚いコード、明日までに書き直しちゃえ！ ? ＠IT自分戦略研究所 なんというか、書き直したわけではないのですが、新しく機能を追加してバグを生んでしまったというお話です。 機能といっても、渡された引数の中身を見て必要ならエスケープする、という単純な事なのですが。 で、書き直した時は従来の機能を損なわずに変更したつもりでした。 しかし、見事に損なっていたわけです。 エスケープするつもりの無いものまでがエスケープされてしまっていました。 敗因は、面倒くさがって自動的に判別させようとした、という事だろうと結論付けています。 エスケープが必要な場合は、スイッチになる引数を渡す、という処理をすればよかったのだと。 今はそう思っています。 …結局、そのバグは下手に触れないので、呼び出し側で何とかしましたが、いずれは直さないといけないなと思いながら、それでまたバグが…と思うとなかなか無理です。\n","date":"2007-11-01T15:02:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/11/01/150244/","title":"コードの書き直しで失敗"},{"content":"これまたmixiつながりで、NightWishがゴシックメタルというジャンルに関係する、ということで、ゴシックメタルをWikipediaで調べた。 ゴシックメタル - Wikipedia で、そこに載っていた「エヴァネッセンス」をさらに詳しく見て、オフィシャルサイトで視聴したところ、どこかで聴いた事があるような曲があった。 それは「Bring Me To Life」だった。 （未だにどこで聴いたのかは思い出せないが）\nその後しばらくして偶然にも中古屋で「Fallen」を発見。 mixiやLast.fmではそれほど再生数は多くありませんが、HDDナビの中にも入れたので車でもアルバムを通しで聴いています。\nここ数日は「Hello」が特に気に入っています。 落ち着く、というか、癒される、のかもしれません。\nFallen Evanescence Epic (2003/04/28) 売り上げランキング: 47221\nおすすめ度の平均: ★★★★☆ ★★★★☆ 全体的に良いデキです ★★★★★ 素晴らしい ★★★★★ アーカンソー州の一等星\nAmazon.co.jp で詳細を見る\n","date":"2007-10-02T14:48:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/10/02/144809/","title":"Evanescence"},{"content":"このアーティストを知ったのはmixiのミュージックから。\n「mixi station」というmixi専用のソフトを使うことで、聴いている楽曲の情報を蓄積することができるのですが、その情報を基にしてオススメの楽曲やアーティストを紹介してくれる機能があるのです。 そこで、何組かのアーティストの曲をiTunesで視聴したところ、「End Of All Hope」が気に入ったのでレンタルしてきました。 オススメの方法は定かではありませんが、なかなかいい所を突いてきます。\nCentury Child Century Child Nightwish Spinefarm (2003/09/23) 売り上げランキング: 10867\nレビュー おすすめ度の平均: ★★★★★ いい声してるな〜ネエチャン インディーズではありません 抜群なインディーズ！！ Amazon.co.jp で詳細を見る\n","date":"2007-09-30T16:36:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/09/30/163602/","title":"NightWish"},{"content":"陰陽座で刺激を受け、メタルに目覚めたか、若しくは、メタル好きを自覚したかは定かではないけれど、TSUTAYAでメタルコーナーを物色した。 そこで大々的に紹介されていたアーティストが「Sonata Arctica」だった。\nファーストアルバムでもある「エクリプティカ」は、今となっては手放せない一枚となってます。 この中で特に気に入っているのは、Blank File、Full Moonの2曲です。\nエクリプティカ ソナタ・アークティカ トニー・カッコ マーキー・インコーポレイティドビクター (2000/03/23) 売り上げランキング: 11026\nおすすめ度の平均: ★★★★★\nメロパワ史に残る名盤です! 彗星の如く現れた超大型新人 蒼い衝撃 Amazon.co.jp で詳細を見る\n","date":"2007-09-29T18:46:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/09/29/184626/","title":"Sonata Arctica"},{"content":"今度の日曜日は参議院選挙。 選挙に関連する話も耳にする機会が増えてきた。\nラジオでは、選挙会場の会場時間が短いところがある、とか。 身のまわりでは、期日前投票に行ったら職員が多くて嫌だった、とか。\n選挙に金がかかるのはある程度仕方が無い。 しかし、期日前投票を2週間もやることは無いと思う。 1週間もあれば十分。 行く人は行くし、行かない人は期間を長くしても行かないと思う。\n色々な人を使って「選挙に行こう」とかCMもやっていたりしているけど、どうせやるのなら、「選挙」というテーマで曲を作ってもらったらどうなのか？ よく売れている人やバンドなどの10組くらいに曲を作ってもらって、それを各TV局で流してもらえばいい。 費用は期日前投票を短縮する分で十分に賄えると思うのだが。\nあとはインターネット投票。 外国では既に導入されているところもあるという話だし。\n長崎市長選の無効票大量発生を教訓に，インターネット投票の導入を：ITpro この“エストニア方式”のような，期日前に何度でも投票し直せるインターネット投票を，例えば公的個人認証を使うことで日本でも行うことができないだろうか。\n既に前例のある投票システムなのだから使えないわけが無い。\n日本のお役所システムは無駄だらけ / SAFETY JAPAN [大前 研一氏] / 日経BP社 今のやり方の総選挙では1回に800億円近くかかる。これが、システム投資さえしておけばすべての選挙に使えるということになれば、1回で元が取れる。また納税やパスポート、運転免許などでどのくらいの国民が時間の無駄を強いられているか、経費が無駄になっているか、を考えれば優秀な人間に10億円は決して高くない。\n国もITに関してもっと本腰を入れてほしいところだ。 この記事に書かれていることが全て実現できるならば、財政もかなり助かるはず。\nあと、7年前（2000年4月14日から4月27日）に調査したというアンケートの結果。\nインターネット投票に関するアンケート調査結果[自主・共同調査結果] - gooリサーチ 現在、インターネット利用者の大半は「無党派層」であり、「無党派層」ほど投票に行く度合いが低い。 一方、インターネット利用者は年齢層に依らずその大半がインターネット投票の利用を希望し、インターネット投票によって自分が投票する回数が増えると考えている。 またインターネット利用者は、候補者個人のホームページ上での公約や実績の掲示などから、投票する際の判断材料が得られる様になることを期待している。\n私も期待しています。\n","date":"2007-07-25T16:43:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/25/164338/","title":"選挙に関して徒然と"},{"content":"読んでいて、これは子どもだけのはなしではないなと。\n子どもの友達力は親子関係から その2 / SAFETY JAPAN [親野智可等氏] / 日経BP社\n印象に残ったところをメモ。\nなぜ、子どもが父親との会話を嫌うかというと、まず説教が多いからだ。何かにつけてすぐ子どもへの説教になる。すると、会話へのモチベーションが下がってしまう。\nたしかに、説教ばかりされる人とはしゃべりたくない。\nもう一つは否定的な話し方をするから。例えば「4年生にもなってまだそんな字を書いているのか。もっとていねいに書かなきゃダメだ」「脱いだ靴はそろえなきゃいけない」など。\nう、耳が痛い。\n話し方の良い例（否定的でない話し方）として2点ほど挙げられている。 一つは肯定的な例。\n良い例1：「字を丁寧に書くと賢く見えるぞ」「脱いだ靴をそろえると気持ちがいいね」\nもう一つは命令だが、否定的であるよりは、命令形のほうがマシ、であるという。\n良い例2：「字を丁寧に書こう」「脱いだ靴をそろえなさい」\n否定的なものの言い方はやめよう。\nそして、一番大切なのは子どもの話をじっくりと聞いてあげることだ。話の聞き方は友達力に大いに関わる。\n親と子どもの話だけではなく、人間関係の基本なのだ。\n","date":"2007-07-19T18:39:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/19/183948/","title":"「教育する者」という立場の怖さ"},{"content":"MTのテンプレートの仕組みには感動しますね。\nZeitgeistの表示にHTMLタグが入っていて変なことになっていたので対策しました。 セキュリティホールでしたので表示されるHTMLタグを無効にする処理を入れました。\n具体的には\n1 \u0026lt;$テンプレートタグ名 encode_html=\u0026#34;1\u0026#34; $\u0026gt; としただけなのです。 便利ですね。\n","date":"2007-07-19T14:45:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/19/144526/","title":"MTの「encode_html」"},{"content":"理事長になる動機にもなったかもしれません。\n「ペット一代限り可」の規約を「飼育可」に変更してもらうには？｜マンション管理新時代\n「ペットの会の会員はマナーを守ってきたのに、2~3年前からの無断飼育者のマナーの悪さのために、ペットの会の飼育者が犯人扱いにされている」\n表向きは「飼育可にしよう」なんて事は言いませんが。\nただ、実際のところ難しいでしょう。 昨年の臨時総会で決議され、定期総会で規約改正も行われ、「一代限り」は正式に規約にうたわれました。 規約をころころと変える理事会が信用されるでしょうか？ ペット飼育ができるマンションを目指すのならば、反対の人を納得させる何かが必要でしょう。 例えばこんな感じの。\nペットの会として、まずやらなければならないことは、「無断飼育者」をなくすこと、つまり、「ペットの会に入会させ、飼育マナーを向上させる」ことから始める必要があります。\nうちのマンションでも「ペットクラブ」というものが作ってあり、無断飼育者はいないはずです。 ただ、残念ながら「ペットクラブ」の人たちの多くは、\nペットクラブは無理矢理作らされた ペットの責任は最終的に飼い主の責任 という考え方でした。 先日初めて出席したペットクラブの会合（2か月に1回集まることになっている）も、どちらかというと「これまで自由に飼えたのに…」という雰囲気で終始していました。\nあと、理事会も役員で留任（再任）した方が1人もいない状態なので、ちょっと出遅れてしまった感があります。 ペットクラブに対してもそうなってしまいました。\n反対者の意見や理由を聞き、その解決策を「ペットの会」として備える必要もあります。会則の中に「ペットの会への飼育者全員参加」や「順守事項」を定め、無断飼育者の根絶や飼育マナーが悪い人への指導やフォロー、そして苦情処理もしなくてはなりません。\nまずは、ペットクラブ内の意識改革を進めていかないと、ペットを飼えるマンションにするのは難しいと思います。 理事会としても協力できることは可能な限り協力する立場をとるつもりです。\nとりあえず、ペットクラブの会合に全員が出席すること、を目標にしてほしい、と思っています。 そのためには、ペットクラブにちゃんとした目的が必要なのかもしれません。 最終目標は「正式にペットが飼えるマンション」にすることだとは思いますが、そのための細かいステップを考えていく必要があるでしょうね。\n","date":"2007-07-17T15:54:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/17/155415/","title":"目標の一つ"},{"content":"視点が面白い。\nコミュニティー論に欠けていた視点／森反章夫氏と語る（第1回）｜マンション管理新時代\n首都直下型地震で大きな被害が出そうな地域で、防災訓練じゃなくて復興模擬訓練をやるんです。すると住民の皆さんは、今までに防災訓練として避難訓練はやったことはあるけれども、復興訓練なんかやったことないわけで、びっくりされるわけです。そして初めて、ああ、町ってこんな問題をかかえているのかと気づく。こんなことが起こったら大変だ、これはみんなでちょっと街全体を考えなきゃいけないと、参加した人たちがおっしゃるんですよ。そのとき街の当事者になるのかもしれないと思います。\n避難訓練ではなく復興訓練という視点が面白い。\n逃げられなかった時にどうするか、という訓練もしたことが無い。 危険から身を守る方法というのは、意外と見落としている事が多いのかもしれません。 あ、逃げ遅れた設定で避難器具を使って脱出する訓練は見たことがありました。\n漠然と、全員が当事者になる訓練って良いなと思いました。 復興というのは、地域にとって大事なことです。 その復興を模擬的に行うことで新しい視点を提供できる。 災害が起きた時ではなく、災害が起きた後のことを考えることが、より災害のことを意識できるのかもしれません。\n","date":"2007-07-17T15:37:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/17/153720/","title":"当事者になる訓練"},{"content":"今回、理事長になって最初の理事会は3時間以上かかった。\n「無意味だ」と言いながら、どうして会議の改善をしないのか - オンラインマガジン - ITmedia エグゼクティブ編集部-\n会議の目的は、情報伝達・意思決定・意見調整・及びその併用と大別され、さらに細分化すると、(1)情報収集 (2)伝達 (3)交流 (4)参加者の教育・スキル向上、そして (5)問題解決 (6)意思統一・一体感・帰属意識の醸成、がある。\n3時間もかかった理由は、1,2を会議の中でやってしまったからだろう。\n前理事長から仕事を引き継いだときに、工事の業者を理事会に呼んでいる、ということで、理事会のときに過去の工事の経緯を聞いたわけです。 そして、その場で質問したり。 …こんなことしていて会議が1時間で終わるはずもありません。\nそれでも、当初の目標は2時間でした。 顔合わせはやっていたものの、最初の理事会でもあるし、ある程度は様子見も必要だとも思いました。 しかし、気がついたら3時間経っていたとは。\n理事をやっていて何が嫌って、会議に出なきゃいけないのが嫌というものです。 月に一回とはいえ、土曜日の昼から3時間も拘束されたら、どこにも遊びにいけないじゃないかと。\nこう、力説されると、ごもっとも、と、いうほかありません。 何とかして短くしないといけません。\nただ、通常会議を開催するとき習慣で2時間を設定するが、1時間で充分である。筆者は、ある時から自分の主催する会議をすべて1時間に設定した。すると長引いても1.5時間で終わり、やがて1時間で終わるようになった。\nということで、第2回理事会は平日の夜8時から1時間で設定し、かろうじて1.5時間で会議を終了することができた。 議題は第1回と同じくらい。 議事録も同じくらいの枚数にもかかわらず、時間は半分に短縮できた。\n今回は、（急ぎだったこともあり）管理会社からの報告書が当日にしか配れなかったが、次回からは理事会の案内とともに配って事前に目を通してもらうことにしているので、おそらく1時間で終われるだろう。\n","date":"2007-07-17T15:15:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/17/151538/","title":"会議は1時間以内"},{"content":"自分のためにやるのが一番いい、という簡単なことを言っているはず。\n我慢して鍛える必要はない自分が続けられることを探そう (ビジネス基礎体力)：NBonline(日経ビジネス オンライン)\n「我慢してやるトレーニングは基本的には無意味」\nタイトルはゆるいのだけど、中身はゆるくない。\nというか、1ページ目と2ページ目で中身が違うのが狙ってのことなのかどうなのか。\n宴会に限らず幹事をやることでしょうね。お金集めが大変だとか、食べてばかりいる奴がいて不愉快だとか。要は、楽しいことも嫌なことも含めて両方分かる。しかも、自分も参加して飲み食いする。旅行の幹事もいいですね。なぜなら、自分も行くからです。\n「自分が楽しむために苦労するのは大変なことだとは思わないでしょう？」というメッセージなんだろうなぁ。\n立候補しろとまでは言わないけど、幹事を誰もが嫌がって引き受けない時に、私がやりますと手を挙げる人は格好いいですよね。それをやる過程の中で、どんどん鍛えられていくはずです。\n理事長をやったことは、結果的に自分自身のためになった。 以前の経験は、今回の理事長の仕事にも役立っている。 ただ、「不愉快なこと」は何度やっても「不愉快なこと」です。 何が不愉快って、協力してくれない人が多い、ということです。\n今回は、その「不愉快なこと」をどうにかすること、に挑戦してみようと思っています。 まずは、興味を持ってもらうこと。 興味を持ってもらえれば私の勝ちだと思って色々画策しています。\n","date":"2007-07-16T16:47:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/16/164705/","title":"全ては自分のために"},{"content":"気がつけばあっという間に1年が経ってしまいました。 しかし、困った問題がありました。 次の理事が決まらないのです。\n仕事を引き継いでくれる人がいない、というのが、これほど悲しいことかと思いました。 マンションのために色々と時間を割いてきたのは、別に感謝されようと思っていたわけではありません。 しかし、どこかで反響と言うか、マンション管理への関心を持ってもらえるものと思っていたのでしょう。 その結果、自分自身が何のために苦労してきたのか…、という思いを抱いてしまいました。\n管理会社を変える、という大仕事をやって燃え尽きた感があったのかもしれません。 モチベーションを維持するのが難しくなってきたのです。\n任期終了となる総会の時期が近づきましたが、次の理事をどうするか、という理事会での議題については何度も先送りになっていました。\n管理会社からの提案もありましたが、役員を経験しないとマンション管理への関心を持つのは難しい、のでしょう。 そこは私たちとしても共通認識となり、結果として、輪番制でお茶を濁すことにしました。\n「マンション管理についての情報収集」 でもチラッと書きましたが、「理事長は、監事として次期役員に再選するよう努める」こととし、私は監事として次の年も理事会にかかわることにしました。 役員が全員が変わってしまうと、引継ぎをやったとしてもうまく機能しないことが多い、という話をよく聞く（そして、これは今回実感しました）ので、一人は再選したほうが良いだろう、と考えたのと、やはり残るのであれば理事長だろう、という安直なものでした。\n結果的に、理事長になる人の負担が増える事ばかりやっていたのかもしれません。 しかし、このときは率先して動くことしか考えつかなかったのです。\n","date":"2007-07-16T12:46:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/07/16/124610/","title":"回顧録-困った問題"},{"content":"臨時総会の一番の心配事は、出席、委任状などが定数以上集まるかどうかでした。\nこの臨時総会の前に一度臨時総会を開催したのですが、その時は回収した票の数が4分の3ギリギリで、1票でも反対票があると否決されてしまう議案がある、という総会になってしまったのです。 そして、見事に否決された議案がありました。\nもともと、マンション管理のノウハウなどありません。 後で管理会社の方に聞いてみると、総会の時には出席か委任か、という風にするのが一般的で、議決権行使書をつけることはほとんどしないそうです。 反対するなら出席して意見を言ってください、というスタンスですね。\n実際、否決された時のことを思い出し、実感しました。 理由書をわざわざつけてくれた方はまだ良いのですが、単純に反対票だけの方もいらしたので。 提案すると言うことはそれなりに時間をかけて、理事会で合意を得て、資料も作って…とやっていることは盛りだくさんなわけです。 それを紙きれ一枚で否定されるわけですから、やりきれなさといったら想像を絶するものがあります。\n閑話休題。 管理会社の変更案は臨時総会で無事可決しました。\n現行の管理会社に対して解約の申し出を行い、丁度会計年度が替わる頃に新しい管理会社に管理を任せることになりました。\n管理会社が変更することが決まってからは、契約が無いにもかかわらず引継ぎのために理事会に出席していただきました。 引継ぎも順調だったように思います。\nマンションの価値は管理で決まる、と言われたりしますが、管理会社の価値は担当者で決まる、もありかなと思います。 まあ、どこの会社でも言えるのかもしれませんが、担当次第でその会社の印象が変わることがあります。\n管理会社の変更が決まったのと前後して、元の管理会社の担当者が変わりました。 その担当は、管理会社が変わるまでちゃんと手を抜かずに仕事をしてくれました。 最初からこの担当だったら管理会社を変えようとまで思ったかどうか…。\n","date":"2007-06-16T12:28:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/16/122844/","title":"回顧録-管理会社変更決議その後"},{"content":"管理会社を変更すると言ってもどうすればいいのかわかりません。 そもそも、管理費が高いのか安いのかもよくわかりませんが、赤字が続くようでは困るのです。\nマンション関係のことを色々と検索して、マンション管理士のサイトを見つけたりしているうちに、偶然ですが「管理会社の入札システム」を見つけました。\nマンション管理組合の経費削減　コストダウン・ドット・コム 理事会でこちらを利用する決議を取り、いざ見積りをするために会員規約を読んでみると、なんと「見積りだけ」の利用はできないのでした。 念のため問合せしたところ「『見積もり合わせ比較』、またはそれを利用した『現状業者への値下げ交渉を目的とした入札』はお断りさせていただいております」という回答でした。\nとはいえ、副理事長との間では「できるなら変更したい」というレベルの話はしていましたし、場合によっては理事会で管理会社変更についての説明もしてくれる、ということで、副理事長と相談の上で管理会社変更を前提とした見積りを取ることにしたのです。\n管理会社を変更するつもりとはいえ、資料についてはどんどん詰めなければなりません。\n理事長が決まってからすぐに名義変更をするべきはずのものが2ヶ月たっても揃いません。 頻繁に来れる訳でもないのに資料を忘れたり、間に合わなかったり。\n施工会社のほうはというと、1年目のアフターサービスの報告書が工事から3ヶ月たっても提出されません。 共用部の工事は一部実行されていない箇所もあります。\n事業主からも、自転車置き場については何の音沙汰もありません。\nコストダウンドットコムの担当者の仕事はとても速く、問合せから10日ほどで入札仕様書が完成し、一ヶ月ほどで入札された金額の説明を受けることができました。 その後、理事会のほうでごたごたがあり多少遅れたものの、問合せから4ヶ月以内に管理会社変更の臨時総会を開くことができました。\n","date":"2007-06-13T12:51:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/13/125127/","title":"回顧録-管理会社の変更"},{"content":"管理組合の総会が開かれたのが、入居からほぼ一年。 その一年間の間、どうやって管理されていたのか？\n初年度の会計書類を見てみると「理事長未選任」という「理由」により、管理会社の権限で会計処理を行っていたのでした。 総会のときに提出を条件で承認とした決算資料の中にそれらはありました。 そこには、設計ミスとも言えるはずの追加の工事が管理組合の費用で行われていました。 これらについては、何度かの理事会を経て事業主から補填していただきました。\nただ、管理会社は竣工当時から決まっていた会社で、事業主や販売代理店との関係もあったためか動きがすごく悪かったのです。\n事業主には、このほかにも求めていたことがあります。\n1.竣工図面を提出してほしい 2.重要事項説明でも「各住居につき1台分の駐輪場を確保されている」となっているのに半分しかない（この件は今も未解決…） 3.斜めに設置された自転車置場は使えないので直してほしい（これも未解決）\n2,3はともかく、1の竣工図面を提出してもらうくらい簡単なことだと思うのですが、結局これも施工会社や事業主に直接連絡を取って提出してもらったのです。 竣工図面は施工会社にありました。という話でしたが、おそらく、作られていなかったのでしょう。\n…管理会社も事業主も施工会社も、ろくでもないところばかりでした。\n最初はあまり乗り気ではなかった理事長職ですが、やり始めると勝手に責任感が生まれてきて、いろんなことを調べなければいけない、と思うようになりました。 それもこれも、管理会社や事業主、施工会社がろくでもなかったおかげです。\nそんなわけで、理事長就任から半年もしないうちに管理会社の変更を計画しはじめました。\n","date":"2007-06-11T13:23:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/11/132348/","title":"回顧録-提出されない資料"},{"content":"理事長にはなったものの、基本的には「管理会社が仕切るもの」という意識は残っていました。 管理会社を監視するような仕事という認識だったと思います。\nマンション購入時は、2棟のマンションを同時に販売していたので、当初は全体でひとつの管理組合だと思っていたのですが、実際にはそうではなかったのです。 私は1棟のほう。 しかし、第1回の理事会は、2棟の管理員室で行うことになったのです。 管理員室の広さは確かに違いますが（1棟のほうはとても狭いのです）、管理会社が同じとはいえ、これはちょっと無しでしょう。\n会議室や集会室の無いような小規模のマンションでは、理事会や総会の場所をどうするのかも問題だと思いました。\n","date":"2007-06-10T07:21:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/10/072146/","title":"回顧録-初めての理事会は別のマンションで"},{"content":"とりあえず、しばらくぶりにアップデート。\nVer4の宣伝もやっているようだけど、そっちは様子見かなと。\n","date":"2007-06-10T07:20:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/10/072000/","title":"アップデート"},{"content":"来週の理事会に向けて徐々にエンジンの回転が上がってきています。 色々と調べていると昔のことを思い出してきました。\n以前のマンションは結婚する時に新築で購入しました。 この時は管理組合とか自治会とかには興味がなく、マンションの管理は管理会社がやるものだ、という思いもあって何も考えずにすごしていました。 結局、総会が開かれずに1年が経過し、ようやく管理組合の発足総会が管理会社の号令で行われました。 …実際には妻が管理会社の尻を叩いていたのですが。\nともかく、第一回の総会がマンションの共用玄関ホールで開催されました。出席者はたしか11人だったと思います。議決権数は31で、今回の議長は管理会社の担当なので、担当が20票を持っていた形ですね。 当然椅子もない、机もない、声は響いて聞こえにくい、冬だったので寒い、など、とても話をする環境ではありません。 それでも、何人かから質問が出され、担当者が答えに窮する、という不思議な総会は1時間以上続いたと思います。 それも初年度の決算で管理費会計が赤字で、修繕積立金から補填という信じがたい出来事があったからでした。 結果的に、不明な事項については今後理事会に提出する、という条件つきで決算と予算は承認されました。\nで、最後の議題は役員の決定です。\n立候補が一人出ました。が、他の人たちは急に静かになりました。 私は「さっきまで威勢が良かったのになぁ」と他人事のように思いました。 気がつくと私の後ろで妻が（一緒に参加していたのでした（もちろん票は二人で1票））「あなたやりなさいよ」と。 まあ、質問も結構しました（ほとんど妻が気づいたことですが）し、いつまでも立ったまま会議するのも嫌なので、立候補することにしました。 （今考えても魔が差したとしか思えません）\nで、先に立候補した方が副理事長となり、私が理事長となりました。 （何も考えてなかったに違いありません）\n残りの理事はクジで決めることに。 残り役員のうち出席者が1名、欠席が2名。 欠席したうちの1名は店舗部分の区分所有者で、賃貸に出していました。 監事を出席の方にお願いしましたが、諸々の理由で辞退され、欠席したもう1名が監事となりました（後に管理会社の担当者が連絡し了解を得た）。\nその後、改めて第1回理事会の日程を決め、総会は何事もなかったように終わりました。 欠席者がいたのも理由の一つですが、その理由は結果的に意味がないものでした。\n総会を欠席する人は理事会も欠席するのです。\n","date":"2007-06-08T16:10:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/08/161010/","title":"回顧録-そもそものきっかけは赤字財政"},{"content":"首長ブロガーの勧め（2）よくある5つの不安を解消：ITpro\n他の行政担当者からお聞きしたものも含めて，首長ブログを始められない代表的な理由を挙げますと，\n揚げ足を取られるのではないか 毎日，書き続けられないのではないか 意見のバランスが取れないのではないか 役所や後援会から反対されるのではないか ブログ対応に忙殺されるのではないか ということになるでしょう。\nこれらを解消しようというわけです。\n読んで納得。\n","date":"2007-06-07T16:03:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/07/160307/","title":"継続が力なり"},{"content":"毎年全世帯が理事に立候補、吉祥寺ロイヤルマンション｜マンション管理新時代\nタイトルを見たときは、積極的な区分所有者ばかりだなぁ、と思ったわけです。\n次期理事候補者を選ぶ「被選挙人名簿」には、毎回、全世帯主の名前が記載される。各戸はふさわしいと思う4人の名前を記入し、1週間以内に管理室脇のポストに入れる。総会の2カ月前には、掲示板に新理事候補者4人と、補欠2人の名と得票数が張り出される。補欠は、任期途中に転居者がいたときに、繰り上がって役目に就く。\n総戸数は33戸で役員が8人。 毎年4人ずつ改選という仕組みらしい。 少ないからこそできるんだな?と。 今のマンションは130戸以上あるので、これはさすがに採用はできないでしょうね。\n以前理事長をやっていたマンションは、31戸で役員が5人。 候補者に困って輪番制を導入したものの、うまく稼動しているのかよくわからない。 先日、総会に出席したが、新旧役員以外は私とあと一人だけ。 ただ「理事長は、監事として次期役員に再選するよう努める」という条件は守られているようです。\n昨年の理事長はたまたま総会に出席したから理事長になってしまった、という感じだったので正直不安でした。 しかし、今回監事として頑張って頂けることになったので嬉しかったです。\nこの方法にはメリットが多い。まず、入居したばかりの人が選ばれやすい。この人たちは、理事を務めながら自然に居住者の輪になじむ。マンション住まいが初めてでもルールを受け入れ、守ろうという意識が身についていく。\nこういうのは大事そうですね。 大阪でもマンションは近隣の付き合いが少ないので…。\n輪番制ではなく「大勢の中から選ばれる」ため、各自に責任感が生まれやすい、という利点もある。また、就任をめぐる不平等感も少ない。たとえ無関心な人が選ばれても、理事を務めるうちに雰囲気に巻き込まれ、取り組まざるを得なくなる。誰もが気づいたときは“はまっている”のだ。\nやはり難しいのは無関心な人にどのように関心を持ってもらうか、に尽きると思います。\n昨年このマンションの総会に出席したのは、ペット禁止の決議が議題にあったからとも言えます。 購入時に、規約ではペット禁止となっていますが、運営上でペット1匹につき500円を納めることで飼う事を了解していました。 私たちとしては、ペットが飼えなくなると非常に困るわけです。 委任状により過半数以上の票を持った理事長が、総会の様子を見て反対票にいれたことでとりあえず保留にはなりましたが、その後一般の人からすればあまり行動のないまま、「現存の一代限り許可条件付ペット禁止」という案が臨時総会にかけられました。\n当初は、出席人数も多いし（と言っても2割程度）、話し合いも活発な総会なので管理組合としてそれなりに機能しているのだと思いました。 しかし、どうも変な感じがこの辺からしてきました。 理事会自体がブラックボックスで、何をやっているのかが全然わからないのです。 ハト対策工事を行う、というアナウンスがあった後に急に取りやめになったり。 ペットについてのアンケートもありましたが、集計結果もよくわからないまま「一代限りOK」という議案にすることまでが決まってしまいました。 この時点で今の理事会にはあまり期待せず、来期に自分たちで何とかしようと思ったのです。\nまあ、理事長を経験していなければ考えなかったことかもしれませんが。\n","date":"2007-06-07T14:43:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/07/144343/","title":"マンション管理についての情報収集"},{"content":"この前の日曜日。マンションの管理組合の総会があって、今年度の理事長をやることになった。 一度経験していると、二度目はハードルが低くなるようで。 住むマンションごとに理事長を経験する、ってどうなんでしょう？\n昨年の総会で、役員は輪番制ということに決まったので、今年度の役員になることは決まっていたわけです。 が、いざ蓋を開けてみると、輪番制なのに断る人が続出だったらしい。 自分たちで決めた、という意識はないんだろうか？\n閑話休題。数年間ブランクがあるので、色々と調べているんですが、日経BPに面白いものを発見しました。\n新米女性理事長奮闘記｜マンション管理新時代 で、これに触発されて理事長ブログをやってみるかと、ふと思って書き始めたわけです。\n","date":"2007-06-06T16:01:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/06/160126/","title":"人生二度目の理事長"},{"content":"旅人(DVD付) posted with amazlet on 07.06.06\n高杉さと美 坂元裕二 TATOO 古内東子 CUBE JUICE AVEX GROUP HOLDINGS.(ADI)(M) (2007/06/06) 売り上げランキング: 78\nAmazon.co.jp で詳細を見る\n会社の車で聴きました。 なかなか好みの曲でした。\nメモメモ。\n","date":"2007-06-06T14:16:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/06/141600/","title":"FM 大阪 「POWER PLAY851」で聴いた曲"},{"content":"Cutting Crew：(I Just) Died In Your Arms 何がどうってわけでもなく、耳に心地よい感じ。 英語を理解することなく聴いていたのだが、曲名を見たときに思わず「なるほど」と言ってしまった。\nBobby Caldwell：Janet マイナーな曲が好きねぇ、と評された。 歌詞がよくわからない分、曲の方に意識が行くのかもしれないけど。\nBobby Caldwell：Where Is Love こちらも同じく。 音楽の好みは人それぞれなものなんだ、と開き直っている。\nNatalie Imbruglia：Torn 本当に偶然。本気で運命を感じた曲。初めてウェブラジオというものを聴いた時にかかった曲。 いきなりだったので調べるのに手間取った。\n","date":"2007-06-01T18:34:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/01/183447/","title":"最近お気に入りの曲を徒然と2"},{"content":"浜崎あゆみ：Because of You 彼女はメジャーすぎて興味なかったのだが、この曲がきっかけで浜崎あゆみの世界も良いんじゃないかと思ってきた。\n浜崎あゆみ：is this LOVE? A BEST2-BLACK-の中で一番印象に残った曲。 サビの歌詞とメロディが心にグッと来た。この部分を聴きたいと思って何度も繰り返して聴いてしまった。\n浜田麻里：Antique 彼女の曲の中では今のところ最も好きな曲。 少々クサイ歌詞もあるのだけど、歌として聴く場合はこのくらいのほうが良いんじゃないか、と勝手に思っている。\n陰陽座：醒 何度聴いても聴き足りない気分で、何度も聴いてしまう。ここ数日、頭から離れない曲。 何故なのか正直わからないが、歌声やギターの奏でる旋律が好きなのは間違いない。\n","date":"2007-06-01T17:36:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/01/173623/","title":"最近お気に入りの曲を徒然と"},{"content":"【第1回】上司を使わずして成果は上がらない (西山昭彦の「女性管理職の落とし穴」)：NBonline(日経ビジネス オンライン)\n上司のタイプを大きく4つに分けて分析している。\n自己顕示欲タイプ: 権力志向が強く、権限を存分に発揮したい人 年収志向タイプ: とにかく上に行けば年収は増えるから、出世したい人 内容重視タイプ: より良い仕事をして自己実現や組織への貢献をしたい人 上司不適合タイプ: 本来適性はないが、間違えて上司になってしまった人 「不適合タイプ」を見て笑えた。 でもまあ、笑ってばかりもいられない。\n","date":"2007-06-01T15:43:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/01/154359/","title":"上司を使わずして成果は上がらない"},{"content":"トーン ナタリー・インブルーリア BMG JAPAN (1998/02/21) 売り上げランキング: 190621\nAmazon.co.jp で詳細を見る\n何気なくiTuneでウェブラジオを聴いていたらかかっていた曲。 何に惹かれたのかはわからないけど。\n","date":"2007-06-01T15:24:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/06/01/152449/","title":"ウェブラジオで偶然引っかかった曲"},{"content":" Love Story amazon.co.jp テレビから聴こえてきて思わず見た。\n","date":"2007-05-31T13:25:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/05/31/132516/","title":"気になった曲"},{"content":"仕事場が変わってから、通勤路の途中にツタヤが入った。 そんなわけで半額レンタルの期間を狙って色々と借りてくるようになった。 通勤途中にある店、というのは結構重要な要素だなぁ、と今更ながら思う。\n半額というのは無意味にお得感がある。 音楽に飢えていたわけではないと思うのだが、結構な時間滞在し、気がつくと枚数が増えている。 新聞で読んだだけのアーティスト、洋楽のオムニバス、etc そんなときに偶然目に留まったのが「陰陽座」だった。 店員によるキャッチコピーにも刺激された。 ということで、ベストアルバム（2枚組＋ボーナスディスクつき）をカゴの中に。\n陰陽珠玉 amazon.co.jp 今なら言える。 店員さん、ありがとう。 もともと音楽はゲーム好きが高じて手を出した趣味。 西欧なら大航海時代。 日本なら平安時代、戦国時代。 中国なら三国時代、水滸伝。 ゲームの舞台をイメージさせる音楽には食指が動く。 ちょうどこの時、偶然「俺の屍を越えてゆけ」のサントラも見つけていたので、平安時代という世界観が一致したのかもしれない。 そうでもなければ名前も知らず曲も聴いたことがないバンド（しかもジャンルがヘヴィメタ）のCDを借りたりはしなかったと思う。 いくらキャッチコピーが優秀で半額レンタル中だったとしてもだ。\n組曲「義経」を聴いて、大河ドラマの義経の静を「石原さとみ」が演じていたことを思い出した。 石原さとみ、迫真の「しずやしず」 快投乱打な雑記帳/ウェブリブログ（NHK大河ドラマ「義経」　第46回「しずやしず」） …でも、この回って結局見てないんですよね…。 リンク先の記事を読んでいるだけで見なかった事を激しく後悔します…。\n…ま、ともかく。 かなり好きな部類に入るバンドになりそうです。\n","date":"2007-05-24T15:15:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/05/24/151556/","title":"陰陽座"},{"content":"もう先週の話だが。 スガキヤ目当てのダイエーで「絵運祭」という展示会をやっていた。\n…まあ、諸事情で見には行かなかったのだが、気になる絵があったので無料の入場券だけを持って帰ってきた。 で、それを思い出したので、気になった画家の名前で検索した、というわけです。\n気になる絵のタイトルは「想紅（おもいくれない）」、書いたのは「SHU」という方で、WebサイトはLittle Bit。\nLittleBit SHU Official Web Site 想紅 -おもいくれない- Omoi Kurenai｜Gallery｜LittleBit SHU Official Web Site やっぱりこういう絵が好きなんだなぁ、と自分自身を改めて認識した出来事でした。\n","date":"2007-04-12T14:44:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/04/12/144412/","title":"インスピレーション"},{"content":"\n気がつけばプレイ時間はすでに100時間をとっくに超えた。 RPGなんかだと、100時間遊んだらかなり強いレベルになっているはずだが、このゲームではまだ序盤…。\n書店で分厚い攻略本を見つけたが、まだ買ってない。 太刀はそれなりに使えるようにはなったのだが、他の武器はあまりにも下手すぎるので、やはり買ったほうがいいのだろうかとも思ったりする。\nここ一週間ほどは、「XLink Kai（XLink Kai: Evolution VII. Global Network Gaming.）」を使ってオンラインで狩りも楽しんでます。 まあ、ちょっと強いボスと戦うと死んだりしますが…。\n村のクエストもレベル4から抜け出せない。 修行あるのみです。\nちなみに、XLinkを使うための無線LANアダプタは、現時点では が最良のようです。\n","date":"2007-04-04T11:48:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/04/04/114817/","title":"MHP2nd"},{"content":"職場不倫がバレるとき (遥洋子の「男の勘違い、女のすれ違い」)：NBonline(日経ビジネス オンライン) http://business.nikkeibp.co.jp/article/person/20060926/110544/?P=1\n記事は少し古いけど、メモ代わりに。\nこのコラムニスト紹介する言葉として、\n時事問題を独自の視点で切り込むタレントでエッセイストの遙洋子氏が、男と女が食い違うワケをユニークな視点で解説していく\nと書かれている。\nいくつか記事を読んでいて、ただ単に「女性の視点」というわけではないことを感じた。\n虚よりも実を取る、というか。\n","date":"2007-02-12T16:36:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/02/12/163605/","title":"男と女の…"},{"content":"Kanameの小部屋 ―本棚と床とダンボール― http://www.tcp-ip.or.jp/~mt2knm/index.html ↑のサイトで公開されている「ToDo Chart」を最近使っています。 http://www.tcp-ip.or.jp/~mt2knm/etc/ToDoChart.html 12月に転勤になったのですが、その時に引き継いだ仕事がとても多く、何をいつまでにしなければならないのかをきっちり把握するために、いくつかToDo管理のソフトを試した中で、最後まで生き残ったソフトです。 また、40歳からの仕事術で見た「自分ひとりの時間でも来客・会議と同様にアポを取る」という言葉。 これがより大きいきっかけになったと思います。 ToDo管理というかプロジェクト管理に近いのかもしれませんが、私の仕事（少なくとも溜まっていた仕事を整理するため）にはこれがあっているように感じました。 ToDo項目をファイルやフォルダに見立ててあるので、階層化の管理が簡単にできるのが気に入っています。 各項目からはフォルダやファイルへのリンクが設定できるので、ランチャのようにも使えますし、項目ごとに独立したメモを設定することができます。 （私が思うに）最も特徴的なのは、予定（開始日から期限日）をバーチャートで表現できることでしょう。 これによって視覚的にも予定が把握しやすくなっています。\n","date":"2007-02-10T16:23:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2007/02/10/162315/","title":"最近使っているToDo管理のソフト"},{"content":"本年もよろしくお願いいたします。\n","date":"2006-12-31T15:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/12/31/150000/","title":"あけましておめでとうございます。"},{"content":"そういえば、携帯を携帯会社ごと変えてました。\nまあ、それもこれも妻の影響なわけですが。\nvodafone softbank から docomo へ。 SH902iS になりました。\n","date":"2006-12-12T13:44:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/12/12/134458/","title":"携帯番号ポータビリティ(MNP)"},{"content":"自分の名前を調べる＠のぶろぐ\n今回も、今後のPerlで推奨されるであろう書き方（UTF-8で書いて、「use utf8;」を用いる）をしてみました。 前回と違うのは、Encodeを明示的に使うのではなく、PerlIOに対して直接細工をします。\n参考：Perl 5.8.x Unicode関連\nWide character な文字列はそのまま出力すると文句を言われるというわけです。 回避するには、PerlIOレイヤを使うか、UTF8フラグを落とします。\nUTF8フラグをいかに落とすか、って事ですね。\nサンプル 今回は、binmodeを使って、出力を「utf8」ということにしています。\nもし、EUC-JPに変更したい場合は、「encoding」を使って文字コードを変更します。 …まあ、バグの元にもなりそうで、あまり意味はなさそうですが。\nさて、テーマは自分の名前を調べる、ですが、ここではCGI.pmで簡単に使える環境変数を取得してみました。 ドキュメントにはあまり細かくは書いていないので、簡単にスクリプトを書いて実装の参考にするのもよいですね。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 #!/usr/bin/perl -T # 日本語（utf-8） use strict; use warnings; use utf8; use CGI; binmode STDOUT, q{:utf8}; # binmode STDOUT, q{:encoding(euc-jp)}; { my $cgi = CGI-\u0026gt;new; my $html = qq{}; my $title = qq{テスト5}; $html .= $cgi-\u0026gt;header( { -charset =\u0026gt; q{UTF-8} } ); # $html .= $cgi-\u0026gt;header( { -charset =\u0026gt; q{EUC-JP} } ); $html .= $cgi-\u0026gt;start_html( { -title =\u0026gt; $title, -lang =\u0026gt; qq{ja}, } ); $html .= $cgi-\u0026gt;h1($title); $html .= $cgi-\u0026gt;start_div; if ( my $referer = $cgi-\u0026gt;referer ) { foreach my $key ( sort keys %ENV ) { my $lc_key = lc $key; $lc_key =~ s/^http_//; my $value = \u0026#34;\u0026#34;; eval { $value = $cgi-\u0026gt;$lc_key() }; unless ($@) { $html .= $cgi-\u0026gt;p( qq{環境変数「$key」の値は、「$value」です。} ); } } $html .= $cgi-\u0026gt;a( { -href =\u0026gt; $referer }, q{戻る} ); $html .= $cgi-\u0026gt;h2(qq{参考}); $html .= $cgi-\u0026gt;p( join $cgi-\u0026gt;br, sort keys %ENV ); # キーの一覧 } else { $html .= $cgi-\u0026gt;p(qq{情報の取得に失敗しました。}); } $html .= $cgi-\u0026gt;end_div . $cgi-\u0026gt;end_html; print $html; } ","date":"2006-12-09T13:17:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/12/09/131737/","title":"自分の名前を調べる"},{"content":"「戻る」リンクを作る@のぶろぐ\n今回は、今後のPerlで推奨されるであろう、\u0026ldquo;use utf8;\u0026ldquo;を使ってみた。\nCGI.pmでは、環境変数に直接アクセスしなくても取得できる。\nもちろん、間接的にはアクセスするわけだが。\nもし、環境変数が%ENVじゃなくて、%Environmentという変数に変わったとしたら、そのソースコードは動くでしょうか？\nCGI.pmを介して環境変数にアクセスしているのであれば、新しい環境変数に対応したCGI.pmにアップグレードされれば、ソースコードを変更する必要は無い。\n今回はサンプル付きです。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #!/usr/bin/perl -T # 日本語(utf-8) use strict; use warnings; use Encode; use utf8; use CGI; { my $cgi = CGI-\u0026gt;new; my $html = \u0026#34;\u0026#34;; $html .= $cgi-\u0026gt;header( { -charset =\u0026gt; \u0026#34;utf-8\u0026#34; } ); $html .= $cgi-\u0026gt;start_html( { -title =\u0026gt; \u0026#34;テスト4\u0026#34;, -lang =\u0026gt; \u0026#34;ja\u0026#34;, } ); $html .= $cgi-\u0026gt;start_div; if ( my $referer = $cgi-\u0026gt;referer ) { $html .= $cgi-\u0026gt;a( { -href =\u0026gt; $referer }, \u0026#34;戻る\u0026#34; ); } else { $html .= $cgi-\u0026gt;p( \u0026#34;HTTPからアクセスされていません。たぶん。\u0026#34;); } $html .= $cgi-\u0026gt;end_div . $cgi-\u0026gt;end_html; print Encode::encode( \u0026#34;utf-8\u0026#34;, $html ); # print $html; } ","date":"2006-11-29T15:37:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/29/153753/","title":"リメイク：「戻る」リンクを作る"},{"content":"妻はいつも言っている。 おいしいそばが食べたい、と。\n昨日行った、伊丹スカイパーク（詳しくは「伊丹スカイパーク - お気楽日和」で）で、スタンプラリーのパンフレットを取ってきたようで、今日はそのスタンプラリーに乗ってみることにした。\nまあ、今日の詳しい経緯は先に書かれてしまったので「スタンプラリー - お気楽日和」を見ていただくことにして。\n私はざるそばを注文。\n十割そばというのは、もしかしたら初めて食べたのかもしれない。 独特なざらつきがあって、歯ごたえが強いけど弾力性が無くぶちっと切れる、というか。 なかなか面白い食感で、美味しかったです。\n極め付けはそば湯。 凄く濃い。 かなりどろどろです。\n最初に出てきたそば茶も香ばしい。 まさにそば尽くしでした。\n","date":"2006-11-26T14:21:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/26/142109/","title":"道の駅「いながわ」の十割そば"},{"content":"アウトレットにて… - お気楽日和\n先日、りんくうプレミアムアウトレットに行ったついでに関西空港へ寄った。 （詳しいことは上記ページで）\nで、その時に見るともなくお土産品を見ていたら、試食コーナーがあった。 丁度食後でデザートでもと思い、チーズケーキに手を出してみたら意外とおいしかった。\n名前からして、本当においしいかどうか怪しい。 試食が無ければまず買わなかっただろう。\nナンジャタウン・お取り寄せランキング 大阪　青木松風庵おいしい大阪チーズケーキ\n実物は「アンジュミニョン（アンジェミニョン？）」というものなのだろう。チーズケーキ・アンジュミニョン│株式会社青木松風庵\nお土産仕様なのだろうが、もう少し考えてから名前をつけた方がよかったのではないか？\nまあ、でも、美味しかった。 また買うかもしれないね。\n","date":"2006-11-25T04:20:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/25/042008/","title":"「おいしい○○○」っていう商品名は止めたほうが…"},{"content":"無料・ダイナミックDNS(DDNS)サービス - ieServer.Net\nPerlを始めたころ、当時のプロバイダのサービスではCGIが実行できなかったので、自宅でサーバを立てて屋台サーバ（と当時呼ばれていた？）をやっていた。 語源は、テレホーダイの時間帯だけ出没するから、だったように記憶している。 毎回IPアドレスが変わるので、告知が面倒だった。\nダイナミックDNSサービスは、告知の面倒さをなくす便利なサービスだ。 生IPの代わりに、一定のホスト名を告知しておけば、それを変更する必要は無くなる。\nでは、IPアドレスが変わっても大丈夫なのか？ という疑問が当然出てくる。 そういう時は、ホスト名とIPアドレスを結びつけているサーバ（DNSサーバ）に新しいIPアドレスを通知してやればよい。\nDiCE DynamicDNS Client (自宅でインターネットサーバー) このソフトは、その作業を自動的に実行してくれる便利なソフトだ。\nで、最初のリンク先であるieServer.Netでアカウントは取っているのだが、とりあえず取っただけ。 公開するとすれば今作っているゲームになるが、半年程度は何も進めていないような気がする。 ひととおりの機能は揃ってはいるのだが、イベントをプログラムにうまく関連付けて発生させるところで詰まってしまってから放置してるような感じ。 何とかしたいところだ。\n","date":"2006-11-25T00:51:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/25/005106/","title":"ダイナミックDNSサービスと自宅サーバ"},{"content":"アメリカのマクドでお気に入りのメニュー、マックフルーリー。 ずっとマックフルリーと呼んでいたが、それはそれ。 ようやく日本上陸ということで、一度は食べておこうと。\nそんな時（21日の火曜日）に妻からのメールが。 どうやら、帰り道の途中にあるマクドにマックフルーリーが売っているらしい。 ということで、買って帰ることに。 正直、アイスを持って帰るのもどうかとは思いましたが。\nまあいつものことですが、期待しすぎるとろくな事がありません。\nまず大きく違うのはサイズ。 アメリカのレギュラーサイズは、日本で言うLサイズ。 マックフルーリーにも顕著に現れていた。 やはり小さい。\n次に違うのは、甘さ。 アメリカでの印象は、やはり甘いアイスクリームに、オレオのほろ苦さがマッチしていた。 しかし、日本のマックフルーリーは、オレオが甘く感じる。 オレオが同じ甘さだとすると、クリームの甘さがぜんぜん違うことになる。 まあ、実際のところ、日本版でも十分に甘いと思いますが。\nあと、やっぱり持ち歩く時間が15分程度あったので、（時間は遅かったし結構寒かったとは思いますが）それなりに溶けてました。\n作るのも意外と手間がかかるようで、作っている間は、まだ新製品なので慣れていないのかなぁ、と思いながら見ていました。 作り終わって商品を渡されるとき、何気なく店員さんの顔を見たら、びっくりするくらいの笑顔で、思わずこっちも笑顔になった。笑顔はすごく印象に残った。 で、振り向いてまたびっくり。 注文したときはレジはすいていたのに、気づいたら後ろに10人くらいは並んでいたのだ。\nで、マックフルーリーですが、妻はもう日本では食べない、と宣言していました。 私はそれほどでもありませんが、日本のアイスクリームには、もっと苦いチョコレートチップくらいが合いそうだと思いました。 カカオ70%くらいのものでも十分ほろ苦い感じが出るんじゃないかと思うんだけど、どうなんでしょう？ 機会があれば、普通のアイスとカカオ70%くらいのチョコレートで試してみようかなぁ。\n","date":"2006-11-24T16:30:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/24/163047/","title":"日本のマックフルーリー"},{"content":"がんばれ！アドミンくん 第51話 - ＠IT\n「Excelくんに気をつけろ」と言っても、なにもExcelが悪いわけじゃありません。\nExcelは扱いやすい。 高度な計算式を使うこともできるし、簡単なワープロにもなるし、グラフも簡単に作れる。 使いこなそうと思うと、色々と大変ではある。\n使い方を勉強しているうちは良いけど、いざ、それを使おうということになった場合、何のために使うのかを考えることができなくなっていることがある。 あるいは、気がつけば使いこなすことが目的になっている場合がある。\nパソコンは道具である。\n…ということを、以前からよく言われる。 目的と手段をよく混同しているのだろうから、自戒を込めて言っておこう。\n道具は使ってこそ真価を発揮するのだ。\n","date":"2006-11-22T09:16:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/22/091644/","title":"道具に使われる、ということ"},{"content":"がんばれ！アドミンくん 第49話 - ＠IT\n「あの法則」はここにもあった、って感じですな。\n20%の時間で80%が完成する。 で、残った20%を完成させるために、80%の時間を費やす。\nプログラムを作るとき、ある程度の動作をさせるまではわりと簡単にできるんですが、最後の仕上げには時間が必要になる。\nでも、結局、20%の時間でできた80%の物というのは、80%ぶんの価値は無い、って事じゃないかと。 見かけ上は80%でも、100%完成しないと使い物にはならないわけで。\n妥協せずに、ちゃんと最後まで完成させよう。\n","date":"2006-11-21T14:28:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/21/142825/","title":"最初はいいんですよ最初は"},{"content":"YappoLogs: ページがどんなキーワードで検索されたかをTagCloud風に表示させるくっつきサービス\nということで、またまたクラウド系ですが、使う側はJavaScriptを書いておくだけなので導入方法はすごく簡単です。\nしかも、設定ツールがあるので便利ですね。\nYappoLogs: Search Word Cloudの設定ツール作りました\nこのツール、一年以上前に開発されてるんですね。 ようやく1年前の時代に追いついたのかもしれません…。\n","date":"2006-11-21T14:18:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/21/141837/","title":"「Search Word Cloud」を導入してみた"},{"content":"perltidyというのは、Perlベストプラクティスに載っている、ソースコードを綺麗に整形してくれるソフト。\n最初は実行形式のプログラムだと思っていたら、Perlスクリプトだった。 考えてみれば、PerlをWindowsでやっていることがどちらかといえばイレギュラーなので、Windowsの実行形式でないのは当然か。\nインストールの方法がよくわからなかったのだが、モジュールならcpanからインストールできるんじゃないかと思ってモジュール名を指定したところ、ズバリ、ありました。 そのままインストールを開始。\ncpanがちゃんと使えるようになっていれば、インストールは簡単。\n1 cpan\u0026gt; install Perl::Tidy インストールが完了すると、Perl.exeと同じフォルダに「perltidy.bat」というファイルができた。\nあとは簡単に手順を。 oreilly.com \u0026ndash; Online Catalog: Perl Best PracticesのExamplesからソース一式を取ってくる。 解凍すると出てくる「perltidyrc」を「.perltidyrc」にリネーム。 ファイルを開いて、4行目の「-st」をコメントアウト（行頭に#を追加する）してやる。 整形したいファイル（仮にtest.plとでもしておこう）と同じフォルダに「.perltidyrc」をコピー。 で、コマンドプロンプトを開いて、そのフォルダで以下のコマンドを実行（perltidy.batの場所にはPathが通っているという前提）。\n1 perltidy test.pl と、まあ、こんな感じで「test.pl.tdy」というファイルが新しくできる。このtdyファイルが整形されたモノだ。\nちなみに、リメイク：ファイルに書き出す＠のぶろぐのコードを、整形させると以下のようになった。\n整形されたソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 #!/usr/bin/perl -T use strict; use warnings; use Encode; use encoding \u0026#34;euc-jp\u0026#34;; use CGI::Pretty; use FileHandle; { my $cgi = CGI::Pretty-\u0026gt;new; my $styles = [ q{../../ipp.css}, q{../test.css} ]; my $wdays = [ \u0026#34;日\u0026#34;, \u0026#34;月\u0026#34;, \u0026#34;火\u0026#34;, \u0026#34;水\u0026#34;, \u0026#34;木\u0026#34;, \u0026#34;金\u0026#34;, \u0026#34;土\u0026#34; ]; my $output = \u0026#34;\u0026#34;; $output .= \u0026amp;amp;print_header( $cgi, \u0026#34;テスト３\u0026#34;, $styles ); $output .= $cgi-\u0026gt;p(\u0026#34;「temp.txt」に書き出します。\u0026#34;); my $fh = FileHandle-\u0026gt;new( \u0026#34;./temp.txt\u0026#34;, \u0026#34;w\u0026#34; ) or die; my $fh_output = \u0026#34;\u0026#34;; $fh_output .= \u0026#34;この文は temp.txt の中身になるはずです。n\u0026#34;; $fh_output .= \u0026#34;書き込んだ時間は、\u0026#34;; my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst ) = localtime; $fh_output .= sprintf( \u0026#34;%04d/%02d/%02d(%s) %02d:%02d:%02dです。n\u0026#34;, $year + 1900, $mon + 1, $mday, $wdays-\u0026gt;[$wday], $hour, $min, $sec ); $fh-\u0026gt;print( Encode::encode( \u0026#34;utf8\u0026#34;, $fh_output ) ); undef $fh; $output .= $cgi-\u0026gt;div( { -class =\u0026gt; \u0026#34;test\u0026#34; }, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;./temp.txt\u0026#34; }, \u0026#34;temp.txtを見る\u0026#34; ) ); $output .= \u0026amp;amp;print_footer($cgi); # print Encode::encode(\u0026#34;utf8\u0026#34;, $output); print $output; } exit; # ヘッダ sub print_header { my ( $cgi, $title, $styles ) = @_; my $result = \u0026#34;\u0026#34;; $result .= $cgi-\u0026gt;header( { -charset =\u0026gt; \u0026#34;utf-8\u0026#34; } ); $result .= $cgi-\u0026gt;start_html( { -lang =\u0026gt; \u0026#39;ja\u0026#39;, -title =\u0026gt; $title, -style =\u0026gt; { src =\u0026gt; $styles }, } ); $result .= $cgi-\u0026gt;div( { -class =\u0026gt; \u0026#34;head\u0026#34; }, $cgi-\u0026gt;h1($title), $cgi-\u0026gt;hr, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../../../\u0026#34; }, \u0026#34;Home\u0026#34; ), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34; ), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34; ), $cgi-\u0026gt;hr, ); return $result; } # フッタ sub print_footer { my ($cgi) = @_; my $fh = FileHandle-\u0026gt;new(\u0026#34;../../sig.txt\u0026#34;) or die; my $sig = join \u0026#34;\u0026#34;, $fh-\u0026gt;getlines; undef $fh; my $result = \u0026#34;\u0026#34;; $result .= $cgi-\u0026gt;div( { -class =\u0026gt; \u0026#34;foot\u0026#34; }, $cgi-\u0026gt;hr, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../../../\u0026#34; }, \u0026#34;Home\u0026#34; ), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34; ), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a( { -href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34; ), $cgi-\u0026gt;hr, $sig, ); $result .= $cgi-\u0026gt;end_html; return $result; } スゲェ。\n","date":"2006-11-20T13:54:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/20/135449/","title":"perltidyを試してみた"},{"content":"今更な感じはするけれど。 ここ最近になっていろいろなサイトを見てまわったり、CatalystやPlaggerを入れてみたり使ってみたりしているうちに、段々と知識欲が出てきた。 もっとPerlの事を知りたいと。\n最近発売されたばかりの続・初めてのPerl 改訂版とどっちにしようか迷った。 この本は、naoyaのはてなダイアリーで紹介されているのを見て、テストの事は知っておきたいと思った。 まあ、それ以外は大体わかっている、つもりではある。\n丁度本屋に行ったので、気になったテストの章を見てみた。\nTest::Moreというモジュールを使ってテストをする。 まずテストを作り、それを満足するコードを書いていく。 というようなことが書いてあった（と思う。全部読んだわけじゃない） 似たようなことをウェブで読んだ気もする。\nで、次にPerlベストプラクティスの方。 この本は、いろいろなサイトで奨められていて気になっていた。 とりあえず、第1章を軽く流し読み。 1.2の「本書について」のあたりで、奨められる理由がわかってきた。 改めて目次を見てみると、テストのことも書いてある。 買うとしたらこっちだなぁ。\n問題は、買うか買わないか、だが…。 専門書だけにそれなりに高い（4,300円+税）ので、なかなか手が出せない。 しかし、内容が内容だけに買うのなら早いほうがいい、ということで買うことに決めた。\nまだ4章だが、盛り沢山すぎ。 コードのレイアウトは気にしてみようと思った。\nPerlベストプラクティス Damian Conway クイープ オライリー・ジャパン 売り上げランキング: 65072\nおすすめ度の平均: ★★★★☆ ★★★★★ 日頃のPerlスタイルの復習と発展学習に ★★★★☆ 私には早すぎたかな？\nAmazon.co.jp で詳細を見る\n続・初めてのPerl 改訂版 Randal L. Schwartz brian d foy Tom Phoenix 吉川 英興 伊藤 直也 田中 慎司 株式会社ロングテール/長尾 高弘 オライリー・ジャパン 売り上げランキング: 34989\nAmazon.co.jp で詳細を見る\n","date":"2006-11-19T14:11:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/19/141116/","title":"Perlベストプラクティスを買ってきた"},{"content":"そういえばノートPCを買っていた しかし、今は妻のもの…。 またアダプタの調子が悪いらしい。 よっぽど使い方が荒いのだろう。 かわいそうに。\n","date":"2006-11-16T15:32:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/16/153255/","title":"そういえばノートを持っていたんだね。昔は。"},{"content":"モジュールの一括更新@のぶろぐ\n1 perl -MCPAN -e \u0026#34;CPAN::Shell-\u0026gt;install(CPAN::Shell-\u0026gt;r)\u0026#34; 最近のCPANモジュール(Ver1.8802)では、\n1 perl -MCPAN -e \u0026#34;CPAN::Shell-\u0026gt;upgrade\u0026#34; で良いようだ。 いつから出来たんだろ？\n","date":"2006-11-15T14:46:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/15/144642/","title":"モジュールの一括更新"},{"content":"…ということで検索をしていると、mt-rebuild.plに行き着く。 MovableType備忘録: MovableTypeを自動的に再構築する 一つのテンプレートを再構築するには十分なのだが、いくつかのテンプレートを効率よく再構築する方法は無いものか？ イメージとしては、\n1 2 my $template = MT::Template-\u0026gt;load([1, 2, 3]); $mt-\u0026gt;rebuild_indexes(BlogID =\u0026gt; 1, Template =\u0026gt; $template, Force =\u0026gt; 1); とか、\n1 2 my @template = MT::Template-\u0026gt;load(1, 2, 3); $mt-\u0026gt;rebuild_indexes(BlogID =\u0026gt; 1, Template =\u0026gt; @template, Force =\u0026gt; 1); かなぁ。 単一のテンプレートだけを再構築できるように、\n1 2 3 MT::Template-\u0026gt;load(1)-\u0026gt;rebuild; MT::Template-\u0026gt;load(2)-\u0026gt;rebuild; MT::Template-\u0026gt;load(3)-\u0026gt;rebuild; みたいなのでもいいんだけど…。 Movable Type オブジェクト・リファレンス - MT::Templateとか見ても、そんなのはなさげ。\n","date":"2006-11-15T13:46:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/15/134600/","title":"特定のインデックステンプレートを自動的に再構築する方法"},{"content":"む～。 設定が楽なのはいいのだが、リポジトリの順番が変えられないし、libにあるモジュールのアップデートなのにsite/libのほうにインストールされてしまう（libはロックされていて上書きできないようだ（？））。\nGUIなら、例えばインストールしたいものをCtrlを押しながら選択していったり、Ctrl＋Aで全て選択とかできればいいのだが、複数選択に対応していない…。\nPlaggerをインストールする時に、このあたりの不便さに使うのが嫌になった。\nで、結局cpanのお世話になることにした。 Plaggerも、一旦動いたあと、cpanからforceインストール。 こうすると、nmakeが自動的に設定されるようなので、あとが楽です。\n1 cpan\u0026gt; force install Plagger ","date":"2006-11-14T16:18:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/14/161816/","title":"ActivePerlのGUIなppmが微妙な件"},{"content":"なかなか手を出せなかったPlaggerに手を出してみた。\nまるごとPerl! Vol.1で紹介されていたページ（しげふみメモ:Windowsで Plagger 準備#1 ActivePerlインストール）から、さらに便利なページができていた（しげふみメモ:Windowsで簡単にPlaggerをインストールする方法）ので、ppmを使ってインストールすることにしました。\nppmのリポジトリが最新のActivePerlにも対応した（Charsbar::Note - PPM 4.x対応しました）らしいので、こちらを利用することに。\n細かい手順を書くつもりが無かったので、詳しく覚えていませんが、とりあえずインストールしては実行して、エラーが出たら足りない分をインストールして実行…を繰り返して、ようやく空のconfig.yamlが実行できた。\nあとで思えば、ここまでで道のりの半分くらいですね。\n次の段階であるrss2email.yamlですが、これが問題でした。 本に載っているソースはこんな感じ。\n1 2 3 4 5 6 7 8 9 plugins: - module: Subscription::Config config: feed: - http://blog.bulknews.net/mt/index.rdf - module: Publish::Gmail config: mailto: ユーザー名@gmail.com これで、http://blog.bulknews.net/mt/index.rdfが取得されて、メールが送信される…はずだったのですが、うまくいきません。 そういえば、勝手に「sendmailとか使うんだろう」とか思っていたのですが、よく考えてみるとsendmailなんてインストールしてないし、そもそも使っているのかもわからない。 ということは、メールを送る手段が無い、ということで。\nで、まあ本にも書いてあるとおり、Publish::Gmailの設定を細かく見ていくことに。 いくつか見てまわった結果、Publish::Gmailの設定（というか、設定しかないわけだが）は以下のような感じで次の段階へ進むことができた。 まあ、Gmailを使って、Gmail宛に送信する、という感じですね。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 plugins: - module: Subscription::Config config: feed: - http://blog.bulknews.net/mt/index.rdf - module: Publish::Gmail config: mailto: ユーザー名@gmail.com mailfrom: ユーザー名@gmail.com mailroute: via: smtp_tls host: smtp.gmail.com:587 username: ユーザー名@gmail.com password: パスワード こうなった時に、ssleay32.dllがどうとか、libxmlがどうとか、いろいろとエラーが出たので、またこれも調べたところ、dllの配布場所を見つけた。 zlatkovic.com - Libxmlの右側にあるメニューからバイナリのディレクトリを見ることができるので、そこから、iconv、libxml2、opensslをダウンロードして、中身のdllファイルを全てplagger.batと同じ場所にコピーしてやる。\nそうすると、ようやく完成。 自分から自分宛のメールが届きました。\nしかし、設定ファイルであるyamlを少し書くだけでこういうことができると、プログラムというよりはソフトウェアという感じです。 使い甲斐がありそうですね。\n","date":"2006-11-14T14:20:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/14/142040/","title":"Windows+ActivePerlにPlaggerを入れるの巻"},{"content":"エントリーを普通に書くと、おそらくEncodeで変換するときに、「～」が「?」に変換されるのだ。\nなので、MovableType（Version 3.33-ja）のライブラリを直接書き換えてやろうと思ったのですが、うまくいかない…。 やっぱり「～」って書かないといけないかなぁ…。\n参考： [Perl] Encode::FB_XMLCREFでコード変換に失敗＆対策 Kawa.net Blog（ゆうすけブログ）/ウェブリブログ 404 Blog Not Found:perl - Encode::from_to() and fallback options\n","date":"2006-11-11T10:45:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/11/104512/","title":"「～」が文字化けする件について苦戦中"},{"content":"すぐにできる人はできるんですねぇ。 spiritlooseのはてなダイアリー - はてなダイアリーをタグクラウド化 さっそく試してみました。 ここのログを書き出して、はてなダイアリーでインポート。 しばらく待って全部の記事が反映されたら、今度はCSV形式でダウンロードする。 これでファイルは準備完了。 で、次は、はてなダイアリーTagCloudにログイン。 最初のログインのときは、はてな認証をしても良いか確認する画面になった。 ま、認証は公開するときに必要なだけで、作る分には認証の必要は無いようだ。 さて、先ほどのファイルを選んで「TagCloud作成」を押すと、しばらく待って結果が出る。 結果は、カテゴリーとかタグに使っている語句が多かった…。 やっぱり、本文だけをどうにかしたいなぁ。\n","date":"2006-11-08T17:50:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/08/175027/","title":"タグクラウド化を試してみた"},{"content":"アメリカンエクスプレスって、こういうセールスもやるんだね。\nこの辺かな？ アメリカン・エキスプレス 個人のお客さま：保険商品のご案内\nなんとなく、もっとクールなカード会社なのかと思ってたけど、キャンペーン中はそうでもないのかな？\n聞いた感じでは普通の傷害保険と同じようなものなのだが、説明が長い。\nこれじゃ、普通の勧誘電話と同じだなぁ。\n","date":"2006-11-08T03:53:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/08/035323/","title":"アメリカンエクスプレスから保険の勧誘電話"},{"content":"何を調べていたのかは忘れてしまったのだが、何故か気になった記事があった。\nMovableType備忘録: エントリを更新された順にソートする エントリーを更新順にソート (オラオラ) …更新エントリーを表示するのって大変だなぁ、と思ったのだが、どこかでもっと簡単な方法を見たような気がしたので探してみた。 …それは意外なところで見つかった。 Movable Type 3.3 マニュアル: テンプレート・タグ リファレンス MTEntriesのアトリビュートにsort_byがあって、その対象として「modified_on（変更日時）」がありました。 Movable Type 3.3から、複数のアトリビュートを指定できる、という事なので、最近更新された10件を表示する場合は、\n1 2 3 4 5 6 7 \u0026lt;ul class=\u0026#34;module-list\u0026#34;\u0026gt; \u0026lt;MTEntries lastn=\u0026#34;10\u0026#34; sort_by=\u0026#34;modified_on\u0026#34; sort_order=\u0026#34;descend\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;module-list-item\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;$MTEntryPermalink$\u0026gt;\u0026#34;\u0026gt; \u0026lt;$MTEntryTitle$\u0026gt; \u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/MTEntries\u0026gt; \u0026lt;/ul\u0026gt; という感じで可能のようですね。 テンプレートタグの一覧を見たいときにはhxxk.jp - Movable Type 3.3 のテンプレートタグリファレンス自家用版が便利でよく使っています。 **追記（2006/11/09 00:25）：**ソースを追っていないのでわかりませんが、アトリビュートの優先順位がよくわからないので、この方法では「最近更新された…」にはなりません。\n","date":"2006-11-08T03:12:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/08/031256/","title":"最近更新されたエントリーを表示するためのアトリビュート（失敗作）"},{"content":"POLAR BEAR BLOG: 「後から」自動タギング\nこの際、タギングを自動化することをもっと考えても良いのではないでしょうか。\nこういう発想がベンチャー的なんでしょうねぇ。\n自動化、という意味で言えば、日本の総理大臣の演説をタグクラウド化: blog.bulknews.netで行っているような「形態素解析」を使うのもありですね。\n形態素解析 - Wikipedia\n他人の記事にタグ付けするのとは逆になりますが、自分自身が何かを伝えようとして書いた記事を解析したときに、ちゃんとその何かが重要なポイントとして解析されているのか、を客観的に診断するツールとしても利用できそうです。\nまあ、MT用のプラグインにするのは重いでしょうけどね…。 指定したURIの形態素解析を行ってタグクラウド化してくれる、とかいうサービスができたら面白そうですね。 ま、かなり負荷が高いでしょうけどね。\n","date":"2006-11-07T16:27:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/07/162751/","title":"タグの進化のために"},{"content":"我が家のリビングには、壁掛けの電波時計がある。 その電波時計が、昨日あたりから狂っていたのだ。\n昨日起きたのは、午前11時頃のはずだったのだが、リビングに行くと何故か12時すぎになっていた。 首をひねりながら寝ぼけてたのかと思ってトイレへいくと、そこの時計も11時すぎ。\nどうも調子が狂う。 なので、とりあえず窓際に置いて放置していたら、今さっき時間が回復したようだ。 かれこれ1日半も1時間先の世界にいた時計は、何食わぬ顔をして元通りに戻っていた…。\n電波時計ということで、時間に関してはかなり信頼を置いているだけに、今回のようなことがあると非常に怖い。\n","date":"2006-11-05T14:30:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/05/143005/","title":"狂った電波時計"},{"content":"ぐるなび - スパゲティハウス マッキー いつきの家\nもちもちパスタが評判ということで行ってみる事に。\nとりあえず電話番号でナビに入力で簡単に目的地設定。 だがしかし、最後の最後で生活道路内に迷い込む…。 （車で行くときは北側から回り込むように行ったほうがいいです。府道2号を東向きに行き、右側に1FにFamily Martが入っている白いマンションを右に入っていくとよさげですね。） 建物はその生活道路からも奥まった所にありました。 敷地に入ると結構広く、車も結構台数が停まっていました。\n","date":"2006-11-05T11:47:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/05/114737/","title":"スパゲティハウス マッキー いつきの家"},{"content":"The Old Spaghetti Factory - オールドスパゲティファクトリー\nもう昨日の話になりましたが、オールドスパゲティファクトリーで「4種類のソースのスパゲッティ」を食べてきました。\n最初はテイスティングできるように4皿に分かれているのかと思っていたのですが。\n実物はこんな感じで\n一皿に4種類のソースがかかっていました。\n「お好みにより切ってお召し上がりください」ということで、ナイフを置いていかれたので、思わず4つに切り分け（というか、切れ目を入れたというか）ましたが、正直それはお勧めできません。 やはり最初から4皿に分けてほしいですよねぇ。\nミート（左手前）は美味しかったです。 チーズ（右手前）はかなり塩のきつい感じでした。 トマト（右奥）はちょっと酸味がきつい感じでした。 クラム（左奥）は普通というか、普通でした。\n妻が食べた「水菜とベーコンのペペロンチーノ温泉卵添え」は、（おそらくベーコンの？）炭のにおいがきつくてあまり美味しいとは思いませんでした。 なにより、水が美味しくなかったのがとても残念ですね。\nもう何年か前になりますが、そのときに食べたペペロンチーノは美味しかったと思ったのですが…。 結構期待していただけに結構がっくりきました。\n","date":"2006-11-05T08:43:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/05/084340/","title":"オールドスパゲティファクトリー"},{"content":"この前、残業を切り上げて会社から帰る間際に、ちょっとmixiにアクセスしたら、家からメールが来た。 「mixiやってないで早く帰ってきなさい」\n","date":"2006-11-04T17:44:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/04/174452/","title":"mixiで監視される"},{"content":"アキバ系!文京区本郷四畳半社長: 秋の夜長にRubyを学ぶ\nピラミッドを建設している最中に、「昨日よりもっと楽にできないか」、楽になったら、「昨日よりもっと速くできないか」、速くできるようになったら「そのプロセスを自動的に繰り返せないか」、それが自動的に繰り返せるようになったら「やーめた」という考えをする人が、ベンチャー企業的なのではないかと思います。要するに飽くなき変化への欲求です。まあこれだけ飽きっぽいと困りますが。\nRubyもやってみたいと、何度も思ったりするんですが、一歩踏み出せないのは年齢のせい？とか思ったりもするんです。\nあとは、UNIXマシン（VineLinuxですが）があるのに、ほとんど起動させていないのも理由なのかもしれません。 …それこそ第一歩は踏み出しているんですが…。 ま、ネットくらいはLinuxでやってみることにして。\n新しいことや変化を求めたりするのには、エネルギーが必要で、そのエネルギーを持っているからこそ変化を実際に求める行動を起こすことができるのでは、と思っています。 ベンチャー企業を起こす人は、そういうエネルギーを持っているんでしょう。\n言語の一つを覚えるのに逡巡しているようでは、なかなかそうもいかないですね。\n","date":"2006-11-04T14:37:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/04/143748/","title":"勢いというか若さというか"},{"content":"追記（more）に記事を書いていると、メインページなどで「続きを読む\u0026hellip;.」というリンクが出るようになるが、デフォルトのAtomやRSS2.0のテンプレートでは、そういう風にはなっていない。 おまけに、SleipnirのHeadline-Reader Pluginでは「閉じタグ」らしきものが見えてしまっていた。 それがどうにも気になって、なんとかしてやろうと思ってみた。\n変更するのは「entry」内の「content」。\nAtom.xmlのデフォルトテンプレートでは、「MTEntryBody」と「MTEntryMore」がそのまま表示されている。\n1 2 3 4 \u0026lt;content type=\u0026#34;html\u0026#34; xml:lang=\u0026#34;\u0026lt;$MTBlogLanguage ietf=\u0026#34; 1\u0026#34;$\u0026gt;\u0026#34; xml:base=\u0026#34;\u0026lt;$MTBlogURL encode_xml=\u0026#34;1\u0026#34; $\u0026gt;\u0026#34;\u0026gt; \u0026lt;$MTEntryBody encode_xml=\u0026#34;1\u0026#34; convert_breaks=\u0026#34;0\u0026#34; $\u0026gt; \u0026lt;$MTEntryMore encode_xml=\u0026#34;1\u0026#34; convert_breaks=\u0026#34;0\u0026#34; $\u0026gt; \u0026lt;/content\u0026gt; これを以下のように変更する。\n1 2 3 4 5 6 7 8 \u0026lt;content type=\u0026#34;html\u0026#34; xml:lang=\u0026#34;\u0026lt;$MTBlogLanguage ietf=\u0026#34; 1\u0026#34;$\u0026gt;\u0026#34; xml:base=\u0026#34;\u0026lt;$MTBlogURL encode_xml=\u0026#34;1\u0026#34; $\u0026gt;\u0026#34;\u0026gt; \u0026lt;MTIfNonEmpty tag=\u0026#34;EntryBody\u0026#34; encode_xml=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;$MTEntryBody$\u0026gt; \u0026lt;MTIfNonEmpty tag=\u0026#34;EntryMore\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;$MTEntryPermalink$\u0026gt;\u0026#34;\u0026gt;続きを読む\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/MTIfNonEmpty\u0026gt; \u0026lt;/MTIfNonEmpty\u0026gt; \u0026lt;/content\u0026gt; content全体を一度にencode_xmlするために、冗長なタグも使っているが、少なくともSleipnirのHeadline-Reader Pluginではきれいに読めるようになったので、一石二鳥である。\n","date":"2006-11-04T13:32:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/04/133249/","title":"Atom.xmlで「続きを読む」を表現する方法"},{"content":"アキバ系!文京区本郷四畳半社長: 週末Script Kiddie\nその中でもとりわけ僕が羨ましいと思ったのは、Win32::CaptureIEという、IEの出力をそのままキャプチャしてしまうライブラリです。\n似たようなことができるサービスがあったりするんです。 しかも、Web上で。\nWeb2.0と呼ばれるのがどの範囲かはともかく、新しいウェブサービスというのは想像以上に速いスピードで増えています。 何かを覚えてやるよりも先に、同じことを誰かがやっていないか、を探すほうが速いかもしれません。 …もちろん、自分でやることが大事なこともあるわけですが。\nで、ページのサムネイルやPDFを作成してくれるサイトが HeartRails Capture | サイトのURLから画像/PDFを生成 です。\n上記サイトで作った、ここのトップページの画像がこれです。 画像のサイズは、今のところプリセットの5種類（tiny, small, medium, large, hugeで、上の画像はmedium）ですが、APIも公開されているので将来的には好きなサイズもできる？かもしれません。\n","date":"2006-11-04T12:27:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/04/122712/","title":"ブラウザの画面をキャプチャする方法"},{"content":"404 Blog Not Found:モテたかったら持つな\nそれは、「ほれっぽい」こと。彼/女らは、「もてる」以前に「ほれて」いるのだ。彼/女らがほれている対象は、「ほれられている」対象とは必ずしも一致しない。しかし「ほれて」る対象に対して懸命なのは共通なのだ。\n人を見る目、というのは、意外と誰でも持っているのかも？\n一所懸命な姿、というのを見せるのは結構恥ずかしいものだ。 必死の形相で走っている姿とかは、普段クールにしている人ほど見せられる物ではない、と、当の本人は思っているだろう。 何事にも一所懸命になれる人というのを羨ましく感じるのは、一所懸命になることを恥ずかしいと思ってしまうからだろう。\n人を好きになる事がその人を魅力的にする、というのは、身近に感じられることだろう。 昨日までなんとも思ってなかった異性が、突然魅力的に見えたりすることがある。 それは、その異性が誰かに恋をした、ということに気づいた証なのかもしれない。\n","date":"2006-11-04T11:35:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/04/113509/","title":"モテるための秘訣"},{"content":"404 Blog Not Found:ちょっとはまともな仕事を選べって\n残業が利益にならないように給与システムを再構築すると同時に、「職場のヌシ」たちにははっきりとデータを示した上で、「あなたにこの仕事は向かない」とはっきりと告げた。\n後半は所謂リストラってやつですね。ちゃんとデータがあれば否定もできないわけだが、日本のほとんどの会社はリストラには苦労しただろう。\n客観的なデータを用意するのは大変だったんじゃないだろうか？\nというのは、結局のところ給与システムが大きな問題で、評価する側にしても残業時間数以外に客観的なデータが無いからだ。\nIT関係ではないが、うちの会社は給与の仕組みを「成果給」ということにしている。 しかし、今まで「評価する」ということをしてこなかった人たちが評価する側にまわったことで、評価するに際しての教育とかを人事がやることになったようだ。\n今のところ、まだちゃんと給与に反映されている訳ではないのでこれ以上は何もいうことは無いが、誰もが納得できる画期的な給与システムってないものかねぇ？\n","date":"2006-11-03T02:06:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/03/020632/","title":"仕事と給料の関係"},{"content":"ファイルに書き出す (のぶろぐ)\n書き直してみるシリーズ第3弾。\n今回は、CGI::Prettyを使ってみた。 …と言ってもソースを見ただけでは何が違うのかわからないけど。\nあと、Perl5.8っぽい書き方を目指してみた。\nCGI::Prettyは、出力するHTMLソースをインデントをつけて整形して出力してくれる。 それ以外は、CGI.pmと同じで、使い方も\n1 use CGI; の部分を\n1 use CGI::Pretty; に変更するだけ。\nで、Perl5.8っぽい書き方のほうだが。 （おそらくこのままだとフォームからの入力ではまりそうだけど、）とりあえずの考え方として、\n1 use encoding \u0026#34;euc-jp\u0026#34;; を使う事とした。 こうすることで、この「euc-jp」で書かれたスクリプトが実行されるときには「Perlの内部形式」に変換されて実行されるようになる。\nただし、出力するときには「Perlの内部形式」のまま出力すると\n1 Wide character in print at .... のように警告されるので、Encodeを使って出力用の形式に変換してやる必要があるようだ。\nとりあえず、今回はそれほど問題ではなかったが、Perl 5.8.x Unicode関連によると、\nencoding プラグマはお手軽だけど副作用が大きいとのことです。Perlの方向性としては、ソースコードをUTF8で書き、use utf8 するというのがいいらしいです。\nということなので、euc-jpで書いているのであれば、無理矢理Perl5.8っぽい書き方をする必要は無い。\nただし、「Perlの内部形式」を意識した場合、マルチバイトな文字でも1文字扱いとなるので、テキスト処理に対してますます有利になることは間違いないだろう。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 #!/usr/bin/perl -T use strict; use warnings; use Encode; use encoding \u0026#34;euc-jp\u0026#34;; use CGI::Pretty; use FileHandle; { my $cgi = CGI::Pretty-\u0026gt;new; my $styles = [q{../../ipp.css}, q{../test.css}]; my $wdays = [\u0026#34;日\u0026#34;, \u0026#34;月\u0026#34;, \u0026#34;火\u0026#34;, \u0026#34;水\u0026#34;, \u0026#34;木\u0026#34;, \u0026#34;金\u0026#34;, \u0026#34;土\u0026#34;]; my $output = \u0026#34;\u0026#34;; $output .= \u0026amp;print_header($cgi, \u0026#34;テスト3\u0026#34;, $styles); $output .= $cgi-\u0026gt;p(\u0026#34;「temp.txt」に書き出します。\u0026#34;); my $fh = FileHandle-\u0026gt;new(\u0026#34;./temp.txt\u0026#34;, \u0026#34;w\u0026#34;) or die; my $fh_output = \u0026#34;\u0026#34;; $fh_output .= \u0026#34;この文は temp.txt の中身になるはずです。\\n\u0026#34;; $fh_output .= \u0026#34;書き込んだ時間は、\u0026#34;; my ($sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst) = localtime; $fh_output .= sprintf(\u0026#34;%04d/%02d/%02d(%s) %02d:%02d:%02dです。\\n\u0026#34;, $year + 1900, $mon + 1, $mday, $wdays-\u0026gt;[$wday], $hour, $min, $sec); $fh-\u0026gt;print(Encode::encode(\u0026#34;utf8\u0026#34;, $fh_output)); undef $fh; $output .= $cgi-\u0026gt;div({-class =\u0026gt; \u0026#34;test\u0026#34;}, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;./temp.txt\u0026#34;}, \u0026#34;temp.txtを見る\u0026#34;)); $output .= \u0026amp;print_footer($cgi); print Encode::encode(\u0026#34;utf8\u0026#34;, $output); } exit; # ヘッダ sub print_header { my ($cgi, $title, $styles) = @_; my $result = \u0026#34;\u0026#34;; $result .= $cgi-\u0026gt;header({ -charset =\u0026gt; \u0026#34;utf-8\u0026#34; }); $result .= $cgi-\u0026gt;start_html({ -lang =\u0026gt; \u0026#39;ja\u0026#39;, -title =\u0026gt; $title, -style =\u0026gt; { src =\u0026gt; $styles }, }); $result .= $cgi-\u0026gt;div({-class =\u0026gt; \u0026#34;head\u0026#34;}, $cgi-\u0026gt;h1($title), $cgi-\u0026gt;hr, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../../../\u0026#34; }, \u0026#34;Home\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34;), $cgi-\u0026gt;hr, ); return $result; } # フッタ sub print_footer { my ($cgi) = @_; my $fh = FileHandle-\u0026gt;new(\u0026#34;../../sig.txt\u0026#34;) or die; my $sig = join \u0026#34;\u0026#34;, $fh-\u0026gt;getlines; undef $fh; my $result = \u0026#34;\u0026#34;; $result .= $cgi-\u0026gt;div({-class =\u0026gt; \u0026#34;foot\u0026#34;}, $cgi-\u0026gt;hr, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../../../\u0026#34; }, \u0026#34;Home\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({-href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34;), $cgi-\u0026gt;hr, $sig, ); $result .= $cgi-\u0026gt;end_html; return $result; } ","date":"2006-11-02T12:50:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/02/125032/","title":"ファイルに書き出す"},{"content":"Yahoo!ニュース - 読売新聞 - 酔って7歳長女と5歳長男に暴行、大工の父親を逮捕\n調べによると、香月容疑者は29日午後8時40分ごろ、アパート自室で小学2年の長女（7）と、保育園児の長男（5）に暴行を加え、ともに軽傷を負わせた疑い。\nこの原因が、ゲームのセーブデータですよ。\n香月容疑者は親子3人暮らし。元妻（34）が香月容疑者に電話をした際に子供の泣き声が聞こえたため、通報した。\n通報は元奥さん、ということで、離婚理由も暴力だったのかなぁ。 で、殺されると心配して通報した…とか。\n香月容疑者は酒に酔っていたといい、「ゲーム機の保存データが消えていたのでかっとなった」と供述している。\n酒は呑んでも呑まれるな。\n","date":"2006-11-01T16:17:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/01/161707/","title":"セーブデータが消えた時の出来事"},{"content":"Yahoo!ニュース - スポーツ報知 - 暴走「凶弟」ゲンカ、兄の頭にボーガン\n兄弟げんかは凄惨（せいさん）な結末に至った。堀口容疑者が兄をボーガンで撃った理由は何と「兄がテレビをつけっぱなしにしていた」こと。兄に重傷を負わせたにもかかわらず調べに対し反省した様子はなく、今までのところ謝罪の言葉もないという。\n冗談だと思いたい。\n兄弟はこれまでも家具を破壊するほどの大げんかを繰り返していた。父は3年前に、母は2年前にともに病気で他界。家には兄弟のほかに祖母と妹が住んでいた。兄はプログラマーの職に就き一家の生活を支えていたが、弟はニートな暮らしに終始し、あげくの暴発。兄の命に別条はないといわれているが、脳挫傷、脳出血のため今後、後遺症が残る可能性もあるという。\n少なくとも2年間は、兄に扶養されていたわけだ。 しかし、\n犯行に使われたボーガンは同容疑者が2年前に通信販売で購入した。本体は縦約70センチ、横60センチ。矢は全長37.5センチ、直径8ミリで先端は金属製のもの。兄のだらしなさに腹を立てていた堀口容疑者は殺傷能力十分のこのボーガンを手に、ついに“制裁”を決意したという。\n2年前に、既にボーガンを手に入れている。 何のために手に入れたのかはわからないが、計画的にも見える。\n「制裁」というのが本人が言ったことかどうかはわからないが、「謝罪も無い」らしいことから考えると当たらずとも遠からずって感じだし、もともとこれが目的で凶器を手に入れたのかもしれない。\n…まあ、兄弟ゲンカが絶えないということは、兄が弟にいつも愚痴っていたのかもしれないなぁ。 ニートだからって生きるには金が必要だ。 兄の方も、ぐうたらな弟に、お前にやる金は無い、とか言っていたんだろう。\nまあ、なんと言うか。 ほんの少し、お互いのことを考えれば、こういう凄惨な事件はおきないと思うのだが…。\n","date":"2006-11-01T15:48:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/01/154851/","title":"嫌な事件"},{"content":"shag の日記 - defined-or(//)\n先日の「undefと0と空文字列」で書いた「//」という演算子についてですが、名称としては「defined-or」というらしいですね。 しかも、5.8.1から使えているようです。 試してみるんだった。\n","date":"2006-11-01T03:44:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/11/01/034402/","title":"defined-orという演算子"},{"content":"「システムの能力不足」孫社長が業務停止で陳謝 : 社会 : YOMIURI ONLINE（読売新聞）\nトラブルの原因について、同席した阿多親市（あた・しんいち）専務執行役は「システムの能力不足と言わざるをえない」と述べた。\nソフトバンクは、MNPに対する認識が甘かった、ということなのかなぁ。\nそれにしても、「システムの処理能力不足」という言葉で片付けられるのは不本意だろうなぁ。\n","date":"2006-10-30T16:28:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/30/162800/","title":"これも予想外か？"},{"content":"ファイルから読み込む (のぶろぐ)\n書き直してみるシリーズ第2弾。\n今回は、CGI.pmをfunctionスタイルではなく、OOP風に使ってみる。 以前は細かい処理も自分で書いていたが、使えるモジュールは使う方向で。 また、サブルーチンにもしてみた。\nEncodeが標準装備となったPerl5.8以降は、文字コード関係の考え方ががらっと変わっている。 で、リメイクするにあたってPerl5.8風の書き方と、utf8を使っていこうと思ったのだが、とりあえず、今回はeuc-jpということで濁しておく。 前回はutf8で出力していたが、文字コードがutf8で書いた状態を想定しているだけで、新しい考え方で実行しているわけではない。\nPerlEditorはutf8を扱えないので、挑戦するとしたらeuc-jpで書いたスクリプトをPerl5.8らしく動作させる、という方向になるだろう。 今、参考に見ているサイトをいくつか挙げておく。\nPerl 5.8.x における日本語コード変換のメモ Perl 5.8.x Unicode関連 ソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #!/usr/bin/perl use strict; use warnings; use CGI; use FileHandle; { my $cgi = CGI-\u0026gt;new; my $styles = [\u0026#34;../../ipp.css\u0026#34;]; \u0026amp;print_header($cgi, \u0026#34;テスト2\u0026#34;, $styles); print $cgi-\u0026gt;p(\u0026#34;「sig.txt」を読み込みます。\u0026#34;); print $cgi-\u0026gt;start_div; my $fh = FileHandle-\u0026gt;new(\u0026#34;../../sig.txt\u0026#34;) or die; print $fh-\u0026gt;getlines; undef $fh; print $cgi-\u0026gt;end_div; \u0026amp;print_footer($cgi); } exit; # ヘッダ sub print_header { my ($cgi, $title, $styles) = @_; print $cgi-\u0026gt;header({ -charset =\u0026gt; \u0026#34;euc-jp\u0026#34; }); print $cgi-\u0026gt;start_html({ -lang =\u0026gt; \u0026#39;ja\u0026#39;, -title =\u0026gt; $title, -style =\u0026gt; { src =\u0026gt; $styles }, }); print $cgi-\u0026gt;h1($title); } # フッタ sub print_footer { my ($cgi) = @_; print $cgi-\u0026gt;hr; print $cgi-\u0026gt;div( $cgi-\u0026gt;a({ href =\u0026gt; \u0026#34;../../../\u0026#34; }, \u0026#34;Home\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({ href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34;), \u0026#34;/\u0026#34;, $cgi-\u0026gt;a({ href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34;), ); print $cgi-\u0026gt;hr; print $cgi-\u0026gt;address( $cgi-\u0026gt;a({ href =\u0026gt; q{mailto:nobu3@x.age.ne.jp}}, \u0026#34;Written by Nobu3\u0026#34;), ); print $cgi-\u0026gt;end_html; } ","date":"2006-10-27T14:12:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/27/141247/","title":"ファイルから読み込む"},{"content":"がんばれ！アドミンくん 第33話 - ＠IT\n本当に落とされたらたまりません。\n会社でよく使われる言葉。 「これ焼いといて」\n実際に燃やされた例は無いようですが、コピーすることを「焼く」というのは何故でしょうね？\n","date":"2006-10-25T15:42:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/154203/","title":"業界用語の危険性"},{"content":"がんばれ！アドミンくん 第31話 - ＠IT\nうちの会社にもいますとも。\n今でこそWordもそれなりに使われていますが、昔の書類を参考に…と思って探してみると、Excelのファイルだらけ。 文章はテキストボックスを使っていたりも。 また、セルの結合、縮小して表示、折り返して表示、など。\n何よりも。 この前Accessでデータ管理をしていこうと思っていたら、「Accessは引継ぎができなくなるからダメ」と言われた…。 うむぅ。\n","date":"2006-10-25T15:32:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/153240/","title":"万能ソフトウェアExcel"},{"content":"第29話　情報砂漠：4コマまんが「がんばれ！アドミンくん」 - ＠IT\n無料でいろいろな情報を集めることができるのは確かにお得だ。\nしかし、例えば最近買った「まるごとPerl! Vol.1」では、ウェブではどこを見てもよくわからなかったCatalystの導入法から簡単な使い方までが、検索にかけた時間よりもはるかに短い時間で手に入る。\nPerlを始めたころは、ウェブの情報だけで頑張っていたが、結局本を買ってからのほうが圧倒的に習熟のスピードが上がった。\n専門書はそれなりの値段がするので敬遠しがちだ。 私もそうだが、仕事でプログラミングをするわけではないのならばなおさらだ。\nでも、時間が限られているからこそ、本を買う価値がある、というものだ。\n","date":"2006-10-25T14:19:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/141950/","title":"本が必要な理由"},{"content":"がんばれ！アドミンくん 第27話 - ＠IT\n削除コマンドは気をつけないとねぇ…。\n実際のところチェックしても無意味なんだよね。 何度チェックしても間違えることはあるわけで。\nこういう場合は、間違いに気づいたときに元に戻せるようにする、のがいいんだろうなぁ。\n","date":"2006-10-25T14:11:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/141127/","title":"事前にしっかりチェック"},{"content":"がんばれ！アドミンくん 第25話 ? ＠IT\nExcelは計算は確かに間違いません。 でも、計算式が正しいかどうかは人間が確認しないとわからんのです。\nまあ、私の場合は、計算式を全部確認するわけですが、縦横を全部見るのって結構大変なんですよねぇ…。 確認するよりも最初から設定しなおすほうが簡単だし間違いは少ないんですね。通常は。 ただ、リンクでいろいろなところに飛んでいるとこれも大変なんですね…。\n","date":"2006-10-25T14:01:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/140143/","title":"はい、私もやったことがあります"},{"content":"がんばれ！アドミンくん 第7話 ? ＠IT\n人が仕事しないときの仕事ですよ。\nシステムのメンテナンスは仕事が終わった後。\nうちの会社でも大きなメンテナンスは年末年始にやっているし、連休には時々メールが使えない、というアナウンスが来る。\n","date":"2006-10-25T12:01:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/120154/","title":"よく聞く話です"},{"content":"がんばれ！アドミンくん 第3話 - ＠IT\nこういうことって、ウィルス対策とかじゃなくてもあるよねぇ…。\n偉い人にはそれがわからんのです。\nわかってもらうには知識を共有する必要がある。 そのために報告書とか議事録とかを作っているわけだが…。\n報告の仕方が悪いのか、わからない上司が悪いのか。 まあ、報告の仕方が悪いと言われるわけですよ。\n","date":"2006-10-25T11:45:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/114525/","title":"知識の違い"},{"content":"がんばれ！アドミンくん 第2話 - ＠IT\nこういうことあるよねぇ。 確かに。\n一応は確認しているつもりなんだけどね。\n手に負えなくて連絡すると、言われたとおりケーブルの抜き差しをするだけで直ったりとかが多い…。\n","date":"2006-10-25T11:17:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/111713/","title":"あるある"},{"content":"がんばれ！アドミンくん 第43話 - ＠IT\n知らないというのは罪なことである。 ある意味不可抗力だが、それはそれで仕方ない。\n少なくとも、今の法律では違法になるわけだ。 知らなかったでは済まされない事も多い。\nだけど、知らなかったから仕方ない、と言われると困りもするわけで。\nそういう目で見ると、世の中知らないことばかり。 知らない、ということが、ある意味幸せでもあったりもするんじゃないかと思ったりしてみる今日この頃。\n","date":"2006-10-25T09:58:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/095809/","title":"初心者最強"},{"content":"会社におけるログの重要性を考える ? @IT情報マネジメント\n一般企業の場合には、まず会議の議事録からロギングするべきだ。顧客や取引先、部署間で交わされた確認や依頼といったビジネス情報のエッセンスが詰まっている。そのほかにも、紙で書かれた伝票や報告書、アクセスログといったものも収集し、信頼度に応じて保存・分析するべきだ。\n仕事の内容を記録するのを仕事としている人、がいる会社の方が成長するのだろうか？\n過去の蓄積から未来を予測する、ということは可能だろう。 天気予報もあるいは占いも、そういう統計に基づいたものだから。\n仕事をした人が、自分の仕事の具合について自己評価をすることは無意味なのだろうか？ …まあ、一人で行動していればいくらでも捏造はできる。 アリバイというのが誰かが証明しないと成立しないのと同じなのだろう。\n客はいったいなぜこんなにも怒っているのかということについて、野球のスコアラーのように淡々と記録した情報があれば、その怒りを共感でき、心から謝ることができ、再発防止を約束できるだろう。\n言われているのはもっともなことだ。\n最近は、電話よりもメールでのやり取りをするようにしている。 議事録が大事というのは社会人になってから何度も言われているが、改めて書類として起こすのがとても苦手なので、メールなら印刷すれば済む、と思ったからだ。 電話で対応した場合、その場でメモはするが記録としては残していない事がほとんどだ。\n議事録には、顧客や取引先、部署間で交わされた確認や依頼といったビジネス情報のエッセンスが詰まっている。できれば、コンピュータに登録して全文検索できるようにしておきたい。\n全文検索システムは確かに便利だろう。 今では議事録もWordかExcelで入力しているのだから、システム化してもいいかもしれない。\nしかし、\n役所では部外者との電話応対の内容はしっかりと記録され、りん議されている\nこれは本当だろうか？\n","date":"2006-10-25T09:21:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/25/092130/","title":"ログ（記録）の取り方と利用法"},{"content":"ソフトバンクの「予想外割」は本当に安いのか\n少し冷静になったところで、予想外割について読んでみた。 うちはVodafoneで、この発表の前までは、妻はdocomoに切り替える気が満々だった。 予想外なインパクトを受けると、冷静に見るのが難しくなるようだ。\nもともと「家族間定額」とか「LOVE定額」とか、Vodafone同士なら通話が定額で電話し放題というオプションはあった。 Vodafoneを使っていたのは、メール受信が無料（128バイト(?)くらいまでだったかな）ということと、家族間（というか親子契約に限った話だが）での通話・メール（SMSのみ）が定額になるというのが大きい。\n変更したいと思った理由は、妻曰く「サポートが悪いから」だそうな。 予想外割は使い方次第で安くはなりそうだが、MNP向けの戦略も見え隠れする。 外ばかりではなく、もともとのユーザに対してもちゃんと目を向けてほしいと思う。\n","date":"2006-10-24T18:22:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/24/182219/","title":"自己責任でお願いします"},{"content":"Life is beautiful: BeStiqでソフトバンクの「予想外割引」につっこんでみた\n変わったウェブサービスの紹介記事。 なんでこういうサービスが技術的に可能なんだろう？ 突っ込みの内容よりも、サービス自体が純粋に不思議。\nと、最初は思ったのだが。 URIをよく見てみると、突っ込みのほうは、本来の記事を直接変更しているわけではなかった…。\n…そう思ってしまうと、昔（？）流行った「大阪弁変換proxy」と同じだなぁ、と思った。 もちろん、JavaScriptを使っていろいろと細かいことはやっているようだが、勝手な思い込みとはいえ「他所のサーバにあるファイルに細工がっ！！」というほうに意識がいってしまったので、ガッカリ感が強い。 …ま、冷静に考えたらありえない（というか、セキュリティ上まずい）でしょう。\nついでなので検索してみた。\n大阪弁変換 ( JavaScript ver. ) 方言変換Proxyサーバ ","date":"2006-10-24T17:57:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/24/175744/","title":"予想外でした"},{"content":"Yahoogle（ヤフーグル）|Yahoo! GOOGLE で検索しよう！\nAPIを利用して検索サイトを作ろう、とか。\nYahoogle!をつくろう!! | トップページ\nAPI用ID登録フォーム | Yahoogle!（ヤフーグル）\n尚、Yahoogle!はAPIサービスとマッシュアップ技術の普及を目的としており、商用サイトではございません。\nまさにweb2.0的ウェブサービスですね。\nちょっと古いブログ記事だけど、こんな記事を最近読んだ。\n【クマガイコム】GMOインターネット社長 熊谷正寿のブログです | Web2.0 マッシュアップ時代への警鐘\nところで、このマッシュアップの大流行ですが、元のデータベースが「柄」で、サービスを開発している方々は、「刃」を持たされているに等しいと感じています。\n刃を持つ事になる、という意味がわからない…。 APIを提供することで柄を握っているほうの利用者が増えるのは間違いないので、提供する価値はあるとは思う。 でも、結果として負担が増えるのも柄の方。 アクセスが多くなれば、その分多くの処理をする必要が出てくる。 サイトを直接見るのであれば、広告収入も期待できるだろうが、APIを提供するだけではいくらデータがあっても収入源としては役に立たない。 もしAPIを有料化、という話になってきたら「gif画像に対するライセンス料請求」と同じような問題になるだろう。 APIの提供は設備投資であって、刃を握ってもらうことではないと思う。\n仮に、刃を握ることになったとしても、鋼の皮膚を持っていれば何も問題は無い。\nAPIついでで。\n犯罪とAPI (PhishTank.com) | 100SHIKI.COM\n犯罪にみんなで立ち向かう。そのためのAPI、という考え方はいいですね。\n道具は使い方次第で武器にも鎧にもなる。\n","date":"2006-10-23T14:20:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/23/142025/","title":"APIで美味しい所をいただきます"},{"content":" CNET Japan Blog - 中島聡・ネット時代のデジタルライフスタイル：「若者のテレビ離れ」に関する一考察 Life is beautiful: 「若者のテレビ離れ」と「釈迦にキリスト教」と 本当の敵は誰なのか。\n本気かどうかはわからないけど、PSPの敵はiPodだ、と言ったとか言わなかったとか。\nITmedia Games：「PSP」は“iPodキラー”?北米向けローンチイベント 消費者の立場とすれば、企業は互いの権利を主張しあうよりも、いい所を合わせて、より良い物を消費者に送り出す、という方向になって欲しいなと。 テレビにはテレビの、インターネットにはインターネットの良いところがあるわけだから。\nシェアが低くなってもラジオはラジオで需要があるわけだし。 あまり敵視しすぎるのもどうかと思う。\n","date":"2006-10-23T13:34:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/23/133445/","title":"インターネットがTVに変わるのか？"},{"content":"どこでもドア、実現へ一歩近づく : Gizmodo Japan（ギズモード・ジャパン）\nまた一歩、テレポーテーションの時代が近づいてきました。\n簡単に思いつくことほど、実現は難しいのかもしれません。\n実験結果はともかく、安全で高速な移動手段が発明されればますます便利になるでしょうね。 例えば、在宅での仕事、とかにこだわらなくても、いつでもどこにでもいけるわけですから。\n…でも、まあ、目の前にいつドアが出てくるかわからないというのは怖いですから、実現したとしても実用には大きな問題があるでしょうねぇ…。\n","date":"2006-10-23T13:02:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/23/130257/","title":"どこでもドアまであと何歩？"},{"content":"hxxk.jp - Movable Type で meta 要素に効率的にキーワードを配置\nこれを導入しようとしたが、エラーになってしまった。 記事が3.2の時のもののようなので、正式採用されているエントリータグとは仕様が違うのだろう、ということで、現行のバージョン（3.33-ja）で動くように変更してみた。\nテンプレート→アーカイブ→エントリーアーカイブで検証。\n1 2 3 4 5 \u0026lt;MTEntryIfTagged\u0026gt; \u0026lt;meta name=\u0026#34;keywords\u0026#34; content=\u0026#34;\u0026lt;MTEntryTags glue=\u0026#34; ,\u0026#34;\u0026gt; \u0026lt;$MTTagName$\u0026gt; \u0026lt;/MTEntryTags\u0026gt;\u0026#34; /\u0026gt; \u0026lt;/MTEntryIfTagged\u0026gt; 実際にはやっていることは同じで、単にタグの名称が違うだけという。\n…しかし、SEOの方法としては見逃せない要素だと思うのだが、標準的にはmeta要素に記載されていないのが不思議。\n","date":"2006-10-22T14:52:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/22/145233/","title":"MovableTypeでmeta要素のkeywordsを書く方法"},{"content":"サブルーチンを使う (のぶろぐ)\n何年も前、Perlで作った初のCGIだったであろうものを、今改めて書き直してみる。 CGI.pmの習作としては冗長かもしれないが。\n…しかも、サブルーチン使ってないし。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/usr/bin/perl use strict; use warnings; use CGI qw(:standard); my $styles = [\u0026#34;../../ipp.css\u0026#34;]; print header({ -charset =\u0026gt; \u0026#34;utf-8\u0026#34; }); print start_html({ -title =\u0026gt; \u0026#34;テスト1\u0026#34;, -style =\u0026gt; { src =\u0026gt; $styles }, }); print p(\u0026#34;うまく動くかな?\u0026#34;); print hr; print div( a({ href =\u0026gt; \u0026#34;../../../index.htm\u0026#34; }, \u0026#34;Home\u0026#34;), \u0026#34;/\u0026#34;, a({ href =\u0026gt; \u0026#34;../../\u0026#34; }, \u0026#34;Perl\u0026#34;), \u0026#34;/\u0026#34;, a({ href =\u0026gt; \u0026#34;../\u0026#34; }, \u0026#34;TestCGI Index\u0026#34;), ); print hr; print address( a({ href =\u0026gt; q{mailto:nobu3@x.age.ne.jp}}, \u0026#34;Written by Nobu3\u0026#34;), ); print end_html; ","date":"2006-10-22T02:23:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/22/022328/","title":"サブルーチンを使う"},{"content":"大分落ち着いてきた。\niネッ時計（インターネット時刻補正）\n","date":"2006-10-21T13:49:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/21/134942/","title":"ソフトウェア選考４"},{"content":"小粋空間: Ajax 月送りカレンダー\nAjaxを利用したMovable Type月送りカレンダーのカスタマイズです。リアルタイムカレンダー（本日の日付の装飾）および土・日・休日表示も盛り込まれています。\n導入しましたよ。\n","date":"2006-10-20T16:41:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/20/164106/","title":"Ajaxカレンダーを導入"},{"content":"究極のゲーム用ディスプレイ - Engadget Japanese\nthe Daily Mail (イギリスのいかがわしい新聞)に「東芝が新開発した360度ディスプレイ」として掲載されていた画像。\n…ヘルメットだ。\nコメントによると、新聞にも出ていたらしい。\nなんというか、小説の世界だったのが現実になってきているような気がする。\nそのうち視覚や聴覚だけじゃなく、五感全部で体感できるシステムができるかも…。\n","date":"2006-10-19T15:10:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/151026/","title":"究極のディスプレイ"},{"content":"なんとなく入れていたmixi stationだが、mixiをチェックするとちゃんと情報が送信されていた。 Windowsのファイアウォールを確認してみたが例外リストにも無かった。 どうやってデータを送っているんだろうか？？\n","date":"2006-10-19T14:41:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/144153/","title":"mixi stationの謎"},{"content":"勝手な思い込みだが、会社のメールアドレスのつけ方から、その会社の情報化に対する考え方とか進捗状況とかがわかるような気がした。\n今までで見たメールアドレスを特徴で分類してみる。 いくつかパターンがあるようだ。\nアルファベット＋数字。 パソコン通信を感じさせる。昔からアドレスが変わっていない会社の場合は、こういうのが多い。もしくは古い体質のままなのかも。 会社の規模が大きくなると、変更するのも大変なのだろう。\n名前がイニシャルで、姓が主体。 うちの会社は今はこれ。ちょっと前まではアルファベット＋数字だったわけだが、ここ数年でIT化の波に飲まれた感じでどんどんIT化が進んでいる。 企業体質が古いのに無理矢理IT化を進めるとこんな感じになるんじゃないだろうか？ 姓は知っているが名前は知らない、という人が沢山いそうな感じ。\n名前が主体で、姓がイニシャル。 ベンチャーとか外資系に多いかも？ どちらかというとアットホームな感じを受けるような。\n","date":"2006-10-19T14:14:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/141442/","title":"会社のメールアドレスから感じること"},{"content":"KEYWALKER ブログ検索\nAI型検索エンジンとは、独自のアーキテクチャにより開発した意味ネットワークデータベースを使って、入力した言葉の意味を理解し、関連する記事も自動的に検索することができる機能のことです。\nなんか、昔も見たような売り文句だ。\n確かinfoseekが「自然言語で検索できる」という売りだったような？ …もう10年近く前の話だが。\n当時は、それだけの理由でよくinfoseekで検索していた気がする。\n人工知能（AI）に対しては、何故か期待しすぎる傾向にある。 ATOKもAI機能付きとかを売りにしてなかったか？ 単純にAIというんじゃなくて、どういう風な思考ルーチンなのかが重要だろう。\n昔、AI搭載のシューティングゲームがあったのだが、今考えてみれば難易度の調整をしているだけだろう。 まあ、それでも当時のゲームからすれば、ステージの進行に合わせて強くなる、のではなく、プレイヤーの武装にあわせて強くなる、というのは画期的だったのかもしれないが。 今でもそういうゲームがあったことを覚えているのだから、なかなか印象が強いという事だ。 …まあ、名前は忘れてしまったけど。\nそうそう。 冒頭の検索エンジンを知ったのは、ニュースの記事から。 ブログの意味を解析し、ブロガーの属性をグラフで表示する「BlogSphere」 - CNET Japan\nBlogSphereアルファ版では、約3000万ページのブログ記事から、ブロガーの男女比や年代構成、趣味、職業、配偶者の有無、買ったもの、欲しい物の一覧と、キーワードの時系列言及度、都道府県別の居住地、居住地別でいかにキーワードに言及しているかを示す割合「地域別言及度」の解析ができる。\n凄いもんだね。 やっぱりこういう系のものには期待してしまう。 早く個人向けツールにならないだろうか？\n参考: キーウォーカー、社長ブログ ブログの意味を解析し、ブロガーの属性をグラフで表示する「BlogSphere」｜キーウォーカー、社長ブログ\n","date":"2006-10-19T13:24:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/132456/","title":"AI（人工知能）の魔力"},{"content":"MovableTypeでも「タグ」の機能が導入された。\n…まあ、先ほどのエントリーのような問題もあるのでアレだが、この機能にはひそかに期待している。\nというか、むしろ「タグ付け」という考え方に対して期待している。\n今までのカテゴリーという考え方だと、レベル付けが必要となるが、その順位を決めるのがとても苦手なのだ。 フォルダ分けもそう。 気が付いたら同じようなフォルダがいくつもできていて、ファイルをどこに仕舞えば良いのか迷ってしまう。\n究極のファイル整理術として、同一フォルダで名前を細かくつけるのが最も良い、というような記事を見た記憶がある。探すのは検索機能があるわけだから、それで探せば良いと。 タグ機能はこれの延長上にあると考えられる。\nタグを管理することで、入力の支援にもなる。はてなブックマークでは、ブックマークがタグで整理されている。 色々な人がつけるので同じようなタグも沢山あるが。、ヒントになるものもあるので試行錯誤の最中だ。 タグのつけ方も少し研究してみたい。\nフリーソフトにTAGるメモというのを見つけた。 残念ながらまだ使ってはいないが、そのうち試してみたいと思っている。\n","date":"2006-10-19T12:51:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/125139/","title":"タグに大きく期待して徒然と"},{"content":"Headline-Reader Pluginでここのatomを読み込んで確認しているのだが、気がつくとカテゴリ欄が数字になっていた。 最初は原因がわからなかったのだが、atom.xmlを眺めてみて「タグ」が原因ということがわかった。\nデフォルトのAtomテンプレートではカテゴリー周りを見ていると、タグもカテゴリで処理されているようだった。 出ている数字は、一番最後の「term」だったので、タグを先に書くことにした。\n1 2 3 4 5 6 7 8 \u0026lt;MTEntryIfTagged\u0026gt; \u0026lt;MTEntryTags\u0026gt; \u0026lt;category term=\u0026#34;\u0026lt;$MTTagID encode_xml=\u0026#34;1\u0026#34;$\u0026gt;\u0026#34; label=\u0026#34;\u0026lt;$MTTagName encode_xml=\u0026#34;1\u0026#34;$\u0026gt;\u0026#34; scheme=\u0026#34;http://www.sixapart.com/ns/types#tag\u0026#34; /\u0026gt; \u0026lt;/MTEntryTags\u0026gt; \u0026lt;/MTEntryIfTagged\u0026gt; \u0026lt;MTEntryCategories\u0026gt; \u0026lt;category term=\u0026#34;\u0026lt;$MTCategoryLabel encode_xml=\u0026#34;1\u0026#34;$\u0026gt;\u0026#34; scheme=\u0026#34;http://www.sixapart.com/ns/types#category\u0026#34; /\u0026gt; \u0026lt;/MTEntryCategories\u0026gt; とりあえずは、うまくいっている。\nAtomの仕様はよくわかっていないけど、順番を変えただけだから問題は無かろう。\n","date":"2006-10-19T12:24:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/19/122429/","title":"タグを使うとSleipnirのHeadline-Reader Pluginでカテゴリが数字になってしまった"},{"content":"何度も確認していて、いくら「サインイン」してもサインインできなかった。 JavaScriptが間違っているんじゃないかとじーっと見ていたが、何もわからない。\nで、ふと思い出したことがあった。 ここのサーバを使っていくとなると、こういう問題もおきそうなのでメモっておこう。\nここは、XREAのサーバのひとつで、通常は利用が無料だが、広告が入るようになっている。 ここのドメインの設定をする前に、広告除外ディレクトリに入れて実行していた。 前のサーバはLWP::UserAgentが入っていなくて、トラックバックなどのWeb通信ができなかったから、移動したのだ。 で、前回サーバの移動時に苦労したので、まずは広告を表示したまま実行できるように事前にテストしていたというわけ。\nドメインの設定が完了した後、公開URIだけを変更して、スクリプトの場所は変えていなかった。 つまり、ブログの公開URIとスクリプトのURIとはドメインが違っていたのだ。 実はそれが原因だったようだ。\nスクリプトをブログと同じドメインになるように場所を移動して再構築すると、無事に「サインイン」ができるようになった。\n","date":"2006-10-18T13:27:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/18/132708/","title":"エントリーアーカイブのコメントで「サインイン」できなかった件"},{"content":"何度かMySQLをインストールして思うのだが、一度ユーザを作ると、大体そのユーザを使いまわすのですぐに作成方法を忘れてしまう。 今後は（少なくともgoogleとかで）検索しなくてすむように、メモしておく。\nまずはMySQLサーバを起動。 とりあえずWindows起動時に起動するようにしたので放っておく。 以前は、mysqld-nt.exeあたりを手動で起動していた。\n次はクライアント。 Ver4.1.21はスタートメニューに「MySQL Command Line Client」ができるようで、ここからクライアントを起動。 DOSもどきの画面で、いきなりパスワードを訊かれる。 インストール時に設定しておいたパスワードを入れると無事起動。 スタートメニューからだとユーザはrootで起動されるようだ。 …まあ、まだ他にユーザを作ってなかったからかもしれないが。\nさて、次はデータベースを作成する。\n1 mysql\u0026gt; create database userdb; 完了。 これで「userdb」という名前のデータベースができた。 次に、このデータベースに対してすべての権限を持つユーザ「userid」を作る。\n1 mysql\u0026gt; grant all on userdb.* to userid@localhost identified by \u0026#34;******\u0026#34;; 「******」にはパスワードを入れる。 CGIから使う分には、「userid@localhost」だけで十分なはずだが、一応localhost以外も作っておく。\n1 mysql\u0026gt; grant all on userdb.* to userid identified by \u0026#34;******\u0026#34;; 以上。\n","date":"2006-10-18T09:50:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/18/095048/","title":"MySQLでデータベースとユーザを作成する"},{"content":"ソフトウェア選考2 (のぶろぐ)\nまだ続く。\nまだまだ続く。\nなんとなく、余計なものも多くなってきているような気がする。\nActivePerl（プログラム言語） 手元でCGIを実行するためには必要不可欠。 Windowsだと何かと不便なことはあるが、無いよりはましだし、PPMもGUIになって扱いやすくなった。\nMySQL（データベース） こういうのって最初に何を使うかによるんだろうなぁ。 Windowsでデータベースソフトといえば、MSAccessが会社にも入っているが、こっちの使い方はさっぱりわからない。 大体Excelで間に合う程度の事しかやらないからだろうけど。 閑話休題。Perlをはじめて以来、ずっとファイルで読み書きをしていたのだが、データベースを使い始めてからというもの、ファイルのロックとかを考える手間から開放されてとても楽になったので、今となっては手放せない。 データベースとしては他にも選択肢はあるのだが、比較的早いということと、導入しているレンタルサーバが多かった、という2点からMySQLを覚えることにした。\nAnHttpd（ウェブサーバ） 以前はこだわりもあってApacheを使っていたのだが、あまり複雑なことをすると何かと大変だということがわかったので、AnHttpdに変更。 扱いは簡単だけど、CGI開発においては必要十分な機能は持っている。と思う。 …しかし、このソフトの正式な呼称はAnHttpdでいいのだろうか？\nPerlEditor（テキストエディタ） Perlを始めたころから使っているエディタで、エクスプローラバーの使い心地から離れられない。 エディタとしての基本機能は少々不満はある。しかし、サブルーチンと変数（$@%の三種）を一覧できて、かつダブルクリックで該当箇所へジャンプする機能が、開発（特にデバッグする）時に重宝する。\niTunes（マルチメディアプレイヤー？） iPodは持ってないのだが、将来のため（？）に導入。あと、Podcastもなかなかよいね。 観たり聴いたりする分には、勝手に入っているWMP (Windows Media Player)でもかまわないわけだが。\nLast.fm（ウェブ連動アプリ？） ほんの最近知ったLast.fmという音楽系SNSと連動するアプリケーション。 WMPやiTunesなどで聴いている曲をサイトに登録して、似たような好みの人が何を聴いているのかとか、いろいろわかるらしい。知らない曲でも好みの曲があるかも…って思ってなんとなく使っていた。 …しかし、一人暮らしでも一人部屋でもないので、パソコンで音楽を聴きながら開発…とかってできないわけで。 ヘッドフォンで一人の世界に入っていると邪魔されてしょうがないので、あまり活用できてない。\nmixi station（ウェブ連動アプリ？） 昨日のことだが、妻から「mixi紹介してあげようか？」と嬉しそうに言われて、有無を言わせず登録することになった。 で、ついでなので見ていると、ミュージックのページがあった。Last.fmと同じような目的なんだろうなぁ、と思いながらダウンロード＆インストール。 …したまではよかったのだが、通信できてなさげ。Last.fmはファイアウォールから警告が来たので解除してあげたわけだが…。どうなっているのか、とりあえず様子見ってことで。\nQuickTime Player（マルチメディアプレイヤー？） iTunesを入れたら勝手に入っていた。 QuickTimeも、名前だけでも変えたらどうかと。iQuickTimeでもいいじゃないか。 ま、とりあえず、同じようなソフトが同時にいくつも入るのは納得いかん。\n","date":"2006-10-18T09:47:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/18/094740/","title":"ソフトウェア選考３"},{"content":"3匹いる犬の中で最も小さいショコラ（ミニチュアダックスフンド、♀）が、先日避妊手術と狼爪（ろうそう）切除のために動物病院へ入院していた。 手術は問題なく終わって、術後に何度か病院へ通っている。\n当初の予定では今夜に行くはずだったのだが、朝から行くことにした。\n朝起きると、足元に濡れたテープ（何か見覚えがあるような…）が放置されていた。 ふとショコラを見ると、足に巻いてあったはずのテープが無い。 また取ったのか…、と思ったが、まあ折角なので傷の様子でも見ておくことにした。 ――避妊手術は術後も順調でほとんど傷が無い。しかし、狼爪のうち右足の方は骨があったせいもあるのか、ショコラが気にして触ってしまい糸を切ってしまっていたのだ。――\n…見てびっくり。 血は出ていないが、傷がぱっくり開いていた。 中に白っぽい物が見えたので骨に違いない、と、急遽朝から病院へ行くことにした。\n病院に着くと、ショコラが一番懐いている先生（様子からすると、かなり犬好きだと思われる）が診てくれた。 白っぽいのは骨ではなく、皮下組織らしい。 とりあえず放っておいても治るらしいのだが、傷口を舐めたりするとあまりよくないということで、やはり縫ってもらうことにした。 で、縫うのは一針らしいのだが、麻酔をするとなると二箇所に注射し、その後に縫うことになるということで、麻酔なしで縫ってもらった。麻酔するのも痛いらしいので…。\n15分ほどして終わった。 結果的に、ショコラは縫われることよりも押さえられる事の方が嫌だったらしい。 というか、こんな簡単に終わるのなら、最初にショコラが糸をとった後に縫ってもらっておけばよかった…。\nま、とりあえず、次は3日後に様子を見てもらうことになった。 病院は「千里桃山台動物病院」という。\n","date":"2006-10-18T04:11:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/18/041117/","title":"ショコラの病院通い"},{"content":"ソフトウェア選考 (のぶろぐ)\nとりあえずインストールしたソフト。\nまだ続く。\nというか、まだまだ最小限って感じ。 Perlも入れてない。\nDevas（ファイル内検索） 複数のファイルの中身を検索してくれる。 自分や他人のスクリプトから検索したりする時に重宝する。 Perlを入れてからでも十分だったのだが、ちょっとした事情でMovableTypeの中を検索するために入れた。\nAVG Anti-Virus Free Edition（アンチウィルス） とりあえず、アンチウィルス。 無いと何かと不安なので。 メールスキャンの後、スタンプ代わりにsignatureが入るのは微妙だが。\n","date":"2006-10-17T17:11:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/17/171141/","title":"ソフトウェア選考２"},{"content":"Mapper Plugin.ja JP - Ogawa Code\nMapperプラグイン エントリーなどに含まれるmapタグをマッピングサービスを利用した地図画像に変換するプラグイン。\n新しくプラグインを入れると試してみたくなるのが世の常。\nということで、なんとなく「ららぽーと甲子園」を表示してみる。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 //\u0026lt;![CDATA[ function attachOnLoad(func) { window.attachEvent ? window.attachEvent(\u0026#39;onload\u0026#39;, func) : window.addEventListener(\u0026#39;load\u0026#39;, func, false); } function attachBeforeUnload(func) { window.attachEvent ? window.attachEvent(\u0026#39;onbeforeunload\u0026#39;, func) : window.addEventListener(\u0026#39;beforeunload\u0026#39;, func, false); } function generateGMap(mapid, address, lat, lng, zoom, maptype) { if (GBrowserIsCompatible()) { var map = new GMap2(document.getElementById(mapid)); map.addControl(new GSmallMapControl()); map.addControl(new GMapTypeControl()); var center = new GLatLng(lat, lng); if (typeof maptype == \u0026#39;string\u0026#39;) maptype = eval(maptype); map.setCenter(center, zoom, maptype); var marker = new GMarker(center, G_DEFAULT_ICON); map.addOverlay(marker); var html = \u0026#39;\u0026lt;div style=\u0026#34;width:12em;font-size:small\u0026#34;\u0026gt;\u0026#39; + address + \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } } //]]\u0026gt; ","date":"2006-10-16T16:30:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/16/163059/","title":"Mapperプラグイン"},{"content":"とりあえずインストールしたソフト。 スレイプニル（ブラウザ） 使い慣れているのでやはり選んでしまう。 慣れているといっても使いこなしているわけではないが。 FFFTP（FTPクライアント） これも使い慣れているから。 設定さえしておけば、拡張子によって転送モードの切り替えができたり、ファイルの属性を変更したりできるのが便利。 特に、cgi→0700、pm,pl,dat→0600などのようなCGI関係のファイルの転送が楽。 すっきり!!デフラグ（デフラグ：最適化） とりあえず、アップデートとドライバ関係を入れた後、寝る前にこいつでデフラグをかけておいた。 チェックディスク→デフラグ→終了ですっきり。 Noah（アーカイバ） 開発は停止しているけど、アーカイバDLLの自動ダウンロード機能（caldix）が便利で使っている。 以前は「7z」で圧縮できるのが嬉しくて使っていた。 Easy圧縮デラックス版（アーカイバ） 圧縮専用ソフト。lzh、zip、cabの3種類がそれぞれ単独のソフトで実装されている。 ソートして格納できるのが特徴で、この機能がお気に入り。 EmEditor Free（テキストエディタ） 基本機能が充実しているエディタ。 文字コードと改行コードに関しては、自動認識はもちろん、保存時には任意でコードの設定が可能。\n","date":"2006-10-16T16:19:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/16/161933/","title":"ソフトウェア選考"},{"content":"ここ数日、パソコンの調子がよくなかったのだが、ついに一昨日立ち上がらなくなった。\nなので、昔使っていた15GBのハードディスクをフォーマットして、WindowsXPを再インストール。 インストールから自動更新数回までで半日潰れた…。\nとりあえず必要なものから入れていこうと思いつつ。\n","date":"2006-10-16T14:30:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/16/143059/","title":"HDDの寿命？"},{"content":"ファイルのコピーで使ったような「die」による強制終了は、ローカルで実行する分には問題はないと思うが、公開しているCGIのエラー処理を「die」で済ますのはあまりよろしくない。\n例えば、掲示板などのスクリプトで、名前を入力し忘れて投稿した時とかに「致命的なエラー」で強制終了（表示としては「500 Internal Server Error」になる）されたらどうだろう？ しかも、その時にブラウザの「戻る」で戻ったら全部消えていた、とかだったらどうだろう？ ユーザーから見れば不親切だ。 名前が抜けているのなら、名前を入力しなおせば良いはずだ。 エラーの種類としては、処理を続けることができなくなる「（実際の意味での）致命的なエラー（データファイルがない、ファイルに書き込みできない、など）」もあるだろうからある程度は仕方ないにしても、「致命的ではないエラー（名前が抜けている、メールアドレスが不適切、など）」は、ユーザーの支障にならないようにしておきたいところだ。\n…というふうに、いつも思ってはいるのだが、エラーの処理は何かと面倒くさい。 とりあえず、「die」しておいてひと通りの処理を作ることが多いが、実際にdieで強制終了されると、それはそれでエラーの確認に手間がかかる。\nウェブで公開する前提のCGIを開発している時にエラーを把握する方法はいくつかあるが、私はCGI::Carpの機能を使うのが手軽で簡単のわりには便利だし十分実用に耐えると思う。\n1 2 3 4 5 6 7 8 9 #!/usr/bin/perl -T # 日本語(EUC-JP) BEGIN { use CGI::Carp qw(fatalsToBrowser); # 500エラー時でもエラー情報をブラウザへ出力 open CGILOG, \u0026#34;\u0026gt;\u0026gt; ./cgi.log\u0026#34; or die \u0026#39;Can not open file. \u0026#34;\u0026gt;\u0026gt; ./cgi.log\u0026#34;\u0026#39;; CGI::Carp::carpout(*CGILOG); } use strict; use warnings; 何かを作ろうと思ったら、とりあえずこのコードを使って書き始める。\n開発の環境がWindowsという事もあり文字コードの問題にも頭を悩ませているが、エディタはPerlEditorを、ウェブサーバはAN HTTPDを使っている。 「AN HTTPD」には「CGIの出力を検査」する機能もあるのでそっちを使うのも手だが、本番運営時には無防備になるので私はあまり使わない。設定がApacheに比べて簡単だから使っている。 「PerlEditor」は、変数エクスプローラが便利で手放せない。Perlを覚えたての頃は「シフトJISで書く場合の注意点」をそこらじゅうで見た。そういうのが面倒だから、最初から「文字コードはEUC-JPで作ろう」というふうに思ったし、そのためにソフトも（それなりに）探した。 今のところ、文字コードの認識についても（ある程度の日本語が書いてあれば）ほとんど問題ないので必要十分。開発がストップしているのが残念ではあるが、私的には今以上にPerl/CGI用の機能があっても多分使わないような気がする。 …というか、実際「ツール」メニューは使ってない。 使っている機能は、画面に出ている変数エクスプローラ、キーワード、メモと文字コード関係くらいで、あとは普通のエディタとして使っている。\n閑話休題。「fatalsToBrowser」をインポートすることで文法エラーなどの実行前のエラーもブラウザで表示できるようにしてくれるので、デバッグがブラウザでできるようになる。 ただし、エラーには色々な情報が含まれてしまうので、セキュリティを考えると公開するときにはコメントにしておく必要があるだろう。 その次の2行は、エラー出力を「cgi.log」に溜め込んでいくようにしている。こちらは「fatalsToBrowser」とは無関係に動作する。動作には多少の負荷はかかるだろうが、レンタルサーバなどを使っていてサーバのエラーログが手に入りにくい場合は重宝するだろう。\n","date":"2006-10-06T06:31:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/06/063105/","title":"エラーの処理方法で暗中模索"},{"content":"ITmedia Biz.ID：A4用紙を手軽に三つ折りする方法\nもしA4用紙が1枚しかない場合は、下辺をナナメに折り返して跡をつけ、それを目印に折っても、同じ効果が得られる。また、手元に洋形3号の封筒（幅98mm）があれば、それを目印としてあてがえば、さらに緻密な三つ折りができる。どの場合も、最初に折った辺を内側にし、あとから折る側を外側にするのがキレイに見えるコツである。\nとまあ、そんなわけであるが。\nそもそも、何故やりにくい「三つ折」にする必要があったのかが不思議だ。 何故、最初から四つ折のサイズで封筒を作らなかったのだろうか？\n確かに、三つ折だと綺麗に見える。 四つ折だと片側が膨らむので、見栄えもよくない。\n見栄えを気にしたのだろうか？\n","date":"2006-10-06T03:24:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/06/032429/","title":"Ａ４用紙を三つ折にする方法"},{"content":"実は（という程の事でもないが）みんなのテニスを買っていた。\n2,3日前にようやく「みんテニ伯爵」との対決まで行ったが、なかなか勝てなくて「騎士」のまま。 というのも、対決してばかりであまりチャレンジモードをしないからかもしれない。 そういえば、最初のプレーも妻との対決だった。\nオレのお気に入りキャラクターは「グロリア」。ジャストインパクトでサーブすると、利き手の方にバウンドするキックサーブが発動する。 妻のお気に入りは「スズキ」。 2人ともみんゴルのキャラクターだ。\nとりあえず、プレイヤーキャラクターは全員使えるので、そろそろ上級キャラクターを使ってみたいのだが、使いこなすには至らない。 とはいえ、タイミングを覚えるには使わないといけないんだろうなぁ。\nみんなのテニス ソニー・コンピュータエンタテインメント (2006/09/14) 売り上げランキング: 86\nおすすめ度の平均: なかなか・・・ 簡単に楽しめます 単純だが楽しい\nAmazon.co.jp で詳細を見る\n","date":"2006-10-05T07:52:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/05/075251/","title":"みんなのテニス"},{"content":"Perl5では、サブルーチンの引数は「@_」という特殊な配列で渡される。 なので、受け取る時は、\n1 my ($hoge1, $hoge2, $hoge3) = @_; とか、\n1 2 3 my $hoge1 = shift; my $hoge2 = shift; my $hoge3 = shift; とかのやり方がある。\nここ最近は、最初のやり方を好んで使っている。\n特殊とはいえ、配列は配列なので扱いは簡単。 shiftを使うと、元の配列の中身が減っていくので、昔はshiftを使うのが好きだった。 気分的にメモリの消費量が少なそうだったし。\n","date":"2006-10-04T03:44:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/04/034422/","title":"引数の受け取り方法"},{"content":"「サブルーチンに初期値を持たせる方法」の中で書いた、\n最近覚えたのだが、\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026gt; $elm = {} unless defined $elm; \u0026gt; ``` \u0026gt; \u0026gt; この行は、もっと簡単に \u0026gt; \u0026gt; ```text \u0026gt; $elm ||= {}; \u0026gt; ``` \u0026gt; \u0026gt; こうやって書くこともできる。 は、正確には違うということに気づかされた。 「[まるごとPerl! Vol.1](http://www.amazon.co.jp/gp/product/4844322893?ie=UTF8\u0026amp;tag=nqounet-22\u0026amp;linkCode=as2\u0026amp;camp=247\u0026amp;creative=1211\u0026amp;creativeASIN=4844322893)」という本に、Perl6の事について触れられていたのだが、その中で「||=」について書かれていた。 definedという関数は、未定義（undef）かどうかを判定して返す関数で、未定義以外の場合は真を返す。 なので、例えば$elmが「0」や「空文字列」だった場合は、左辺の式は実行されない。 一方「||=」は、$elmが「0」や「空文字列」であっても代入が実行される。 「0」も「空文字列」も「undef」も「偽」として評価されるためだ。 …ただ、「use strict」の環境下では、突然出てきた変数は警告されるので、通常は不要。 ほとんどの場合、これらの文はサブルーチンの中で引数が渡されたかどうかを監視するのを目的として使われる。 ちなみにPerl6では、関数ではなく演算子でもundefかどうかを調べられるらしい。 ```text $elm //= {}; 正確な意味で代用できる、という事ですね。\n","date":"2006-10-03T04:57:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/10/03/045726/","title":"undefと0と空文字列"},{"content":" 「Trackback Ping Link Lookup」 自ブログへのリンクが無いトラックバックを迷惑トラックバックとして扱います。\nという事なんですが。 リンクが切れているようなので、配布元をメモっておく。\nhttp://svn.bulknews.net/viewcvs/public/mt-tb-link-lookup/trunk/tb-link-lookup.pl?view=markup\n","date":"2006-09-29T08:15:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/29/081503/","title":"便利なＭＴプラグイン"},{"content":"見るともなく古いファイルを見ていたら、変なコードを見つけた。\n1 2 3 4 5 6 7 8 9 10 11 12 13 sub get_1 {print \u0026#39;a\u0026#39;; 1;} sub get_2 {print \u0026#39;b\u0026#39;; 2;} sub get_3 {print \u0026#39;c\u0026#39;; 3;} print get_1; print get_2; print get_3; print \u0026#34;\\n\u0026#34;; print \u0026#34;-----\\n\u0026#34;; print get_1, get_2, get_3, \u0026#34;\\n\u0026#34;; print \u0026#34;-----\\n\u0026#34;; なんだろう？と思って実行してみてびっくりした。\nどこかで見た記憶があったので探してみたら、「a geek - perlの評価順」だった。\n同じネタで何度もびっくりしてしまうのは、記憶力の欠如ですか？\n1 2 3 4 a1b2c3 ----- abc123 ----- ","date":"2006-09-27T07:23:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/27/072343/","title":"実行順序"},{"content":"サブルーチンで初期値を持っておきたい時や、サブルーチン呼び出し時に引数で動作を色々と変更したい時などに便利なコード。 どこで見たのかは忘れたけど、いいなぁと思って真似して使っていた。\n1 2 3 4 5 6 7 8 9 sub hoge { my %elm = ( foo =\u0026gt; \u0026#34;FOO\u0026#34;, bar =\u0026gt; \u0026#34;BAR\u0026#34;, @_ ); print $elm{foo}.\u0026#34;n\u0026#34;; print $elm{bar}.\u0026#34;n\u0026#34;; } 実際の呼び出し方法は、\n1 2 3 \u0026amp;hoge; \u0026amp;hoge(foo =\u0026gt; \u0026#34;ＦＯＯ\u0026#34;); \u0026amp;hoge(bar =\u0026gt; \u0026#34;ｂａｒ\u0026#34;); な感じ。\nただ、欠点がある。 引数の数がちゃんと合っていないとwarningsで警告されるのだ。\nなので、最近はリファレンスを使っている。 CGI.pmなんかでも使われている。\n1 2 3 4 5 6 7 8 9 10 11 sub fuga { my $elm = shift; $elm = {} unless defined $elm; my %elm = ( foo =\u0026gt; \u0026#34;FOO\u0026#34;, bar =\u0026gt; \u0026#34;BAR\u0026#34;, %{$elm} ); print $elm{foo}.\u0026#34;n\u0026#34;; print $elm{bar}.\u0026#34;n\u0026#34;; } 呼び出し方も括弧が一組付くだけであまり変わらない。\n1 2 3 \u0026amp;fuga; \u0026amp;fuga({foo =\u0026gt; \u0026#34;ＦＯＯ\u0026#34;}); \u0026amp;fuga({bar =\u0026gt; \u0026#34;ｂａｒ\u0026#34;}); 最近覚えたのだが、\n1 $elm = {} unless defined $elm; この行は、もっと簡単に\n1 $elm ||= {}; こうやって書くこともできる。\n","date":"2006-09-26T07:49:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/26/074902/","title":"サブルーチンに初期値を持たせる方法"},{"content":"ファイルのコピーでも使ったけど、正規表現で何かを取り出したいときに使いやすいコード。\n1 (my $to_dir = $to) =~ s|([^/]*?)$||; 例の場合は、ファイルパスからディレクトリ名を取り出す。 この場合$toは変更されない。 $toの中身が$to_dirにコピーされて、$to_dirに対して置換が実施される。 2行に分けて書いても同じだが、1行で書けるのが便利。\n1 2 my $to_dir = $to; $to_dir =~ s|([^/]*?)$||; 置換の内容は、一番右の「/（スラッシュ）」よりも右側を、空文字列に置き換える（平たく言うと、削除する）。\n他にも、ファイル名だけを取り出してみたり、\n1 (my $filename = $path) =~ s|^.*/||; 拡張子（ファイル名のピリオド以降）を取り出してみたり、\n1 (my $ext = $path) =~ s/^.*.//; してみる。\n","date":"2006-09-25T03:55:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/25/035518/","title":"ファイルパスから正規表現で色々と取り出す方法"},{"content":"hail2u.net - Weblog - 圧縮フォルダを使わないようにするとエクスプローラがキビキビ動く\nやり方\n1 2 regsvr32 /u zipfldr.dll regsvr32 /u cabview.dll これをやったあと、関連付けを他のソフトにしておいたほうが良いらしい。\n","date":"2006-09-22T02:10:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/22/021002/","title":"これは覚えておかねばっ！"},{"content":"ファイルのコピーをする場合は、File::Copyというモジュールを使うのが良い。\n1 2 3 4 use File::Copy; my $from = \u0026#34;/user_dir/hoge/fuga.txt\u0026#34;; my $to = \u0026#34;/user_dir/fuga/hoge.txt\u0026#34;; copy($from, $to) or die \u0026#34;Can not copy `$from` to `$to`.\u0026#34;; ただし、コピーするためのフォルダ（ディレクトリ）が必要。 上の例の場合は、user_dirにfugaというディレクトリがないとコピーに失敗する。\nWebで運用するようなCGIの場合は、あらかじめディレクトリを作成しておいて、バックアップや一時ファイルを作ったりするので機能的には十分ではある。 ただ、ローカルでファイル管理をしようとした時などは、これだとかなり面倒だ。 ディレクトリごとコピーする簡単な方法はないものか？ …という需要はあると思うのだが、なかなかうまい方法が見つけられない。 とりあえず、File::Pathというモジュールを使うとできるようだが、もっと簡単な方法もあるかもしれない。\n1 2 3 4 5 6 7 use File::Copy; use File::Path; my $from = \u0026#34;/user_dir/hoge/fuga.txt\u0026#34;; my $to = \u0026#34;/user_dir/fuga/hoge.txt\u0026#34;; (my $to_dir = $to) =~ s|([^/]*?)$||; mkpath($to_dir); copy($from, $to) or die \u0026#34;Can not copy `$from` to `$to`.\u0026#34;; mkpathは致命的なエラーを吐いて死ぬのでエラー処理は特にしなくてもOK。 あと、作ったディレクトリを知りたい場合は、\n1 my @dir = mkpath($to_dir); とすれば、@dirに作ったディレクトリのパスが入る。\nとにかく、これでファイルの操作も簡単だ。\n","date":"2006-09-21T08:11:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/21/081132/","title":"ファイルのコピー"},{"content":" 1 next if index $foo, \u0026#34;hoge\u0026#34;; 意味的には、$fooが「hoge」ではじまっていなければ次へ、という感じ。 例えば、hogeで始まるファイルだけをピックアップする場合に、ループの中でhoge以外を取り除くために使う。\n他のやり方としては、例えば正規表現を使うと、\n1 next if $foo !~ /^hoge/; とか、もう少し自然に書けば、\n1 next unless $foo =~ /^hoge/; とか。\n正規表現を使うと遅くなる、という噂があるので、ループなどではなるべく正規表現を使わないようにしよう、とか思いながらこういうコードを使うわけです。\n","date":"2006-09-20T08:26:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/20/082647/","title":"「○○○で始まらない文字列」を探す方法"},{"content":"さっき気付いたのだが、ActivePerlでモジュール管理をするプログラムの「PPM（Perl Package Manager）」が、GUIになっていた。\n","date":"2006-09-18T06:29:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/18/062901/","title":"ActivePerlのPPMがGUIな件"},{"content":"先日のエラーの影響もあって、最新版に置き換えた。\nさて、どうだろう。\n","date":"2006-09-17T17:57:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/17/175757/","title":"最新版に変更"},{"content":"変なことはしてないはずなのだが、FMABCP BBSがエラーのせいで、書き込んだり、最新の状態にしたりできない。\nまあ、自作なので面倒を見ないといけないわけだが…。\n","date":"2006-09-15T03:22:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/15/032209/","title":"またエラー？"},{"content":"少し前に両親から頼まれていた、ドルフィンツアーについて、を記したページを作った。 …もうすぐ時期も終わりだが。\nもともと素材とかは面倒で使わないのだが、いざ探してみると本当に沢山あって迷う。 そんな中で選んだのが。\nテーマが決まっているとまだ探しやすいのだが、これが例えばRPGに使えそうな素材、と思って探すとなかなか思うようなものが見つからない。\nゲーム作りがなかなか進まないので、気分を変えるために素材探しをしたのが刺激になったのかもしれない。 今のところ気になっているのは、\nDA\u0026rsquo;s Homepage -Room- COLORNIX フリー素材【幻想素材サイトFirst Moon】天使、悪魔、妖精、ドラゴンなどファンタジーイラスト素材と動物素材 ファンタジーフリー素材屋「竜棲星-Dragon\u0026rsquo;s Planet(ドラゴンズプラネット)」 こんな感じ。 ゲーム用だと、なんとなく「ドット絵」が相応しいかな?とか思ってみる。 あと、やはりファンタジー系。 幻想素材サイト First Moonさんの素材は、背景で使わせてもらったこともある。\n","date":"2006-09-13T15:13:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/13/151323/","title":"素材選び"},{"content":"3.32-jaです。\n","date":"2006-09-12T18:47:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/09/12/184714/","title":"アップデート"},{"content":"アサヒのビール（PRIME TIME）を飲んでふと思い出した。\nアサヒというとスーパードライを思い出してあまり好きではないのだが、はまったビールがあった。 それが、アサヒ・生一丁。 確か、やしきたかじんがCMをやっていた。\n美化しているかもしれないが、生ビールに似たなめらかさが特徴的だった。と思う。\n正直言って、このPRIME TIMEよりもうまい。 いや、うまかったと思う。\n","date":"2006-08-22T17:00:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/08/22/170026/","title":"アサヒ・生一丁"},{"content":"Ryoko Hirosue OfficialHomePage [HOME]\n昨日、スマスマで広末涼子を見た。 巷ではいろいろと言われてはいるようだが、綺麗な人は綺麗だし、かわいい人はかわいい。\n2003年だから、もう3年前？ ドラマ「元カレ」でようやく意識した。 このドラマを見たのも偶然。 奈良健康ランドの仮眠室（？）で偶然流れていたのを見たのがきっかけだった。 …すでに第2話だったが。\nもともとテレビはあまり見ないほうなのだ。 しかし、連載物は一度見てしまうと気になってしまう。 「元カレ」は結局ほとんど見てしまった。\nその原動力になったのは、やっぱり広末涼子演じる佐伯真琴が気になったからだろう。\n元カレ DVD-BOX\nポニーキャニオン (2003/11/19) 売り上げランキング: 8737\nおすすめ度の平均: ★★★★☆ ★★★★★ 思い出がよみがえる! ★★★★★ 胸に迫る「せつなさ」 ★★★★★ 超はまった！！\nAmazon.co.jp で詳細を見る\n","date":"2006-07-25T08:23:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/07/25/082344/","title":"広末涼子"},{"content":"何気に古い話題らしいが。\nH-Yamaguchi.net: Steve Jobsのスピーチ、山口訳 個人的には、「死に関する話題」の中で出てきた言葉が印象的。\n「もし今日が自分の人生最後の日だとしたら、今日やろうとしていることを私は本当にやりたいだろうか？」\n","date":"2006-07-19T03:53:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/07/19/035320/","title":"スティーブ・ジョブス氏のスタンフォード大学卒業祝賀スピーチ"},{"content":"YouTube - Broadcast Yourself.\n最近、何かと話題らしい。\nふと思い出して上戸彩のCMを探してみた。 うまい具合に見つかったのだが、画質はあまり良くないね。\nYouTube: https://www.youtube.com/watch?v=naXh6ayfDkY\n","date":"2006-07-16T16:59:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/07/16/165904/","title":"チアガール編を思い出してみる"},{"content":"結局バージョンを見ることにした。\n1 2 3 4 5 6 7 8 if ($CGI::Session::VERSION \u0026lt; 4) {# Ver3.xx require CGI::Session::MySQL; $CGI::Session::MySQL::TABLE_NAME = \u0026#34;\u0026#34;;# -w対策 $CGI::Session::MySQL::TABLE_NAME = $tn-\u0026gt;{session}; $session = CGI::Session-\u0026gt;new(\u0026#34;dr:MySQL\u0026#34;, $cgi, {Handle =\u0026gt; $dbh}); # クッキーやフォーム情報からIDを自動的に取得する。なければ新しく作成。 } else { # Ver4.xx $session = CGI::Session-\u0026gt;new(\u0026#34;dr:mysql\u0026#34;, $cgi, {Handle =\u0026gt; $dbh, TableName =\u0026gt; $tn-\u0026gt;{session}}); # クッキーやフォーム情報からIDを自動的に取得する。なければ新しく作成。 } 今度は4.xxでは未調整。。。\n4.xxでも、動作は確認した。\n3.xxで失敗していたのは、実際にはevalとrequireの書き方がまずかった気がする。\n1 2 if (eval q{require CGI::Session::MySQL}) { ... とやっていればよかったのかも？\n","date":"2006-06-26T15:55:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/06/26/155557/","title":"結局バージョンを見るしか…。"},{"content":"CGI::Sessionの対策だが…。\n失敗だった。3.95では動かない。 また考え直し…。\n","date":"2006-06-26T07:27:27+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/06/26/072727/","title":"ダメだった。"},{"content":"愚痴です。\n省エネしよう、とか、CO2を削減しよう、とかもあって、クールビズという名の下でうちの会社も軽装化されているわけですが。 事務所にひとりだけ、具体的にはその事務所で一番偉い人が軽装化していなかった場合。 エアコンの温度は28度ってわけにはいかないでしょうね？\nファイルのロック処理と一緒で、こういうのは約束なんですね。 皆でやるから効果がある。 複数のプログラムで単一のファイルを処理する場合に、一つのプログラムだけロック処理をしていない場合を考えてみる。 そのプログラムは他のプログラムでロックしているファイルでもお構いなしに書き込みに行くわけです。 ロックの意味が無い。\n結局何が言いたいかというと、寒いんですよ。\n","date":"2006-06-21T09:36:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/06/21/093650/","title":"半端なクールビズ"},{"content":"前エントリの対処方法。\n結局はCGI::Session::MySQLがロードできるかどうかを見ることにした。\n1 2 3 4 5 6 7 8 if (eval q{require \u0026#34;CGI::Session::MySQL\u0026#34;}) { # Ver3.xx $CGI::Session::MySQL::TABLE_NAME = $tablename; $session = CGI::Session-\u0026gt;new(\u0026#34;dr:MySQL\u0026#34;, $cgi, {Handle =\u0026gt; $dbh}); } else { # Ver4.xx $session = CGI::Session-\u0026gt;new(\u0026#34;dr:mysql\u0026#34;, $cgi, {Handle =\u0026gt; $dbh, TableName =\u0026gt; $tablename}); } ま、3.xx環境ではまだテストしてませんが…。\n","date":"2006-06-07T23:34:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/06/07/233404/","title":"CGI::Session対策"},{"content":"困った。\nローカル環境のCGI::SessionをVer4.xxにしたら、いろいろと変わっていて、そのままではエラーを出すようになった。 MySQLでテーブルの名前を変更して使っていた（不細工だが、直接モジュールをロードして変数を変更していた）のだが、そのモジュールの名前と場所が変わったのだ。\n実際にはよりスマートにテーブル名を変更できるようになったのだが…。\n\u0026mdash;- 3.xx \u0026mdash;-\n1 2 3 4 use CGI::Session qw(-ip_match); use CGI::Session::MySQL; $CGI::Session::MySQL::TABLE_NAME = $tablename; my $session = CGI::Session-\u0026gt;new(\u0026#34;dr:MySQL\u0026#34;, $cgi, {Handle =\u0026gt; $dbh}); \u0026mdash;- 4.xx \u0026mdash;-\n1 2 use CGI::Session qw(-ip_match); my $session = CGI::Session-\u0026gt;new(\u0026#34;dr:mysql\u0026#34;, $cgi, {Handle =\u0026gt; $dbh, TableName =\u0026gt; $tablename}); CGI::Sessionのバージョンを見て処理を分けないといけないんだろうなぁ…。\n","date":"2006-06-01T02:49:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/06/01/024923/","title":"CGI::Session Ver4.xx"},{"content":"何度やっても忘れるのでメモ。\n1 perl -MCPAN -e \u0026#34;CPAN::Shell-\u0026gt;install(CPAN::Shell-\u0026gt;r)\u0026#34; 出展\nPerl モジュールの一括更新 - Ceekz Logs 古いモジュールの更新 ","date":"2006-05-26T22:35:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/05/26/223556/","title":"モジュールの一括更新"},{"content":"何を探して彷徨っていたのか忘れたが、ふと気になるエントリーに出会った。 こんなMMORPGだったらいいかな\n発想が素直で面白い。\n自分で作るのはめんどくさい、、、。\nだったら、ユーザに作ってもらおうか。\nここから色々な案があって、\nさらには、ユーザは開拓者にもなれて、 未開拓ゾーンにおいて、自ら世界を開拓（製作）していくことができる。\nついでに、最強のユーザは大魔王になって、世界に君臨することができるとか、 PKはOKだけど、治安部隊に見つかったら逮捕されるとか、、。\nついでにモンスター工場とか作って、ユーザにモンスター作ってもらうとか。\nこのあたりが特に好み。\n実際には自分で作るよりも大変な事が多いだろうなぁ、とは思うけどね。\nこの時に勝手に思いついたのが、ゲームの中での世界を大きく分けて二つの勢力があるようにする、ということ。 ありていに言えば、善と悪でもいいが、最終的には立場が違うだけで善悪はない、というところに落ち着くかな。\nアニメでもよくあるが、人間vs自然というか、最初に自然を開拓する人なのか、自然を守る人なのかを選んでもらう。 開拓側は、人口を増やし、街を大きくして未開の土地を切り開いていく。 守る側は、開拓者よりも先にモンスター工場や罠のある洞窟を探索で手に入れて対抗する、って感じかなぁ。 開拓側は工場などを見つけても破壊することしかできない（使い方がわからない）という事にする。 街が大きくなるように、工場も成長（？）させることができたり。\n…まあ、妄想だけど。\n","date":"2006-04-27T06:12:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/04/27/061241/","title":"思いつき"},{"content":"MFPM:ホーム\n他の人がどんなモジュールを使っているのかには興味あります。 strictは使っていましたが、warningsは知りませんでした。\nというか、本を読め、って事なんだろうなぁ。 Perlの本どころか、本自体最近読んでないね。\n","date":"2006-04-26T04:58:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/04/26/045842/","title":"My Favorite Perl Modules"},{"content":"どんなモジュールがあるのかを調べるのにCPANを使ったりするわけですが、当然ながらこういうところは英語です。\n小さいモジュールは、使用例をみてどういうものかを判断したりもしますが、CGI.pmのように大きいモジュールはいちいち大変です。\nそういう時便利なのが、perldoc.jpです。\n最近興味を持っているモジュールに、CGI::Applicationというのがあるのですが、これがまたドキュメントが長い。\nということで、探したのがPerlモジュール/CGI::Application - Walrus, Digit.です。\nありがたく読ませていただきます。\n","date":"2006-04-26T04:03:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/04/26/040323/","title":"和訳"},{"content":"エスカレーターの片側を空けて乗るのは間違い。 …という話なのだが。 大阪に来て以来、エスカレーターで真ん中には乗ったことがない。 昨日1日は試そうと思ったけれど、一人だけやっても効果は…。\n社団法人 エレベータ協会：安全・快適にご利用ただくために 今更言われても?という感じですが。\n最近の(安価な?)エスカレーターは、歩くと揺れる事が多い。 確かにエスカレーターの基準は満たしてはいるのだろう。 基準値は歩くことを想定していないのだから。\nただ、片側を空けるのがほぼ常識のような今、そういうエスカレーターで緊急停止による将棋倒しのような事故があった場合、誰が責任を負うのか？\nもし、今後歩きを禁止にする方向にいくのなら、エスカレーターの注意書きとして義務付けるなどの対応が必要でしょう。 トリビアに出ていた方も「ホームページでは呼びかけているんですがね」とか、やってる態度をアピールはしていました。 しかし、行政に働きかけるとか、他により広く周知するやり方はいくらでもあると思うのですが。 何故今まで放っておかれたのでしょうね？\n","date":"2006-02-10T06:41:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/02/10/064146/","title":"トリビアの泉的エスカレーターの乗り方"},{"content":"おいでよどうぶつの森の話。\n昨夜、妻の村からうちの村へ遊びに来る時に、偶然別の村の門が開いていた。 初めてのことだったので驚いた。\n","date":"2006-02-10T01:59:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/02/10/015949/","title":"DSどうしで通信"},{"content":"女芸人は結婚したら終わりやで。 …とは、山田花子の弁。\n旦那を気にしたら出来る芸も出来なくなる。 だいたひかるはそれを実証していた。\nでも、女芸人だから結婚しない、というのは、ちょっと違うかなと。\n","date":"2006-02-10T01:56:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/02/10/015606/","title":"芸人魂と結婚"},{"content":"かなり久しぶりにフロントミッション全曲集計画のページを更新しました。\n掲示板がプログラムのエラーで色々と不具合があったようですが、ぜんぜん気づいていませんでした。 ダウンロード数はそれなりに安定しているのであまり気にしていなかったのですが…。 やはりちゃんと管理しないといけませんね(^^;\nあと、新メンバーが増えました。 なんと、10月にメールをいただいていたのですが、見落としたまま数ヶ月…。 PSYCHEさん、本当に申し訳ありませんでしたm(_ _)m ホームページ「Frozen River」にはMP3のファイルもありますので、音源を持っていない方でも楽しむことができます。\n","date":"2006-01-22T14:21:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/01/22/142121/","title":"全曲集ひさしぶりに更新！"},{"content":"先日、テレビを見ていたら、光浦靖子が「遺伝子が求めてるんだよぅ」と、面食いの理由を語って（？）いた。\n思わず感心してしまった。\n","date":"2006-01-18T04:11:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/01/18/041132/","title":"遺伝子が求める遺伝子"},{"content":"\n「Equal」という、カロリーゼロのダイエットシュガーを出品中です。\n","date":"2006-01-14T15:15:51+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/01/14/151551/","title":"我が家のオークション"},{"content":"ここ最近、というか、年末あたりからニンテンドーDSのゲーム「おいでよ どうぶつの森」にはまっている。 年越しもゲームの中でカウントダウンし、新年を祝った。\nWikiのサイトに攻略方法が載っているのだが、あまり見すぎるのも面白さが半減するなぁ、って思った。\nDSのゲームは作るのが大変だろうなぁ、と思う。 2画面＋タッチペンでの操作が標準なわけで。 このゲームはシリーズ物ということで、上の画面は補助（というか、追加）的な使われ方をしているようだ。 メニューを開くとメインの画面が上の画面に移動する、というのは面白い案だと思う。\n","date":"2006-01-04T23:49:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2006/01/04/234958/","title":"おいでよ どうぶつの森"},{"content":"本年もよろしくお願いいたします。\n","date":"2005-12-31T15:00:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/12/31/150000/","title":"明けましておめでとうございます"},{"content":"近所のロイヤルホストでブランチ。 ま、店的にはモーニングなんだけど。\n","date":"2005-12-08T02:25:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/12/08/022550/","title":"ろいほ?"},{"content":"気になる記事があったので備忘録的に。\nShady Grove: BlogPet設定について Project MultiBurst: BlogPet投稿には「APIパスワード」の設定が必要です アップグレードだからかもしれないけど、設定に「APIパスワード」なんて項目はない。 コンフィグを見直す必要があるのかも。\n何気なく判明しました。\nひととおりコンフィグも確認したものの、実際コンフィグが関係あったのかはよくわかりません。 というのは、根本的に違う場所を探していたからです。\nこのサイトではブログペット用に専用のアカウントを作っていて、普段の自分用アカウントからでは、例の「APIパスワード」の設定を見ることができなかったのです。 つまり、ブログペット用のアカウントでログインし、システムメニュー→投稿者→アカウント名、を選ぶことで設定画面になると。 あとは、「APIパスワード」を設定してやればOK。\n投稿テストも無事完了。\n","date":"2005-11-22T03:14:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/11/22/031438/","title":"BlogPetとMovableType3.2"},{"content":"3.2にアップデートしたのはいいけれど、その直後に3.2-2が出ていたのに気づいていなかった。 しかも、3.2にしてからブログペットの投稿が失敗しているようだ。\nというか、さっさと気づけと。\n","date":"2005-11-09T23:47:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/11/09/234714/","title":"3.2-ja-2"},{"content":"もうすぐ日本を出発。 三度目のラスベガスへ。\n今回はホテル側のはからいで宿泊料が4泊無料なのだ。\n","date":"2005-09-18T05:32:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/09/18/053236/","title":"成田空港のヤフーカフェにて"},{"content":"携帯のディスプレイに、よく覗き見防止のシールを貼っている人がいる。\nV903SHも広視野角をウリにしているけど、携帯に求められる液晶の性能は狭視野角ではないのか？ どうですか？シャープさん。\nいや、でも広視野角は伊達じゃないですよ。 ほぼ水平にしても反射光がなければ画面が見えるから。 これに覗き見防止シールを貼るのはもったいないね。\n","date":"2005-08-23T07:35:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/08/23/073544/","title":"携帯の液晶"},{"content":"あいかわらずvodafone。\n妻に勧められるまま V903SH に。3Gに昇格(?)だ。\n海外へ行く場合に、3Gなら互いに連絡が取れるという話だ。\nもともと携帯には興味がなかったはずなのに、今では妻よりも新しい機種になっている。 そのうち妻も同機種に変更しそうな勢いだ。\n","date":"2005-08-23T07:22:56+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/08/23/072256/","title":"またまた携帯機種変更"},{"content":"先週の土曜日に妻の誕生日祝いという名目で行った。\n店のフルネームは「あぶり肉工房 和黒（わっこく）」。 本店ではなく、新神戸オリエンタルアベニュー店の方へ。\n出来ればディナーと行きたい所だけど、さすがにそこまでは余裕がない。\n","date":"2005-08-03T06:08:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/08/03/060809/","title":"和黒（わっこく）"},{"content":"WindowsXPには簡単に画像の一覧を印刷する機能がついているのだが「配置やサイズは適宜調整されます」がネック。 なぜ拡大縮小ではなく、トリミングされるのだろう？\n","date":"2005-06-20T01:12:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/06/20/011210/","title":"画像の一覧印刷"},{"content":"特に何かあったわけでもないのだが、実家に行った。 しかも二週連続で。\n…あえて言えば、父の日だから？\n","date":"2005-06-20T00:33:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/06/20/003348/","title":"実家へ"},{"content":"今日、郵便局で通帳の更新を数年ぶりにした。 住所、印鑑も同時に変更した。\n新しい通帳は、記入が多くの銀行と同じように横向きになった。 なので、ATMに入れるときの方向が変わってしまった。 見開きの状態で入れるのが気に入っていたんだけど。残念だ。\nというか、印鑑部分の保護などもされていて、少し前の銀行の通帳と同じような感じになった。 せめて郵便貯金くらいは独自路線を貫いて欲しいと思ったのだが、費用がかかるのかもしれない。\n民営化されるかどうかはわからないが、もしされた場合、また仕様が変わったりするのだろうか？ そうなったら、また費用がかかることになるね。\n","date":"2005-05-17T08:17:01+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/17/081701/","title":"貯金通帳の更新"},{"content":"上戸彩Official Site\n【あやすま】上戸彩ファンサイト Aya Smile\n実際には、書くほどなのかは微妙なところ。\nきっかけはかなり前で、確か「8×4」のCMだったと思う。 上戸彩 画像付きCMリストで見ると『2003年 / ニベア花王 / 8×4「エイトフォー」チアガール篇』だと思われる。\n意識した（というか、知った？）のは「渡る世間は鬼ばかり」なので2002年ということになる。 台詞が長くて大変だなというのが感想で、一本調子であまりうまくないな、と、その時は思った気がする。 まあ、世間的には評価されているらしいのだが…。\nそれが、エイトフォーのCMを見るうちに、かわいいなと思うようになった。 何がそうさせたのかはわからない。 それと前後して映画「あずみ」の主演に抜擢されたということで、それも見に行こう…とか思った。 結局行かなかったが。\nただ、確かにかわいいとは思うのだが、やはり「チアガール篇」が一番好きかもしれない。\n上戸彩写真集「natural」 舞山 秀一 ワニブックス 売り上げランキング: 68007\nおすすめ度の平均: ★★★★★\nすごくよかった!!! か、かわいい。。 簡単な感想 Amazon.co.jp で詳細を見る\n","date":"2005-05-17T06:36:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/17/063614/","title":"上戸彩 （うえと あや）"},{"content":"そういえば、4月のはじめごろにノートパソコンを買った。 hpの「compaq nx9030」だ。\n","date":"2005-05-17T02:54:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/17/025426/","title":"そういえばノートＰＣを買っていた"},{"content":"ラスベガスでの5泊を終え、日本へ帰る日がやってきた。 日付変更線と時差の関係で暦上は二日かかる。 あっという間に夢から覚めることになる。\n帰りはラスベガスからロサンゼルスを経由して関西空港へ。\nラスベガスと比べるとロサンゼルスは治安が悪い。 …ま、ラスベガス自体が大きなテーマパークのようなものだとは思うので、比べることはナンセンスなのかもしれないが。\n帰りの便は幸いにも機内はすいていたので、中央の4人部分を2人で使うことができた。 疲れもあったのだろうが、広く使えると思うとよく眠れる。 何度か目を覚ましながらも十分な睡眠を確保できたと思う。 帰りはあっという間についた。\n今回のラスベガスでは、ある意味禁断の領域に踏み込んだと思う。 感化されやすいせいもあるのだが、日本に帰ってきて色々思った。 特に公共の場でのマナー。 ま、他人のことはあまり言えないのだが。\nもう土日の夕方に回転寿司やファミレスなどで外食することができなくなるかもしれない。 ラスベガスのバフェと比べてしまうと、客のマナーがぜんぜん違う。 バフェの値段はせいぜいファミレス程度。 しかし、客の質はもっと高級な店でもおかしくないくらいだ。 子供が少ないとか、店の広さのせいもあるのかもしれないが…。\n","date":"2005-05-16T08:52:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/16/085219/","title":"夢から覚めた日（帰国）"},{"content":"今日は事実上の最終日。 なので早朝から作戦会議。 …実際には妻が下調べをしたなかから行動を選択する形なのだが。 移動手段にはトロリーを選択した。 まずはミラージュからNYNYへ行く。\nバフェは朝7時から。プールは朝8時からということで、まずはバフェへ。\n昨晩のうちにたまっていたポイントを精算していたので、バフェ無料券をもらっている。 新規メンバーは少ないポイントでもTシャツをもらえたりバフェをもらえたりする特典がある。 それを利用したわけだ。\nバフェには優先レーンが設けられている。普通のところに並んでいると、優先レーンのほうにセレブっぽい女性がプレイヤーズクラブのカードを持ってならんだ。当然優先されて中に入っていった。 …まあ、バフェは中に入ってしまえば一緒のようだったが。\n水着を着ていったので、バフェ終了後そのままプールへ。 さすがに朝だからか、それとも平日だからか、結構すいていた。…むしろ寒かったからかもしれない。日陰に入ると結構冷える。 すいていたのでクッションがついた椅子を使うことができた。\nさすがに水に入るのはやめにして、ジャグジーだけを利用。 あがった後はじっくりと体の両面を焼いた。 朝とはいえ結構焼ける。やはり一時間程度が限界か。 …もしかして、皮膚が弱いのだろうか？\n部屋で体についた塩素を落とし、改めて外出。 トラムでミラージュへ行き、裏側という北口を目指していく。 …看板が見当たらないので妻がホテルの人に尋ねると、この辺ではなくあっちのほうだということだった。 なので、あっちのほうへ行ってみる。 …あっちへ行くと、どんどんTIが近くなってくる。 ほとんどTIだと思ったとき、妻が道路の向こうにトロリー乗り場を見つけた。しかも、その向こうにトロリーが見えた。急げば間に合いそうだ、ということで走った。 （翌日トロリー乗り場の場所を確認すると、TIのタクシー乗り場からの方が圧倒的に近かった…）\nちゃんと間に合ってトロリーに乗り込んだ。 座席数が思ったより少なくて座ることはできなかったのが残念だ。 エンジンの音がうるさい。というか運転が激しいのかもしれないが。 運転士が観光案内もするのがトロリーなのか、運転中ずっとしゃべっていた気がするほどしゃべっていた。しかもマイク無しで。陽気な運転士だった。\n無事NYNYに到着し、その流れでカジノへ。 ここもMGMの系列なのでポイントがたまる。 色々なカジノで遊んでも無駄にならない（無駄は言いすぎだが）のは嬉しい。 前回はアラジン以外ではほとんどカジノをしなかったから。 …まあ、遊ぶ前にプレイヤーズクラブのようなものに入ればすむ話だけど。\n映画のターミネーターをモチーフにしたビデオスロットがあったので、まずはそれで遊ぶ。 ボーナスゲームが結構スリルあった。\n気のせいかもしれないが、音の大きいものは良く出る気がする。 まあ、結果的には負けているのだからあてにはならないとは思うけど。\n本当はこの後、さらに南へ行く予定だったのだが、なんとなく予定を変更してMGMを通ってm＆mにより、そのあとモンテカルロへ。 その中のピザ屋で昼食をとった。 …1ピースが皿1枚くらいの大きさだ。\nその後、トラムでベラージオまで戻り、後は歩いて部屋まで。 この数日間、よく歩いたものだと思う。\n部屋である程度の帰り支度をしたあと、いつでも見ることができると思ったからか結局最終日になってしまったTIの無料ショー「Sirens of TI」を見に行った。 とても無料で見ることができるとは思えないような凄いショーだった。 ホテルのカードキーを見せないと入れないゾーンからの見物は凄いものがあった。 ショーが終わったあと水から上がってくる出演者も間近に見ることができた。\nさて、明日は朝早いのでコンプの申請をしにプレイヤーズクラブへ。 今からだとカフェくらいしか使えないのでカフェのコンプをもらおうと思ったら、なんだかとんでもないことに。 係の人としゃべっていたら突然電話をかけて、少ししゃべった後代わるように言われた。 当然、電話の向こうから英語が聞こえてきたのだが、なんともさっぱりわからない。 しばらく会話にならない会話をしていたら、電話の向こうで電話をしているような声が。 その電話が終わると、係の人の隣から女性が来て受話器を返すように言った。 電話で話していたのは彼女だったらしい。\n彼女いわく、次回は部屋を無料にします。ということだった。 なんと、ルームコンプをもらったらしい。 今回はツアーの中にホテル料金も含まれていたので、次回に持ち越しというわけだ。 渡された名刺を見ると、肩書きが「Executive Slot Host」。 ちょっとぼ〜っとしながら、カフェのコンプももらった。\n軽い興奮状態のままカフェへ行って夕飯、というか夜食。 数日前に来たときは入り口に近い場所だったのだが、今回は奥のほうまで連れて行かれた。 様子からすると、奥の方はコンプの人専用の領域のようだ。\n露骨にも見えるサービスの違いだが、悪い気はしない。戸惑いは隠せないが。 どうも、今までとは違う領域に一歩踏み込んでしまったようだ。 これがサービスというものなのだろうか。\n日本では勝手に取られているサービス料。 サービスに対する考えの違いは、こういう場所で出てくるのかもしれない。 ラスベガスは大人の街だと思った。\nこの後、調子に乗って朝近くまでカジノで遊び倒したのは言うまでも無い。 次にラスベガスに来るときに、TIを使わない理由は無いのだから。\n","date":"2005-05-16T07:14:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/16/071433/","title":"ラスベガス滞在記（五日目）"},{"content":"ようやく平日になったので、ツアーの特典であるベラージオのランチバフェをいただきにいった。 そこからフォーラムショップ（目的はディズニーストアだったのだが）へというルートだ。\nベラージオのランチバフェは（ちゃんと買えばそれなりに高いだけあって）なかなか良かった。 ただ、グレープフルーツジュースはTIの方がおいしいと思った。 ほとんど並ばずに座ることができたので、あまり人気が無いのか？、と思ったのだが、帰るころには結構並んでいたので運が良かっただけらしい。\nバフェではいろんなものを少しずつ食べるほうだが、中には海老だけを山盛食べている人もいた。 そもそも皿自体が大きい。…ま、皿に限らず大きいのだが。 実際には結構な量なのだが、見た感じだとそんなに多くないように見えるのだ。 で、食べ始めるとなかなか量が減らない。 慣れるまで食べ過ぎて大変だった。\nさて、ベラージオもMGMの系列なので、ここでもカジノで遊んだ。 ベラージオはあまり当らないという噂だったが、それほどでもなかった。…ま、妻のほうはそうでもないようだったが。\n適度に切り上げて、フォーラムショップへ。 目的地はディズニーストアとチーズケーキファクトリー。 …で、ディズニーストアはなくなっていた。残念。他にも改装中が多いのか入れない店が結構あった。 チーズケーキファクトリーでは、行列ができていた。…が、イートインの方らしく、持ち帰りはほとんど並んでいなかったので助かった。 バフェでもデザートを食べたので、とりあえず夜のデザートにということで一つずつ購入。 正直言って一つで十分だったとは思う。結果的には二つとも食べたけど。\n","date":"2005-05-16T03:45:05+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/16/034505/","title":"ラスベガス滞在記（四日目）"},{"content":"三日目は中休み。 明日以降のためにゆっくりしようと考えた。 というか、正直疲れていた。\n予定としては、プールとTIの無料ショーくらいを考えていた。\n午前中にプールへ行った。 ラスベガスの日差しは想像以上に強いものらしく、午前中であるにもかかわらず焼けているのが感じられるほどジリジリ焼かれた。 小一時間ほどで境目がくっきりするほど色がついた。\n午後、近くなので、オープンしたてのWynnホテルを見物に。 その後、妻の買い物についていったのだが途中で眠気に負けた。 眠気をどうにかしようと色々苦心したのだが無駄だった。 結局先に帰ることにし、部屋で寝た。\n","date":"2005-05-16T03:39:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/16/033909/","title":"ラスベガス滞在記（三日目）"},{"content":"昨晩の負けは置いといて、二日目はMGMのショーを見に行く予定だ。 ついでに南の方向を攻める。 ルート的にはミラージュからアラジン、NYNY、そして、MGMのルートだ。\n今夜はショーと言う事で、服装を少し整えて外出。 まずは隣のホテル、ミラージュへ。\nTIからミラージュへは無料のトラムがあるので移動は楽チン。 で、時間もあると言う事でシークレットガーデンという、ちょっとした動物園のような場所へ寄る事にした。 前回は雨だったので満足に見る事が出来なかった場所でもある。\n突き刺さるほどの日差しの中、イルカを見る。 実はそこのイルカプールは水中の様子を見る事が出来るようになっていた。前回は気付かなかった…というか、そこまで余裕が無かったのかもしれない。 ショーと言う形ではなく、普通の生活をしているようなイルカを見るのも面白い。 途中、係員がボールを投げ入れたり、ジャンプの練習をしたりしていた。\nさて、前回は行けなかった奥へと進む。 そこには象、黒ヒョウ、トラ、ライオンがいた。 雰囲気は動物園だけど、檻ではなくて二重になったフェンスが境界にあるだけだ。 デジカメを動画モードで撮影していたら、トラが観客を威嚇していた。 ライオンは草を食べ、象は砂を浴び、黒ヒョウはそっぽ向いて寝ていた。 何とも不思議な空間だ。\nお昼になったのでランチのためにアラジンへ。 当初の予定では、土曜日である二日目にベラージオのランチバフェの予定だったのだが、平日しか使えない事が判明したので、アラジンのランチバフェに変更することにした。 妻が足が痛いと言い出した（少々無理をして履いてもらっていた靴のせいかも？）ので、一旦部屋に帰って靴を変えてからタクシーで移動。 アラジンは前回の宿だったので勝手は大体分かっている。\n到着後、前回のポイントを確認（前回の深夜の分が未精算だったから）した。 結果＄5のキャッシュバック。少しだが予算の足しにする。\nランチバフェを堪能（オレンジジュースが美味しい）したが、思ったより食べられない。 残すのは気が引けるのだが、仕方なく残す。 …が、この街はそういうことは気にしないのだろう。食べ残しのある皿もどんどんさげられる。\nさて、アラジンから徒歩でMGM方面へ。 途中にある、ハワイアンマーケット、コカコーラ、m＆mなどでお土産品を買い込み、MGMでライオンを見物。 カジノからライオンを見る事が出来るのだ。 ガラスかアクリルかは不明だが、透明なトンネル状の場所があって、その屋根の部分でライオンが寝そべっていた。 ライオンを至近距離、しかも真下から見る事が出来るというのは、すごく不思議な感じ。 しかも、囲いの無い場所に人間が。 飼育係かどうか不明だが、ライオンの頭を撫でている！\n…ラスベガスは不思議なところだ。\n適度にカジノを楽しみ、ショーの前にNYNYへ。 目的はマンハッタンエクスプレスという名前のジェットコースター。 乗り場は建物の中にあると言う事にビックリ。 それと、予想以上に混んでいる！ 一番前に乗りたかったのだが、無理も言えなさそう。しかも、前後の間隔が狭い席だったので視界があまり良くない。 ちょっと残念な気持ちで出発。\n建物の外に出てゆっくりと頂上を目指してガタンガタンと上がっていく。 そして、頂上で風景を見る間もほとんど無く急降下。 トップスピードになるまでの加速が自然落下のようで息が詰まる。 宙返りや180度の捻り、そしてスピードはそれなりだけど激しいアップダウンで身体が放り出されそうになる。 動きも知らないし、見えない分予想外の動きで翻弄されていた。 最後に建物の中に突っ込む時はゆっくりだが、真っ暗の中で再加速したのが予想外でビックリ。 $12.50は少々高いが、コースター好きなら乗る価値はあると思われる。 NYNYのコンプなら待ち時間無しで乗れるようだ（実際に1人いた）。\n戻ると妻がとても眠そうだった。 このあと今回のメインとも言えるMGMのショー（「KA」という）が待っているのだが、大丈夫だろうか？\nそんなわけで、またMGMに戻って、ライオンを見ながらカジノにいそしむ。 そして開演の30分前くらいを目途に会場へ。 のども渇いたことだし、ビールと妻は水を片手に会場の中へ入る。\n…MGMは全体的に照明が暗く感じられる。 KAの会場もそうだった。 暗い会場の中で、座席の案内をしてくれる人々もショーの役をしているかのよう。 そして舞台を見る。\n前回見た「O」の時と違って、ここは緞帳が無い。 水の「O」と、火の「KA」。 そういえば、見たいと思ったきっかけはテレビだった。\nで、舞台を見たのだが、舞台が…無い？ 舞台の場所にあるのは、細い通路、そしてその後ろにはスモークと、時折噴出す炎。 「KA」はどうやって幕が開くのだろう？\n…中略…\nショーは素晴らしいものだった。 途中、息をするのを忘れる、という感覚を味わった。すっかり魅入っていたらしい。 そして、何度も息が詰まるシーンがあり、最後には鳥肌になっているのを感じた。\n人間ってこういうことも出来るんだ?、という身体能力だけじゃなく、舞台装置を駆使することで、ここまで出来るんだ、という、裏方も一体になって出来たショーなんだと思って、思わず涙が出そうになった。\nオペラグラスは持っていったものの、結局ほとんど用無し。 やっぱり肉眼で見たいと思った。\nさて、帰りはモノレールで近くのホテルまで。 思った以上にスピードを出すようで、かなり揺れが激しい。 それに、なぜか移動中は照明が少し暗くなる。利用者はそこそこいるが、なかなか気味が悪い。\n部屋に帰る前に、夜食代わりにマクドをテイクアウト。 着いた頃には、ポテトは冷めていた。 …でも、マクドは隣のホテルの向かいにあるのだ。 どのくらい歩いたか想像つくだろうか？\n","date":"2005-05-10T05:55:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/10/055533/","title":"ラスベガス滞在記（二日目）"},{"content":"ラスベガス、マッカラン空港に着いたのが、5/6の朝10時前。 その後世界早巡りツアーなるものに行った。 ルクソール→NYNY→パリス…\n予定よりも早く飛行機が到着したせいで税関が開くまでしばらく待つことに。 アナウンスでは5分程度待ちとのことだったが、気持ち的には10分以上待った。\n座席が2階席の後ろのほうという事もあって、入国審査の時は前のほうに並べたのだが、どんどん後から人が増えてきた。 座席を指定するときに「後ろのほうなら二人席がある」と言われたが、断っておいてよかったと思った。\n入国審査の時、英語で答えるつもりで準備していたのだが「観光？仕事？」と日本語で訊かれて拍子抜けした。確かに日本語で話せば楽なのだが、何故かしどろもどろになってしまった。 通ったときには、荷物は全部到着していて、探すのが大変だった。準備の間も荷物は降ろされていたのだろう。 ま、待つよりはマシなのだが。\nで、ここまでは順調だった。\n税関を抜けてツアーの集合場所へ。 さすがに日本からの直行便だからか、日本系のツアーの係員が多い。 ここで早巡りツアーの待ち合わせをする事に。あと16人いる、ということだったので、そこそこ待つだろうとは思ったのだが、まさか一時間以上待つなんて。 いつ来るか分からない他人を待つのは必要以上にイライラする。 本人たちは何も思わないのだろうけど、一言あっても良かったのでは？と思った。\nさて、気を取り直して先ずは第一目的地のルクソール。 斜めに上がるエレベーターには乗れなかったが、軽くカジノで勝負。 1ドルが3ドルになったので、少しは気が晴れた。\nそのあと、ニューヨークニューヨークの斜め向かいからNYNYを一望。 マンハッタンエクスプレスに乗っている人たちの悲鳴・歓声がよく聞こえる。前回は乗れなかったので、今回はちゃんと乗ろう。\nさて、次はパリスだが、そろそろ眠気と団体行動への不適合が限界にきた。 ガイドさんに無理を言ってここでツアーから脱落。 タクシーで泊まるホテルに移動する。\nラスベガスは移動手段でお金が結構かかる。 ホテルとホテルが隣りあっているとはいえ、その隣に行くのに10分以上かかることが普通にあるので、少し離れたホテルに移動するにはタクシーを使ってしまう。\nさて、泊まるホテルはTI、トレジャーアイランドだ。 ここで、ホテルのチェックインのお手伝いをしてくれたのは、前回アラジンのチェックインの時もお世話になったナガクボさんだった。 部屋を選ぶとき、多少無理を言ってショーが見える部屋にしてもらった。 ホテルの宿泊者は優待席があるらしいので楽しみだ。\nツアーにはもうひとつ、ベラージオのランチバフェが特典で付いていたのだが、実は土日は使えないらしい。日本では説明を受けていなかったと思ったのだが。 当初は二日目にMGMへ行く予定があったので、その時に寄っていくつもりだったので予定が狂った。\n…まあ、予定が狂うのは日常茶飯事。二人の旅行で予定通りに行ったためしは無い。\nさて、早巡りツアーでフォーラムショップに寄るつもりだったのだが、それは後日にすると言う事で、まずはファッションショーモールへ行く事に変更した。 …つもりだったのだが、妻の一言で、とりあえずプレイヤーズクラブカードを作る事に。 そして、気が付けばしばらくカジノで遊んでいた。\n…気を取り直して、ファッションショーに移動。 ABCストアというコンビニを目指して。 で、その前にカリフォルニアピザキッチンで昼食（？）を。 ご飯の最中、妻はうつらうつらと寝ていたらしい。\nご飯の後、水とプリングルスを仕入れてホテルに戻った。 妻はそのまま就寝。よほど疲れていたのだろう。 で、オレはカジノへ。 勝手が分からないので、とりあえず探索も兼ねて色々とまわった。\nだが、今回は妻のサインでトラベラーズチェックを作っているので、あまり軍資金が無い。 程々に切り上げて部屋に戻って寝た。\n…夜、ショーの花火で目が覚めた妻に起こされた。 その後、遅めの晩飯を食べ、またカジノへと消えていくのであった。\n","date":"2005-05-10T05:54:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/10/055430/","title":"ラスベガス滞在記（一日目）"},{"content":"Yahooカフェから書き込みだ。\nとうとう雨が降り始めた。 16:00発の便だが、大丈夫だろうか？\n","date":"2005-05-06T05:15:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/06/051529/","title":"成田空港"},{"content":"ただいまラウンジオーサカより書き込み中。\nこの後成田へ行き、夕方からラスベガスに出発だ。\n…このラウンジは空調が効き過ぎだ。 寒い。\n","date":"2005-05-05T22:45:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/05/224509/","title":"伊丹空港"},{"content":"公式サイト（ホリプロ）\n里[sa-to] -石原さとみファンサイト-\n携帯の待ち受けに、ポッキーのCM（デビュー篇）から取り出した画像を使っているのだが、友人にそれを見られたところから「誰？」という話で盛り上がったので、忘れる前に書いてみる。 まあ、ロリコンだとか犯罪だとか言われたのは伏せておく。\nきっかけは、2005年1～3月に放送されたTBS系のドラマH2。 実際には、彼女が古賀春華という人物を演じているから気になったのかもしれない。 例えば、てるてる家族も何度か見たはずだが、まったく気にしていなかったわけだし。 …まあ、H2も全部見たわけじゃないので、どこまで気になっているのかはよくわからない。\n知ってから調べてみたら、結構TVで見る機会もあったようだが、全然気づいていなかった。 例えばJ-PhoneのCM（2003年の1～3月くらいに放送されていたらしい。）確かに見た記憶がある。むしろ犬のほうを覚えている（ぉ 今見ると「かわいいやん」と思うのが不思議だ。\nH2ではドジな天然系の役どころ、ポッキーのCMでは綺麗でクールな印象と、いろんな表情を持っているのが凄いなぁ。\nCMのワンシーン\n石原さとみ写真集「たゆたい」 熊谷 貫 小学館 売り上げランキング: 23994\nおすすめ度の平均: ★★★★★\nお勧めできます！ 石原さとみ総決算！ しっとりと、美しい写真集です。 Amazon.co.jp で詳細を見る\n","date":"2005-05-02T07:06:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/05/02/070658/","title":"石原さとみ （いしはら さとみ）"},{"content":"もうすぐ、ラスベガスに行く。 ゴールデンウィークを微妙にはずして一週間の旅だ。\n","date":"2005-04-26T08:07:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/04/26/080726/","title":"ラスベガスに行く"},{"content":"家庭内LANが我が家にも\n実はもう結構前になるけど、家のほうにも無線LANの環境ができた。 ほぼ妻のノート用だけど、有線ポートもあるので、どちらかというとブロードバンドルータの買い替えという感じだ。 実際には、外向きの速度が最大でも8Mbps (Yahoo8Mだから) なので、大したことはないのだが。\n","date":"2005-04-01T03:58:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/04/01/035843/","title":"家庭内LANが我が家にも"},{"content":"機種変更しました。 vodafoneのV601SHに。\nもともと妻が使っていたヤツですが、妻が3G対応の機種に変えたので余ったわけです。\n","date":"2005-02-21T15:24:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/02/21/152409/","title":"携帯の機種変更"},{"content":"バージョン3.151-jaにしてみた。\n\u0026hellip;それだけ。\n","date":"2005-02-15T15:34:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/02/15/153435/","title":"バージョンあっぷ"},{"content":"出発は朝早い。それがツアーの宿命か。 とはいえ、その気になればちゃんと朝食を食べるほどの余裕はある。\n朝食はホテルのバフェ。 値段はアラジンとほぼ同じだが、さすがに量は少ない。 というか、アラジンの方が多すぎなんだけど。\n食欲がないわけじゃないのだが、さすがに連日大食いしているせいかあまり食べられない（とはいっても朝食にしては多いと思うけど）。 満腹・満足。\nチェックアウトをすませてロビーで待つ。 迎えが来て表に出ると、あいにく天気は雨。 バスは昨日と同じ運転士だった。 雨の中、荷物を入れてくれたりしていた。\n空港はそこそこすいていた。 が、荷物のチェック方法が違うのか少し戸惑ってしまった。 入港直後、荷物検査のために預けると、その後は係の人が運搬するのだ。 こういう時もガイドさんがいると助かる。 無事チェックイン完了。 そして暇になる…。\n椅子に座ってアイスクリームを食べながら、アメリカでの思い出を話す。 免税店を覗き、セキュリティチェックを超え、搭乗口へ。\n…搭乗口が地上だった。 …というわけではなく、帰りの飛行機へは、空港内を走るバスに乗って別の建物から乗ることになっていたようだ。\n搭乗する時に座席をリクエストし忘れたことに気づく。もう遅いけど。 座席は窓際と2列目だった。 通路側には通路を挟んでおばちゃんが二人。 途中、そのおばちゃんたちに、アテンダントが座席を変更しませんか？と聞いたが、答えはノーだった。 仕方ないので、別に何かを我慢することもなく、トイレのたびに退いてもらったけど。 すぐ後ろの席では、若い女性が3席を1人占めしていた…。 なんか自分たちがかわいそうに思えてきた。\n帰りは結構長い。12時間以上乗るのだ。 日本はすでに正月。今度は1日損した気分になる。 映画を見たり寝たりしているうちに到着。長かった…。\n空港についてからはあっさり。 多くの人が乗り継ぎだからなのか、荷物も出てくるのが早い。 利用者が少ないからなのか、それとも、ロサンゼルスが混んでいるだけなのか。 とにかくスムーズに荷物を受け取り、税関を通って帰国。 空港内が思いっきり正月モードになっていた。\n家に着いたが、落ち着く前にマロンとキキを迎えに。 成長したからか、キキが一緒だからか、普段とあまり変わらない程度の再会だった。\n翌日、チビーを迎えにいって、久しぶりに一家勢揃いとなった。\n","date":"2005-01-13T07:15:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/13/071511/","title":"ラスベガスに行ってきた（最終日）"},{"content":"滞在地はすでにロサンゼルスだけど。 とはいっても、ダウンタウンには用はない（何 さっさとハリウッドに行こう。\nというわけで、移動は地下鉄。 朝食はハリウッドハイランドにあったバーガーキングを目指して。\n駅の出口を出たら正面にはディズニーストアがある。 とりあえず、それを尻目に朝食を…と思ったのだが、店が変わっていた。 仕方ないので朝食はしばらくお預け（少し歩けばもう1軒あるのだ）。\nで、その流れで免税店であるDFSギャラリアでお土産を物色。 チビーを預かってくれている友人にはタバコ。 自分と実家用にお酒。 その他、チョコレートや妻の時計などを買い込む。\n前回来た時とは微妙に様子が変わっていたので少し道に迷いつつ、案内板に導かれてJCBプラザを発見した。 久しぶりの日本語ネット環境。 が、時間もあまりないので小ネタを入れる程度で終了。 ユニバーサルスタジオの割引券をもらう。持ってきたやつよりも割引額が大きいのでちょっと得した気分。\n次はお預けにしていたディズニーストアだ。隣には劇場もある。 前回はリロ\u0026amp;スティッチが早々に公開されていて、中もテーマパークのようになっていたようだ。入らなかったけど。 今回はミスターインクレディブル。そして今回も入らなかった。 店では主に妻がやっている音楽教室の生徒へのお土産だ。 スティッチ人形は日本のと仕様が違うようだ。前回買ってきたスティッチ人形も、生徒ちゃん曰く「日本で売っているのよりもかわいい」らしい。 ちなみに製造は中国。Made in CHINAです。同じ物にすればいいのに。 ということで、小さめのスティッチ人形と、プリンセス軍団（何）のものをいくつか買っていたようだ。\nさて、ようやく朝食。 当然こっちではレギュラーサイズだが、日本サイズではハンバーガーも飲み物もLサイズだ。 結果的にしっかりと朝食（ほぼランチだが）を食べる。 …飲み物が余ってしまった。\n腹ごしらえも終わり、再び地下鉄。今度はユニバーサルスタジオまで。 天気が不安定なせいか予想よりも寒い。 （…今回は移動の時の服装や傘などの所持品に失敗しまくりだ。） 駅についたらお迎えのトラムで駅前からユニバーサルシティへ移動。 年末（というか、クリスマス休暇？）だから、さすがに混んでいた。 …とは言っても、日本ほどじゃない。一番人気（\u0026amp;最新のライド）のマミーでも1時間待ちくらい。\nまずは、スタジオツアー（STUDIO TOUR）。 図らずも一番前の車輌で、運転席のすぐ後ろに座った。 スタジオに入ってすぐに撮影準備中らしい人を発見。手を振って挨拶してみる。振り返されたのがちょっと嬉しかった。 次はアニマルプラネットライブ（ANIMAL PLANET LIVE!）。 本編はUSJのアニマルアクターズステージと似たような感じ。むしろUSJの方が動物の種類が多いかも？ それよりも前座（？）のほうが面白かった。入場中の観客にまぎれたり、係員の振りをしておかしな方へ誘導したり。 観客を巻き込むやり方は好き嫌いもあるだろうけど、巻き込まれた方も笑っているのを見られれば気持ちいい。 つづいて、スペシャルエフェクトステージ（SPECIAL EFFECTS STAGES）。 最初のステージで合成映像の最新技術を見た。すごいもんだね。 そして念願のマミー（REVENGE OF THE MUMMY THE RIDE）。妻はイヤだという事で1人で乗りにいった。 外で待っているのは大変だった。並ぶ前にジュラシックパークの売店で上着を買ったのだが、それでも寒かった。 …で、乗る時にわかったのだが、シングルライドがあったらしい。案内は特になかったと思ったのだが…残念。 で、このライドの正体は…自分で確かめてね。 ライド前、建物の中に少し仕掛けがあるようなのだが、気持ち悪い系は苦手なので試さなかった。 ライドから出ると薄暗くなっていた。 次は暗くなってからのウォーターワールド（WATER WORLD）へ。 時間ギリギリだったが、最後部ながらほぼ正面に座れたのがラッキー。 前座も楽しみなのだが、座るとほぼ同時に本編が開始。ちょっと残念。 役者が全員が普通に喋ってる（だろう？）のがUSJとは違うところか。USJは吹替え（だろう？）なのが微妙な感じがする。 でも、喋ってる言葉の内容がわからない（ぉ ま、流れは知っているので別に困らないけど。 で、最後にシュレック（SHREK 4-D）。 専用だからだろうけどUSJとは雰囲気が違う（特に前室）。あと、鏡が2枚あった。 丸い液晶モニタ…って事はないだろうけど、鏡の造りが印象的。 聞き取りはほぼあきらめていたので、脳内は日本語版の音声が再生されていた。 建物から出るとすっかり夜だった。 最後の最後にお土産屋を少し覗いた。\nホテルへはシャトルを利用。やはりツアーの場合は移動手段が便利。 バスには思ったよりも多くの日本人がいた。 海外で出会う日本人（日本語）には同郷意識が働くのか、少し変な感じ。 日本語の上手な運転士が面白かった。最初は冗談がわかりにくかったけど。\nホテルについて、実質遊び終了。 明日は日本に帰る日なので移動のみ…。\n最後の夜はホテルのレストランでディナー。 サラダと単品で2皿だったのに量が多くて食べきれなかった。 コースにしなくて良かった。\n","date":"2005-01-13T05:39:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/13/053919/","title":"ラスベガスに行ってきた（5日目）"},{"content":"移動日。まさに言葉どおりの日だった。 移動のために夜更かし、そしてロサンゼルスへ。\nさすがに朝6時くらいになると遊ぶのにも疲れてくる。 少し取り戻したところで終了。部屋に引き上げた。\n最終の荷物の確認をしてオレは少し横になった。 で、待ち合わせ時間の少し前に迎えが来る。 ツアーで行くと時間には縛られるけど移動が楽で助かる。 そしてマッカラン空港へ。空港の担当と交代。到着した時にチラッと見た人だった。(担当同士で挨拶をしていたのだ)\n昨日からの雨でダイアが多少(?)乱れているらしく、チェックインが屋外で行われていた。 もちろん屋根はあったが。 国際線は特に酷かったらしい。 幸いにも国内線だったので、15分待ちくらいでチェックイン終了。 乗り場を教えてもらい担当とは一旦別れる。搭乗時間の少し前にまた来るそうだ。もちろん搭乗口へ。\nそのままセキュリティチェックを通りモノレールに乗って搭乗口へ。 セキュリティチェックの係員が日本語上手で面白かった。いきなり「生麦生米生卵」って言われたらどうよ？ で、モノレールを降りてあとは搭乗時間を待つだけ。 適当に朝ご飯、買い物、スロットをして時間を待つ。 どんどん天気がよくなってきた。不思議なことだ。\nそして、搭乗時間の少し前、担当に再会。どうやって来たんでしょうか？ ともかく、来た時と同じような機体へ乗りこみ、いざロサンゼルスへ出発。\nさすがによく揺れた。 しかも、ロスの上空で待機しているのか予定よりも飛行時間が長い。 オレは疲れて寝ていたのだが、妻が恐怖からプチ切れしかけたところで着陸。\n…ロサンゼルスは曇っていた。そして気づけば雨が降ってきた。 ずっと降ったりやんだり晴れたりを繰り返しているという話だった。 ダイアも乱れていたせいで、担当の人も空港では二人にお世話になった。 そして、迎えの車はなんとキャデラック。シートも皮張りで少し興奮。 しかし、慣れないせいか途中で少し酔ってしまったので、とりあえず寝ることにした。 その間、妻は運転士と色々と話をしていたようだ。\nここでの宿泊先はハイアットリージェンシー。 ツアーの特典で、ジュニアスイートに泊まれるのだ。 部屋はさすがに2部屋合わせれば広い。 ただ、バスルームはアラジンと比べてしまうとグレードが下がる。\n荷物もそこそこにして、とりあえず昼ご飯を食べにホテルから近いはずのセブンスフィグへ。 で、外に出た途端にラスベガスとの違いをまざまざと見せられることに。 建物の影で寝ている人、激しく臭う通行人(ごく一部だけど)など、いきなり緊張感。 ひとことで「危険」と称するのはどうかとは思うが、危険な街だなと思った。 とりあえず、パンダエクスプレスで昼食、ロビンソンメイを少し散策、そしてホテルに戻った。\nそこで移動の疲れから少し休んで、気がつくと夜10時すぎ。 どうしようもないのでタクシーで懐かしのウェスティンボナベンチャーへ。 展望バーで晩御飯(すでに夜食に近いが)にステーキを食べた。 すっかり忘れていたが、床がゆっくりと回転しているので座ったまま360度の景色が楽しめる。 ラスベガスに比べれば夜景も暗いが、クリスマスの飾り付けがそれなりに綺麗だった。\nそうそう、アメリカでは日本のようにクリスマスをすぎたら正月、という雰囲気ではなく、クリスマスをすぎてもずっと祝っている。1月1日もニューイヤーデイというだけで、飾りはクリスマスのままのようだ。\nさて、ご飯も食べ少しゆっくりしたところでホテルに帰る。 ワンボックス型のタクシーをホテル前で拾い、帰った。 …実はすこし臭かったが、特に何も言わなかった。\nそれにしても、ラスベガスが特殊なだけだとは思うけど、夜は人が少ない、というかほとんどいない。 当然明かりも暗いし、とても静かだった。\n","date":"2005-01-06T08:02:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/06/080226/","title":"ラスベガスに行ってきた(4日目)"},{"content":"この日は珍しいことに雨だった。 昨日のガイド曰く、ラスベガスで雨の日に当たるのはスロットで当たるよりも難しい、とか。 翌日は移動なので、ラスベガス滞在は本日が最後だ。 今までの分を挽回できるのか？\n今日は、近所のホテルめぐりをする予定だった。 朝から天気が悪くて珍しく寒かった。\nデザートパッセージで少し買い物をし、予定どおりホテルめぐりへ行こうとしたら、外は雨だった。 部屋に帰れば折り畳み傘はあったのだが、大した事はないだろうとそのまま外に出た。 まあ、後悔するのだけど。\n予定では北はトレジャーアイランドから南はMGMグランドまで行くつもりだったのだが、雨という事もあって途中で断念。 北はシーザースパレスを経由してミラージュからベネチアンまで行き、そこからタクシーでホテルに戻った。\nベラージオとシーザースパレスは中を通っただけ。 ベラージオからはバリーズ方面、シーザースパレス方面へ陸橋があるのだ。中々便利。\nミラージュではホワイトタイガーとイルカに会いにいった。 ホワイトタイガーの前は人が多かった。前肢の太さと肩の筋肉のしなやかさが印象的だった。 イルカのほうは丁度ご飯の時間だったらしく目の前で芸を披露してくれた。 係の人が来る前や帰ったあと、一人遊びをしているイルカを見るのも面白かった。 ここのカジノは天井が低かった印象がある。\nここらでこれ以上ホテルめぐりをあきらめることに。 最後にベネチアンでゴンドラだけは見ておくことにした。\nベネチアンでは川を渡ってくるゴンドラを眺めた。 建物の中にあることを忘れるような眺めだった。…まあ、それを忘れれば川の幅は狭いのだけど。 船頭さんは中々器用だなと思いながらしばらくぼ〜っとしていた。\nで、タクシーに乗るためにタクシー乗り場へ。 途中で天井にかかれた絵画を見て思わず写真撮影。 タクシー乗り場では人の列が凄かった。やはり雨のせいなのか？ そして、ここの天井にも絵が。ラスベガスのホテルはただものではない。 結局30分くらいは待ったと思う。そのままホテルへ戻った。\nホテルへ戻ると、歩きすぎたせいか妻が足の疲労を訴える。 しばらくマッサージをして、気がついたらすでに6時すぎ。 とりあえず8時までは寝るという事なので1人でカジノへ。とりあえず、8時には戻ってくると言い残す。\nきっかけは100プレイのビデオポーカーでロイヤルフラッシュを1つ出したこと。 それを機に、今までプレイしていなかった色々なマシンに手を出した。 それなりにはつぎ込むが、ボーナスなどでそれなりに当たりが続く。 とりあえず今日の分だけで考えると$200以上の勝ち。ほくほくだ。\n…その後、スロットを回ったりして資金が少なくなってきたので、また100プレイのビデオポーカーに戻って、気がつけば勝っていた分はなくなっていた。 恐るべし。\nポーカーに戻ったあたりで妻がやってきた。もちろん8時は過ぎていた…。\n明日の朝の集合時間は早い。 とりあえず、徹夜で遊ぶことに決め、夜のご飯を求めるためコンビニへ。 今回はちゃんと傘を持っていった。 しかし、道路に川ができているなんて誰が予想した？\nそれはもう、後悔しても遅すぎです。 そこは開き直ってコンビニついでにホテルめぐりもしてみた。…といっても通っただけ。 MGMグランドあたりに店があるので行くつもりなのだが、道路が川になってて渡れないから仕方なくというのは秘密。\nMGMグランドで折返し、ファーストフードへ。 さすがに遅い時間という事もあって、開いてる店も少なく、人もそれなりに少ない。雰囲気が少し違っていて緊張した。 店の中で誕生日を祝っていた。歌は同じなのだがbirthdayの発音が違うことが特に印象的だった。\nウェンディーズでご飯をすませホテルに戻った。 そして、荷造りをして再びカジノへ。 明け方はさすがに眠かった。\n","date":"2005-01-06T06:20:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/06/062022/","title":"ラスベガスに行ってきた（3日目）"},{"content":"ラスベガス時間で12月27日はショーの最中にやってきた。 41時間の長い日が終わった。 そして、夜はここから始まる（何\nオーを見て、興奮が冷めないままホテルに戻ってカジノ三昧。 疲れもピークをすぎると感じなくなるようで、すでに眠くない。 そのまま朝5時すぎまでカジノで遊んだ。 本当に眠らない（眠れない？）街だ。\nさて、この日は昨日頼んだ夜のホテルめぐりが18:10にベラッジオで待ち合わせ。 眠りから覚めるとすでに昼過ぎだった。 それまでの時間はファッションショー・モールへお買い物。 そうは見えないのだが、それなりに距離があるのでタクシーでいく。 ホテルも道も広いし大きいので、距離感がおかしくなる。目に見えるところへ行くのに15分以上歩く必要があるのだ。 歩けばファッションショーへは30分くらいはかかるとの事。 タクシーの運転士にはプレミアムアウトレットを勧められたが、そこまでの時間もない。\nさて、ディズニーストアがあるという話で行ったのだが、残念ながら見つけられなかった。 ともかく、Macy\u0026rsquo;sで服などを買いこむ。日本人向けなのか11%割引券がもらえたので思ったよりも安かった。 そして、キッチン用品の店では電動ミルを買った。日本で見かけるよりも安い。友人宅へのお土産もこれにした。 17時もすぎそろそろ帰ろうという時になって、タクシー乗り場がわからない。歩けばかなり時間もかかるし、モール自体も広いので大変だった。 なんとか場所は見つけたものの、今度はタクシーが止まっていない。 待ち合わせの時間に間に合うかどうか心配になってきた。\n10分以上は待っただろうか？ようやくタクシーに乗れた。 ホテルについて荷物をおき、いそいで待ち合わせ場所へ。なんとか間に合った。\nガイドは大原麗子さん。なかなか面白い人だった。 メインストリートであるストリップは混んでいるのでフリーウェイを使って移動することに。 ホテルの紹介をしながらラスベガスツアーという感じですすんでいく。\nまずはストラトスフィア。 地上100階を超える場所に乗り物があるホテルだ。しかも、もうすぐ新しい乗り物が増えるらしい。 展望台に登る時にセキュリティチェックがあった。荷物のX線検査はないが空港なみに厳しい。 そのセキュリティを通るのに約30分かかった。 しかし、展望フロア（108階）に行ってみると人は少なかった。 乗り物は、展望フロアからさらに上。 とりあえず、乗ったのは二つ。Xスクリームとハイローラー。 Xスクリームはラスベガスの夜景に突っ込んでいくような感覚。夜だからきれいな印象が多かったのだが、昼間だとものすごく怖いだろう。残念ながら前から2列目だったので、前方がそれほど開けていなかったのが多少残念。と言っておこう。 ハイローラーはタワーを6週する。ずっと左回りなので安心して乗れる。 きれいな夜景がぐるぐる移り変わっていく様子がきれいだった。\n続いてリオ。 吊り下げられたゴンドラでダンサーが踊りを披露するショーだ。 2周目はネックレスを観客に投げてくれるというのだ。 ツアーガイド曰く、ネックレスをとれたらカジノで勝てるというジンクスがあるという。 実際、今までに二人ほど車を当てたらしい。 案内された場所で待ち構え、見事ゲット。妻もちゃんとゲットしていた。 そして今夜もカジノ三昧に違いない。\n続いてハワイアンマーケットで小休止。乾燥しているためかのどがよく乾く。ここで水をもらった。 そこからダウンタウンへ。 ショーの名前は忘れたが、かなり長いアーケードの天井が全てスクリーンになっていて、そこで色々な種類の映像を流すのだ。 ずっと首を上に向けているのは大変だが凄い迫力だった。\nツアーが終わって大体22時半。 外も人の数は全然減っていない。 夜はこれからだ。\n","date":"2005-01-05T02:30:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/05/023033/","title":"ラスベガスに行ってきた（2日目）"},{"content":"年末から正月にかけてラスベガス〜ロサンゼルス7日間の旅に行ってきた。 その間、マロンとキキはペットホテルに、チビーは友人宅に預けた。\nまずはラスベガスへ。 しかし、ロサンゼルス空港で一旦入国審査を受ける必要があった。 審査はスムーズに通った。荷物は遅かった（というか、勝手にレーンから下されていて気づくのが遅かった）が、そのあとトラブル発生。 妻の入国カード（？）にスタンプが押されていなかったらしく出口で止められたのだ。 で、オレのカードには押されていたので、オレは出て待っておくように言われた…。\nなんとか無事にスタンプを押してもらって（「オレはちゃんと押した」みたいな事を言われたようだが）乗り継ぎを開始。 そこで、現地のツアー担当に出会う。在住26年のベテランだった。 案内によってユナイテッドのエリアに。 乗り継ぎ便までまだ時間があるのだが、そそくさとセキュリティエリアへと案内されてしまった。 セキュリティチェックは結構込んでいたので、いろいろと話をした。日本語で。 スマトラ沖地震と津波の話もこの時に聞いた。マグニチュード9くらいの想像もできない規模の地震…。\nチェック自体は何事もなく通ってしまったので、乗り継ぎまでしばらく暇になった…。 現地時間も11時前と少し中途半端だったが、本日4食目のご飯（大きなサンドイッチだったが）をいただくことにした。\nさて、乗り継ぎ便はユナイテッド航空だが、機体にはTedの文字が。定員が130人程度の小さめの機体だった。 では、マッカラン空港へ向けて出発だ。\n機体が小さいだけあってかなり揺れる。 それにシートの間隔が狭い。普通に座っても膝から前の席が10cmもないくらいだ。 1時間程度の我慢だ。大した事はない。\nさて、無事マッカラン空港に到着。通路を通るとありました、スロットマシン。 が、スロットマシンよりも先に現地係員に出会う。…ここってセキュリティエリアじゃないのか？ とりあえず、荷物受取場までモノレールに乗っていく。結構遠い。 荷物を受け取って、さあ、いざラスベガス。\nホテルまではツアーの車（貸切状態だった）で案内された。 空港の車寄せには車長の長いリムジンがずら〜り10台以上。まるで別世界だ。 車がホテルに着くまで、窓から見える場所（というかほぼホテル）を運転士さんが紹介してくれる。\n宿泊先のアラジンについた。ここでホテル担当の係員に交代。ロサンゼルスから数えて4人目の担当（運転士含む）だ。 まずはホテルのチェックインをしてもらった。\nその後、観光スポットなどを色々と説明してくれた。不思議とセールス臭くなかったので、その中から車がないと移動が大変そうな、夜のホテルを見てまわるツアー（1人$50）を申し込む。\nそして、ようやくホテルの部屋で一休みできた。 しかし、夜（22:30からだ）はベラッジオで「オー」を見る事になっていたので、ゆっくり休んではいられない。\nまずは、そのチケット（3ヶ月前に予約済み）をまずは受け取りに。係員も、一回目のショー（19:30からだ）もあるから早めに受け取ったほうが良い、と言っていた。 その係員は、同じ時刻に「カー」を見に行くといっていた。\nさて、現地の服装だが。とりあえずそれなりに外を歩くので多少厚着にしていった。 しかし、ホテルに入るとやや暑い。 それに、思ったよりも寒くない。気温は摂氏1度とか聞いていたのだけど…。\n無事チケットも受け取り、ショーまで時間がある。いよいよカジノだ。 ベラッジオに行く前にも少し遊んだが、本格的に開始。 スロットクラブにも申し込んでポイントを貯めておく。 最初感じたよりも広いところだったので、マシンを色々見ている間に、カジノ内で迷子になりそうになった。 5¢や1¢のマシンもそれなりにおいてあったので、それらで軽く遊ぶ。 精算はコインが沢山出てくるのかと思ったら、レシートのようなもので管理されているらしくマシン間の移動がとても楽だった。\nしばらく遊んだあと、アラジン内にあるショッピングモール「デザートパッセージ」をうろつく。 そこで、本日5食目の食事。 デザートをもらえるクーポンを使ったら、そのデザートがでかい。 なんとか平らげて、またまたカジノへ消えていったのである。\nさて、長かった26日（17時間の時差があるので、41時間ある）もようやく大詰め。 今回の最も大きな目的でもある「オー」だ。舞台にプールがあるショーだ。 アメリカのエンターテインメントは、観客と演じる側との一体感が感じられる。今回もそれを最初、しかも幕が開く前に感じた。 別に大した事じゃない。ただ、観客の乗りが良いだけかもしれないけれど、気がつくと会場の拍手や喝采が手の振りで操られているのだ。\nそして予想を裏切る幕開け。 …敷き詰められている紅い布の上を走っていく人。その紅い布がなくなっていくと、そこは水だった。\n幕引きも突然。 しかし、日は開けて27日になっていた。\n","date":"2005-01-05T01:46:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2005/01/05/014636/","title":"ラスベガスに行ってきた"},{"content":"ここはロサンゼルス。\nいまからユニバーサルスタジオに行ってきます。 マミーに乗るのだ。\nちなみに、今12/30の11:30\n","date":"2004-12-30T19:25:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/12/30/192512/","title":"ロサンゼルスより"},{"content":"人狼てすと版(α3)の29.黒煙の村にニーナとして参加。 村人だった。\n前回と同じく14人の村。\n結果は狼の勝利です。 負けました。能力者の真偽推理がまるで逆だった。\n今回は狼希望で村人になった。 ちょっとショック。\nそれに不在者はどうにもならないのだろうか？ ま、事情はあるにしても少しくらい顔出しできるだろうに。 オレも自動投票はないにしてもギリギリだったけど。\n今回は、途中で離脱した人を吊らないことになった。2人に絞った自由投票だったのだが、結果的にそれが仇になった。 最終日は、実質人間2狼2でのランダムで負けた。\nやはり、手数が減っても不在者は何とかする必要があるのだろう。 村の敵は村の中にいた。 そういうのばっかり。\n","date":"2004-11-25T13:58:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/11/25/135809/","title":"自動投票に左右される不条理"},{"content":"人狼 てすと版(α3)の16.峠の村にステラとして参加。 狂人だった。\n14人の村は、狼が3人となって比較的狼に有利な村。 そう、最初から狼にとって有利なんですよ。\n結果は狼の勝利です。 狂人は役立たずでした。まあ、吊られただけマシですが。\n最初から発言無しのキャラがいたのだが、そいつがなんと占い師だった。 つまり、アレですよ。 本物と思っていた占い師は狼さんだったと。\n不在者がいて、占い師が1人の場合、とても危険です。\n","date":"2004-11-19T01:34:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/11/19/013453/","title":"伝説の村"},{"content":"α3 (ID: pliz)\nhttp://www.juna.net/game/wolf/room/13/ http://www.juna.net/game/wolf/room/9/ http://www.juna.net/game/wolf/room/3/ α2.5 (ID: pliz)\nhttp://www.juna.net/game/wolf2/room/17/ http://www.juna.net/game/wolf2/room/14/ http://www.juna.net/game/wolf2/room/11/ ","date":"2004-11-15T04:16:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/11/15/041625/","title":"人狼α プレイ一覧"},{"content":"juna.netの人狼が人狼 てすと版(α3)になっている。 とりあえず静かな村に「医師 ヴィンセント」として参加した。 プロローグをよく読まなかったせいで「折檻」の意味が非常に微妙。あとで気づいたがもう遅いよ…。\n結果は村の勝利。オレは結社員（共有者）だったので勝った。\n以前α2.5のなかで呟いていたことが実装されていた。 発言ポイント（独り言含む）の減少、過去ログの1ページ化とか。 「話しを促す」がゲームとして必要があるかどうかはわからないけど、全体的に話せる量がまだ多いと思う。中には独り言も使い切る強者もいるみたいだけど。 ゲーム性を高めるにはもう少し減らしたほうがいいのかな?と思うけどどうだろう？\nあと、発言フィルタと発言数表示は便利だね。 欲を言えば、過去ログになった時もポイント数があるといいなぁ。発言量の目安になるからね。 要望出しておこうかな。 でも、計算するの面倒だろうな。 減算方式だと、「話しを促す」の分を考慮するのに変数がいるし。 もしくは、総発言ポイントという変数を作ったほうが楽か。\n","date":"2004-11-05T02:43:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/11/05/024316/","title":"人狼ぶろぐ？"},{"content":"人狼BBS まとめサイトに個人ページを作ってみた。\n人狼BBSとA国の戦績は自動的に集計されるようになっているようだ。すごい仕組みだ。\n","date":"2004-11-03T10:29:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/11/03/102939/","title":"人狼まみれ"},{"content":"人狼セカンドプレイ 人狼BBS: A A117 海辺の村\n人狼BBS（A国）では初プレイ。なので村人希望でエントリー。結果、人狼だった。 なかなかうまい具合にステルス。まとめ役にリーダーシップが不足していたので特に難しい話も無かった。 が、しかし、グレーが3人になった時点でオレが動揺。運悪く投票でランダム負け。死亡。 しかし、結果は狂人ともう1人の人狼により勝利。 狂人は狼に襲われるという狂人らしい最期だった。\nダイジェスト 一日目（狼2：人間10） 適当。村も狼も方針らしい方針を決めなかった。\n二日目（狼2：人間9） ゲルト襲われる（お約束） 占い師が二人CO。ディーターを占い、結果二人とも白。ディーター支配人誕生。\n三日目（狼2：人間7） アルビン（霊能者）吊り完了、占い先のペーター襲われる。 目立った動き無し？ローラー状態。\n四日目（狼2：人間5） ニコラス吊り完了、ヤコブ襲われる、占い先トーマス白 ここで狼か狂人を吊らないと村の完全敗北。\n五日目（狼1：人間4） 票割れてパメラ、ヨアヒムのランダムでヨアヒム（オレ）吊り完了、トーマス（狩人）襲われる。占い先パメラ白 リーザ（実は狂人）が占い先をオットー（実は占い師）に変更、黒判定。ディーター大変。\n六日目（狼1：人間2） オットー（占い師）吊り完了、パメラ襲われる。 この時点で、人間のうち1人が狂人なので狼の勝利。人狼＆狂人CO。ディーター逃亡。\n七日目（狼1：人間0） ディーター吊り完了、狂人リーザ襲われる。 終了。\nRP反省点 読みなおしてみると話題が中途半端。誰も突っ込まなかったから良かったものの、普通は疑いの対象。 4日目完全勝利を目前にして窮地に陥った時つい余計なRPに走ったり、頭が真白になって行動できなかった。 人間側のリーダーの特徴を利用するような発言をしていくのが大事なのだろう。\n教訓 人間（村）側にはリーダーが必要。まとめ役がきっちりしていないと狼に付入られる。 あと、狂人と狼の連携を狂人側から取るのは難しい。霊能者COなど、狂人にわかるようなアピールが必要。\n","date":"2004-10-22T01:43:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/22/014355/","title":"人狼セカンドプレイ"},{"content":"人狼初プレイ 人狼 てすと版(α2.5)で初めて人狼をプレイした。隠された村。 ただの村人役（宿の主人 ヘクター）だったが、狩人（↑では守護者）に間違われて襲われて死亡。結果は人狼側の勝利で、村は負けてしまった。残念。\nダイジェスト 一日目 色々相談。ここでは「アクション」があるので、ついついRPしてしまうようだ。\n二日目 自警団全滅（お約束）。 占い師が人狼を見つけた。最初の占いで黒は珍しいが、とりあえず信じて吊り実行。\n三日目 狼さん吊り完了。狩人襲われる。 霊能者（霊媒師）現る。ここで村が勝利ムードに包まれる。しかし、悲劇はそこから始まった。\n四日目 はからずも狂人吊り。村人（オレ）襲われる。ここで狼が1人、人間が7人。自動投票（人狼BBSならほぼ突然死に相当）が3人。 霊媒師（まとめ役）が白吊りに動揺。方向性失う。\n五日目 自動投票者吊り。霊媒師（まとめ役）襲われる。狼1：人間5。 グレーローラー作戦続行。\n六日目 自動投票者吊り。占い師襲われる。狼1：人間3。 大ピンチ。ここではずすと負け。\n七日目（最終日） はずした…。村人襲われる。狼1：人間1。 終了。\nRP反省点 今回の役はただの村人だった。人狼自体の初プレイなので、とりあえず気楽に。 素の状態でRPしていたら、狩人に間違われていたらしい。 狩人は黙って守るものなので、RPするものでは無いと思うのだが、狼側はそうは思わなかった。もしくは、思わずRPしたものとして解釈したようだ。\n教訓 狩人はRPするな。少なくとも狩人っぽい仕草はするな。\n","date":"2004-10-22T01:10:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/22/011059/","title":"人狼初プレイ"},{"content":"人狼をやるつもりの人なら必ず読む必要がある。 というか、読まずにやると非難を浴びる事は間違いない。 そこで人狼BBSの過去ログのオレ的な読み方。 まあ、まだ一度しかやってないけど。\nまずは村人視点で全部見て推理しながら読んでいく。やはり種を知る前に読まないとね。ゲーム中は村人の視点がとても重要だと思うし。 次に最終日の結果までわかったら最初に戻って全員の視点で読む。ゲームをやるなら重要なのはここ。役職が全部わかるので、誰がどういう立場で発言していたかを確認していく。 最後に感想というか講評というかを読む。プレイヤー同士の思惑とかがよく見えていいと思う。\n","date":"2004-10-18T02:12:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/18/021248/","title":"オレ的人狼BBSの読み方"},{"content":"はまる…。\n人狼BBS:A（人狼BBSと多分同じ）が結構空いている。\nあと、BBSタイプならば人狼てすと版(α2.5)も空いている。 役職名は違うが、人狼BBSを進化させたような感じだ。 RSSがないのは残念だが、個人用のページはHTML化されているのでアクセスに対する負荷が少なそう。 発言も回数じゃなく量で決まるような仕組みを取っていてなかなか良いと思う。\n","date":"2004-10-18T01:26:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/18/012609/","title":"人狼！"},{"content":"いよいよ本命（？）のくら寿司。 日曜日の晩御飯だ。 日曜日にしては空いていた。 まあよく行く店舗は9時を過ぎてもかなり人が待っているので、今回は行き先を変えたのが正解だったのかも。\nただ、研修生か新人が多いのか対応が微妙。教育している声も聞こえる。 あと妻曰く「トイレレベルが低い」。 それは箕面店だ。\nちなみによく行くのは江坂店だ。\n","date":"2004-10-18T01:19:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/18/011910/","title":"くらくら"},{"content":"別に変なAA（アスキーアート）ではない。餃子の王将だ。 土曜日の晩御飯。 ここの餃子は安くてでかくてうまくて熱い。結構口の中が火傷する。 それでもいくのだから不思議なもんだ。\n","date":"2004-10-18T01:04:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/18/010436/","title":"OHSHO"},{"content":"やっぱりゲーム好きには必要なカテゴリーだったか。\nそもそもそのゲーム自体を今日始めて知ったのだ。 最初はブログの中で見た。 「汝は人狼なりや？」というゲーム。\n最近、ゲームで頭を使うことがなかったので、気分転換に色々と調べてみた。 WORは戦争がないとクリックするだけのゲームだしね。 まあ、辞めたので新しく何かやりたかったのかもしれないけど。\nで、色々と調べていくのだが、なかなか参加できる場所がない。 そんなときに「人狼BBS」という場所でおすすめログがあったので、投票数がわりと多かった55村を読んでみた。\nますますやりたくなった。 やっぱり人間を相手にするなら駆け引きが面白い。\n","date":"2004-10-14T17:54:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/14/175409/","title":"汝は人狼なりや？すなわち人狼"},{"content":"M.Hiroi\u0026rsquo;s Home Page / Puzzle De Programming\n何を検索して見つけたのかすでに記憶に無い。検索されたページを読んでいて気に入ると、調べるのを忘れて没頭していることが多い。\nまたエクセルの話になるが、最初に作ったのは確か15パズルだった。 整列した状態からランダムに並び替えをして、それを解いていくパズルだ。 マスの数を自由に変更できるので、8パズルから80パズルまで遊んだ。\n次ぐらいに作ったのは、パネルを取り除いていく思いつきゲーム。 最初はどれでも取れるが、次からは取ったパネルと隣り合った4枚のうちどれかしか取れない、というルールで全部取り除くと達成。 パネルを取り除いていくルールで逆にパネルを置いていくのでランダムだが、必ず解ける。 枚数を設定できるようにしたが、あまりに多いと逆に簡単になっていくようだった。\nという感じで、パソコンに出題させて自分で解く、という感じで遊んでいた。 ひょっとすると製作時間のほうが遊んだ時間よりも長いかもしれない。\n","date":"2004-10-14T07:53:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/14/075321/","title":"パズルゲームは好きですか？"},{"content":"折角なので（って何が折角なのかよくわからないけど）もう一つ紹介。文章が読みやすくて深いです。\nオリーブの枝\nアルゴリズムはプログラムを作る上で大切なもの。\n1〜n（正の整数、例えば10）までの足し算の答え（和）を計算するプログラムをなんとなくPerlで作ってみよう。\n1 2 3 4 5 6 my $n = 10; my $sum = 0; for (my $i = 1; $i \u0026lt;= $n; $i++) { $sum += $i; } print $sum; はいできました。\n…ループは便利なのだが、先のプログラムでは$n回の足し算を行うことになる。\nさて、1〜nの和を求める公式があるので、それを使う。\n1 2 3 my $n = 10; my $sum = ($n + 1) * $n / 2; print $sum; 式は少し複雑になったが計算は1回で終了。 さて、どっちが速いか？\n$nが小さいうちはループのほうが速いかもしれない。 でも、$nが大きくなればなるほど公式を使うほうが圧倒的に速くなる。\nプログラムはそのアルゴリズム（計算方法？）で性能が各段に変わる。\nかなり昔、（小学校の3，4年くらい？）奇数マス四方の正方形の魔方陣（数字を一つずつ使って、たて、よこ、ななめの和が全て等しくなるように並べる）の作り方を父から教わった。（父は、特に算数に関しては良き先生だった。）\n3×3の例\n1 2 3 2 7 6 9 5 1 4 3 8 奇数マス四方の作り方は、どれだけ大きくなってもちゃんと成立する。 しかし、偶数マス四方の作成方法は4×4では出来るのだが、6×6だと成立しない。というか、4×4にしても、どのような法則なのかいまいち釈然としなかった。\nこの時6×6の魔方陣も作れていたら、数に執着はしなかったかもしれない。 中学どころか高専の時も思い出しては図書館に行って本を読んだ。 6×6の魔方陣は本の中に存在している。しかし、どうやって作っているのか読み取れなかった。\n最初にエクセルでプログラムが出来ることに気づいて作り始めたのは、魔方陣計算プログラムだった。 今思うと、最初の例のように「総当り」という工夫も何も無いプログラムで、とっても遅かった。\nと、まあ、そんな昔の話を思い出した。 結局、4×4までは330MHz程度のパソコン上で動くエクセルでも、我慢できるほどで結果が出てくるようにはなった。 しかし、突破口が無いのでずっと放置したままだ。\nプログラムのアルゴリズムはともかく、魔方陣そのもののアルゴリズムについてのページを見つけた。\nMagic Square すごい。\n","date":"2004-10-14T05:42:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/14/054252/","title":"魔方陣とアルゴリズム"},{"content":"さっきの記事は「perl」でブログ検索したところから色々リンクしてたどりついたところ。\n年齢のせいか、だんだん日常が漫然としてくる。\n昔から人間観察というかそういうのが好きで、心理テストの解説に興味を持ったり心理学の本を読んだりしていた時期もあった。 いろんな事に興味を持って何かしら考え事をしていた気がする。\n最近、自分がMTを使い出して、色々な人のブログを読むようになって、色々な人に共感を持ったり反論を持ったりするようになってきた。 やっぱり人間って面白い。\n","date":"2004-10-14T05:12:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/14/051209/","title":"ブログの輪"},{"content":"「社長様」に気をつけろ!　飛び入りと肩書き\n別にオレは社長ではないのだけど。 良いセールスマンと悪いセールスマンの違いが的を射ていて面白い。\nと同時に、悪いセールスマンとしつこい勧誘電話が頭の中で繋がった。 こっちの言うことには耳を貸さずに延々と自分の主張をして、脈なしだとわかると一方的に電話を切ってしまうのだ。捨て台詞と共に。\n幸いにも最近は殆ど無いのだが、うちの会社の支店長のところには頻繁にかかってくる。 大体が投資関係の話だ。 で、そのセールス電話が成功したような気配は全く無い。\n","date":"2004-10-14T04:48:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/14/044820/","title":"しつこい勧誘電話"},{"content":"今夜はあきんどスシローへ。 どうしても金沢の回転寿司と比較することになる。 今日は高いヤツ（一貫もの）を多く食べた。\nそれでも料金は二人で2,800円くらい。\n","date":"2004-10-13T15:51:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/13/155147/","title":"大阪回転寿司"},{"content":"イノシシとシカ、電車止める　JR湖西線の2カ所\nクマだけじゃなく、イノシシやシカまで麓までエサ探し？ ザ・コアじゃないけど、地球の磁力が変になっているとか？\n田舎に行った時はクマとか出なかったけど、考えるとなかなか怖いね。\n","date":"2004-10-12T08:38:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/12/083843/","title":"動物に異変？"},{"content":"「のぶろぐ」で検索に引っ掛かるのか試してみた。 よく考えてみると「○○のぶろぐ」という感じのヤツが全部引っ掛かる。 そんななかで、同名のブログがあったので記念リンク。\nのぶろぐ のぶろぐ のぶろぐ のぶろぐ のぶろぐ そろそろ飽きてきた。 とりあえず30件までで5件。\n","date":"2004-10-12T08:05:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/12/080508/","title":"よーく考えよう"},{"content":"カラオケで歌う時は、主旋律を耳コピーしてそれにしたがって歌う。という事をやっているのだろう。 あまり意識はしていないが、耳コピーというのは自然に出来る物なのかもしれない。主旋律くらいなら。\nMIDIを作っていく過程での耳コピーという作業は、採譜という作業になる。 オレはそれが苦手だ。\n中学生の頃にパソコンでドラクエの曲（音源はPC88MA2のFM音源だ）を打ちこんだが、それはカセットについていたおまけの楽譜を元にしてだった。 （今考えると、ドラクエ1〜4で楽譜のある曲は全部打ちこんだのだから我ながらすごい） 実際に楽譜のとおり打ちこんで、それを聞いて変なところはその都度修正したり、原曲にあって楽譜に無い（と感じた）音を追加したり。 …修正や追加という作業はわりと簡単で楽しいのだが、最初から作るというのはとても大変で難しい。\nWindowsを使うようになって、MIDIに興味を持ったころ、最初に打ちこもうと思ったのはドラクエの曲だった。 が、しかし、その時にはおまけの楽譜をほとんど無くしていた。 ついでにパソコンも壊れていた。 まあ、少なくとも5年は放置していた（その間は家庭用ゲーム機で遊んでいた）のだから仕方ないと思ったけど。\nそんなわけで、初めてMIDIで作ったのは、ドラクエ5の曲だった。\n","date":"2004-10-12T07:20:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/12/072007/","title":"耳コピーと採譜と始まり"},{"content":"フロントミッション全曲集計画（新しく作ってないけど）でお世話になっているかともさんのページで「生パイプオルガン」という記事を見た。 で、思い出した。\nオルガンの有名な曲はいかにもオルガン！って感じの音だけど、パイプオルガンの仕組みを知った時はシンセサイザーみたいだと思った。 音源でオルガンという音色はあるけど、それは本来の意味ではオルガンの音色ではない。なんだか騙された感じだ。\n…でも、オルガンの音色は好きだ。\n原因になっている曲は、Xの「Rose of Pain」とか、コナミのゲーム「ドラキュラシリーズ」の曲全般とか。\n","date":"2004-10-12T06:49:49+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/12/064949/","title":"パイプオルガン"},{"content":"実家は若林荘という民宿をやっている。 「shi」ではなく「si」なのは親父の趣味だ。\n近所は民宿ばかりで競争も激しいはずだが、うちの実家は昔から来てくれている馴染の人が多く、一見さんが少ない、ということだ。 馴染の人がいうには、釣り舟が良い（親父が釣れるポイントを沢山知っているから）らしい。\n実家では犬を飼っているので、地元の商工会からペット連れのお客さんを紹介されたことがあったらしい。 残念ながらその時はすでに満室だったので断ったらしいのだが…。\nうちも犬を飼っている家庭なので、ペットと泊まれる民宿にしたらどうかと言ってみたが、あまり乗り気ではなかった。 個人的にはペットと泊まれる宿が増えてくれれば嬉しいんだけどね。\nイヤな理由としては、「他のお客さんに迷惑になる」ということが筆頭。 （ふと気づいたけど「盲導犬を断った理由」と同じなんだよね…。）\n個人的には犬そのものよりも飼主のマナーアップに期待したい。 無駄吠えしてるのに放置していたり、きれいな芝生の中にウンチが放置されていたり。 このままだと自由に遊べる場所がどんどん少なくなっていく。\nペットのしつけは飼主の責任。 子供のように可愛がるなら責任もちゃんと持たなくちゃ。\n","date":"2004-10-12T05:34:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/12/053458/","title":"実家の商売"},{"content":"10/05〜10/11の車中1泊付6泊7日、総走行距離約1,700kmの旅は無事終了。\n大阪、高速、新潟、七尾など、道を走りながらレギュラーガソリンの値段を分析。110円後半が多い。 金沢は値段の幅があった。最安値は北陸道金沢東ICそばのGS。105円/リットル。ビバ、コーナン。 しかし、残念なことにそこで給油することはなかった。 田舎での給油は余裕を持って。\n","date":"2004-10-11T17:30:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/11/173029/","title":"無事帰着＆ガソリン単価"},{"content":"旅行の締めに、というわけではないのだが、寿司を食べよう、と言うことで気になっていたという「もりもり寿司」へ。 （今調べてみると金沢では結構人気がある店のようだ。）\n回転寿司というとくら寿司かあきんどスシローくらいしかいかないので、職人さんが回転レーンの中で握っているのは久しぶりに見た。\nいくらの味が濃厚、ヒラメの縁側が分厚い、回転レーンが3段（うち湯のみが1段）、などなど。 普段との違いをはっきりと感じた。\nただ、時間が遅かったのか、ネタ切れが結構あったのが残念だった。次はランチタイムに行ってみたい。 会計は二人で4,200円程度になったが、美味しかったので安く感じた。\n","date":"2004-10-11T10:49:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/11/104922/","title":"金沢の回転寿司"},{"content":"WHR3-AG54で実家の無線LANを構築した。 AOSSという仕組みを使ってセキュリティにも気を使った設定にすることができる。 という機能に惹かれて選んだ。\n本当は、設定を全部細かくやるほうが精神衛生上よいのだが、時間もかかるしいろいろ調べないといけないし大変なんだよね。\nというわけで、最初は長押しするのがわからなくて親機を認識させるのに手間取った。 が、それがわかれば後は簡単。 自動的に「WPA-PSK AES」という方式のセキュリティがかかった。\nで、2台目の子機を設定するときに、1台目の調子がおかしくなってしまった。 しかし、AOSSの設定中ということで一時的に使えなくなっていただけだったというオチ。 無事2台の無線LANが完了した。\n…まあ、そのうちの1台は（妻の）手持ちのノートなのだけど。\n","date":"2004-10-09T17:27:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/09/172717/","title":"無線LAN"},{"content":"生まれて2回目のなんでんかんでんだ。 2回とも金沢だが。\n店内はとんこつ（？）臭い。 時間帯が中途半端なせいか客も少ない。 前回もそうだったけど、マネーの虎で話題性があっただけなのか？、と思う。\nスープの一口目はぬるかった。 が、かき混ぜるとそうでもなかった。 麺も思ったよりかため。というか、少し生っぽい。 と、思ったのだが。 それでも。 スープはなかなか癖になる味だと思った。\n今回はネギばかラーメン。 すりゴマや高菜、紅しょうががテーブルにおいてあって自由に使える。 しょうがを入れると独特の臭みが抑えられて味が変わる感じ。\nたぶん、今度実家に帰ってくるときも寄る事になるんだろう、と漠然と思った。\n","date":"2004-10-09T14:18:46+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/09/141846/","title":"昼はラーメン"},{"content":"新潟から数百キロ。 最近合併して郡から市に昇格（？）した実家にやってきた。\nそして、何故か無線LANを構築。 で、早速そこから書き込みというわけだ。\n","date":"2004-10-09T13:49:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/09/134928/","title":"今日からオレの実家"},{"content":"本日は友人夫妻と江戸沢で夕食。 友人（夫）が妻の元バンド仲間で、友人（妻）が妻の複雑な知り合い（バイト仲間＆エレクトーンの先生が同じ、etc）、という関係。 うわさではキューピット役だったらしい。\n","date":"2004-10-08T16:10:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/08/161054/","title":"今期初（ちゃんこ）鍋"},{"content":"昼はだるまやラーメンで。 餃子は肉汁たっぷりでいいのだが、もう一味欲しい感じだった。 餃子のたれは自分で作るのだが、天日干のとうがらし、が、ラーメンにも使えていい味をだしている。\n種類は背脂系とんこつ？ 味噌ラーメンもあるのだが、前回（昨年）と比べてスープが変わったと（妻談 北国系らしく、表面に脂の膜があって冷めにくく、食べ終わった後もスープから湯気が出ていた。\n最終的にオレのラーメンだけがとうがらしの入れすぎで色違いだった…。\n","date":"2004-10-08T06:19:14+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/08/061914/","title":"らーめん"},{"content":"妻の母親がプリンターが欲しいというのでヨドバシへお買い物。 とりあえずプリンターだが、コピーも出来るということで複合機を奨めた。 選んだのは「hp psc 1315」、約15k円。\nうちが複合機（hp psc…なんだっけ？）を買ったときはほぼ倍の値段だった。 1315との違いは、カードリーダーの代わりにPictBridge、両面印刷が自動で出来ない、くらい。 この業界も進歩が早いのね。\n","date":"2004-10-06T23:30:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/06/233026/","title":"最近の複合機"},{"content":"総延長600km超。 大阪から新潟まで走り抜けました。 一家総出の家出（ぇ\n5日の深夜に出発。トラックがやたらに多い。 予想以上の眠気で北陸道に入ってすぐ（3時頃？）仮眠。 朝7時頃に再出発。 途中、朝食＆塩ソフト休憩などをしながら14時頃目的地到着。\nたぶん、チビーが一番疲れただろう。お疲れさん。\n","date":"2004-10-06T23:22:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/06/232225/","title":"超長距離運転"},{"content":"深層水で作られたソフトクリーム（袋入り）。 前回（いつだっけ？）の新潟紀行の帰りに発見。珍しかったので買ってみたら、なかなかおいしかったので、今回は捜索をかねて。 北陸道のSA「有磯海」で発見。\n","date":"2004-10-06T23:06:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/06/230608/","title":"塩ソフト"},{"content":"本日からしばらく新潟県民。\nというわけで、昼は小嶋屋でへぎそば。 わさびが鮫皮と一緒に出てきた。そのまま少し食すと、つ〜んとした感じがなく甘かった。\n夜は山茂登で釜飯。 釜飯は意外と量が多く、ほかの料理を結構頼んでいたせいで腹12分目。食べ過ぎた。\n","date":"2004-10-06T14:53:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/06/145350/","title":"へぎそば＆かまめし"},{"content":"今晩はリンガーハット。 基本はちゃんぽんめんだ。\n","date":"2004-10-05T14:40:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/05/144057/","title":"リンガーハット"},{"content":"今日は肉々しいメニューだった。\n","date":"2004-10-04T14:45:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/04/144508/","title":"ウィンナー＆ナゲット＆…"},{"content":"技術のある人というのは、その技術を使って何かすることで「満足」を得ることが出来る。と思う。 フリーソフトウェアというのはそういう気持があるからこそ出来るのだと思っている。\n一般的な仕事の場合、納期や予算があるので、技術屋としては限られた範囲で何とかしなければならない。 しかし、そういう作業というのはストレスがたまる。\nもう少し時間があれば、もう少し予算があれば。とか。\nこの前、テレビでSEGAの社長（ソフトウェア部門出身だったはず、名前は失念）が「最後のひと頑張りで出来が違ってくる」というような（少なくともオレはそう受け取った）趣旨のことを言った。 その時は「だからといって発売延期が続くとイヤだけどな」と思ったのだが。\n仕事は技術屋でも種類は違うけど、営業とかの都合で作業の時間が減ってしまうことはよくある。 なんでもハイハイ受けるのが営業ならオレでも出来る。 営業屋さんは理想とかないのかな？\n","date":"2004-10-04T00:59:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/04/005925/","title":"技術屋の理想"},{"content":"最近、大人っぽい対応ができなくなってきたような気がする。\n例えば、急いでいる時に駅構内のエスカレーターで両側がふさがっていた場合（今朝がまさにそうだったのだが）、わざと聞こえるようにため息をついてみたり、舌打ちをしてみたり。 普通に「急いでいるので通してください」とか言えば通れたかな?、と後で思った。\n","date":"2004-10-03T23:32:50+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/03/233250/","title":"余裕がない？"},{"content":"今夜の夕食はあきんどスシローでスシ。 丁度混んでいる時間帯だったせいか、結構待った。 帰る頃（8時くらい）には待っている人は少なかったけど。\n瞬間ピーク時は人が足りないんだろうなぁ。 席が空いていても呼出が全然なかったりする。 そうかと思えば、店員同士が雑談をしていたり、研修生（？）を教育するのに二人で行動していたり。 待たされる身としては嫌なのだが。\n","date":"2004-10-03T14:06:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/03/140643/","title":"大回転"},{"content":"散髪にいってすっきりした。 ひげそり＆シャンプーで、計1,800円。\nわりと丁寧にひげを剃ってくれていたと思うのだが、結構残っている。 自分でやったときに残るような場所（左のえらの下あたりとか）はきれいなのだが、普通にそれる部分は手触りで微妙に残っているのがわかる。\nやはり3枚刃の威力はすばらしい。\n","date":"2004-10-03T04:34:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/03/043459/","title":"三枚刃の威力"},{"content":"工事自体は大したことないのだが、職人の車がうちのマンションの前に止まっている事と、作業用の足場で歩道を封鎖している事が腹立たしい。 分譲マンションの営業用の事務所になるようなのだが、この分だと営業のときにも車で悩まされることになりそうだ。\n","date":"2004-10-03T01:40:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/03/014055/","title":"となりの工事"},{"content":"昨夜はめんむすで大量にうどんを消費した。\nうどんがぶっかけ（大（3玉））で、てんぷらが半熟卵とごぼう。\nうどんが結構太め。\n半熟卵のてんぷらは変形するほどやわらかいのにしっかりしてて、中身もとろとろの部分と固まった部分とが微妙に混ざり合ってかなりおいしかった。\n","date":"2004-10-03T01:24:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/03/012428/","title":"大量のうどん"},{"content":"ボンズという店ができた。 以前は「きのや」が入っていたところだ。\n最初は定食屋なのかと思っていたら、実は居酒屋みたいな感じの店だった。 初めて行く店。\n行く前にホームページで調べると、店の雰囲気は「くつを脱いで掘りごたつに…」とあったのでちょっと期待していたら、新しい店はバリアフリー化されていたようで、土足のまま普通にテーブルだった。 テーブルといっても、仕切りが天井まであって個室っぽい雰囲気でなかなか良い。 分煙も結構きっちりしている。\n飲み物も、食べ物も結構頼んでおなかいっぱい。 二人で5,800円弱ってところ。 妻がアルコールを飲まないので、二人がアルコールだともう少し高いかも。\n","date":"2004-10-01T23:01:32+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/01/230132/","title":"近所にできた新しい店"},{"content":"結局、ほとんど自分でテンプレート（スタイルシートも）を作ることにした。\n","date":"2004-10-01T06:42:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/10/01/064237/","title":"落ち着いてきた？"},{"content":"お手製マーボ豆腐とお手製ワンタンスープ。\n相変わらず作りすぎ。 マーボ豆腐を残した。\nワンタンの中身はエビがぷりぷりだった。 オレ的には薄味だったのだが、「旨味のわからない人ね」と言われた。\n別にいいけど。\n","date":"2004-09-30T16:10:57+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/161057/","title":"今夜のご飯"},{"content":"テンプレートがよくわからん。 そんなわけでテスト。\n","date":"2004-09-30T10:50:08+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/105008/","title":"トラックバックが…というよりは"},{"content":"あまり見てなかったといえば確かにそのとおり。 でも、まさか\u0026quot;cousagi\u0026quot;だったとは。\n","date":"2004-09-30T10:35:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/103521/","title":"こうさぎはこうさぎだった"},{"content":"ペットボトルビール 泡立つ!?論争\n缶のほうがリサイクル率いいのは、缶集めしている人々がいるからではないのか？ この記事を見て朝早くから大量のアルミ缶を自転車に積んでいる人々を思い出した。\n大体、未だにペットボトルをどう捨てればいいか迷う。 「燃えるゴミ」と「カン・ビン」があった時どっちに捨てればいいのか。 覗いてみるとどっちにもペットボトルがある。\nオレは基本的に「燃えるゴミ」に捨てている。\nそれにしても、スタイニーボトルはどうなったのか？ 1回だけ買った事があるけど、泡だって飲みにくかったから一度きり。 ビンはやはりグラスを使わないとね。\n飲み方はペットボトルもビンと同じだと思うが…。どうなんだろう？\n","date":"2004-09-30T10:06:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/100645/","title":"ペットボトルのリサイクル"},{"content":"おそらく新技ではないと。 しかし、スタイルシートでの段組の基本を知らなかった身にとって驚きの技（というか設定）があった。 これで今までレイアウトが崩れてしまって困っていたことが解決だ。\nそれは「word-break」。 たしか中学で、英単語は区切る場所があってそれ以外では区切ってはいけない、という風に習った記憶がある。 で、この「word-break」はそれを無視することができるのだ。\nword-break: break-all;\nこれで長い単語でも大丈夫。 たとえば\n1 2 incomprehensibl e という感じにできてしまう。\nガラガラと音をたてて常識が消えていった瞬間だった。\n","date":"2004-09-30T06:03:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/060330/","title":"スタイルシートの新技"},{"content":"HTMLファイルはキャッシュされる。 最近のIEなどは、読もうとしたファイルの更新時間を取得して、以前キャッシュした時の更新時間と変更がなければキャッシュしたファイルを読む。 そうすることで、通信時間をかけずに読める。 いいことだ。\nしかし、開発時はそれに悩まされることが多い。 特にHTMLファイルではなく、JavaScriptとか外部ファイルの場合。 変更したのに正常に動かない時、実はキャッシュを使っていただけ、という事がよくある。\nだから開発時には「キャッシュを使わない」設定にしていることがある。 ブロードバンドならば多少の通信コストは無視するという選択肢は間違いではない。と思う。\nただ、実際に使う人が「自動的に更新を確認する」設定だとやはり問題がおきる。\nこのMovableType3のタイプキーの管理（サインインとかサインアウト）はJavaScriptで行われている。 サインインしたはずなのにしていないことになっている。 そして、リロードすると（または新しいページを開くと）サインインしている。\nサインアウトも同じ。\nキャッシュは便利なのだが、JavaScriptによるダイナミックな変更さえもキャッシュするのはどうかと思う。\n","date":"2004-09-30T04:17:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/041747/","title":"ファイルキャッシュの表裏"},{"content":"WORもそうだったのだが、カスタマイズをしていくには、中身を知らなくてはならない。 中身を知れば知るほどに、自分のスタイルと違うことに気づいていく。\nそして、禁断の領域に。\nカスタマイズが大変だったのは色関係。 こうさぎを導入する時に背景がないとかわいそうだったので素材を入れることにした。 で、ついでだったので、そのサイトで気に入った画像を背景にした。\nもともと背景が灰色に近い青を選んでいたのだが、画像に合わせて背景を黒に変更した。 背景を黒にしたので、黒をバックにする文字の色を明るい色に変更しようとした。\nそこは禁断の領域だった。\nオレが思う設計のスタイルシートだったら、多くても2,3箇所の修正で済むはずだった。 しかし、残念ながらそうではなかった。 また、スタイルシートの中身を見ていくにつれて今後のカスタマイズについて考えると滅入ってしまう要素がたくさん出てきた。\nそこまで細かく設定しなくても。\nそれでも、頑張って色を全部変えた。\nでも。 もうだめぽ。 初期化した。\n","date":"2004-09-30T03:53:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/035311/","title":"カスタマイズすればするほど感じること"},{"content":"どうもコメントまわりがおかしい。 とりあえず新しいブログをつくって、そっちの設定をもらうことにした。\n何が正しいのかわからない。\n","date":"2004-09-30T03:39:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/033935/","title":"カスタマイズ失敗"},{"content":"テンプレート数が11になった。\nカスタマイズの最中に、コメント関係のスクリプトの挙動が変だったので、中身を見た。とても時間がかかったが。\nで、その中で、MTタグの使い方が怪しいと思われる個所を発見。 確認はまだだけど。\n1 \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;\u0026lt;MTCGIPath\u0026gt;\u0026lt;MTCommentScript\u0026gt;?__mode=cmtr_name_js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 少なくともこうだと思われる。\n1 \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;\u0026lt;$MTCGIPath$\u0026gt;\u0026lt;$MTCommentScript$\u0026gt;?__mode=cmtr_name_js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ","date":"2004-09-30T01:58:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/30/015844/","title":"テンプレート・モジュール大活用"},{"content":"今日は一家総出でクウ動物病院へ。\nマロンは検査。\nキキは避妊手術＆歯石取りの事前診察。\nチビーは爪切り。\nマロンの肝臓の数値はかなり減っていた。 食べても吐かないし、見た目も健康そうなので薬をしばらくもらって様子見ということに。\nキキは特に異常なさそう。おなかやおっぱいにしこりもない。 歯石も言うほどひどくはないとの事。 まあ、以前歯磨きしてるときにごっそり取れたのだけど。はじめは歯が取れたのかと思ってビックリしたけど。 日程は2週間後ということにした。\nチビーは目が多少気になったようだが、ひどいわけではないので様子見。 痒がったりするようなら目薬を処方するということで、今回は何もなし。爪だけを切ってもらった。 慣れれば自分でもできるということだが、動くので指ごと切りそうで怖いのでいつもお願いしているのだ。\n","date":"2004-09-29T13:29:44+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/132944/","title":"一家総出"},{"content":"本日はジョリーパスタへ。 フォカッチャのチーズフォンデュが美味しかった。 たぶん、チーズフォンデュは初めて食べるのだが、チーズがかなり美味しかった。 あとは、サラダとペペロンチーノ。\n食べている途中で雷が来た。 食べ終わる頃には大雨。 まあ大変。\n","date":"2004-09-29T13:24:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/132407/","title":"パスタ＆チーズフォンデュ"},{"content":"過半数の店で盲導犬、拒否　補助犬法の完全施行後も\n犬を飼っている身だからそう思うのかもしれないけど、ちょっとショックだ。 飲食店が断る理由はわからなくもないけど、タクシーが断るなんて。\n訓練された犬のほうが、しつけのなっていない子供よりましだと思うけど。\n","date":"2004-09-29T03:56:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/035603/","title":"なんでだろう？"},{"content":"「こうさぎ」が「こうげき」に見えた。 微妙。\n","date":"2004-09-29T03:52:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/035255/","title":"大した事ではないのだが"},{"content":"何気なく書く分には「Convert Line Breaks」は便利。\nただ、エントリーにタグを使う時（特にソースを書く時）は困る。\nかといって「なし」にすると結構面倒くさい。\nこういう時にソースを触りたくなるのだが…。\n","date":"2004-09-29T02:16:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/021629/","title":"「Convert Line Breaks」の表裏"},{"content":"やっぱ矢印「-\u0026gt;」でしょう。 OOPの導入テキストでは、「bless」がよく出てくるけど、実際に作る時はほとんど使わないので。 矢印をどんどん増やしたくて、以前は、\n1 my $cgi = new CGI; とかやっていたのが、最近は、\n1 my $cgi = CGI-\u0026gt;new; とやっている。\n","date":"2004-09-29T01:54:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/29/015415/","title":"PerlでOOPをしているなぁと思う瞬間"},{"content":"ピザハットで。 ベーコンマッシュルームとデラックスのハーフアンドハーフで、生地はソーセージチーズクラストだ。 今なら6種のチーズが無料です。たぶん。\n","date":"2004-09-28T16:39:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/163907/","title":"本日はピザなり"},{"content":"寄ったサイトで偶然見つけた。 自動投稿が面白くて興味があったので早速付けてみたというわけだ。\n早速投稿があった。\n","date":"2004-09-28T14:46:21+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/144621/","title":"「こうさぎ」導入"},{"content":"当然データとしては持っているわけですよね。 \u0026lt; 送信された先\n","date":"2004-09-28T14:41:33+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/144133/","title":"というわけで実装しました"},{"content":"KINGO WEBlog: リーセントトラックバックの表示\n帰ったら早速試してみよう。 …というか、さっさと帰ろう。\n","date":"2004-09-28T11:57:36+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/115736/","title":"よその羨ましい機能を盗め！"},{"content":"てすと\n…気のせいでした。\nさっきの記事を書いた時、トラックバックを設定しなかったと思ったのにpingを送っていたので。\n…いや、やはり気のせいではない！ リンクの中に、MT(など？)のブログのアドレスがあると解釈できればトラックバックを送るようです。 なかなかすごい機能ですね。\n","date":"2004-09-28T11:22:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/112207/","title":"トラックバックの別のやり方？"},{"content":" CGI::Sessionの、期限切れのセッションをお掃除する:raindrop::knowledge - frog.raindrop.jp Perlモジュール/Walrus::Session::Lite - CGIのセッションデータを保持するための簡易なモジュールです。 ","date":"2004-09-28T10:41:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/104100/","title":"CGI::Session関連リンク"},{"content":"頭がごちゃごちゃしてきたので、頭の整理も兼ねて書いてみる。\nCGIでセッション管理を行うのは少々面倒くさいので、CGI::Sessionモジュールを使ってやる。 セッションを読み込むのは、CGIオブジェクトをCGI::Sessionに渡してやるだけ。\n1 2 my $cgi = CGI-\u0026gt;new; my $session = CGI::Session-\u0026gt;new(\u0026#34;dr:MySQL\u0026#34;, $cgi, {Handle =\u0026gt; $dbh}); もし、読み込めなければ、新しくセッションを作ることになる。 読み込まれた（または新しく作られた）セッションはcookieかformに保存してやる。 どちらに保存しても、CGIオブジェクトを渡せば取得できる。 鍵になる名前は決まっているけど、nameメソッドを使ってやったほうが確実。\n1 2 3 4 5 6 7 8 9 10 $cgi-\u0026gt;append( -name =\u0026gt; \u0026#39;new_cookie\u0026#39;, -value =\u0026gt; [ $cgi-\u0026gt;cookie( -name =\u0026gt; $session-\u0026gt;name, -value =\u0026gt; $session-\u0026gt;id, -expires =\u0026gt; \u0026#39;+28d\u0026#39;, ), ], ); CGI.pmのメソッドであるappendを使っているのは、あとでまとめてcookieを保存させるため。 出力する時は以下のような感じにする。\n1 2 3 print $cgi-\u0026gt;header( -cookie =\u0026gt; [$cgi-\u0026gt;param(\u0026#34;new_cookie\u0026#34;)], ); 話を戻す。 CGIオブジェクトから取得できた時点で、CGI::Sessionによってデータの照合が行われる。 セッションに何らかの情報を保存していて、その情報が取得できれば認証できたということ。 得られなければ新しく作られたか、認証に失敗したという事になる。\nセッションの実体はサーバー側にある。 先の例の場合は、MySQLというデータベースにセッションの情報を保管している。 クライアントとのやりとりはIDだけ。 IDは少なくともサーバー側でユニークなので、他の人のデータになってしまうことはまずない。 これに加えて、IP情報と一緒に管理する方法もある。\n1 use CGI::Session qw(-ip_match); チュートリアルなどには\u0026quot;-ip-matchスイッチ\u0026quot;と書いてあるのだが、ソースを見ると\u0026quot;-ip_match\u0026quot;が正しい。 IDが同じでIPアドレスが違うという状況でテストしたら、サーバーに保管してあるセッション情報が削除された。 つまり、IDを何らかの方法で知ったとしても、IPアドレスが違うため使用できない、という事が確認できた。\n逆に、IPアドレスが同じで違うIDの場合は、サーバー側にIDが貯まっていく。 セッションを削除せずに新しいIDを発行するとどんどん増えていく。 元々、多重登録を防止するため、アクティブなIPアドレスは一つしかセッションを持てないような仕組みにしていた。 IP情報と一緒に管理する、というのを見て乗り換えたつもりだったのだがそこだけが失敗。\n","date":"2004-09-28T10:16:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/101617/","title":"CGI::Sessionを使ってみる"},{"content":"プレイヤーの判別（認証処理）。 プレイヤーのデータから、キャラクターなど必要な情報を呼び出す（データロード）。 あれこれ処理（作業）。 キャラクターなどのデータが変更されていれば保存（データセーブ）。 次回のプレイヤー判別のための処理。\n…これくらいか？\n","date":"2004-09-28T09:27:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/092759/","title":"認証を含んだ処理の手順"},{"content":"それは昨日。 一昨日は夜遅かったので、ゴミをまとめていなかった。 で、昨日の朝は時間ギリギリだったからゴミをまとめる時間もなくそのまま出社。\n帰ったらそのままだった。 まあ、たまにはそんなこともある。\n","date":"2004-09-28T06:55:25+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/065525/","title":"ゴミの日"},{"content":"リンクを変更するたびに全部のテンプレートを修正するのは面倒なので、テンプレート・モジュールを使って楽にしてみる。\nまずは、テンプレート・モジュールを新規作成。 名前を「Links」にして登録する。 で欲しい場所に以下のように書く。\n1 \u0026lt;$MTInclude module=\u0026#34;Links\u0026#34; $\u0026gt; テンプレート・モジュールの中でもMTタグが使えるのでどんどんモジュールを増やした。 右側にあるLinksから下は全部モジュールだ。\n","date":"2004-09-28T05:47:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/28/054704/","title":"テンプレート・モジュールを使う"},{"content":"WOR0荒野の野望 [narinariclub]で改造担当というか副管理やってます。\nきっかけは、私が不正をしたことからなんですがね（ぉ 今では中身を知っている私でも不正をするのは面倒なくらいのものにはなりました。\n","date":"2004-09-27T13:25:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/132530/","title":"The Wars of Roses"},{"content":"炸芝麻蝦（ザァチィマァシァ） とおそば。\n後者から攻めていったせいで、大量にあった前者が残ってしまった。\n","date":"2004-09-27T11:45:41+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/114541/","title":"晩御飯"},{"content":"ピアノ講座のあと、みっちゃんを駅まで送っていった。 そのあと、また別の友達の家へ押しかけていった。\n妻とO夫人が中学（だっけ？）からの仲良しさん。 O夫妻には結婚前から夫婦共々お世話になっている。\nつい話しこんで、気がついたら日付が変わっていた。 オレは最後のほうは眠気と空腹でダウン気味。\nで、帰りに近くの天一（淡路店）へ（好きだねぇ）。当然こってり。 ネギが多く、にんにくはきざんだヤツを盛り付けていた。オレは結構好きかも。 が、妻はネギをいやがっていた。\n「にんにくはおろしたヤツよりもきざんだヤツのほうがよく効く。」 というようなセリフを思い出した。 食べたあとはそんなに感じなかったのだが、今朝になってかなりにんにく臭を発している事に気づいた。 きざみにんにくはなかなか侮れない。\n味は悪くなかった。というか、普通に美味しかった。 が、時間帯のせいか場所柄のせいか、怪しい人たちもいて落ち着かなかったのが残念。\n","date":"2004-09-27T05:22:42+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/052242/","title":"深夜の天一"},{"content":"公式サイト\nカバーばかり目立っていてあまり好きではなかったのだが「Perseus-ペルセウス-(CCCD)」や「Viola (CCCD)」を聴いてからはあまりこだわらなくなった。\nPerseus-ペルセウス-(CCCD) どこがどう好きなのかよくわからないけど好きな曲。\nViola (CCCD) 胡弓（二胡）と思われる音色が奏でるアジアっぽい雰囲気が好き。\n","date":"2004-09-27T04:39:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/043937/","title":"島谷ひとみ （しまたに ひとみ）"},{"content":"公式サイト\n知ったのは大分前。妹がアルバム「BLUE BLOOD」を買ったのがきっかけだろうか。多感な時期に聴いていたアルバム「Jealousy」は、オレに多くの影響を与えたことだろう。 どのあたりから「JAPAN」が付いたのかはよくわからない。\nSilent Jealousy アルバムで「Es Durのピアノ線」から続くのが最高に良い。この時ばかりは、アルバムをランダム再生する人の気持ちがわからない。…やったけど。間奏がとてもとても好き。\nRUSTY NAIL 初めて聴いた時、この曲をずっと知らなかった、という事にショックを受けた曲。知ってからは（平均すれば）毎日1回以上は聴いている。\n","date":"2004-09-27T03:31:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/033110/","title":"X JAPAN （えっくす じゃぱん）"},{"content":"公式サイト\n知ったのはいつだろう。「Paradox」という曲に反応した。しかし、どこでどう反応したかは覚えてない。\nParadox 特に好きなのはサビ。サビを聴いていると、「胸が締め付けられるような感じ」がする。それがたまらなく好き。同じ事を書いているようだが、結局のところ「好みは昔から変わってない」ということなのだろう。\n","date":"2004-09-27T03:30:03+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/033003/","title":"浜田麻里 （はまだ まり）"},{"content":"公式サイト\nたぶん発売当時だろうから1998年12月頃なんだろうな。仕事で車に乗っていた時にFMで「Automatic」がよく流れていた。\nAutomatic 作詞作曲とは聞いていたが、年齢を聞いて驚いた。「身体が自動的に反応する」とかって15,6歳で言えるのかな?って。その辺も含めて歌詞が特に好き。\nSAKURAドロップス まずシングルのジャケットが好き。そしてPVが好き。んで曲が好き。特にサビと間奏のメロディと音色がたまらなく好き。\n","date":"2004-09-27T03:28:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/032830/","title":"宇多田ヒカル （うただ ひかる）"},{"content":"公式サイト\n2001年11月頃の話。化粧品（？）のCMソングになっていた「Bloomin\u0026rsquo;!」に反応した。気になっていたのだが曲名を知ったのは12月に入ってからだった。\nBloomin’!\nサビのキラキラ感（？）が好き。曲がどうこうというよりも、音色の使われ方が好きなのかも？\n","date":"2004-09-27T03:27:23+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/032723/","title":"Tommy February6 （とみー ふぇぶらりー）"},{"content":"公式サイト\nPS2のソフト「プロジェクト・ミネルヴァ」のCMで使われていた曲「VALENTI」に反応した。\nVALENTI サビの前の一群（普通に言えばたぶんBメロ）が好き。サビも好きだが、サビに繋がるこの部分がこの曲の要だと勝手に思っている。PVもカッコいい。動きが激しすぎて大変そうだが。\n","date":"2004-09-27T03:20:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/032058/","title":"BoA （ぼあ）"},{"content":"公式サイト\n2003年1月頃からよく聴くようになった「もらい泣き」に反応した。\nもらい泣き サビのコード進行と歌声とがあわさって「切なさ爆裂な感じ」なのがかなり好き。\n","date":"2004-09-27T03:13:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/031347/","title":"一青窈 （ひとと よう）"},{"content":"公式サイト\n2003年1月下旬頃の話。番組名は忘れたが、深夜帯の音楽番組で紹介されていた「車線変更25時」に反応した。\n車線変更25時 サビのリズム感（？）が好き。音域が広くなさそうなので「カラオケで歌えそうな曲だな?」っていう邪な気持ちもある。\n二人のアカボシ 駆け落ちな二人の行方が気になって仕方がない曲。サビへいく部分が特に好き。\n","date":"2004-09-27T03:12:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/031226/","title":"キンモクセイ （きんもくせい）"},{"content":"公式サイト\n2003年1月下旬頃の話。番組名は忘れた（というか知らない）が、深夜帯の音楽番組で紹介されていた「CHANGE THE WORLD」に反応した。曲もそうだが、歌声に魅了された。\nCHANGE THE WORLD 病的にサビが好き。うまく言葉にできないが、メロディの「胸が締め付けられるような感じ」が、もの凄く好き。たぶん「変わらなくてはいけない！」っていう感覚になってるんだと思う。そして、それを味わうのがクセになってる。アルバム「It’s a wonderful feeling」の1曲目だ。 あとシングルのジャケットも好き。ヴォーカルの松田さんが凄くきれいなんだ。これを見たおかげで、より深みにハマったのは間違いない。\nFLOWER アルバム「It’s a wonderful feeling」の2曲目だ。アルバムを聴いているうちに、どんどん好きになっていった曲。 サビの最後が好き。すべてがそこへ収束していくような感覚。アジアンチックな楽器の音色も好きだな。\nIt’s a wonderful feeling RAMJET PULLEY GIZA (2003/01/29) 売り上げランキング: 109194\nおすすめ度の平均: 子守唄には良いかも\nAmazon.co.jp で詳細を見る\n","date":"2004-09-27T03:11:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/031130/","title":"RAMJET PULLEY （らむじぇっと ぷーりー）"},{"content":"過去に書いたことだけど、遡らずに書いてみる。\n当時の内容\nサントリー和茶（公式情報によると2003年3月11日発売開始）のCM。というか、お茶はどうでも良くて。登場する女の子、於保佐代子ちゃん。\nかわいいよねえ。うん。かわいいよ。初めてCM見たときに、思わず「誰？」と訊いてしまった。で、CM見るたびに「『ネットで調べればいい』ことに気づくのだが、すぐ忘れる」というのを繰り返し、ようやく4月になって調べることを達成。操作時間わずか20秒。長い道のりであった…。\nまだまだ謎の人物らしく、オフィシャル（？）以外にこれといった情報はないようだ。google検索で23件（2003/04/02現在）しか見つからない。\nいつの間にか、和茶のページでCMのストリーミングが開始されていた。長編のCMは初めて見た…。髪をかきあげる仕草が良いね。（2003/04/15）\n於保佐代子ファースト写真集\n根本 好伸 朝日出版社 売り上げランキング: 278176\nおすすめ度の平均: ★★★★☆ ★★★★★ 4.5 ★★★☆☆ ちょっと残念 ★★★★★ サントリー「和茶」の美少女\nAmazon.co.jp で詳細を見る\nCMのワンシーン\n","date":"2004-09-27T03:10:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/031000/","title":"於保 佐代子 （おほ さよこ）"},{"content":"簡単に紹介してみます。\n飼った順序で。\nミニー 性別：女 種類：（ハムスター）ジャンガリアン 色：プディング 現在：宝塚霊園で眠っています リッキー 性別：男 種類：（ハムスター）ジャンガリアン 色：プディング 現在：宝塚霊園で眠っています マロン 性別：男 種類：（犬）ミニチュアダックスフンド 色：レッド 現在：肝臓（詳細不明）と耳（外耳炎）を患っています チビー 性別：男 種類：（ハムスター）ジャンガリアン 色：ブルーサファイア 現在：左目が開きづらい（目やに？）ような感じ キキ 性別：女 種類：（犬）パピヨン 色：トライ 現在：歯石が多いので避妊手術と同時に取ってもらう計画中 ","date":"2004-09-27T02:45:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/024540/","title":"我が家の動物たち"},{"content":"結構完璧主義っぽい所があって、Perlを使うようになってから「自分用のCGIは自分で作る」をモットーとしていた。 しかし、ついに挫折、というか、ようやく受け入れられるようになった。\n実際には、日本語変換や画像のサイズ取得など、お世話になっているモジュールやライブラリはあるのだけど。 なんと言うか、気分的に解放されたと言うかそういう雰囲気（謎） モジュールの使い方をマスターする時間のほうが、作ってデバッグしてメンテナンスする時間よりもはるかに短いという事が、メリットとして自分自身の中で折り合いがついたのだろう。\nそうなってしまうと吹っ切れるもので、CGI.pmやHTML::Templateなど、今まで手を出さなかったモジュールにも手を出すようになった。 使ってみると、何故使わなかったのか不思議なくらい便利だ。\n","date":"2004-09-27T01:52:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/27/015217/","title":"完璧主義と路線変更"},{"content":"CGI.pmもXHTMLだったが、Movable Typeもそうなのだ。 時代はXMLなのだろうか？\n","date":"2004-09-26T07:48:58+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/26/074858/","title":"標準はXML(XHTML)？"},{"content":"今のところ健康そうに見える。 本当に肝臓が変なのか?と思うほどに。\n","date":"2004-09-26T07:43:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/26/074322/","title":"マロンの状態"},{"content":"今日は妻の友達と会うために武庫川へ。 当然車で。\n妻の元バンド仲間で、みっちゃん(♂)という。 ベーシストらしいのだが、実は鍵盤系がやりたかったらしく、ピアノを習いたいと言う話になって、じゃあ家で習うというような話に発展。 強引(?)に連れて帰ってきた。\nで、今ピアノ講座体験中。\n","date":"2004-09-26T07:21:55+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/26/072155/","title":"ピアノ講座？"},{"content":"行ってきました。日帰りというか、本当に行って帰ってきただけ。\n家を出たのは15時くらい。 まろん隊長とキキ隊員を連れて。\n途中、目的のひとつでもある水無瀬のDogCafe Wanで休憩。 犬を遊ばせる場所がある喫茶店というか、そういう店。\n一時間半くらい遊んで再出発。\n19時くらいに最終目的地に到着。 チャーハンセットを食べた。妻はスープライスセット。 箕面にある天一と比べると、スープが結構違うことに気づいた。 本店のスープは雑味が少ない気がする。\nで、帰りは1号線を通って約2時間。 日帰りラーメン紀行でした。\n","date":"2004-09-25T14:20:12+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/25/142012/","title":"天下一品総本店"},{"content":"テンプレートの中でも、スタイルシートはまだわかる。 が、テンプレートのテンプレートで表示したいもの（例えばカテゴリーとか）をどうやって表示するのかが、マニュアルを読んでもいまいちぴんと来ない。\n結局検索して、参考になりそうなサイトを二つほど。 ・プロが教えるMovable Typeの構造デザイン ・HINAGATA\nまあ、そんなに深く探したわけじゃないけど。\nまず、最初のサイト（というか記事）ですが。 多少なりともStrictなHTMLを目指して、StyleSheetの機能的デザインを考えたことがあるので、主旨はよくわかりました。 特に私の場合、IDに依存するスタイルシートは好きではないので。\nただ、テンプレートが「Main Index」の分しかないので、他の分まで考える必要がありました。 あと、記事が少々古いので現在のVer3.xに対応しているのかもわかりません。 もしも、時間ができたら参考にしたいなと、いうことでリストアップ。\nで、次のサイト。 ここには、すべてのテンプレートが用意されていました。しかも、Ver3.xに対応していました。 さらに、skinも用意されていました。 手軽さで即採用決定。\n","date":"2004-09-24T19:36:28+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/193628/","title":"テンプレートのテンプレート"},{"content":"少しの間、試行錯誤してみた結果そういう結論に達した。\nというわけで、開発系のものはWikiの方にリンクを張るだけにした。\n","date":"2004-09-24T18:15:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/181504/","title":"Wikiを併用したほうが楽だった"},{"content":"かわいい系チャットを書いた\n","date":"2004-09-24T18:09:22+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/180922/","title":"NANO-Chat"},{"content":"見た目は普通の掲示板\n配布・説明\n","date":"2004-09-24T18:06:31+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/180631/","title":"Incomprehensible Bulletin Board System"},{"content":"Cryptを拡張し最大32文字までを判別するモジュールを書いた\n","date":"2004-09-24T17:45:18+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/174518/","title":"LargeCrypt"},{"content":"（大体の）作業時間を表示するモジュール\n配布・説明\n","date":"2004-09-24T17:27:26+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/172726/","title":"Cost"},{"content":"昨日の深夜にマロンが吐いた。\nうんちを食べたりすると、時々吐くのだ。 いつもの事だろうと思っていたら、吐いた後、痛そうに鳴いて（泣いて？）いた。\n横にしてやるといくらか楽そうにしていたが、今度はしっぽに変に力が入っていた。 変だなと思ってしっぽの根元部分を見てみると、肛門が開いた状態になっていて、うんちが見えていた。 軽くマッサージをしてやると、（力を抜いているように見えるのに）どんどん出てきて。\nこいつは大変だと箕面にある救急病院に連れていった。\n血液検査の結果、肝臓関係の数値に異常があった。 あと、胃の中に異物（留守中に何か食べたか？）があるようだと。 嘔吐したのはその異物にも原因があるかもしれないということだ。\nそして、今日、かかりつけのクウ動物病院に行ってきた。 しばらく様子を見て、異物が取れないようなら開腹手術が必要だといわれた。 あと、肝臓のための内服薬をもらってきた。\nちゃんと取れてくれればいいのだけど…。\n","date":"2004-09-24T11:27:34+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/112734/","title":"マロン危機一髪！？"},{"content":"少しだけ移行していたのだが、路線変更のため再度移行することにした。 しばらくは移行しかけていたコンテンツをご覧ください。\n","date":"2004-09-24T05:26:53+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/24/052653/","title":"移行していたコンテンツ"},{"content":"http://www.movabletype.jp http://rebecca.ac/milano/install/\n最初は英語版にしようと思っていたのだが、あっけなく挫折。\n","date":"2004-09-23T01:55:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/23/015535/","title":"参考にしたところとか"},{"content":"過去の記事にトラックバック。 これでいいのかな？\n","date":"2004-09-23T01:21:54+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/23/012154/","title":"トラックバックのテスト"},{"content":"今 一 度 テ ス ト 。 今 度 は 縦 長 に し て み る 。\n","date":"2004-09-23T01:09:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/23/010945/","title":"日本語テスト2"},{"content":"日本語タイトルでのテスト\n","date":"2004-09-23T01:05:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/23/010545/","title":"日本語テスト"},{"content":"test テスト てすと\nglucoseを使って投稿してみるてすと。 作成日時のチェックをはずしてみた。\n","date":"2004-09-23T00:58:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2004/09/23/005800/","title":"TEST"},{"content":"コンピューターというのは、基本的にデジタル処理（1と0、ONとOFFなど）しかできないので、文字の形をそのまま覚えるとかなりの容量が必要になる。それで、容量を減らすために文字に番号をつけて覚えておいて、番号を復元することで文字として読めるようになっている。その番号の付け方が、日本語なら「SJIS」や「EUC」、「JIS」などという規格で決められているので、「SJIS」として記録してるデータは「SJIS」で復元しないと意味不明な記号の羅列に見えてしまう。\nまあ、その辺の詳しい（もしくは、正確な）事は「文字コード」とか「漢字コード」で検索すればいろいろと見つかるでしょう。2つほどあげれば、「日本語と文字コード」や「文字コードの話」などでしょうか。\n結局何が言いたいかというと、フォームから送信されたデータで「%」がついてる（例えば「%82%A0%82%A2%82%A4%82%A6%82%A8」のような）ものは、URLに使えない（使うのを推奨されていない）文字の「文字コードを“%”付の文字列に変換」した結果、だという事。「フォームからの入力」で意味不明な状態で使っていた「pack()」の命令は、「“%”付の文字列を文字コードに変換」している作業だ。\n・・・なんか、前置きが長くなったかも・・・。\nで、今回やりたかったのは、「文字←→文字コード」の変換。でも、Perlにはそれ専用の関数があったりする。「文字→文字コード」にするのが「ord()」で、「文字コード→文字」にするのが「chr()」だ。ただ「ord()」は1バイト分しか変換できないようで、複数の文字とか全角をいれると最初の1バイトだけを変換して返すようだ。配列で受けてもデータが1個しかない。\nところで、1バイトというのは8ビット、つまり、8桁の2進数の事で、256個の情報を区別する事ができる。8桁の2進数は16進数で表すと2桁になる。人間でもこの変換は比較的簡単なので、この手のデータの表現には16進数を使う事が多い。\n01011010 → 0101 1010 → 80+41+20+11 81+40+21+10 → 5 A(10) → 5A むぅ。なんか話がずれてる・・・。\nで、結局何かというと、「ord()」を使うなら1バイトずつ区切る必要があるということ。そして、1バイト毎にデータ化するなら16進数が便利ということ。\nただ、「ord()」は数値で返ってくるので、16進数に変換する必要がある。そして「chr()」は数値に変換してやらなくてはいけない。しかも、それぞれ1バイトずつなのでループが大変・・・。\n実は「unpack()」や「pack()」の添え字（？）に「H」を使う事で「文字コードを16進数の文字列に変換する（またはその逆）」ことができる。これらは1バイトずつ区切らなくてもいいので、全体を変換するのはとても簡単。\n・・・まあ、最終的にはこれが書きたかったんだけど、すごくまわりくどい書き方になった。\nこの「pack()」の添え字「H」を使う方法は「Perlメモ」の「URIエスケープ・アンエスケープする」を見て知りました。他にもいろんな事が書いてあります。しかも実用的なコードでまとめられているので応用も簡単にできます。もし知らなかったのなら行ってみましょう。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); # $|=1; #} $usr_title = \u0026#39;テスト32\u0026#39;; $tgCode = ord(\u0026#39;漢\u0026#39;); if($tgCode == 0x8a){ $usr_outcode = \u0026#39;sjis\u0026#39;; }elsif($tgCode == 0xb4){ $usr_outcode = \u0026#39;euc\u0026#39;; } require \u0026#34;./tsenv.pl\u0026#34;; { printHeader($usr_title); printBodyHeader(\u0026#39;文字←→文字コード\u0026#39;); # チェックする文字 @checkStrs = (\u0026#39;a\u0026#39;, \u0026#39;A\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;@\u0026#39;, \u0026#39;\\\\\u0026#39;, \u0026#39;}\u0026#39;, \u0026#39;[ ]\u0026#39;, \u0026#39;あ\u0026#39;); # 1文字変換 Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;table border=1\u0026gt; \u0026lt;caption\u0026gt;ord() \u0026amp;amp; chr()\u0026lt;/caption\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th rowspan=2\u0026gt;文字 \u0026lt;th rowspan=2\u0026gt;→ \u0026lt;th colspan=5\u0026gt;文字コード \u0026lt;th rowspan=2\u0026gt;→ \u0026lt;th rowspan=2\u0026gt;文字 \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;10進数 \u0026lt;th\u0026gt;→ \u0026lt;th\u0026gt;16進数 \u0026lt;th\u0026gt;→ \u0026lt;th\u0026gt;10進数 \u0026lt;/tr\u0026gt; EOM foreach(@checkStrs){ my $dOrd = ord(); my $hOrd = sprintf(\u0026#34;%x\u0026#34;, $dOrd); my $dhOrd = hex($hOrd); my $dChr = chr($dhOrd); print \u0026lt;\u0026lt;EOM; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;$_ \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$dOrd \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$hOrd \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$dhOrd \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$dChr \u0026lt;/tr\u0026gt; EOM } Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;/table\u0026gt; EOM # 一括変換その2 push @checkStrs, \u0026#39;漢字\u0026#39;, \u0026#39;Nobu3\u0026#39;, \u0026#39;!\u0026#34;#()=~\u0026#39;; Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;table border=1\u0026gt; \u0026lt;caption\u0026gt;unpack(H*) \u0026amp;amp; pack(H*)\u0026lt;/caption\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;文字 \u0026lt;th\u0026gt;→ \u0026lt;th\u0026gt;文字コード \u0026lt;th\u0026gt;→ \u0026lt;th\u0026gt;文字 \u0026lt;/tr\u0026gt; EOM foreach(@checkStrs){ my $hunpack = unpack(\u0026#34;H*\u0026#34;, $_); my $hpack = pack(\u0026#34;H*\u0026#34;, $hunpack); print \u0026lt;\u0026lt;EOM; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;$_ \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$hunpack \u0026lt;td\u0026gt; \u0026lt;td\u0026gt;$hpack \u0026lt;/tr\u0026gt; EOM } Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;/table\u0026gt; EOM printFooter(); exit(0); } ","date":"2000-10-07T14:13:37+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/141337/","title":"文字と文字コード"},{"content":"定番といえば定番ですが、「乱数はどのくらい乱数なのか」です。タイトルを「何処かで見たな\u0026hellip;」と思った人は、なかなか通です（笑）\n基本的にコンピューターが作成する乱数というのは、ある意味では規則的なものです。たぶん。どのような規則なのかは、さっぱりわかりませんけど。\nJavaScriptの時と同じように、「発生する値の分布」を調べてみました。それだけでは面白くなかったので、今回は「似たような値が連続して発生しないか」も調べてみました。ついでに（というか一度やってみたかったので）、結果を見やすくするため、出力をグラフにしてみました。\n前者については、ほぼ均等に発生するようです。データ数が多いほどばらつきが少なくなります。\n大量発生させるには不安が多いので、ローカルで試した「1,048,576回」の結果を載せておきます。ちなみに、画像は「png形式」です。一度使ってみたかったので\u0026hellip;。\nで、後者ですが、なかなか面白い結果になりました。\nこの結果をどう見ます？\nと、思ったところで、「差」ではなく「どう動いたか」を見ることにしました。画面からはみ出るので「比率」は表示してませんが、以下の画像がその結果です。\n三角ですね（笑）\nやってみれば、「あ、そうか」という感じですが、まさかこんな結果になるとは思いませんでした。JavaScriptでも試してみる価値はあるかもしれません。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; #} $usr_title = \u0026#39;テスト31\u0026#39;; require \u0026#34;tsenv.pl\u0026#34;; $G_image = \u0026#34;/x/nobu3/images/blue1.gif\u0026#34;; { printHeader($usr_title); printBodyHeader(\u0026#39;\u0026lt;font face=times\u0026gt;Random Test\u0026lt;/font\u0026gt;\u0026#39;); srand(time()^($$+($$\u0026lt;\u0026lt;15))); randomTest(10, 2**4); randomTest(10, 2**8); randomTest(10, 2**12); printFooter(); exit(0); } sub randomTest{ my($len, $loopTimes) = @_; my @value = (); # 発生値格納用 my @near = (); # 発生値差格納用 my $winH = 150; # 縦棒グラフの最大高さ my $eleW = 40; # 縦棒グラフの各棒の幅 my $winW = 400; # 横棒グラフの最大長さ my $eleH = 20; # 横棒グラフの各棒の幅 # 配列初期化（無くても動くけど...） for($i=0;$i\u0026lt;$len;$i++){ $value[$i] = 0; $near[$i]-\u0026gt;[0] = 0; } # 移動値用（上に同じ） # for($i=$len;$i\u0026lt;$len*2-1;$i++){ # $near[$i]-\u0026gt;[0] = 0; # } # 乱数発生 # 1回目例外処理 my $lst = int(rand(scalar(@value))); # 発生値比較用 $value[$lst]++; # 2回目以降処理 for($i=1;$i\u0026lt;$loopTimes;$i++){ my $now = int(rand(scalar(@value))); $value[$now]++; $near[abs($now-$lst)]-\u0026gt;[0]++; # 前回との差をカウント # $near[$now-$lst+$len-1]-\u0026gt;[0]++; # 前回との移動値をカウント $lst = $now; } # 最小値、最大値 my($min, $max) = ($loopTimes, 0);# 最小値、最大値初期化 foreach(@value){ $min = $_ if($_ \u0026lt; $min); $max = $_ if($max \u0026lt; $_); } # 書式設定 my $ws = $max / ($winW - 10); # 横グラフ表示用 my $loopTimesN = divideNum($loopTimes); my $dif = $max - $min; my $difN = divideNum($dif); my $difP = sprintf \u0026#34;%.2f%%\u0026#34;, $dif / $loopTimes * 100; my $maxN = divideNum($max); my $maxP = sprintf \u0026#34;%.2f%%\u0026#34;, $max / $loopTimes * 100; my $minN = divideNum($min); my $minP = sprintf \u0026#34;%.2f%%\u0026#34;, $min / $loopTimes * 100; foreach(@near){ $_-\u0026gt;[1] = divideNum($_-\u0026gt;[0]); $_-\u0026gt;[2] = sprintf \u0026#34;%.2f%%\u0026#34;, $_-\u0026gt;[0] / $loopTimes * 100; } # まとめの出力 Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;div class=box1\u0026gt; \u0026lt;strong\u0026gt;データ数：$loopTimesN\u0026lt;/strong\u0026gt; \u0026lt;table border=1\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;最大値\u0026lt;td align=right\u0026gt;$maxN\u0026lt;td align=right\u0026gt;$maxP \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;最小値\u0026lt;td align=right\u0026gt;$minN\u0026lt;td align=right\u0026gt;$minP \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;誤　差\u0026lt;td align=right\u0026gt;$difN\u0026lt;td align=right\u0026gt;$difP \u0026lt;/table\u0026gt; \u0026lt;br\u0026gt; EOM # 各項目の出力 Jprint(\u0026lt;\u0026lt;EOM); \u0026lt;table border=1\u0026gt; \u0026lt;caption\u0026gt;値の発生回数と比率\u0026lt;/caption\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;発生値 \u0026lt;th width=$winW\u0026gt;カウント数 \u0026lt;th\u0026gt;比率 \u0026lt;th\u0026gt;備考 EOM my $cnt = 0; foreach(@value){ my $w = int($_ / $ws); # グラフ巾決定 my $n = divideNum($_); # カウント数 my $p = sprintf(\u0026#34;%.2f%%\u0026#34;, $_ / $loopTimes * 100); # 比率 print \u0026lt;\u0026lt;EOM; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;$cnt\u0026lt;td\u0026gt; \u0026lt;img src=\u0026#34;$G_image\u0026#34; width=$w height=$eleH alt=\u0026#34;$n\u0026#34;\u0026gt;\u0026lt;td align=right\u0026gt; $p\u0026lt;td\u0026gt; EOM if($min == $_){ Jprint(\u0026#39;最小\u0026#39;); }elsif($max == $_){ Jprint(\u0026#39;最大\u0026#39;); }else{ print \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } print \u0026#34;n\u0026#34;; $cnt++; } print \u0026#34;\u0026lt;/table\u0026gt;nn\u0026lt;br\u0026gt;nn\u0026#34;; # 発生値差 print \u0026#34;\u0026lt;table border=1\u0026gt;n\u0026#34;; Jprint(\u0026#34;\u0026lt;caption\u0026gt;前回の発生値との差\u0026lt;/caption\u0026gt;n\u0026lt;tr\u0026gt;n\u0026#34;); my $nearmax = 0; foreach(@near){ $nearmax = $_-\u0026gt;[0] if $nearmax \u0026lt; $_-\u0026gt;[0]; } my $hs = $nearmax / ($winH - 10); Jprint(\u0026#34;\u0026lt;th height=$winH\u0026gt;カウント数\u0026#34;); foreach(@near){ my $h = int($_-\u0026gt;[0] / $hs); print qq(\u0026lt;td valign=bottom align=center\u0026gt;\u0026lt;img src=\u0026#34;$G_image\u0026#34; width=$eleW height=$h alt=\u0026#34;$_-\u0026gt;[1]\u0026#34;\u0026gt;); } Jprint(\u0026#34;\u0026lt;tr\u0026gt;n\u0026lt;th\u0026gt;前回との差\u0026#34;); for($i=0;$i\u0026lt;$len;$i++){ print \u0026#34;\u0026lt;th\u0026gt;$i\u0026#34; } # 移動値用 # for($i=-($len-1);$i\u0026lt;$len;$i++){ print \u0026#34;\u0026lt;th\u0026gt;$i\u0026#34; } Jprint(\u0026#34;n\u0026lt;tr\u0026gt;n\u0026lt;th\u0026gt;比率\u0026#34;); print \u0026#34;\u0026lt;td align=right\u0026gt;$_-\u0026gt;[2]\u0026#34; foreach(@near); print \u0026#34;n\u0026lt;/table\u0026gt;nn\u0026lt;br\u0026gt;nn\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;nn\u0026#34;; } sub divideNum{ my($num) = @_; 1 while $num =~ s/(d+)(d{3})/$1,$2/; return $num; } ","date":"2000-10-07T13:57:39+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/135739/","title":"乱数の信憑性"},{"content":"掲示板を作ったのはいいけど、「経験値システム」をうまく動作させるには、「経験値」を記録しておかなくちゃいけない。\n↓\n記録を名前で判別すると、同名の人とは経験値を共有することになってしまうから、パスワードも必要になってくる。\n↓\nパスワードをそのまま保存すると、他の人に見られたときに困るから、パスワードを暗号化して記録しておこう。\nという、思考の流れで「暗号化」について考えてみた。\nPerlには「crypt」という「文字列を暗号化する」命令がある。ただ、(Win32版の仕様かもしれないけど)半角で8文字までしか認識しないようで、9文字以降の文字が違っていても結果が同じになってしまうのが難点といえば難点か。\n一般的に「暗号」というのは、「『鍵』を使って、暗号化されたものを元の文字列に戻せるもの」の事を言うのかもしれない。\n「crypt」は逆に「『鍵』を使って文字列を暗号化(別の文字列に変換)する」ものです。「同じ文字列」を、「同じ鍵」を使って変換すれば、「常に同じ値が返ってくる」ので、パスワードなんかの認証にはちょうどいい。というか、そのために作られたのかもしれないけど・・・。その「鍵」は作成された文字列の中に隠されているので、それを使って変換すれば必ず同じ文字列になる。\n「鍵」の事は「salt値」と言っているようです。その「salt値」は「2文字」で、大文字小文字アルファベットの52文字と数値の10文字、それに「.」と「/」を加えた64文字の中から選びます。試したかぎりではそれ以外でも大丈夫だけど、使わない方がいいでしょう。たぶん。\n「crypt」で変換されると「salt値」は通常は最初の2文字につく。通常でない(より高度な変換？)場合は、最初が「$1$」で、その後ろの2文字が「salt値」になる。認証するときは、「salt値」を拾って同じように変換してやる。結果が違っていれば入力されたものは正しくないということになる。\nこれを元にして「登録」「認証」を作ればとりあえず完成だ。「変更」も作れば文句無しです。さて、頑張りましょうかね(笑)\n「salt値」作成の部分で使っている「scalar()」という命令は「スカラー値」を明示的に要求する命令です。よくは知りませんが「コンテキスト」という概念が絡んでくるようです。\n例えば、「localtime()」は直接「print」すると、意味不明な数値になって表示されます(本当は配列を区切り文字なしで表示しているからで、「join()」で連結させてやればそれなりに見えます)が、「スカラー値」を要求するとそれっぽい表示形式で値を返してくれるのです。\n今の場合は、乱数の上限を制限するため「配列の個数」を要求しています。「$#char+1」とやれば済む話ですけど。この概念もなかなか奥が深そうです。\nちなみに「int()」は「整数化」。単に小数点以下を無視するようだ。\n「rand()」は乱数発生装置。これも「0以上1未満」を返すんでしょうね。たぶん。これには引数が取れるので、「rand()*100」とかやらなくても「rand(100)」で済む。好みの問題でしょうけどね。\nここからは(も？)余談的。\n世間に「crypt」が出てどのくらい経つのかわからないけど、実は「crypt」の結果から元の文字列を求めるプログラムが存在するらしい。だから暗号化したといっても、そのまま記録するのは危険なようだ。\n簡単には解読できないようにする手段として「crypt」の結果に「crypt」をかける方法が、「Web裏技」で紹介されてました。今見たら、リニューアルされたようで、見つけられませんでしたけど・・・。\nただ、「crypt」の戻り値は「salt値」2文字を含めて13文字だから、8文字までしか認識できないのがやっぱり問題かもね・・・。分割して結合するっていう手もあるけど。\nそれに、公開するスクリプトの中には「複雑暗号化」のコードを書いても意味がない。「鍵」を見せないことが「暗号」である条件なんだから・・・。\n「鍵」といえば「salt値」ですが、これを例の64文字にするのは、「『crypt』された文字列には、(経験上)その64文字が使われる」事に理由があるのではないかと思います。つまり、「crypt」の結果をそのまま使えば最初の(または「$1$」に続く)2文字ですが、それを適当な場所に埋め込んでもわからないようになってるんじゃないかと思ったわけです。解読プログラムがどういう物なのかわかりませんが、「salt値」がわからなければ多少なりとも解読が難しくなるんじゃないかな・・・と。ホントはマニュアルかなんかにお奨め方法として書いてあるのかもしれませんけどね(笑)\nでも、パスワードを管理する側がいくら頑張っても、使う側が「生年月日」とか「連続した数字」、「意味のある単語」のようなモノを使っていたり、「紙に書いて保管」したりしてると・・・簡単にばれそうで恐いです。\nここから追記(2000/12/14)\n「crypt」で暗号化された文字列の中で「salt値」が入っている場所は、今現在では間違いではないです。ただ、認証するときには「『暗号化された文字列そのもの』をsalt値の代わりに渡して、その結果が『暗号化された文字列そのもの』になるかを調べる」のが正しいようです。つまり、「crypt」が自分で「salt値」を探して暗号化するので、「salt値」がどこにあるかはスクリプトを組む上では知らなくてもいい事になります。\n簡単に認証のサンプルを書けば以下のようなものになります。\n1 2 3 4 5 6 $cryptedPW = crypt($PW, \u0026#34;xx\u0026#34;); # $PW を暗号化して $cryptedPW に格納する if( crypt($enterPW, $cryptedPW) eq $cryptedPW ){ $enterPW は $PW と同じ文字列 }else{ $enterPW は $PW と違う文字列 } この認証方法は「プログラミングPerl 改訂版(発行所／オライリー・ジャパン)」に使用方法の例として載ってる方法です。補足としてsalt値の場所の事についても書かれていますけどね・・・。\nあと、このページでは「通常でない(より高度な変換？)場合は、最初が「$1$」で、・・・」と書いてある部分は、かなりの確率で間違っています。というよりは、暗号が2種類しかないように書いている時点で確実に間違っています。ただ、現時点では間違っているという事だけしかわかりません・・・。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; #} $usr_title = \u0026#39;テスト30\u0026#39;; require \u0026#34;tsenv.pl\u0026#34;; { printHeader($usr_title); printBodyHeader(\u0026#39;\u0026lt;font face=times\u0026gt;Crypt Test\u0026lt;/font\u0026gt;\u0026#39;); # 乱数初期化 srand; crypt_test(\u0026#39;12345678\u0026#39;, \u0026#39;12345678\u0026#39;); crypt_test(\u0026#39;987654321\u0026#39;, \u0026#39;987654320\u0026#39;); crypt_test(\u0026#39;abcdefgh\u0026#39;, \u0026#39;abcdefgi\u0026#39;); new_crypt_test(\u0026#39;12345678\u0026#39;, \u0026#39;12345678\u0026#39;); new_crypt_test(\u0026#39;987654321\u0026#39;, \u0026#39;987654320\u0026#39;); new_crypt_test(\u0026#39;abcdefgh\u0026#39;, \u0026#39;abcdefgi\u0026#39;); print \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; print \u0026#34;Normal localtime : \u0026#34;; print localtime(); print \u0026#34;n\u0026#34;; print \u0026#34;Scalar localtime : \u0026#34;; print scalar(localtime()); print \u0026#34;n\u0026#34;; print \u0026#34;Expand localtime : \u0026#34;; print join(\u0026#34;, \u0026#34;, localtime()); print \u0026#34;n\u0026#34;; print \u0026#34;n\u0026#34;; print \u0026#34;int(1.5) = \u0026#34;; print int(1.5); print \u0026#34;n\u0026#34;; print \u0026#34;int(2.9) = \u0026#34;; print int(2.9); print \u0026#34;n\u0026#34;; print \u0026#34;int(-2.5) = \u0026#34;; print int(-2.5); print \u0026#34;n\u0026#34;; print \u0026#34;int(-2.9) = \u0026#34;; print int(-2.9); print \u0026#34;n\u0026#34;; print \u0026#34;int(-1.1) = \u0026#34;; print int(-1.1); print \u0026#34;n\u0026#34;; print \u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;; printFooter(); exit(0); } sub crypt_test{ my($setpass, $authpass) = @_; # 設定パスワード確認 print qq(\u0026lt;table border=1 width=\u0026#34;80%\u0026#34;\u0026gt;n\u0026lt;tr\u0026gt;n\u0026lt;td width=\u0026#34;40%\u0026#34;\u0026gt;n); Jprint(\u0026#34;設定パスワード：$setpass\u0026lt;br\u0026gt;n\u0026#34;); # salt値作成 my @char = (\u0026#34;.\u0026#34;, \u0026#34;/\u0026#34;, \u0026#34;0\u0026#34;..\u0026#34;9\u0026#34;, \u0026#34;a\u0026#34;..\u0026#34;z\u0026#34;, \u0026#34;A\u0026#34;..\u0026#34;Z\u0026#34;); my $salt = \u0026#39;\u0026#39;; for(0,1){ $salt .= $char[int(rand(scalar(@char)))]; } # salt値の確認 Jprint(\u0026#34;Salt値：$salt\u0026lt;br\u0026gt;n\u0026#34;); # cryptする $sp = crypt($setpass, $salt); Jprint(\u0026#34;crypt結果：$sp\u0026lt;br\u0026gt;n\u0026#34;); # 認証パスワード確認 print qq(\u0026lt;td width=\u0026#34;40%\u0026#34;\u0026gt;n); Jprint(\u0026#34;認証パスワード：$authpass\u0026lt;br\u0026gt;n\u0026#34;); # 作成したパスワードから「salt値」を取得 if($sp =~ /^$1$/){ $offset = 3; }else{ $offset = 0; } $salt = substr($sp, $offset, 2); # salt値の確認 Jprint(\u0026#34;Salt値：$salt\u0026lt;br\u0026gt;n\u0026#34;); # cryptする $ap = crypt($authpass, $salt); Jprint(\u0026#34;crypt結果：$ap\u0026lt;br\u0026gt;n\u0026#34;); # 結果は同じ？ if($sp eq $ap){ $result = \u0026#39;OK\u0026#39;; }else{ $result = \u0026#39;NG\u0026#39;; } print \u0026#34;\u0026lt;tr\u0026gt;n\u0026lt;td colspan=2 align=center\u0026gt;n\u0026#34;; Jprint(\u0026#34;認証結果：$result\u0026lt;br\u0026gt;n\u0026#34;); print \u0026#34;\u0026lt;/table\u0026gt;\u0026lt;br\u0026gt;nn\u0026#34;; } # 新しい(というか、正しい)cryptの使い方 # 中身は手抜き・・・(^^;;; sub new_crypt_test{ my($PW, $enterPW) = @_; my $salt = \u0026#39;./\u0026#39;; # salt値作成、手抜き my $cryptedPW = crypt($PW, $salt); my $result = \u0026#39;\u0026#39;; if( crypt($enterPW, $cryptedPW) eq $cryptedPW ){ $result = \u0026#39;OK\u0026#39;; }else{ $result = \u0026#39;NG\u0026#39;; } print \u0026lt;\u0026lt;EOM; \u0026lt;pre\u0026gt; 設定パスワード ： $PW 認証パスワード ： $enterPW 照合結果　： $result \u0026lt;/pre\u0026gt; EOM } ","date":"2000-10-07T13:57:07+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/135707/","title":"お手軽暗号化"},{"content":"ソースをコンパクトにまとめる一つの方法として、たぶん少なからず使われるのが「再帰呼出し」が可能なサブルーチンでしょう。僕は恐くてあまり使えませんが・・・。\nなぜ恐いかというと、無限ループに陥りやすいからです。\n「こんなもんだろう」という感じで「とりあえず実行」をしてしまうので、この手のサブルーチンは苦手なのです。そのおかげか知りませんが、強制終了は上手くなりました（自爆）\n数少ない成果として、「数値の整形スクリプト」を作ってみました。これだとループさせてもよさそうなものですが、なんとなく。でも、結構シンプルにまとまっているでしょう？（自画自讃）\nもともと「TestCGI Index」のバイト数表示用に作ってみたのですが、結構緊張しました。こちらは「1MB」を越えることは無い（と思う）ので、本当は再帰は必要ないのですけどね・・・。\nただ、この手の機能はよく使われると思うので、ライブラリがあると思うのですけど、全然把握してません。必要な機能を自分で作るのも勉強です（苦笑）\nまた、ディレクトリの検索にも「再帰呼出し」を使っていますが、この場合、「..（親ディレクトリ）」の処理を忘れると大変です。とほほさんの検索スクリプトを見ていなかったら、迷わず嵌っていた事でしょう（笑）\nちなみに、明らかに数値しか扱わない場合は正規表現を使えば簡単に整形できます。\n1 2 3 4 5 sub divideNum { my ($num) = @_; 1 while $num =~ s/(d+)(d{3})/$1,$2/; return $num; } 変換部分は、とほほさんのラウンジで見たのを多少アレンジしたものですが、最初見たときには目から鱗が落ちました。正規表現を極めると面白そうです。\nそんなわけで、上の「（自画自讃）」はかなりボケてます（爆）\nここから追記（2000/12/14）\n「再帰呼出し」とは関係ないですが、数値の整形については「Perlメモ」の「数字を 3桁ごとにコンマで区切る」が、かなり詳しいです。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; #} $usr_title = \u0026#39;テスト２９\u0026#39;; require \u0026#34;tsenv.pl\u0026#34;; { $rh_form = getForm(); if(exists $rh_form-\u0026gt;{num}){ if($rh_form-\u0026gt;{num}){ outputNumber($rh_form-\u0026gt;{num}); }else{ error(\u0026#39;Data is `Nothing` or `Zero`\u0026#39;); } }else{ inputNumber(); } exit(0); } sub error{ my($err, $num) = @_; print \u0026#34;Content-type: text/html; charset=iso-8859-1nn\u0026#34;; print \u0026#34;\u0026lt;html lang=en\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$err\u0026lt;/h1\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;p\u0026gt;Request is `$num`\u0026lt;/p\u0026gt;n\u0026#34; if $num; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; exit(1); } sub inputNumber{ my $title = $usr_title.\u0026#39;（数値入力）\u0026#39;; printHeader($title); printBodyHeader($title); print qq(\u0026lt;form action=\u0026#34;$ENV{SCRIPT_NAME}\u0026#34;\u0026gt;n); Jprint(\u0026#39;\u0026lt;p\u0026gt;不要っぽい「０」を消し、３桁ずつ区切って表示します。\u0026#39;.\u0026#34;n\u0026#34;); Jprint(\u0026#39;\u0026lt;p\u0026gt;適当な数値を入力してください。\u0026#39;.\u0026#34;n\u0026#34;); print qq(\u0026lt;p\u0026gt;\u0026lt;input type=text name=num size=30\u0026gt;n); Jprint(qq(\u0026lt;p\u0026gt;\u0026lt;input type=submit value=\u0026#34;区切ってみる\u0026#34;\u0026gt;n)); Jprint(qq(\u0026lt;input type=reset value=\u0026#34;とりあえず消す\u0026#34;\u0026gt;n)); print qq(\u0026lt;/p\u0026gt;\u0026lt;/form\u0026gt;n); printFooter(); } sub outputNumber{ my($num) = @_; my $outnum = numbering($num); my $title = $usr_title.\u0026#39;（結果出力）\u0026#39;; printHeader($title); printBodyHeader($title); print \u0026#34;\u0026lt;table border=1 cellpadding=4\u0026gt;n\u0026#34;; Jprint(qq(\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;入力された値\u0026lt;td\u0026gt;$numn)); Jprint(qq(\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;整形後\u0026lt;td\u0026gt;$outnumn)); print \u0026#34;\u0026lt;/table\u0026gt;\u0026#34;; Jprint(\u0026#39;\u0026lt;p\u0026gt;合ってるでしょうか・・・？\u0026#39;); printFooter(); } sub getForm{ my $method = $ENV{REQUEST_METHOD}; my $len = $ENV{CONTENT_LENGTH}; my($query, $key, $value, @elm, %form); if($method eq \u0026#39;POST\u0026#39;){ error(\u0026#39;Memory Over\u0026#39;) if(8191 \u0026lt; $len); read(STDIN, $query, $len); }elsif($method eq \u0026#39;GET\u0026#39;){ $query = $ENV{QUERY_STRING}; }else{ error(\u0026#39;Unknown Request\u0026#39;); } @elm = split(\u0026#39;\u0026amp;amp;\u0026#39;, $query); foreach(@elm){ ($key, $value) = split(\u0026#39;=\u0026#39;); $form{$key} = $value; } return %form; } sub numbering{ my($num) = @_; my($f); error(\u0026#39;Not a Number\u0026#39;, $num) if($num !~ /^[0-9]*.?[0-9]*$/); $num =~ s/^0+//; if($num =~ /./){ ($num, $f) = split(/./, $num); $f =~ s/0+$// if $f; } $num = \u0026#39;0\u0026#39; unless $num; $num = divideNum($num); $num .= \u0026#39;.\u0026#39;.$f if $f; return $num; } sub divideNum{ my($num) = @_; my $len = length($num); if(3 \u0026lt; $len){ my $hn = substr($num, -3); my $th = divideNum(substr($num, 0, $len - 3)); return $th.\u0026#39;,\u0026#39;.$hn; }else{ return $num; } } ","date":"2000-10-07T13:55:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/135515/","title":"再帰呼出し型サブルーチン"},{"content":"強引な「require」をやってしまいましたが、今度は、普通に「require」してパッケージを使ってみましょう。\nパッケージにある「もの」を使うには、『「もの」の識別子、パッケージ名、「::」、「もの」の名前』を続けて書く。サンプルで使用しているパッケージを例にすると、「hogeprintサブルーチン」なら「\u0026amp;hoge::hogeprint」のようにして呼び出す。その他はソースを参考にしてください。\nまた、パッケージ内からでも、他のパッケージ名で宣言することもできるようだ。強引な「require」にも書いたとおり、パッケージ名のないCGIは「mainパッケージ」として動作するので、パッケージ内で「main::hogehoge」のようなサブルーチンを定義すると、パッケージ名無しで「\u0026amp;hogehoge;」のように呼び出すことができる。「dumpvar.pl」の「dumpValueサブルーチン」は、このようにして書かれていた。\nところで、サブルーチンを呼び出す場合、通常は「\u0026amp;」を頭につける必要がある。しかし、呼び出し時に引数をつける場合などは「\u0026amp;」を書かなくても呼び出せる。で、いろいろ試してみた結果、後ろに「()」がついているとサブルーチン（または関数？）として認識されるようだ。つまり、引数がない場合でも、そのことを明示的に表現する（つまり、中身が空の括弧を書く）と呼び出すことができる。この方法は「JavaScript」と似ているし、見栄えがいいので最近はよく使う。\nまた、「()」をつけない場合の不具合もある。\n「\u0026amp;」も「()」も付けないと、「文字列」として解釈されるようだ。うっかり「print hoge::hogereturn;」のように使用すると、ファイルハンドルとして認識されてエラーになる。\nそれに、サブルーチン側で引数を受け付けている場合、引数を指定せずに「\u0026amp;hoge::hogeprint;」と呼び出してしまうと、「@_」が自動的に引数として渡されてしまうようだ。引数を受け付けるサブルーチンを呼び出す場合は、「引数がない」ということを示さないと、誤作動を起こす可能性が高い。実はこれが原因で、何度か嵌ったことがある・・・(^^;;;\nこの辺のことは、サンプルの中に例として書いたつもりです。\n今更という気がしないでもないけど、日本語を扱う場合、特に出力コードを変換している場合に気をつけないといけないのは、漢字コードの統一。IE4などでは、「jis（iso-2022-jp）」と「sjis（shift_jis）」が混ざっていても、なぜか普通に表示されてしまい、漢字コードの混在に気付きにくい。ついさっきもこのミスをしてしまった(^^;;;\nで、その時に、ブラウザ上で比較的簡単に間違いを発見する方法を思いついた。\nCGIの漢字コード出力を「jis」に設定して、さらに「Content-type」で漢字コードを指定しないで（このサンプルなら「BEGIN」を有効にしておいて）CGIを実行する。そして、ブラウザに表示されたら、コードの種類で「日本語（シフト JIS）」を選択する。\nそうすると、すべてが「jis」なら日本語（2バイト文字）が（普通の人なら）読めなくなるので、もし、この状態で（普通の人が）読める日本語があれば、変換忘れ（変換違い）があるということ。HTMLソースを見れば、わざわざこんなことしなくても良いんだけど、ソースの状態だと横スクロールがたくさんあって、見にくい。・・・まぁ、改行をたくさん書くようにすれば良いんだけど。\nASCII文字も含めて、全部の出力を「Jcode」にかければ、こんなミスはなくなるけど、なんだかね・・・。\nただ、この方法でもうまくいかないことがあった・・・。やはり、ソースを直に見るしかないのかもしれない。NNでは、出力を「text/html」に直してから表示させて、漢字コードを変えても、リロード（再描画？）されて元に戻るし・・・(T_T)\n簡単にチェックする方法はないのかなぁ・・・。\n・・・\nこのテストからは「tsenv.pl」を使っているので変更はほとんどありません。やはりパッケージ（tsenv.pl自体は違うけど）を使うと便利ですね・・・。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); # $|=1; #} $usr_title = \u0026#39;テスト28\u0026#39;; require \u0026#34;tsenv.pl\u0026#34;; require \u0026#34;hoge.pl\u0026#34;; { printHeader($usr_title); printBodyHeader($usr_title); @_ = (\u0026#39;ホゲ1\u0026#39;,\u0026#39;ほげ2\u0026#39;,\u0026#39;hoge3\u0026#39;); $_ = \u0026#39;hogeほげgehoげほ\u0026#39;; print \u0026#39;$_ = \u0026#39;; Jprint($_); print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#39;@_ = \u0026#39;; Jprint(join(\u0026#39;,\u0026#39;, @_)); print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;\u0026amp;hoge::hogeprint;で呼び出し\u0026lt;br\u0026gt;\u0026#39;); \u0026amp;hoge::hogeprint; Jprint(\u0026#39;\u0026amp;hoge::hogeprint();で呼び出し\u0026lt;br\u0026gt;\u0026#39;); \u0026amp;hoge::hogeprint(); Jprint(\u0026#39;\u0026amp;hoge::hogeprint($_);で呼び出し\u0026lt;br\u0026gt;\u0026#39;); \u0026amp;hoge::hogeprint($_); print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;\u0026amp;hoge::hogeprint;で配列呼び出し\u0026lt;br\u0026gt;\u0026#39;); foreach(@_){ \u0026amp;hoge::hogeprint; } print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;\u0026amp;hoge::hogeprint($_);で配列呼び出し\u0026lt;br\u0026gt;\u0026#39;); foreach(@_){ \u0026amp;hoge::hogeprint($_); } print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;Jprint(hoge::hogereturn);で呼び出し（不可。文字列と解釈される）\u0026lt;br\u0026gt;\u0026#39;); Jprint(hoge::hogereturn); print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;Jprint(hoge::hogereturn());で呼び出し\u0026lt;br\u0026gt;\u0026#39;); Jprint(hoge::hogereturn()); Jprint(\u0026#39;Jprint(hoge::hogereturn($_));で呼び出し\u0026lt;br\u0026gt;\u0026#39;); Jprint(hoge::hogereturn($_)); print \u0026#34;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#39;$hoge::version = \u0026#39;; print $hoge::version; print \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#39;@hoge::version = \u0026#39;; print foreach(@hoge::version); print \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#39;%hoge::version = \u0026#39;; print \u0026#34;$_ =\u0026gt; $hoge::version{$_}\u0026#34; foreach(keys %hoge::version); print \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; Jprint(\u0026#39;hogehoge();で呼び出し\u0026lt;br\u0026gt;\u0026#39;); hogehoge(); printFooter(); exit(0); } ","date":"2000-10-07T13:53:02+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/135302/","title":"普通の「require」"},{"content":"何度も同じ物を書くのはだるいし、気が変わったとき（笑）にすべてのスクリプトを変更するなんて大変だ。\nというわけで、「require」の強引な使い方です。掲示板を作っていたときに、「設定部分だけを別で定義したい」と思ったのがきっかけでやってみた。\n普通に「require」するファイルには、「package hoge;」のように「パッケージ名」を宣言する。しかし、パッケージ宣言を省略すると、呼出し元のファイルの一部として機能するようだ。\nエラーメッセージを見ていると、パッケージ宣言されていないCGIスクリプト（つまり、一般的には呼出したCGIスクリプト）は「main」というパッケージ名で動作しているようだ。だから、「require」するファイルで「パッケージ宣言」されていないと、「mainパッケージ」として動作する。\nつまり、「パッケージ宣言」していない「hoge.pl」を、「require」した場合、「hoge.pl」内の「hogesubサブルーチン」は「\u0026amp;hogesub」で呼出す事ができる。\nただし、このような方法では、呼出し側と同じ空間で実行されるので、例えば「hoge.pl」にある「hogesubサブルーチン」を、呼出し側でも宣言してしまうと、「Subroutine hogesub redefined」という詳細エラー（-wオプションをつけた場合）がでる。この場合、どちらのサブルーチンが実行されるかは謎です。また、変数も「hoge.pl」内で変更されると、値が変わってしまうので注意が必要です。\nまた、「require」するファイルが、最終的に「真」を返さない場合「require」できません。なので、念のため、最後に「1;」をつけておきます。これで「真」を返す事ができます。最後を「0;」とするとエラーが見れます。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。\nで、リンク先の順番の事ですが、「tsenv.pl」はハッシュをソートして表示していたようです。なにか勘違いをしていたみたいですね。今回も偶然うまく行くようですが、今後のために配列を2つ使った方式に変更します。\nまた、テストの中には「Jcode」専用の使い方を用いていたので、それはコメントにしました。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; #} $timeBegin = times; $usr_title = \u0026#39;テスト２７\u0026#39;; require \u0026#34;tsenv.pl\u0026#34;; { printHeader($usr_title); printBodyHeader($usr_title); Jprint(\u0026#39;ほげてすと\u0026lt;br\u0026gt;\u0026#39;); Jprint(\u0026#39;ちゃんとJISで表示されてますか？\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#39;); # print Jcode-\u0026gt;new(\u0026#39;げほてすと\u0026lt;br\u0026gt;これもJISですか？\u0026#39;)-\u0026gt;jis; printFooter(); exit(0); } tsenv.plソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 # tsenv.pl : TestCGI向き共通設定 init() unless defined $info_copyright; sub init{ # use Jcode; unshift(@INC, \u0026#39;../..\u0026#39;); require \u0026#39;jcode.pl\u0026#39;; $info_copyright=\u0026#39;\u0026#39;; open(IN, \u0026#34;../../sig.txt\u0026#34;); \u0026lt;IN\u0026gt;; while(\u0026lt;IN\u0026gt;){ $info_copyright .= $_; } close(IN); $usr_outcode = \u0026#39;jis\u0026#39; unless defined $usr_outcode;# \u0026#39;sjis\u0026#39;;# \u0026#39;euc\u0026#39;;# \u0026#39;utf8\u0026#39;; if($usr_outcode eq \u0026#39;sjis\u0026#39;){ $usr_outCharset = \u0026#39;shift_jis\u0026#39;; }elsif($usr_outcode eq \u0026#39;jis\u0026#39;){ $usr_outCharset = \u0026#39;iso-2022-jp\u0026#39;; }elsif($usr_outcode eq \u0026#39;euc\u0026#39;){ $usr_outCharset = \u0026#39;euc-jp\u0026#39;; # }elsif($usr_outcode eq \u0026#39;utf8\u0026#39;){ # $usr_outCharset = \u0026#39;utf-8\u0026#39;; } $usr_exTitle = $usr_title . \u0026#39;の解説\u0026#39;; $usr_ex = $ENV{SCRIPT_NAME}; $usr_ex =~ s|cgi/(ts[0-9]{4})(_[12u])?.cgi$|$1.htm|; @usr_stylesheet = ( \u0026#39;../../ipp.css\u0026#39;, \u0026#39;../test.css\u0026#39;, ); # %usr_links = ( # \u0026#39;Home\u0026#39; =\u0026gt; \u0026#39;../../../index.htm\u0026#39;, # \u0026#39;Perl\u0026#39; =\u0026gt; \u0026#39;../../\u0026#39;, # \u0026#39;TestCGI Index\u0026#39; =\u0026gt; \u0026#39;../\u0026#39;, # $usr_exTitle =\u0026gt; $usr_ex, # ); @usr_linkName = ( \u0026#39;Home\u0026#39;, \u0026#39;Perl\u0026#39;, \u0026#39;TestCGI Index\u0026#39;, $usr_exTitle, ); @usr_linkAddr = ( \u0026#39;../../../index.htm\u0026#39;, \u0026#39;../../\u0026#39;, \u0026#39;../\u0026#39;, $usr_ex, ); } sub printHeader{ # 「\u0026lt;title\u0026gt;タグ」の文字列 my($title) = @_; my $ss = \u0026#39;\u0026#39;; $ss .= qq(\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n) foreach @usr_stylesheet; Jprint(\u0026lt;\u0026lt;EOM); Content-type: text/html; charset=$usr_outCharset \u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt; \u0026lt;html lang=ja\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta name=\u0026#34;ROBOTS\u0026#34; content=\u0026#34;NOINDEX\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-type\u0026#34; content=\u0026#34;text/html; charset=$usr_outCharset\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-style-type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt; \u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt; \u0026lt;link rev=\u0026#34;made\u0026#34; href=\u0026#34;$info_mailAddr\u0026#34;\u0026gt; $ss \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; EOM } sub printBodyHeader{ # 英字なら「printBodyHeader(\u0026#34;\u0026lt;font face=times\u0026gt;Title String\u0026lt;/font\u0026gt;\u0026#34;);」がいいんだけど・・・。 my($title) = @_; print \u0026#34;\u0026lt;div align=center\u0026gt;n\u0026#34;; Jprint(qq(\u0026lt;h2\u0026gt;\u0026lt;a name=\u0026#34;top\u0026#34;\u0026gt;$title\u0026lt;/a\u0026gt;\u0026lt;/h2\u0026gt;n\u0026lt;hr\u0026gt;n)); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=test\u0026gt;nn\u0026#34;; } sub printFooter{ print \u0026#34;n\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div align=center\u0026gt;n\u0026#34;; print qq(\u0026lt;a href=\u0026#34;#top\u0026#34; class=en\u0026gt;Top\u0026lt;/a\u0026gt;n\u0026lt;hr\u0026gt;n); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;n\u0026lt;div align=right\u0026gt;n\u0026#34;; printf(\u0026#34;Cost : %.2f\u0026lt;br\u0026gt;n\u0026#34;, times); print $info_copyright; print \u0026#34;n\u0026lt;/div\u0026gt;n\u0026lt;/body\u0026gt;n\u0026lt;/html\u0026gt;nn\u0026#34;; } sub printLinks{ # my $cnt = 0; # foreach(sort keys %usr_links){ # print \u0026#34;/ \u0026#34; if $cnt++; # Jprint(qq(\u0026lt;a href=\u0026#34;$usr_links{$_}\u0026#34;\u0026gt;$_\u0026lt;/a\u0026gt;n)); # } # for($i=0; $i\u0026lt;@usr_linkName; $i++){ foreach $i(0 .. $#usr_linkName){ print \u0026#34;/ \u0026#34; if $i; Jprint(qq(\u0026lt;a href=\u0026#34;$usr_linkAddr[$i]\u0026#34; class=en\u0026gt;$usr_linkName[$i]\u0026lt;/a\u0026gt;n)); } print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; } sub Jprint{ # print Jcode::convert($_, $usr_outcode) foreach(@_); print jcode::to($usr_outcode, $_) foreach @_; } 1; ","date":"2000-10-07T13:52:09+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/135209/","title":"強引な「require」"},{"content":"値、特に大きな配列など、たくさんのデータを渡すときには、「リファレンス」というものを用いると良いらしい。・・・ということで、どのくらい有効なのか？と思ってやってみた。\n一応書いておきますが、サンプルで実行できるのは、下の方に書いてある「リファレンスの使用法」みたいなものです。ベンチマークとは関係ありませんので、適当に実行してください。\nまず、基準となる配列「$cnt個」に乱数「rand」を格納した。それを「my」変数に書き込むサブルーチンを作って「$count」回「Benchmark」してみました。（基本的な書式）\n$countの値 $cntの値 リファレンス不使用 リファレンス使用 Type1 1000 100 7.14 2.48 Type2 1000 10 1.87 1.26 Type3 10000 1 12.97 11.58 Type4 100 1000 5.77 1.32 この計測が正しい方法なら、配列が大きければ大きいほど、「リファレンス」を使ったほうが処理が速いようだ。\nちなみに、「print」に関係する部分を削除すると、より明らかに差が出た。\nただ、「リファレンス」を参照する（本には「デリファレンス」と書いてあった）には、配列なら「@」を、ハッシュなら「%」を「リファレンス変数」の前につける必要がある。実は、これが結構面倒だったりする。\nまた、個別に参照するには通常と同じように「$」を頭につける。つまり「$$array[0]」や「$$hash{num}」のように・・・。で、なぜか知らないけど、配列の場合だけは「@$array[0]」でも参照できる。普通の配列でも「@a[0]」で参照できる（この辺はおそらくPerl5のみ）。このおかげで「@」が「\u0026quot;（ダブルクォート）」の中では展開されるようになり、文字として表示するには「エスケープ」しないといけなくなったんだろう。\nこの他に「矢印記法」というものもあり、例えば「$$array[0]（または@$array[0]）」の場合は「$array-\u0026gt;[0]」と記述する事もできる。ハッシュなら「$$hash{num}」が「$hash-\u0026gt;{num}」といった具合。ややこしいけど、なかなか面白いことを考える。\nこの「リファレンス」というやつは、サブルーチンに対しても作る事ができるし、さらに、その「リファレンスされたサブルーチン」が、それぞれ違う値を返したり・・・と、なかなか奥が深い。理解するのは結構時間がかかりそうだ。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); # $|=1; #} %h = ( \u0026#39;num1\u0026#39; =\u0026gt; 1, \u0026#39;num2\u0026#39; =\u0026gt; 2, ); @a = (1,2); $hash = %h; $array = @a; print \u0026lt;\u0026lt;EOM; Content-type: text/plain $h{num1} = $h{num1} $$hash{num1} = $$hash{num1} %$hash{num1} = %$hash{num1} $hash-\u0026gt;{num1} = $hash-\u0026gt;{num1} $a[0] = $a[0] @a[0] = @a[0] $$array[0] = $$array[0] @$array[0] = @$array[0] $array-\u0026gt;[0] = $array-\u0026gt;[0] EOM ベンチマーク用ソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #!/usr/bin/perl BEGIN{ print \u0026#34;Content-type: text/plainnn\u0026#34;; open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); $|=1; } use Benchmark; $count = 1000; $cnt = 100; $dat1 = \u0026#34;reftest1.txt\u0026#34;; $dat2 = \u0026#34;reftest2.txt\u0026#34;; srand; for(0 .. $cnt){ @nums[$_] = rand; } open(OUT, \u0026#34;\u0026gt; $dat1\u0026#34;); close(OUT); open(OUT, \u0026#34;\u0026gt; $dat2\u0026#34;); close(OUT); sleep 1; @t = timethese($count, { \u0026#39;Refuse\u0026#39; =\u0026gt; \u0026#39;\u0026amp;use_ref;\u0026#39;, \u0026#39;RefNouse\u0026#39; =\u0026gt; \u0026#39;\u0026amp;nouse_ref;\u0026#39;, }); exit(0); sub use_ref{ my $r_nums; $r_nums = @nums; open(OUT, \u0026#34;\u0026gt;\u0026gt; $dat1\u0026#34;); foreach(@$r_nums){ print OUT \u0026#34;$_\\n\u0026#34;; } close(OUT); } sub nouse_ref{ my @n_nums; @n_nums = @nums; open(OUT, \u0026#34;\u0026gt;\u0026gt; $dat2\u0026#34;); foreach(@n_nums){ print OUT \u0026#34;$_\\n\u0026#34;; } close(OUT); } ","date":"2000-10-07T13:49:29+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/134929/","title":"リファレンス"},{"content":"本を買ってから「効率的なソース」について考えるようになった。とはいっても、数回の実行では目に見えて変わる事はないけど。\nで、「サブディレクトリ内も一覧（その2）」を見てしまって「これはちょっと・・・」と思った（コスト表示した「その2」）。\nで、ほぼ同じ物を新しく作ってみたら、時間が約半分になった（当社比）。結果的に「readdir」を一回で済むようにしたのが効いたのかもしれない。少なくとも、その発想が出ただけでも良しとしよう。\nただ、以前は使っていなかった「リファレンス」を使うようにしたので、ファイル数やディレクトリが多くなると、もっと短くなるかもしれない。\n・・・と思ってやってみた。条件と結果は、以下のようになりました。\nタイプ1 タイプ2 ts0014p ts0025 ts0014p ts0025 総フォルダ数 70 10.44 5.82 36 2.80 2.25 総ファイル数 4,631 424 総ファイルサイズ（バイト） 12,843,625 1,746,391 HTMLファイル数 419 252 HTMLファイルサイズ（バイト） 2,314,124 882,760 これだけで決めてしまうのはよくないけど、ファイル数が多いと「readdir」の回数が効いてくるようだ。でも、HTMLファイルの比率が高い場合は、それほど差がつかないのがちょっと残念。\nところで、「dumpvar.pl」と「dumpValueサブルーチン」は、（「リファレンス」を含む）配列、ハッシュを把握するのにとても役に立つパッケージで、「ActivePerl522」にはついている。これも前述の「実用 Perlプログラミング」に載っていたんだけど、実は非公開（非公式？）のパッケージらしい。\nこのサブルーチンを使うと、深い階層の配列やハッシュの値が、整形されて表示される。複雑な形式の変数を扱うときは、これで確認しながら作っていくと、デバッグもしやすいのでお奨めです。\n使用する方法は、まず「dumpvar.pl」を「require」します。これは標準の「@INC」に入っていると思うので、探す必要はないと思います。そして、そのパッケージ内に存在する「dumpValue」サブルーチンに、表示したい配列、またはハッシュを「リファレンス」で渡します。すると、あら不思議。デバッグに有効な情報が手に入る。というわけです。是非試してみてください。\n・・・ちょっと欠陥（ディレクトリ名が正しく取れない事があったみたいです）を見つけてしまったので、訂正しました。すると、悲しいかな、差が縮んでしまいました (T_T)\nただ、「ts0014p」にも新しい欠陥（ディレクトリの字下げが正しく行なわれていないみたいです）を見つけてしまったのですが・・・。\n多少条件が変わりましたが、とりあえず、新しい結果を・・・。\nタイプ1 タイプ2 ts0014p 11.15 2.80 ts0025 9.88 2.31 「タイプ1」が、かなり遅くなってしまいました。ディレクトリ情報を収集するだけで「6秒」ほどかかってしまいます。訂正方法が良くなかったのかもしれません。ディレクトリとファイルの区別を、もっと簡潔にできないものでしょうか・・・。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。\nついでに、リンク先も付け加えたのですが・・・。ハッシュは順不同で呼び出されるので、見事にリンクの順番が変わってしまいました・・・。いくつか先に、配列を2つ使ってリンクを作成するスクリプトがあるはずなので、これは愛嬌ということに・・・ (^^;;;\nここから追記（2000/12/14）\nハッシュは、順不同で呼び出される、じゃなくて、取り出しやすいように順不同で格納される、が正解。呼び出した結果だけ見れば同じようなものだけど・・・。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plainnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; #} $timeBegin = times; # use Jcode; require \u0026#39;../../../cgi-bin/jcode.pl\u0026#39;; $info_mailName = \u0026#39;Nobu3\u0026#39;; $info_mailAddr = \u0026#39;nobu3@x.age.ne.jp\u0026#39;; $info_uriName = \u0026#39;Incomprehensible Perl Project\u0026#39;; $info_uriAddr = \u0026#39;http://www.age.ne.jp/x/nobu3/perl/\u0026#39;; $info_uri = qq(\u0026lt;a href=\u0026#34;$info_uriAddr\u0026#34;\u0026gt;$info_uriName\u0026lt;/a\u0026gt;.); $info_mail = qq((C)1999 \u0026lt;a href=\u0026#34;mailto:$info_mailAddr\u0026#34;\u0026gt;$info_mailName\u0026lt;/a\u0026gt;. All rights reserved.); $info_copyright = \u0026#34;\u0026lt;address\u0026gt;n\u0026lt;font face=times\u0026gt;$info_uri\u0026lt;br\u0026gt;n$info_mail\u0026lt;/font\u0026gt;\u0026lt;br\u0026gt;n\u0026lt;/address\u0026gt;n\u0026#34;; # @usr_stylesheet = (\u0026#39;/Nobu3/ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;);# できあがりからのURIパス @usr_stylesheet = (\u0026#39;../../ipp.css\u0026#39;, \u0026#39;../test.css\u0026#39;); $usr_outcode = \u0026#39;jis\u0026#39;; $usr_outCharset = \u0026#39;iso-2022-jp\u0026#39;; $usr_title = \u0026#39;テスト２５\u0026#39;; $explain = $ENV{SCRIPT_NAME}; $explain =~ s|cgi/(ts[0-9]{4})(_[12u])?.cgi$|$1.htm|; $explain_title = $usr_title . \u0026#39;の解説\u0026#39;; %usr_links = ( \u0026#39;Home\u0026#39; =\u0026gt; \u0026#39;../../../index.htm\u0026#39; , \u0026#39;Perl\u0026#39; =\u0026gt; \u0026#39;../../\u0026#39; , \u0026#39;TestCGI Index\u0026#39; =\u0026gt; \u0026#39;../\u0026#39; , $explain_title =\u0026gt; $explain ); $searchDir = \u0026#39;..\u0026#39;; $searchReg = \u0026#39;.(html?|[sp]ht(ml)?)$\u0026#39;; $indexReg = \u0026#34;index$searchReg\u0026#34;; { $ra_dir = dirSearch($searchDir); printHeader($usr_title); printBodyHeader($usr_title); print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; Jprint(\u0026#39;\u0026lt;p\u0026gt;親ディレクトリ以下にあるファイルの一覧（HTMLファイルのみ）\u0026lt;/p\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;); print \u0026#34;\u0026lt;ul\u0026gt;n\u0026#34;; # require \u0026#34;dumpvar.pl\u0026#34;; dumpValue($ra_dir); printRefArray($ra_dir); print \u0026#34;\u0026lt;/ul\u0026gt;n\u0026lt;/div\u0026gt;n\u0026#34;; printFooter(); exit(0); } sub searchTitle{ my($file)= @_; my $title = \u0026#39;タイトル無し\u0026#39;; open(IN, $file); while(\u0026lt;IN\u0026gt;){ if(m|\u0026lt;title\u0026gt;(.*?)\u0026lt;/title\u0026gt;|i){ $title = ($1 !~ /^s*$/) ? $1:\u0026#39;不正なタイトル\u0026#39;; last; } last if m|\u0026lt;/head\u0026gt;|i; } close(IN); return $title; } sub printRefArray{ my($ra_dir) = @_; my $indexfile = (grep(/$indexReg/, @$ra_dir))[0] || \u0026#39;\u0026#39;; my $dir = shift(@$ra_dir); my($dirname) = $dir =~ m|([^/]+)/$|; my $title = \u0026#39;ＨＴＭＬインデックス無し\u0026#39;; $title = searchTitle($indexfile) if($indexfile); Jprint(qq(\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026#34;$dir\u0026#34;\u0026gt;$dirname（$title）\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;n)); return if($#$ra_dir \u0026lt; 0); print \u0026#34;\u0026lt;ul\u0026gt;n\u0026#34;; foreach $file(@$ra_dir){ next if($file eq $indexfile); if(ref($file)){ printRefArray($file); next; }elsif(-r $file){ my $title = searchTitle($file); my($filename) = $file =~ m|([^/]+)$|; Jprint(qq(\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;$file\u0026#34;\u0026gt;$filename（$title）\u0026lt;/a\u0026gt;n)); } } print \u0026#34;\u0026lt;/ul\u0026gt;n\u0026#34;; } sub dirSearch{ my($dir) = @_; my @dirs = (); my @filenames = (\u0026#34;$dir/\u0026#34;); opendir(DIR, $dir); my @files = sort grep(/^[^.]/, readdir(DIR)); closedir(DIR); foreach(@files){ $_ = \u0026#34;$dir/$_\u0026#34;; if(-d $_){ push(@dirs, dirSearch($_)); }elsif(/$searchReg/){ push(@filenames, $_); } } push(@filenames, @dirs); return @filenames; } sub printHeader{ # 「\u0026lt;title\u0026gt;タグ」の文字列 my($title) = @_; print \u0026#34;Content-type: text/html; charset=$usr_outCharsetnn\u0026#34;; print qq(\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;n); print \u0026#34;\u0026lt;html lang=ja\u0026gt;n\u0026lt;head\u0026gt;n\u0026#34;; print qq(\u0026lt;meta http-equiv=\u0026#34;Content-type\u0026#34; content=\u0026#34;text/html; charset=$usr_outCharset\u0026#34;\u0026gt;n); print qq(\u0026lt;meta http-equiv=\u0026#34;Content-style-type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;n); Jprint(\u0026#34;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;n\u0026#34;); print qq(\u0026lt;link rev=\u0026#34;made\u0026#34; href=\u0026#34;$info_mailAddr\u0026#34;\u0026gt;n); foreach(@usr_stylesheet){ print qq(\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n); } print qq(\u0026lt;meta name=\u0026#34;ROBOTS\u0026#34; content=\u0026#34;NOINDEX\u0026#34;\u0026gt;n); print \u0026#34;\u0026lt;/head\u0026gt;nn\u0026#34;; print \u0026#34;\u0026lt;body\u0026gt;nn\u0026#34;; } sub printBodyHeader{ # 英字なら「printBodyHeader(\u0026#34;\u0026lt;font face=times\u0026gt;Title String\u0026lt;/font\u0026gt;\u0026#34;);」がいい my($title) = @_; print \u0026#34;\u0026lt;div align=center\u0026gt;n\u0026#34;; Jprint(qq(\u0026lt;h1\u0026gt;\u0026lt;a name=\u0026#34;top\u0026#34;\u0026gt;$title\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt;n\u0026lt;hr\u0026gt;n)); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div align=center\u0026gt;n\u0026#34;; print qq(\u0026lt;a href=\u0026#34;#top\u0026#34;\u0026gt;Top\u0026lt;/a\u0026gt;n\u0026lt;hr\u0026gt;n); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;n\u0026lt;div align=right\u0026gt;n\u0026#34;; $timeEnd = sprintf(\u0026#34;%.3f\u0026#34;, times - $timeBegin); print \u0026#34;Cost : $timeEnd\u0026lt;br\u0026gt;n\u0026#34;; print $info_copyright; print \u0026#34;n\u0026lt;/body\u0026gt;n\u0026lt;/html\u0026gt;nn\u0026#34;; } sub printLinks{ my $cnt = 0; foreach(keys %usr_links){ print \u0026#34;/ \u0026#34; if($cnt++); Jprint(qq(\u0026lt;a href=\u0026#34;$usr_links{$_}\u0026#34;\u0026gt;$_\u0026lt;/a\u0026gt;n)); } print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; } sub Jprint{ foreach(@_){ # print Jcode::convert($_, $usr_outcode); print jcode::to($usr_outcode, $_); } } ","date":"2000-10-07T13:43:40+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/134340/","title":"サブディレクトリ内も一覧（その３）"},{"content":"BBSを作っていて、勉強になったことが沢山ありすぎ。それに、ソースの書き方も少し変わってきた。\nというわけで、「Jcode.pm」を正しい使い方（？）で使ってみた。ただ、この方法は「Jcode.pm」に書いてあるんだけど・・・。この機会に「jcode.pl」も色々な使い方で試してみた。\n今まで、「Jcode.pm」を何気なく使用していたせいか、「jcode.pl」は使いにくい。「jcode.pl」はリファレンスを渡すはずなのに、変換されてないこともある。直接「print」できないというのも難点かなぁ・・・。使える条件がよくわからない。それに、「-w」オプションをつけると、「Use of uninitialized value」エラーがたくさん出る。使い方がよくないのかなぁ・・・？\n「Jcode.pm」ならば、以下のように使っても正しく動作する。\n1 2 3 4 foreach(@_){ print Jcode-\u0026gt;new($_)-\u0026gt;jis; } foreach(@_){ print Jcode-\u0026gt;new($_)-\u0026gt;jis; } foreach(@_){ print Jcode::convert($_, \u0026#39;jis\u0026#39;); } foreach(@_){ print Jcode::convert($_, \u0026#39;jis\u0026#39;); } ただ、「Jcode」は普通のプロバイダではインストールしてないだろうし、解凍したままの「Jcode」は約721KBもある。ユニコードを使えるということで肥大化してるみたいだけど・・・。\nその点「jcode.pl」だと、ファイルが1つ（手元にあるのはCR,LF改行で、20,633バイト）で済む。それを考えると、「jcode.pl」を正しく使える方が有益なんだろうなぁ・・・。\n話は変わって、連想配列。\n連想配列は「ハッシュ」と呼ぶ方がいいようだ。配列と混同しやすいので、これからは「ハッシュ」と書く事にする。\n代表的なハッシュは「%ENV」だ。今まで、ハッシュを定義する方法として「$hash{\u0026lsquo;hoge\u0026rsquo;} = \u0026ldquo;ほげ\u0026rdquo;;」のような形式で代入する事しか知らなかった。\n実はハッシュも配列と同じように、まとめて定義できる事がわかった。それは以下のようなもの。\n1 2 # ハッシュの定義 %hash = (\u0026#39;hoge\u0026#39; =\u0026gt; \u0026#39;ほげ\u0026#39;, \u0026#39;geho\u0026#39; =\u0026gt; \u0026#39;げほ\u0026#39;); これで、「$hash{\u0026lsquo;hoge\u0026rsquo;}」は「ほげ」、「$hash{\u0026lsquo;geho\u0026rsquo;}」は「げほ」を示す事になる。なかなかかっこいい（笑）\nまた、ソースを書く場合、「;」が行の最後を表すので、「;」をつけなければ複数行に分けて書く事もできる。\n1 2 3 4 5 # ハッシュの定義 その２ %hash = ( \u0026#39;hoge\u0026#39; =\u0026gt; \u0026#39;ほげ\u0026#39; , \u0026#39;geho\u0026#39; =\u0026gt; \u0026#39;げほ\u0026#39; ); このサンプルCGIでは「タブ」と「改行」を使って整形しているけど、HTMLで表示するときに変換しているので、うまく整形されてない。ちなみに、普段は「スペース4文字」分で表示しているので、テキストとして表示しても、ブラウザでは「8文字」に変換されてしまうのでうまくない。残念だ。\nまた、引用符を使わなくても、ちゃんと認識してくれるようだ。例えば「$hash{hoge}」でも「ほげ」を示すことになる。「つけなくても動く」というだけで、つけた方が安全だとは思うけど・・・。でも、環境変数くらいなら、使わなくてもわかりやすいし、許してやってもいいかもしれない。\nPerlは、色々な書き方ができるので、ソースに自分のスタイルがでるような気がしてきた。\nあと、これからは不具合が無いかぎり、ソースは「sjis」だけでいく事にした。ファイル数が結構多くなってきたので、フォルダ内が見にくくなってきたから。\n「euc」も良いんだけど、これだと普通のエディタで読めなくなってしまうから。「utf8」も、IEとNNで変換が違っていたり（例えば「?」がIEでは文字化けするとか）するし、なにより変換に時間がかかる。今のところあえて使う必要もない。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。なので、このスクリプトは無理やり実行してもほとんど意味がないので取りやめます。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 #!/usr/bin/perl #BEGIN{ # print \u0026#34;Content-type: text/plain\\n\\n\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); # $|=1; #} $timeBegin = times; unshift(@INC, \u0026#34;../..\u0026#34;);# 「jcode.pl」のあるディレクトリ require \u0026#34;jcode.pl\u0026#34;; use Jcode; $info_mailName = \u0026#39;Nobu3\u0026#39;; $info_mailAddr = \u0026#39;nobu3@x.age.ne.jp\u0026#39;; $info_uriName = \u0026#39;Incomprehensible Perl Project\u0026#39;; $info_uriAddr = \u0026#39;http://www.age.ne.jp/x/nobu3/perl/\u0026#39;; $info_uri = qq(\u0026lt;a href=\u0026#34;$info_uriAddr\u0026#34;\u0026gt;$info_uriName\u0026lt;/a\u0026gt;.); $info_mail = qq((C)1999 - 2000 \u0026lt;a href=\u0026#34;mailto:$info_mailAddr\u0026#34;\u0026gt;$info_mailName\u0026lt;/a\u0026gt;. All rights reserved.); $info_copyright = \u0026#34;\u0026lt;address\u0026gt;\\n\u0026lt;font face=times\u0026gt;$info_uri\u0026lt;br\u0026gt;\\n$info_mail\u0026lt;/font\u0026gt;\u0026lt;br\u0026gt;\\n\u0026lt;/address\u0026gt;\\n\u0026#34;; @usr_stylesheet = (\u0026#39;/Nobu3/ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;);# できあがりからのURIパス $usr_outcode = \u0026#39;jis\u0026#39;; $usr_outCharset = \u0026#39;iso-2022-jp\u0026#39;; $usr_title = \u0026#39;テスト２４\u0026#39;; $explain = $ENV{SCRIPT_NAME}; $explain =~ s|cgi/(ts[0-9]{4})(_[12u])?.cgi$|$1.htm|; $explain_title = $usr_title . \u0026#39;の解説\u0026#39;; %usr_links = (# リンクネーム =\u0026gt; リンクアドレス \u0026#39;Home\u0026#39; =\u0026gt; \u0026#39;../../../index.htm\u0026#39; , \u0026#39;Perl\u0026#39; =\u0026gt; \u0026#39;../../\u0026#39; , \u0026#39;TestCGI Index\u0026#39; =\u0026gt; \u0026#39;../\u0026#39; , $explain_title =\u0026gt; $explain ); { printHeader($usr_title); printBodyHeader($usr_title); print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; # require \u0026#34;dumpvar.pl\u0026#34;; dumpValue(%usr_links); print \u0026#34;Jcode $Jcode::VERSION\u0026lt;br\u0026gt;\\n\u0026#34;; $japanese = \u0026#34;日本語に変換する文字列。\u0026lt;br\u0026gt;\\n\u0026#34;; print useJcode($japanese); print Jcode-\u0026gt;new(\u0026#39;これも日本語\u0026lt;br\u0026gt;\u0026#39;)-\u0026gt;jis; $hoge = \u0026#39;ほげほげほ?\u0026#39;; print Jcode::convert($hoge, $usr_outcode); $geho = \u0026#39;げほげほげ?\u0026#39;; print Jcode::convert($geho, $usr_outcode); print $geho; print \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\\n\u0026#34;; print \u0026#34;jcode.pl $jcode::version\u0026lt;br\u0026gt;\\n\u0026#34;; print usejcode($japanese); print jcode::convert(\u0026#39;これも日本語\u0026lt;br\u0026gt;\u0026#39;, $usr_outcode); $hoge = \u0026#39;ほげほげほ?\u0026#39;; print jcode::convert($hoge, $usr_outcode); $geho = \u0026#39;げほげほげ?\u0026#39;; print jcode::convert($geho, $usr_outcode); print $geho; print \u0026#34;\u0026lt;br\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; printFooter(); exit(0); } sub useJcode{ my($str)= @_; return Jcode-\u0026gt;new($str)-\u0026gt;jis; } sub usejcode{ my($str) = @_; jcode::convert($str, $usr_outcode); return $str; } sub error{ my($err) = shift; printHeader($err); printBodyHeader($err.\u0026#39;です\u0026#39;); Jprint(@_); printFooter(); exit(1); } sub printHeader{ # 「\u0026lt;title\u0026gt;タグ」の文字列 my($title) = @_; print \u0026#34;Content-type: text/html; charset=$usr_outCharset\\n\\n\u0026#34;; print qq(\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;\\n); print \u0026#34;\u0026lt;html lang=ja\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026#34;; print qq(\u0026lt;meta http-equiv=\u0026#34;Content-type\u0026#34; content=\u0026#34;text/html; charset=$usr_outCharset\u0026#34;\u0026gt;\\n); print qq(\u0026lt;meta http-equiv=\u0026#34;Content-style-type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;\\n); Jprint(\u0026#34;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;\\n\u0026#34;); print qq(\u0026lt;link rev=\u0026#34;made\u0026#34; href=\u0026#34;$info_mailAddr\u0026#34;\u0026gt;\\n); foreach(@usr_stylesheet){ print qq(\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;\\n); } print qq(\u0026lt;meta name=\u0026#34;ROBOTS\u0026#34; content=\u0026#34;NOINDEX\u0026#34;\u0026gt;\\n); print \u0026#34;\u0026lt;/head\u0026gt;\\n\\n\u0026#34;; print \u0026#34;\u0026lt;body\u0026gt;\\n\\n\u0026#34;; } sub printBodyHeader{ # 英字なら「printBodyHeader(\u0026#34;\u0026lt;font face=times\u0026gt;Title String\u0026lt;/font\u0026gt;\u0026#34;);」がいい my($title) = @_; print \u0026#34;\u0026lt;div align=center\u0026gt;\\n\u0026#34;; Jprint(qq(\u0026lt;h1\u0026gt;\u0026lt;a name=\u0026#34;top\u0026#34;\u0026gt;$title\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt;\\n\u0026lt;hr\u0026gt;\\n)); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div align=center\u0026gt;\\n\u0026#34;; print qq(\u0026lt;a href=\u0026#34;#top\u0026#34;\u0026gt;Top\u0026lt;/a\u0026gt;\\n\u0026lt;hr\u0026gt;\\n); printLinks(); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\\n\u0026lt;div align=right\u0026gt;\\n\u0026#34;; $timeEnd = sprintf(\u0026#34;%.3f\u0026#34;, times - $timeBegin); print \u0026#34;Cost : $timeEnd\u0026lt;br\u0026gt;\\n\u0026#34;; print $info_copyright; print \u0026#34;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\\n\u0026#34;; } sub printLinks{ my $cnt = 0; foreach(keys %usr_links){ print \u0026#34;/ \u0026#34; if($cnt++); Jprint(qq(\u0026lt;a href=\u0026#34;$usr_links{$_}\u0026#34;\u0026gt;$_\u0026lt;/a\u0026gt;\\n)); } print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; } sub Jprint{ foreach(@_){ my $tmp = $_; jcode::convert($tmp, $usr_outcode); print $tmp; } } ","date":"2000-10-07T13:42:47+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/134247/","title":"漢字コードの変換（その３）"},{"content":"エラーがなければそれに越したことはないけれど、開発中のスクリプトではエラーが発生してしまうのはよくあることだ。\n問題は、CGIとして実行すると、簡単にエラー出力を見れないこと。ファイルのロックのページで書いた方法では、文法間違いは（Apacheでは）表示されなかった。\nで、先日手に入れた「実用 Perlプログラミング（発行所／オライリー・ジャパン）」によれば、「BEGIN」というサブルーチン（？）はコンパイルする前、つまり、全体の文法チェックなどをする前に実行するらしい。\nということは、標準エラー出力の内容を標準出力に出力するような命令（ややこしい言い方(^^;;;）を「BEGIN」に書いておけば、文法エラーもちゃんとブラウザでチェックできる。\nあと、1行目は今まで「#!perl」と書いていたけれど、freewebを借りたとき、ここのPerlが「/usr/local/bin/perl」にあるようなので、ローカル環境（のApache）でもこの設定で動くように環境を変更した。で、その環境とは？\nApacheが入っているドライブ、仮に「c:apache」に入っている場合、CGIからディレクトリの「/」を指定すると「c:」が対象になる。これはCGIファイル自体のドライブは関係ないようだ。ということで、ActivePerlならインストールディレクトリを「c:usrlocal」にする。そうすると、実際のPerlは「c:usrlocalbinperl.exe」に存在する。つまり、Apacheで動作しているCGIからは「/usr/local/bin/perl」でPerlが呼び出せることになるのだ。\nそういうわけで、これからは「#!/usr/local/bin/perl」で行きます。\nまた、最初の行に、Perlで使用するオプションを付け加えて書くと、そのオプションをつけて実行してくれる。仮に「-v」をつけると、コンパイルせずにバージョン情報だけを出力してくれた（笑）\n一般的には「-w」をつけて、細かいエラーの探索に使えそうだ。このオプションをつけると、変数名の間違い程度なら簡単に判明する。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。また、同じ理由で、「このスクリプトを実行するのは好ましくない」と思ったので取りやめました。\nちなみに、今のプロバイダのNETAGEでは「#!/usr/bin/perl」です（2000年5月現在）。\nソースコード 1 2 3 4 5 6 7 8 9 10 #!/usr/bin/perl -w BEGIN { print \u0026#34;Content-type: text/plain\\n\\n\u0026#34;; open(STDERR, \u0026#34;\u0026gt;\u0026amp;STDOUT\u0026#34;); $| = 1; } { # ...existing code... ","date":"2000-10-07T13:42:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/134200/","title":"エラーをブラウザで見る"},{"content":"漢字コードの変換にかかった時間（単位：秒） 入力コード 出力コード sjis euc jis utf8 sjis 2.57 19.39 29.82 53.11 euc 19.06 2.49 14.39 39.39 jis 29.94 15.21 2.58 49.59 utf8 65.41 50.92 60.75 2.58 今回もサンプルの実行はありません。\nミリ秒単位での速度比較の方法を知ったので、もう一度試してみました。ミリ秒単位だと、データとしてもそれっぽいです。\n「jis」から「sjis」「euc」への変換は、逆の場合とそれほど変わらないみたいです。どうやら、前回は嘘を書いていたようです (^^;;;\nしかし、測定のタイミングなのか「誤差」が結構あります。仕方の無い事なのでしょうか・・・。\n今回使ったのは「Benchmark」というライブラリ（パッケージ？）で「ActivePerl519」に入っていました。とはいえ、その存在を知ったのは、とほほさんの「ラウンジ」なんですけど・・・。\n他にも「times」という関数（？）で実行時間（？）が「ミリ秒」単位で取得できるようです。ただ、スクリプトの最初に書くと普段は「0000」なのですが、時々「0.05」などと言われる事があるので、どの瞬間からの時間なのかはよくわかりません。\nただ、便利なのは便利です。「time」で引き算をしても「0秒」ばかりだったので・・・。\nそういえば、前回はわざわざ時刻に変換して計算をしていたけど、「time」は「グリニッジ標準時の1970年1月1日0時0分0秒」からの秒数を返すので、変換せずにそのまま引き算をすれば簡単に答えが出ていた・・・。「time」も計算できる事に何故気づかなかったのか（笑）\n掲示板を作るために色々なスクリプトを参考していると、「なるほど」な事がたくさんあった。やはり「作る過程で習得する」のが性にあっているらしい。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/usr/bin/perl use Benchmark; use Jcode; $count = 50000; $icode = \u0026#39;sjis\u0026#39;; # $icode = \u0026#39;euc\u0026#39;; # $icode = \u0026#39;jis\u0026#39;; # $icode = \u0026#39;utf8\u0026#39;; $japanese = \u0026#39;あいうえお阿衣兎得緒\u0026#39;; \u0026amp;Jcode::convert($japanese, $icode); print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;pre\u0026gt;\\n\u0026#34;; @t = timethese($count, { \u0026#39;to_SJIS\u0026#39; =\u0026gt; \u0026#39;\u0026amp;to_sjis;\u0026#39;, \u0026#39;to_EUC\u0026#39; =\u0026gt; \u0026#39;\u0026amp;to_euc;\u0026#39;, \u0026#39;to_JIS\u0026#39; =\u0026gt; \u0026#39;\u0026amp;to_jis;\u0026#39;, # \u0026#39;to_UTF8\u0026#39; =\u0026gt; \u0026#39;\u0026amp;to_utf8;\u0026#39; }); print \u0026#34;\u0026lt;/pre\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; exit(0); sub to_sjis { \u0026amp;Jcode::convert($japanese, \u0026#39;sjis\u0026#39;, $icode); } sub to_euc { \u0026amp;Jcode::convert($japanese, \u0026#39;euc\u0026#39;, $icode); } sub to_jis { \u0026amp;Jcode::convert($japanese, \u0026#39;jis\u0026#39;, $icode); } sub to_utf8 { \u0026amp;Jcode::convert($japanese, \u0026#39;utf8\u0026#39;, $icode); } ","date":"2000-10-07T13:39:06+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133906/","title":"変換にかかる時間（その2）"},{"content":"漢字コードの変換にかかった時間（単位：秒） 入力コード 出力コード sjis euc jis utf8 sjis 2 19 29 54 euc 19 2 14 39 jis 31 16 3 49 utf8 64 49 60 3 今回はサンプルの実行はありません。\n現時点では、perlでのミリ秒単位の時間取得方法を知らないので、秒単位の記録です。多少データとして出来過ぎな気もしますが、サンプル文字も適当なのであくまで参考ということで・・・。\n入力と出力の漢字コードが同じ場合は、どのコードでもほぼ同じ時間で終了しています。全体的に見ると、「euc」が変換にかかる時間は短いようです。\n「jis」からの変換では、「sjis」や「euc」からの変換よりも多少時間が必要なのかもしれません。何度やっても1,2秒は違います。何をしているのでしょう？\nで、やはりというか「utf8」は時間がかかっています。そして逆の変換はさらに時間が必要です。最初は計算が違ったのかと思いましたが、10秒前後ずれます。どんな変換が必要なのでしょうか・・・？\n「Jcode.pm」のソースを見てわかったのですが、「convert」で「入力コード」を指定しないときは「getcode」でコードを取得するようです。\nそれにしても、「Jcode.pm」のソースは何度見ても文法がさっぱりです。これが「perl5」の書き方なのでしょうか・・・。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #!/usr/bin/perl # 初期設定 use Jcode; $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; *Jgetcode = \u0026amp;Jcode::getcode; *Jconvert = \u0026amp;Jcode::convert; $G_myCode = \u0026amp;Jgetcode(\u0026#34;漢字\u0026#34;); $G_code = \u0026#34;jis\u0026#34;; $G_charset = \u0026#34;iso-2022-jp\u0026#34;; { $icode = \u0026#39;sjis\u0026#39;; # $icode = \u0026#39;euc\u0026#39;; # $icode = \u0026#39;jis\u0026#39;; # $icode = \u0026#39;utf8\u0026#39;; $ocode = \u0026#39;sjis\u0026#39;; # $ocode = \u0026#39;euc\u0026#39;; # $ocode = \u0026#39;jis\u0026#39;; # $ocode = \u0026#39;utf8\u0026#39;; print(\u0026#34;Content-type: text/html\\n\\n\u0026#34;); $japanese = \u0026#39;あいうえお阿衣兎得緒\u0026#39;; $japanese = \u0026amp;Jconvert($japanese, $icode); print(\u0026amp;getTime); print(\u0026#39; : BeginTime \u0026#39;); print(\u0026#34;\u0026lt;br\u0026gt;\u0026#34;); for(1 .. 50000){ \u0026amp;Jconvert($japanese, $ocode, $icode); } print(\u0026amp;getTime); print(\u0026#39; : EndTime\u0026#39;); exit(0); } sub getTime{ my ($sec,$min,$hour,$day,$mon,$year) = localtime(time); return sprintf(\u0026#34;%4d/%02d/%02d %02d:%02d:%02d\u0026#34;, $year+1900,$mon+1,$day,$hour,$min,$sec); } ","date":"2000-10-07T13:36:15+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133615/","title":"変換にかかる時間"},{"content":"2つ（もしくはそれ以上）の異なったデータを、同じファイルへ同時に書き込んでしまうような事がもし起これば、そのデータは、本来あるべき姿からは遠く離れた状態になるでしょう（直訳みたいな文だ（笑））。\n要は、データを書き込んでいる最中に、他から書き込んでしまうと、ファイルの中身が滅茶苦茶になるって事。\nいかにプログラムでも、実行中の他のプログラムの中までは見る事ができないので、こういった事は対策をしていないと起きる可能性が高い。だから、外に存在するファイルなどの「プログラムが共通で扱えるもの」を媒介にして現在の状況を報告しあうことで、実行（特にファイルへの書き込み）を制御する。その制御方法が「排他処理」で、「ロック」と呼ばれている（と思いこんでいる）。\n実際にロックをしないで、ファイルを壊す実験をしてみた。実験で使ったファイルは2種類。最初のテストでは、なかなかうまく壊せなかったけど、次のテストでは、簡単に壊れた。どちらの実験もJavaScriptの「window.open(実行ファイル)」で2，3枚のウィンドウを開くだけ。ウィンドウの起動が速いブラウザだと、「最初のテスト」でも時間が重複するようだ。でも、書き込み処理の間に「sleep」で眠ってもらったらいちころですね。それを思いつくまで色々大変でした。\nファイルのロックを敬遠していたというのもあるけど、今回はいろいろなことを試したような気がする。ホントに書ききれるのか・・・。まず、やった（と思われる）ことを整理してみる。\nファイルのロック（ロック形式はmkdir。） エラーメッセージのブラウザへの出力（dieを使用。実行時よりも、開発時向き。） 標準出力をファイル出力へ一発切替（まさかそんな利用法があったとは。でも、まだ未知数。） ある意味セキュリティ対策（稼動CGIのソース公開なので・・・とか言ってみたり。） シグナル処理（Windowsでは使えないのか？） ファイルの蓄積（これで掲示板も夢じゃない（？）） その他（sleep、入力文字列の置換方法の強化（？）、useとrequire、など。） あと、サーバに使っている「AnHttpd」（と、よく呼ばれているソフト）の設定で、「CGI出力の検査」をチェックしておけば、エラーメッセージがちゃんと返ってきていた。\nそれにしても、このソフトは、環境変数の「SERVER_SOFTWARE」では「AnWeb」という名前だったりする。そして、ヘルプでは「HTTP Daemon」だったり。なんと呼べばいいんだろうか？\nとにかく、CGIのデバッグ（というか、開発時の間違い発見）は簡単にできるようになった。今までの苦労はこれで少しは報われる（と思いたい）。\nではまず、ファイルのロック。\n通常だと「flock」という命令でファイルにロックを掛けることができる。Windowsでは使えない（らしい。試していない）ので、詳しいことは抜きにする。ファイルのロックが確実なら、それだけファイルの安全性が保証される。ただし、ロックが確実だからといって、確実にファイルが守られるわけではない。ファイル書込み中に停電になったとか、システムが止まったとか、など継続実行ができない状態になる要素は色々あるから。\nデータファイルの保全を考えると、ファイルのロックは基本だということ。ロック以外にも色々とコツがあるようだが、それについてはとりあえず置いておく。でも、実際に掲示板などで使用する場合はデータの保全をちゃんと考える必要がある。特にバックアップは必要な事でしょう。\nで、ロックの方法で「flock」以外だと、書込み中だけファイルなどを作成して、それが存在する間は、書き込みできないようにする方法がある。\n「ファイルなど」と書いているのに、何故ここではファイルではなくディレクトリなのかというと、ディレクトリの方が扱いが簡単だから。\nperlでは、ファイルの扱いが難しい。特に、「ファイルを作成する」だけの命令がないし、普通に書き込むように「open」すると上書きしてしまう。これではロックに使う意味がないので、まず最初にファイルの存在をチェックする必要があり、面倒な手間がかかる。\nそれに、もし「存在をチェックしてから、ロック用ファイルを作成するまでの間」に、他のプログラムがロック用ファイルを作成していたら・・・。当然それに気づかないので「ロック用ファイルを上書き」してしまい、ロックは失敗してしまう。\nその点、ディレクトリだと、「ディレクトリを作成する命令（mkdir）」がある。それに、同じ名前のディレクトリがあると、作成しようとしても上書きができないので作成に失敗する。「mkdir」は作成に失敗すると「0（もしくはperlで偽を示す値）」を返し、成功すれば、ディレクトリを作成した後に「1（もしくはperlで真を示す値）」を返す。つまり、if文の中で使う事で「すでに存在しているか」のチェックと「ディレクトリの作成」が同時にできることになり、ファイルの時の様にタイムラグが発生しないので、ロックが失敗する事もない。\nそういうわけで、ディレクトリをロックのフラグに使っている。プログラムの中で、この「ロック用ディレクトリ」が存在している間は「データファイルに書き込みができない」ようにしておけば、そのプログラムが2つ以上同時に起動していても、ファイルを上書きしてしまう事は無い。\n当然データファイル自体をロックしているわけではないので、他のプログラムからは改変される事もある。もし、別のプログラムでも同じ「データファイル」を扱うならば、「ロック用ディレクトリ」も同じ名前（もちろん作成する場所も）にする必要がある。このサンプルには3種類のプログラム（厳密に言うと漢字コードと改行コードが違うだけ）があるけど、データファイルが同じでも、ロック形式が同じなので、ロック不全によるファイルの破損はおきない。\nただ、このロック方法は、ロックを掛けることについては完全だけど、ロックを解除する方に問題がある。何事もおきなければ「rmdir」によってディレクトリは削除され、同時にロックも解除される。しかし、ロック中に何かの影響でプログラムが中断されると、ディレクトリが削除されないままになってしまうのでロックが解除されない。放っておけば永遠にそのプログラムは機能しない事になる。\nここで出てくるのがシグナル処理。\nハッキリ言って仕組みはよくわからないけど、なにかアクシデントが起きたときに、実行中のプログラムに対してシグナル（信号でいいのか？）が送られてくる。シグナル処理は、その「シグナルを受け取ったときに実行させるプログラム」を設定する事で、不慮の事故に対応しようというもの。というように解釈している。\nWindowsでは、そのシグナルが送られないのか、「不慮の事故」を故意に起こしても削除されていなかった・・・。よくわからない。是非ともUNIXで実行してみたいぞ・・・。\n・・・と思っていたけど、サーバによるみたいな気がしてきた。「Apache/1.3.9 (Win32)」だと、ちゃんと処理されているみたい。\n・・・と思っていたんだけどね?。ディレクトリが削除されるのは、先に送った実行プロセス（？）が、ちゃんと動作していたからのようだ。シグナルが本当に送られているのか調べる方法があったので、一応調べてみたけど、何も送られていなかった。う?ん・・・。Windowsがいけないのか？？？\nともかく、シグナル処理がうまく働かなければ、ロックが解除されないので、ロックを掛ける段階でロックディレクトリが存在するとき、その作られた時間を見て、1分以上前に作られたものなら削除する。という事をしている。強制的にロックを解除するので、あまり良くはないけど・・・。\n話は変わって、ブラウザへのエラーメッセージ出力。\n「die」という命令（？）を、例えば\nopen(OUT, \u0026ldquo;\u0026raquo; $file\u0026rdquo;)||die \u0026ldquo;File open Error!!n\u0026rdquo;; のように使うと、「$file」のファイルを追加書き込み形式で開けない時に、文字列「File open Error!!」を標準エラー出力に吐き出して、プログラムの実行が中止される。文字列の最後に「n」が無い場合（または文字列が無い場合）は、perlが出すエラーメッセージも追加される。普通だとこのメッセージはブラウザでは読めない。「AnHttpd」なら設定さえすれば、このエラーメッセージをブラウザに対して送信してくれるけど、「Apache」では「エラー500（Internal Server Error）」が出るだけ。ただ、これらのサーバは、エラーが発生した際に表示する、ファイル（CGIも可能）を設定できるので、そちらでうまくやれば出来るのかもしれないけど・・・。\nともかく、標準エラー出力（ハンドル：STDERR）を、標準出力（ハンドル：STDOUT）で表示させるためには\nprint \u0026ldquo;Content-type: text/htmlnn\u0026rdquo;; open(STDERR, \u0026ldquo;\u0026gt;\u0026amp;STDOUT\u0026rdquo;); $|=1; を最初の方に書く。こうすれば、エラーもブラウザに出力されるので、パーミッション（Windows95/98では「読み取り専用」とか）の影響で、ファイルに書き込みが出来ないなどのエラーが把握できる。ただ、このファイルが正しく実行されるようになって、はじめて有効になるので、純粋な「文法間違い」のようなエラーは無理。\n本来なら、デバッグのために出力するなら、「Content-type」は「text/plain」が良いと思うんだけど、IE4などでは、何故かダウンロード画面になったりするので、使いにくい。サーバの言う事をちゃんと聞いてくれないブラウザは困ります・・・。また、デバッグが終わったら、コメントにするか、削除しないと、余計な文字が見えるし、基本的に出力が「HTML」ではないので、表示できないブラウザもあるかもしれないから注意しよう。\nあと、これは「||」の（特殊な？）使い方になるけど、先の例で言う「open」が失敗すると、「||」の後ろにある構文を実行するようだ。つまり、「die」の変わりに、サブルーチンを実行するようにしておけば、そちらが実行されることになる。この場合は、最終的に「exit」なり「die」を使わないと、サブルーチンから処理が戻ってくるので、注意が必要だけど。\nそれで、この「エラーをブラウザで表示する」やり方から、「標準出力をファイルにする」方法として考えてしまったのがこれ。\nopen(STDOUT, \u0026ldquo;\u0026gt; $file\u0026rdquo;); ただ、これをやってしまうと、「close」して、再度「STDOUT」に対して「open」しなおしても、ブラウザには何も出力されないようなので、きっと間違った使い方なんだろう・・・。ハンドルを指定せずに「print」をすると、普通は「標準出力（STDOUT）」に出力される。ただ、「select」という命令（？）を使うと、ハンドルの切替ができるらしい。情報不足で良くわからないから試してないけど・・・。こっちの方が、たぶん正しいやり方なのだろう。\n次はセキュリティ対策・・・と言うには少しお粗末すぎるけど、自分以外から送信されたデータは受付けないようにしてみた。\nやっている事は単純。環境変数の「HTTP_REFERER」に、「SCRIPT_NAME」と「HTTP_HOST」が入っているかを調べているだけ。これなら、もし余所から間違ったデータが送られても受付けない。はず。本当はもう少し考えたけど、実際に稼動しているスクリプトのソースを見れるようにしているので、「あまり意味が無い」と思ってやめた。\nで、ファイルの蓄積。\nただ単に「追加書き込み」をしているだけだけど・・・。\nそれでも、実際に追加書き込みをしてみると、なんとなく嬉しく思ってしまう・・・。ちゃんとファイルの操作をしてるんですね?。\nこの他にもいろいろとあった。\n「sleep」はプログラムを中断（？）できる。厳密な動作は良くわからないけど、「sleep 10;」で「10秒間」プログラムを中断する。これはカッコで囲んでも、囲まなくてもいいみたい。この命令に限らず、「print」などでもカッコがあっても無くても動作する。基本的につけた方が安心はするけど・・・。とくに、「print」は、日本語が混ざった場合はサブルーチンで出力するようにしているので、カッコをつけておいた方が後々変更しやすい。・・・そう言いながら、ほとんどつけていないような気がするけど。\nあと、フォームからのデータの変換方法を、少し付け足してみた。この変換については、入力データについての色々な情報が必要だと思うので、今後も注意してみたい。このような（正規表現での？）変換処理は時間がかかるらしいので、次は時間でも測定してみようかと思っていたり。\nそれで、これまでは送信データの漢字コードは「OSに依存している（例えばWindowsならShift_JIS）」と思っていたけど、少なくともIE4/5では表示されている漢字コードで送信されるようだ。これを調べるのに、画面に表示されているコードと、入力したコードを出力できるようにしてみた。いろんなブラウザで試してみると面白いかもしれない。\n「Jcode」は「use」でも使えるらしい。でも、「use」と「require」とで何が違うのかは・・・さっぱりわからない。それに「jcode.pl」にも「use」が使えるかもしれないし・・・。「Jcode.pm」についてきた書類や、配布サイトを見てサンプルコード（全然意味がわからない）を真似してみたけど、うまくいかなかった・・・。文法がわかっていないから、このあたりは苦労する。やっぱり本は必要だなぁ・・・。\n「など」と書いていたけど、この他に何をしたのか、何を書きたかったのか覚えていない。ソースを見ても思い出せないから、きっと大したことじゃないとは思うけど・・・。ちょっと気になる。\nそれにしても、長すぎ。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。よって「Unicode（UTF-8）」は使えなくなってます。\nあと、「jcode.pl」では、リファレンスで渡さないと「getcode」できないのを思い出したので、ここからは変更します・・・。\nついでに「画面表示」が「sjis」のスクリプトで文字化けしているのは愛嬌という事で・・・。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 #!/usr/bin/perl # print \u0026#34;Content-type: text/htmlnn\u0026#34;; # open(STDERR, \u0026#34;\u0026gt;\u0026amp;amp;STDOUT\u0026#34;); # $|=1; # 初期設定 # require Jcode; # $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; # *Jgetcode = \u0026amp;amp;Jcode::getcode; # *Jconvert = \u0026amp;amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; $JcodeVer = \u0026#34;jcode.pl $jcode::version\u0026#34;; *Jgetcode = \u0026amp;amp;jcode::getcode; *Jconvert = sub { \u0026amp;amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $G_title = \u0026#34;テスト２０\u0026#34;; # $G_myCode = \u0026amp;amp;Jgetcode(\u0026#34;漢字\u0026#34;); $G_myCode = \u0026amp;amp;Jgetcode(\u0026#34;漢字\u0026#34;); $G_code = \u0026#34;jis\u0026#34;; $G_charset = \u0026#34;iso-2022-jp\u0026#34;; %G_form=(); $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ # _1,_uなどと共通で使用する項目 $G_scrName = $\u0026amp;amp;; $G_dataFile = \u0026#34;dat/$G_scrName.dat\u0026#34;; $G_lock = \u0026#34;lock/$G_scrName\u0026#34;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; $G_linkName = $G_title; } { \u0026amp;amp;sigInit; if($#ARGV == -1){ \u0026amp;amp;selectCode; }elsif( $ENV{\u0026#39;HTTP_REFERER\u0026#39;} !~ /$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}/ || $ENV{\u0026#39;HTTP_REFERER\u0026#39;} !~ /$ENV{\u0026#39;HTTP_HOST\u0026#39;}/ ){ exit; # }elsif($ARGV[0] eq \u0026#34;utf8\u0026#34;){ # $G_code = \u0026#34;utf8\u0026#34;; # $G_charset = \u0026#34;UTF-8\u0026#34;; # \u0026amp;amp;printForm(\u0026#34;post\u0026#34;); }elsif($ARGV[0] eq \u0026#34;sjis\u0026#34;){ $G_code = \u0026#34;sjis\u0026#34;; $G_charset = \u0026#34;shift_jis\u0026#34;; \u0026amp;amp;printForm(\u0026#34;post\u0026#34;); }elsif($ARGV[0] eq \u0026#34;euc\u0026#34;){ $G_code = \u0026#34;euc\u0026#34;; $G_charset = \u0026#34;euc-jp\u0026#34;; \u0026amp;amp;printForm(\u0026#34;post\u0026#34;); }elsif($ARGV[0] eq \u0026#34;jis\u0026#34;){ \u0026amp;amp;printForm(\u0026#34;post\u0026#34;); }elsif($ARGV[0] eq \u0026#34;output\u0026#34;){ \u0026amp;amp;formRead; \u0026amp;amp;formWrite; }elsif($ARGV[0] eq \u0026#34;read\u0026#34;){ \u0026amp;amp;dataOpen; }else{ \u0026amp;amp;error(\u0026#34;\u0026lt;h2\u0026gt;無効なコマンドが渡されました。\u0026lt;/h2\u0026gt;\u0026#34;); } exit; } sub sigInit{ $SIG{\u0026#39;PIPE\u0026#39;} = \u0026#34;sigExit\u0026#34;; $SIG{\u0026#39;INT\u0026#39;} = \u0026#34;sigExit\u0026#34;; $SIG{\u0026#39;HUP\u0026#39;} = \u0026#34;sigExit\u0026#34;; $SIG{\u0026#39;QUIT\u0026#39;} = \u0026#34;sigExit\u0026#34;; $SIG{\u0026#39;TERM\u0026#39;} = \u0026#34;sigExit\u0026#34;; } sub sigExit{ \u0026amp;amp;dataUnlock; exit; } sub error{ $G_title .= \u0026#34;（エラー）\u0026#34;; \u0026amp;amp;printHeader; \u0026amp;amp;Jprint(@_); \u0026amp;amp;printFooter; exit; } sub selectCode{ $G_title .= \u0026#34;（漢字コード選択）\u0026#34;; \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;p\u0026gt;入力フォームで使用する漢字コードを選んでください。\u0026lt;/p\u0026gt;n\u0026#34;); print \u0026lt;\u0026lt;EOM; \u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?jis\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;JIS(iso-2022-jp)\u0026#34;\u0026gt;\u0026lt;/form\u0026gt; \u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?sjis\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;Shift_JIS\u0026#34;\u0026gt;\u0026lt;/form\u0026gt; \u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?euc\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;EUC-JP\u0026#34;\u0026gt;\u0026lt;/form\u0026gt; EOM # 以下の一行を削除した # \u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?utf8\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;Unicode(UTF-8)\u0026#34;\u0026gt;\u0026lt;/form\u0026gt; print qq(\u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?read\u0026#34;\u0026gt;n); \u0026amp;amp;Jprint(qq(\u0026lt;input type=submit value=\u0026#34;過去ログ（？）を見る\u0026#34;\u0026gt;n)); print \u0026#34;\u0026lt;/form\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; } sub dataLock{ local($i, $mtime); for($i=0;$i\u0026lt;2;$i++){ if(mkdir($G_lock, 0755)){ return; }else{ unless($i){ ($mtime) = (stat($G_lock))[9]; if ($mtime \u0026lt; time() - 60) { # １分以上前のロックは解除 rmdir($G_lock); } } } } \u0026amp;amp;error(\u0026#34;\u0026lt;h2\u0026gt;現在、ロック中です。ごめんなさい。\u0026lt;/h2\u0026gt;\u0026#34;); } sub dataUnlock{ if(-d $G_lock){ rmdir($G_lock); } } sub dataOpen{ $G_title .= \u0026#34;（過去ログ）\u0026#34;; \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; \u0026amp;amp;dataLock; open(IN, \u0026#34;\u0026lt;$ G_dataFile\u0026#34;)||die \u0026#34;Can not open $G_dataFile....\u0026#34;; # データファイルはEUC記録なので時間短縮のつもり。 # 標準出力は「jis」だけど・・・。 if($G_code eq \u0026#34;euc\u0026#34;){ print while (\u0026lt;IN\u0026gt;); }else{ while (\u0026lt;IN\u0026gt;){ print \u0026amp;amp;Jconvert($_, $G_code, \u0026#34;euc\u0026#34;); } } close(IN); \u0026amp;amp;dataUnlock; print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; } sub formWrite{ local($name, $value); \u0026amp;amp;dataLock; open(OUT, \u0026#34;\u0026gt;\u0026gt; $G_dataFile\u0026#34;)||die \u0026#34;Can not open $G_dataFile....\u0026#34;; print(OUT \u0026#34;\u0026lt;table border=1\u0026gt;n\u0026#34;); print(OUT \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;Name\u0026lt;th\u0026gt;Value\u0026lt;/tr\u0026gt;n\u0026#34;); while (($name, $value) = each(%G_form)){ print(OUT \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;$name\u0026lt;td\u0026gt;$value\u0026lt;/tr\u0026gt;n\u0026#34;); } sleep 5; print(OUT \u0026#34;\u0026lt;/table\u0026gt;n\u0026#34;); close(OUT); \u0026amp;amp;dataUnlock; $G_title .= \u0026#34;（送信完了）\u0026#34;; \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;p\u0026gt;たぶん、無事に送信されました。n\u0026#34;); \u0026amp;amp;Jprint(qq(\u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?read\u0026#34;\u0026gt;心配だから、過去ログを見る。\u0026lt;/a\u0026gt;n)); print \u0026#34;\u0026lt;/p\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; } sub formRead{ local($query_string, @elements, $elm, $name, $value, $code, $method); $method = $ENV{\u0026#39;REQUEST_METHOD\u0026#39;}; if($method eq \u0026#34;POST\u0026#34;){ read(STDIN, $query_string, $ENV{\u0026#39;CONTENT_LENGTH\u0026#39;}); }elsif($method eq \u0026#34;GET\u0026#34;){ $query_string = $ENV{\u0026#39;QUERY_STRING\u0026#39;}; }else{ \u0026amp;amp;error(\u0026#34;\u0026lt;h2\u0026gt;「POST」か「GET」のデータしか受け取れません。\u0026lt;/h2\u0026gt;\u0026#34;); } @elements = split(/\u0026amp;amp;/, $query_string); # 中身はpostもgetも同じ foreach $elm (@elements){ ($name, $value) = split(/=/, $elm); $value =~ tr/+/ /; $value =~ s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;C\u0026#34;, hex($1))/eg; # $code = \u0026amp;amp;Jgetcode($value); $code = \u0026amp;amp;Jgetcode($value); if($code ne \u0026#34;euc\u0026#34;){ $value = \u0026amp;amp;Jconvert($value, \u0026#34;euc\u0026#34;, $code); # とりあえずEUCに変換 } $value =~ s/\u0026amp;amp;/\u0026amp;amp;amp;/g; # メタ文字（？）を無効化 # $value =~ s/\u0026lt;!--/\u0026amp;amp;lt;!--/g; # SSI入力を無効化 # $value =~ s/--\u0026gt;/--\u0026amp;amp;gt;/g; # SSI入力を無効化 $value =~ s/\u0026lt;/\u0026amp;amp;lt;/g; # タグを無効化 $value =~ s/\u0026gt;/\u0026amp;amp;gt;/g; # タグを無効化 $value =~ s/rn*/n/g; # 改行を統一 $value =~ s/nnn+/nn/g; # 長い改行（３回以上）を２回（１行空き）に $value =~ s/[ns]+$//g; # 最後の連続した空白、改行を削除 $value =~ s/n/\u0026lt;br\u0026gt;/g; # 改行を\u0026lt;br\u0026gt;に変換 $G_form{$name} = $value .\u0026#34;\u0026lt;br\u0026gt;InputCode : $coden\u0026#34;; } } sub printForm{ $G_title .= \u0026#34;（入力画面）\u0026#34;; \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; print qq(\u0026lt;form method=$_[0] action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?output\u0026#34;\u0026gt;n); \u0026amp;amp;Jprint(qq(\u0026lt;input type=hidden name=tx0 value=\u0026#34;画面表示：$G_codenブラウザ：$ENV{\u0026#39;HTTP_USER_AGENT\u0026#39;}nスクリプト：$G_myCode\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n)); print qq(\u0026lt;input type=text name=tx1 value=\u0026#34;tx1\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n); \u0026amp;amp;Jprint(\u0026#34;\u0026lt;textarea name=ta1 cols=40 rows=4\u0026gt;ta1n何か適当にどうぞ。n\u0026lt;/textarea\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;); \u0026amp;amp;Jprint(\u0026#34;\u0026lt;p\u0026gt;送信し、データを書き込んでいる最中に５秒間待ちます。\u0026lt;/p\u0026gt;n\u0026#34;); \u0026amp;amp;Jprint(\u0026#34;\u0026lt;p\u0026gt;この間は、しばらく待つか、他のブラウザなどから「送信」を試してみてください。\u0026lt;/p\u0026gt;n\u0026#34;); \u0026amp;amp;Jprint(qq(\u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}\u0026#34;\u0026gt;ブラウザをもう一枚開く\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;n)); \u0026amp;amp;Jprint(qq(\u0026lt;input type=submit value=\u0026#34;送信する\u0026#34;\u0026gt;n)); print \u0026#34;\u0026lt;/form\u0026gt;n\u0026#34;; print qq(\u0026lt;form method=$_[0] action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?read\u0026#34;\u0026gt;n); \u0026amp;amp;Jprint(qq(\u0026lt;input type=submit value=\u0026#34;過去ログ（？）を見る\u0026#34;\u0026gt;n)); print \u0026#34;\u0026lt;/form\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; } sub printHeader{ if($G_charset){ print \u0026#34;Content-type: text/html; charset=$G_charsetnn\u0026#34;; }else{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; } print qq(\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;n); print \u0026#34;\u0026lt;html lang=ja\u0026gt;n\u0026lt;head\u0026gt;n\u0026#34;; if($G_charset){ print qq(\u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=$G_charset\u0026#34;\u0026gt;n); } print qq(\u0026lt;meta http-equiv=\u0026#34;Content-Script-Type\u0026#34; content=\u0026#34;text/javascript\u0026#34;\u0026gt;n); print qq(\u0026lt;meta http-equiv=\u0026#34;Content-Style-Type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;n); \u0026amp;amp;Jprint(\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;n\u0026#34;); foreach (@G_styles){ print qq(\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n); } print \u0026#34;\u0026lt;/head\u0026gt;n\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; # print $ENV{\u0026#39;HTTP_REFERER\u0026#39;}.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;.$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;.$ENV{\u0026#39;HTTP_HOST\u0026#39;}; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;漢字コード変換 ： $JcodeVer\u0026lt;br\u0026gt;n\u0026#34;); open(IN, \u0026#34;../../sig.txt\u0026#34;); print while (\u0026lt;IN\u0026gt;); close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } sub printlinks{ print qq(\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;n); print qq(/n\u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;n); print qq(/n\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n); if($G_linkFile){ \u0026amp;amp;Jprint(qq(/n\u0026lt;a href=\u0026#34;$G_linkFile\u0026#34;\u0026gt;$G_linkNameの解説\u0026lt;/a\u0026gt;n)); } } sub Jprint{ if($G_code eq $G_myCode){ foreach (@_){ print; } }else{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_code, $G_myCode); } } } sub JconvPrint{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_code, \u0026amp;amp;Jgetcode($_)); } } ","date":"2000-10-07T13:33:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133348/","title":"ファイルのロック"},{"content":"ふとしたきっかけで知ったのだけども、perlには新型引用符（？）があるらしい。なかなか面白いことを考えてくれる。\n「新型引用符」というのは「()」に機能を付け加えたもののようで、「q(?)」と書くと「\u0026rsquo;?\u0026rsquo;」に、「qq(?)」と書くと「\u0026quot;?\u0026quot;」になるらしい。「q()」の中では「\u0026rsquo;」をエスケープする必要が無い。同じように「qq()」の中では「\u0026quot;」が文字として有効になる。\nperlの「命令」というか「文法」がいまいち見えてこないけど、「q[?]」や「q/?/」でも大丈夫らしい。でも、何故一度に沢山の記号を使えるようにするのか。例えば、「qq(?)」と「qq[?]」で記号の扱い方を変えるとかすれば、もっと機能的になるのに・・・。いや、ホントは機能が違うのかもしれないけど・・・。\nやはり不思議なのだが、「q(?)」の中では「()」が、「q[?]」の中では「[]」が使える。ただし、組数は等しくし、開いて閉じなければならない。どちらにしろ、エスケープは出来るので紛らわしいことはやめたほうがよさそうだ。\nあと、今回は「Shift_JIS」では全部は表示できなかった。エラーの内容から考えると、文字列の中に「[」を示すコードが入っているようで「[?]」の行が実行できなくなっている。だから、「Shift_JIS版」はその部分を省いた。「表示」が文字化けしている・・・。やはり通常使うのは「EUC」の方がよさそうだ。\nついでだったので、「\u0026rsquo;?\u0026rsquo;」で格納した変数と、「\u0026quot;?\u0026quot;」で格納した変数を、引用符の中で展開したらどうなるかも調べてみた。意外なことだが、「」は「\u0026rsquo;?\u0026rsquo;」の中でも、エスケープされることがわかった。やはり「」を示すには、常にエスケープするように気をつけたほうがいいのかも。その他にも、引用符に使用している記号だけはエスケープされるようだ。使う文字列によって引用符を使い分けるようにすると、案外便利かも。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 #!/usr/bin/perl # 初期設定 # require Jcode; # $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; # *Jgetcode = \u0026amp;amp;Jcode::getcode; # *Jconvert = \u0026amp;amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; $JcodeVer = \u0026#34;jcode.pl $jcode::version\u0026#34;; *Jgetcode = \u0026amp;amp;jcode::getcode; *Jconvert = sub { \u0026amp;amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#39;../../ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;); $G_title = \u0026#39;テスト１９\u0026#39;; $G_myCode = \u0026amp;amp;Jgetcode(\u0026#39;漢字\u0026#39;); $G_Code = \u0026#39;jis\u0026#39;; $G_Charset = \u0026#39;iso-2022-jp\u0026#39;; $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ $G_scrName = $\u0026amp;amp;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; } { \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026lt;table border=1\u0026gt;\u0026#34;; $temp = \u0026#39;\u0026#34;変数\u0026#34;という文字列\u0026#39;; $quotstr = \u0026#39;][)(\u0026#39;\u0026#34;/\\\u0026#39;; $doublequotstr = \u0026#34;][)(\u0026#39;\u0026#34;/\\\u0026#34;; $str = \u0026#39;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026#39;?\u0026#39;を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr\u0026#39;; \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); $str = q(\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;q(?)を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr); \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); $str = q/\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;q/?/を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr/; \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); # $str = q[\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;q[?]を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr]; # \u0026amp;amp;Jprint($str.\u0026#34;nn\u0026#34;); $str = \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026#34;?\u0026#34;を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr\u0026#34;; \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); $str = qq(\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;qq(?)を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr); \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); $str = qq/\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;qq/?/を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr/; \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); # $str = qq[\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;qq[?]を使用\u0026lt;td\u0026gt;$tempを\u0026#34;格納\u0026#34;、\u0026#39;表示\u0026#39;する。\u0026lt;td\u0026gt;][)(\u0026#39;\u0026#34;/\\\u0026lt;td\u0026gt;$quotstr\u0026lt;td\u0026gt;$doublequotstr]; # \u0026amp;amp;Jprint($str.\u0026#34;n\u0026#34;); print \u0026#34;\u0026lt;/table\u0026gt;n\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; exit; } sub printHeader{ if($G_Charset){ print \u0026#34;Content-type: text/html; charset=$G_Charsetnn\u0026#34;; }else{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; } print \u0026#39;\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;n\u0026lt;head\u0026gt;n\u0026#34;; if($G_Charset){ print \u0026#34;\u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=$G_Charset\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Script-Type\u0026#34; content=\u0026#34;text/javascript\u0026#34;\u0026gt;\u0026#39;,\u0026#34;n\u0026#34;; print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Style-Type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;n\u0026#34;); foreach (@G_styles){ print \u0026#34;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;n\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;漢字コード変換 ： $JcodeVer\u0026lt;br\u0026gt;n\u0026#34;); open(IN, \u0026#39;../../sig.txt\u0026#39;); print while (\u0026lt;IN\u0026gt;); close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; if($G_linkFile){ \u0026amp;amp;Jprint (\u0026#34;/n\u0026lt;a href=\u0026#34;$G_linkFile\u0026#34;\u0026gt;$G_titleの解説\u0026lt;/a\u0026gt;n\u0026#34;); } } sub Jprint{ if($G_Code eq $G_myCode){ foreach (@_){ print; } }else{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, $G_myCode); } } } sub JconvPrint{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, \u0026amp;amp;Jgetcode($_)); } } ","date":"2000-10-07T13:33:11+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133311/","title":"新型引用符"},{"content":"一応、「get」での受信をやってみた。受け取り後の内容解析は、前回の時にやってしまったので、今回はARGVの受信部分を少し変更しただけ。\nメソッドが「get」の時は、環境変数の「QUERY_STRING」にフォームの内容が入る。リンクでコマンドを送ると「ARGV」だけでなく「QUERY_STRING」にも入ってしまうので、ちょっと扱いに困るけど・・・。\nとりあえず、この例では「ARGV」をまず見て、それが空の場合だけ動作するようにした。次に「QUERY_STRING」が空なら送信フォームを、そうじゃなければ、その内容を分解して表示するようにした。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 #!/usr/bin/perl # 初期設定 # require Jcode; # $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; # *Jgetcode = \u0026amp;amp;Jcode::getcode; # *Jconvert = \u0026amp;amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; $JcodeVer = \u0026#34;jcode.pl $jcode::version\u0026#34;; *Jgetcode = \u0026amp;amp;jcode::getcode; *Jconvert = sub { \u0026amp;amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#39;../../ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;); $G_title = \u0026#39;テスト１８\u0026#39;; $G_myCode = \u0026amp;amp;Jgetcode(\u0026#39;漢字\u0026#39;); $G_Code = \u0026#39;jis\u0026#39;; $G_Charset = \u0026#39;iso-2022-jp\u0026#39;; %G_form=(); $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ $G_scrName = $\u0026amp;amp;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; } { \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; if($#ARGV == -1){ if($ENV{\u0026#39;QUERY_STRING\u0026#39;}){ \u0026amp;amp;formRead; \u0026amp;amp;formWrite; }else{ \u0026amp;amp;printForm(\u0026#34;get\u0026#34;); } }else{ \u0026amp;amp;error(\u0026#39;\u0026lt;h2\u0026gt;無効なコマンドが渡されました。\u0026lt;/h2\u0026gt;\u0026#39;); } print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; exit; } sub error{ \u0026amp;amp;Jprint(@_); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; exit; } sub formWrite{ local($name, $value); print \u0026#34;\u0026lt;table border=1\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;エレメントの名前\u0026lt;th\u0026gt;エレメントの中身\u0026lt;/tr\u0026gt;n\u0026#34;); while (($name, $value) = each(%G_form)){ \u0026amp;amp;JconvPrint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;$name\u0026lt;td\u0026gt;$value\u0026lt;/tr\u0026gt;n\u0026#34;); } print \u0026#34;\u0026lt;/table\u0026gt;n\u0026#34;; } sub formRead{ local($query_string, @elements, $elm, $name, $value, $code, $method); $method = $ENV{\u0026#39;REQUEST_METHOD\u0026#39;}; if($method eq \u0026#34;POST\u0026#34;){ read(STDIN, $query_string, $ENV{\u0026#39;CONTENT_LENGTH\u0026#39;}); }elsif($method eq \u0026#34;GET\u0026#34;){ $query_string = $ENV{\u0026#39;QUERY_STRING\u0026#39;}; }else{ \u0026amp;amp;error(\u0026#39;methodは「post」か「get」にしてください。\u0026#39;); } @elements = split(/\u0026amp;amp;/, $query_string); # 中身はpostもgetも同じ foreach $elm (@elements){ ($name, $value) = split(/=/, $elm); $value =~ s/+/ /g; # =~ tr/+/ /; と書くのが普通なのか？ $value =~ s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;C\u0026#34;, hex($1))/eg; $code = \u0026amp;amp;Jgetcode($value); if($code ne \u0026#39;euc\u0026#39;){ $value = \u0026amp;amp;Jconvert($value, \u0026#39;euc\u0026#39;, $code); } # とりあえずEUCに変換 $value =~ s/\u0026amp;amp;/\u0026amp;amp;amp;/g; # メタ文字（？）を無効化 $value =~ s/\u0026lt;/\u0026amp;amp;lt;/g; # タグを無効化 $value =~ s/\u0026gt;/\u0026amp;amp;gt;/g; # タグを無効化 $value =~ s/rn?/n/g; # 改行を統一 $value =~ s/n/\u0026lt;br\u0026gt;/g; # 改行を\u0026lt;br\u0026gt;に変換 $G_form{$name} = $value; } } sub printForm{ print \u0026#34;\u0026lt;form method=$_[0] action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?output\u0026#34;\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx1 value=\u0026#34;tx1\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx2 value=\u0026#34;tx2\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;textarea name=tx3 cols=40 rows=4\u0026gt;tx3 日本語 英語 どちらでもnタグなどは無効になります。\u0026lt;/textarea\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;); print \u0026#34;\u0026lt;input type=submit value=\u0026#34;Submit!\u0026#34;\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/form\u0026gt;n\u0026#34;; } sub printHeader{ if($G_Charset){ print \u0026#34;Content-type: text/html; charset=$G_Charsetnn\u0026#34;; }else{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; } print \u0026#39;\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;n\u0026lt;head\u0026gt;n\u0026#34;; if($G_Charset){ print \u0026#34;\u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=$G_Charset\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Script-Type\u0026#34; content=\u0026#34;text/javascript\u0026#34;\u0026gt;\u0026#39;,\u0026#34;n\u0026#34;; print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Style-Type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;n\u0026#34;); foreach (@G_styles){ print \u0026#34;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;n\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;漢字コード変換 ： $JcodeVer\u0026lt;br\u0026gt;n\u0026#34;); open(IN, \u0026#39;../../sig.txt\u0026#39;); print while (\u0026lt;IN\u0026gt;); close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; if($G_linkFile){ \u0026amp;amp;Jprint (\u0026#34;/n\u0026lt;a href=\u0026#34;$G_linkFile\u0026#34;\u0026gt;$G_titleの解説\u0026lt;/a\u0026gt;n\u0026#34;); } } sub Jprint{ if($G_Code eq $G_myCode){ foreach (@_){ print; } }else{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, $G_myCode); } } } sub JconvPrint{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, \u0026amp;amp;Jgetcode($_)); } } ","date":"2000-10-07T13:32:38+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133238/","title":"フォームからの入力（その３）"},{"content":"いろいろ試してみた結果、やはりフォームからでは、メソッドが「get」の時は「ARGV」が使えない。「action」に設定しても、フォームの内容に上書きされてしまうのか、無視されるようだ。\nサーバのログを見ると、リンクやイメージでの呼出しは「get」で発生している。おなじ「get」でも、この場合はちゃんと「ARGV」に入ってくれる。フォームで「get」からコマンド的な物を使うには、「type=hidden」で渡すしかないようだ。それはそれで興味深いけど。\nともかく、そういうわけで、この例では「get」では送信できません。っていうか、受信できないのか・・・。送信後に「post」か「get」かを選ぶ画面に戻ってしまいます。\n一つのCGIスクリプトで色々な動作ができるというのは、なかなか面白い。癖になってしまう。\nそういえば、エラーがあるとき、DOSプロンプトから直に実行すると、ちゃんとエラーの内容も出てくれる。エラーがあるときにブラウザから実行すると、「無効なまたは認識されない応答をサーバーが返しました」とか「ドキュメントにデータが含まれていません」とかいうエラーしかでない。これはなかなか貴重だ。チョット面倒だけど・・・。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 #!/usr/bin/perl # 初期設定 # require Jcode; # $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; # *Jgetcode = \u0026amp;amp;Jcode::getcode; # *Jconvert = \u0026amp;amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; $JcodeVer = \u0026#34;jcode.pl $jcode::version\u0026#34;; *Jgetcode = \u0026amp;amp;jcode::getcode; *Jconvert = sub { \u0026amp;amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#39;../../ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;); $G_title = \u0026#39;テスト１７\u0026#39;; $G_myCode = \u0026amp;amp;Jgetcode(\u0026#39;漢字\u0026#39;); $G_Code = \u0026#39;jis\u0026#39;; $G_Charset = \u0026#39;iso-2022-jp\u0026#39;; %G_form=(); $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ $G_scrName = $\u0026amp;amp;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; } { \u0026amp;amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; if($#ARGV == -1){ \u0026amp;amp;printMethodtype; }elsif($ARGV[0] eq \u0026#34;output\u0026#34;){ \u0026amp;amp;formRead; \u0026amp;amp;formWrite; }elsif($ARGV[0] eq \u0026#34;post\u0026#34;){ \u0026amp;amp;printForm(\u0026#34;post\u0026#34;); }elsif($ARGV[0] eq \u0026#34;get\u0026#34;){ \u0026amp;amp;printForm(\u0026#34;get\u0026#34;); }else{ \u0026amp;amp;error(\u0026#39;\u0026lt;h2\u0026gt;無効なコマンドが渡されました。\u0026lt;/h2\u0026gt;\u0026#39;); } print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; exit; } sub printMethodtype{ \u0026amp;amp;Jprint(\u0026#34;\u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?post\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;POSTでの送信フォーム\u0026#34;\u0026gt;\u0026lt;/form\u0026gt;n\u0026#34;); \u0026amp;amp;Jprint(\u0026#34;\u0026lt;form method=post action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?get\u0026#34;\u0026gt;\u0026lt;input type=submit value=\u0026#34;GETでの送信フォーム\u0026#34;\u0026gt;\u0026lt;/form\u0026gt;n\u0026#34;); } sub error{ \u0026amp;amp;Jprint(@_); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; \u0026amp;amp;printFooter; exit; } sub formWrite{ local($name, $value); print \u0026#34;\u0026lt;table border=1\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;エレメントの名前\u0026lt;th\u0026gt;エレメントの中身\u0026lt;/tr\u0026gt;n\u0026#34;); while (($name, $value) = each(%G_form)){ \u0026amp;amp;JconvPrint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;$name\u0026lt;td\u0026gt;$value\u0026lt;/tr\u0026gt;n\u0026#34;); } print \u0026#34;\u0026lt;/table\u0026gt;n\u0026#34;; } sub formRead{ local($query_string, @elements, $elm, $name, $value, $code, $method); $method = $ENV{\u0026#39;REQUEST_METHOD\u0026#39;}; if($method eq \u0026#34;POST\u0026#34;){ read(STDIN, $query_string, $ENV{\u0026#39;CONTENT_LENGTH\u0026#39;}); }elsif($method eq \u0026#34;GET\u0026#34;){ $query_string = $ENV{\u0026#39;QUERY_STRING\u0026#39;}; }else{ \u0026amp;amp;error(\u0026#39;methodは「post」か「get」にしてください。\u0026#39;); } @elements = split(/\u0026amp;amp;/, $query_string); # 中身はpostもgetも同じ foreach $elm (@elements){ ($name, $value) = split(/=/, $elm); $value =~ s/+/ /g; # =~ tr/+/ /; と書くのが普通なのか？ $value =~ s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;C\u0026#34;, hex($1))/eg; $code = \u0026amp;amp;Jgetcode($value); if($code ne \u0026#39;euc\u0026#39;){ $value = \u0026amp;amp;Jconvert($value, \u0026#39;euc\u0026#39;, $code); } # とりあえずEUCに変換 $value =~ s/\u0026amp;amp;/\u0026amp;amp;amp;/g; # メタ文字（？）を無効化 $value =~ s/\u0026lt;/\u0026amp;amp;lt;/g; # タグを無効化 $value =~ s/\u0026gt;/\u0026amp;amp;gt;/g; # タグを無効化 $value =~ s/rn?/n/g; # 改行を統一 $value =~ s/n/\u0026lt;br\u0026gt;/g; # 改行を\u0026lt;br\u0026gt;に変換 $G_form{$name} = $value; } } sub printForm{ print \u0026#34;\u0026lt;form method=$_[0] action=\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?output\u0026#34;\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx1 value=\u0026#34;tx1\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx2 value=\u0026#34;tx2\u0026#34;\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;\u0026lt;textarea name=tx3 cols=40 rows=4\u0026gt;tx3 日本語 英語 どちらでもnタグなどは無効になります。\u0026lt;/textarea\u0026gt;\u0026lt;br\u0026gt;n\u0026#34;); print \u0026#34;\u0026lt;input type=submit value=\u0026#34;Submit!\u0026#34;\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/form\u0026gt;n\u0026#34;; } sub printHeader{ if($G_Charset){ print \u0026#34;Content-type: text/html; charset=$G_Charsetnn\u0026#34;; }else{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; } print \u0026#39;\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;n\u0026lt;head\u0026gt;n\u0026#34;; if($G_Charset){ print \u0026#34;\u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=$G_Charset\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Script-Type\u0026#34; content=\u0026#34;text/javascript\u0026#34;\u0026gt;\u0026#39;,\u0026#34;n\u0026#34;; print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Style-Type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;\u0026#39;.\u0026#34;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;n\u0026#34;); foreach (@G_styles){ print \u0026#34;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$_\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;n\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;amp;Jprint(\u0026#34;漢字コード変換 ： $JcodeVer\u0026lt;br\u0026gt;n\u0026#34;); open(IN, \u0026#39;../../sig.txt\u0026#39;); print while (\u0026lt;IN\u0026gt;); close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; if($G_linkFile){ \u0026amp;amp;Jprint (\u0026#34;/n\u0026lt;a href=\u0026#34;$G_linkFile\u0026#34;\u0026gt;$G_titleの解説\u0026lt;/a\u0026gt;n\u0026#34;); } } sub Jprint{ if($G_Code eq $G_myCode){ foreach (@_){ print; } }else{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, $G_myCode); } } } sub JconvPrint{ foreach (@_){ print \u0026amp;amp;Jconvert($_, $G_Code, \u0026amp;amp;Jgetcode($_)); } } ","date":"2000-10-07T13:32:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133200/","title":"フォームからの入力（その２）"},{"content":"CGIを使うメインとも言えるのが「掲示板」じゃないか？ということは、フォームから文字列を取得しなければいけない。たとえそれが日本語でも・・・。\nハッキリ言って仕組みはよくわからない。実際に使っているCGIから拝借しただけ・・・。\nフォームの中身はブラウザから送信するときは、特に指定しない限り「application/x-www-form-urlencoded」で出力される（Content-Typeがこれになる）。urlに使えない文字（？）は「%hh」の形で変換（エンコード）された形式。これを元に戻す（デコード）のが次の命令。\n1 s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;C\u0026#34;, hex($1))/eg; とりあえず、「pack(\u0026ldquo;C\u0026rdquo;, hex($1))」を実行した形式で置きかえるらしい。「$1」は正規表現で最初に出てきた「()」の中身を参照する。「hex」は文字列を16進数として解釈し、10進数に変換するようだ。どうやら「pack」は、10進数でしか機能しない関数のようだ。いや、嘘かも・・・。よくわからない。\nあと、メソッド（送信形式？）にも、postやgetなどがあって、それによって受け取り方も変更しなくてはいけない。このサンプルでは「post」の形式しか使えない。\n「CGI」に送信できるのはフォームの中身だけではなく、コマンド的（？）な文字列も渡すことができる。このコマンド（引数の方が相応しいかな？）を使えば、一つのCGIスクリプトで色々な処理をすることができる。このサンプルでは、引数無し（ts0016.cgi）だと「入力フォーム」を出力し、outputをつける（ts0016.cgi?output）とフォームの中身を出力するようにしている。この方法は「post」でしか使えないのか、「get」だと引数を渡すことができなかった。やり方がまずいのかもしれないけど・・・。もう少し調べてみたい。\nこの引数は「@ARGV」という変数（？）に渡される。2つ以上のコマンド（output+input+\u0026hellip;のように書く）がある場合は、「@ARGV」という配列に順次渡される。先の例では「$ARGV[0]」が「output」、「$ARGV[1]」が「input」ということになる。扱い方は、通常の配列と同じようだ。つまり、コマンドが無い場合は「$#ARGV」は「-1」となる。\nところで、「ARGV」というのは、なんという単語の略なのか？覚えにくい・・・。\nフォームの中身は、「post」の場合は「標準入力（STDIN）」に入力される。この入力を解釈するには以下のようにする。\n1 read(STDIN, $query_string, $ENV{\u0026#39;CONTENT_LENGTH\u0026#39;}); これで、送信されたデータが「$query_string」の中に入力される。「$ENV{\u0026lsquo;CONTENT_LENGTH\u0026rsquo;}」は入力されたバイト数を返す環境変数のようだ。「STDIN」から「$ENV{\u0026lsquo;CONTENT_LENGTH\u0026rsquo;}」バイト分のデータを「$query_string」に代入する。とでも解釈すればいいのか・・・。\nこの内容は「名前1=中身1\u0026amp;名前2=中身2\u0026hellip;」のようになっているため、まず「\u0026amp;」を区切りにして配列に入れる（配列 = split(/\u0026amp;/, 文字列)）。次に、その文字列を「=」で区切って「名前」と「中身」に分離する（(名前にする変数, 中身にする変数) = split(/=/, 分離させた文字列)）。そして、「名前」を見出しにして「中身」を連想配列に入れる（$連想配列名{名前} = 中身）。すると、変数の参照時に「名前」を用いる事ができる（$連想配列名(見出し)で内容を参照する）ので、簡単にデータを扱う事が可能となる。詳しい事はソースを見ればわかる。と思う。この一連の流れは、連想配列への格納や参照の方法の勉強にもなる。\nこの他に、色々見なれない命令もあるが、そのうちわかるようになる・・・かもしれない。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 #!/usr/bin/perl # 初期設定 # require Jcode; # $JcodeVer = \u0026#34;Jcode $Jcode::VERSION\u0026#34;; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; $JcodeVer = \u0026#34;jcode.pl $jcode::version\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#39;../../ipp.css\u0026#39;,\u0026#39;../test.css\u0026#39;); $G_title = \u0026#39;テスト１６\u0026#39;; $G_myCode = \u0026amp;Jgetcode(\u0026#39;漢字\u0026#39;); $G_Code = \u0026#39;jis\u0026#39;; $G_Charset = \u0026#39;iso-2022-jp\u0026#39;; %G_form=(); $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ $G_scrName = $\u0026amp;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; } { \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; if($#ARGV == -1){ \u0026amp;printForm; }elsif($ARGV[0] eq \u0026#34;output\u0026#34;){ \u0026amp;formRead; \u0026amp;formWrite; } print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; \u0026amp;printFooter; exit; } sub formWrite{ local($name, $value); print \u0026#34;\u0026lt;table border=1\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;エレメントの名前\u0026lt;th\u0026gt;エレメントの中身\u0026lt;/tr\u0026gt;\\n\u0026#34;); while (($name, $value) = each(%G_form)){ \u0026amp;JconvPrint(\u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;$name\u0026lt;td\u0026gt;$value\u0026lt;/tr\u0026gt;\\n\u0026#34;); } print \u0026#34;\u0026lt;/table\u0026gt;\\n\u0026#34;; } sub formRead{ local($query_string, @elements, $elm, $name, $value, $code); read(STDIN, $query_string, $ENV{\u0026#39;CONTENT_LENGTH\u0026#39;}); @elements = split(/\u0026amp;/, $query_string); foreach $elm (@elements){ ($name, $value) = split(/=/, $elm); $value =~ s/+/ /g; # =~ tr/+/ /; と書くのが普通なのか？ $value =~ s/%([0-9a-fA-F][0-9a-fA-F])/pack(\u0026#34;C\u0026#34;, hex($1))/eg; $code = \u0026amp;Jgetcode($value); if($code ne \u0026#39;euc\u0026#39;){ $value = \u0026amp;Jconvert($value, \u0026#39;euc\u0026#39;, $code); } # とりあえずEUCに変換 $value =~ s/\u0026amp;/\u0026amp;amp;/g; # メタ文字（？）を無効化 $value =~ s/\u0026lt;/\u0026amp;lt;/g; # タグを無効化 $value =~ s/\u0026gt;/\u0026amp;gt;/g; # タグを無効化 $value =~ s/\\r\\n?/\\n/g; # 改行を統一 $value =~ s/\\n/\u0026lt;br\u0026gt;/g; # 改行を\u0026lt;br\u0026gt;に変換 $G_form{$name} = $value; } } sub printForm{ print \u0026#34;\u0026lt;form method=post action=\\\u0026#34;$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}?output\\\u0026#34;\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx1 value=\\\u0026#34;tx1\\\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;input type=text name=tx2 value=\\\u0026#34;tx2\\\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;\u0026lt;textarea name=tx3 cols=40 rows=4\u0026gt;tx3 日本語 英語 どちらでも\\nタグなどは無効になります。\u0026lt;/textarea\u0026gt;\u0026lt;br\u0026gt;\\n\u0026#34;); print \u0026#34;\u0026lt;input type=submit value=\\\u0026#34;Submit!\\\u0026#34;\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/form\u0026gt;\\n\u0026#34;; } sub printHeader{ if($G_Charset){ print \u0026#34;Content-type: text/html; charset=$G_Charset\\n\\n\u0026#34;; }else{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; } print \u0026#39;\u0026lt;!doctype html public \u0026#34;-//W3C//DTD HTML 4.01 Transitional//EN\u0026#34;\u0026gt;\u0026#39;.\u0026#34;\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026#34;; if($G_Charset){ print \u0026#34;\u0026lt;meta http-equiv=\\\u0026#34;Content-Type\\\u0026#34; content=\\\u0026#34;text/html; charset=$G_Charset\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Script-Type\u0026#34; content=\u0026#34;text/javascript\u0026#34;\u0026gt;\u0026#39;.\u0026#34;\\n\u0026#34;; print \u0026#39;\u0026lt;meta http-equiv=\u0026#34;Content-Style-Type\u0026#34; content=\u0026#34;text/css\u0026#34;\u0026gt;\u0026#39;.\u0026#34;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;\\n\u0026#34;); foreach (@G_styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$_\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;漢字コード変換 ： $JcodeVer\u0026lt;br\u0026gt;\\n\u0026#34;); open(IN, \u0026#39;../../sig.txt\u0026#39;); print while (\u0026lt;IN\u0026gt;); close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($G_linkFile){ \u0026amp;Jprint (\u0026#34;/\\n\u0026lt;a href=\\\u0026#34;$G_linkFile\\\u0026#34;\u0026gt;$G_titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;); } } sub Jprint{ if($G_Code eq $G_myCode){ foreach (@_){ print; } }else{ foreach (@_){ print \u0026amp;Jconvert($_, $G_Code, $G_myCode); } } } sub JconvPrint{ foreach (@_){ print \u0026amp;Jconvert($_, $G_Code, \u0026amp;Jgetcode($_)); } } ","date":"2000-10-07T13:31:16+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133116/","title":"フォームからの入力"},{"content":"「Unicode」でスクリプトを実行してみたかった。それだけ。変換には少し時間が掛かるようだ。原因はファイルの入出力にあるのか、それとも、変換にあるのか…。ともかく、実行はできるようなので少し試してみよう。そんなわけで、今までのサンプルを「Unicode」に変換してみました。\n実行してみると、色々不具合がありますね…。そもそも、ファイル名を限定しすぎていたから、「…の解説」に戻れなくなった。しかも、出力が標準で「Unicode」になるから、NNではまともに見れないです。\n今回は色々と見なおしてみた。じっくり見ていくともっと工夫できそうな事もあって、なかなか迷ってしまう。\nブラウザへの出力「Content-type: text/html」に「charset=ISO-2022-JP」とかを付け加えて書くと、ブラウザはきっちり理解してくれるようだ。試しに出力を「Unicode」にして書いてみると、今までは「日本語（自動選択）」のままだったのがちゃんと「ユニバーサル文字（UTF-8）」で表示された。NN4は相変わらず「□」に化けてるけど…。NN3はオプションなのか、グレー表示になっていた。「Unicode」はブラウザへ出力するのはやめたほうがいい。「Unicode」を乱用するのは、文字化けの原因を増やす事になるだけのような気がする。\nグローバル変数とローカル変数を区別しやすくするために、グローバルな変数は「$G_」ではじめる事にした。区別するのには、一般的には大文字を使うことが多い（環境変数も大文字だし）みたいだけど。小指が痛くて「Shiftキー」を長い時間押しているのは疲れるし、「CapsLock」もあまり使いたくない。基本的に大文字が好きじゃないという事もあるけど。\n少し前に気づいたけど、正規表現で「何回繰り返す」の表現は、その後ろに「{}（中カッコ）」で囲んだ数値をいれると良いようだ。その他にも、無くてもいい（0文字以上）なら後ろに「」を、1文字以上なら後ろに「+」を表記する。つまり、「ts[0-9][0-9][0-9][0-9]」は「ts[0-9]{4}」と書けるし、桁数にこだわらないなら「ts[0-9]」1桁以上なら「ts[0-9]+」と書く。なかなか便利だ。\n「.（ピリオド）」のエスケープは常にするように心がけた方が良いのかな？「.」は正規表現内では特殊文字なのでエスケープが必要なのに…。\u0026quot;...\u0026quot;では「\\」は常にエスケープされるから、「\\」以外に「\\」を表現する方法は無いけど…。時々は変数を出力してみて、感覚をつかむ必要がありそうだ。いい例が\u0026quot;index\\.($HTMLEXT)\u0026quot;だ。読み方には気をつけよう。\n「HTML-Lint」で書かれている出力する漢字コードの格納先は、今まで「$cutcode」だと思っていた。でも、実は「$outcode」と書いてあった。確かに…。意味もわからずにまねをするのは恥ずかしい事だな…と思った。他にも、変数の書き方の規則（とまではいかないけど）を考えて変更したり、ループや関数の書き方をなるべく統一したりした。\n…\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。よって「Unicode（UTF-8）」は使えなくなってます。\nというわけで、「euc」で出力してます。…このテストの意味がほとんど無くなりました (^^;;;\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 #!/usr/bin/perl # 初期設定 # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @G_styles = (\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $G_title = \u0026#34;テスト15\u0026#34;; $G_myCode = \u0026amp;Jgetcode(\u0026#34;漢字\u0026#34;); $G_Code = \u0026#34;jis\u0026#34;; $G_Charset = \u0026#34;ISO-2022-JP\u0026#34;; $G_scrName = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($G_scrName =~ /ts[0-9]{4}/){ $G_scrName = $\u0026amp;; $G_linkFile = \u0026#34;../$G_scrName.htm\u0026#34;; } # 固有設定 $G_inFile = \u0026#34;ts0014.cgi\u0026#34;; # $G_outCode = \u0026#34;utf8\u0026#34;; $G_outCode = \u0026#34;euc\u0026#34;; $G_outFile = $G_inFile; # $G_outFile =~ s/.cgi/_u.txt/; $G_outFile =~ s/.cgi/_e.txt/; { \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; \u0026amp;fileOUT ($G_outFile, \u0026amp;fileIN($G_inFile)); \u0026amp;Jprint (\u0026#34;\u0026lt;a href=\\\u0026#34;$G_outFile\\\u0026#34;\u0026gt;出力が完了しました。\u0026lt;/a\u0026gt;\\n\u0026#34;); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; \u0026amp;printFooter; exit; } sub fileOUT{ local($outFile)= shift(@_); local(@outFileLines) = @_; \u0026amp;Jprint (\u0026#34;出力ファイル名 : \u0026#34;); print $outFile; print \u0026#34;\u0026lt;br\u0026gt;\\n\u0026#34;; # \u0026amp;printSource(@_); open (OUT, \u0026#34;\u0026gt; $outFile\u0026#34;); foreach (@outFileLines){ print OUT \u0026amp;Jconvert($_, $G_outCode, \u0026amp;Jgetcode($_)); } close (OUT); # \u0026amp;Jprint (\u0026#34;以上の内容で出力しました。\u0026#34;); } sub fileIN{ local(@inFileLines); local($inFile) = $_[0]; \u0026amp;Jprint (\u0026#34;入力ファイル名 : \u0026#34;); print $inFile; print \u0026#34;\u0026lt;br\u0026gt;\\n\u0026#34;; open (IN, $inFile); @inFileLines = \u0026lt;IN\u0026gt;; close (IN); return @inFileLines; } sub printSource{ local(@lines)= @_; local($line); print \u0026#34;\u0026lt;ol\u0026gt;\\n\u0026#34;; foreach $line (@lines){ $line =~ s/\u0026amp;/\u0026amp;amp;/g; $line =~ s/\u0026#34;/\u0026amp;quot;/g; $line =~ s/\u0026lt;/\u0026amp;lt;/g; $line =~ s/\u0026gt;/\u0026amp;gt;/g; $line =~ s/ /\u0026amp;nbsp;/g; print \u0026amp;JconvPrint(\u0026#34;\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;$line\u0026lt;/code\u0026gt;\u0026#34;); } print \u0026#34;\u0026lt;/ol\u0026gt;\\n\u0026#34;; } sub printHeader{ if($G_Charset){ print \u0026#34;Content-type: text/html; charset=$G_Charset\\n\\n\u0026#34;; }else{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; } print \u0026#34;\u0026lt;!doctype html public \\\u0026#34;-//W3C//DTD HTML 4.0 Transitional//EN\\\u0026#34;\u0026gt;\\\u0026#34;.\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026#34;; if($G_Charset){ print \u0026#34;\u0026lt;meta http-equiv=\\\u0026#34;Content-Type\\\u0026#34; content=\\\u0026#34;text/html; charset=$G_Charset\\\u0026#34;\u0026gt;\\n\u0026#34;; } \u0026amp;Jprint (\u0026#34;\u0026lt;title\u0026gt;$G_title\u0026lt;/title\u0026gt;\\n\u0026#34;); foreach (@G_styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$_\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$G_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN, \u0026#34;../../sig.txt\u0026#34;); while (\u0026lt;IN\u0026gt;) { print; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($G_linkFile){ \u0026amp;Jprint (\u0026#34;/\\n\u0026lt;a href=\\\u0026#34;$G_linkFile\\\u0026#34;\u0026gt;$G_titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;); } } sub Jprint{ foreach (@_){ print \u0026amp;Jconvert($_, $G_Code, $G_myCode); } } sub JconvPrint{ foreach (@_){ print \u0026amp;Jconvert($_, $G_Code, \u0026amp;Jgetcode($_)); } } ","date":"2000-10-07T13:30:10+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/133010/","title":"漢字コードの変換（その2）"},{"content":"ディレクトリを後回しにする事に成功した。少しは見やすくなった…かもしれない。配列の扱いかたの勉強になった。\n今回はタイトル文字列の取得を少し考えてみた。「titleタグ」があって、その中身が無いときにも、そのまま表示していたようだ。とりあえず「全角空白」だけのタイトルは除いて取得しない（？）ようにした。「全角空白」は「EUC」の落とし穴らしいのでとりあえずは無視。「Unicode」なら大丈夫なのだろうか？やってみよう。\n改行については、とりあえずは無視。ファイルの読み込みは1行ずつ行われるようなので、ループに工夫が必要だ。フラグ1個でなんとかなるかな…？\nあと、「インデックス」になるページは表示しないで、ディレクトリにそのタイトルを表示する事にした。でも、いい方法が浮かばなくて、結局「インデックス」を探すためだけにサブルーチンを作ってしまった…。二度手間だ。しかも、正規表現がよくわからない。「HTML-Lint」では「index.($HTMLEXT)」になっていた（$HTMLEXTはhtmlの正規表現）けど、どう解釈していいのかわからない。「\\」は「」を示すし、「.」は「.」を示す。では「.」は何を示すのか？しかも「htmlの正規表現」が「()」で囲まれている。とりあえず消えてはいるけど…。大文字小文字を区別するのかと思ったら違うし、「」は（少なくともWindowsでは）ファイル名に使えないし…。難しい。\n…と思っていたけど、謎が解けた。この正規表現は、変数に格納されていたから、実際の文字列としては「index.(html?|[sp]ht(ml)?)」になるんだ。あぁ…おバカさんだ…。そういうことだったのか。\nそれに気づいてから、変数文字列を変数に格納してみた。でも、それは文字列として解釈されるのか、思ったとおりにはならなかった。チョット残念。それに「.」をそのまま変数に格納していたのもあった。変数の中身を考えると混乱する…。\nついでなので、インデックス以外にHTMLファイルが無い場合は\u0026lt;/ul\u0026gt;タグを書かないようにした。チョットだけこだわり。\nあと、大量に「print」していると、時々書いてないはずの文字が表示される事がある。見た感じでは最後の部分に発生するようだ。何故なのかな？\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 #!/usr/bin/perl # 初期設定 # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @g_styles = (\u0026#34;../../ipp.css\u0026#34;, \u0026#34;../test.css\u0026#34;); $g_title = \u0026#34;テスト14\u0026#34;; $my_code = \u0026amp;Jgetcode(\u0026#34;漢字\u0026#34;); $cut_code = \u0026#34;jis\u0026#34;; $htmlfile = \u0026#34;html?|[ps]ht(ml)?\u0026#34;; $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; $scrname =~ s/_1|_u// ; if($scrname =~ /ts[0-9]{4}.cgi$/){ $linkfile = $\u0026amp; ; $linkfile =~ s/.cgi/.htm/ ; } # 固有設定 $searchdir = \u0026#34;..\u0026#34;; $searchfile = \u0026#34;\\.$htmlfile\u0026#34;; $indexfile = \u0026#34;index\\.($htmlfile)\u0026#34;; { \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;親ディレクトリ以下にあるファイルの一覧（HTMLファイルのみ）\u0026#34;,\u0026#34;\\n\u0026#34;); print \u0026#34;\u0026lt;ul\u0026gt;\\n\u0026#34;; \u0026amp;Jconv (\u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026#34;$searchdir\\\u0026#34;\u0026gt;\u0026#34;, \u0026amp;indexSearch($searchdir), \u0026#34;\u0026lt;/a\u0026gt;\\n\u0026#34;); \u0026amp;dirlist($searchdir); print \u0026#34;\u0026lt;/ul\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; \u0026amp;printFooter; exit; } sub indexSearch{ local($dir) = $_[0]; local($result, @filelist); opendir(DIR, $dir); @filelist = readdir(DIR); closedir(DIR); @filelist = sort @filelist; $result = \u0026#34;インデックス無し\u0026#34;; foreach(@filelist){ if(/$indexfile/){ $result = \u0026amp;getHTMLTitle(\u0026#34;$dir/$\u0026amp;\u0026#34;); last; } } return $result; } sub dirlist{ local($dir)=$_[0]; local(@filelist,@dirs, $file, $filename, $ftitle, $fileflg); @dirs = (); $fileflg = 1; opendir(DIR, $dir); @filelist = readdir(DIR); closedir(DIR); @filelist = sort @filelist; foreach $file(@filelist){ if($file eq \u0026#34;.\u0026#34;){ next; } if($file eq \u0026#34;..\u0026#34;){ next; } $filename = \u0026#34;$dir/$file\u0026#34;; if(-d $filename){ push(@dirs, $filename); }elsif($filename =~ /$searchfile/){ if($filename !~ /$indexfile/){ if($fileflg){ print \u0026#34;\u0026lt;ul\u0026gt;\\n\u0026#34;; $fileflg = 0; } $ftitle = \u0026amp;getHTMLTitle($filename); \u0026amp;Jconv (\u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026#34;$filename\\\u0026#34;\u0026gt;$file（\u0026#34;, $ftitle, \u0026#34;）\u0026lt;/a\u0026gt;\\n\u0026#34;); } } } foreach $filename (@dirs){ if($filename =~ /[\\w-]+$/){ $file = $\u0026amp;; } $ftitle = \u0026amp;indexSearch($filename); \u0026amp;Jconv (\u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026#34;$filename/\\\u0026#34;\u0026gt;$file（\u0026#34;, $ftitle, \u0026#34;）\u0026lt;/a\u0026gt;\\n\u0026#34;); \u0026amp;dirlist($filename); } if(!$fileflg){print \u0026#34;\u0026lt;/ul\u0026gt;\\n\u0026#34;;} } sub getHTMLTitle{ local($file)=$_[0]; local($ttl, $result); $result = \u0026#34;タイトル無し\u0026#34;; if($file =~ /$htmlfile/){ open(IN, $file); while(\u0026lt;IN\u0026gt;){ if(/\u0026lt;title\u0026gt;/){ if($\u0026#39; =~ /\u0026lt;\\/title\u0026gt;/){ $ttl = $`; if($ttl =~ /\\S/){$result = $ttl;} last; } } } close(IN); } return $result; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$g_title\u0026lt;/title\u0026gt;\\n\u0026#34;); foreach (@g_styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$_\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$g_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN, \u0026#34;../../sig.txt\u0026#34;); while (\u0026lt;IN\u0026gt;){ print; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($linkfile){ \u0026amp;Jprint (\u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$linkfile\\\u0026#34;\u0026gt;$g_titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;); } } sub Jprint{ foreach (@_) { print \u0026amp;Jconvert($_, $cut_code, $my_code); } } sub Jconv{ foreach (@_) { print \u0026amp;Jconvert($_, $cut_code, \u0026amp;Jgetcode($_)); } } ","date":"2000-10-07T13:29:20+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132920/","title":"サブディレクトリ内も一覧（その2）"},{"content":"自動的にサイトマップを作ってみたかった。\nリンクをつけて、タイトルを書いて…。でも、位置関係がよくわからない。せめてディレクトリとファイルの区別はしてみたい。とりあえず「sort」という命令で配列をソートできるのはわかったけど、ディレクトリの内部をそのままソートすると、全部ごちゃごちゃになってしまった。ディレクトリかどうかは「-d」で検査できるので、配列の順序を並び替える事もできそうだ。\nこのディレクトリの探索方法は「とほほのWWW入門」の「検索フォーム設置法」で使われていたスクリプトを参考にした。だんだんわかってきているのか、プログラムが見えるようになってきた。これからが楽しみだ。\nここでの「HTMLファイル」は正規表現を使って取得している。「HTML-Lint」で使っていたのを見てみると「html?|[sp]ht(ml)?」となっていた。対象がわかっている正規表現を見ると理解が深まる。今までは「?」の使い方を勘違いしていたようだ。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 #!/usr/bin/perl # 初期設定 # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @g_styles = (\u0026#34;../../ipp.css\u0026#34;, \u0026#34;../test.css\u0026#34;); $g_title = \u0026#34;テスト13\u0026#34;; $my_code = \u0026amp;Jgetcode(\u0026#34;漢字\u0026#34;); $cut_code = \u0026#34;jis\u0026#34;; $htmlfile = \u0026#34;html?|[ps]ht(ml)?\u0026#34;; $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; $scrname =~ s/_1|_u//; if ($scrname =~ /ts[0-9]{4}.cgi$/) { $linkfile = $\u0026amp;; $linkfile =~ s/.cgi/.htm/; } # 固有設定 $searchdir = \u0026#34;..\u0026#34;; $searchfile = $htmlfile; { \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;親ディレクトリ以下にあるファイルの一覧（HTMLファイルのみ）\u0026#34;, \u0026#34;\\n\u0026#34;); \u0026amp;dirlist($searchdir); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; \u0026amp;printFooter; exit; } sub dirlist { local($dir) = $_[0]; local(@filelist, $file, $filename, $ftitle); opendir(DIR, $dir); @filelist = readdir(DIR); closedir(DIR); @filelist = sort @filelist; print \u0026#34;\u0026lt;ul\u0026gt;\\n\u0026#34;; foreach $file (@filelist) { if ($file eq \u0026#34;.\u0026#34;) { next; } if ($file eq \u0026#34;..\u0026#34;) { next; } $filename = \u0026#34;$dir/$file\u0026#34;; if (-d $filename) { print \u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026#34;$filename/\\\u0026#34;\u0026gt;$file\u0026lt;/a\u0026gt;\\n\u0026#34;; \u0026amp;dirlist($filename); } elsif ($filename =~ /.$searchfile/) { $ftitle = \u0026amp;getHTMLTitle($filename); \u0026amp;Jconv(\u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026#34;$filename\\\u0026#34;\u0026gt;$file（\u0026#34;, $ftitle, \u0026#34;）\u0026lt;/a\u0026gt;\\n\u0026#34;); } } print \u0026#34;\u0026lt;/ul\u0026gt;\\n\u0026#34;; } sub getHTMLTitle { local($file) = $_[0]; local($result); $result = \u0026#34;タイトル無し\u0026#34;; if ($file =~ /$htmlfile/) { open(IN, $file); while (\u0026lt;IN\u0026gt;) { if (/\u0026lt;title\u0026gt;/) { if ($\u0026#39; =~ /\u0026lt;\\/title\u0026gt;/) { $result = $`; last; } } } close(IN); } return $result; } sub printHeader { print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$g_title\u0026lt;/title\u0026gt;\\n\u0026#34;); foreach (@g_styles) { print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$_\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; \u0026amp;Jprint(\u0026#34;\u0026lt;h1\u0026gt;$g_title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter { print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN, \u0026#34;../../sig.txt\u0026#34;); while (\u0026lt;IN\u0026gt;) { print; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks { print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if ($linkfile) { \u0026amp;Jprint(\u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$linkfile\\\u0026#34;\u0026gt;$g_titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;); } } sub Jprint { foreach (@_) { print \u0026amp;Jconvert($_, $cut_code, $my_code); } } sub Jconv { foreach (@_) { print \u0026amp;Jconvert($_, $cut_code, \u0026amp;Jgetcode($_)); } } ","date":"2000-10-07T13:28:17+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132817/","title":"サブディレクトリ内も一覧"},{"content":"ファイルの出力の応用（？）と、「Location」でページを移動する練習です。\nとりあえず出力は「ISO-2022-JP」で。でも、「Shift_JIS版」では、「のソース」が文字化けしている。なおすのは簡単（\u0026ldquo;のソース\u0026quot;か、\u0026lsquo;のソース\u0026rsquo;と書けばなおるはず）だけど、そのままにしておく。\nHTML形式で出力しているから、IEでもちゃんと表示されるはず。ついでだから、行番号も入れておいた。ただ、両方を試すと「ts0011.htm」がブラウザのキャッシュに残るはずなので、表示後にはリロードが必要です。\nこれを少し応用すれば、ディレクトリ内のcgiファイルをHTMLに変換することも簡単にできる。ただ、単純なテキストファイルよりも、サイズが大きくなるのが欠点か・・・。\nついでなので、ソースを見るCGIスクリプトを作って、このファイルから適用することにした。スクリプト自体を「EUC」にしたから、文字化けはしないはずだけど・・・。\n次に、「Location」について。\nperl（CGI?）では、「print」するときに、何を出力するのかをまず書く必要があるようだ。例えば、HTMLとして画面に出力するには「Content-type: text/html」をまず最初に出力する必要がある。しかも、その後には空行が必要らしい。\nそもそも、「print」というのはブラウザに対して出力するのだから、HTMLファイルを読むときと同じように出力する必要があるのかもしれない。よくわからないけど。\nで、「Location」はLocation: http://www.hoge.ne.jp/hoge/のように出力する。これも、空行を書かないとブラウザが正しく処理してくれない。具体的にはprint \u0026quot;Location: http://www.hoge.ne.jp/hoge/\\n\\n\u0026quot;;と書く必要がある。URLの指定は、絶対指定（http://...）だけでなく、相対指定も使えるようだ。\nまた、大文字小文字も判別するようで、「location」と書いてしまうと、これもうまくいかない。サーバとブラウザの間では、シビアな約束事があるようだ。\n出力したCGIスクリプトの文字コードを出力するように訂正した。\n「txt」ディレクトリを削除するため、出力先を変更した。ついでに、「\u0026lt;code\u0026gt;タグ」を追加したり、出力先を変数に格納したりなどの変更時の簡素化をはかってみた。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 #!/usr/bin/perl # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; $file = \u0026#34;ts0011\u0026#34;; $outfile = \u0026#34;$file.htm\u0026#34;; $infile = \u0026#34;$file.cgi\u0026#34;; $title = \u0026#34;$infileのソース\u0026#34;; $fcode = \u0026#34;sjis\u0026#34;; $mycode = \u0026amp;Jgetcode(\u0026#34;漢字\u0026#34;); $cutcode = \u0026#34;jis\u0026#34;; $title .= \u0026#34;（$mycodeから出力）\u0026#34;; { open(OUT, \u0026#34;\u0026gt; $outfile\u0026#34;); \u0026amp;printHeader; print (OUT \u0026#34;\u0026lt;ol\u0026gt;\u0026#34;); open(IN, $infile); while($line = \u0026lt;IN\u0026gt;){ $line =~ s/\u0026amp;/\u0026amp;amp;/g; $line =~ s/\u0026#34;/\u0026amp;quot;/g; $line =~ s/\u0026lt;/\u0026amp;lt;/g; $line =~ s/\u0026gt;/\u0026amp;gt;/g; $line =~ s/ /\u0026amp;nbsp;/g; \u0026amp;Jfprint (\u0026#34;\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;$line\u0026lt;/code\u0026gt;\u0026#34;); } close(IN); print (OUT \u0026#34;\u0026lt;/ol\u0026gt;\u0026#34;); \u0026amp;printFooter; close(OUT); print \u0026#34;Location: $outfilenn\u0026#34;; exit; } sub printHeader{ \u0026amp;Jprint (\u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;n\u0026#34;); print (OUT \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;n\u0026#34;); \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;$title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); } sub printFooter{ print (OUT \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;); print (OUT \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;); } sub Jprint{ foreach (@_) { print (OUT \u0026amp;Jconvert($_, $cutcode, $mycode)); } } sub Jfprint{ foreach (@_) { print (OUT \u0026amp;Jconvert($_, $cutcode, $fcode)); } } ","date":"2000-10-07T13:27:43+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132743/","title":"ファイルを作って飛ばす"},{"content":"「CGIソース」は、「cgiファイル」をコピーして、拡張子を「txt」に変更しただけのもの。しかも、IEではHTMLとして解釈される事もしばしば。いっその事、cgiファイルをそのままHTMLに取りこんで表示してみようかな・・・なんて考えてみた。\nせっかくなので、今回は「Unicode(UTF-8)」を使用してみた。でも、もしかすると失敗したかも・・・。IEでは「Unicode」にすれば表示できた(そのままだと真っ白だった)けど、NNでは2バイト文字が全部「□」になって表示された。「Unicode」は今のところ、ブラウザへの出力には向いてないのかもしれない。\n今回は、同じファイルだと都合悪そうだったので「ts0010.cgi」を変換した。でも、スタイルシートのせいか「Unicode」のせいか知らないけど、ソースがとても読みにくい・・・。せっかく行番号までつけたのに、残念だ。そういえば、「htmllint」のように「\u0026lt;code\u0026gt;タグ」で括ってしまえばよかったのかも・・・。もういいけど。\nやり方は単純なので、htmファイルに出力するものを作ってみよう。出力コードは「jis」で。\n・・・\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。よって「Unicode(UTF-8)」は使えなくなってます。\nというわけで、「euc」で出力してみました。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 #!/usr/bin/perl # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @styles = (\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $title = \u0026#34;テスト11\u0026#34;; $mycode = \u0026amp;Jgetcode($title); # $cutcode = \u0026#34;utf8\u0026#34;; $cutcode = \u0026#34;euc\u0026#34;; $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; $scrname =~ s/_1|_u// ; if($scrname =~ /(ts[0-9]{4}.cgi$)/){ $filename = $+ ; $filename =~ s/cgi/htm/ ; } $file = \u0026#34;ts0010.cgi\u0026#34;; $fcode = \u0026#34;sjis\u0026#34;; { \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;$cutcode で $file の出力をする。\u0026lt;br\u0026gt;\\n\u0026#34;); print \u0026#34;\u0026lt;ol\u0026gt;\u0026#34;; open(IN, $file); while($line = \u0026lt;IN\u0026gt;){ $line =~ s/\u0026amp;/\u0026amp;amp;/g; $line =~ s/\u0026#34;/\u0026amp;quot;/g; $line =~ s/\u0026lt;/\u0026amp;lt;/g; $line =~ s/\u0026gt;/\u0026amp;gt;/g; $line =~ s/ /\u0026amp;nbsp;/g; \u0026amp;Jfprint (\u0026#34;\u0026lt;li\u0026gt;$line\u0026#34;); } close(IN); print \u0026#34;\u0026lt;/ol\u0026gt;\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;\u0026#34;, $title, \u0026#34;\u0026lt;/title\u0026gt;\u0026#34;, \u0026#34;\\n\u0026#34;); foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;\u0026#34;, $title, \u0026#34;\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN, \u0026#34;../../sig.txt\u0026#34;); while ($sig = \u0026lt;IN\u0026gt;){ print $sig; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($filename){ \u0026amp;Jprint (\u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$filename\\\u0026#34;\u0026gt;\u0026#34;, $title, \u0026#34;の解説\u0026#34;, \u0026#34;\u0026lt;/a\u0026gt;\\n\u0026#34;); } } sub Jprint{ foreach (@_) { print \u0026amp;Jconvert($_, $cutcode, $mycode); } } sub Jfprint{ foreach (@_) { print \u0026amp;Jconvert($_, $cutcode, $fcode); } } ","date":"2000-10-07T13:27:00+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132700/","title":"ソースの表示"},{"content":"そりゃもちろん、文字化けをなくすため。\n変換には(たぶん)「Jcode.pm」を使っている。「htmllint.cgi」で使っていたので、それを参考にしてなんとかできた。意味不明な命令がいくつかあったけど、なんとなく使い方はわかった気がする。説明書を読んだらもっと簡単にわかるのかもしれないけど・・・。\n出力は「JIS」にしてみた。「JIS」はブラウザでは文字化けが起きにくいらしいから。Windowsでは「Shift_JIS」、perlでは「EUC」、そしてブラウザでは「JIS」・・・。それぞれ得意分野が違うのは仕方のない事なのかな？\nちなみに、「Jcode.pm」では「Unicode(UTF-8)」も変換に使えるらしい。試してみるのも悪くない。\n「Jcode.pm」は「htmllint」を使うためにインストールしたから、使うのは簡単。「require Jcode;」これだけ。あとは、コードを取得する「getcode」と、変換する「convert」の2つ。これらは「*Jgetcode = \u0026amp;Jcode::getcode;」「*Jconvert = \u0026amp;Jcode::convert;」と書くことで、「Jgetcode」「Jconvert」という名前でサブルーチンとして使えるようになる(ような気がした)。\n「getcode」は、引数に対象となる文字列を渡すと、その文字の漢字コードを返してくれる。「convert」は「変換する文字列、変換目的のコード、変換前のコード」の3つを引数として渡すと、コードが変換されて返ってくる。漢字コードの指定は「utf8」「jis」「euc」「sjis」というふうに指定する。「getcode」でもこれらの文字列が返ってくる。なかなか便利だ。\n今回、ローカル環境から完全に移行するために「jcode.pl」に変更しました。よって「Unicode(UTF-8)」は使えなくなっています。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 #!/usr/bin/perl # require Jcode; # *Jgetcode = \u0026amp;Jcode::getcode; # *Jconvert = \u0026amp;Jcode::convert; require \u0026#34;../../../cgi-bin/jcode.pl\u0026#34;; *Jgetcode = \u0026amp;jcode::getcode; *Jconvert = sub { \u0026amp;jcode::to($_[1], $_[0], $_[2]); }; @styles = (\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $title = \u0026#34;テスト10\u0026#34;; $mycode = \u0026amp;Jgetcode($title); $cutcode = \u0026#34;jis\u0026#34;; $scrname = \u0026#34;\u0026#34;; $filename = \u0026#34;\u0026#34;; $rtdir = \u0026#34;../\u0026#34;; $file = \u0026#34;\u0026#34;; { $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; $scrname =~ s/_1|_u// ; if($scrname =~ /(ts[0-9]{4}.cgi$)/){ $filename = $+ ; $filename =~ s/cgi/htm/ ; } \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;n\u0026#34;; \u0026amp;Jprint (\u0026#34;$mycode → $cutcode 変換\u0026lt;br\u0026gt;n\u0026#34;); \u0026amp;Jprint (\u0026#34;「親ディレクトリ」には、以下のHTMファイルがあります。\u0026#34;); print \u0026#34;\u0026lt;ul\u0026gt;n\u0026#34;; chdir($rtdir); opendir(DIR, \u0026#34;.\u0026#34;); while ($file = readdir(DIR)) { if($file =~ /htm$/){ open(IN, $file); while(\u0026lt;IN\u0026gt;){ if(/\u0026lt;title\u0026gt;/){ if($\u0026#39; =~ /\u0026lt;/title\u0026gt;/){ print \u0026#34;\u0026lt;li\u0026gt;$file\u0026#34; ; \u0026amp;Jconv (\u0026#34;（\u0026#34;, $`, \u0026#34;）\u0026#34;, \u0026#34;n\u0026#34;); last; } } } close(IN); } } closedir(DIR); print \u0026#34;\u0026lt;/ul\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;\u0026#34;, $title, \u0026#34;\u0026lt;/title\u0026gt;\u0026#34;, \u0026#34;n\u0026#34;); foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$st\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; \u0026amp;Jprint (\u0026#34;\u0026lt;h1\u0026gt;\u0026#34;, $title, \u0026#34;\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;); \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; open(IN, \u0026#34;../../sig.txt\u0026#34;); while ($sig = \u0026lt;IN\u0026gt;){ print $sig; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;/n\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; if($filename){ \u0026amp;Jprint (\u0026#34;/n\u0026lt;a href=\u0026#34;../$filename\u0026#34;\u0026gt;\u0026#34;, $title, \u0026#34;の解説\u0026#34;, \u0026#34;\u0026lt;/a\u0026gt;n\u0026#34;); } } sub Jprint{ foreach (@_) { print \u0026amp;Jconvert($_, $cutcode, $mycode); } } sub Jconv{ foreach (@_) { print \u0026amp;Jconvert($_, $cutcode, \u0026amp;Jgetcode($_)); } } ","date":"2000-10-07T13:25:52+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132552/","title":"漢字コードの変換"},{"content":"やはり一覧を作るなら、ファイル名よりタイトルの方がいいでしょう。ということで、HTMファイルから「\u0026lt;title\u0026gt;タグ」の中身を取り出してみました。\n「/（スラッシュ）」は正規表現の区切り（？）なので、エスケープする必要があるみたい。何度も失敗しているうちに色々とコツがわかってきたような気がする。\n気がしているだけのような気もしない事も無いけど・・・。\nあと、表示して気づいた事だけど、EUC-JP版ではタイトルが文字化けする。これは、タイトルがShift_JISのままだからなのだろう・・・。漢字コードが混在するのはよくない。きちんと変換しなくてはいけないけど・・・。\n・・・文字コードの混在というのは、危険もあるようだ。UnicodeとShift_JISが混ざると、どうしようもないことが起きるみたい。文字コードの扱いには気をつけなくては・・・。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $title=\u0026#34;テスト9\u0026#34;; $scrname=\u0026#34;\u0026#34;; $filename=\u0026#34;\u0026#34;; $rtdir=\u0026#34;../\u0026#34;; $file=\u0026#34;\u0026#34;; { $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; $scrname =~ s/_1// ; if($scrname =~ /(ts[0-9]{4}.cgi$)/){ $filename = $+ ; $filename =~ s/cgi/htm/ ; } \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; print \u0026#34;「親ディレクトリ」には、以下のHTMファイルがあります。\u0026#34;; print \u0026#34;\u0026lt;ul\u0026gt;\\n\u0026#34;; chdir($rtdir); opendir(DIR, \u0026#34;.\u0026#34;); while ($file = readdir(DIR)) { if($file =~ /htm$/){ open(IN, $file); while(\u0026lt;IN\u0026gt;){ if(/\u0026lt;title\u0026gt;/){ if($\u0026#39; =~ /\u0026lt;\\/title\u0026gt;/){ print \u0026#34;\u0026lt;li\u0026gt;$file（$`）\\n\u0026#34;; last; } } } close(IN); } } closedir(DIR); print \u0026#34;\u0026lt;/ul\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($filename){ print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$filename\\\u0026#34;\u0026gt;$titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;; } } ","date":"2000-10-07T13:25:19+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132519/","title":"タイトルを探す"},{"content":"ファイル数が多くなってくると、だんだん書くのが面倒になってくる。一覧を自動で作れたら楽でしょ？\nそのうち、「テストindex」を自動作成してみたいという野望もある。サイトマップも自動で作成できるような気がするし・・・。\nなんにしても、決まった規則で作っているファイルの一覧からは、機械的な操作でいろんな情報を集める事ができる。これは、その第1段階だと思っている。\n純粋にディレクトリを全部表示すると、見たくない（見て欲しくない）ファイルも見えてしまうので、ここでも正規表現を使って「htmファイル」のみを表示している。「testディレクトリ」には「htmファイル」は沢山あるけど、「cgiディレクトリ」には1つしかない。とりあえず成功だ。\n「txt」ディレクトリを削除するため、「cgi」ディレクトリにHTMLファイルなどを出力する事にした。だから、いくつか増えるはず・・・。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $title=\u0026#34;テスト8\u0026#34;; $scrname=\u0026#34;\u0026#34;; $filename=\u0026#34;\u0026#34;; $rtdir=\u0026#34;./\u0026#34;; $file=\u0026#34;\u0026#34;; { $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($scrname =~ /(ts[0-9][0-9][0-9][0-9][_1]*.cgi$)/){ $filename = $+ ; $filename =~ s/_1// ; $filename =~ s/.cgi/.htm/ ; } \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; print \u0026#34;このディレクトリには、以下のHTMファイルがあります。\u0026#34;; opendir(DIR, $rtdir); print \u0026#34;\u0026lt;ul\u0026gt;\u0026#34;; while ($file = readdir(DIR)) { if($file =~ /.htm$/){ print \u0026#34;\u0026lt;li\u0026gt;$file\\n\u0026#34;; } } print \u0026#34;\u0026lt;/ul\u0026gt;\u0026#34;; closedir(DIR); print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($filename){ print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$filename\\\u0026#34;\u0026gt;$titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;; } } ","date":"2000-10-07T13:23:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132359/","title":"ディレクトリを見る"},{"content":"このサンプルを作っていて気が付いたけど、正規表現で、EUC-JP版の「_1」の処理をするのを忘れていた。こじつけてしまったから正規表現とは呼びにくいかも・・・。\nま、ともかく、テストの結果から、このページへ戻るリンクを作ることができた。ついでに、サブルーチンへ引数で渡していたのをグローバル変数に変更した。今のところprintするだけのサブルーチンだからこれで十分だ。\n文字列の置換には、正規表現を適用する事もできる。・・・けど、なんか正規表現って難しい。もっと色々試してみよう。\nう〜ん。考え方によっては、先に「_1」を取ってしまえば同じファイル名になるから、そうやってもいいかもしれない。少なくとも「ts[0-9][0-9][0-9][0-9]」の表現は変えるつもりは無いし。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $title=\u0026#34;テスト7\u0026#34;; $scrname=\u0026#34;\u0026#34;; $filename=\u0026#34;\u0026#34;; { $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; if($scrname =~ /(ts[0-9][0-9][0-9][0-9][_1]*.cgi$)/){ $filename = $+ ; $filename =~ s/_1// ; $filename =~ s/.cgi/.htm/ ; } \u0026amp;printHeader; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; if($filename){ print \u0026#34;この実行ファイルのパス名（？）は「$scrname」です。\u0026lt;br\u0026gt;\\n\u0026#34;; print \u0026#34;つまり、このスクリプトの解説は「\u0026#34; . $filename . \u0026#34;」にあります。\u0026lt;br\u0026gt;\\n\u0026#34;; }else{ print \u0026#34;・・・どうやら失敗のようです・・・。\u0026#34;; } print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$title\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$title\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; \u0026amp;printlinks; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } sub printlinks{ print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; if($filename){ print \u0026#34;/\\n\u0026lt;a href=\\\u0026#34;../$filename\\\u0026#34;\u0026gt;$titleの解説\u0026lt;/a\u0026gt;\\n\u0026#34;; } } ","date":"2000-10-07T13:23:30+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132330/","title":"文字列の置換"},{"content":"今まで、何度か聞いた事だけはある「正規表現」という言葉。じぃ〜っと眺めてみても、何をやっているのかさっぱりだった。いや、過去形じゃないけど。\nとりあえず、このファイルについて言えば成功した。一応、正規表現として正しかったということ。チョットうれしいかも。あとは、これをリンクに応用すればいいだけだ。\n・・・さて、どうしましょうか？\nあ、そう言えば、文字列の足し算も覚えた。「.」で文字列の足し算（連結）ができる。「.=」では、JavaScriptでいう「+=」と同じ事ができる。\n新しい言語を覚えるのも楽しくなってきた。\nちなみに、正規表現でperlで使える変数名を表すと、「^[a-zA-Z_][0-9a-zA-Z_]*$」ということらしい。つまりそういうことらしいです。この例は、とてもわかりやすい表現だと思う。\nちなみに、今のところperlの勉強は、「とほほのperl入門」だけ。ためになります。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); $scrname=\u0026#34;\u0026#34;; $filename=\u0026#34;\u0026#34;; { \u0026amp;printHeader(\u0026#34;テスト6\u0026#34;); $scrname = $ENV{\u0026#39;SCRIPT_NAME\u0026#39;}; print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; if($scrname){ print \u0026#34;この実行ファイルのパス名（？）は「$scrname」です。\u0026lt;br\u0026gt;\\n\u0026#34;; print \u0026#34;そのうち、ファイルの名前は\u0026#34;; if($scrname =~ /(ts[0-9]+[_1]*.cgi$)/){ $filename = \u0026#34;「\u0026#34; . $+ . \u0026#34;」です。\u0026#34;; }else{ $filename = \u0026#34;わかりませんでした。\u0026#34;; } print $filename; }else{ print \u0026#34;・・・どうやら失敗のようです・・・。\u0026#34;; } print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } ","date":"2000-10-07T13:22:45+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132245/","title":"正規表現"},{"content":"先ほどと同じく環境変数の一つです。\n実は、環境変数の一覧を作ったのですけど…。自分で実行するならともかく、公開するとなると、とても危険そうな情報も入っていたのでやめました。簡単に作れるので、自分で試してみましょう。\nで、なぜ、「SCRIPT_NAME」なのかというと、ここのスクリプトは「htm」と「cgi」という拡張子とディレクトリが違うだけなので、「解説を見る」とかいうリンクを作りたかったから。この環境変数は、実行しているファイルの名前が最後に出るので、それを使ってリンクを作ろうかと思って…。\nでも、perlを使うからには「正規表現」というやつを使ってみたい。と、ふと思ったので、ここでは環境変数の紹介だけ。\n…といっても、ここで使う以外には汎用性はなさそうだけど（笑）\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); { \u0026amp;printHeader(\u0026#34;テスト5\u0026#34;); print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; if($ENV{\u0026#39;SCRIPT_NAME\u0026#39;}){ print \u0026#34;この実行ファイルのパス名（？）は「$ENV{\u0026#39;SCRIPT_NAME\u0026#39;}」です。\\n\u0026#34;; }else{ print \u0026#34;…どうやら失敗のようです…。\u0026#34;; } print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } ","date":"2000-10-07T13:21:59+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132159/","title":"自分の名前を調べる"},{"content":"CGIでは、環境変数と呼ばれている特殊な配列がある。この例ではそのうちの「HTTP_REFERER」を使って、JavaScriptでいう「history.back()」や「history.go(-1)」を、中身ごと書いてしまおうという計画。まあ、今の場合は意味無いけど・・・。ただ、「戻る」とは言っても、実際には「進んで」いるので表現としては違うのかもしれない。\n環境変数は「$ENV{\u0026lsquo;HTTP_REFERER\u0026rsquo;}」の様に「ENV」という特別な「連想配列」のことを示している。「連想配列」とは文字列によってその値を参照や変更ができるような配列のこと。環境変数はあらかじめ設定されていて、その都度サーバー（？）によって変更されている連想配列と考える事ができる。解釈が正しいかどうかは別にして。\nJavaScriptでは、オブジェクトを参照するときには「name」や「id」で設定している「文字列」が配列としてそのまま利用できた。perlでは連想配列と、普通の配列は区別されているようだ。\nちなみに、配列全体を表すには「@」、連想配列全体を表すには「%」を頭文字につける必要がある。配列、連想配列は参照の仕方が変わっているので注意が必要だ。これらは単独で参照するには「$」が頭につく。\n実は、変数も「$」を頭につけるので、ややこしい。しかも、これらは独自の空間を持っていて「$aaa」と「@aaa」と「%aaa」はまったく別のものとなる。混乱しそうだ。\nこのサンプルでは、「if文」を使って「HTTP_REFERER」が無いときは表示しない様にしてある。「if文」自体はどの言語も似たようなものだけど、perlでは「else if」が「elsif」になってる。最近はそうなのかな？ここではまだ使ってないけど、間違えそうでちょっと恐い。\n・・・時は過ぎ・・・\n環境変数はCGIをする楽しみの一つだと思う。JavaScriptでもuserAgentとかは取得できるけど、CGIならもっと多くの情報を取得できるから。\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); { \u0026amp;printHeader(\u0026#34;テスト4\u0026#34;); print \u0026#34;\u0026lt;div class=test\u0026gt;\\n\u0026#34;; if($ENV{\u0026#39;HTTP_REFERER\u0026#39;}){ print \u0026#34;\u0026lt;a href=\\\u0026#34;$ENV{\u0026#39;HTTP_REFERER\u0026#39;}\\\u0026#34;\u0026gt;戻る\u0026lt;/a\u0026gt;\\n\u0026#34;; }else{ print \u0026#34;・・・どうやら失敗のようです・・・。\u0026#34;; } print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } ","date":"2000-10-07T13:21:04+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/132104/","title":"「戻る」リンクを作る"},{"content":"やっぱり、みんなで共有できるデータが欲しいから・・・。\n・・・実行してから気づいた事だけど、一度出力するとそのファイルができてしまう。当たり前の事だけど、上書きしても内容が同じだった（笑）\nということで、書きこんだ時間を付け足す事にした。時刻の書式変換は「wwwboard.cgi」のをそのままもらった。未変換だと凄い数値になって返ってきたから・・・。いずれ、時間関係も勉強しようと思った。\nところで、何度か実行しても、「temp.txt」はキャッシュに残ってる事があるので、その場合はテキストを表示した後に「リロード」する必要がある。CGIの直表示と違って、ブラウザのキャッシュを考えると表示の仕方が難しい。\nすでにある「temp.txt」を見る。\n・・・時は過ぎ・・・\n今もそれほど成長はしてないとは思うけど、当時の状況を見ると初々しくて面白い。成長を記録しようと思ったのは正解だったか（笑）\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); @wdays = (\u0026#34;日\u0026#34;, \u0026#34;月\u0026#34;, \u0026#34;火\u0026#34;, \u0026#34;水\u0026#34;, \u0026#34;木\u0026#34;, \u0026#34;金\u0026#34;, \u0026#34;土\u0026#34;); { \u0026amp;printHeader(\u0026#34;テスト3\u0026#34;); print \u0026#34;「temp.txt」に書き出します。\\n\u0026#34;; open(OUT,\u0026#34;\u0026gt; temp.txt\u0026#34;); print(OUT \u0026#34;この文は temp.txt の中身になるはずです。\\n\u0026#34;); print(OUT \u0026#34;書き込んだ時間は、\u0026#34;); ($sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst) = localtime(time); $date = sprintf(\u0026#34;%04d/%02d/%02d(%s) %02d:%02d:%02d\u0026#34;, $year + 1900, $mon + 1, $mday, @wdays[$wday], $hour, $min, $sec); print(OUT $date); print(OUT \u0026#34;です。\\n\u0026#34;); close(OUT); print \u0026#34;\u0026lt;div class=test\u0026gt;\u0026lt;a href=\\\u0026#34;temp.txt\\\u0026#34;\u0026gt;temp.txtを見る\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$st\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } ","date":"2000-10-07T13:18:13+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/131813/","title":"ファイルに書き出す"},{"content":"そりゃ、includeと同じ事くらいはCGIでもやってみないとね・・・。\n「open(IN,\u0026ldquo;ファイル名\u0026rdquo;)」だけど、ファイル名にはサーバーのルートからの指定は無視されるのかな？「/sig.txt」とやると何も表示されなかった・・・。\nと思っていたけど、思いっきり勘違いをしていた。CGIを実行するときは、サーバー自身のディレクトリの参照が必要なのだった。だから、ホストのルートではなく、ルートディレクトリを参照していたみたい。ディレクトリの指定も気をつけないと、変なところにファイルを作りかねない・・・。\n実は、「テスト1」（便宜上こう呼ぶ）の方だけど、titleタグの方の変数が訂正してなかった。よく考えてみると、タイトルバーにはURLが表示されていたような気がする。サブルーチンでの引数の扱い方も気をつけよう。\nちなみに、エディタは「Perl Editor」を使っている。プログラミング用のエディタみたいで、サブルーチンや変数の一覧が表示されて、使用されている場所へジャンプする事もできる。エディタとしては少し能力不足だけど、他の人が作ったプログラムを見るのにはとても便利だ。ホイールも認識するのが気に入ってる。意外といいエディタだと思っても、ホイールに対応してないのが多いから、この手のソフトはバージョンアップに期待したい。作者のページは「川千原千」です。\n・・・時は過ぎ・・・\n「Perl Editor」も結構便利になってきた。漢字コードや改行の種類を気にしないで編集できるのが特にいい感じ。\nソースコード\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;,\u0026#34;../test.css\u0026#34;); { \u0026amp;amp;printHeader(\u0026#34;テスト２\u0026#34;); print \u0026#34;「sig.txt」を読み込みます。n\u0026#34;; print \u0026#34;\u0026lt;div class=test\u0026gt;\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); @sig1=\u0026lt;IN\u0026gt;; foreach $line(@sig1){ print $line; } close(IN); print \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; \u0026amp;amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/htmlnn\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;n\u0026#34;; foreach $st (@styles){ print \u0026#34;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;$st\u0026#34;\u0026gt;n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;a href=\u0026#34;../../../index.htm\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\u0026#34;../../\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;n\u0026#34;; open(IN,\u0026#34;../../sig.txt\u0026#34;); while ($sig=\u0026lt;IN\u0026gt;){print $sig;} close(IN); print \u0026#34;\u0026lt;/div\u0026gt;n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;n\u0026#34;; } ","date":"2000-10-07T13:16:48+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/131648/","title":"ファイルから読み込む"},{"content":"プログラムを楽に作るには、やはり優れたサブルーチンが必要だと思う。そういうわけです。\nで、メールアドレスの「@」なんだけども、perl5では「@」が\u0026quot;〜\u0026quot;の中ではそのまま使えない。ということらしい。実はこれに気づかなくて色々やっていたのを全部消してしまった。JavaScriptみたいにエラーの行が出れば楽なのに…。ブラウザからいきなり実行するのは良くないようだ。\nなんだかいきなりつまづいてしまった…。ちゃんと回避方法（\u0026quot;@\u0026quot;か'@'と書く）も書いてあったのに (T_T)\nperlでは引用符によって変数やエスケープ文字「\\」の扱いが違うらしい。\u0026quot;〜\u0026quot;の中では有効だけど、'〜'の中ではそのままの文字列として表示される。引用符の中に変数を書くというのが慣れない事だけど、引用符を区別する事で便利な使い方もあるのかもしれない。\nサブルーチンとは言っても、この状態だとSSIの「include」と変わらないけどね。せっかく「if文」も使おうと思ってたのに。\nちなみに、JIS版もせっかく作ったけど、うちの環境ではダメみたい。コードの変換をしてないからなのかな…。とは言っても、その変換方法もまだ良くわかってないけど。\nperl（CGI？）で日本語を使うときは、文字コードはEUC-JPが適しているらしい。バックスラッシュ（または円マーク）「\\」のコードが「Shift_JIS」では漢字にも使われている。だから、その文字を使うと特殊な働きをして文字が変わってしまう。気をつけよう。「\\」の他にも文字コードについては色々と問題があるようだ。JISは問題外らしい…。\nあと、IEで「CGIソース」をみると、時々「HTML」として解釈されるようだ。そういうときは、「更新」ボタンでしょう。きっと正常に表示されます。\nこの当時は、「CGIソース」は別でテキストファイルを作成して表示していたので、IEでは「HTML」として解釈されていた。今は表示方法が違うので大丈夫です。\nサブルーチンは確かに便利だとは思うけど、ここで使ったサブルーチンは、ほとんど意味が無い（爆）\nソースコード 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #!/usr/bin/perl @styles=(\u0026#34;../../ipp.css\u0026#34;); { \u0026amp;printHeader(\u0026#34;テスト1\u0026#34;); print \u0026#34;うまく動くかな？\\n\u0026#34;; \u0026amp;printFooter; exit; } sub printHeader{ print \u0026#34;Content-type: text/html\\n\\n\u0026#34;; print \u0026#34;\u0026lt;html lang=ja\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;$_[0]\u0026lt;/title\u0026gt;\\n\u0026#34;; foreach (@styles){ print \u0026#34;\u0026lt;link rel=\\\u0026#34;stylesheet\\\u0026#34; type=\\\u0026#34;text/css\\\u0026#34; href=\\\u0026#34;$_\\\u0026#34;\u0026gt;\\n\u0026#34;; } print \u0026#34;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;div class=head\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;h1\u0026gt;$_[0]\u0026lt;/h1\u0026gt;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;/div\u0026gt;\\n\u0026#34;; } sub printFooter{ print \u0026#34;\u0026lt;div class=foot\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;a href=\\\u0026#34;../../../index.htm\\\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../../\\\u0026#34;\u0026gt;Perl\u0026lt;/a\u0026gt; / \u0026lt;a href=\\\u0026#34;../\\\u0026#34;\u0026gt;TestCGI Index\u0026lt;/a\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;hr\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;address\u0026gt;\u0026lt;a href=\\\u0026#34;mailto:nobu3@x.age.ne.jp\\\u0026#34;\u0026gt;Written by Nobu3\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/div\u0026gt;\\n\u0026#34;; print \u0026#34;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#34;; } ","date":"2000-10-07T12:50:35+09:00","image":"https://www.nqou.net/favicon.png","permalink":"https://www.nqou.net/2000/10/07/125035/","title":"サブルーチンを使う"}]