<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Visitorパターン（GoF Behavioral Pattern）についての包括的な調査。基本構造、用途、利点・欠点、Perl実装例、内部リンク候補を含む。"><title>Visitorパターン（Visitor Design Pattern）調査ドキュメント</title><link rel=canonical href=https://www.nqou.net/warehouse/visitor-pattern-investigation/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Visitorパターン（Visitor Design Pattern）調査ドキュメント"><meta property='og:description' content="Visitorパターン（GoF Behavioral Pattern）についての包括的な調査。基本構造、用途、利点・欠点、Perl実装例、内部リンク候補を含む。"><meta property='og:url' content='https://www.nqou.net/warehouse/visitor-pattern-investigation/'><meta property='og:site_name' content='nqou.net'><meta property='og:type' content='article'><meta property='article:section' content='Warehouse'><meta property='article:tag' content='design-pattern'><meta property='article:tag' content='gof'><meta property='article:tag' content='visitor'><meta property='article:tag' content='behavioral-pattern'><meta property='article:tag' content='perl'><meta property='article:published_time' content='2025-12-31T09:26:00+09:00'><meta property='article:modified_time' content='2025-12-31T09:26:00+09:00'><meta property='og:image' content='https://www.nqou.net/favicon.png'><meta name=twitter:title content="Visitorパターン（Visitor Design Pattern）調査ドキュメント"><meta name=twitter:description content="Visitorパターン（GoF Behavioral Pattern）についての包括的な調査。基本構造、用途、利点・欠点、Perl実装例、内部リンク候補を含む。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nqou.net/favicon.png'><link rel="shortcut icon" href=/favicon.png><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap';:root{--base-font-family:Arial, "Noto Sans JP", sans-serif}</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3923446804785015" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js defer></script><script defer>document.addEventListener("DOMContentLoaded",function(){try{typeof mermaid!="undefined"&&document.querySelector(".mermaid")&&mermaid.initialize({startOnLoad:!0,securityLevel:"strict"})}catch(e){console.warn("Mermaid failed to initialize:",e)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-E50H9ESN7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E50H9ESN7E")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/public_images/nqounet201703.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🥃</span></figure><div class=site-meta><h1 class=site-name><a href=/>nqou.net</a></h1><h2 class=site-description>Whisky, Perl, Kansai.pm</h2></div></header><ol class=menu-social><li><a href=https://github.com/nqounet target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/nqounet target=_blank title=X rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/advent-calendar-2025/><svg class="icon icon-tabler icon-tabler-calendar" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><path d="M8 15h.01"/><path d="M12 15h.01"/><path d="M16 15h.01"/><path d="M8 19h.01"/><path d="M12 19h.01"/><path d="M16 19h.01"/></svg>
<span>Perl Advent Calendar 2025 - AI Edition</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/warehouse/><svg class="icon icon-tabler icon-tabler-warehouse" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l9-6 9 6"/><rect x="5" y="10" width="14" height="10" rx="2"/><rect x="10" y="14" width="4" height="6" rx="1"/><path d="M7 20v-4h2v4"/><path d="M15 20v-4h2v4"/></svg>
<span>Warehouse</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目次</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#調査概要>調査概要</a></li><li><a href=#1-visitorパターンの概要>1. Visitorパターンの概要</a><ol><li><a href=#11-gofデザインパターンにおける位置づけ>1.1 GoFデザインパターンにおける位置づけ</a></li><li><a href=#12-パターンの目的>1.2 パターンの目的</a></li><li><a href=#13-基本的な構造登場人物要素>1.3 基本的な構造（登場人物/要素）</a></li></ol></li><li><a href=#2-visitorパターンの用途>2. Visitorパターンの用途</a><ol><li><a href=#21-どのような問題を解決するのか>2.1 どのような問題を解決するのか</a></li><li><a href=#22-実際のユースケースコンパイラastツリー処理など>2.2 実際のユースケース（コンパイラ、ASTツリー処理など）</a><ol><li><a href=#ユースケース1-コンパイラと抽象構文木ast処理>ユースケース1: コンパイラと抽象構文木（AST）処理</a></li><li><a href=#ユースケース2-ドキュメント処理システム>ユースケース2: ドキュメント処理システム</a></li><li><a href=#ユースケース3-ファイルシステム操作>ユースケース3: ファイルシステム操作</a></li><li><a href=#ユースケース4-オンラインショッピング金融システム>ユースケース4: オンラインショッピング・金融システム</a></li></ol></li><li><a href=#23-適用すべき場面と適用すべきでない場面>2.3 適用すべき場面と適用すべきでない場面</a><ol><li><a href=#適用すべき場面when-to-use>適用すべき場面（When to Use）</a></li><li><a href=#適用すべきでない場面when-not-to-use>適用すべきでない場面（When NOT to Use）</a></li></ol></li></ol></li><li><a href=#3-利点と欠点>3. 利点と欠点</a><ol><li><a href=#31-メリットadvantages>3.1 メリット（Advantages）</a><ol><li><a href=#1-操作の追加が容易開放閉鎖原則>1. 操作の追加が容易（開放閉鎖原則）</a></li><li><a href=#2-関心の分離>2. 関心の分離</a></li></ol></li><li><a href=#32-デメリットdisadvantages>3.2 デメリット（Disadvantages）</a><ol><li><a href=#1-要素の追加が困難>1. 要素の追加が困難</a></li><li><a href=#2-カプセル化の破壊>2. カプセル化の破壊</a></li></ol></li><li><a href=#33-トレードオフの考え方>3.3 トレードオフの考え方</a></li></ol></li><li><a href=#4-サンプルコード実装の方向性>4. サンプルコード実装の方向性</a><ol><li><a href=#41-perlでの実装例を想定した場合の考慮点>4.1 Perlでの実装例を想定した場合の考慮点</a><ol><li><a href=#1-perlの動的型システムの活用>1. Perlの動的型システムの活用</a></li><li><a href=#2-ダブルディスパッチの実装>2. ダブルディスパッチの実装</a></li><li><a href=#3-エラーハンドリング>3. エラーハンドリング</a></li><li><a href=#4-テスタビリティ>4. テスタビリティ</a></li></ol></li><li><a href=#42-他の言語での実装例参考>4.2 他の言語での実装例（参考）</a><ol><li><a href=#java実装例>Java実装例</a></li><li><a href=#python実装例>Python実装例</a></li></ol></li></ol></li><li><a href=#5-内部リンク候補の調査>5. 内部リンク候補の調査</a><ol><li><a href=#51-contentpost配下で関連する記事の検索結果>5.1 <code>/content/post</code>配下で関連する記事の検索結果</a></li><li><a href=#52-推奨内部リンク構成>5.2 推奨内部リンク構成</a></li></ol></li><li><a href=#6-参考文献出典一覧>6. 参考文献・出典一覧</a><ol><li><a href=#61-公式書籍定番文献>6.1 公式書籍・定番文献</a></li><li><a href=#62-信頼性の高いwebリソース>6.2 信頼性の高いWebリソース</a></li><li><a href=#63-コンパイラast関連の専門リソース>6.3 コンパイラ・AST関連の専門リソース</a></li><li><a href=#64-実装例githubリポジトリ>6.4 実装例・GitHubリポジトリ</a></li><li><a href=#65-その他の参考資料>6.5 その他の参考資料</a></li></ol></li><li><a href=#7-調査結果のサマリーと結論>7. 調査結果のサマリーと結論</a><ol><li><a href=#71-主要な発見事項>7.1 主要な発見事項</a></li><li><a href=#72-不明点今後の調査が必要な領域>7.2 不明点・今後の調査が必要な領域</a></li><li><a href=#73-記事執筆への推奨事項>7.3 記事執筆への推奨事項</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/warehouse/visitor-pattern-investigation/><img src=/favicon.png loading=lazy alt="Featured image of post Visitorパターン（Visitor Design Pattern）調査ドキュメント"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/warehouse/visitor-pattern-investigation/>Visitorパターン（Visitor Design Pattern）調査ドキュメント</a></h2><h3 class=article-subtitle>Visitorパターン（GoF Behavioral Pattern）についての包括的な調査。基本構造、用途、利点・欠点、Perl実装例、内部リンク候補を含む。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>12月 31, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>読了時間: 23分</time></div></footer></div></header><section class=article-content><h1 id=visitorパターンvisitor-design-pattern調査ドキュメント>Visitorパターン（Visitor Design Pattern）調査ドキュメント</h1><h2 id=調査概要>調査概要</h2><p><strong>調査対象</strong>: Visitorパターン（GoFデザインパターン - 振る舞いに関するパターン）<br><strong>調査実施日</strong>: 2025年12月31日<br><strong>調査者</strong>: 10年以上の経験を持つ調査・情報収集専門家<br><strong>調査目的</strong>: Visitorパターンに関する最新かつ信頼性の高い情報を収集し、ブログ記事作成のための基盤資料とする</p><hr><h2 id=1-visitorパターンの概要>1. Visitorパターンの概要</h2><h3 id=11-gofデザインパターンにおける位置づけ>1.1 GoFデザインパターンにおける位置づけ</h3><p><strong>要点</strong>:</p><ul><li>Visitorパターンは、GoF（Gang of Four）の23のデザインパターンの一つ</li><li>**振る舞いに関するパターン（Behavioral Patterns）**に分類される（全11種類のうちの1つ）</li><li>オブジェクト間の責任分担とコミュニケーションを管理するパターン群に属する</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF書籍「Design Patterns: Elements of Reusable Object-Oriented Software」（1994年）にて定義</li><li>振る舞いパターンの中でも、特に「オブジェクト構造を変更せずに新しい操作を追加する」という明確な目的を持つ</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Visitor pattern - <a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></li><li>GeeksforGeeks: Visitor design pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/visitor-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/visitor-design-pattern/</a></li><li>Refactoring Guru: Visitor - <a class=link href=https://refactoring.guru/ja/design-patterns/visitor target=_blank rel=noopener>https://refactoring.guru/ja/design-patterns/visitor</a></li></ul><p><strong>信頼度</strong>: 高（公式文献および著名な技術サイト）</p><hr><h3 id=12-パターンの目的>1.2 パターンの目的</h3><p><strong>要点</strong>:
Visitorパターンの主な目的は「<strong>オブジェクト構造（例：複数の異なる型の集合体）を変更せず、新しい操作（処理）を容易に追加できるようにする</strong>」こと。</p><p><strong>詳細説明</strong>:</p><ul><li>アルゴリズム（処理ロジック）をオブジェクト（データ構造）から分離する</li><li>オブジェクトの要素クラスを変更せずに、新しい操作を追加できる</li><li>開放閉鎖原則（Open/Closed Principle）に準拠：拡張には開いており、修正には閉じている</li></ul><p><strong>具体例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>状況: 複数の異なる型の要素（FileノードとDirectoryノード）から成るファイルシステム
</span></span><span class=line><span class=cl>要求: 
</span></span><span class=line><span class=cl>  - サイズ計算機能を追加したい
</span></span><span class=line><span class=cl>  - 後日、権限チェック機能も追加したい
</span></span><span class=line><span class=cl>  - さらに、ウイルススキャン機能も追加したい
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>従来の方法:
</span></span><span class=line><span class=cl>  各要素クラス（File, Directory）にcalcSize(), checkPermission(), scanVirus()メソッドを追加
</span></span><span class=line><span class=cl>  → クラスが肥大化し、責任が不明確になる
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Visitorパターン:
</span></span><span class=line><span class=cl>  SizeVisitor, PermissionVisitor, VirusScanVisitorを個別に作成
</span></span><span class=line><span class=cl>  → 要素クラスは変更不要、新しい操作はVisitorとして追加
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>要素の型が固定されており、新しい処理（ビジター）を追加していきたいケースに最適</li><li>複数型の集合体を横断的に処理したい場合に有効（if文やinstanceofチェックを排除）</li></ul><p><strong>出典</strong>:</p><ul><li>ソフトウェア開発日記: Visitorパターンとは - <a class=link href=https://lightgauge.net/journal/object-oriented/visitor-pattern/ target=_blank rel=noopener>https://lightgauge.net/journal/object-oriented/visitor-pattern/</a></li><li>Zenn: デザインパターンを学ぶ #19 ビジター（Visitor） - <a class=link href=https://zenn.dev/tajicode/articles/ab5d11802df265 target=_blank rel=noopener>https://zenn.dev/tajicode/articles/ab5d11802df265</a></li><li>MYNT Blog: GoFデザインパターン23個を完全に理解するブログ #23 Visitor - <a class=link href=https://blog.myntinc.com/2025/11/gof23-23-visitor.html target=_blank rel=noopener>https://blog.myntinc.com/2025/11/gof23-23-visitor.html</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=13-基本的な構造登場人物要素>1.3 基本的な構造（登場人物/要素）</h3><p><strong>要点</strong>:
Visitorパターンは以下の4つの主要な要素（役割）から構成される。</p><div class=table-wrapper><table><thead><tr><th>要素名</th><th>役割</th><th>説明</th></tr></thead><tbody><tr><td><strong>Visitor（訪問者）</strong></td><td>インターフェース</td><td>各要素型ごとの訪問メソッド（visit）を定義</td></tr><tr><td><strong>ConcreteVisitor（具体訪問者）</strong></td><td>実装クラス</td><td>実際の処理ロジックを実装</td></tr><tr><td><strong>Element（要素）</strong></td><td>インターフェース</td><td>Visitorを受け入れる<code>accept(visitor)</code>メソッドを定義</td></tr><tr><td><strong>ConcreteElement（具体要素）</strong></td><td>実装クラス</td><td>個々のデータ構造を表し、acceptメソッドで自分自身をVisitorに渡す</td></tr><tr><td><strong>ObjectStructure（オブジェクト構造）</strong></td><td>コレクション</td><td>Elementのコレクション（配列やツリー構造など）</td></tr></tbody></table></div><p><strong>構造図（簡略版）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;&lt;interface&gt;&gt; Visitor
</span></span><span class=line><span class=cl>  + visitElementA(ElementA)
</span></span><span class=line><span class=cl>  + visitElementB(ElementB)
</span></span><span class=line><span class=cl>      ↑
</span></span><span class=line><span class=cl>      | implements
</span></span><span class=line><span class=cl>ConcreteVisitor
</span></span><span class=line><span class=cl>  + visitElementA(ElementA) { /* 処理A */ }
</span></span><span class=line><span class=cl>  + visitElementB(ElementB) { /* 処理B */ }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;&lt;interface&gt;&gt; Element
</span></span><span class=line><span class=cl>  + accept(Visitor)
</span></span><span class=line><span class=cl>      ↑
</span></span><span class=line><span class=cl>      | implements
</span></span><span class=line><span class=cl>ConcreteElementA          ConcreteElementB
</span></span><span class=line><span class=cl>  + accept(v) {             + accept(v) {
</span></span><span class=line><span class=cl>      v.visitElementA(this)     v.visitElementB(this)
</span></span><span class=line><span class=cl>    }                         }
</span></span></code></pre></td></tr></table></div></div><p><strong>ダブルディスパッチ（Double Dispatch）の仕組み</strong>:</p><ul><li>Visitorパターンの核心概念</li><li><code>element.accept(visitor)</code> → <code>visitor.visit(element)</code> の2段階呼び出し</li><li>要素型（Element）とビジター型（Visitor）の<strong>両方</strong>に基づいて処理を決定</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF書籍およびパターン解説文献で一貫した構造定義</li><li>ダブルディスパッチにより、単一ディスパッチ（通常のメソッド呼び出し）では実現困難な柔軟性を実現</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Visitor pattern - <a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></li><li>Programming TIPS: Java : Visitor パターン - <a class=link href=https://programming-tips.jp/archives/a2/52/index.html target=_blank rel=noopener>https://programming-tips.jp/archives/a2/52/index.html</a></li><li>Oracle: Visitorデザイン・パターン 徹底解説（PDF） - <a class=link href=https://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-SO18-VisitorDesignPattern-ja.pdf target=_blank rel=noopener>https://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-SO18-VisitorDesignPattern-ja.pdf</a></li><li>SourceMaking: Visitor Design Pattern - <a class=link href=https://sourcemaking.com/design_patterns/visitor target=_blank rel=noopener>https://sourcemaking.com/design_patterns/visitor</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=2-visitorパターンの用途>2. Visitorパターンの用途</h2><h3 id=21-どのような問題を解決するのか>2.1 どのような問題を解決するのか</h3><p><strong>要点</strong>:
Visitorパターンは以下のような問題を解決する。</p><ol><li><p><strong>クラスの肥大化問題</strong></p><ul><li>複数の異なる操作を同一クラスに追加していくと、クラスが肥大化し、単一責任原則（SRP）に違反する</li><li>Visitorパターンでは、各操作を独立したVisitorクラスとして分離可能</li></ul></li><li><p><strong>if/switch文の乱立</strong></p><ul><li>型判定（instanceof、type checking）による条件分岐が増加</li><li>Visitorパターンではダブルディスパッチにより型判定を排除</li></ul></li><li><p><strong>開放閉鎖原則（OCP）の違反</strong></p><ul><li>新しい操作を追加するたびに既存クラスを修正する必要がある</li><li>Visitorパターンでは新しいConcreteVisitorを追加するだけで済む</li></ul></li></ol><p><strong>解決前のコード例（アンチパターン）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 悪い例：各要素クラスに複数の操作を詰め込む</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>calc_size</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>check_permission</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>scan_virus</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>compress</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1># → クラスが肥大化、責任が不明確</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># または、型判定による分岐</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>process_element</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$element</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$element</span><span class=o>-&gt;</span><span class=n>isa</span><span class=p>(</span><span class=s>&#39;File&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># File固有の処理</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>elsif</span> <span class=p>(</span><span class=nv>$element</span><span class=o>-&gt;</span><span class=n>isa</span><span class=p>(</span><span class=s>&#39;Directory&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># Directory固有の処理</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1># → 新しい型を追加するたびに修正が必要</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Visitorパターンでの解決</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 各操作を独立したVisitorとして分離</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>SizeVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>PermissionVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 要素クラスはacceptメソッドだけを持つ</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_file</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>SOLID原則（特にSRP, OCP）への準拠を実現</li><li>実務における保守性・拡張性の向上が報告されている</li></ul><p><strong>出典</strong>:</p><ul><li>TheLinuxCode: Visitor Design Pattern: A Comprehensive Guide - <a class=link href=https://thelinuxcode.com/visitor-design-pattern-a-comprehensive-guide/ target=_blank rel=noopener>https://thelinuxcode.com/visitor-design-pattern-a-comprehensive-guide/</a></li><li>GoF Pattern: Visitor Pattern - <a class=link href=https://www.gofpattern.com/behavioral/patterns/visitor-pattern.php target=_blank rel=noopener>https://www.gofpattern.com/behavioral/patterns/visitor-pattern.php</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=22-実際のユースケースコンパイラastツリー処理など>2.2 実際のユースケース（コンパイラ、ASTツリー処理など）</h3><p><strong>要点</strong>:
Visitorパターンは以下のような実世界のシステムで広く活用されている。</p><h4 id=ユースケース1-コンパイラと抽象構文木ast処理>ユースケース1: コンパイラと抽象構文木（AST）処理</h4><p><strong>詳細</strong>:</p><ul><li><strong>問題</strong>: コンパイラでは、ソースコードを解析して抽象構文木（AST）を構築する。ASTに対して複数の操作（型チェック、コード生成、最適化、評価など）を実行する必要がある。</li><li><strong>Visitorパターンの適用</strong>: 各操作をVisitorとして実装<ul><li><code>TypeCheckVisitor</code>: 型の整合性チェック</li><li><code>CodeGenVisitor</code>: 中間コードやアセンブリの生成</li><li><code>OptimizationVisitor</code>: 定数畳み込み、デッドコード削除</li><li><code>EvaluationVisitor</code>: 式の評価</li></ul></li></ul><p><strong>具体例（JavaによるAST処理）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Expression</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>ExpressionVisitor</span><span class=w> </span><span class=n>visitor</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Number</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Expression</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>ExpressionVisitor</span><span class=w> </span><span class=n>visitor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>visitor</span><span class=p>.</span><span class=na>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Addition</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Expression</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Expression</span><span class=w> </span><span class=n>left</span><span class=p>,</span><span class=w> </span><span class=n>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>ExpressionVisitor</span><span class=w> </span><span class=n>visitor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>visitor</span><span class=p>.</span><span class=na>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>ExpressionVisitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Number</span><span class=w> </span><span class=n>number</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Addition</span><span class=w> </span><span class=n>addition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 評価用Visitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>EvaluationVisitor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ExpressionVisitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Number</span><span class=w> </span><span class=n>number</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>number</span><span class=p>.</span><span class=na>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Addition</span><span class=w> </span><span class=n>addition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>addition</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>leftResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>addition</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>leftResult</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>実例</strong>:</p><ul><li>Java Compiler（Eclipse JDT）</li><li>C++コンパイラフロントエンド</li><li>Crystal言語の構文解析</li><li>LLVM IR の変換パス</li></ul><p><strong>出典</strong>:</p><ul><li>Moments Log: Visitor Pattern in Compiler Design: Abstract Syntax Trees - <a class=link href=https://www.momentslog.com/development/design-pattern/visitor-pattern-in-compiler-design-abstract-syntax-trees-2 target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/visitor-pattern-in-compiler-design-abstract-syntax-trees-2</a></li><li>Compiling to Assembly: Visitor Pattern - <a class=link href=https://keleshev.com/compiling-to-assembly-from-scratch/12-visitor-pattern target=_blank rel=noopener>https://keleshev.com/compiling-to-assembly-from-scratch/12-visitor-pattern</a></li><li>Pat Shaughnessy: Visiting an Abstract Syntax Tree - <a class=link href=https://patshaughnessy.net/2022/1/22/visiting-an-abstract-syntax-tree target=_blank rel=noopener>https://patshaughnessy.net/2022/1/22/visiting-an-abstract-syntax-tree</a></li><li>CS Colorado: AST Visitor patterns（PDF） - <a class=link href=https://www.cs.colostate.edu/~cs453/yr2014/Slides/10-AST-visitor.ppt.pdf target=_blank rel=noopener>https://www.cs.colostate.edu/~cs453/yr2014/Slides/10-AST-visitor.ppt.pdf</a></li></ul><p><strong>信頼度</strong>: 高（学術的文献および実装例が豊富）</p><hr><h4 id=ユースケース2-ドキュメント処理システム>ユースケース2: ドキュメント処理システム</h4><p><strong>詳細</strong>:</p><ul><li><strong>問題</strong>: ドキュメントは複数の要素（段落、テーブル、画像、リストなど）から構成される。各要素に対して複数の操作（レンダリング、スペルチェック、PDF出力、統計情報取得）が必要。</li><li><strong>Visitorパターンの適用</strong>:<ul><li><code>RenderVisitor</code>: HTML/PDF形式でレンダリング</li><li><code>SpellCheckVisitor</code>: スペルチェック実行</li><li><code>StatisticsVisitor</code>: 文字数・単語数などの統計情報収集</li></ul></li></ul><p><strong>実例</strong>:</p><ul><li>Microsoft WordやGoogle Docsのような文書処理システム</li><li>LaTeX/Markdown処理エンジン</li></ul><hr><h4 id=ユースケース3-ファイルシステム操作>ユースケース3: ファイルシステム操作</h4><p><strong>詳細</strong>:</p><ul><li><strong>問題</strong>: ファイルシステムはファイルとディレクトリから成る階層構造。サイズ計算、権限チェック、バックアップなどの操作を追加したい。</li><li><strong>Visitorパターンの適用</strong>:<ul><li><code>SizeCalculatorVisitor</code>: ファイル・ディレクトリのサイズ計算</li><li><code>PermissionCheckerVisitor</code>: アクセス権限の確認</li><li><code>BackupVisitor</code>: バックアップ対象のファイル収集</li></ul></li></ul><p><strong>Perlでの実装例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>new</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$class</span><span class=p>,</span> <span class=nv>$name</span><span class=p>,</span> <span class=nv>$size</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>bless</span> <span class=p>{</span> <span class=n>name</span> <span class=o>=&gt;</span> <span class=nv>$name</span><span class=p>,</span> <span class=n>size</span> <span class=o>=&gt;</span> <span class=nv>$size</span> <span class=p>},</span> <span class=nv>$class</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_file</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Directory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>new</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$class</span><span class=p>,</span> <span class=nv>$name</span><span class=p>,</span> <span class=nv>$items</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>bless</span> <span class=p>{</span> <span class=n>name</span> <span class=o>=&gt;</span> <span class=nv>$name</span><span class=p>,</span> <span class=n>items</span> <span class=o>=&gt;</span> <span class=nv>$items</span> <span class=p>},</span> <span class=nv>$class</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_directory</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>SizeVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>new</span> <span class=p>{</span> <span class=nb>bless</span> <span class=p>{</span> <span class=n>total_size</span> <span class=o>=&gt;</span> <span class=mi>0</span> <span class=p>},</span> <span class=nb>shift</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$file</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>total_size</span><span class=p>}</span> <span class=o>+=</span> <span class=nv>$file</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>size</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$dir</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=k>my</span> <span class=nv>$item</span> <span class=p>(</span><span class=nv>@</span><span class=p>{</span><span class=nv>$dir</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>items</span><span class=p>}})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$item</span><span class=o>-&gt;</span><span class=nb>accept</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_total_size</span> <span class=p>{</span> <span class=nb>shift</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>total_size</span><span class=p>}</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=ユースケース4-オンラインショッピング金融システム>ユースケース4: オンラインショッピング・金融システム</h4><p><strong>詳細</strong>:</p><ul><li><strong>問題</strong>: ショッピングカートには異なる種類の商品（Book、Electronics、Clothingなど）が混在。価格計算、割引適用、配送料計算、税金計算などの操作が必要。</li><li><strong>Visitorパターンの適用</strong>:<ul><li><code>PriceCalculatorVisitor</code>: 合計金額計算</li><li><code>DiscountVisitor</code>: 割引適用</li><li><code>ShippingCostVisitor</code>: 配送料計算</li><li><code>TaxCalculatorVisitor</code>: 税金計算</li></ul></li></ul><p><strong>実例</strong>:</p><ul><li>ECサイトのカート処理</li><li>金融システムの取引処理（手数料計算、レポート生成など）</li></ul><p><strong>出典</strong>:</p><ul><li>Qiita: Visitorパターン - <a class=link href=https://qiita.com/Yankaji777/items/ac5a006057c880d3bb26 target=_blank rel=noopener>https://qiita.com/Yankaji777/items/ac5a006057c880d3bb26</a></li><li>Tamotech: 「Visitor」パターンとは？ - <a class=link href=https://tamotech.blog/2025/05/19/visitor/ target=_blank rel=noopener>https://tamotech.blog/2025/05/19/visitor/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=23-適用すべき場面と適用すべきでない場面>2.3 適用すべき場面と適用すべきでない場面</h3><h4 id=適用すべき場面when-to-use>適用すべき場面（When to Use）</h4><p><strong>要点</strong>:</p><ol><li><p><strong>要素の型が安定しており、操作が頻繁に追加される場合</strong></p><ul><li>オブジェクト構造（要素の種類）が固定的</li><li>新しい操作を継続的に追加する必要がある</li><li>例：コンパイラ（ASTの構造は安定、新しい最適化パスを追加）</li></ul></li><li><p><strong>複数の無関係な操作を一元管理したい場合</strong></p><ul><li>各操作のロジックを1箇所（Visitorクラス）に集約</li><li>オブジェクト構造の各要素に操作ロジックを分散させたくない</li></ul></li><li><p><strong>if/switch文による型判定を排除したい場合</strong></p><ul><li>ダブルディスパッチにより、型判定なしで適切なメソッドを呼び出せる</li></ul></li><li><p><strong>公開API設計で、ユーザーが振る舞いを拡張できるようにしたい場合</strong></p><ul><li>コアコードを変更せずに新しい操作を追加可能</li><li>プラグイン機構として活用</li></ul></li></ol><p><strong>具体的な判断基準</strong>:</p><ul><li>「新しい要素型を追加する頻度」 &lt; 「新しい操作を追加する頻度」の場合</li></ul><p><strong>根拠</strong>:</p><ul><li>GoFパターンのガイドライン</li><li>実務での成功事例が蓄積</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Visitor pattern - <a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></li><li>Software Patterns Lexicon: Visitor Pattern in Go - <a class=link href=https://softwarepatternslexicon.com/go/classic-gang-of-four-gof-design-patterns-in-go/behavioral-patterns/visitor/ target=_blank rel=noopener>https://softwarepatternslexicon.com/go/classic-gang-of-four-gof-design-patterns-in-go/behavioral-patterns/visitor/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h4 id=適用すべきでない場面when-not-to-use>適用すべきでない場面（When NOT to Use）</h4><p><strong>要点</strong>:</p><ol><li><p><strong>要素の型が頻繁に変更される場合</strong></p><ul><li>新しい要素型を追加するたびに、<strong>すべてのVisitorクラス</strong>を修正する必要がある</li><li>保守コストが非常に高くなる</li><li>例：頻繁に新しい商品カテゴリが追加されるECシステム</li></ul></li><li><p><strong>操作が単純で、型ごとの処理分岐が少ない場合</strong></p><ul><li>シンプルなポリモーフィズム（仮想関数）で十分</li><li>Visitorパターンは過剰設計（オーバーエンジニアリング）になる</li></ul></li><li><p><strong>パターンマッチングや代数的データ型を持つ言語の場合</strong></p><ul><li>Haskell、Scala、OCaml、Rust、最新のC#/F#など</li><li>これらの言語ではパターンマッチングでより簡潔に記述可能</li></ul></li><li><p><strong>小規模システムで追加のレイヤーが負担になる場合</strong></p><ul><li>Visitor、ConcreteVisitor、Element、ConcreteElement、ObjectStructureと多層化</li><li>システムの複雑性がメリットを上回る</li></ul></li><li><p><strong>カプセル化を厳密に守りたい場合</strong></p><ul><li>Visitorは要素の内部状態にアクセスすることが多い</li><li>要素とVisitorの結合度が高くなる可能性</li></ul></li></ol><p><strong>具体的な判断基準</strong>:</p><ul><li>「新しい要素型を追加する頻度」 > 「新しい操作を追加する頻度」の場合は避ける</li></ul><p><strong>根拠</strong>:</p><ul><li>パターン誤用の事例研究</li><li>関数型言語の代替手段との比較研究</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Visitor pattern - <a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></li><li>ScholarHat: Visitor Design Pattern: An Easy Path - <a class=link href=https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern target=_blank rel=noopener>https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern</a></li><li>Coder Scratchpad: Python Design Patterns: Visitor Pattern - <a class=link href=https://coderscratchpad.com/python-design-patterns-visitor-pattern/ target=_blank rel=noopener>https://coderscratchpad.com/python-design-patterns-visitor-pattern/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=3-利点と欠点>3. 利点と欠点</h2><h3 id=31-メリットadvantages>3.1 メリット（Advantages）</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>メリット</th><th>説明</th><th>具体例</th></tr></thead><tbody><tr><td><strong>1. 操作の追加が容易</strong></td><td>既存の要素クラスを変更せず、新しいConcreteVisitorを追加するだけで新機能を実装可能</td><td>コンパイラに新しい最適化パス（Visitor）を追加</td></tr><tr><td><strong>2. 関心の分離（Separation of Concerns）</strong></td><td>操作ロジックがVisitorに集約され、データ構造（Element）と処理（Visitor）が分離</td><td>ファイル処理とサイズ計算ロジックの分離</td></tr><tr><td><strong>3. 開放閉鎖原則（OCP）への準拠</strong></td><td>拡張には開いており（新Visitor追加）、修正には閉じている（既存Element変更不要）</td><td>既存コードに影響を与えず拡張可能</td></tr><tr><td><strong>4. 関連操作のグループ化</strong></td><td>同じ目的の処理が1つのVisitorクラスにまとまる</td><td>レポート生成ロジックがReportVisitorに集約</td></tr><tr><td><strong>5. 型安全性の向上</strong></td><td>ダブルディスパッチにより、if/instanceofなどの型チェックが不要</td><td>コンパイル時の型エラー検出</td></tr><tr><td><strong>6. 複雑なアルゴリズムの一元管理</strong></td><td>複数のクラスにまたがる処理を1箇所で管理</td><td>ASTの複雑な変換ロジックを1つのVisitorに集約</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><h4 id=1-操作の追加が容易開放閉鎖原則>1. 操作の追加が容易（開放閉鎖原則）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 新しい操作を追加する場合</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>NewOperationVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 既存の要素クラス（File, Directory）は一切変更不要</span>
</span></span><span class=line><span class=cl><span class=c1># → OCPに準拠した設計</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-関心の分離>2. 関心の分離</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>データ構造（Element）側:
</span></span><span class=line><span class=cl>  - データの保持
</span></span><span class=line><span class=cl>  - Visitorの受け入れ（accept）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>処理ロジック（Visitor）側:
</span></span><span class=line><span class=cl>  - 具体的な操作の実装
</span></span><span class=line><span class=cl>  - 各要素型ごとの処理分岐
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>→ 責任が明確に分離され、保守性が向上
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>GoFパターンの設計原則</li><li>実務での適用事例と成功報告</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Visitor design pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/visitor-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/visitor-design-pattern/</a></li><li>ScholarHat: Visitor Design Pattern - <a class=link href=https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern target=_blank rel=noopener>https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern</a></li><li>Generalist Programmer: What is Visitor Pattern - <a class=link href=https://generalistprogrammer.com/glossary/visitor-pattern target=_blank rel=noopener>https://generalistprogrammer.com/glossary/visitor-pattern</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=32-デメリットdisadvantages>3.2 デメリット（Disadvantages）</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>デメリット</th><th>説明</th><th>影響</th></tr></thead><tbody><tr><td><strong>1. 要素の追加が困難</strong></td><td>新しい要素型を追加すると、<strong>すべてのVisitor</strong>に新しいvisitメソッドを追加する必要がある</td><td>保守コストの増大</td></tr><tr><td><strong>2. カプセル化の破壊</strong></td><td>Visitorが要素の内部状態にアクセスする必要がある場合、privateフィールドの公開が必要になることがある</td><td>情報隠蔽の原則に反する</td></tr><tr><td><strong>3. 双方向依存</strong></td><td>ElementとVisitorが相互に依存する関係になる</td><td>循環依存の発生</td></tr><tr><td><strong>4. 複雑性の増加</strong></td><td>Visitor、ConcreteVisitor、Element、ConcreteElementと多層化</td><td>小規模システムでは過剰設計</td></tr><tr><td><strong>5. ダブルディスパッチの理解が必要</strong></td><td>accept → visitの2段階呼び出しを理解する必要がある</td><td>学習コストの増加</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><h4 id=1-要素の追加が困難>1. 要素の追加が困難</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 新しい要素型SymbolicLinkを追加する場合</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>SymbolicLink</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_symbolic_link</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>  <span class=c1># 新メソッド</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 問題：すべての既存Visitorに修正が必要</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>SizeVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_symbolic_link</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>  <span class=c1># 追加必要</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>PermissionVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_symbolic_link</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>  <span class=c1># 追加必要</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>BackupVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_symbolic_link</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>  <span class=c1># 追加必要</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># → Visitorが多数ある場合、大規模な修正が必要</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-カプセル化の破壊>2. カプセル化の破壊</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>new</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$class</span><span class=p>,</span> <span class=nv>$name</span><span class=p>,</span> <span class=nv>$size</span><span class=p>,</span> <span class=nv>$permissions</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>bless</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=&gt;</span> <span class=nv>$name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>_size</span> <span class=o>=&gt;</span> <span class=nv>$size</span><span class=p>,</span>          <span class=c1># private想定</span>
</span></span><span class=line><span class=cl>        <span class=n>_permissions</span> <span class=o>=&gt;</span> <span class=nv>$permissions</span><span class=p>,</span>  <span class=c1># private想定</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=nv>$class</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Visitorがアクセスするために、getterを公開</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_size</span> <span class=p>{</span> <span class=nb>shift</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>_size</span><span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_permissions</span> <span class=p>{</span> <span class=nb>shift</span><span class=o>-&gt;</span><span class=p>{</span><span class=n>_permissions</span><span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># → カプセル化が弱まる</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>パターン適用時の実務経験レポート</li><li>アンチパターンとしての報告事例</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Visitor pattern - <a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></li><li>ScholarHat: Visitor Design Pattern - <a class=link href=https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern target=_blank rel=noopener>https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=33-トレードオフの考え方>3.3 トレードオフの考え方</h3><p><strong>要点</strong>:
Visitorパターンの採用は、以下のトレードオフを考慮する必要がある。</p><p><strong>トレードオフの軸</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>操作の追加頻度 vs 要素の追加頻度
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>高 ←─ 操作追加頻度 ─→ 低
</span></span><span class=line><span class=cl> |                      |
</span></span><span class=line><span class=cl>Visitor有利         Visitor不利
</span></span><span class=line><span class=cl> |                      |
</span></span><span class=line><span class=cl>低 ←─ 要素追加頻度 ─→ 高
</span></span></code></pre></td></tr></table></div></div><p><strong>判断基準表</strong>:</p><div class=table-wrapper><table><thead><tr><th>状況</th><th>操作追加頻度</th><th>要素追加頻度</th><th>Visitor採用</th><th>理由</th></tr></thead><tbody><tr><td>コンパイラAST処理</td><td>高（頻繁）</td><td>低（安定）</td><td>◎ 推奨</td><td>新しい最適化パスを継続的に追加</td></tr><tr><td>ECサイトの商品管理</td><td>低（稀）</td><td>高（頻繁）</td><td>× 非推奨</td><td>新商品カテゴリが頻繁に追加</td></tr><tr><td>ドキュメント処理</td><td>中（定期）</td><td>低（安定）</td><td>○ 採用可</td><td>レンダリング、統計、変換など操作追加</td></tr><tr><td>小規模ツール</td><td>低（稀）</td><td>低（安定）</td><td>△ 不要</td><td>シンプルなポリモーフィズムで十分</td></tr></tbody></table></div><p><strong>設計判断のフローチャート</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>開始
</span></span><span class=line><span class=cl> ↓
</span></span><span class=line><span class=cl>要素の種類は安定しているか？
</span></span><span class=line><span class=cl> ├─ No → Visitorパターンは不適切
</span></span><span class=line><span class=cl> ↓ Yes
</span></span><span class=line><span class=cl>新しい操作を頻繁に追加するか？
</span></span><span class=line><span class=cl> ├─ No → 他のパターンを検討
</span></span><span class=line><span class=cl> ↓ Yes
</span></span><span class=line><span class=cl>要素数とVisitor数は管理可能か？
</span></span><span class=line><span class=cl> ├─ No → 複雑性が高すぎる
</span></span><span class=line><span class=cl> ↓ Yes
</span></span><span class=line><span class=cl>Visitorパターンを採用
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>パターン選択の意思決定プロセス研究</li><li>実務における成功・失敗事例の分析</li></ul><p><strong>出典</strong>:</p><ul><li>Code Study: Confused About the Visitor Design Pattern? - <a class=link href=https://www.codestudy.net/blog/confused-about-the-visitor-design-pattern/ target=_blank rel=noopener>https://www.codestudy.net/blog/confused-about-the-visitor-design-pattern/</a></li><li>Visual Paradigm: Visitor Pattern Tutorial - <a class=link href=https://tutorials.visual-paradigm.com/visitor-pattern-tutorial/ target=_blank rel=noopener>https://tutorials.visual-paradigm.com/visitor-pattern-tutorial/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=4-サンプルコード実装の方向性>4. サンプルコード実装の方向性</h2><h3 id=41-perlでの実装例を想定した場合の考慮点>4.1 Perlでの実装例を想定した場合の考慮点</h3><p><strong>要点</strong>:
PerlでVisitorパターンを実装する際は、以下の点を考慮する必要がある。</p><h4 id=1-perlの動的型システムの活用>1. Perlの動的型システムの活用</h4><p><strong>考慮点</strong>:</p><ul><li>Perlには厳密なインターフェース定義機構がないため、メソッド命名規則で代替</li><li>Moo/Mooseを使用したオブジェクト指向設計が推奨</li><li>Roleベースの設計（Moo::Role / Moose::Role）でインターフェースを定義</li></ul><p><strong>実装例（Moo::Role使用）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># Visitor ロールの定義</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Visitor::Role</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo::Role</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>requires</span> <span class=s>&#39;visit_file&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>requires</span> <span class=s>&#39;visit_directory&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Element ロールの定義</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Element::Role</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo::Role</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>requires</span> <span class=s>&#39;accept&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体的な要素の実装</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>with</span> <span class=s>&#39;Element::Role&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>name</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>size</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_file</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Directory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>with</span> <span class=s>&#39;Element::Role&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>name</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>items</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span> <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=o>[]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_directory</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 具体的なVisitorの実装</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>SizeVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>with</span> <span class=s>&#39;Visitor::Role&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>total_size</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span> <span class=n>default</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$file</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>total_size</span><span class=p>(</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=n>total_size</span> <span class=o>+</span> <span class=nv>$file</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$dir</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=k>my</span> <span class=nv>$item</span> <span class=p>(</span><span class=nv>@</span><span class=p>{</span><span class=nv>$dir</span><span class=o>-&gt;</span><span class=n>items</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$item</span><span class=o>-&gt;</span><span class=nb>accept</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>メリット</strong>:</p><ul><li>Moo::Roleの<code>requires</code>によりインターフェース制約を強制</li><li>実行時にメソッドの存在をチェック</li><li>型制約（isa）でオブジェクトの型を検証可能</li></ul><hr><h4 id=2-ダブルディスパッチの実装>2. ダブルディスパッチの実装</h4><p><strong>考慮点</strong>:</p><ul><li>Perlでは明示的なメソッドオーバーロードがないため、メソッド名で区別</li><li><code>visit_file</code>, <code>visit_directory</code>など、要素型ごとに異なるメソッド名を使用</li></ul><p><strong>実装パターン</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># Element側</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>accept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$visitor</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 自分の型に応じた適切なvisitメソッドを呼び出す</span>
</span></span><span class=line><span class=cl>    <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>visit_file</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>  <span class=c1># Fileの場合</span>
</span></span><span class=line><span class=cl>    <span class=c1># または</span>
</span></span><span class=line><span class=cl>    <span class=c1># $visitor-&gt;visit_directory($self);  # Directoryの場合</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Visitor側</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_file</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$file</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># File固有の処理</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$directory</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Directory固有の処理</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=3-エラーハンドリング>3. エラーハンドリング</h4><p><strong>考慮点</strong>:</p><ul><li>必須メソッドの未実装チェック（Moo::Roleの<code>requires</code>で自動化）</li><li>型の不一致エラー（<code>isa</code>チェック）</li><li>循環参照の防止（特にツリー構造の場合）</li></ul><p><strong>実装例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>sub</span> <span class=nf>visit_directory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$dir</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 型チェック</span>
</span></span><span class=line><span class=cl>    <span class=nb>die</span> <span class=s>&#34;Expected Directory object&#34;</span> <span class=k>unless</span> <span class=nv>$dir</span><span class=o>-&gt;</span><span class=n>isa</span><span class=p>(</span><span class=s>&#39;Directory&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 循環参照チェック（簡易版）</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>%visited</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=k>my</span> <span class=nv>$item</span> <span class=p>(</span><span class=nv>@</span><span class=p>{</span><span class=nv>$dir</span><span class=o>-&gt;</span><span class=n>items</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>next</span> <span class=k>if</span> <span class=nv>$visited</span><span class=p>{</span><span class=nv>$item</span><span class=p>}</span><span class=o>++</span><span class=p>;</span>  <span class=c1># 訪問済みならスキップ</span>
</span></span><span class=line><span class=cl>        <span class=nv>$item</span><span class=o>-&gt;</span><span class=nb>accept</span><span class=p>(</span><span class=nv>$self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=4-テスタビリティ>4. テスタビリティ</h4><p><strong>考慮点</strong>:</p><ul><li>Test2/Test::Moreを使用した単体テスト</li><li>Visitorのモック/スタブ化が容易</li><li>各Visitorを独立してテスト可能</li></ul><p><strong>テスト例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>use</span> <span class=nn>Test2::V0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>File</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Directory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>SizeVisitor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>subtest</span> <span class=s>&#39;SizeVisitor calculates total size&#39;</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$file1</span> <span class=o>=</span> <span class=nn>File</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>name</span> <span class=o>=&gt;</span> <span class=s>&#39;file1.txt&#39;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=&gt;</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$file2</span> <span class=o>=</span> <span class=nn>File</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>name</span> <span class=o>=&gt;</span> <span class=s>&#39;file2.txt&#39;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=&gt;</span> <span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$dir</span> <span class=o>=</span> <span class=nn>Directory</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=&gt;</span> <span class=s>&#39;mydir&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=nv>$file1</span><span class=p>,</span> <span class=nv>$file2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$visitor</span> <span class=o>=</span> <span class=nn>SizeVisitor</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$dir</span><span class=o>-&gt;</span><span class=nb>accept</span><span class=p>(</span><span class=nv>$visitor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>is</span> <span class=nv>$visitor</span><span class=o>-&gt;</span><span class=n>total_size</span><span class=p>,</span> <span class=mi>300</span><span class=p>,</span> <span class=s>&#39;Total size is correct&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>done_testing</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>Perlのベストプラクティス</li><li>Moo/Mooseコミュニティのガイドライン</li></ul><p><strong>出典</strong>:</p><ul><li>MetaCPAN: Moo - <a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></li><li>MetaCPAN: Moo::Role - <a class=link href=https://metacpan.org/pod/Moo::Role target=_blank rel=noopener>https://metacpan.org/pod/Moo::Role</a></li><li>Test2 Documentation - <a class=link href=https://metacpan.org/pod/Test2::V0 target=_blank rel=noopener>https://metacpan.org/pod/Test2::V0</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=42-他の言語での実装例参考>4.2 他の言語での実装例（参考）</h3><p><strong>要点</strong>:
参考のため、他の主要言語での実装例を示す。</p><h4 id=java実装例>Java実装例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Element interface</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Element</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>Visitor</span><span class=w> </span><span class=n>visitor</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// Concrete Elements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>File</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Element</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>Visitor</span><span class=w> </span><span class=n>visitor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>visitor</span><span class=p>.</span><span class=na>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getSize</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Directory</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Element</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Element</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>Visitor</span><span class=w> </span><span class=n>visitor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>visitor</span><span class=p>.</span><span class=na>visit</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Element</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getItems</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// Visitor interface</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Visitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Directory</span><span class=w> </span><span class=n>directory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// Concrete Visitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>SizeVisitor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Visitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>totalSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>totalSize</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getSize</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>visit</span><span class=p>(</span><span class=n>Directory</span><span class=w> </span><span class=n>directory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Element</span><span class=w> </span><span class=n>item</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>directory</span><span class=p>.</span><span class=na>getItems</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>item</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getTotalSize</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>totalSize</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=python実装例>Python実装例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Element interface</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Element</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>accept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>visitor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Concrete Elements</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>File</span><span class=p>(</span><span class=n>Element</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=n>size</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>accept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>visitor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>visitor</span><span class=o>.</span><span class=n>visit_file</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Directory</span><span class=p>(</span><span class=n>Element</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>items</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>items</span> <span class=o>=</span> <span class=n>items</span> <span class=ow>or</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>accept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>visitor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>visitor</span><span class=o>.</span><span class=n>visit_directory</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Visitor interface</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Visitor</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>visit_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>visit_directory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>directory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Concrete Visitor</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SizeVisitor</span><span class=p>(</span><span class=n>Visitor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_size</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>visit_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>total_size</span> <span class=o>+=</span> <span class=n>file</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>visit_directory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>directory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>directory</span><span class=o>.</span><span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span><span class=o>.</span><span class=n>accept</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Visitor design pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/visitor-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/visitor-design-pattern/</a></li><li>SourceMaking: Visitor Design Pattern - <a class=link href=https://sourcemaking.com/design_patterns/visitor target=_blank rel=noopener>https://sourcemaking.com/design_patterns/visitor</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=5-内部リンク候補の調査>5. 内部リンク候補の調査</h2><h3 id=51-contentpost配下で関連する記事の検索結果>5.1 <code>/content/post</code>配下で関連する記事の検索結果</h3><p><strong>検索実施日</strong>: 2025年12月31日</p><p><strong>検索キーワード</strong>:</p><ul><li><code>design-pattern</code>, <code>design pattern</code>, <code>デザインパターン</code></li><li><code>object-oriented</code>, <code>オブジェクト指向</code></li><li><code>perl</code>, <code>moo</code>, <code>moose</code></li><li><code>strategy</code></li></ul><p><strong>検索結果（関連度の高い記事）</strong>:</p><div class=table-wrapper><table><thead><tr><th>ファイルパス</th><th>タイトル（推定）</th><th>内部リンク</th><th>関連度</th><th>関連理由</th></tr></thead><tbody><tr><td><code>/content/post/2025/12/30/164012.md</code></td><td>第12回-これがデザインパターンだ！ - Mooを使ってディスパッチャーを作ってみよう</td><td><code>/2025/12/30/164012/</code></td><td><strong>高</strong></td><td>Strategyパターン（Visitorと同じく振る舞いパターン）、Moo使用、デザインパターン入門</td></tr><tr><td><code>/content/post/2025/12/30/164011.md</code></td><td>第11回-完成！ディスパッチャー - Mooを使ってディスパッチャーを作ってみよう</td><td><code>/2025/12/30/164011/</code></td><td><strong>高</strong></td><td>ディスパッチャー実装（Visitorと類似の構造）、Moo使用</td></tr><tr><td><code>/content/post/2025/12/25/234500.md</code></td><td>JSON-RPC Request/Response実装 - 複合値オブジェクト設計【Perl×TDD】</td><td><code>/2025/12/25/234500/</code></td><td><strong>中</strong></td><td>Factoryパターン言及、Moo使用、Perlでのオブジェクト指向設計</td></tr><tr><td><code>/content/post/2025/12/21/234500.md</code></td><td>JSON-RPC 2.0仕様から学ぶ値オブジェクト設計【Perl実装】仕様書の読み方とTDD</td><td><code>/2025/12/21/234500/</code></td><td><strong>中</strong></td><td>値オブジェクト設計、Perl実装、設計パターンの実践</td></tr><tr><td><code>/content/post/2021/10/31/191008.md</code></td><td>第1回-Mooで覚えるオブジェクト指向プログラミング</td><td><code>/2021/10/31/191008/</code></td><td><strong>高</strong></td><td>Mooによるオブジェクト指向入門、シリーズの基礎</td></tr><tr><td><code>/content/post/2016/02/21/150920.md</code></td><td>よなべPerl で Moo について喋ってきました</td><td><code>/2016/02/21/150920/</code></td><td><strong>中</strong></td><td>Moo解説、Perl OOP</td></tr><tr><td><code>/content/post/2009/02/14/105950.md</code></td><td>Moose::Roleが興味深い</td><td><code>/2009/02/14/105950/</code></td><td><strong>中</strong></td><td>Roleパターン（Visitorでも使用可能）</td></tr></tbody></table></div><hr><h3 id=52-推奨内部リンク構成>5.2 推奨内部リンク構成</h3><p><strong>Visitorパターン記事からのリンク先</strong>:</p><ol><li><p><strong>デザインパターン関連記事</strong>（必須）</p><ul><li><code>/2025/12/30/164012/</code> - Strategyパターン解説（同じ振る舞いパターン）</li><li>Strategyパターンとの比較・対比で相互理解を深める</li></ul></li><li><p><strong>Moo/Mooseによるオブジェクト指向基礎</strong>（推奨）</p><ul><li><code>/2021/10/31/191008/</code> - Mooの基本（前提知識）</li><li><code>/2016/02/21/150920/</code> - Moo詳細解説</li><li><code>/2009/02/14/105950/</code> - Moose::Role（Visitorでも活用可能）</li></ul></li><li><p><strong>実践的な設計例</strong>（関連）</p><ul><li><code>/2025/12/25/234500/</code> - Factoryパターン（生成パターン）</li><li><code>/2025/12/21/234500/</code> - 値オブジェクト設計</li></ul></li></ol><p><strong>リンクテキスト例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>Visitorパターンは「振る舞いに関するパターン」の一つです。同じカテゴリーの[<span class=nt>Strategyパターン</span>](<span class=na>/2025/12/30/164012/</span>)と比較すると理解が深まります。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Perlでの実装には[<span class=nt>Mooによるオブジェクト指向プログラミング</span>](<span class=na>/2021/10/31/191008/</span>)の知識が役立ちます。特に[<span class=nt>Moo::Role</span>](<span class=na>/2009/02/14/105950/</span>)を活用することで、よりクリーンな設計が可能です。
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=6-参考文献出典一覧>6. 参考文献・出典一覧</h2><h3 id=61-公式書籍定番文献>6.1 公式書籍・定番文献</h3><div class=table-wrapper><table><thead><tr><th>書籍名</th><th>著者</th><th>出版年</th><th>ISBN</th><th>備考</th></tr></thead><tbody><tr><td><strong>Design Patterns: Elements of Reusable Object-Oriented Software</strong></td><td>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides (GoF)</td><td>1994</td><td>978-0201633610</td><td>Visitorパターンの原典</td></tr><tr><td><strong>Head First Design Patterns (2nd Edition)</strong></td><td>Eric Freeman, Elisabeth Robson</td><td>2020</td><td>978-1492078005</td><td>初心者向け、視覚的解説</td></tr><tr><td><strong>Dive Into Design Patterns</strong></td><td>Alexander Shvets</td><td>-</td><td>-</td><td>Refactoring Guru著者</td></tr></tbody></table></div><hr><h3 id=62-信頼性の高いwebリソース>6.2 信頼性の高いWebリソース</h3><p><strong>英語リソース</strong>:</p><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th><th>信頼度</th></tr></thead><tbody><tr><td>Wikipedia: Visitor pattern</td><td><a class=link href=https://en.wikipedia.org/wiki/Visitor_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Visitor_pattern</a></td><td>包括的な解説、歴史的背景</td><td>高</td></tr><tr><td>GeeksforGeeks: Visitor design pattern</td><td><a class=link href=https://www.geeksforgeeks.org/system-design/visitor-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/visitor-design-pattern/</a></td><td>詳細な解説、コード例豊富</td><td>高</td></tr><tr><td>SourceMaking: Visitor Design Pattern</td><td><a class=link href=https://sourcemaking.com/design_patterns/visitor target=_blank rel=noopener>https://sourcemaking.com/design_patterns/visitor</a></td><td>実装例、ダイアグラム</td><td>高</td></tr><tr><td>TheLinuxCode: Visitor Design Pattern Guide</td><td><a class=link href=https://thelinuxcode.com/visitor-design-pattern-a-comprehensive-guide/ target=_blank rel=noopener>https://thelinuxcode.com/visitor-design-pattern-a-comprehensive-guide/</a></td><td>実践的ガイド</td><td>高</td></tr><tr><td>ScholarHat: Visitor Design Pattern</td><td><a class=link href=https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern target=_blank rel=noopener>https://www.scholarhat.com/tutorial/designpatterns/visitor-design-pattern</a></td><td>チュートリアル形式</td><td>中</td></tr></tbody></table></div><p><strong>日本語リソース</strong>:</p><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th><th>信頼度</th></tr></thead><tbody><tr><td>Refactoring Guru: Visitor（日本語版）</td><td><a class=link href=https://refactoring.guru/ja/design-patterns/visitor target=_blank rel=noopener>https://refactoring.guru/ja/design-patterns/visitor</a></td><td>視覚的解説、多言語コード例</td><td>高</td></tr><tr><td>ソフトウェア開発日記: Visitorパターンとは</td><td><a class=link href=https://lightgauge.net/journal/object-oriented/visitor-pattern/ target=_blank rel=noopener>https://lightgauge.net/journal/object-oriented/visitor-pattern/</a></td><td>日本語での丁寧な解説</td><td>高</td></tr><tr><td>Zenn: デザインパターンを学ぶ #19 ビジター</td><td><a class=link href=https://zenn.dev/tajicode/articles/ab5d11802df265 target=_blank rel=noopener>https://zenn.dev/tajicode/articles/ab5d11802df265</a></td><td>実装例、図解</td><td>高</td></tr><tr><td>MYNT Blog: GoF #23 Visitor</td><td><a class=link href=https://blog.myntinc.com/2025/11/gof23-23-visitor.html target=_blank rel=noopener>https://blog.myntinc.com/2025/11/gof23-23-visitor.html</a></td><td>GoFパターン全体との関連</td><td>中</td></tr><tr><td>Qiita: Visitorパターン</td><td><a class=link href=https://qiita.com/Yankaji777/items/ac5a006057c880d3bb26 target=_blank rel=noopener>https://qiita.com/Yankaji777/items/ac5a006057c880d3bb26</a></td><td>Javaコード例</td><td>中</td></tr><tr><td>Tamotech: 「Visitor」パターンとは？</td><td><a class=link href=https://tamotech.blog/2025/05/19/visitor/ target=_blank rel=noopener>https://tamotech.blog/2025/05/19/visitor/</a></td><td>わかりやすい日本語解説</td><td>中</td></tr><tr><td>Programming TIPS: Java Visitor パターン</td><td><a class=link href=https://programming-tips.jp/archives/a2/52/index.html target=_blank rel=noopener>https://programming-tips.jp/archives/a2/52/index.html</a></td><td>図解、実装例</td><td>中</td></tr><tr><td>Oracle: Visitorデザイン・パターン 徹底解説（PDF）</td><td><a class=link href=https://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-SO18-VisitorDesignPattern-ja.pdf target=_blank rel=noopener>https://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-SO18-VisitorDesignPattern-ja.pdf</a></td><td>詳細な解説、公式ドキュメント</td><td>高</td></tr></tbody></table></div><hr><h3 id=63-コンパイラast関連の専門リソース>6.3 コンパイラ・AST関連の専門リソース</h3><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th><th>信頼度</th></tr></thead><tbody><tr><td>Moments Log: Visitor Pattern in Compiler Design</td><td><a class=link href=https://www.momentslog.com/development/design-pattern/visitor-pattern-in-compiler-design-abstract-syntax-trees-2 target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/visitor-pattern-in-compiler-design-abstract-syntax-trees-2</a></td><td>AST処理の実例</td><td>高</td></tr><tr><td>Compiling to Assembly: Visitor Pattern</td><td><a class=link href=https://keleshev.com/compiling-to-assembly-from-scratch/12-visitor-pattern target=_blank rel=noopener>https://keleshev.com/compiling-to-assembly-from-scratch/12-visitor-pattern</a></td><td>コンパイラ実装での実践</td><td>高</td></tr><tr><td>Pat Shaughnessy: Visiting an AST</td><td><a class=link href=https://patshaughnessy.net/2022/1/22/visiting-an-abstract-syntax-tree target=_blank rel=noopener>https://patshaughnessy.net/2022/1/22/visiting-an-abstract-syntax-tree</a></td><td>AST走査の解説</td><td>高</td></tr><tr><td>CS Colorado: AST Visitor patterns（PDF）</td><td><a class=link href=https://www.cs.colostate.edu/~cs453/yr2014/Slides/10-AST-visitor.ppt.pdf target=_blank rel=noopener>https://www.cs.colostate.edu/~cs453/yr2014/Slides/10-AST-visitor.ppt.pdf</a></td><td>学術的資料</td><td>高</td></tr><tr><td>Software Patterns Lexicon: Visitor Pattern Use Cases</td><td><a class=link href=https://softwarepatternslexicon.com/java/behavioral-patterns/visitor-pattern/use-cases-and-examples/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/behavioral-patterns/visitor-pattern/use-cases-and-examples/</a></td><td>Java実装例</td><td>中</td></tr></tbody></table></div><hr><h3 id=64-実装例githubリポジトリ>6.4 実装例・GitHubリポジトリ</h3><div class=table-wrapper><table><thead><tr><th>リポジトリ</th><th>言語</th><th>URL</th><th>説明</th><th>スター数（参考）</th></tr></thead><tbody><tr><td>iluwatar/java-design-patterns</td><td>Java</td><td><a class=link href=https://github.com/iluwatar/java-design-patterns target=_blank rel=noopener>https://github.com/iluwatar/java-design-patterns</a></td><td>包括的なパターン集</td><td>90k+</td></tr><tr><td>faif/python-patterns</td><td>Python</td><td><a class=link href=https://github.com/faif/python-patterns target=_blank rel=noopener>https://github.com/faif/python-patterns</a></td><td>Python実装例</td><td>40k+</td></tr><tr><td>johnbeard/visitor-double-dispatch</td><td>C++</td><td><a class=link href=https://github.com/johnbeard/visitor-double-dispatch target=_blank rel=noopener>https://github.com/johnbeard/visitor-double-dispatch</a></td><td>ダブルディスパッチの解説</td><td>-</td></tr></tbody></table></div><hr><h3 id=65-その他の参考資料>6.5 その他の参考資料</h3><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th><th>信頼度</th></tr></thead><tbody><tr><td>Visual Paradigm: Visitor Pattern Tutorial</td><td><a class=link href=https://tutorials.visual-paradigm.com/visitor-pattern-tutorial/ target=_blank rel=noopener>https://tutorials.visual-paradigm.com/visitor-pattern-tutorial/</a></td><td>UML図、ステップバイステップ</td><td>中</td></tr><tr><td>GoF Pattern: Visitor Pattern</td><td><a class=link href=https://www.gofpattern.com/behavioral/patterns/visitor-pattern.php target=_blank rel=noopener>https://www.gofpattern.com/behavioral/patterns/visitor-pattern.php</a></td><td>パターン詳細</td><td>中</td></tr><tr><td>Generalist Programmer: What is Visitor Pattern</td><td><a class=link href=https://generalistprogrammer.com/glossary/visitor-pattern target=_blank rel=noopener>https://generalistprogrammer.com/glossary/visitor-pattern</a></td><td>用語解説</td><td>中</td></tr><tr><td>Code Study: Confused About Visitor?</td><td><a class=link href=https://www.codestudy.net/blog/confused-about-the-visitor-design-pattern/ target=_blank rel=noopener>https://www.codestudy.net/blog/confused-about-the-visitor-design-pattern/</a></td><td>よくある疑問への回答</td><td>中</td></tr><tr><td>Coder Scratchpad: Python Visitor Pattern</td><td><a class=link href=https://coderscratchpad.com/python-design-patterns-visitor-pattern/ target=_blank rel=noopener>https://coderscratchpad.com/python-design-patterns-visitor-pattern/</a></td><td>Python実装</td><td>中</td></tr></tbody></table></div><hr><h2 id=7-調査結果のサマリーと結論>7. 調査結果のサマリーと結論</h2><h3 id=71-主要な発見事項>7.1 主要な発見事項</h3><ol><li><p><strong>Visitorパターンの本質</strong></p><ul><li>オブジェクト構造（要素）と操作（ビジター）の分離を実現</li><li>ダブルディスパッチによる柔軟な処理分岐</li><li>開放閉鎖原則への準拠を可能にする</li></ul></li><li><p><strong>適用領域の明確化</strong></p><ul><li>コンパイラ（AST処理）が最も典型的で成功している適用例</li><li>ドキュメント処理、ファイルシステム、金融システムでも有効</li><li>要素型が安定し、操作が頻繁に追加される場合に最適</li></ul></li><li><p><strong>トレードオフの重要性</strong></p><ul><li>要素追加が困難になるというデメリットは無視できない</li><li>パターンの適用判断には「変更の方向性」の分析が必須</li><li>小規模システムや頻繁に要素が変わる場合は避けるべき</li></ul></li><li><p><strong>Perlでの実装可能性</strong></p><ul><li>Moo/Mooseを活用することで、型安全性を高められる</li><li>Moo::Roleによるインターフェース定義が有効</li><li>動的型付け言語でも十分に実装可能</li></ul></li><li><p><strong>モダンな代替手段</strong></p><ul><li>パターンマッチングを持つ言語（Rust, Scala, Haskell等）では、Visitorパターンは不要な場合がある</li><li>関数型プログラミングのアプローチも検討価値あり</li></ul></li></ol><hr><h3 id=72-不明点今後の調査が必要な領域>7.2 不明点・今後の調査が必要な領域</h3><ul><li>Visitorパターンと他のパターンの組み合わせ（Composite + Visitor、Iterator + Visitorなど）</li><li>大規模システムでの実装事例とベストプラクティス</li><li>パフォーマンス面での影響（特に深いツリー構造での再帰処理）</li><li>並行処理・非同期処理とVisitorパターンの組み合わせ</li><li>Perlにおける既存CPANモジュールでのVisitorパターン活用例</li></ul><hr><h3 id=73-記事執筆への推奨事項>7.3 記事執筆への推奨事項</h3><p><strong>記事構成の提案</strong>:</p><ol><li><p><strong>導入部</strong>（読者の課題提示）</p><ul><li>「クラスに処理を詰め込みすぎて保守が困難」という問題提起</li><li>if/switch文の乱立による可読性低下</li></ul></li><li><p><strong>パターンの解説</strong>（理解促進）</p><ul><li>構造の図解（UML、シーケンス図）</li><li>ダブルディスパッチの仕組み</li><li>具体例（ファイルシステムなど身近な題材）</li></ul></li><li><p><strong>実装例</strong>（実践）</p><ul><li>Perlでの段階的な実装</li><li>Moo/Moo::Roleの活用</li><li>テストコードの提示</li></ul></li><li><p><strong>メリット・デメリット</strong>（判断基準）</p><ul><li>いつ使うべきか、いつ避けるべきか</li><li>トレードオフの明確化</li></ul></li><li><p><strong>実例紹介</strong>（信頼性向上）</p><ul><li>コンパイラでの活用例</li><li>実務での適用シーン</li></ul></li><li><p><strong>内部リンク</strong>（サイト内回遊）</p><ul><li>Strategyパターンとの比較</li><li>Mooシリーズへのリンク</li></ul></li><li><p><strong>まとめ</strong>（行動喚起）</p><ul><li>パターン適用のチェックリスト</li><li>次のステップ（他のパターン学習）</li></ul></li></ol><p><strong>差別化ポイント</strong>:</p><ul><li><strong>Perl実装に特化</strong>（他サイトはJava/Python中心）</li><li><strong>Moo/Moo::Roleの活用</strong>（Perlのモダンな実装）</li><li><strong>トレードオフを明確化</strong>（過剰な推奨を避ける）</li><li><strong>実務での判断基準を提示</strong>（いつ使うべきか/いつ避けるべきか）</li></ul><hr><p><strong>調査完了日</strong>: 2025年12月31日<br><strong>調査実施者</strong>: 調査・情報収集専門家<br><strong>信頼度総合評価</strong>: 高（公式文献、学術資料、実装事例が豊富）</p></section><footer class=article-footer><section class=article-tags><a href=/tags/design-pattern/>Design-Pattern</a>
<a href=/tags/gof/>Gof</a>
<a href=/tags/visitor/>Visitor</a>
<a href=/tags/behavioral-pattern/>Behavioral-Pattern</a>
<a href=/tags/perl/>Perl</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/warehouse/state-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Stateパターン（State Design Pattern）調査報告書</h2></div></a></article><article class=has-image><a href=/warehouse/strategy-pattern-research/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Strategyパターン（振る舞いパターン）調査ドキュメント</h2></div></a></article><article class=has-image><a href=/warehouse/mediator-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Mediatorパターンの調査</h2></div></a></article><article class=has-image><a href=/warehouse/factory-method-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Factory Method(ファクトリーメソッド)パターン調査ドキュメント</h2></div></a></article><article class=has-image><a href=/warehouse/observer-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Observerパターン（デザインパターン）調査ドキュメント</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//nqounet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2000 -
2026 nqou.net</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>