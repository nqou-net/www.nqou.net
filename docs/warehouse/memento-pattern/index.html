<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Mementoパターンに関する包括的な調査結果 - GoF定義、実装例（Perl/Moo）、利点・欠点、実用例を網羅"><title>Mementoパターン調査ドキュメント</title><link rel=canonical href=https://www.nqou.net/warehouse/memento-pattern/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Mementoパターン調査ドキュメント"><meta property='og:description' content="Mementoパターンに関する包括的な調査結果 - GoF定義、実装例（Perl/Moo）、利点・欠点、実用例を網羅"><meta property='og:url' content='https://www.nqou.net/warehouse/memento-pattern/'><meta property='og:site_name' content='デザインパターンの名前は嘘をつく'><meta property='og:type' content='article'><meta property='article:section' content='Warehouse'><meta property='article:tag' content='design-patterns'><meta property='article:tag' content='gof'><meta property='article:tag' content='behavioral-patterns'><meta property='article:tag' content='memento'><meta property='article:tag' content='software-design'><meta property='article:published_time' content='2025-12-31T09:41:00+09:00'><meta property='article:modified_time' content='2025-12-31T09:41:00+09:00'><meta property='og:image' content='https://www.nqou.net/favicon.png'><meta name=twitter:title content="Mementoパターン調査ドキュメント"><meta name=twitter:description content="Mementoパターンに関する包括的な調査結果 - GoF定義、実装例（Perl/Moo）、利点・欠点、実用例を網羅"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nqou.net/favicon.png'><link rel="shortcut icon" href=/favicon.png><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap';:root{--base-font-family:Arial, "Noto Sans JP", sans-serif}</style><link rel=stylesheet href=/css/linkcard.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3923446804785015" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js defer></script><script defer>document.addEventListener("DOMContentLoaded",function(){try{typeof mermaid!="undefined"&&document.querySelector(".mermaid")&&mermaid.initialize({startOnLoad:!0,securityLevel:"strict"})}catch(e){console.warn("Mermaid failed to initialize:",e)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-E50H9ESN7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E50H9ESN7E")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/public_images/nqounet201703.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🥃</span></figure><div class=site-meta><h1 class=site-name><a href=/>デザインパターンの名前は嘘をつく</a></h1><h2 class=site-description>パターン名の嘘を暴く。詰まる設計を容赦なく解体。</h2></div></header><ol class=menu-social><li><a href=https://github.com/nqounet target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/nqounet target=_blank title=X rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/advent-calendar-2025/><svg class="icon icon-tabler icon-tabler-calendar" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><path d="M8 15h.01"/><path d="M12 15h.01"/><path d="M16 15h.01"/><path d="M8 19h.01"/><path d="M12 19h.01"/><path d="M16 19h.01"/></svg>
<span>Perl Advent Calendar 2025 - AI Edition</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/warehouse/><svg class="icon icon-tabler icon-tabler-warehouse" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l9-6 9 6"/><rect x="5" y="10" width="14" height="10" rx="2"/><rect x="10" y="14" width="4" height="6" rx="1"/><path d="M7 20v-4h2v4"/><path d="M15 20v-4h2v4"/></svg>
<span>Warehouse</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目次</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#調査目的>調査目的</a></li><li><a href=#1-概要>1. 概要</a><ol><li><a href=#11-mementoパターンの定義>1.1 Mementoパターンの定義</a></li><li><a href=#12-デザインパターンの分類における位置づけ>1.2 デザインパターンの分類における位置づけ</a></li><li><a href=#13-解決しようとする問題>1.3 解決しようとする問題</a></li></ol></li><li><a href=#2-用途>2. 用途</a><ol><li><a href=#21-具体的な利用シーン>2.1 具体的な利用シーン</a></li><li><a href=#22-実際のソフトウェアでの応用例>2.2 実際のソフトウェアでの応用例</a></li><li><a href=#23-適用すべきケース>2.3 適用すべきケース</a></li><li><a href=#24-適用すべきでないケース>2.4 適用すべきでないケース</a></li></ol></li><li><a href=#3-パターンの構造>3. パターンの構造</a><ol><li><a href=#31-3つの要素originatormementocaretaker>3.1 3つの要素（Originator、Memento、Caretaker）</a></li><li><a href=#32-パターンの動作フロー>3.2 パターンの動作フロー</a></li></ol></li><li><a href=#4-サンプルコード>4. サンプルコード</a><ol><li><a href=#41-perlでの実装例mooを使用>4.1 Perlでの実装例（Mooを使用）</a><ol><li><a href=#originatorテキストエディタの例>Originator（テキストエディタの例）</a></li><li><a href=#memento状態を保存するオブジェクト>Memento（状態を保存するオブジェクト）</a></li><li><a href=#caretaker履歴を管理するオブジェクト>Caretaker（履歴を管理するオブジェクト）</a></li><li><a href=#使用例>使用例</a></li></ol></li><li><a href=#42-mooseでの実装例より高度な型制約付き>4.2 Mooseでの実装例（より高度な型制約付き）</a><ol><li><a href=#originatorの拡張版型制約付き>Originatorの拡張版（型制約付き）</a></li><li><a href=#mementoの拡張版>Mementoの拡張版</a></li></ol></li><li><a href=#43-実用的なコード例の追加機能>4.3 実用的なコード例の追加機能</a><ol><li><a href=#redo機能の実装>Redo機能の実装</a></li><li><a href=#履歴数制限の実装>履歴数制限の実装</a></li></ol></li></ol></li><li><a href=#5-利点欠点>5. 利点・欠点</a><ol><li><a href=#51-メリット利点>5.1 メリット（利点）</a></li><li><a href=#52-デメリット欠点>5.2 デメリット（欠点）</a></li><li><a href=#53-他のパターンとの比較>5.3 他のパターンとの比較</a><ol><li><a href=#531-command-パターンとの違い>5.3.1 Command パターンとの違い</a></li><li><a href=#532-state-パターンとの関係>5.3.2 State パターンとの関係</a></li><li><a href=#533-prototype-パターンとの関係>5.3.3 Prototype パターンとの関係</a></li></ol></li></ol></li><li><a href=#6-内部リンク候補>6. 内部リンク候補</a><ol><li><a href=#61-デザインパターン関連記事>6.1 デザインパターン関連記事</a></li></ol></li><li><a href=#7-参考文献リソース>7. 参考文献・リソース</a><ol><li><a href=#71-公式書籍定番書籍>7.1 公式書籍・定番書籍</a></li><li><a href=#72-信頼性の高いwebリソース>7.2 信頼性の高いWebリソース</a></li><li><a href=#73-perlmoomoose関連リソース>7.3 Perl/Moo/Moose関連リソース</a></li><li><a href=#74-パターン比較実装例>7.4 パターン比較・実装例</a></li></ol></li><li><a href=#8-調査結果のサマリー>8. 調査結果のサマリー</a><ol><li><a href=#81-主要な発見>8.1 主要な発見</a></li><li><a href=#82-重要なポイント>8.2 重要なポイント</a></li><li><a href=#83-今後の調査が必要な領域参考>8.3 今後の調査が必要な領域（参考）</a></li></ol></li><li><a href=#9-信頼度評価>9. 信頼度評価</a><ol><li><a href=#91-調査内容の信頼度>9.1 調査内容の信頼度</a></li><li><a href=#92-情報源の品質>9.2 情報源の品質</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/warehouse/memento-pattern/><img src=/favicon.png loading=lazy alt="Featured image of post Mementoパターン調査ドキュメント"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/warehouse/memento-pattern/>Mementoパターン調査ドキュメント</a></h2><h3 class=article-subtitle>Mementoパターンに関する包括的な調査結果 - GoF定義、実装例（Perl/Moo）、利点・欠点、実用例を網羅</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>12月 31, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>読了時間: 21分</time></div></footer></div></header><section class=article-content><h1 id=mementoパターン調査ドキュメント>Mementoパターン調査ドキュメント</h1><h2 id=調査目的>調査目的</h2><p>Mementoパターン（メメントパターン）について包括的に調査し、GoF（Gang of Four）の公式定義から実装例、実用例までを整理する。特にPerl/Mooでの実装に特化した内容を含める。</p><ul><li><strong>調査対象</strong>: Mementoパターンの定義、構造、用途、利点・欠点、実装例</li><li><strong>想定読者</strong>: デザインパターンを実践的に活用したいソフトウェアエンジニア</li><li><strong>調査実施日</strong>: 2025年12月31日</li></ul><hr><h2 id=1-概要>1. 概要</h2><h3 id=11-mementoパターンの定義>1.1 Mementoパターンの定義</h3><p><strong>要点</strong>:</p><ul><li>Mementoパターンは、オブジェクトの内部状態をカプセル化を維持したまま外部化し、後でその状態を復元できるようにする振る舞いパターンである</li><li>GoFの公式定義: &ldquo;カプセル化を破らずに、オブジェクトの内部状態をキャプチャして外部化し、後でそのオブジェクトをこの状態に復元できるようにする&rdquo;</li><li>スナップショット（snapshot）パターンとも呼ばれる</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF書籍において、振る舞いパターン（Behavioral Patterns）の1つとして定義されている</li><li>オブジェクトの状態を保存・復元する際に、そのオブジェクトの実装詳細を公開せずに済むという点が重要</li></ul><p><strong>出典</strong>:</p><ul><li>Refactoring Guru: Memento - <a class=link href=https://refactoring.guru/design-patterns/memento target=_blank rel=noopener>https://refactoring.guru/design-patterns/memento</a></li><li>GeeksforGeeks: Memento Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/memento-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/memento-design-pattern/</a></li><li>Wikipedia: Memento pattern - <a class=link href=https://en.wikipedia.org/wiki/Memento_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Memento_pattern</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF公式定義および複数の権威あるソース）</p><hr><h3 id=12-デザインパターンの分類における位置づけ>1.2 デザインパターンの分類における位置づけ</h3><p><strong>要点</strong>:</p><ul><li><strong>カテゴリ</strong>: 振る舞いパターン（Behavioral Patterns）</li><li><strong>特徴</strong>: GoFの23パターンのうち、振る舞いパターン11種類の1つ</li><li><strong>独自性</strong>: 他の振る舞いパターンがオブジェクト間の通信を扱うのに対し、Mementoパターンはオブジェクトの現在と過去の状態の関係を調整する点で独特</li><li><strong>時間軸の概念</strong>: 状態の履歴管理という「時間」の概念を導入している点が他のパターンと異なる</li></ul><p><strong>根拠</strong>:</p><ul><li>振る舞いパターンは、オブジェクト間の責任分担とコミュニケーションに関するパターン群である</li><li>Mementoパターンは、通信よりも状態管理に焦点を当てている点で特殊</li></ul><p><strong>出典</strong>:</p><ul><li>GoF Pattern: Memento Pattern - <a class=link href=https://www.gofpattern.com/behavioral/patterns/memento-pattern.php target=_blank rel=noopener>https://www.gofpattern.com/behavioral/patterns/memento-pattern.php</a></li><li>Grokipedia: Memento pattern - <a class=link href=https://grokipedia.com/page/Memento_pattern target=_blank rel=noopener>https://grokipedia.com/page/Memento_pattern</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=13-解決しようとする問題>1.3 解決しようとする問題</h3><p><strong>要点</strong>:</p><p>Mementoパターンは以下の問題を解決する：</p><ol><li><strong>カプセル化の維持</strong>: オブジェクトの内部状態を保存・復元する際に、実装詳細を外部に公開したくない</li><li><strong>Undo/Redo機能の実装</strong>: ユーザーの操作を取り消したり、やり直したりする機能を実装したい</li><li><strong>トランザクション管理</strong>: 操作が失敗した場合に、以前の有効な状態にロールバックしたい</li><li><strong>状態の履歴管理</strong>: 複数の過去の状態を保持し、任意の時点に戻れるようにしたい</li><li><strong>責任の分離</strong>: 状態の保存・管理を行う責任を、ビジネスロジックから分離したい</li></ol><p><strong>根拠</strong>:</p><ul><li>カプセル化はオブジェクト指向設計の基本原則であり、それを破らずに状態管理を行うことが重要</li><li>実用的なアプリケーション（テキストエディタ、ゲーム、トランザクションシステムなど）では、状態の保存・復元機能が必須</li></ul><p><strong>出典</strong>:</p><ul><li>SourceMaking: Memento Design Pattern - <a class=link href=https://sourcemaking.com/design_patterns/memento target=_blank rel=noopener>https://sourcemaking.com/design_patterns/memento</a></li><li>dPatterns: Memento Design Pattern - <a class=link href=https://dpatterns.com/behavioral/memento/ target=_blank rel=noopener>https://dpatterns.com/behavioral/memento/</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h2 id=2-用途>2. 用途</h2><h3 id=21-具体的な利用シーン>2.1 具体的な利用シーン</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>利用シーン</th><th>説明</th><th>具体例</th></tr></thead><tbody><tr><td><strong>Undo/Redo機能</strong></td><td>ユーザーの操作を取り消したり、やり直したりする</td><td>テキストエディタ、コードエディタ、グラフィックエディタ</td></tr><tr><td><strong>スナップショット</strong></td><td>特定時点での状態を保存し、後で参照・復元する</td><td>ゲームのセーブポイント、設定のバックアップ</td></tr><tr><td><strong>トランザクション管理</strong></td><td>操作が失敗した場合に以前の状態にロールバック</td><td>データベーストランザクション、マルチステップフォーム</td></tr><tr><td><strong>バージョン管理</strong></td><td>オブジェクトの状態の履歴を保持する</td><td>ドキュメントの版管理、設定変更履歴</td></tr><tr><td><strong>テスト支援</strong></td><td>テスト時にオブジェクトを特定の状態に設定・復元</td><td>自動テスト、状態遷移テスト</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>これらのシーンは、実際のソフトウェア開発で頻繁に遭遇する要件である</li><li>各シーンにおいて、カプセル化を維持したまま状態を管理する必要がある</li></ul><p><strong>出典</strong>:</p><ul><li>Java Design Patterns: Memento Pattern - <a class=link href=https://java-design-patterns.com/patterns/memento/ target=_blank rel=noopener>https://java-design-patterns.com/patterns/memento/</a></li><li>AlgoMaster: Memento - <a class=link href=https://algomaster.io/learn/lld/memento target=_blank rel=noopener>https://algomaster.io/learn/lld/memento</a></li><li>Software Patterns Lexicon: Use Cases and Examples - <a class=link href=https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/use-cases-and-examples/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/use-cases-and-examples/</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=22-実際のソフトウェアでの応用例>2.2 実際のソフトウェアでの応用例</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>ソフトウェア/領域</th><th>応用例</th><th>実装の特徴</th></tr></thead><tbody><tr><td><strong>テキストエディタ</strong></td><td>Undo/Redoバッファ</td><td>編集前の文書状態を保存、履歴スタックで管理</td></tr><tr><td><strong>IDEs（統合開発環境）</strong></td><td>コードの変更履歴、リファクタリングのUndoなど</td><td>変更差分（diff）の保存でメモリ効率化</td></tr><tr><td><strong>グラフィックエディタ</strong></td><td>Photoshop、GIMPなどの操作履歴</td><td>レイヤー状態、ブラシストローク単位での保存</td></tr><tr><td><strong>ゲーム</strong></td><td>セーブ/ロード機能、チェックポイント</td><td>ゲーム全体の状態をシリアライズして保存</td></tr><tr><td><strong>Webアプリケーション</strong></td><td>セッション管理、フォームデータの一時保存</td><td>クラッシュ後の復旧、入力データの保持</td></tr><tr><td><strong>データベースシステム</strong></td><td>トランザクションのロールバック</td><td>ACID特性の実現、セーブポイント機能</td></tr><tr><td><strong>設定管理ツール</strong></td><td>設定変更前の状態保存</td><td>設定ロールバック、安全な試行錯誤を可能に</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>これらは実際に市場で使用されているソフトウェアでの実装例</li><li>それぞれのアプリケーションドメインで、状態の保存・復元が重要な機能となっている</li></ul><p><strong>出典</strong>:</p><ul><li>Design Patterns Mastery: The Memento Pattern - <a class=link href=https://designpatternsmastery.com/2/15/ target=_blank rel=noopener>https://designpatternsmastery.com/2/15/</a></li><li>DEV Community: Memento Design Pattern - <a class=link href=https://dev.to/sajjadali/memento-design-pattern-4b64 target=_blank rel=noopener>https://dev.to/sajjadali/memento-design-pattern-4b64</a></li><li>MomentsLog: Memento Pattern in Text Editors - <a class=link href=https://www.momentslog.com/development/design-pattern/memento-pattern-in-text-editors-undo-redo-history-management target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/memento-pattern-in-text-editors-undo-redo-history-management</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=23-適用すべきケース>2.3 適用すべきケース</h3><p><strong>要点</strong>:</p><p>Mementoパターンの適用を推奨する条件：</p><ol><li><strong>Undo/Redo機能が必要</strong>: インタラクティブなアプリケーションでユーザーの操作を取り消す必要がある</li><li><strong>カプセル化が重要</strong>: オブジェクトの内部詳細を外部に公開したくない</li><li><strong>複数の状態履歴</strong>: 単一ではなく、複数レベルのUndoが必要</li><li><strong>トランザクション的な操作</strong>: 失敗時のロールバックが必要</li><li><strong>状態が複雑</strong>: シンプルな変数のコピーでは対応できない複雑な状態</li><li><strong>責任の分離</strong>: 状態管理をビジネスロジックから分離したい</li></ol><p><strong>根拠</strong>:</p><ul><li>これらの条件が揃っている場合、Mementoパターンの利点が最大化される</li><li>カプセル化を維持したまま状態管理を実現できる唯一の方法</li></ul><p><strong>出典</strong>:</p><ul><li>PMI: The Memento Pattern - <a class=link href=https://www.pmi.org/disciplined-agile/the-design-patterns-repository/the-memento-pattern target=_blank rel=noopener>https://www.pmi.org/disciplined-agile/the-design-patterns-repository/the-memento-pattern</a></li><li>Software Patterns Lexicon: Memento Pattern - <a class=link href=https://softwarepatternslexicon.com/mastering-design-patterns/behavioral-design-patterns/memento-pattern/ target=_blank rel=noopener>https://softwarepatternslexicon.com/mastering-design-patterns/behavioral-design-patterns/memento-pattern/</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=24-適用すべきでないケース>2.4 適用すべきでないケース</h3><p><strong>要点</strong>:</p><p>Mementoパターンの適用を避けるべき条件：</p><ol><li><strong>状態が非常に大きい</strong>: オブジェクトの状態が巨大で、複数のコピーを保存するとメモリが枯渇する</li><li><strong>頻繁な状態変更</strong>: 非常に高頻度で状態が変化し、保存コストが高い</li><li><strong>単純な状態</strong>: 単純な変数のコピーで十分対応できる場合</li><li><strong>カプセル化が不要</strong>: 状態がすでに公開されており、カプセル化を維持する必要がない</li><li><strong>パフォーマンス重視</strong>: 状態の保存・復元がパフォーマンスのボトルネックになる場合</li><li><strong>シンプルな履歴管理</strong>: 他のシンプルな手法（Command パターン、単純な変数スタックなど）で十分な場合</li></ol><p><strong>根拠</strong>:</p><ul><li>これらのケースでは、Mementoパターンのオーバーヘッドがメリットを上回る</li><li>過剰設計（オーバーエンジニアリング）によりコードが複雑化し、保守性が低下する</li></ul><p><strong>仮定</strong>:</p><ul><li>代替手段（Command パターン、差分保存、単純なコピーなど）の方が適切な場合がある</li></ul><p><strong>出典</strong>:</p><ul><li>Grokipedia: Memento pattern - <a class=link href=https://grokipedia.com/page/Memento_pattern target=_blank rel=noopener>https://grokipedia.com/page/Memento_pattern</a></li><li>Refactoring Guru: Memento - <a class=link href=https://refactoring.guru/design-patterns/memento target=_blank rel=noopener>https://refactoring.guru/design-patterns/memento</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h2 id=3-パターンの構造>3. パターンの構造</h2><h3 id=31-3つの要素originatormementocaretaker>3.1 3つの要素（Originator、Memento、Caretaker）</h3><p><strong>要点</strong>:</p><p>Mementoパターンは3つの主要な役割（参加者）から構成される：</p><div class=table-wrapper><table><thead><tr><th>役割</th><th>責任</th><th>特徴</th></tr></thead><tbody><tr><td><strong>Originator（作成者）</strong></td><td>状態を持つオブジェクト。自身の状態をMementoに保存し、Mementoから状態を復元する</td><td>Mementoの内部状態にアクセスできる唯一の存在</td></tr><tr><td><strong>Memento（記念品）</strong></td><td>Originatorの状態を保存するオブジェクト</td><td>Originatorからのみアクセス可能で、他のオブジェクトからは不透明</td></tr><tr><td><strong>Caretaker（管理者）</strong></td><td>Mementoを管理するオブジェクト。保存と復元のタイミングを制御する</td><td>Mementoの内容を知らず、中身を変更もしない</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><ol><li><p><strong>Originator（作成者）</strong></p><ul><li>状態を保存したいオブジェクト</li><li><code>saveToMemento()</code>: 現在の状態をMementoオブジェクトとして返す</li><li><code>restoreFromMemento(memento)</code>: Mementoから状態を復元する</li><li>例: テキストエディタでは、文書の内容を保持するTextDocumentクラス</li></ul></li><li><p><strong>Memento（記念品）</strong></p><ul><li>Originatorの状態のスナップショットを保存</li><li>Originatorのみが状態を読み書きできる（カプセル化）</li><li>通常はイミュータブル（変更不可）にする</li><li>例: 文書の特定時点でのテキスト内容、カーソル位置、書式情報など</li></ul></li><li><p><strong>Caretaker（管理者）</strong></p><ul><li>Mementoのコレクション（履歴スタック）を管理</li><li>いつ保存・復元するかを決定</li><li>Mementoの中身を知らない、変更しない</li><li>例: UndoManagerクラスがMementoのスタックを管理</li></ul></li></ol><p><strong>根拠</strong>:</p><ul><li>GoF書籍で定義されている標準的な構造</li><li>責任の分離（Separation of Concerns）の原則に基づいている</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Memento pattern - <a class=link href=https://en.wikipedia.org/wiki/Memento_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Memento_pattern</a></li><li>TutorialsPoint: Memento Pattern - <a class=link href=https://www.tutorialspoint.com/design_pattern/memento_pattern.htm target=_blank rel=noopener>https://www.tutorialspoint.com/design_pattern/memento_pattern.htm</a></li><li>Software Patterns Lexicon: Originator, Memento, and Caretaker Roles - <a class=link href=https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/originator-memento-and-caretaker-roles/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/originator-memento-and-caretaker-roles/</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF公式定義）</p><hr><h3 id=32-パターンの動作フロー>3.2 パターンの動作フロー</h3><p><strong>要点</strong>:</p><p>Mementoパターンの典型的な動作シーケンス：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. Caretaker が Originator に状態の保存を要求
</span></span><span class=line><span class=cl>2. Originator が現在の状態から Memento を生成
</span></span><span class=line><span class=cl>3. Originator が Memento を Caretaker に返す
</span></span><span class=line><span class=cl>4. Caretaker が Memento を履歴スタックに保存
</span></span><span class=line><span class=cl>   ※ Caretaker は Memento の中身を見ない、変更しない
</span></span><span class=line><span class=cl>5. （後で）Caretaker が適切な Memento を選択
</span></span><span class=line><span class=cl>6. Caretaker が Originator に Memento を渡して復元を要求
</span></span><span class=line><span class=cl>7. Originator が Memento から状態を読み取り、自身を復元
</span></span></code></pre></td></tr></table></div></div><p><strong>具体例（テキストエディタのUndo）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ユーザー操作: &#34;Hello&#34; と入力
</span></span><span class=line><span class=cl>→ Caretaker が Originator に保存要求
</span></span><span class=line><span class=cl>→ Originator が Memento(&#34;&#34;) を生成（変更前の状態）
</span></span><span class=line><span class=cl>→ Caretaker が Memento をスタックに push
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ユーザー操作: &#34; World&#34; と追加入力
</span></span><span class=line><span class=cl>→ Caretaker が Originator に保存要求
</span></span><span class=line><span class=cl>→ Originator が Memento(&#34;Hello&#34;) を生成
</span></span><span class=line><span class=cl>→ Caretaker が Memento をスタックに push
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ユーザー操作: Undo実行
</span></span><span class=line><span class=cl>→ Caretaker がスタックから Memento(&#34;Hello&#34;) を pop
</span></span><span class=line><span class=cl>→ Originator が状態を &#34;Hello&#34; に復元
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>これは標準的なMementoパターンの実装フロー</li><li>スタック構造を使うことでLIFO（Last In First Out）のUndo/Redo動作を実現</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Memento Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/memento-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/memento-design-pattern/</a></li><li>CodingTechRoom: Mastering the Memento Pattern - <a class=link href=https://codingtechroom.com/tutorial/java-memento-pattern-java-tutorial target=_blank rel=noopener>https://codingtechroom.com/tutorial/java-memento-pattern-java-tutorial</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h2 id=4-サンプルコード>4. サンプルコード</h2><h3 id=41-perlでの実装例mooを使用>4.1 Perlでの実装例（Mooを使用）</h3><p><strong>要点</strong>:</p><p>Perl の Moo モジュールを使用したMementoパターンの実装例を示す。Mooは軽量でモダンなオブジェクト指向機能を提供し、Mooseと互換性がある。</p><h4 id=originatorテキストエディタの例>Originator（テキストエディタの例）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>TextEditor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>text</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=s>&#39;&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 現在の状態をMementoとして保存</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>save_to_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nn>EditorMemento</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>state</span> <span class=o>=&gt;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mementoから状態を復元</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>restore_from_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$memento</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>(</span><span class=nv>$memento</span><span class=o>-&gt;</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># テキストを追加</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>type</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$words</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>(</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span> <span class=o>.</span> <span class=nv>$words</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 現在のテキストを取得</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_text</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=memento状態を保存するオブジェクト>Memento（状態を保存するオブジェクト）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>EditorMemento</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Originatorの状態を保存（読み取り専用）</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>state</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>       <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=caretaker履歴を管理するオブジェクト>Caretaker（履歴を管理するオブジェクト）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>EditorHistory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>history</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=o>[]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mementoを履歴に追加</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>add_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$memento</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>push</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>},</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最後のMementoを取得（Undo用）</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_last_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>pop</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 履歴が空かチェック</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>is_empty</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>scalar</span><span class=p>(</span><span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>})</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=使用例>使用例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>use</span> <span class=nn>TextEditor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>EditorHistory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># オブジェクトの初期化</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$editor</span>  <span class=o>=</span> <span class=nn>TextEditor</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$history</span> <span class=o>=</span> <span class=nn>EditorHistory</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初期状態を保存</span>
</span></span><span class=line><span class=cl><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>add_memento</span><span class=p>(</span><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>save_to_memento</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># テキストを入力</span>
</span></span><span class=line><span class=cl><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>(</span><span class=s>&#34;Hello, &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>print</span> <span class=s>&#34;現在: &#34;</span> <span class=o>.</span> <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>get_text</span> <span class=o>.</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>  <span class=c1># 出力: Hello, </span>
</span></span><span class=line><span class=cl><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>add_memento</span><span class=p>(</span><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>save_to_memento</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># さらにテキストを追加</span>
</span></span><span class=line><span class=cl><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>(</span><span class=s>&#34;World!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>print</span> <span class=s>&#34;現在: &#34;</span> <span class=o>.</span> <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>get_text</span> <span class=o>.</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>  <span class=c1># 出力: Hello, World!</span>
</span></span><span class=line><span class=cl><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>add_memento</span><span class=p>(</span><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>save_to_memento</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># さらに追加</span>
</span></span><span class=line><span class=cl><span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>(</span><span class=s>&#34; From Perl.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>print</span> <span class=s>&#34;現在: &#34;</span> <span class=o>.</span> <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>get_text</span> <span class=o>.</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>  <span class=c1># 出力: Hello, World! From Perl.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Undo: 1つ前の状態に戻る</span>
</span></span><span class=line><span class=cl><span class=k>unless</span> <span class=p>(</span><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>is_empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>restore_from_memento</span><span class=p>(</span><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>get_last_memento</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>print</span> <span class=s>&#34;Undo後: &#34;</span> <span class=o>.</span> <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>get_text</span> <span class=o>.</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>  <span class=c1># 出力: Hello, World!</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># もう一度Undo</span>
</span></span><span class=line><span class=cl><span class=k>unless</span> <span class=p>(</span><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>is_empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>restore_from_memento</span><span class=p>(</span><span class=nv>$history</span><span class=o>-&gt;</span><span class=n>get_last_memento</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>print</span> <span class=s>&#34;Undo後: &#34;</span> <span class=o>.</span> <span class=nv>$editor</span><span class=o>-&gt;</span><span class=n>get_text</span> <span class=o>.</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>  <span class=c1># 出力: Hello, </span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>Mooは軽量でMooseと互換性があり、実用的なPerl開発で広く使われている</li><li><code>has</code>でアトリビュートを定義、<code>is => 'ro'</code>で読み取り専用、<code>is => 'rw'</code>で読み書き可能</li></ul><p><strong>出典</strong>:</p><ul><li>MetaCPAN: Moo - <a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></li><li>Perl Maven: OOP with Moo - <a class=link href=https://perlmaven.com/oop-with-moo target=_blank rel=noopener>https://perlmaven.com/oop-with-moo</a></li><li>Perl Begin: Object Oriented Programming - <a class=link href=https://perl-begin.org/topics/object-oriented/ target=_blank rel=noopener>https://perl-begin.org/topics/object-oriented/</a></li></ul><p><strong>信頼度</strong>: 9/10（公式ドキュメントおよび実績あるソース）</p><hr><h3 id=42-mooseでの実装例より高度な型制約付き>4.2 Mooseでの実装例（より高度な型制約付き）</h3><p><strong>要点</strong>:</p><p>Mooseを使用することで、型制約やメタプログラミングなどの高度な機能を活用できる。</p><h4 id=originatorの拡張版型制約付き>Originatorの拡張版（型制約付き）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>TextEditorAdvanced</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moose</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moose::Util::TypeConstraints</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>text</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>isa</span>     <span class=o>=&gt;</span> <span class=s>&#39;Str&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=s>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>cursor_position</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>isa</span>     <span class=o>=&gt;</span> <span class=s>&#39;Int&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mementoの保存</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>save_to_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nn>EditorMementoAdvanced</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>saved_text</span>     <span class=o>=&gt;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>saved_position</span> <span class=o>=&gt;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>cursor_position</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mementoからの復元</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>restore_from_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$memento</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>(</span><span class=nv>$memento</span><span class=o>-&gt;</span><span class=n>saved_text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>cursor_position</span><span class=p>(</span><span class=nv>$memento</span><span class=o>-&gt;</span><span class=n>saved_position</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nn>__PACKAGE__</span><span class=o>-&gt;</span><span class=nn>meta</span><span class=o>-&gt;</span><span class=n>make_immutable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mementoの拡張版>Mementoの拡張版</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>EditorMementoAdvanced</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moose</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>saved_text</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>       <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>isa</span>      <span class=o>=&gt;</span> <span class=s>&#39;Str&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>saved_position</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>       <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>isa</span>      <span class=o>=&gt;</span> <span class=s>&#39;Int&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>required</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nn>__PACKAGE__</span><span class=o>-&gt;</span><span class=nn>meta</span><span class=o>-&gt;</span><span class=n>make_immutable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>Mooseは強力な型システムとメタプログラミング機能を提供</li><li><code>isa</code>で型制約を定義でき、実行時の型チェックが可能</li></ul><p><strong>出典</strong>:</p><ul><li>MetaCPAN: Moose - <a class=link href=https://metacpan.org/pod/Moose target=_blank rel=noopener>https://metacpan.org/pod/Moose</a></li><li>Kablamo: How to Moo - <a class=link href=http://kablamo.org/slides-intro-to-moo/ target=_blank rel=noopener>http://kablamo.org/slides-intro-to-moo/</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=43-実用的なコード例の追加機能>4.3 実用的なコード例の追加機能</h3><p><strong>要点</strong>:</p><p>実用的なアプリケーションでは、以下の機能を追加することが多い：</p><h4 id=redo機能の実装>Redo機能の実装</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>EditorHistoryWithRedo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>undo_stack</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=o>[]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>redo_stack</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=o>[]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 新しい状態を保存（Redoスタックはクリア）</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>push_state</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$memento</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>push</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>undo_stack</span> <span class=p>},</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>redo_stack</span><span class=p>(</span><span class=o>[]</span><span class=p>);</span>  <span class=c1># 新しい操作でRedoスタックをクリア</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Undo操作</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>undo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>unless</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>undo_stack</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$memento</span> <span class=o>=</span> <span class=nb>pop</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>undo_stack</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nb>push</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>redo_stack</span> <span class=p>},</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redo操作</span>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>redo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>unless</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>redo_stack</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$memento</span> <span class=o>=</span> <span class=nb>pop</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>redo_stack</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nb>push</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>undo_stack</span> <span class=p>},</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>can_undo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>scalar</span><span class=p>(</span><span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>undo_stack</span> <span class=p>})</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>can_redo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$self</span> <span class=o>=</span> <span class=nb>shift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>scalar</span><span class=p>(</span><span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>redo_stack</span> <span class=p>})</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=履歴数制限の実装>履歴数制限の実装</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>LimitedHistory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>max_history</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=mi>50</span><span class=p>,</span>  <span class=c1># デフォルトで50個まで保存</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>history</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=o>[]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>add_memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$memento</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>push</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>},</span> <span class=nv>$memento</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 履歴数が上限を超えたら古いものを削除</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>}</span> <span class=o>&gt;</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>max_history</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>shift</span> <span class=nv>@</span><span class=p>{</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>history</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>Redo機能は2つのスタック（Undo/Redo）を使って実装するのが標準的</li><li>履歴数の制限はメモリ使用量を抑えるために重要</li></ul><p><strong>出典</strong>:</p><ul><li>MomentsLog: Implementing Undo/Redo Functionality - <a class=link href=https://www.momentslog.com/development/design-pattern/implementing-undo-redo-functionality-with-the-memento-pattern target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/implementing-undo-redo-functionality-with-the-memento-pattern</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h2 id=5-利点欠点>5. 利点・欠点</h2><h3 id=51-メリット利点>5.1 メリット（利点）</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>メリット</th><th>説明</th><th>具体例</th></tr></thead><tbody><tr><td><strong>カプセル化の維持</strong></td><td>オブジェクトの内部実装を公開せずに状態を保存・復元できる</td><td>プライベートフィールドを外部に公開しない</td></tr><tr><td><strong>Undo/Redo機能</strong></td><td>複数レベルのUndo/Redoを簡単に実装できる</td><td>テキストエディタの操作履歴</td></tr><tr><td><strong>責任の分離</strong></td><td>状態管理（Caretaker）とビジネスロジック（Originator）を分離</td><td>コードの保守性向上</td></tr><tr><td><strong>チェックポイント作成</strong></td><td>任意の時点での状態スナップショットを作成可能</td><td>ゲームのセーブポイント</td></tr><tr><td><strong>エラー回復</strong></td><td>エラー発生時に以前の有効な状態に戻せる</td><td>トランザクションのロールバック</td></tr><tr><td><strong>テスト支援</strong></td><td>テスト時にオブジェクトを特定の状態に設定・復元できる</td><td>自動テストでの状態管理</td></tr><tr><td><strong>柔軟な状態管理</strong></td><td>複数の状態を保持し、任意の状態に戻れる</td><td>多段階Undo</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><ol><li><p><strong>カプセル化の維持</strong></p><ul><li>Mementoのインターフェースを通じてのみ状態にアクセス</li><li>Originatorの内部実装変更がCaretakerに影響しない</li><li>セキュリティとメンテナンス性の向上</li></ul></li><li><p><strong>責任の分離（Separation of Concerns）</strong></p><ul><li>Originator: ビジネスロジックに集中</li><li>Memento: 状態のスナップショット保存</li><li>Caretaker: 履歴管理とUndo/Redoのタイミング制御</li></ul></li><li><p><strong>柔軟な状態管理</strong></p><ul><li>必要に応じて保存する状態の粒度を調整可能</li><li>差分保存やフル保存を選択できる</li></ul></li></ol><p><strong>根拠</strong>:</p><ul><li>GoFパターンの基本原則（カプセル化、責任の分離）に従っている</li><li>実際のアプリケーションで繰り返し実証されている利点</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Memento Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/memento-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/memento-design-pattern/</a></li><li>HackerNoon: Memento Design Pattern Overview - <a class=link href=https://hackernoon.com/memento-design-pattern-overview-4r7p3wol target=_blank rel=noopener>https://hackernoon.com/memento-design-pattern-overview-4r7p3wol</a></li><li>Scaler Topics: Memento Design Pattern - <a class=link href=https://www.scaler.com/topics/memento-design-pattern/ target=_blank rel=noopener>https://www.scaler.com/topics/memento-design-pattern/</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=52-デメリット欠点>5.2 デメリット（欠点）</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>デメリット</th><th>説明</th><th>影響</th><th>対策</th></tr></thead><tbody><tr><td><strong>メモリ使用量</strong></td><td>複数の状態コピーを保存するため、メモリ消費が大きい</td><td>大規模オブジェクトや頻繁な保存で問題化</td><td>履歴数制限、差分保存、圧縮</td></tr><tr><td><strong>パフォーマンス影響</strong></td><td>状態のシリアライズ/デシリアライズにコストがかかる</td><td>複雑なオブジェクトで顕著</td><td>浅いコピー、遅延コピー</td></tr><tr><td><strong>Caretaker の複雑化</strong></td><td>履歴管理ロジックが複雑になりがち</td><td>バグの温床になる可能性</td><td>シンプルな設計、テスト強化</td></tr><tr><td><strong>限定的なアクセス</strong></td><td>Originatorのみが状態を読み書きできる</td><td>状態の共有や転送が困難</td><td>必要に応じて設計を見直す</td></tr><tr><td><strong>誤用のリスク</strong></td><td>Mementoが不変でない場合、カプセル化が破れる</td><td>セキュリティ問題、予期しない動作</td><td>Mementoをイミュータブルに</td></tr><tr><td><strong>バージョン管理の欠如</strong></td><td>どの状態がどの時点のものか識別困難</td><td>履歴の追跡が難しい</td><td>タイムスタンプや説明を追加</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><ol><li><p><strong>メモリ使用量の問題</strong></p><ul><li>大規模なオブジェクトの場合、1つのMementoで数MB〜数十MB消費する可能性</li><li>50段階のUndoをサポートする場合、単純計算で50倍のメモリが必要</li><li><strong>対策</strong>:<ul><li>履歴数を制限（例: 最大50個）</li><li>差分（delta）のみを保存</li><li>古い履歴を圧縮</li><li>weak reference を使用</li></ul></li></ul></li><li><p><strong>パフォーマンスへの影響</strong></p><ul><li>ディープコピーが必要な場合、処理時間がかかる</li><li>シリアライズ/デシリアライズのオーバーヘッド</li><li><strong>対策</strong>:<ul><li>Copy-on-Write（COW）戦略</li><li>参照カウントによる共有</li><li>遅延コピー（実際に必要になるまで遅らせる）</li></ul></li></ul></li><li><p><strong>Caretakerの複雑化</strong></p><ul><li>Undo/Redoスタックの管理</li><li>履歴数制限の実装</li><li>メモリ解放のタイミング</li><li><strong>対策</strong>:<ul><li>単純な設計を心がける</li><li>十分なユニットテスト</li></ul></li></ul></li></ol><p><strong>根拠</strong>:</p><ul><li>実務での失敗事例や課題が技術コミュニティで共有されている</li><li>メモリとパフォーマンスのトレードオフは設計上の重要な考慮事項</li></ul><p><strong>出典</strong>:</p><ul><li>CodingTechRoom: Memento Pattern Drawbacks - <a class=link href=https://codingtechroom.com/question/-memento-pattern-drawbacks target=_blank rel=noopener>https://codingtechroom.com/question/-memento-pattern-drawbacks</a></li><li>Molecular Sciences: Memento Design Pattern Explanation - <a class=link href=https://molecularsciences.org/content/detailed-explanation-of-memento-design-pattern/ target=_blank rel=noopener>https://molecularsciences.org/content/detailed-explanation-of-memento-design-pattern/</a></li><li>PMI: The Memento Pattern - <a class=link href=https://www.pmi.org/disciplined-agile/the-design-patterns-repository/the-memento-pattern target=_blank rel=noopener>https://www.pmi.org/disciplined-agile/the-design-patterns-repository/the-memento-pattern</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h3 id=53-他のパターンとの比較>5.3 他のパターンとの比較</h3><h4 id=531-command-パターンとの違い>5.3.1 Command パターンとの違い</h4><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>観点</th><th>Memento パターン</th><th>Command パターン</th></tr></thead><tbody><tr><td><strong>保存対象</strong></td><td>オブジェクトの状態（スナップショット）</td><td>操作・アクション（コマンド）</td></tr><tr><td><strong>Undo方法</strong></td><td>以前の状態を復元</td><td>操作を逆実行</td></tr><tr><td><strong>メモリ使用</strong></td><td>状態全体を保存するため大きい</td><td>アクションのみ保存で小さい</td></tr><tr><td><strong>適用場面</strong></td><td>複雑な状態の復元</td><td>個別操作の取り消し</td></tr><tr><td><strong>粒度</strong></td><td>状態のスナップショット</td><td>操作単位</td></tr><tr><td><strong>実装の複雑さ</strong></td><td>状態のコピーのみ</td><td>Undo ロジックの実装が必要</td></tr></tbody></table></div><p><strong>詳細説明</strong>:</p><ul><li><p><strong>Memento</strong>: 「オブジェクトの状態を丸ごと保存して、後で復元する」</p><ul><li>例: ドキュメント全体の状態をコピー</li><li>Undo: 以前の状態に丸ごと戻す</li></ul></li><li><p><strong>Command</strong>: 「操作をオブジェクトとしてカプセル化し、逆操作を定義」</p><ul><li>例: 「文字を挿入する」コマンド、「削除する」コマンド</li><li>Undo: 各コマンドの<code>undo()</code>メソッドを実行（挿入の逆は削除）</li></ul></li></ul><p><strong>使い分け</strong>:</p><ul><li><strong>Mementoを選ぶ</strong>: 状態が複雑で、個別操作の逆実行が困難な場合</li><li><strong>Commandを選ぶ</strong>: 操作が明確で、逆操作が定義しやすい場合</li><li><strong>両方を組み合わせる</strong>: Commandでアクションをカプセル化し、Mementoで状態を保存</li></ul><p><strong>根拠</strong>:</p><ul><li>両パターンは補完的であり、実際のアプリケーションでは併用されることも多い</li><li>選択基準は、状態の複雑さと逆操作の実装コスト</li></ul><p><strong>出典</strong>:</p><ul><li>Stack Overflow: Memento vs Command - <a class=link href=https://stackoverflow.com/questions/49098745/what-is-the-difference-between-memento-and-command-design-pattern target=_blank rel=noopener>https://stackoverflow.com/questions/49098745/what-is-the-difference-between-memento-and-command-design-pattern</a></li><li>CodingTechRoom: Differences Between Memento and Command - <a class=link href=https://codingtechroom.com/question/understanding-differences-memento-command-design-patterns target=_blank rel=noopener>https://codingtechroom.com/question/understanding-differences-memento-command-design-patterns</a></li><li>Microsoft Learn: Command/Memento - <a class=link href=https://learn.microsoft.com/en-us/shows/Visual-Studio-Toolbox/Design-Patterns-CommandMemento target=_blank rel=noopener>https://learn.microsoft.com/en-us/shows/Visual-Studio-Toolbox/Design-Patterns-CommandMemento</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h4 id=532-state-パターンとの関係>5.3.2 State パターンとの関係</h4><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>観点</th><th>Memento パターン</th><th>State パターン</th></tr></thead><tbody><tr><td><strong>目的</strong></td><td>状態の保存と復元</td><td>状態に応じた振る舞いの変更</td></tr><tr><td><strong>焦点</strong></td><td>履歴管理（過去の状態）</td><td>現在の状態による動作切り替え</td></tr><tr><td><strong>状態遷移</strong></td><td>明示的な遷移なし（任意の状態に復元）</td><td>明確な状態遷移ロジック</td></tr><tr><td><strong>状態の可視性</strong></td><td>カプセル化されている</td><td>状態オブジェクトとして明示的</td></tr></tbody></table></div><p><strong>関連性</strong>:</p><ul><li>両方とも「状態」を扱うが、目的が異なる</li><li>State: 現在の状態によって振る舞いを変える</li><li>Memento: 過去の状態を保存し、必要に応じて復元する</li></ul><p><strong>組み合わせ例</strong>:</p><ul><li>Stateパターンで状態管理しながら、Mementoで状態履歴を保存</li><li>例: ワークフローシステムで、現在の状態（State）と履歴（Memento）を管理</li></ul><p><strong>出典</strong>:</p><ul><li>GoF Pattern: Memento Pattern - <a class=link href=https://www.gofpattern.com/behavioral/patterns/memento-pattern.php target=_blank rel=noopener>https://www.gofpattern.com/behavioral/patterns/memento-pattern.php</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h4 id=533-prototype-パターンとの関係>5.3.3 Prototype パターンとの関係</h4><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>観点</th><th>Memento パターン</th><th>Prototype パターン</th></tr></thead><tbody><tr><td><strong>目的</strong></td><td>状態の保存と復元</td><td>オブジェクトの複製</td></tr><tr><td><strong>対象</strong></td><td>既存オブジェクトの状態</td><td>新しいオブジェクトの生成</td></tr><tr><td><strong>用途</strong></td><td>履歴管理、Undo/Redo</td><td>オブジェクトの効率的な生成</td></tr></tbody></table></div><p><strong>共通点</strong>:</p><ul><li>両方ともオブジェクトのコピー（クローン）を作成する</li><li>ディープコピーが必要な場合がある</li></ul><p><strong>違い</strong>:</p><ul><li>Prototype: 新しいオブジェクトを作るため</li><li>Memento: 同じオブジェクトの状態を保存・復元するため</li></ul><p><strong>組み合わせ</strong>:</p><ul><li>Mementoの実装でPrototypeのクローン機能を利用することがある</li><li>複雑な状態の場合、Prototypeパターンでディープコピーを実現</li></ul><p><strong>出典</strong>:</p><ul><li>Springer: Behavioral Patterns - <a class=link href=https://link.springer.com/content/pdf/10.1007/978-1-4842-1848-8_8.pdf target=_blank rel=noopener>https://link.springer.com/content/pdf/10.1007/978-1-4842-1848-8_8.pdf</a></li><li>Wikibooks: Memento - <a class=link href=https://en.wikibooks.org/wiki/Computer_Science_Design_Patterns/Memento target=_blank rel=noopener>https://en.wikibooks.org/wiki/Computer_Science_Design_Patterns/Memento</a></li></ul><p><strong>信頼度</strong>: 9/10</p><hr><h2 id=6-内部リンク候補>6. 内部リンク候補</h2><h3 id=61-デザインパターン関連記事>6.1 デザインパターン関連記事</h3><p>以下は<code>/content/post</code>配下のデザインパターン・オブジェクト指向関連記事の内部リンク候補：</p><div class=table-wrapper><table><thead><tr><th>記事タイトル</th><th>推定パス</th><th>関連度</th><th>理由</th></tr></thead><tbody><tr><td>第1回-Mooで覚えるオブジェクト指向プログラミング</td><td><code>/2021/10/31/191008/</code></td><td>高</td><td>Mooの基本、本記事のコード例と直接関連</td></tr><tr><td>JSON-RPC Request/Response実装 - 複合値オブジェクト設計</td><td><code>/2025/12/25/234500/</code></td><td>中</td><td>オブジェクト設計、Factoryパターン言及</td></tr><tr><td>Moose::Roleが興味深い</td><td><code>/2009/02/14/105950/</code></td><td>中</td><td>Moose/Mooのロール機能</td></tr><tr><td>よなべPerl で Moo について喋ってきました</td><td><code>/2016/02/21/150920/</code></td><td>中</td><td>Mooに関するプレゼンテーション</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>本調査ドキュメントはPerl/Mooでの実装を含むため、Moo関連記事との関連性が高い</li><li>オブジェクト指向設計の記事とも親和性がある</li></ul><p><strong>出典</strong>:</p><ul><li>既存の<code>design-patterns-research.md</code>の内部リンク調査セクションを参考</li></ul><p><strong>信頼度</strong>: 9/10（実際のファイルパス調査に基づく）</p><hr><h2 id=7-参考文献リソース>7. 参考文献・リソース</h2><h3 id=71-公式書籍定番書籍>7.1 公式書籍・定番書籍</h3><div class=table-wrapper><table><thead><tr><th>書籍名</th><th>著者</th><th>ISBN</th><th>備考</th></tr></thead><tbody><tr><td><strong>Design Patterns: Elements of Reusable Object-Oriented Software</strong></td><td>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides</td><td>978-0201633610</td><td>GoF原典、Mementoパターンの公式定義</td></tr><tr><td><strong>Head First Design Patterns (2nd Edition)</strong></td><td>Eric Freeman, Elisabeth Robson</td><td>978-1492078005</td><td>初心者向け、視覚的な解説</td></tr></tbody></table></div><h3 id=72-信頼性の高いwebリソース>7.2 信頼性の高いWebリソース</h3><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th></tr></thead><tbody><tr><td><strong>Refactoring Guru: Memento</strong></td><td><a class=link href=https://refactoring.guru/design-patterns/memento target=_blank rel=noopener>https://refactoring.guru/design-patterns/memento</a></td><td>視覚的で詳細な解説、多言語コード例</td></tr><tr><td><strong>GeeksforGeeks: Memento Design Pattern</strong></td><td><a class=link href=https://www.geeksforgeeks.org/system-design/memento-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/memento-design-pattern/</a></td><td>網羅的な解説、実装例豊富</td></tr><tr><td><strong>SourceMaking: Memento</strong></td><td><a class=link href=https://sourcemaking.com/design_patterns/memento target=_blank rel=noopener>https://sourcemaking.com/design_patterns/memento</a></td><td>実践的なチュートリアル形式</td></tr><tr><td><strong>Wikipedia: Memento pattern</strong></td><td><a class=link href=https://en.wikipedia.org/wiki/Memento_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Memento_pattern</a></td><td>歴史的背景、構造の説明</td></tr><tr><td><strong>dPatterns: Memento</strong></td><td><a class=link href=https://dpatterns.com/behavioral/memento/ target=_blank rel=noopener>https://dpatterns.com/behavioral/memento/</a></td><td>簡潔な定義と例</td></tr></tbody></table></div><h3 id=73-perlmoomoose関連リソース>7.3 Perl/Moo/Moose関連リソース</h3><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th></tr></thead><tbody><tr><td><strong>MetaCPAN: Moo</strong></td><td><a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></td><td>Mooの公式ドキュメント</td></tr><tr><td><strong>Perl Maven: OOP with Moo</strong></td><td><a class=link href=https://perlmaven.com/oop-with-moo target=_blank rel=noopener>https://perlmaven.com/oop-with-moo</a></td><td>Mooでのオブジェクト指向プログラミングチュートリアル</td></tr><tr><td><strong>Perl Begin: Object Oriented Programming</strong></td><td><a class=link href=https://perl-begin.org/topics/object-oriented/ target=_blank rel=noopener>https://perl-begin.org/topics/object-oriented/</a></td><td>Perl のOOP概要</td></tr><tr><td><strong>Kablamo: How to Moo</strong></td><td><a class=link href=http://kablamo.org/slides-intro-to-moo/ target=_blank rel=noopener>http://kablamo.org/slides-intro-to-moo/</a></td><td>Mooの実践的な使い方</td></tr></tbody></table></div><h3 id=74-パターン比較実装例>7.4 パターン比較・実装例</h3><div class=table-wrapper><table><thead><tr><th>リソース名</th><th>URL</th><th>特徴</th></tr></thead><tbody><tr><td><strong>Stack Overflow: Memento vs Command</strong></td><td><a class=link href=https://stackoverflow.com/questions/49098745/what-is-the-difference-between-memento-and-command-design-pattern target=_blank rel=noopener>https://stackoverflow.com/questions/49098745/what-is-the-difference-between-memento-and-command-design-pattern</a></td><td>パターンの違いに関する議論</td></tr><tr><td><strong>Java Design Patterns: Memento</strong></td><td><a class=link href=https://java-design-patterns.com/patterns/memento/ target=_blank rel=noopener>https://java-design-patterns.com/patterns/memento/</a></td><td>Java実装例（Perlへの移植参考）</td></tr><tr><td><strong>Software Patterns Lexicon: Memento</strong></td><td><a class=link href=https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/behavioral-patterns/memento-pattern/</a></td><td>構造化された解説</td></tr><tr><td><strong>MomentsLog: Text Editor Undo/Redo</strong></td><td><a class=link href=https://www.momentslog.com/development/design-pattern/memento-pattern-in-text-editors-undo-redo-history-management target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/memento-pattern-in-text-editors-undo-redo-history-management</a></td><td>テキストエディタの実装例</td></tr></tbody></table></div><p><strong>信頼度</strong>: すべて高（公式ドキュメント、著名な技術サイト、学術的なソース）</p><hr><h2 id=8-調査結果のサマリー>8. 調査結果のサマリー</h2><h3 id=81-主要な発見>8.1 主要な発見</h3><ol><li><strong>Mementoパターンの本質</strong>: カプセル化を維持したまま、オブジェクトの状態を保存・復元する仕組み</li><li><strong>3つの役割の明確な分離</strong>: Originator、Memento、Caretakerの責任が明確</li><li><strong>実用性の高さ</strong>: Undo/Redo機能、スナップショット、トランザクション管理など、多くの実用シーンで活用</li><li><strong>Commandパターンとの補完性</strong>: 状態保存（Memento）vs 操作の逆実行（Command）で使い分け、または併用</li><li><strong>Perl/Mooでの実装の容易さ</strong>: MooのシンプルなOOP機能で、パターンを簡潔に実装可能</li><li><strong>メモリとパフォーマンスのトレードオフ</strong>: 利便性と引き換えにリソース消費が増える点に注意が必要</li></ol><h3 id=82-重要なポイント>8.2 重要なポイント</h3><ul><li><strong>適用判断</strong>: 状態の複雑さ、Undo/Redoの必要性、カプセル化の重要性を考慮</li><li><strong>メモリ対策</strong>: 履歴数制限、差分保存、圧縮などの工夫が必要</li><li><strong>実装のベストプラクティス</strong>: Mementoをイミュータブルに、Caretakerはシンプルに</li><li><strong>Mooseとの選択</strong>: 大規模プロジェクトや高度な型制約が必要な場合はMoose、それ以外はMooで十分</li></ul><h3 id=83-今後の調査が必要な領域参考>8.3 今後の調査が必要な領域（参考）</h3><ul><li>他の言語（Python、JavaScript、Rubyなど）での実装パターン</li><li>大規模システムでのMementoパターンのスケーラビリティ</li><li>分散システムでの状態管理への応用</li><li>関数型プログラミングにおける状態管理との比較</li></ul><hr><h2 id=9-信頼度評価>9. 信頼度評価</h2><h3 id=91-調査内容の信頼度>9.1 調査内容の信頼度</h3><div class=table-wrapper><table><thead><tr><th>項目</th><th>信頼度</th><th>根拠</th></tr></thead><tbody><tr><td>GoF定義</td><td>高</td><td>公式書籍、複数の権威あるソースで確認</td></tr><tr><td>パターンの構造（3要素）</td><td>高</td><td>GoF公式定義、多数の実装例で一貫</td></tr><tr><td>Perl/Moo実装</td><td>高</td><td>公式ドキュメント、実績あるチュートリアル</td></tr><tr><td>メリット・デメリット</td><td>高</td><td>実務経験に基づく事例、技術コミュニティの共有知識</td></tr><tr><td>Command パターンとの比較</td><td>高</td><td>複数の技術記事、Stack Overflowでの議論</td></tr><tr><td>実用例</td><td>高</td><td>実際のソフトウェアでの使用実績</td></tr></tbody></table></div><h3 id=92-情報源の品質>9.2 情報源の品質</h3><ul><li><strong>一次情報源</strong>: GoF書籍、公式ドキュメント（MetaCPAN）</li><li><strong>二次情報源</strong>: Refactoring Guru、GeeksforGeeks、SourceMaking</li><li><strong>コミュニティソース</strong>: Stack Overflow、技術ブログ</li></ul><p>すべての情報は複数のソースで裏付けを取り、信頼性を確保している。</p><hr><p><strong>調査完了</strong>: 2025年12月31日</p><p><strong>調査者メモ</strong>:</p><ul><li>Mementoパターンは実用性が高く、特にUndo/Redo機能の実装に最適</li><li>Perl/Mooでの実装は簡潔で理解しやすい</li><li>メモリ使用量に注意し、適切な制限や最適化が必要</li><li>Commandパターンとの違いを理解し、適切に使い分けることが重要</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/design-patterns/>Design-Patterns</a>
<a href=/tags/gof/>Gof</a>
<a href=/tags/behavioral-patterns/>Behavioral-Patterns</a>
<a href=/tags/memento/>Memento</a>
<a href=/tags/software-design/>Software-Design</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/warehouse/interpreter-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Interpreterパターン調査ドキュメント</h2></div></a></article><article class=has-image><a href=/warehouse/design-patterns-overview/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>デザインパターン概要</h2></div></a></article><article class=has-image><a href=/warehouse/design-patterns-research/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>デザインパターン調査ドキュメント</h2></div></a></article><article class=has-image><a href=/2026/01/16/004313/><div class=article-image><img src=/public_images/2026/observer-pattern-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/observer-pattern-series-image.jpg></div><div class=article-details><h2 class=article-title>第10回-これがObserverパターンだ！ - Perlでローグライク通知システムを作ろう</h2></div></a></article><article class=has-image><a href=/warehouse/observer-pattern/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Observerパターン調査ドキュメント</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//nqounet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2000 -
2026 デザインパターンの名前は嘘をつく</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>