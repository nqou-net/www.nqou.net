<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Chain of Responsibilityパターン学習シリーズ「クレジットカード決済の多段審査処理」作成のための調査・情報収集結果"><title>調査ドキュメント - クレジットカード決済の多段審査処理（Chain of Responsibilityパターン学習シリーズ）</title><link rel=canonical href=https://www.nqou.net/warehouse/credit-card-payment-verification/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="調査ドキュメント - クレジットカード決済の多段審査処理（Chain of Responsibilityパターン学習シリーズ）"><meta property='og:description' content="Chain of Responsibilityパターン学習シリーズ「クレジットカード決済の多段審査処理」作成のための調査・情報収集結果"><meta property='og:url' content='https://www.nqou.net/warehouse/credit-card-payment-verification/'><meta property='og:site_name' content='デザインパターンの名前は嘘をつく'><meta property='og:type' content='article'><meta property='article:section' content='Warehouse'><meta property='article:tag' content='chain-of-responsibility'><meta property='article:tag' content='design-patterns'><meta property='article:tag' content='perl'><meta property='article:tag' content='moo'><meta property='article:tag' content='payment-processing'><meta property='article:tag' content='e-commerce'><meta property='article:tag' content='research'><meta property='article:published_time' content='2026-01-08T22:31:00+09:00'><meta property='article:modified_time' content='2026-01-08T22:31:00+09:00'><meta property='og:image' content='https://www.nqou.net/favicon.png'><meta name=twitter:title content="調査ドキュメント - クレジットカード決済の多段審査処理（Chain of Responsibilityパターン学習シリーズ）"><meta name=twitter:description content="Chain of Responsibilityパターン学習シリーズ「クレジットカード決済の多段審査処理」作成のための調査・情報収集結果"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nqou.net/favicon.png'><link rel="shortcut icon" href=/favicon.png><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap';:root{--base-font-family:Arial, "Noto Sans JP", sans-serif}</style><link rel=stylesheet href=/css/linkcard.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3923446804785015" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js defer></script><script defer>document.addEventListener("DOMContentLoaded",function(){try{typeof mermaid!="undefined"&&document.querySelector(".mermaid")&&mermaid.initialize({startOnLoad:!0,securityLevel:"strict"})}catch(e){console.warn("Mermaid failed to initialize:",e)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-E50H9ESN7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E50H9ESN7E")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/public_images/nqounet201703.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🥃</span></figure><div class=site-meta><h1 class=site-name><a href=/>デザインパターンの名前は嘘をつく</a></h1><h2 class=site-description>パターン名の嘘を暴く。詰まる設計を容赦なく解体。</h2></div></header><ol class=menu-social><li><a href=https://github.com/nqounet target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/nqounet target=_blank title=X rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/advent-calendar-2025/><svg class="icon icon-tabler icon-tabler-calendar" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><path d="M8 15h.01"/><path d="M12 15h.01"/><path d="M16 15h.01"/><path d="M8 19h.01"/><path d="M12 19h.01"/><path d="M16 19h.01"/></svg>
<span>Perl Advent Calendar 2025 - AI Edition</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/warehouse/><svg class="icon icon-tabler icon-tabler-warehouse" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l9-6 9 6"/><rect x="5" y="10" width="14" height="10" rx="2"/><rect x="10" y="14" width="4" height="6" rx="1"/><path d="M7 20v-4h2v4"/><path d="M15 20v-4h2v4"/></svg>
<span>Warehouse</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目次</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#調査目的>調査目的</a></li><li><a href=#調査概要>調査概要</a><ol><li><a href=#想定読者>想定読者</a></li><li><a href=#技術スタック>技術スタック</a></li><li><a href=#制約>制約</a></li></ol></li><li><a href=#1-クレジットカード決済審査のドメイン知識>1. クレジットカード決済審査のドメイン知識</a><ol><li><a href=#11-オーソリゼーション与信処理の概要>1.1 オーソリゼーション（与信処理）の概要</a></li><li><a href=#12-ecサイト決済フローの処理工程>1.2 ECサイト決済フローの処理工程</a></li><li><a href=#13-審査条件の種類>1.3 審査条件の種類</a></li><li><a href=#14-決済処理の成功失敗パターン>1.4 決済処理の成功・失敗パターン</a><ol><li><a href=#成功パターン>成功パターン</a></li><li><a href=#失敗パターン>失敗パターン</a></li></ol></li><li><a href=#15-架空のecサイト決済フローの設計シリーズ記事向け>1.5 架空のECサイト決済フローの設計（シリーズ記事向け）</a></li></ol></li><li><a href=#2-chain-of-responsibilityパターンとの適合性>2. Chain of Responsibilityパターンとの適合性</a><ol><li><a href=#21-決済審査処理がchain-of-responsibilityパターンに適している理由>2.1 決済審査処理がChain of Responsibilityパターンに適している理由</a></li><li><a href=#22-パターンの構造と決済審査への適用>2.2 パターンの構造と決済審査への適用</a></li><li><a href=#23-他のデザインパターンとの比較>2.3 他のデザインパターンとの比較</a></li><li><a href=#24-審査処理をチェーン構造にする際のベストプラクティス>2.4 審査処理をチェーン構造にする際のベストプラクティス</a></li></ol></li><li><a href=#3-競合記事の分析>3. 競合記事の分析</a><ol><li><a href=#31-決済処理chain-of-responsibilityを題材にした技術記事>3.1 「決済処理」×「Chain of Responsibility」を題材にした技術記事</a></li><li><a href=#32-日本語perl記事の希少性>3.2 日本語Perl記事の希少性</a></li><li><a href=#33-差別化のポイント>3.3 差別化のポイント</a></li></ol></li><li><a href=#4-内部リンク調査>4. 内部リンク調査</a><ol><li><a href=#41-既存シリーズとの関連性>4.1 既存シリーズとの関連性</a></li><li><a href=#42-関連記事内部リンク候補>4.2 関連記事（内部リンク候補）</a></li><li><a href=#43-既存シリーズとの差別化>4.3 既存シリーズとの差別化</a></li></ol></li><li><a href=#5-連載構造の提案>5. 連載構造の提案</a><ol><li><a href=#51-シリーズタイトル案>5.1 シリーズタイトル案</a></li><li><a href=#52-連載構造3回構成>5.2 連載構造（3回構成）</a></li><li><a href=#53-各回の詳細ストーリー>5.3 各回の詳細ストーリー</a><ol><li><a href=#第1回決済審査をif文で実装してみる>第1回：決済審査をif文で実装してみる</a></li><li><a href=#第2回審査ロジックをチェッカーに分離する>第2回：審査ロジックをチェッカーに分離する</a></li><li><a href=#第3回拡張可能な決済審査システムを完成させる>第3回：拡張可能な決済審査システムを完成させる</a></li></ol></li></ol></li><li><a href=#6-技術的詳細>6. 技術的詳細</a><ol><li><a href=#61-perlmooでの実装イメージ>6.1 Perl/Mooでの実装イメージ</a></li><li><a href=#62-決済リクエストオブジェクトの設計>6.2 決済リクエストオブジェクトの設計</a></li></ol></li><li><a href=#7-リスクと対策>7. リスクと対策</a><ol><li><a href=#71-想定されるリスク>7.1 想定されるリスク</a></li></ol></li><li><a href=#8-推奨タグ>8. 推奨タグ</a><ol><li><a href=#シリーズ全体>シリーズ全体</a></li><li><a href=#各回固有>各回固有</a></li></ol></li><li><a href=#9-結論>9. 結論</a><ol><li><a href=#最終推薦>最終推薦</a></li><li><a href=#次のステップ>次のステップ</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/warehouse/credit-card-payment-verification/><img src=/favicon.png loading=lazy alt="Featured image of post 調査ドキュメント - クレジットカード決済の多段審査処理（Chain of Responsibilityパターン学習シリーズ）"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/warehouse/credit-card-payment-verification/>調査ドキュメント - クレジットカード決済の多段審査処理（Chain of Responsibilityパターン学習シリーズ）</a></h2><h3 class=article-subtitle>Chain of Responsibilityパターン学習シリーズ「クレジットカード決済の多段審査処理」作成のための調査・情報収集結果</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>1月 08, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>読了時間: 16分</time></div></footer></div></header><section class=article-content><h1 id=調査ドキュメントクレジットカード決済の多段審査処理>調査ドキュメント：クレジットカード決済の多段審査処理</h1><h2 id=調査目的>調査目的</h2><p>Chain of Responsibilityパターンを学ぶシリーズ記事「クレジットカード決済の多段審査処理」作成のための情報収集と調査。架空のECサイト決済フローを題材に、多段階の審査処理をハンドラチェーンとして実装する連載記事の作成を目指す。</p><p><strong>調査実施日</strong>: 2026年1月8日</p><hr><h2 id=調査概要>調査概要</h2><h3 id=想定読者>想定読者</h3><ul><li>Perl入学式を卒業したばかりの入門者</li><li>「Mooで覚えるオブジェクト指向プログラミング」シリーズを読了してOOPを身に付けたい</li><li>モダンなPerl（v5.36+）を使ってみたい</li></ul><h3 id=技術スタック>技術スタック</h3><ul><li>Perl v5.36以降（signatures対応）</li><li>Mooによるオブジェクト指向プログラミング</li></ul><h3 id=制約>制約</h3><ul><li>コード例は2つまで</li><li>新しい概念は1つまで</li><li>回の最後には完成コードを示す</li><li>完成コードは原則として1つのスクリプトファイル</li></ul><hr><h2 id=1-クレジットカード決済審査のドメイン知識>1. クレジットカード決済審査のドメイン知識</h2><h3 id=11-オーソリゼーション与信処理の概要>1.1 オーソリゼーション（与信処理）の概要</h3><p><strong>要点</strong>:</p><ul><li>オーソリ（オーソリゼーション）とは、クレジットカードの「信用照会」「承認」「与信確保」を行う処理</li><li>購入者がECサイトでカード情報を入力すると、カード会社へリアルタイムで確認が入る</li><li>審査項目：カードの有効性、利用限度額の確認、不正利用の疑いの検出</li><li>問題がなければ取引予定額分の利用枠を一時的に確保（実際の引き落としは後日の売上処理で実行）</li></ul><p><strong>根拠</strong>:</p><ul><li>各決済代行会社の公式ドキュメントで一貫した説明がなされている</li><li>業界標準のプロセスとして確立されている</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://theapps.jp/media/3396 target=_blank rel=noopener>https://theapps.jp/media/3396</a>（Appsクレカナビ - オーソリとは）</li><li><a class=link href=https://www.gmo-pg.com/blog/articles/article-0173/ target=_blank rel=noopener>https://www.gmo-pg.com/blog/articles/article-0173/</a>（GMOペイメントゲートウェイ）</li><li><a class=link href=https://stripe.com/jp/resources/more/credit-card-payment-authorization-and-transaction-settlement-process target=_blank rel=noopener>https://stripe.com/jp/resources/more/credit-card-payment-authorization-and-transaction-settlement-process</a>（Stripe公式）</li></ul><p><strong>信頼度</strong>: 高（複数の決済代行会社の公式ドキュメント）</p><hr><h3 id=12-ecサイト決済フローの処理工程>1.2 ECサイト決済フローの処理工程</h3><p><strong>要点</strong>:</p><p>決済処理の一般的なフローは以下の通り：</p><ol><li><strong>カード情報入力</strong>: 購入者がカード番号、有効期限、セキュリティコード等を入力</li><li><strong>情報の暗号化送信</strong>: SSL/TLSで安全に送信</li><li><strong>決済代行会社への伝達</strong>: 必要に応じて3Dセキュアによる追加認証</li><li><strong>カード会社での審査</strong>: 有効性、限度額、不正利用チェック</li><li><strong>結果通知</strong>: 承認時はオーソリコード発行、非承認時はエラーコード返却</li><li><strong>注文処理</strong>: 承認結果に応じて注文確定または失敗</li><li><strong>売上処理（後日）</strong>: 商品発送時に本決済を実行</li></ol><p><strong>根拠</strong>:</p><ul><li>決済代行会社の開発者向けドキュメントに詳細なフロー図が掲載されている</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://www.veritrans.co.jp/docs/mdk_guide/flow_diagram.html target=_blank rel=noopener>https://www.veritrans.co.jp/docs/mdk_guide/flow_diagram.html</a>（DGフィナンシャルテクノロジー）</li><li><a class=link href=https://www.robotpayment.co.jp/blog/creditcard/5722/ target=_blank rel=noopener>https://www.robotpayment.co.jp/blog/creditcard/5722/</a>（ロボットペイメント）</li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=13-審査条件の種類>1.3 審査条件の種類</h3><p><strong>要点</strong>:</p><p>ECサイトの決済審査で一般的にチェックされる項目：</p><div class=table-wrapper><table><thead><tr><th>チェック項目</th><th>内容</th><th>失敗時の対応</th></tr></thead><tbody><tr><td><strong>カード有効期限</strong></td><td>期限切れでないか確認</td><td>即座に拒否</td></tr><tr><td><strong>カード番号形式</strong></td><td>Luhnアルゴリズムによる妥当性チェック</td><td>即座に拒否</td></tr><tr><td><strong>金額上限チェック</strong></td><td>取引金額が設定上限以内か</td><td>拒否または追加認証</td></tr><tr><td><strong>ブラックリストチェック</strong></td><td>過去に問題のあったカード番号かどうか</td><td>即座に拒否</td></tr><tr><td><strong>不正利用検知</strong></td><td>異常な取引パターン、地理的不整合等</td><td>拒否または人的審査へエスカレーション</td></tr><tr><td><strong>3Dセキュア認証</strong></td><td>本人確認の追加認証</td><td>認証失敗で拒否</td></tr><tr><td><strong>利用限度額確認</strong></td><td>残り利用可能枠の確認</td><td>枠不足で拒否</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>決済代行会社のセキュリティ対策ドキュメント</li><li>不正対策サービスの説明資料</li></ul><p><strong>仮定</strong>:</p><ul><li>シリーズ記事では、上記のうち学習目的に適した項目を選定して実装する</li><li>実際のカード会社との通信は行わず、架空の審査ロジックとして実装</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://theapps.jp/media/3396 target=_blank rel=noopener>https://theapps.jp/media/3396</a>（審査項目）</li><li><a class=link href=https://www.gmo-pg.com/blog/articles/article-0173/ target=_blank rel=noopener>https://www.gmo-pg.com/blog/articles/article-0173/</a>（不正対策）</li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=14-決済処理の成功失敗パターン>1.4 決済処理の成功・失敗パターン</h3><p><strong>要点</strong>:</p><p>決済処理の結果パターン：</p><h4 id=成功パターン>成功パターン</h4><ul><li>全ての審査をパスし、オーソリコードが発行される</li><li>利用枠が一時的に確保され、注文処理へ進む</li></ul><h4 id=失敗パターン>失敗パターン</h4><div class=table-wrapper><table><thead><tr><th>失敗タイプ</th><th>原因</th><th>ユーザーへの通知例</th></tr></thead><tbody><tr><td>カード情報エラー</td><td>番号、有効期限、CVCの入力誤り</td><td>「カード情報をご確認ください」</td></tr><tr><td>限度額超過</td><td>利用可能枠不足</td><td>「カード会社にお問い合わせください」</td></tr><tr><td>有効期限切れ</td><td>カードの期限が過ぎている</td><td>「有効期限をご確認ください」</td></tr><tr><td>利用停止</td><td>カード会社による停止（盗難、紛失等）</td><td>「カード会社にお問い合わせください」</td></tr><tr><td>不正検知</td><td>セキュリティシステムによる拒否</td><td>「お取引を完了できませんでした」</td></tr><tr><td>通信エラー</td><td>ネットワーク障害</td><td>「しばらく経ってから再度お試しください」</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>ECサイト運営者向けのトラブルシューティングガイド</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://theapps.jp/media/3396 target=_blank rel=noopener>https://theapps.jp/media/3396</a>（エラー原因）</li><li><a class=link href=https://www.gmo-pg.com/blog/articles/article-0173/ target=_blank rel=noopener>https://www.gmo-pg.com/blog/articles/article-0173/</a>（エラー対応）</li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=15-架空のecサイト決済フローの設計シリーズ記事向け>1.5 架空のECサイト決済フローの設計（シリーズ記事向け）</h3><p><strong>要点</strong>:</p><p>学習目的に適した簡略化された審査フローを設計：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>決済リクエスト
</span></span><span class=line><span class=cl>    │
</span></span><span class=line><span class=cl>    ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│ カード有効期限   │ ──失敗──▶ 拒否「有効期限切れ」
</span></span><span class=line><span class=cl>│ チェッカー       │
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │成功
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│ 金額上限         │ ──失敗──▶ 拒否「金額上限超過」
</span></span><span class=line><span class=cl>│ チェッカー       │
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │成功
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│ ブラックリスト   │ ──失敗──▶ 拒否「取引不可」
</span></span><span class=line><span class=cl>│ チェッカー       │
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │成功
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│ 残高（枠）       │ ──失敗──▶ 拒否「利用限度額超過」
</span></span><span class=line><span class=cl>│ チェッカー       │
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │成功
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>     承認完了
</span></span></code></pre></td></tr></table></div></div><p><strong>仮定</strong>:</p><ul><li>実際のカード会社APIは呼び出さない（架空の審査ロジック）</li><li>各チェッカーは独立したハンドラとして実装</li><li>チェーンの順序は変更可能</li></ul><p><strong>信頼度</strong>: 高（設計は著者による提案）</p><hr><h2 id=2-chain-of-responsibilityパターンとの適合性>2. Chain of Responsibilityパターンとの適合性</h2><h3 id=21-決済審査処理がchain-of-responsibilityパターンに適している理由>2.1 決済審査処理がChain of Responsibilityパターンに適している理由</h3><p><strong>要点</strong>:</p><p>Chain of Responsibilityパターンが決済審査に適している理由：</p><ol><li><strong>多段階の判定処理</strong>: 複数の審査ステップを順次実行</li><li><strong>早期終了（Short-circuit）</strong>: いずれかの審査で失敗した場合、後続の処理をスキップ</li><li><strong>処理の独立性</strong>: 各審査ロジックは独立しており、単体でテスト可能</li><li><strong>順序の柔軟性</strong>: 審査の順序を実行時に変更可能</li><li><strong>拡張性</strong>: 新しい審査ロジックを既存コードを変更せずに追加可能</li></ol><p><strong>根拠</strong>:</p><ul><li>決済処理のバリデーションシナリオはChain of Responsibilityの典型的なユースケース</li><li>複数のチュートリアルで決済バリデーションが例として使用されている</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://dotnettutorials.net/lesson/real-time-examples-of-chain-of-responsibility-design-pattern/ target=_blank rel=noopener>https://dotnettutorials.net/lesson/real-time-examples-of-chain-of-responsibility-design-pattern/</a></li><li><a class=link href=https://www.geeksforgeeks.org/system-design/chain-responsibility-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/chain-responsibility-design-pattern/</a></li><li><a class=link href=https://readmedium.com/chain-of-responsibility-design-pattern-the-validation-scenario-7e7235fd05a2 target=_blank rel=noopener>https://readmedium.com/chain-of-responsibility-design-pattern-the-validation-scenario-7e7235fd05a2</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=22-パターンの構造と決済審査への適用>2.2 パターンの構造と決済審査への適用</h3><p><strong>要点</strong>:</p><p>Chain of Responsibilityパターンの基本構造：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                   Handler                        │
</span></span><span class=line><span class=cl>│  ─────────────────────────────────────────────  │
</span></span><span class=line><span class=cl>│  + set_next(handler): Handler                   │
</span></span><span class=line><span class=cl>│  + handle(request): Result                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>                         △
</span></span><span class=line><span class=cl>                         │
</span></span><span class=line><span class=cl>         ┌───────────────┼───────────────┐
</span></span><span class=line><span class=cl>         │               │               │
</span></span><span class=line><span class=cl>┌────────┴────────┐ ┌────┴────┐ ┌────────┴────────┐
</span></span><span class=line><span class=cl>│ ExpiryChecker   │ │ Limit   │ │ BlacklistChecker │
</span></span><span class=line><span class=cl>│                 │ │ Checker │ │                  │
</span></span><span class=line><span class=cl>└─────────────────┘ └─────────┘ └──────────────────┘
</span></span></code></pre></td></tr></table></div></div><p>決済審査での適用：</p><ul><li><strong>Handler（基底クラス）</strong>: <code>PaymentChecker</code> - 次のハンドラへの参照と共通インターフェースを定義</li><li><strong>ConcreteHandler（具象クラス）</strong>: 各審査ロジック（有効期限、金額上限、ブラックリスト等）</li><li><strong>Request（リクエスト）</strong>: <code>PaymentRequest</code> - カード情報、金額、購入者情報等を保持</li><li><strong>Result（結果）</strong>: 承認/拒否の判定結果とエラーメッセージ</li></ul><p><strong>根拠</strong>:</p><ul><li>GoFデザインパターンの標準的な構造</li><li>決済バリデーションでの実装例が多数存在</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://refactoring.guru/design-patterns/chain-of-responsibility target=_blank rel=noopener>https://refactoring.guru/design-patterns/chain-of-responsibility</a></li><li><a class=link href=https://www.tutorialspoint.com/design_pattern/chain_of_responsibility_pattern.htm target=_blank rel=noopener>https://www.tutorialspoint.com/design_pattern/chain_of_responsibility_pattern.htm</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=23-他のデザインパターンとの比較>2.3 他のデザインパターンとの比較</h3><p><strong>要点</strong>:</p><p>決済審査処理に適用可能なパターンとの比較：</p><div class=table-wrapper><table><thead><tr><th>パターン</th><th>適用可能性</th><th>Chain of Responsibilityとの違い</th></tr></thead><tbody><tr><td><strong>Strategy</strong></td><td>高</td><td>単一のアルゴリズムを切り替える。複数の審査を順次実行するには不向き</td></tr><tr><td><strong>Template Method</strong></td><td>中</td><td>処理の骨格を定義。審査ステップの追加・変更の柔軟性が低い</td></tr><tr><td><strong>Decorator</strong></td><td>中</td><td>機能を追加するが、処理を「中断」する概念が弱い</td></tr><tr><td><strong>Pipeline</strong></td><td>高</td><td>類似パターン。全処理を必ず通過させる場合に適する</td></tr><tr><td><strong>Chain of Responsibility</strong></td><td>最高</td><td>途中で処理を中断でき、ハンドラの順序も柔軟に変更可能</td></tr></tbody></table></div><p><strong>Chain of Responsibilityが最適な理由</strong>:</p><ol><li>審査失敗時に後続処理をスキップできる（早期終了）</li><li>各審査ロジックが完全に独立</li><li>実行時にチェーンを動的に構築可能</li><li>初心者にとって理解しやすい「次に渡す」という概念</li></ol><p><strong>根拠</strong>:</p><ul><li>デザインパターンの比較記事</li><li>実務での適用事例</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://softwarepatternslexicon.com/mastering-design-patterns/behavioral-design-patterns/chain-of-responsibility-pattern/ target=_blank rel=noopener>https://softwarepatternslexicon.com/mastering-design-patterns/behavioral-design-patterns/chain-of-responsibility-pattern/</a></li><li><a class=link href=https://thelinuxcode.com/mastering-the-chain-of-responsibility-design-pattern-a-comprehensive-guide-for-developers-and-architects/ target=_blank rel=noopener>https://thelinuxcode.com/mastering-the-chain-of-responsibility-design-pattern-a-comprehensive-guide-for-developers-and-architects/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=24-審査処理をチェーン構造にする際のベストプラクティス>2.4 審査処理をチェーン構造にする際のベストプラクティス</h3><p><strong>要点</strong>:</p><ol><li><strong>単一責任原則の遵守</strong>: 各ハンドラは1つの審査ロジックのみを担当</li><li><strong>明確な結果オブジェクト</strong>: 成功/失敗、エラーメッセージ、エラーコードを含む結果を返す</li><li><strong>チェーン構築の分離</strong>: チェーンの組み立てはファクトリやビルダーで行う</li><li><strong>ログ出力</strong>: 各ハンドラで処理結果をログに記録（デバッグ・監査用）</li><li><strong>フェイルファスト</strong>: 最初に失敗する可能性が高い審査を先に配置（パフォーマンス最適化）</li><li><strong>テスト容易性</strong>: 各ハンドラを単体でテスト可能に設計</li></ol><p><strong>根拠</strong>:</p><ul><li>SOLID原則との整合性</li><li>実務での運用経験に基づくベストプラクティス</li></ul><p><strong>仮定</strong>:</p><ul><li>初心者向けシリーズでは、上記のうち1〜3を重点的に解説</li><li>4〜6は応用編として触れる程度</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://dev.to/syridit118/understanding-the-chain-of-responsibility-design-pattern-in-backend-development-p2f target=_blank rel=noopener>https://dev.to/syridit118/understanding-the-chain-of-responsibility-design-pattern-in-backend-development-p2f</a></li><li><a class=link href=https://andrewhalil.com/2024/06/06/using-design-patterns-in-net-core-part-8-chain-of-responsibility-pattern/ target=_blank rel=noopener>https://andrewhalil.com/2024/06/06/using-design-patterns-in-net-core-part-8-chain-of-responsibility-pattern/</a></li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=3-競合記事の分析>3. 競合記事の分析</h2><h3 id=31-決済処理chain-of-responsibilityを題材にした技術記事>3.1 「決済処理」×「Chain of Responsibility」を題材にした技術記事</h3><p><strong>要点</strong>:</p><div class=table-wrapper><table><thead><tr><th>言語</th><th>記事の有無</th><th>特徴</th></tr></thead><tbody><tr><td><strong>C#/.NET</strong></td><td>多数</td><td>決済バリデーションの例が豊富。Microsoftのドキュメントにも言及あり</td></tr><tr><td><strong>Java</strong></td><td>多数</td><td>Spring Frameworkでの実装例が多い</td></tr><tr><td><strong>Python</strong></td><td>中程度</td><td>一般的なパターン解説に決済例が含まれることがある</td></tr><tr><td><strong>JavaScript/TypeScript</strong></td><td>中程度</td><td>Express.jsミドルウェアとして実装される例がある</td></tr><tr><td><strong>Perl</strong></td><td>ほぼ皆無</td><td>決済×Chain of Responsibilityの日本語記事は見当たらない</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>Web検索での調査結果</li><li>各言語のデザインパターン記事の分析</li></ul><p><strong>出典</strong>:</p><ul><li><a class=link href=https://dotnettutorials.net/lesson/real-time-examples-of-chain-of-responsibility-design-pattern/ target=_blank rel=noopener>https://dotnettutorials.net/lesson/real-time-examples-of-chain-of-responsibility-design-pattern/</a>（C#）</li><li><a class=link href=https://www.geeksforgeeks.org/system-design/chain-responsibility-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/chain-responsibility-design-pattern/</a>（Java）</li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=32-日本語perl記事の希少性>3.2 日本語Perl記事の希少性</h3><p><strong>要点</strong>:</p><ul><li>日本語でPerlを使ったChain of Responsibilityパターンの解説記事はほぼ存在しない</li><li>さらに「決済処理」と組み合わせた記事は皆無と言える</li><li>Mooを使ったデザインパターン実装の日本語記事は極めて希少</li></ul><p><strong>根拠</strong>:</p><ul><li>複数の検索エンジンでの調査結果</li><li>CPANドキュメントの確認</li></ul><p><strong>仮定</strong>:</p><ul><li>この希少性は差別化の大きな強みとなる</li><li>日本語でPerl/Mooを使った決済審査パターンの記事は「初」の可能性が高い</li></ul><p><strong>信頼度</strong>: 高</p><hr><h3 id=33-差別化のポイント>3.3 差別化のポイント</h3><p><strong>要点</strong>:</p><p>本シリーズの差別化ポイント：</p><ol><li><strong>言語の独自性</strong>: 日本語でのPerl/Moo実装は競合がほぼ存在しない</li><li><strong>ドメインの具体性</strong>: 「決済審査」という実践的で身近なドメイン</li><li><strong>段階的学習</strong>: 問題体験→パターン適用→拡張という流れ</li><li><strong>既存シリーズとの差別化</strong>: フォーム検証、ログ監視とは異なるEコマース・金融ドメイン</li></ol><p><strong>根拠</strong>:</p><ul><li>競合記事分析の結果</li><li>既存シリーズとの比較</li></ul><p><strong>信頼度</strong>: 高</p><hr><h2 id=4-内部リンク調査>4. 内部リンク調査</h2><h3 id=41-既存シリーズとの関連性>4.1 既存シリーズとの関連性</h3><p>本シリーズは以下の既存シリーズと関連を持つ：</p><div class=table-wrapper><table><thead><tr><th>シリーズ</th><th>ファイルパス</th><th>関連度</th><th>関連の内容</th></tr></thead><tbody><tr><td><strong>Mooで覚えるオブジェクト指向プログラミング</strong></td><td><code>/2021/10/31/191008/</code> 〜</td><td>最高</td><td>前提知識として必須</td></tr><tr><td><strong>フォーム検証シリーズ</strong></td><td><code>agents/structure/form-validation-series-structure.md</code></td><td>高</td><td>同じChain of Responsibilityパターン、異なるドメイン</td></tr><tr><td><strong>Mooディスパッチャーシリーズ</strong></td><td><code>/2026/01/03/002116/</code> 〜</td><td>高</td><td>Mooの実践的な活用例</td></tr></tbody></table></div><h3 id=42-関連記事内部リンク候補>4.2 関連記事（内部リンク候補）</h3><div class=table-wrapper><table><thead><tr><th>ファイルパス</th><th>内部リンク</th><th>タイトル（推定）</th><th>関連度</th></tr></thead><tbody><tr><td><code>/content/post/2021/10/31/191008.md</code></td><td><code>/2021/10/31/191008/</code></td><td>第1回-Mooで覚えるオブジェクト指向プログラミング</td><td>最高</td></tr><tr><td><code>/content/post/2026/01/03/001530.md</code></td><td><code>/2026/01/03/001530/</code></td><td>Moo OOPシリーズ第2回〜</td><td>最高</td></tr><tr><td><code>/content/post/2016/02/21/150920.md</code></td><td><code>/2016/02/21/150920/</code></td><td>よなべPerl で Moo について喋ってきました</td><td>高</td></tr><tr><td><code>/content/post/2025/12/19/234500.md</code></td><td><code>/2025/12/19/234500/</code></td><td>値オブジェクト入門</td><td>中</td></tr><tr><td><code>/content/post/2025/12/25/234500.md</code></td><td><code>/2025/12/25/234500/</code></td><td>JSON-RPC Request/Response実装</td><td>中</td></tr><tr><td><code>/content/post/2015/03/03/100703.md</code></td><td><code>/2015/03/03/100703/</code></td><td>Perl入学式で講師役をしてきました</td><td>中</td></tr></tbody></table></div><h3 id=43-既存シリーズとの差別化>4.3 既存シリーズとの差別化</h3><div class=table-wrapper><table><thead><tr><th>項目</th><th>フォーム検証シリーズ</th><th>ログ監視シリーズ</th><th>本シリーズ（決済審査）</th></tr></thead><tbody><tr><td><strong>対象データ</strong></td><td>ユーザー入力（外部）</td><td>サーバーログ（内部）</td><td>決済リクエスト（外部トランザクション）</td></tr><tr><td><strong>主な目的</strong></td><td>入力検証・エラー通知</td><td>監視・アラート発火</td><td>審査判定・承認/拒否</td></tr><tr><td><strong>ドメイン</strong></td><td>Webアプリ・UX</td><td>インフラ・運用</td><td>Eコマース・金融</td></tr><tr><td><strong>ハンドラの役割</strong></td><td>形式チェック・エラー収集</td><td>深刻度判定・通知</td><td>審査ロジック・可否判定</td></tr><tr><td><strong>失敗時の動作</strong></td><td>エラーメッセージ収集</td><td>アラート発火・エスカレーション</td><td>取引拒否・理由コード返却</td></tr></tbody></table></div><hr><h2 id=5-連載構造の提案>5. 連載構造の提案</h2><h3 id=51-シリーズタイトル案>5.1 シリーズタイトル案</h3><p>「架空ECサイトで学ぶ決済審査の責任チェーン」</p><h3 id=52-連載構造3回構成>5.2 連載構造（3回構成）</h3><div class=table-wrapper><table><thead><tr><th>回</th><th>タイトル</th><th>新しい概念</th><th>コード例1</th><th>コード例2</th></tr></thead><tbody><tr><td>第1回</td><td>決済審査をif文で実装してみる</td><td>決済審査の基本と条件分岐</td><td>カード有効期限・金額上限のif文チェック</td><td>審査項目追加でコードが複雑化</td></tr><tr><td>第2回</td><td>審査ロジックをチェッカーに分離する</td><td>Chain of Responsibilityパターンの適用</td><td>基底PaymentCheckerクラスの定義</td><td>ExpiryChecker, LimitCheckerの実装</td></tr><tr><td>第3回</td><td>拡張可能な決済審査システムを完成させる</td><td>チェーンの動的構築と結果オブジェクト</td><td>BlacklistChecker, BalanceCheckerの追加</td><td>完成版：架空EC決済審査スクリプト</td></tr></tbody></table></div><h3 id=53-各回の詳細ストーリー>5.3 各回の詳細ストーリー</h3><h4 id=第1回決済審査をif文で実装してみる>第1回：決済審査をif文で実装してみる</h4><p><strong>ストーリー</strong>:</p><p>架空のECサイト「ペルマート」の決済システムを作成することに。最初はシンプルにif文で審査ロジックを実装するが、審査項目が増えるにつれてコードが複雑化し、保守が困難になる問題を体験する。</p><p><strong>学習目標</strong>:</p><ul><li>決済審査の基本概念（有効期限、金額上限等）を理解</li><li>条件分岐が増えると保守性が低下する問題を実感</li></ul><p><strong>コード例1</strong>: カード有効期限チェックと金額上限チェックの基本実装
<strong>コード例2</strong>: ブラックリスト、残高確認を追加してネストが深くなる問題</p><h4 id=第2回審査ロジックをチェッカーに分離する>第2回：審査ロジックをチェッカーに分離する</h4><p><strong>ストーリー</strong>:</p><p>第1回の複雑なif文をリファクタリング。各審査ロジックを独立した「チェッカー」クラスに分離し、チェーン構造で連結する。Chain of Responsibilityパターンの基本を学ぶ。</p><p><strong>学習目標</strong>:</p><ul><li>Chain of Responsibilityパターンの構造を理解</li><li>Mooで基底クラスと具象ハンドラを実装</li></ul><p><strong>コード例1</strong>: <code>PaymentChecker</code>基底クラス（<code>next_handler</code>属性と<code>check</code>メソッド）
<strong>コード例2</strong>: <code>ExpiryChecker</code>と<code>LimitChecker</code>の具体的な実装</p><h4 id=第3回拡張可能な決済審査システムを完成させる>第3回：拡張可能な決済審査システムを完成させる</h4><p><strong>ストーリー</strong>:</p><p>実用的な決済審査システムを完成。新しいチェッカーの追加方法、結果オブジェクトの設計、チェーンの動的構築を学ぶ。架空のECサイト決済フローを完成させる。</p><p><strong>学習目標</strong>:</p><ul><li>パターンの拡張性を実感（新しいチェッカーを追加）</li><li>完成したシステムの全体像を理解</li></ul><p><strong>コード例1</strong>: <code>BlacklistChecker</code>と<code>BalanceChecker</code>の追加
<strong>コード例2</strong>: 完成版スクリプト（架空EC決済審査システム）</p><hr><h2 id=6-技術的詳細>6. 技術的詳細</h2><h3 id=61-perlmooでの実装イメージ>6.1 Perl/Mooでの実装イメージ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 基底チェッカークラスのイメージ</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>PaymentChecker</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=s>&#39;signatures&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=s>&#39;experimental::signatures&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>next_handler</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>check</span> <span class=p>($self, $request) {</span>
</span></span><span class=line><span class=cl>    <span class=c1># サブクラスで実装</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>pass_to_next</span> <span class=p>($self, $request) {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>next_handler</span>
</span></span><span class=line><span class=cl>        <span class=p>?</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>next_handler</span><span class=o>-&gt;</span><span class=n>check</span><span class=p>(</span><span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>:</span> <span class=p>{</span> <span class=n>ok</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span> <span class=n>message</span> <span class=o>=&gt;</span> <span class=s>&#39;承認&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 有効期限チェッカーのイメージ</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>ExpiryChecker</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>feature</span> <span class=s>&#39;signatures&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>no</span> <span class=nn>warnings</span> <span class=s>&#39;experimental::signatures&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>extends</span> <span class=s>&#39;PaymentChecker&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>check</span> <span class=p>($self, $request) {</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$exp_month</span><span class=p>,</span> <span class=nv>$exp_year</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@</span><span class=p>{</span><span class=nv>$request</span><span class=p>}{</span><span class=sx>qw(exp_month exp_year)</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 有効期限チェック（簡略化）</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>@now</span> <span class=o>=</span> <span class=nb>localtime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$current_year</span> <span class=o>=</span> <span class=nv>$now</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1900</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$current_month</span> <span class=o>=</span> <span class=nv>$now</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$exp_year</span> <span class=o>&lt;</span> <span class=nv>$current_year</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$exp_year</span> <span class=o>==</span> <span class=nv>$current_year</span> <span class=o>&amp;&amp;</span> <span class=nv>$exp_month</span> <span class=o>&lt;</span> <span class=nv>$current_month</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span> <span class=n>ok</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=n>error_code</span> <span class=o>=&gt;</span> <span class=s>&#39;EXPIRED&#39;</span><span class=p>,</span> <span class=n>message</span> <span class=o>=&gt;</span> <span class=s>&#39;有効期限切れ&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=n>pass_to_next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>信頼度</strong>: 高（著者による設計）</p><hr><h3 id=62-決済リクエストオブジェクトの設計>6.2 決済リクエストオブジェクトの設計</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># 決済リクエストのイメージ</span>
</span></span><span class=line><span class=cl><span class=c1># 注意: 4111111111111111 は Visa のテストカード番号です</span>
</span></span><span class=line><span class=cl><span class=c1># 実際のカード番号ではありません（学習用サンプル）</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$request</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>card_number</span> <span class=o>=&gt;</span> <span class=s>&#39;4111111111111111&#39;</span><span class=p>,</span>  <span class=c1># Visa テストカード番号</span>
</span></span><span class=line><span class=cl>    <span class=n>exp_month</span>   <span class=o>=&gt;</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>exp_year</span>    <span class=o>=&gt;</span> <span class=mi>2028</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>cvv</span>         <span class=o>=&gt;</span> <span class=s>&#39;123&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span>      <span class=o>=&gt;</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span> <span class=o>=&gt;</span> <span class=s>&#39;CUST001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>信頼度</strong>: 高（著者による設計）</p><hr><h2 id=7-リスクと対策>7. リスクと対策</h2><h3 id=71-想定されるリスク>7.1 想定されるリスク</h3><div class=table-wrapper><table><thead><tr><th>リスク</th><th>対策</th></tr></thead><tbody><tr><td>決済ドメインが初心者に難しい</td><td>架空のECサイトとして簡略化、実際のカード会社APIは使用しない</td></tr><tr><td>セキュリティへの誤解</td><td>「学習用の架空システム」であることを明記、実運用には使用しないよう注意喚起</td></tr><tr><td>コード例が複雑化</td><td>1記事2コード例の制約を厳守、段階的に機能を追加</td></tr><tr><td>既存シリーズとの重複感</td><td>ドメインの違い（決済 vs フォーム検証 vs ログ監視）を冒頭で明確化</td></tr></tbody></table></div><hr><h2 id=8-推奨タグ>8. 推奨タグ</h2><h3 id=シリーズ全体>シリーズ全体</h3><ul><li><code>chain-of-responsibility</code></li><li><code>design-patterns</code></li><li><code>perl</code></li><li><code>moo</code></li><li><code>payment-processing</code></li><li><code>e-commerce</code></li><li><code>oop</code></li></ul><h3 id=各回固有>各回固有</h3><div class=table-wrapper><table><thead><tr><th>回</th><th>追加タグ</th></tr></thead><tbody><tr><td>第1回</td><td><code>credit-card</code>, <code>validation</code>, <code>code-smell</code>, <code>nested-conditionals</code></td></tr><tr><td>第2回</td><td><code>handler-pattern</code>, <code>refactoring</code>, <code>single-responsibility</code></td></tr><tr><td>第3回</td><td><code>extensibility</code>, <code>open-closed-principle</code>, <code>best-practices</code></td></tr></tbody></table></div><hr><h2 id=9-結論>9. 結論</h2><h3 id=最終推薦>最終推薦</h3><p>「クレジットカード決済の多段審査処理」は、Chain of Responsibilityパターンを学ぶ題材として以下の理由で最適である：</p><ol><li><strong>既存シリーズとの明確な差別化</strong>: Eコマース・金融ドメインは、フォーム検証（Web開発）やログ監視（インフラ）とは異なる領域</li><li><strong>実践的なドメイン</strong>: ECサイトでの買い物経験がある読者には身近なテーマ</li><li><strong>パターンとの高い適合性</strong>: 多段階審査はChain of Responsibilityの典型的なユースケース</li><li><strong>日本語Perl記事としての希少性</strong>: 競合がほぼ存在しない</li><li><strong>段階的学習が可能</strong>: 問題体験→パターン適用→拡張という流れで学習効果が高い</li></ol><h3 id=次のステップ>次のステップ</h3><ol><li>本調査ドキュメントに基づき連載構造案を作成</li><li>各回のアウトラインを詳細化</li><li>第1回の記事執筆を開始</li></ol><hr><p><strong>調査完了日</strong>: 2026年1月8日
<strong>調査者</strong>: 調査・情報収集専門家
<strong>次のステップ</strong>: 連載構造案の作成（<code>agents/structure/credit-card-payment-series-structure.md</code>）</p></section><footer class=article-footer><section class=article-tags><a href=/tags/chain-of-responsibility/>Chain-of-Responsibility</a>
<a href=/tags/design-patterns/>Design-Patterns</a>
<a href=/tags/perl/>Perl</a>
<a href=/tags/moo/>Moo</a>
<a href=/tags/payment-processing/>Payment-Processing</a>
<a href=/tags/e-commerce/>E-Commerce</a>
<a href=/tags/research/>Research</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/2026/01/10/221432/><div class=article-image><img src=/public_images/2026/payment-verification-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/payment-verification-series-image.jpg></div><div class=article-details><h2 class=article-title>【目次】架空ECサイトで学ぶ決済審査システム（全3回）</h2></div></a></article><article class=has-image><a href=/warehouse/chain-of-responsibility-alternative-themes/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>調査ドキュメント - Chain of Responsibilityパターン代替テーマ調査</h2></div></a></article><article class=has-image><a href=/2026/01/10/221229/><div class=article-image><img src=/public_images/2026/payment-verification-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/payment-verification-series-image.jpg></div><div class=article-details><h2 class=article-title>第3回-審査ロジックをチェッカーに分離する</h2></div></a></article><article class=has-image><a href=/2026/01/10/220823/><div class=article-image><img src=/public_images/2026/payment-verification-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/payment-verification-series-image.jpg></div><div class=article-details><h2 class=article-title>第1回-架空ECサイトの決済審査を作ってみる</h2></div></a></article><article class=has-image><a href=/2026/01/09/100200/><div class=article-image><img src=/public_images/2026/chain-of-responsibility-pattern-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/chain-of-responsibility-pattern-series-image.jpg></div><div class=article-details><h2 class=article-title>第3回-【Perl/Moo】バリデータをチェーンで連携 - Chain of Responsibilityパターン入門</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//nqounet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2000 -
2026 デザインパターンの名前は嘘をつく</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>