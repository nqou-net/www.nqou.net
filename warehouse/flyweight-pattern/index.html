<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Flyweightパターン（GoFデザインパターン）に関する調査結果"><title>Flyweightパターン調査ドキュメント</title><link rel=canonical href=https://www.nqou.net/warehouse/flyweight-pattern/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Flyweightパターン調査ドキュメント"><meta property='og:description' content="Flyweightパターン（GoFデザインパターン）に関する調査結果"><meta property='og:url' content='https://www.nqou.net/warehouse/flyweight-pattern/'><meta property='og:site_name' content='設計パターンを疑え'><meta property='og:type' content='article'><meta property='article:section' content='Warehouse'><meta property='article:tag' content='design-patterns'><meta property='article:tag' content='flyweight'><meta property='article:tag' content='structural-patterns'><meta property='article:tag' content='perl'><meta property='article:tag' content='moo'><meta property='article:published_time' content='2026-01-20T14:14:00+09:00'><meta property='article:modified_time' content='2026-01-20T14:14:00+09:00'><meta property='og:image' content='https://www.nqou.net/favicon.png'><meta name=twitter:title content="Flyweightパターン調査ドキュメント"><meta name=twitter:description content="Flyweightパターン（GoFデザインパターン）に関する調査結果"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nqou.net/favicon.png'><link rel="shortcut icon" href=/favicon.png><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap';:root{--base-font-family:Arial, "Noto Sans JP", sans-serif}</style><link rel=stylesheet href=/css/linkcard.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3923446804785015" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js defer></script><script defer>document.addEventListener("DOMContentLoaded",function(){try{typeof mermaid!="undefined"&&document.querySelector(".mermaid")&&mermaid.initialize({startOnLoad:!0,securityLevel:"strict"})}catch(e){console.warn("Mermaid failed to initialize:",e)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-E50H9ESN7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E50H9ESN7E")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/public_images/blog-nqounet-square.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>設計パターンを疑え</a></h1><h2 class=site-description>名前の嘘を暴き、意図で設計を語る</h2></div></header><ol class=menu-social><li><a href=https://github.com/nqounet target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/nqounet target=_blank title=X rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/advent-calendar-2025/><svg class="icon icon-tabler icon-tabler-calendar" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><path d="M8 15h.01"/><path d="M12 15h.01"/><path d="M16 15h.01"/><path d="M8 19h.01"/><path d="M12 19h.01"/><path d="M16 19h.01"/></svg>
<span>Perl Advent Calendar 2025 - AI Edition</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/warehouse/><svg class="icon icon-tabler icon-tabler-warehouse" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#bababa" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l9-6 9 6"/><rect x="5" y="10" width="14" height="10" rx="2"/><rect x="10" y="14" width="4" height="6" rx="1"/><path d="M7 20v-4h2v4"/><path d="M15 20v-4h2v4"/></svg>
<span>Warehouse</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目次</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#調査概要>調査概要</a></li><li><a href=#1-flyweightパターンの基礎>1. Flyweightパターンの基礎</a><ol><li><a href=#11-定義と目的>1.1 定義と目的</a></li><li><a href=#12-gofパターンにおける位置づけ>1.2 GoFパターンにおける位置づけ</a></li><li><a href=#13-パターンの本質内部状態-vs-外部状態>1.3 パターンの本質（内部状態 vs 外部状態）</a></li></ol></li><li><a href=#2-flyweightパターンの構造>2. Flyweightパターンの構造</a><ol><li><a href=#21-uml図mermaid形式>2.1 UML図（Mermaid形式）</a></li><li><a href=#22-構成要素の説明>2.2 構成要素の説明</a></li></ol></li><li><a href=#3-flyweightパターンの適用場面>3. Flyweightパターンの適用場面</a><ol><li><a href=#31-どのような問題を解決するか>3.1 どのような問題を解決するか</a></li><li><a href=#32-典型的なユースケース>3.2 典型的なユースケース</a></li><li><a href=#33-他の構造パターンとの比較>3.3 他の構造パターンとの比較</a></li></ol></li><li><a href=#4-メリットデメリット>4. メリット・デメリット</a><ol><li><a href=#41-メリット>4.1 メリット</a></li><li><a href=#42-デメリット>4.2 デメリット</a></li><li><a href=#43-いつ使うべきか使うべきでないか>4.3 いつ使うべきか/使うべきでないか</a></li></ol></li><li><a href=#5-perlでの実装方法>5. Perlでの実装方法</a><ol><li><a href=#51-mooを使ったflyweightfactoryの実装>5.1 Mooを使ったFlyweightFactoryの実装</a></li><li><a href=#52-state変数やクラス変数でのオブジェクトプール管理>5.2 state変数やクラス変数でのオブジェクトプール管理</a></li><li><a href=#53-弱い参照scalarutilweakenの活用>5.3 弱い参照（Scalar::Util::weaken）の活用</a></li><li><a href=#54-cpanモジュールでflyweightパターンを実装しているもの>5.4 CPANモジュールでFlyweightパターンを実装しているもの</a></li></ol></li><li><a href=#6-既存シリーズとの重複チェック>6. 既存シリーズとの重複チェック</a><ol><li><a href=#61-既存記事の調査結果>6.1 既存記事の調査結果</a></li><li><a href=#62-他のデザインパターンシリーズとの差別化ポイント>6.2 他のデザインパターンシリーズとの差別化ポイント</a></li></ol></li><li><a href=#7-競合分析>7. 競合分析</a><ol><li><a href=#71-既存チュートリアルの調査>7.1 既存チュートリアルの調査</a></li></ol></li><li><a href=#8-内部リンク候補>8. 内部リンク候補</a><ol><li><a href=#81-mooで覚えるオブジェクト指向プログラミングシリーズの関連回>8.1 「Mooで覚えるオブジェクト指向プログラミング」シリーズの関連回</a></li><li><a href=#82-他のデザインパターン調査ドキュメント>8.2 他のデザインパターン調査ドキュメント</a></li></ol></li><li><a href=#9-参考文献リソースリスト>9. 参考文献・リソースリスト</a><ol><li><a href=#91-必読リソース書籍>9.1 必読リソース（書籍）</a></li><li><a href=#92-必読リソースweb>9.2 必読リソース（Web）</a></li><li><a href=#93-補足リソース>9.3 補足リソース</a></li></ol></li><li><a href=#10-まとめと今後の展開>10. まとめと今後の展開</a><ol><li><a href=#101-調査のまとめ>10.1 調査のまとめ</a></li><li><a href=#102-記事作成の方向性>10.2 記事作成の方向性</a></li><li><a href=#103-今後の課題>10.3 今後の課題</a></li></ol></li><li><a href=#調査完了>調査完了</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/warehouse/flyweight-pattern/><img src=/favicon.png loading=lazy alt="Featured image of post Flyweightパターン調査ドキュメント"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/warehouse/flyweight-pattern/>Flyweightパターン調査ドキュメント</a></h2><h3 class=article-subtitle>Flyweightパターン（GoFデザインパターン）に関する調査結果</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>1月 20, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>読了時間: 25分</time></div></footer></div></header><section class=article-content><h1 id=flyweightパターン調査ドキュメント>Flyweightパターン調査ドキュメント</h1><h2 id=調査概要>調査概要</h2><ul><li><strong>調査目的</strong>: 「Mooで覚えるオブジェクト指向プログラミング」シリーズを読了した読者が、Flyweightパターンを自然に学べる教材作成のための基礎資料</li><li><strong>調査実施日</strong>: 2026年1月21日</li><li><strong>技術スタック</strong>: Perl v5.36以降 / Moo / Scalar::Util</li><li><strong>想定読者</strong>: オブジェクト指向の基礎が理解できている読者</li><li><strong>難易度評価</strong>: 3.5/5（内部状態と外部状態の分離、オブジェクトプール管理が必要）</li><li><strong>前提知識</strong>: 「Mooで覚えるオブジェクト指向プログラミング」シリーズ（全12回）の基本理解済み</li></ul><hr><h2 id=1-flyweightパターンの基礎>1. Flyweightパターンの基礎</h2><h3 id=11-定義と目的>1.1 定義と目的</h3><p><strong>要点</strong>:</p><ul><li>Flyweightパターンは、GoF（Gang of Four）の**構造パターン（Structural Patterns）**の1つ</li><li><strong>「共有を利用して、大量の細粒度オブジェクトを効率的にサポートする」</strong></li><li>多数の類似オブジェクトが必要な場合に、共通する部分（内部状態）を共有し、メモリ使用量を削減する</li><li>オブジェクト生成コストが高い場合や、メモリに制約がある環境で特に有効</li></ul><p><strong>GoF原典での定義</strong>:</p><blockquote><p>&ldquo;Use sharing to support large numbers of fine-grained objects efficiently.&rdquo;</p><p>「共有を利用して、大量の細粒度オブジェクトを効率的にサポートする」</p></blockquote><p><strong>パターンの本質</strong>:</p><ul><li><strong>内部状態（Intrinsic State）と外部状態（Extrinsic State）の分離</strong>が核心概念</li><li>共有可能な状態（内部状態）はFlyweightオブジェクト内に保持し、複数のコンテキストで再利用</li><li>コンテキスト依存の状態（外部状態）はクライアント側で管理し、操作時に渡す</li><li>FlyweightFactoryがオブジェクトプールを管理し、同じ内部状態のオブジェクトを再利用</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF書籍「Design Patterns: Elements of Reusable Object-Oriented Software」（1994年）で定義</li><li>Refactoring Guru、GeeksforGeeks、Wikipedia等の主要技術サイトで一致した説明</li><li>Java String Pool、ゲームエンジン、テキストエディタなど多数の実装例</li></ul><p><strong>仮定</strong>:</p><ul><li>読者は「Mooで覚えるオブジェクト指向プログラミング」シリーズでクラス、属性、メソッドの基礎を学んでいる</li><li>Prototypeパターンとの違い（共有 vs コピー）を理解する必要がある</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Flyweight pattern - <a class=link href=https://en.wikipedia.org/wiki/Flyweight_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Flyweight_pattern</a></li><li>Refactoring Guru: Flyweight - <a class=link href=https://refactoring.guru/design-patterns/flyweight target=_blank rel=noopener>https://refactoring.guru/design-patterns/flyweight</a></li><li>GeeksforGeeks: Flyweight Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></li><li>SpotADev: Flyweight Pattern - <a class=link href=https://www.spotadev.com/home/java/design-patterns/gang-of-four/flyweight target=_blank rel=noopener>https://www.spotadev.com/home/java/design-patterns/gang-of-four/flyweight</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および複数の信頼できる技術サイト）</p><hr><h3 id=12-gofパターンにおける位置づけ>1.2 GoFパターンにおける位置づけ</h3><p><strong>要点</strong>:</p><p>Flyweightは、GoFの23パターンのうち<strong>構造パターン（Structural Patterns）7種類</strong>の1つです。</p><div class=table-wrapper><table><thead><tr><th>パターン名</th><th>概要</th></tr></thead><tbody><tr><td><strong>Adapter</strong></td><td>互換性のないインターフェースを持つクラスを、クライアントが期待するインターフェースに変換</td></tr><tr><td><strong>Bridge</strong></td><td>抽象部分と実装部分を分離し、それぞれが独立して変更可能にする</td></tr><tr><td><strong>Composite</strong></td><td>オブジェクトをツリー構造に組み立て、個別オブジェクトと複合オブジェクトを同一視</td></tr><tr><td><strong>Decorator</strong></td><td>オブジェクトに動的に責任を追加し、サブクラス化の代替手段を提供</td></tr><tr><td><strong>Facade</strong></td><td>サブシステムの複雑なインターフェース群に対して、統一された簡素なインターフェースを提供</td></tr><tr><td><strong>Flyweight</strong></td><td>多数の細粒度オブジェクトを効率的にサポートするため、オブジェクトを共有 ⭐</td></tr><tr><td><strong>Proxy</strong></td><td>他のオブジェクトへのアクセスを制御する代理オブジェクトを提供</td></tr></tbody></table></div><p><strong>構造パターンの中での特徴</strong>:</p><div class=table-wrapper><table><thead><tr><th>比較軸</th><th>Flyweight</th><th>他の構造パターン</th></tr></thead><tbody><tr><td><strong>主目的</strong></td><td>メモリ効率化（リソース最適化）</td><td>インターフェース変換、組み立て、アクセス制御</td></tr><tr><td><strong>焦点</strong></td><td>オブジェクトの共有</td><td>オブジェクトの組み合わせ方</td></tr><tr><td><strong>状態管理</strong></td><td>内部状態と外部状態を分離</td><td>通常は分離しない</td></tr><tr><td><strong>適用場面</strong></td><td>大量の類似オブジェクト</td><td>構造の柔軟性、簡素化</td></tr></tbody></table></div><p><strong>Flyweightの独自性</strong>:</p><ul><li>他の構造パターンが「オブジェクトの組み立て方」に焦点を当てるのに対し、Flyweightは**「オブジェクトの共有とリソース効率」**に特化</li><li>パフォーマンス最適化が主目的の唯一の構造パターン</li><li>組み込みシステム、ゲーム開発、大規模ドキュメント処理など、メモリ制約がある環境で活躍</li></ul><p><strong>根拠</strong>:</p><ul><li>GoFの分類体系で明確に定義されている</li><li>構造パターンはクラスやオブジェクトを組み合わせて、より大きな構造を形成するパターン</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Structural Design Patterns - <a class=link href=https://www.geeksforgeeks.org/system-design/structural-design-patterns/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/structural-design-patterns/</a></li><li>Wikipedia: Design Patterns - <a class=link href=https://en.wikipedia.org/wiki/Design_Patterns target=_blank rel=noopener>https://en.wikipedia.org/wiki/Design_Patterns</a></li><li>Stony Brook University: Structural Design Patterns (PDF) - <a class=link href=https://www3.cs.stonybrook.edu/~pfodor/courses/CSE316/L23_StructuralDesignPatterns.pdf target=_blank rel=noopener>https://www3.cs.stonybrook.edu/~pfodor/courses/CSE316/L23_StructuralDesignPatterns.pdf</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および学術資料）</p><hr><h3 id=13-パターンの本質内部状態-vs-外部状態>1.3 パターンの本質（内部状態 vs 外部状態）</h3><p><strong>要点</strong>:</p><p>Flyweightパターンの核心は、<strong>内部状態（Intrinsic State）と外部状態（Extrinsic State）の分離</strong>です。</p><div class=table-wrapper><table><thead><tr><th>項目</th><th>内部状態（Intrinsic State）</th><th>外部状態（Extrinsic State）</th></tr></thead><tbody><tr><td><strong>定義</strong></td><td>複数オブジェクト間で共有される状態</td><td>各オブジェクト使用時に固有の状態</td></tr><tr><td><strong>保存場所</strong></td><td>Flyweightオブジェクト内部</td><td>クライアント側で管理</td></tr><tr><td><strong>共有</strong></td><td>Yes（共有される）</td><td>No（個別に保持）</td></tr><tr><td><strong>不変性</strong></td><td>不変（Immutable）</td><td>可変（Context-dependent）</td></tr><tr><td><strong>例（テキストエディタ）</strong></td><td>文字の形状、フォント種類</td><td>画面上の位置（X, Y座標）</td></tr><tr><td><strong>例（ゲーム）</strong></td><td>敵の種類、テクスチャ、色</td><td>各敵の位置、HP、状態</td></tr><tr><td><strong>例（地図アプリ）</strong></td><td>マーカーアイコン画像</td><td>緯度、経度、ラベル</td></tr></tbody></table></div><p><strong>メモリ効率化の原理</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>従来の方法:
</span></span><span class=line><span class=cl>N個のオブジェクト × (共有可能データ + 固有データ) = 大量メモリ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Flyweightパターン:
</span></span><span class=line><span class=cl>M個の共有オブジェクト × 共有可能データ + N個 × 固有データ = 削減メモリ
</span></span><span class=line><span class=cl>（ただし M &lt;&lt; N）
</span></span></code></pre></td></tr></table></div></div><p><strong>具体例</strong>（10,000本の木を描画する場合）:</p><ul><li><strong>従来</strong>: 10,000個の木オブジェクト × （3Dモデルデータ + 位置データ）</li><li><strong>Flyweight</strong>: 5種類の木オブジェクト × 3Dモデルデータ + 10,000個の位置データ</li><li><strong>削減効果</strong>: 3Dモデルデータが1/2000に削減（共有される部分が大きいほど効果的）</li></ul><p><strong>実装のポイント</strong>:</p><ol><li><strong>内部状態の不変性</strong>: 共有されるため、変更不可（Immutable）であることが重要</li><li><strong>外部状態の明示的な受け渡し</strong>: 操作メソッドの引数として渡す</li><li><strong>FlyweightFactoryによる管理</strong>: オブジェクトプールで再利用を保証</li></ol><p><strong>根拠</strong>:</p><ul><li>GoF原典で明確に定義された概念</li><li>複数の技術サイトで一貫した説明</li><li>Java String Pool、Unity ゲームエンジンなど実装例多数</li></ul><p><strong>出典</strong>:</p><ul><li>Refactoring Guru: Flyweight - <a class=link href=https://refactoring.guru/design-patterns/flyweight target=_blank rel=noopener>https://refactoring.guru/design-patterns/flyweight</a></li><li>Software Patterns Lexicon: Intrinsic vs Extrinsic State - <a class=link href=https://softwarepatternslexicon.com/java/structural-patterns/flyweight-pattern/intrinsic-vs-extrinsic-state/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/structural-patterns/flyweight-pattern/intrinsic-vs-extrinsic-state/</a></li><li>The Linux Code: Flyweight Pattern in Practice - <a class=link href=https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/ target=_blank rel=noopener>https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および複数の技術資料）</p><hr><h2 id=2-flyweightパターンの構造>2. Flyweightパターンの構造</h2><h3 id=21-uml図mermaid形式>2.1 UML図（Mermaid形式）</h3><p><strong>GoF原典に基づく標準構造</strong>:</p><pre class=mermaid>
	classDiagram
    class Flyweight {
        &lt;&lt;interface&gt;&gt;
        +operation(extrinsicState)
    }
    
    class ConcreteFlyweight {
        -intrinsicState
        +operation(extrinsicState)
    }
    
    class UnsharedConcreteFlyweight {
        -allState
        +operation(extrinsicState)
    }
    
    class FlyweightFactory {
        -flyweights : Map~Key, Flyweight~
        +getFlyweight(key) : Flyweight
    }
    
    class Client {
        -extrinsicState
        +operation()
    }
    
    Flyweight &lt;|.. ConcreteFlyweight
    Flyweight &lt;|.. UnsharedConcreteFlyweight
    FlyweightFactory --&gt; Flyweight : creates/manages
    Client --&gt; Flyweight : uses
    Client --&gt; FlyweightFactory : requests
</pre><p><strong>コラボレーション図</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Client
</span></span><span class=line><span class=cl>  │
</span></span><span class=line><span class=cl>  ├──&gt; FlyweightFactory
</span></span><span class=line><span class=cl>  │         │
</span></span><span class=line><span class=cl>  │         └──&gt; Flyweight (生成・管理・再利用)
</span></span><span class=line><span class=cl>  │
</span></span><span class=line><span class=cl>  └──&gt; Flyweight.operation(extrinsicState)
</span></span><span class=line><span class=cl>           ↑
</span></span><span class=line><span class=cl>           │
</span></span><span class=line><span class=cl>           ├── ConcreteFlyweight (共有可能、内部状態を保持)
</span></span><span class=line><span class=cl>           └── UnsharedConcreteFlyweight (共有不可、すべての状態を保持)
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>GoF原典のFlyweightパターンの構造図に準拠</li><li>主要な技術サイト（Refactoring Guru、GeeksforGeeks）でも同様の構造</li></ul><p><strong>出典</strong>:</p><ul><li>Wikipedia: Flyweight pattern - <a class=link href=https://en.wikipedia.org/wiki/Flyweight_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Flyweight_pattern</a></li><li>Visual Paradigm: Flyweight Pattern Template - <a class=link href=https://circle.visual-paradigm.com/flyweight/ target=_blank rel=noopener>https://circle.visual-paradigm.com/flyweight/</a></li><li>University of Minnesota Duluth: Flyweight Pattern - <a class=link href=https://www.d.umn.edu/~gshute/cs5741/patterns/flyweight.xhtml target=_blank rel=noopener>https://www.d.umn.edu/~gshute/cs5741/patterns/flyweight.xhtml</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典準拠）</p><hr><h3 id=22-構成要素の説明>2.2 構成要素の説明</h3><div class=table-wrapper><table><thead><tr><th>構成要素</th><th>役割</th><th>責務</th></tr></thead><tbody><tr><td><strong>Flyweight</strong></td><td>抽象インターフェース</td><td>Flyweightオブジェクトが外部状態を受け取り、操作するためのインターフェースを宣言</td></tr><tr><td><strong>ConcreteFlyweight</strong></td><td>具象フライウェイト</td><td>Flyweightインターフェースを実装し、**内部状態（intrinsic state）**を保持。共有可能で、コンテキストから独立</td></tr><tr><td><strong>UnsharedConcreteFlyweight</strong></td><td>共有されない具象フライウェイト</td><td>Flyweightインターフェースを実装するが、<strong>共有されない</strong>。他のFlyweightへの参照を持つことができる（オプショナル）</td></tr><tr><td><strong>FlyweightFactory</strong></td><td>ファクトリ</td><td>Flyweightオブジェクトの生成と管理を担当。既存のFlyweightがあれば返却し、なければ新規作成して共有を実現</td></tr><tr><td><strong>Client</strong></td><td>クライアント</td><td>Flyweightへの参照を保持し、**外部状態（extrinsic state）**を計算・保存。Flyweightの操作を呼び出す際に外部状態を渡す</td></tr></tbody></table></div><p><strong>各要素の詳細</strong>:</p><p><strong>Flyweight（抽象インターフェース）</strong>:</p><ul><li>メソッド例: <code>operation(extrinsicState)</code></li><li>PerlではMoo::Roleで実装可能（インターフェース的な使い方）</li></ul><p><strong>ConcreteFlyweight（具象フライウェイト）</strong>:</p><ul><li>内部状態を属性として保持（<code>has intrinsic_state => (is => 'ro');</code>）</li><li>内部状態は不変（<code>ro</code>）であることが重要</li><li>FlyweightFactoryによって管理・共有される</li></ul><p><strong>UnsharedConcreteFlyweight（共有されない具象フライウェイト）</strong>:</p><ul><li>共有が適さない場合に使用（例：複合オブジェクトの一部）</li><li>すべての状態を保持するため、通常のオブジェクトと同様</li><li>必須ではなく、必要に応じて実装</li></ul><p><strong>FlyweightFactory（ファクトリ）</strong>:</p><ul><li>オブジェクトプール（通常はHashRef）を保持</li><li><code>getFlyweight(key)</code>メソッドでキーに基づいて既存オブジェクトを返すか、新規作成</li><li>Perlでは<code>state</code>変数やクラス変数でプールを管理</li></ul><p><strong>Client（クライアント）</strong>:</p><ul><li>外部状態を管理（例：位置情報、HP、個別設定）</li><li>FlyweightFactoryからFlyweightを取得</li><li>操作時に外部状態を渡す（<code>$flyweight->operation($extrinsic_state)</code>）</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF原典の参加者（Participants）セクションで定義</li><li>各要素の役割と責務が明確に区分されている</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Flyweight Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></li><li>Refactoring Guru: Flyweight - <a class=link href=https://refactoring.guru/design-patterns/flyweight target=_blank rel=noopener>https://refactoring.guru/design-patterns/flyweight</a></li><li>DoFactory: Flyweight Design Pattern - <a class=link href=https://dofactory.com/net/flyweight-design-pattern target=_blank rel=noopener>https://dofactory.com/net/flyweight-design-pattern</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および複数の技術資料）</p><hr><h2 id=3-flyweightパターンの適用場面>3. Flyweightパターンの適用場面</h2><h3 id=31-どのような問題を解決するか>3.1 どのような問題を解決するか</h3><p><strong>要点</strong>:</p><p>Flyweightパターンは、以下のような問題を解決します：</p><ol><li><p><strong>大量のオブジェクトによるメモリ枯渇</strong></p><ul><li>数千〜数百万の類似オブジェクトが必要な場合</li><li>各オブジェクトが重複データを持つことによるメモリの無駄</li></ul></li><li><p><strong>オブジェクト生成コストの高さ</strong></p><ul><li>生成に時間がかかるオブジェクト（データベース接続、画像読み込みなど）</li><li>同じオブジェクトを何度も生成する非効率性</li></ul></li><li><p><strong>リソース制約のある環境</strong></p><ul><li>組み込みシステム、モバイルアプリ、ゲーム開発</li><li>メモリやCPUに制約がある環境での最適化</li></ul></li></ol><p><strong>解決方法</strong>:</p><ul><li>共通する部分（内部状態）を共有し、差異部分（外部状態）のみを個別管理</li><li>FlyweightFactoryによるオブジェクトプールで再利用を実現</li><li>メモリ使用量を劇的に削減（場合によっては90%以上）</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF原典の「Motivation」セクションで詳述</li><li>実世界の多数の実装例（Java String Pool、Unity ゲームエンジンなど）</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Flyweight Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></li><li>The Linux Code: Flyweight Pattern in Practice - <a class=link href=https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/ target=_blank rel=noopener>https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および実装例多数）</p><hr><h3 id=32-典型的なユースケース>3.2 典型的なユースケース</h3><p><strong>1. テキストエディタでの文字オブジェクト</strong></p><p><strong>概要</strong>:</p><ul><li>大規模ドキュメントで数百万の文字を扱う</li><li>各文字を個別のオブジェクトとして管理するのは非効率</li></ul><p><strong>Flyweightアプローチ</strong>:</p><ul><li><strong>内部状態</strong>: 文字記号(&lsquo;a&rsquo;, &lsquo;b&rsquo;等)、フォント、スタイル → 共有</li><li><strong>外部状態</strong>: ドキュメント内の位置、個別フォーマット → クライアント側で管理</li></ul><p><strong>効果</strong>:</p><ul><li>Times New Roman 12ptの&rsquo;a&rsquo;を1つのFlyweightオブジェクトとして作成し、全ての該当文字で再利用</li><li>メモリ使用量が劇的に削減</li></ul><hr><p><strong>2. ゲーム開発での大量オブジェクト管理</strong></p><p><strong>概要</strong>:</p><ul><li>オープンワールドゲームで数千の木、岩、敵キャラクターなどの反復オブジェクトを効率管理</li></ul><p><strong>Flyweightアプローチ</strong>:</p><ul><li><strong>内部状態</strong>: 3Dモデル、テクスチャ、基本動作 → 共有</li><li><strong>外部状態</strong>: ワールド座標、体力、アニメーション状態 → インスタンス毎</li></ul><p><strong>効果</strong>:</p><ul><li>特定樹種の3Dモデルを1つだけメモリに保持し、マップ上の全ての木はそれを参照+位置情報のみで実現</li><li>パフォーマンスとスケーラビリティが大幅向上</li></ul><hr><p><strong>3. GUIライブラリでのウィジェット管理</strong></p><p><strong>概要</strong>:</p><ul><li>数千のマップマーカーやUIアイコンを効率的にレンダリング</li></ul><p><strong>Flyweightアプローチ</strong>:</p><ul><li><strong>内部状態</strong>: アイコンイメージ、スタイル、ツールチップフォーマット → 共有</li><li><strong>外部状態</strong>: 緯度経度、クリックイベントハンドラ → 個別管理</li></ul><hr><p><strong>4. データベース接続プール</strong></p><p><strong>概要</strong>:</p><ul><li>データベース接続の生成・破棄はコストが高い</li><li>複数のスレッドやリクエストで接続を再利用</li></ul><p><strong>Flyweightアプローチ</strong>:</p><ul><li><strong>内部状態</strong>: 接続設定（ホスト、ポート、認証情報） → 共有</li><li><strong>外部状態</strong>: トランザクション状態、現在のSQL → 個別管理</li></ul><hr><p><strong>実世界の実装例</strong>:</p><ul><li><strong>Java String Pool</strong>: 文字列リテラルに対してFlyweightパターンを採用</li><li><strong>Unity ゲームエンジン</strong>: パーティクルシステム、敵キャラクター管理</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF原典のテキストエディタの例</li><li>複数の技術サイトで一貫したユースケース</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Flyweight Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></li><li>MomentsLog: Flyweight Pattern in Text Editors - <a class=link href=https://www.momentslog.com/development/design-pattern/flyweight-pattern-in-text-editors-efficient-character-representation-for-large-documents target=_blank rel=noopener>https://www.momentslog.com/development/design-pattern/flyweight-pattern-in-text-editors-efficient-character-representation-for-large-documents</a></li><li>Unity Learn: Flyweight Pattern - <a class=link href="https://learn.unity.com/course/design-patterns-unity-6/tutorial/flyweight-pattern?version=6.0" target=_blank rel=noopener>https://learn.unity.com/course/design-patterns-unity-6/tutorial/flyweight-pattern?version=6.0</a></li><li>Software Patterns Lexicon: Flyweight Use Cases - <a class=link href=https://softwarepatternslexicon.com/java/structural-patterns/flyweight-pattern/use-cases-and-examples/ target=_blank rel=noopener>https://softwarepatternslexicon.com/java/structural-patterns/flyweight-pattern/use-cases-and-examples/</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および実装例多数）</p><hr><h3 id=33-他の構造パターンとの比較>3.3 他の構造パターンとの比較</h3><p><strong>Singletonとの違い</strong>:</p><div class=table-wrapper><table><thead><tr><th>項目</th><th>Flyweight</th><th>Singleton</th></tr></thead><tbody><tr><td><strong>分類</strong></td><td>構造パターン</td><td>生成パターン</td></tr><tr><td><strong>目的</strong></td><td>メモリ効率化（状態共有）</td><td>唯一インスタンスの保証</td></tr><tr><td><strong>インスタンス数</strong></td><td>ユニークな状態毎に1つ（複数）</td><td>アプリケーション全体で1つのみ</td></tr><tr><td><strong>主要原則</strong></td><td><strong>共有</strong></td><td><strong>制限</strong></td></tr><tr><td><strong>適用例</strong></td><td>テキストエディタの文字フォーマット</td><td>ロガー、設定マネージャー</td></tr></tbody></table></div><p><strong>違いの本質</strong>:</p><ul><li>Singletonは「1インスタンスのみ」を保証</li><li>Flyweightは「ユニークな状態の組み合わせ毎に1インスタンス」を共有</li></ul><hr><p><strong>Prototypeとの違い</strong>:</p><div class=table-wrapper><table><thead><tr><th>項目</th><th>Flyweight</th><th>Prototype</th></tr></thead><tbody><tr><td><strong>分類</strong></td><td>構造パターン</td><td>生成パターン</td></tr><tr><td><strong>目的</strong></td><td>オブジェクトの共有</td><td>クローンによる効率的な生成</td></tr><tr><td><strong>生成方法</strong></td><td>共有インスタンスを返す</td><td>既存オブジェクトをコピー</td></tr><tr><td><strong>独立性</strong></td><td>共有（同じインスタンス）</td><td>独立（各クローンは別インスタンス）</td></tr><tr><td><strong>適用例</strong></td><td>文字の再利用</td><td>ドキュメントテンプレートのコピー</td></tr></tbody></table></div><p><strong>違いの本質</strong>:</p><ul><li>Prototypeは新しい独立したオブジェクトを作成（複製）</li><li>Flyweightは既存のオブジェクトを共有（再利用）</li></ul><hr><p><strong>Proxyとの違い</strong>:</p><div class=table-wrapper><table><thead><tr><th>項目</th><th>Flyweight</th><th>Proxy</th></tr></thead><tbody><tr><td><strong>目的</strong></td><td>メモリ効率のため状態を分離・共有</td><td>アクセス制御・拡張</td></tr><tr><td><strong>関係</strong></td><td>多対一（多数のコンテキストが1つの共有オブジェクトを使用）</td><td>一対一（Proxyと実オブジェクト）</td></tr><tr><td><strong>適用例</strong></td><td>画像データの共有</td><td>権限チェック後の保存処理</td></tr></tbody></table></div><p><strong>根拠</strong>:</p><ul><li>複数の技術サイトで比較が明確に説明されている</li><li>GoF原典でもSingletonとの違いが言及されている</li></ul><p><strong>出典</strong>:</p><ul><li>StackOverflow: Flyweight vs Singleton - <a class=link href=https://stackoverflow.com/questions/16750758/what-are-the-practical-use-differences-between-flyweight-vs-singleton-patterns target=_blank rel=noopener>https://stackoverflow.com/questions/16750758/what-are-the-practical-use-differences-between-flyweight-vs-singleton-patterns</a></li><li>GeeksforGeeks: Prototype vs Flyweight - <a class=link href=https://www.geeksforgeeks.org/system-design/difference-between-prototype-design-pattern-and-flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/difference-between-prototype-design-pattern-and-flyweight-design-pattern/</a></li><li>LMU Example Patterns: Flyweight vs Proxy - <a class=link href=https://cs.lmu.edu/~ray/notes/examplepatterns/ target=_blank rel=noopener>https://cs.lmu.edu/~ray/notes/examplepatterns/</a></li></ul><p><strong>信頼度</strong>: 8/10（複数の技術サイトで一貫した説明）</p><hr><h2 id=4-メリットデメリット>4. メリット・デメリット</h2><h3 id=41-メリット>4.1 メリット</h3><div class=table-wrapper><table><thead><tr><th>項目</th><th>詳細</th></tr></thead><tbody><tr><td><strong>メモリ効率</strong></td><td>内部状態共有により、重複データの大幅削減。大規模文書やゲームで顕著（90%以上削減可能）</td></tr><tr><td><strong>パフォーマンス向上</strong></td><td>オブジェクト生成コスト削減、GC圧力軽減、CPUキャッシュ効率向上</td></tr><tr><td><strong>リソース節約</strong></td><td>メモリだけでなく、ディスク・CPU等のリソースも節約可能</td></tr><tr><td><strong>スケーラビリティ</strong></td><td>大量のオブジェクトを扱うシステムでも安定動作</td></tr></tbody></table></div><p><strong>具体的な効果の例</strong>:</p><ul><li><strong>テキストエディタ</strong>: 100万文字のドキュメントで、文字オブジェクトのメモリ使用量を1/1000以下に削減</li><li><strong>ゲーム</strong>: 10,000本の木を描画する際、3Dモデルデータが5種類に集約され、メモリ使用量が1/2000に削減</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF原典の「Consequences」セクションで言及</li><li>実装例における測定データ</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Flyweight Pattern in C++ - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-pattern-c-design-patterns/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-pattern-c-design-patterns/</a></li><li>Belatrix: Flyweight Design Patterns - <a class=link href=https://belatrix.globant.com/us-en/blog/tech-trends/flyweight-design-patterns/ target=_blank rel=noopener>https://belatrix.globant.com/us-en/blog/tech-trends/flyweight-design-patterns/</a></li></ul><p><strong>信頼度</strong>: 9/10（GoF原典および測定データ）</p><hr><h3 id=42-デメリット>4.2 デメリット</h3><div class=table-wrapper><table><thead><tr><th>項目</th><th>詳細</th></tr></thead><tbody><tr><td><strong>複雑さの増加</strong></td><td>内部・外部状態の厳密な分離が必要。新規メンバーには理解が困難</td></tr><tr><td><strong>外部状態管理の負担</strong></td><td>クライアント側で外部状態を毎回供給する必要があり、バグのリスク増加</td></tr><tr><td><strong>適用範囲の限定</strong></td><td>ユニーク状態が大半の場合、メモリ削減効果が薄く、複雑さが無駄に</td></tr><tr><td><strong>デバッグの困難性</strong></td><td>共有インスタンスのためデバッグが複雑化</td></tr><tr><td><strong>スレッドセーフティ</strong></td><td>並行アクセス時の同期化が必要（ファクトリのプール管理）</td></tr></tbody></table></div><p><strong>具体的なリスク</strong>:</p><ul><li><strong>誤った状態の共有</strong>: 外部状態を内部状態として保持してしまうと、予期しない動作</li><li><strong>過剰な最適化</strong>: 小規模プロジェクトでは不要な複雑さを導入してしまう</li><li><strong>ファクトリの肥大化</strong>: プールが大きくなりすぎると、検索コストが増加</li></ul><p><strong>根拠</strong>:</p><ul><li>GoF原典の「Consequences」セクションで言及</li><li>実装経験に基づく知見</li></ul><p><strong>出典</strong>:</p><ul><li>The Linux Code: Flyweight Pattern in Practice - <a class=link href=https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/ target=_blank rel=noopener>https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/</a></li><li>GOFPattern: Flyweight Consequences - <a class=link href=https://www.gofpattern.com/design-patterns/module5/flyweightConsequences.php target=_blank rel=noopener>https://www.gofpattern.com/design-patterns/module5/flyweightConsequences.php</a></li></ul><p><strong>信頼度</strong>: 8/10（GoF原典および実装経験）</p><hr><h3 id=43-いつ使うべきか使うべきでないか>4.3 いつ使うべきか/使うべきでないか</h3><p><strong>✅ 使うべき場合</strong>:</p><ul><li><strong>大量の類似オブジェクト</strong>: 数千〜数百万のオブジェクトが必要</li><li><strong>メモリが制約</strong>: モバイルアプリ、組み込みシステム、大規模ゲーム</li><li><strong>共有可能な状態が多い</strong>: 内部状態と外部状態が明確に分離可能</li><li><strong>パフォーマンス最適化が必要</strong>: オブジェクト生成コストが高い場合</li></ul><p><strong>実例</strong>:</p><ul><li>テキストエディタ（数百万文字）</li><li>地図アプリ（数千のマーカー）</li><li>3Dゲーム（数千の木、岩、敵）</li><li>データベース接続プール</li></ul><hr><p><strong>❌ 使うべきでない場合</strong>:</p><ul><li><strong>オブジェクト数が少ない</strong>: 数十〜数百程度では効果が薄い</li><li><strong>共有状態がほとんどない</strong>: 外部状態が大半を占める場合</li><li><strong>外部状態管理が複雑すぎる</strong>: メリットを上回る複雑さが生じる場合</li><li><strong>リアルタイムデバッグが必要</strong>: 共有インスタンスはデバッグが困難</li></ul><p><strong>判断基準</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>適用すべきかどうかのチェックリスト:
</span></span><span class=line><span class=cl>□ オブジェクト数が1000以上である
</span></span><span class=line><span class=cl>□ 共有可能な状態が全体の50%以上を占める
</span></span><span class=line><span class=cl>□ メモリ使用量が問題になっている、または将来問題になる可能性がある
</span></span><span class=line><span class=cl>□ チームメンバーがFlyweightパターンを理解できる、または学習する時間がある
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>→ 4つ全てにチェックが入った場合、Flyweightパターンの適用を検討する価値あり
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>GoF原典の「Applicability」セクション</li><li>実装経験に基づくベストプラクティス</li></ul><p><strong>出典</strong>:</p><ul><li>GeeksforGeeks: Flyweight Design Pattern - <a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></li><li>GOFPattern: Flyweight Suitability - <a class=link href=https://www.gofpattern.com/design-patterns/module5/flyweightSuitability-applicability.php target=_blank rel=noopener>https://www.gofpattern.com/design-patterns/module5/flyweightSuitability-applicability.php</a></li></ul><p><strong>信頼度</strong>: 8/10（GoF原典および実装経験）</p><hr><h2 id=5-perlでの実装方法>5. Perlでの実装方法</h2><h3 id=51-mooを使ったflyweightfactoryの実装>5.1 Mooを使ったFlyweightFactoryの実装</h3><p><strong>基本的な実装パターン</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=c1># Flyweightクラス（共有状態）</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>Shape</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>color</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>);</span>  <span class=c1># 内部状態（不変）</span>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>type</span>  <span class=o>=&gt;</span> <span class=p>(</span><span class=n>is</span> <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>);</span>  <span class=c1># 内部状態（不変）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>draw</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$x</span><span class=p>,</span> <span class=nv>$y</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>  <span class=c1># $x, $yは外部状態</span>
</span></span><span class=line><span class=cl>    <span class=n>say</span> <span class=s>&#34;Drawing $self-&gt;{type} in $self-&gt;{color} at ($x, $y)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FlyweightFactory</span>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>ShapeFactory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_cache</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;rw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=p>{}</span> <span class=p>},</span>  <span class=c1># オブジェクトプール</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$type</span><span class=p>,</span> <span class=nv>$color</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$key</span> <span class=o>=</span> <span class=s>&#34;$type:$color&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># キャッシュから取得、なければ新規作成</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=sr>//</span><span class=o>=</span> <span class=nn>Shape</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>type</span>  <span class=o>=&gt;</span> <span class=nv>$type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span> <span class=o>=&gt;</span> <span class=nv>$color</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用例</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>ShapeFactory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$factory</span> <span class=o>=</span> <span class=nn>ShapeFactory</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$red_circle1</span> <span class=o>=</span> <span class=nv>$factory</span><span class=o>-&gt;</span><span class=n>get_shape</span><span class=p>(</span><span class=s>&#39;circle&#39;</span><span class=p>,</span> <span class=s>&#39;red&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$red_circle2</span> <span class=o>=</span> <span class=nv>$factory</span><span class=o>-&gt;</span><span class=n>get_shape</span><span class=p>(</span><span class=s>&#39;circle&#39;</span><span class=p>,</span> <span class=s>&#39;red&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 同じインスタンスが返される</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=nv>$red_circle1</span> <span class=o>==</span> <span class=nv>$red_circle2</span><span class=p>;</span>  <span class=c1># 1（真）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 外部状態を渡して描画</span>
</span></span><span class=line><span class=cl><span class=nv>$red_circle1</span><span class=o>-&gt;</span><span class=n>draw</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>  <span class=c1># &#34;Drawing circle in red at (10, 20)&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$red_circle2</span><span class=o>-&gt;</span><span class=n>draw</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>);</span>  <span class=c1># &#34;Drawing circle in red at (30, 40)&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>ポイント</strong>:</p><ul><li><code>has color => (is => 'ro')</code>: 内部状態は読み取り専用（不変）</li><li><code>_cache</code>: プライベート属性（<code>_</code>プレフィックス）でオブジェクトプールを管理</li><li><code>//=</code>演算子: キャッシュにあればそれを返し、なければ新規作成して代入</li></ul><p><strong>根拠</strong>:</p><ul><li>Mooの公式ドキュメントのベストプラクティス</li><li>PerlのイディオムとFlyweightパターンの組み合わせ</li></ul><p><strong>出典</strong>:</p><ul><li>DesignPatterns-Perl GitHub - <a class=link href=https://github.com/jeffa/DesignPatterns-Perl/blob/master/docs/structural/flyweight.md target=_blank rel=noopener>https://github.com/jeffa/DesignPatterns-Perl/blob/master/docs/structural/flyweight.md</a></li><li>Moo - MetaCPAN - <a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></li></ul><p><strong>信頼度</strong>: 9/10（公式ドキュメントおよび実装例）</p><hr><h3 id=52-state変数やクラス変数でのオブジェクトプール管理>5.2 state変数やクラス変数でのオブジェクトプール管理</h3><p><strong>state変数を使った実装</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.36</span><span class=p>;</span>  <span class=c1># signatures, state変数が使える</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>package</span> <span class=nn>ObjectPool</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_object</span> <span class=p>($class, $key) {</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=nv>%pool</span><span class=p>;</span>  <span class=c1># 関数呼び出し間で永続化</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$pool</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=sr>//</span><span class=o>=</span> <span class=nn>MyObject</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>key</span> <span class=o>=&gt;</span> <span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用例</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$obj1</span> <span class=o>=</span> <span class=nn>ObjectPool</span><span class=o>-&gt;</span><span class=n>get_object</span><span class=p>(</span><span class=s>&#39;foo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$obj2</span> <span class=o>=</span> <span class=nn>ObjectPool</span><span class=o>-&gt;</span><span class=n>get_object</span><span class=p>(</span><span class=s>&#39;foo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>say</span> <span class=nv>$obj1</span> <span class=o>==</span> <span class=nv>$obj2</span><span class=p>;</span>  <span class=c1># 1（同じインスタンス）</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>クラス変数（クロージャ）を使った実装</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>ObjectPool</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>v5</span><span class=mf>.36</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>%pool</span><span class=p>;</span>  <span class=c1># クロージャ内でプライベート変数として宣言</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>sub</span> <span class=nf>get_object</span> <span class=p>($class, $key) {</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$pool</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=sr>//</span><span class=o>=</span> <span class=nn>MyObject</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>key</span> <span class=o>=&gt;</span> <span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>sub</span> <span class=nf>clear_pool</span> <span class=p>($class) {</span>
</span></span><span class=line><span class=cl>        <span class=nv>%pool</span> <span class=o>=</span> <span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>それぞれの特徴</strong>:</p><div class=table-wrapper><table><thead><tr><th>方法</th><th>メリット</th><th>デメリット</th></tr></thead><tbody><tr><td><strong>state変数</strong></td><td>シンプル、v5.10以降で利用可能</td><td>関数ごとに独立、グローバルな管理が難しい</td></tr><tr><td><strong>クロージャ</strong></td><td>プライベートで安全、複数メソッドで共有可能</td><td>やや複雑</td></tr><tr><td><strong>Moo属性</strong></td><td>オブジェクト指向的、テストしやすい</td><td>インスタンスごとに別プール</td></tr></tbody></table></div><p><strong>推奨</strong>:</p><ul><li><strong>Mooを使う場合</strong>: Moo属性（<code>has _cache</code>）を推奨（オブジェクト指向的で明確）</li><li><strong>関数ベースの場合</strong>: クロージャを推奨（複数メソッドで共有可能）</li></ul><p><strong>根拠</strong>:</p><ul><li>Perlのイディオムとベストプラクティス</li><li>テストのしやすさと保守性を考慮</li></ul><p><strong>出典</strong>:</p><ul><li>Perl Maven: Static and state variables - <a class=link href=https://perlmaven.com/static-and-state-variables-in-perl target=_blank rel=noopener>https://perlmaven.com/static-and-state-variables-in-perl</a></li><li>perlsub: Persistent Private Variables - <a class=link href=https://perldoc.perl.org/perlsub#Persistent-Private-Variables target=_blank rel=noopener>https://perldoc.perl.org/perlsub#Persistent-Private-Variables</a></li></ul><p><strong>信頼度</strong>: 9/10（公式ドキュメントおよびベストプラクティス）</p><hr><h3 id=53-弱い参照scalarutilweakenの活用>5.3 弱い参照（Scalar::Util::weaken）の活用</h3><p><strong>基本的な使用例</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>use</span> <span class=nn>Scalar::Util</span> <span class=sx>qw(weaken)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>%cache</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_flyweight</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$class</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># キャッシュが有効な参照を持っているか確認</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=k>if</span> <span class=nb>exists</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=ow>and</span> <span class=nb>defined</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$obj</span> <span class=o>=</span> <span class=nn>Flyweight</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>key</span> <span class=o>=&gt;</span> <span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=o>=</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>weaken</span><span class=p>(</span><span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>});</span>  <span class=c1># キャッシュは弱い参照を保持</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>弱い参照の効果</strong>:</p><ul><li><strong>循環参照によるメモリリーク防止</strong>: 参照カウントを増やさない</li><li><strong>自動クリーンアップ</strong>: 外部から参照されなくなったオブジェクトは自動的にGCされる</li><li><strong>キャッシュの自動整理</strong>: 使われなくなったFlyweightが自動的にプールから削除される</li></ul><p><strong>注意点</strong>:</p><ol><li><p><strong>弱い参照のコピーは強い参照になる</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>my</span> <span class=nv>$weak_ref</span> <span class=o>=</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>weaken</span><span class=p>(</span><span class=nv>$weak_ref</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$strong_ref</span> <span class=o>=</span> <span class=nv>$weak_ref</span><span class=p>;</span>  <span class=c1># これは強い参照！</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>使用前にundefined チェックが必要</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>defined</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$cache</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>必ずしもFlyweightに必須ではない</strong></p><ul><li>常にキャッシュを保持したい場合は、弱い参照を使わない</li><li>メモリを節約したい場合に弱い参照を活用</li></ul></li></ol><p><strong>実装例（自動クリーンアップ付きFlyweightFactory）</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=k>package</span> <span class=nn>FlyweightFactory</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Moo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>Scalar::Util</span> <span class=sx>qw(weaken)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>has</span> <span class=n>_cache</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>is</span>      <span class=o>=&gt;</span> <span class=s>&#39;ro&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=o>=&gt;</span> <span class=k>sub</span> <span class=p>{</span> <span class=p>{}</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>get_flyweight</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 既存の有効な参照があればそれを返す</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>exists</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=ow>and</span> <span class=nb>defined</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 新規作成</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=nv>$obj</span> <span class=o>=</span> <span class=nn>Flyweight</span><span class=o>-&gt;</span><span class=k>new</span><span class=p>(</span><span class=n>key</span> <span class=o>=&gt;</span> <span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=o>=</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>weaken</span><span class=p>(</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>sub</span> <span class=nf>clear_unused</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>my</span> <span class=p>(</span><span class=nv>$self</span><span class=p>)</span> <span class=o>=</span> <span class=nv>@_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># undefになったエントリを削除</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=k>my</span> <span class=nv>$key</span> <span class=p>(</span><span class=nb>keys</span> <span class=nv>%</span><span class=p>{</span><span class=nv>$self</span><span class=o>-&gt;</span><span class=n>_cache</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>delete</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>}</span> <span class=k>unless</span> <span class=nb>defined</span> <span class=nv>$self</span><span class=o>-&gt;</span><span class=nn>_cache</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$key</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>根拠</strong>:</p><ul><li>Perlの弱い参照の仕組み</li><li>メモリリーク対策のベストプラクティス</li></ul><p><strong>出典</strong>:</p><ul><li>Perl Maven: Eliminate circular reference memory-leak - <a class=link href=https://perlmaven.com/eliminate-circular-reference-memory-leak-using-weaken target=_blank rel=noopener>https://perlmaven.com/eliminate-circular-reference-memory-leak-using-weaken</a></li><li>StackOverflow: Why does copying a weak reference create a strong reference - <a class=link href=https://stackoverflow.com/questions/4464219/in-perl-why-does-copying-a-weak-reference-create-a-normal-strong-reference target=_blank rel=noopener>https://stackoverflow.com/questions/4464219/in-perl-why-does-copying-a-weak-reference-create-a-normal-strong-reference</a></li><li>perldoc: Scalar::Util - <a class=link href=https://perldoc.perl.org/Scalar::Util target=_blank rel=noopener>https://perldoc.perl.org/Scalar::Util</a></li></ul><p><strong>信頼度</strong>: 9/10（公式ドキュメントおよび実装例）</p><hr><h3 id=54-cpanモジュールでflyweightパターンを実装しているもの>5.4 CPANモジュールでFlyweightパターンを実装しているもの</h3><p><strong>主要なリソース</strong>:</p><ol><li><p><strong>DesignPatterns-Perl（GitHub）</strong></p><ul><li>GoFの全デザインパターンをMooseで実装</li><li>Flyweight用クラス:<ul><li><code>OODP::ConcreteFlyweight</code></li><li><code>OODP::UnsharedConcreteFlyweight</code></li><li><code>OODP::FlyweightFactory</code></li></ul></li><li>URL: <a class=link href=https://github.com/jeffa/DesignPatterns-Perl target=_blank rel=noopener>https://github.com/jeffa/DesignPatterns-Perl</a></li></ul></li><li><p><strong>Moose / Moo</strong></p><ul><li>Flyweight専用ではないが、モダンなPerlのOOパターンのベース</li><li>属性、ロール、型制約などをサポート</li><li>Flyweightパターンの実装に必要な機能を提供</li></ul></li></ol><p><strong>直接的な専用CPANモジュールは存在しない</strong>:</p><ul><li>SingletonやFactoryとは異なり、Flyweight専用のCPANモジュールは広く認識されていない</li><li>多くのPerlプロジェクトでは内部実装として実装される</li><li>理由: Flyweightは状態の分離が重要で、ドメイン固有の実装が必要なため</li></ul><p><strong>推奨アプローチ</strong>:</p><ul><li><strong>Moo</strong>を使って自前でFlyweightFactoryを実装</li><li><strong>DesignPatterns-Perl</strong>のコードを参考にする</li><li>プロジェクト固有の要件に合わせてカスタマイズ</li></ul><p><strong>根拠</strong>:</p><ul><li>CPAN検索結果</li><li>Perlコミュニティのベストプラクティス</li></ul><p><strong>出典</strong>:</p><ul><li>DesignPatterns-Perl on GitHub - <a class=link href=https://github.com/jeffa/DesignPatterns-Perl/blob/master/docs/structural/flyweight.md target=_blank rel=noopener>https://github.com/jeffa/DesignPatterns-Perl/blob/master/docs/structural/flyweight.md</a></li><li>Moose on MetaCPAN - <a class=link href=https://metacpan.org/pod/Moose target=_blank rel=noopener>https://metacpan.org/pod/Moose</a></li><li>Moo on MetaCPAN - <a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></li></ul><p><strong>信頼度</strong>: 8/10（CPAN検索および実装経験）</p><hr><h2 id=6-既存シリーズとの重複チェック>6. 既存シリーズとの重複チェック</h2><h3 id=61-既存記事の調査結果>6.1 既存記事の調査結果</h3><p><strong>grep結果</strong>:</p><ul><li><code>/home/runner/work/www.nqou.net/www.nqou.net/content/post/2026/01/17/004437.md</code>: Prototypeパターンの記事で言及</li><li><code>/home/runner/work/www.nqou.net/www.nqou.net/content/warehouse/design-patterns-overview.md</code>: 構造パターンの一覧で言及</li><li><code>/home/runner/work/www.nqou.net/www.nqou.net/content/warehouse/composite-pattern.md</code>: 他のパターンとの比較で言及</li></ul><p><strong>重複状況</strong>:</p><ul><li><strong>Flyweightパターン専用の記事は存在しない</strong></li><li>他のパターンの説明の中で名前のみ言及されている程度</li><li>詳細な解説や実装例は一切ない</li></ul><p><strong>結論</strong>:</p><ul><li>Flyweightパターンの詳細な解説記事を作成する価値がある</li><li>「Mooで覚えるオブジェクト指向プログラミング」シリーズの続編として位置づけることが可能</li></ul><hr><h3 id=62-他のデザインパターンシリーズとの差別化ポイント>6.2 他のデザインパターンシリーズとの差別化ポイント</h3><p><strong>既存のパターンシリーズ</strong>:</p><ul><li>Prototype、Composite、Bridge、Decorator、Proxy、Command、Mediator、Memento、Observer、State、Strategy、Template Method</li></ul><p><strong>Flyweightの差別化ポイント</strong>:</p><ol><li><strong>メモリ効率化に特化</strong>: 他のパターンと異なり、リソース最適化が主目的</li><li><strong>状態の分離</strong>: 内部状態と外部状態の明確な分離が必須</li><li><strong>実践的なユースケース</strong>: ゲーム開発、テキストエディタ、GUIライブラリなど、実用例が豊富</li><li><strong>Perlでの実装の独自性</strong>: state変数、弱い参照など、Perl固有の機能を活用</li></ol><p><strong>シリーズとしての位置づけ</strong>:</p><ul><li>「Mooで覚えるオブジェクト指向プログラミング」シリーズの応用編</li><li>構造パターンの中では、Composite、Decorator、Proxyに続く4つ目</li><li>メモリ効率を重視する読者に向けた実践的な内容</li></ul><hr><h2 id=7-競合分析>7. 競合分析</h2><h3 id=71-既存チュートリアルの調査>7.1 既存チュートリアルの調査</h3><p><strong>「Flyweight パターン Perl」での検索結果</strong>:</p><ul><li><strong>DesignPatterns-Perl（GitHub）</strong>: Mooseによる実装例あり、学習用として有用</li><li><strong>Perl.com記事</strong>: 古い記事（2003年）で、blessベースの実装</li><li><strong>英語圏の技術ブログ</strong>: Java、C++、Pythonの実装が主流で、Perlは少数</li></ul><p><strong>「Perl メモリ効率 オブジェクト」での検索結果</strong>:</p><ul><li>メモリリーク対策の記事が多い</li><li>Flyweightパターンとして体系化された記事は少ない</li></ul><p><strong>競合の強み・弱み</strong>:</p><div class=table-wrapper><table><thead><tr><th>競合</th><th>強み</th><th>弱み</th></tr></thead><tbody><tr><td><strong>DesignPatterns-Perl</strong></td><td>Mooseによる正統的な実装</td><td>学習用で実践的な応用例が少ない</td></tr><tr><td><strong>Perl.com記事</strong></td><td>歴史的価値あり</td><td>古い実装（bless）、モダンなアプローチがない</td></tr><tr><td><strong>英語圏の技術ブログ</strong></td><td>理論的に正確</td><td>Perlでの実装例がほとんどない</td></tr></tbody></table></div><p><strong>本シリーズの優位性</strong>:</p><ul><li><strong>Mooを使ったモダンな実装</strong>: 2026年時点の最新アプローチ</li><li><strong>日本語での体系的な解説</strong>: 日本語でのFlyweightパターン+Perlの情報は希少</li><li><strong>実践的なユースケース</strong>: ゲーム開発、テキストエディタなど、読者が想像しやすい例</li><li><strong>「Mooで覚えるオブジェクト指向プログラミング」シリーズとの連続性</strong>: 既存読者にとって学びやすい</li></ul><p><strong>根拠</strong>:</p><ul><li>Google検索、GitHub検索の結果</li><li>既存記事の内容分析</li></ul><p><strong>信頼度</strong>: 7/10（検索結果および内容分析）</p><hr><h2 id=8-内部リンク候補>8. 内部リンク候補</h2><h3 id=81-mooで覚えるオブジェクト指向プログラミングシリーズの関連回>8.1 「Mooで覚えるオブジェクト指向プログラミング」シリーズの関連回</h3><div class=table-wrapper><table><thead><tr><th>回</th><th>タイトル</th><th>関連性</th></tr></thead><tbody><tr><td>第1回</td><td>Mooで覚えるオブジェクト指向プログラミング</td><td>Mooの基礎、blessを忘れる</td></tr><tr><td>第3回</td><td>同じものを何度も作れるように</td><td>オブジェクト生成の基礎</td></tr><tr><td>第4回</td><td>勝手に書き換えられないようにする</td><td>不変性（<code>is => 'ro'</code>）の重要性</td></tr><tr><td>第6回</td><td>内部実装を外から触らせない</td><td>カプセル化（<code>_cache</code>など）</td></tr><tr><td>第11回</td><td>「持っている」ものに仕事を任せる</td><td>委譲の考え方（Factoryパターン）</td></tr></tbody></table></div><p><strong>リンク例</strong>:</p><ul><li>「第4回で学んだ<code>is => 'ro'</code>による不変性が、Flyweightの内部状態で重要になります」</li><li>「第11回の委譲の考え方が、FlyweightFactoryの設計に活かされています」</li></ul><hr><h3 id=82-他のデザインパターン調査ドキュメント>8.2 他のデザインパターン調査ドキュメント</h3><div class=table-wrapper><table><thead><tr><th>パターン</th><th>関連性</th></tr></thead><tbody><tr><td><strong>Prototype</strong></td><td>生成方法の違い（共有 vs コピー）</td></tr><tr><td><strong>Singleton</strong></td><td>インスタンス数の違い（複数 vs 1つ）</td></tr><tr><td><strong>Proxy</strong></td><td>構造パターンとしての比較</td></tr><tr><td><strong>Composite</strong></td><td>構造パターンとしての比較、UnsharedConcreteFlyweightとの関係</td></tr></tbody></table></div><p><strong>リンク例</strong>:</p><ul><li>「Prototypeパターンとの違いについては、<a class=link href=/warehouse/prototype-pattern/>Prototypeパターン調査ドキュメント</a>をご覧ください」</li><li>「構造パターン全体の概要は、<a class=link href=/warehouse/design-patterns-overview/>デザインパターン概要</a>で確認できます」</li></ul><hr><h2 id=9-参考文献リソースリスト>9. 参考文献・リソースリスト</h2><h3 id=91-必読リソース書籍>9.1 必読リソース（書籍）</h3><div class=table-wrapper><table><thead><tr><th>書籍名</th><th>著者</th><th>要点</th><th>根拠</th><th>仮定</th><th>出典</th><th>信頼度</th></tr></thead><tbody><tr><td><strong>Design Patterns: Elements of Reusable Object-Oriented Software</strong></td><td>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides</td><td>GoF原典、Flyweightパターンの定義</td><td>1994年出版、デザインパターンの原典</td><td>読者は英語の技術書を読める</td><td>ISBN: 978-0201633610</td><td>10/10</td></tr></tbody></table></div><hr><h3 id=92-必読リソースweb>9.2 必読リソース（Web）</h3><div class=table-wrapper><table><thead><tr><th>タイトル</th><th>要点</th><th>根拠</th><th>仮定</th><th>出典</th><th>信頼度</th></tr></thead><tbody><tr><td><strong>Refactoring Guru: Flyweight</strong></td><td>Flyweightパターンの図解と実装例</td><td>著名な技術サイト、視覚的に分かりやすい</td><td>読者はUMLが読める</td><td><a class=link href=https://refactoring.guru/design-patterns/flyweight target=_blank rel=noopener>https://refactoring.guru/design-patterns/flyweight</a></td><td>9/10</td></tr><tr><td><strong>GeeksforGeeks: Flyweight Design Pattern</strong></td><td>基礎から応用まで網羅</td><td>大手技術サイト、サンプルコード豊富</td><td>読者はJavaのコードが読める</td><td><a class=link href=https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/ target=_blank rel=noopener>https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/</a></td><td>9/10</td></tr><tr><td><strong>Wikipedia: Flyweight pattern</strong></td><td>歴史的背景、構造、実装例</td><td>信頼性の高い情報源</td><td>英語が読める</td><td><a class=link href=https://en.wikipedia.org/wiki/Flyweight_pattern target=_blank rel=noopener>https://en.wikipedia.org/wiki/Flyweight_pattern</a></td><td>8/10</td></tr><tr><td><strong>DesignPatterns-Perl (GitHub)</strong></td><td>PerlでのFlyweight実装例</td><td>Mooseによる正統的な実装</td><td>読者はMooseが読める</td><td><a class=link href=https://github.com/jeffa/DesignPatterns-Perl target=_blank rel=noopener>https://github.com/jeffa/DesignPatterns-Perl</a></td><td>9/10</td></tr><tr><td><strong>The Linux Code: Flyweight Pattern in Practice</strong></td><td>実践的な使い方とベストプラクティス</td><td>実装経験に基づく知見</td><td>英語が読める</td><td><a class=link href=https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/ target=_blank rel=noopener>https://thelinuxcode.com/flyweight-design-pattern-in-practice-memory-sharing-without-the-headaches/</a></td><td>8/10</td></tr></tbody></table></div><hr><h3 id=93-補足リソース>9.3 補足リソース</h3><div class=table-wrapper><table><thead><tr><th>タイトル</th><th>要点</th><th>出典</th><th>信頼度</th></tr></thead><tbody><tr><td><strong>Unity Learn: Flyweight Pattern</strong></td><td>ゲーム開発でのFlyweight活用</td><td><a class=link href=https://learn.unity.com/course/design-patterns-unity-6/tutorial/flyweight-pattern target=_blank rel=noopener>https://learn.unity.com/course/design-patterns-unity-6/tutorial/flyweight-pattern</a></td><td>8/10</td></tr><tr><td><strong>Perl Maven: Static and state variables</strong></td><td>Perlのstate変数の解説</td><td><a class=link href=https://perlmaven.com/static-and-state-variables-in-perl target=_blank rel=noopener>https://perlmaven.com/static-and-state-variables-in-perl</a></td><td>9/10</td></tr><tr><td><strong>Scalar::Util - perldoc</strong></td><td>弱い参照（weaken）の公式ドキュメント</td><td><a class=link href=https://perldoc.perl.org/Scalar::Util target=_blank rel=noopener>https://perldoc.perl.org/Scalar::Util</a></td><td>10/10</td></tr><tr><td><strong>Moo - MetaCPAN</strong></td><td>Mooの公式ドキュメント</td><td><a class=link href=https://metacpan.org/pod/Moo target=_blank rel=noopener>https://metacpan.org/pod/Moo</a></td><td>10/10</td></tr></tbody></table></div><hr><h2 id=10-まとめと今後の展開>10. まとめと今後の展開</h2><h3 id=101-調査のまとめ>10.1 調査のまとめ</h3><p><strong>Flyweightパターンの本質</strong>:</p><ul><li><strong>内部状態と外部状態の分離</strong>が核心概念</li><li><strong>オブジェクトの共有</strong>によるメモリ効率化</li><li><strong>大量の類似オブジェクト</strong>を扱う場合に威力を発揮</li></ul><p><strong>Perlでの実装のポイント</strong>:</p><ul><li>Mooの<code>is => 'ro'</code>で内部状態の不変性を保証</li><li><code>state</code>変数やクロージャでオブジェクトプールを管理</li><li><code>Scalar::Util::weaken</code>で自動クリーンアップを実現</li></ul><p><strong>既存シリーズとの関連</strong>:</p><ul><li>「Mooで覚えるオブジェクト指向プログラミング」シリーズの応用編として位置づけ</li><li>第4回（不変性）、第11回（委譲）との関連が強い</li></ul><hr><h3 id=102-記事作成の方向性>10.2 記事作成の方向性</h3><p><strong>ターゲット読者</strong>:</p><ul><li>「Mooで覚えるオブジェクト指向プログラミング」シリーズを読了した読者</li><li>メモリ効率化やパフォーマンスに興味がある読者</li><li>ゲーム開発や大規模システムの開発者</li></ul><p><strong>記事の構成案</strong>:</p><ol><li><strong>導入</strong>: テキストエディタやゲームでの大量オブジェクト問題</li><li><strong>基礎</strong>: 内部状態と外部状態の分離</li><li><strong>実装</strong>: Mooを使ったFlyweightFactoryの実装</li><li><strong>応用</strong>: 弱い参照を使った自動クリーンアップ</li><li><strong>比較</strong>: Prototype、Singletonとの違い</li><li><strong>まとめ</strong>: いつ使うべきか、使うべきでないか</li></ol><p><strong>差別化ポイント</strong>:</p><ul><li>Mooを使ったモダンな実装</li><li>実践的なユースケース（ゲーム、テキストエディタ）</li><li>Perl固有の機能（state変数、弱い参照）の活用</li></ul><hr><h3 id=103-今後の課題>10.3 今後の課題</h3><p><strong>調査が必要な項目</strong>:</p><ul><li>Perlでのベンチマーク測定（メモリ使用量、実行速度）</li><li>実際のアプリケーションでの適用事例</li><li>マルチスレッド環境でのスレッドセーフな実装</li></ul><p><strong>記事執筆時の注意点</strong>:</p><ul><li>内部状態と外部状態の違いを分かりやすく説明</li><li>過剰な最適化にならないよう、適用場面を明確に</li><li>Prototypeパターンとの違いを強調</li></ul><hr><h2 id=調査完了>調査完了</h2><p><strong>調査実施日</strong>: 2026年1月21日<br><strong>調査者</strong>: investigative-research agent<br><strong>信頼度</strong>: 8.5/10（GoF原典、複数の信頼できる技術サイト、実装例に基づく）</p><p>この調査ドキュメントを基に、「Mooで覚えるオブジェクト指向プログラミング」シリーズの読者が、Flyweightパターンを自然に学べる教材を作成できます。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/design-patterns/>Design-Patterns</a>
<a href=/tags/flyweight/>Flyweight</a>
<a href=/tags/structural-patterns/>Structural-Patterns</a>
<a href=/tags/perl/>Perl</a>
<a href=/tags/moo/>Moo</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/warehouse/singleton-flyweight-proxy-combination/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Singleton × Flyweight × Proxy パターン組み合わせ調査ドキュメント</h2></div></a></article><article class=has-image><a href=/2026/01/24/003901/><div class=article-image><img src=/public_images/2026/flyweight-series-header.png loading=lazy data-key data-hash=/public_images/2026/flyweight-series-header.png></div><div class=article-details><h2 class=article-title>【目次】PerlとMooで弾幕シューティングを作ってみよう（全6回）</h2></div></a></article><article class=has-image><a href=/2026/01/24/003844/><div class=article-image><img src=/public_images/2026/flyweight-series-header.png loading=lazy data-key data-hash=/public_images/2026/flyweight-series-header.png></div><div class=article-details><h2 class=article-title>【第6回】これがFlyweightパターンだ！</h2></div></a></article><article class=has-image><a href=/2026/02/04/001726/><div class=article-image><img src=/public_images/2026/bridge-adapter-proxy-series-image.jpg loading=lazy data-key data-hash=/public_images/2026/bridge-adapter-proxy-series-image.jpg></div><div class=article-details><h2 class=article-title>Perlで作るウイスキーテイスティング・ノート〜3つの「間に入る」パターンで設計を手で覚える</h2></div></a></article><article class=has-image><a href=/warehouse/interpreter-visitor-composite-series/><div class=article-image><img src=/favicon.png loading=lazy data-key data-hash=/favicon.png></div><div class=article-details><h2 class=article-title>Interpreter × Visitor × Composite 組み合わせシリーズ調査</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//nqounet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2000 -
2026 設計パターンを疑え</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>