# AGENTS.md — リポジトリ用エージェント向けガイダンス

このファイルは `README.md` の補助文書で、Hugo ベースのウェブサイト（`www.nqou.net`）におけるエージェントの作業指針をまとめたものです。

## コミュニケーション

- 原則として日本語で応答する
- 技術用語やコードは英語のまま記載してよい

## プロジェクト概要

- 目的: Hugo を用いた個人の技術ブログの管理
- 主要技術: Hugo、Markdown、必要に応じた補助スクリプト（例: Perl）
- 重要なディレクトリ:
  - `content/` — ソースコンテンツ（投稿は `content/post/`）
  - `layouts/`, `partials/`, `shortcodes/` — テーマやレイアウト
  - `static/` — 静的アセット
  - `resources/` — Hugo のリソース出力
  - `docs/` — 生成済みサイト（読み取り専用扱い）

## クイックスタート（エージェント向け要点）

- コンテンツは `content/post/` に追加する
- エージェントは環境セットアップやシステムレベルのインストールを自動実行してはならない
- `docs/` は生成物のため直接編集しない

## 調査ドキュメントの運用

- 保存場所: 調査ドキュメントは `agents/research/<slug>.md` に作成する（例: `agents/research/test2.md`）
- 内容の書き方: 調査目的、実施日、使用したコマンドや参照元 (URL)、発見・結論、次のステップを明記すること。追加で実験ログや小さなコードスニペットを含めてよい
- Todo 管理: 長い調査や複数工程がある場合は `manage_todo_list` を用いて段階的に進捗を記録すること（エージェントはTODOを必ず作成・更新してください）
- **調査後1週間が経過している場合は、再調査すること**
- 調査結果は再利用して良い

## セットアップ（人間が実行するコマンド）

- ローカルプレビュー: `hugo server -D`
- 本番ビルド: `hugo --minify`
- 例（macOS、Homebrew）:

```zsh
brew install hugo
hugo server -D -F
```

## エージェントの作業フロー（概要）

- コンテンツ作成、プレビュー、ビルド、検証の一連の流れを人間が管理する前提でエージェントは補助作業を行います

## コンテンツ作成ルール

- フロントマターは YAML（`---`）で記述する
- 投稿はドラフト中は `draft: true` にする
- タグは英語小文字・ハイフン形式（例: `object-oriented`）
- ファイル名はスラッグ（例: `how-to-hugo.md`）を推奨。ただし、公開時にファイル名が変更される。関連記事の検索はタグを利用すること
- 見出しは ATX スタイル（`##` 以上）を使用。H1 はフロントマターの `title` に任せる
- 外部参照は既存ショートコード（例: `{{< linkcard "https://example.com" >}}`）を優先する
- よく使うフロントマターキー: `title`, `draft`, `tags`, `description`

## プレビューと編集

- `hugo server -D` で `http://localhost:1313` を開き、レンダリングを確認する
- レイアウトやショートコードの挙動を検証する

## ビルドと検証

- `hugo --minify` を実行し、生成物（`docs/` など）を目視で確認する
- `build.pl` 等を使う場合は、人間がスクリプトの内容と引数を精査してから実行する

## テスト手順

- 自動化されたユニットテストは本リポジトリに含まれていない。検証は主に目視とリンクチェッカーを利用する
- 推奨ツール: `linkinator`, `broken-link-checker` 等

## コードスタイル & コンテンツ規約

- Markdown は CommonMark 互換
- フェンスコードブロックに適切な言語タグを付与する
- 画像には意味のある `alt` を付ける
- 既存ショートコードやパーシャルを優先する。生 HTML 埋め込みはなるべく避ける

## ビルドとデプロイ

- ビルドコマンドは `hugo --minify`
- 生成物の出力先（`docs/` 等）を CI 設定に合わせて確認する
- `docs/` は通常読み取り専用とする。編集はソースに対して行う

## プルリクエストとコントリビューション規約

- ブランチ命名例: `feature/write-hugo-article`, `fix/images-optimization`
- PR タイトル: `[post] 短い説明` または `[site] 短い説明`
- PR 提出前に行うこと:
  - `hugo server -D` で目視確認
  - `hugo --minify` でビルド確認
  - 下書きは `draft: true` のままにする

## セキュリティとシークレット管理

- リポジトリにシークレットを置かない。CI のシークレットは GitHub Secrets 等を利用する
- フロントマターやコンテンツに資格情報を埋め込まない

## トラブルシューティング

- `hugo server` が失敗する場合の確認:
  - Hugo のバージョン確認（`config/_default/config.toml` 等）
  - ショートコードやパーシャルのパラメータ不足の確認
- 画像が表示されない場合:
  - `assets/` や `static/images/` にファイルがあるか確認
  - フロントマターのパスが正しいか確認
- コンテンツが表示されない場合:
  - `draft` の値、または `hugo server -D` を使用しているか確認

## カスタムエージェントを使ったアウトライン作成

### 基本方針

- アウトライン作成の際には、カスタムエージェント群を連携させて作成する
- アウトライン作成は、専門家エージェントに割り当てる（下のエージェントトピックマッピング参照）
- トピックに最も適した専門家エージェントにアウトライン（構成）作成を委任する
- エージェントへの依頼は明確なプロンプトテンプレートに従う
- 出力は H2/H3 見出し（日本語）で、各見出しに 1–2 行の説明を付ける
- 出力は破壊的変更ではなく、下書きとして人間が `content/` に配置して最終調整する
- 最後は、**必ず公開前の最終チェック（reviewer）に依頼すること**

### シリーズ記事（連載記事）のワークフロー
シリーズ記事（連載記事）のワークフローは以下の順とする。それぞれ専門家エージェントに割り当てる

1. 調査・情報収集（investigative-researchエージェント）
  - キーワード、および関連トピックの調査
2. 連載の構造作成（search-engine-optimizationエージェント）
  - 調査結果に基づき、連載の全体像を考え、各記事の位置付けを整理する
  - 連載の構造案を3つ（案A/B/C）作成する
3. 各記事の執筆
  - 連載の構造に基づいて、各記事を作成する
  - 各記事については、単体記事のワークフローに従う

### 単体記事のワークフロー
記事ごとのワークフローは以下の順とする。それぞれ専門家エージェントに割り当てる

1. 調査・情報収集（investigative-researchエージェント）
  - キーワード、および関連トピックの調査
  - 参考URLの収集
  - 書籍については、ASINやISBNの収集
  - 競合記事の分析
  - 内部リンク（関連記事など）の調査。ファイル名ではなくタグを利用すること
2. アウトライン作成（search-engine-optimizationエージェント）
  - タイトルの最適化：主要キーワードを含め、クリックされやすい表現にする
  - meta description：検索結果でのCTRを高める要約する
  - 見出し構造の整理：H1はページの主題、H2/H3で論理的に分割する
  - 構造化データの導入：リッチリザルト促進（FAQ、レビュー、イベントなど）
3. 下書き生成（各専門家エージェント）
  - アウトラインに基づいて、技術的に正確で最新の情報を盛り込んだ下書きを作成する
  - ユーザーが求める回答を分かりやすく、独自の視点やデータで提供
  - コード例、図表（mermaid記法など）、引用を適切に配置する
  - 引用元のURLや内部リンクを明記する
4. スタイルと構成の整形（layout-and-content-harmonizationエージェント）
5. 校正（proofreaderエージェント）
6. SEO（search-engine-optimizationエージェント）
7. 公開前の最終チェック（reviewerエージェント）

## エージェントトピックマッピング（代表例）

- Perl / CPAN / ワンライナー: `perl-monger`
- SQL / クエリ最適化 / DB 設計: `sql-otaku`
- JSON-RPC / API 設計: `json-rpc-otaku`
- WebSocket / リアルタイム通信: `websocket-otaku`
- Docker / コンテナ運用: `docker-otaku`
- Kubernetes / クラスタ運用: `kubernetes-otaku`
- Git / ブランチ運用: `git-otaku`
- GitHub / ワークフロー・PR ベストプラクティス: `github-otaku`
- カスタムエージェント: `github-copilot-otaku`
- AGENTS.pm / AIエージェントガイドライン: `agents-pm-otaku`
- 調査・情報収集: `investigative-research`, `websearch-nerd`
- 記事構成・編集: `blog-planner`, `blog-editor`, `layout-and-content-harmonization`
- 企画・アイデア: `creative-brainstorming`
- 公開前の最終チェック: `reviewer`

## プロンプトテンプレート

### 調査・情報収集依頼

キーワード、トピックに基づいて、最新かつ信頼性の高い情報を調査・情報収集してください。

#### 出力
- 各トピックごとに、URL、要点、引用、信頼性の評価
- 記事執筆時に参照すべき重要なリソースのリスト
- 技術的な正確性を担保するための情報源
- 調査結果は、調査ドキュメントとして保存する
- 調査ドキュメントは `agents/research/<slug>.md` に作成する（例: `agents/research/test2.md`）

### アウトライン依頼

調査結果に基づいて、技術記事のアウトライン案を3つ（案A/B/C）作ってください。必ず最新の情報を元に作成してください。

#### 出力
- 各案に対して: 要約(1行)、H2/H3 見出しの階層、各見出しに1-2行の説明、推奨タグ(3つ程度)、推定文字数レンジ

### 下書き生成依頼

調査結果とアウトラインに基づいて、技術記事の下書きを作成してください。コード例や図表（mermaid記法など）を適切に配置し、引用元のURLを明記してください。

#### 出力
- フロントマター（YAML形式）をつける
- H2/H3 見出しの階層に従って本文を作成する
- **本文の文体は敬体（です・ます調）にする**
- **箇条書きの文体は常体（だ・である調）にする**
- **箇条書きの最後の句点（。）はつけない**
- 各コード例に言語タグ、バージョン、外部依存を明記する
- 書籍については、ショートコード（amazon）を使用して記載する（例: `{{< amazon asin="<ASIN>" title="<書籍のタイトル>" >}}`）

## 検証と品質ゲート

- H2/H3 の見出しが適切に分割されていること
- 各セクションの説明が具体的であること（曖昧な語句は再要求）
- コード例の言語・バージョン・外部依存が明記されていること
- 推奨タグがリポジトリのタグ規約に合致していること（英語小文字、ハイフン）

## 付記

- 変更や追補が必要な場合は `.github/agents/*.agent.md` を参照して各エージェントの特性に合わせて調整してください
