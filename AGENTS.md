# AGENTS.md — リポジトリ用エージェント向けガイダンス

このファイルは `README.md` の補助文書で、Hugo ベースのウェブサイト（`www.nqou.net`）におけるエージェントの作業指針をまとめたものです。

# 目次

## 基礎セクション
- 最重要項目
- コミュニケーション
- プロジェクト概要

## セットアップと準備
- クイックスタート
- エージェントトピックマッピング

## ガイドラインと規約
- 調査ドキュメントの運用
- コンテンツ作成ルール
- コードスタイル & コンテンツ規約
- テスト手順
- プルリクエストとコントリビューション規約
- セキュリティとシークレット管理

## ワークフロー
- ワークフロー
  - 基本方針
  - シリーズ記事（連載記事）のワークフロー
    - プランニングフェーズ
    - 執筆フェーズ
  - 単体記事のワークフロー

## プロンプトテンプレートと依頼方法
- プロンプトテンプレート
  - 調査・情報収集依頼
  - 連載構造案作成依頼
    - 各案に必要な項目
    - 出力
  - 連載構造案レビュー依頼
    - レビュー観点
    - 出力
  - アウトライン依頼
    - 各案に必要な項目
  - 記事作成依頼
    - 出力

## 品質管理
- 検証と品質ゲート
  - 単体記事の品質基準
  - 連載構造案の品質基準

## 参考
- 付記

# 最重要項目

- **わからない場合や確証を持てない場合は、正直に『わからない』と答えること**
- 常に正確性と透明性を最優先に考え、適切な回答を心がけること

# コミュニケーション

- 原則として日本語で応答すること
- 技術用語やコードは英語のままで良い

# プロジェクト概要

- 目的: Hugo を用いた個人の技術ブログの管理
- 主要技術: Hugo、Markdown、必要に応じた補助スクリプト（例: Perl）
- 重要なディレクトリ:
  - `agents/`: エージェント用
  - `content/`: ソースコンテンツ（投稿は `content/post/`）
  - `layouts/`, `partials/`, `shortcodes/`: テーマやレイアウト
  - `static/`: 静的アセット
  - `resources/`: Hugo のリソース出力
  - `docs/`: 生成済みサイト（直接の編集は禁止）

# クイックスタート

- コンテンツは `content/post/` に追加する
- エージェントは環境セットアップやシステムレベルのインストールを自動実行してはならない
- `docs/` は生成物のため直接編集しない

# 調査ドキュメントの運用

- 保存場所: 調査ドキュメントは `content/warehouse/<slug>.md` に作成する（例: `content/warehouse/test2.md`）
- 内容の書き方: 調査目的、実施日、使用したコマンドや参照元 (URL)、発見・結論を明記すること。追加で実験ログや小さなコードスニペットを含めてよい

# コンテンツ作成ルール

- フロントマターは YAML（`---`）で記述する
- 投稿はドラフト中は `draft: true` にする
- タグは英語小文字・ハイフン形式（例: `object-oriented`）
- ファイル名はスラッグ（例: `how-to-hugo.md`）を推奨。ただし、公開時にファイル名が変更される。関連記事の検索はタグを利用すること
- 見出しは ATX スタイル（`##` 以上）を使用。H1 はフロントマターの `title` に任せる
- 外部参照は既存ショートコード（例: `{{< linkcard "https://example.com" >}}`）を優先する
- よく使うフロントマターキー: `title`, `draft`, `tags`, `description`, `image`
- アイキャッチ画像: `image` フィールドで指定。画像は `static/public_images/2025/` に配置する

# テスト手順

- 自動化されたユニットテストは本リポジトリに含まれていない。検証は主に目視とリンクチェッカーを利用する

# コードスタイル & コンテンツ規約

- Markdown は CommonMark 互換
- フェンスコードブロックに適切な言語タグを付与する
- 画像には意味のある `alt` を付ける
- 既存ショートコードやパーシャルを優先する。生 HTML 埋め込みは禁止

# プルリクエストとコントリビューション規約

- ブランチ命名例: `feature/write-hugo-article`, `fix/images-optimization`
- PR タイトル: `[post] 短い説明` または `[site] 短い説明`
- PR 提出前に行うこと:
  - 下書きは `draft: true` のままにする

# セキュリティとシークレット管理

- リポジトリにシークレットを置かない。CI のシークレットは GitHub Secrets 等を利用する
- フロントマターやコンテンツに資格情報を埋め込まない

# ワークフロー

## 基本方針

- エージェントへの依頼は明確なプロンプトテンプレートに従う
- 最後は、 **必ず公開前の最終チェック（reviewer）に依頼すること**

## シリーズ記事（連載記事）のワークフロー

### プランニングフェーズ

1. **調査・情報収集**（investigative-researchエージェント）
   - キーワード、テーマに関する情報収集
   - 競合記事の分析、内部リンク候補の調査
   - 調査ドキュメントを `content/warehouse/<slug>.md` に保存

2. **連載構造案の作成**（該当する専門家エージェント）
   - 調査結果に基づき、連載の全体像を設計
   - 異なる視点/アプローチの構造案を3つ（案A/B/C）作成
   - 各記事の主要テーマ、新しい概念、ストーリー、推奨タグを定義
   - 連載構造案を `content/warehouse/<slug>-structure.md` に保存
   
3. **連載構造案のレビューと改善**（search-engine-optimizationエージェント + reviewerエージェント）
   - SEO視点（キーワード配置、検索意図適合）と品質視点（構造の一貫性、段階的難易度）からレビュー
   - 必要に応じて改善を反復（最大3回：第1版→第2版→第3版（最終版））
   - 最終版を確定

4. **最終案の決定**（ユーザーまたはreviewerエージェント）
   - 3案の中から最適な案を選定
   - 選定理由を文書化

### 執筆フェーズ

5. **各記事の執筆**
   - 連載構造に基づいて、各記事を作成
   - 各記事については「単体記事のワークフロー」に従うこと
   - 各回のアウトライン作成（search-engine-optimizationエージェント）から開始

## 単体記事のワークフロー

1. 調査・情報収集（investigative-researchエージェント）
2. アウトライン作成（search-engine-optimizationエージェント）
  - タイトルの最適化：主要キーワードを含め、クリックされやすい表現にする
  - meta description：検索結果でのCTRを高める要約する
  - 見出し構造の整理：H1はページの主題、H2/H3で論理的に分割する
  - 構造化データの導入：リッチリザルト促進（FAQ、レビュー、イベントなど）
3. 記事作成（各専門家エージェント）
  - アウトラインに基づいて、技術的に正確で最新の情報を盛り込んだ記事を作成する
  - ユーザーが求める回答を分かりやすく、独自の視点やデータで提供
  - コード例、図表（mermaid記法など）、引用を適切に配置する
  - 引用元のURLや内部リンクを明記する
4. 挿絵を追加する（illustration-craftspersonエージェント）
  - 記事の内容を理解し、読者の理解を深めるための視覚的な要素を提案する
  - 技術記事に適した図表、ダイアグラム、フローチャートなどを作成する
  - Mermaid記法を活用して、システム構成図やシーケンス図などを作成する
5. 校正（proofreaderエージェント）
6. 公開前の最終チェック（reviewerエージェント）

# エージェントトピックマッピング

専門家エージェントは `.github/agents/*.agent.md` を参照してください。以下は代表例です。

- Perl / CPAN / ワンライナー: `perl-monger`
- SQL / クエリ最適化 / DB 設計: `sql-otaku`
- JSON-RPC / API 設計: `json-rpc-otaku`
- WebSocket / リアルタイム通信: `websocket-otaku`
- Docker / コンテナ運用: `docker-otaku`
- Kubernetes / クラスタ運用: `kubernetes-otaku`
- Git / ブランチ運用: `git-otaku`
- GitHub / ワークフロー・PR ベストプラクティス: `github-otaku`
- カスタムエージェント: `github-copilot-otaku`
- AGENTS.pm / AIエージェントガイドライン: `agents-pm-otaku`
- 挿絵作成 / 図表・ダイアグラム / Mermaid: `illustration-craftsperson`

# プロンプトテンプレート

## 調査・情報収集依頼

- キーワード、および関連トピックについて、最新かつ信頼性の高い情報を調査・情報収集し、ドキュメントにまとめること。調査結果と共に **要点** 、 **根拠** 、 **仮定** 、 **出典（URL、書籍名（ASIN、ISBN）など）** 、 **信頼度** を示してください。
- 競合記事の分析を行うこと
- 内部リンク（関連記事など）の調査。`/content/post`配下に存在するファイルを`grep`で調査すること。リンクへの変換はファイル名から変換して使用すること（例: ファイル名`/content/post/2025/12/24/000000.md`=>内部リンク`/2025/12/24/000000/`）
- 記事執筆時に技術的な正確性を担保するための情報源として参照すべき重要なリソースのリストを作成すること
- 調査結果は、調査ドキュメントとして保存する。調査ドキュメントは `content/warehouse/<slug>.md` に作成する（例: `content/warehouse/test2.md`）

## 連載構造案作成依頼

- 調査結果（`content/warehouse/<slug>.md`）に基づいて、シリーズ記事の連載構造案を3つ（案A/B/C）作成すること
- 各案は、異なる視点やアプローチを持つこと
- 生成後、レビューと改善を3回繰り返すこと

### 各案に必要な項目
- 特徴・アプローチ: メリット・デメリットを明記
- 連載構造表: 以下の列を持つ表形式
  - 回数（第N回）
  - タイトル
  - 新しい概念（1記事1概念の原則）
  - ストーリー（具体的なシナリオ）
  - コード例1/2（技術記事の場合）
  - 推奨タグ（3つ程度、英語小文字・ハイフン形式）
- 差別化ポイント: 各案の独自性を明示
- 推薦案とその理由: ペルソナや検索意図への適合性

### 出力
- 連載構造案は `content/warehouse/<slug>-structure.md` に保存する
- フロントマター（YAML形式）をつける
- 調査結果の参照元を明記する（例: `調査結果: content/warehouse/<slug>.md に基づく`）

## 連載構造案レビュー依頼

- 連載構造案（`content/warehouse/<slug>-structure.md`）をレビューすること
- SEO視点と品質視点の両面から評価する
- 改善提案を具体的に提示する
- レビューと改善を最大3回反復する（第1版→第2版→第3版（最終版））

### レビュー観点

**SEO視点（search-engine-optimizationエージェント）**:
- 各回のタイトルにキーワードが適切に配置されているか
- 検索意図に合致した構成か
- 推奨タグが適切か
- メタ情報の最適化（各回の description など）

**品質視点（reviewerエージェント）**:
- 構造の一貫性（ストーリーの流れ、難易度の段階性）
- 1記事1概念の原則が守られているか
- 各案が明確に差別化されているか
- ペルソナへの適合性
- 技術的正確性の担保

### 出力
- レビューコメントを連載構造案に追記する
- 改善が必要な場合は、改善版を作成する（第2版、第3版として同一ファイルに追記）
- 最終版では推薦案を明確に選定し、理由を文書化する

## アウトライン依頼

- 調査結果に基づいて、技術記事のアウトライン案を3つ（案A/B/C）作成すること
- 各案は、異なる視点やアプローチを持つこと
- 生成後、レビューと改善を3回繰り返すこと

### 各案に必要な項目
- 要約(1行)
- H2/H3 見出しの階層
- 推奨タグ(3つ程度)

## 記事作成依頼

- 調査結果とアウトラインに基づいて、記事を作成すること
- 技術的に正確で最新の情報を盛り込むこと
- コード例や図表（mermaid記法など）を適切に配置する
- 引用する場合はURLを単独のリンクとし、ショートコードを使用して記載する（例: `{{< linkcard "https://www.example.com" >}}`）
- 生成後、レビューと改善を3回繰り返すこと

### 出力
- 記事作成は、必ず新たなファイルとして作成する
- フロントマター（YAML形式）をつける
- H2/H3 見出しの階層に従って本文を作成する
- **「話し言葉（例:なんです）」ではなく「書き言葉（例:なのです）」で書く**
- **本文の文体は「です・ます調」にする**
- **箇条書きの文体は「だ・である調」にする**
- **箇条書きの最後の句点（。）はつけない**
- 各コード例に言語タグ、バージョン、外部依存を明記する
- 書籍については、ショートコード（amazon）を使用して記載する（例: `{{< amazon asin="<ASIN>" title="<書籍のタイトル>" >}}`）

# 検証と品質ゲート

## 単体記事の品質基準

- H2/H3 の見出しが適切に分割されていること
- 各セクションの説明が具体的であること（曖昧な語句は再要求）
- コード例の言語・バージョン・外部依存が明記されていること
- 推奨タグがリポジトリのタグ規約に合致していること（英語小文字、ハイフン）

## 連載構造案の品質基準

- 構造の一貫性: 連載全体でストーリーの流れが論理的に繋がっていること
- 段階的難易度上昇: 初回から最終回にかけて段階的に難易度が上がっていること
- 1記事1概念の原則: 各回で1つの新しい概念に焦点を当てていること（複数の概念を詰め込まない）
- 各案の差別化: 3つの構造案（案A/B/C）が明確に異なる視点・アプローチを持っていること
- 連載構造表の完全性: 全回分の「回数、タイトル、新概念、ストーリー、コード例、タグ」が記載されていること
- 推薦案の根拠: 推薦案が選定され、ペルソナや検索意図への適合性が理由として明示されていること

# 付記

- 変更や追補が必要な場合は `.github/agents/*.agent.md` を参照して各エージェントの特性に合わせて調整してください
