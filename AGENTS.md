# AGENTS.md — リポジトリ用エージェント向けガイダンス

このファイルは `README.md` の補助文書で、Hugo ベースのウェブサイト（`www.nqou.net`）におけるエージェントの作業指針をまとめたものです。

# コミュニケーション

- 原則として日本語で応答する。ただし技術用語やコードは英語のまま記載してよい。

# プロジェクト概要

- **目的**: Hugo を用いた個人の技術ブログの管理。
- **主要技術**: Hugo、Markdown、必要に応じた補助スクリプト（例: Perl）。
- **重要なディレクトリ**:
  - `content/` — ソースコンテンツ（投稿は `content/post/`）。
  - `layouts/`, `partials/`, `shortcodes/` — テーマやレイアウト。
  - `static/` — 静的アセット。
  - `resources/` — Hugo のリソース出力。
  - `docs/` — 生成済みサイト（読み取り専用扱い）。

# クイックスタート（エージェント向け要点）

- コンテンツは `content/post/` に追加する。
- エージェントは環境セットアップやシステムレベルのインストールを自動実行してはならない。
- `docs/` は生成物のため直接編集しない。

# セットアップ（人間が実行するコマンド）

- ローカルプレビュー: `hugo server -D`
- 本番ビルド: `hugo --minify`
- 例（macOS、Homebrew）:

```zsh
brew install hugo
hugo server -D -F
```

> 注意: エージェントはシステムインストールやセットアップを自動実行してはなりません。

# エージェントの作業フロー（概要）

- コンテンツ作成、プレビュー、ビルド、検証の一連の流れを人間が管理する前提でエージェントは補助作業を行います。

# コンテンツ作成ルール

- フロントマターは YAML（`---`）で記述する。
- 投稿はドラフト中は `draft: true` にする。
- タグは英語小文字・ハイフン形式（例: `object-oriented`）。
- ファイル名はスラッグ（例: `how-to-hugo.md`）を推奨。
- 見出しは ATX スタイル（`##` 以上）を使用。H1 はフロントマターの `title` に任せる。
- 外部参照は `{{< linkcard "https://example.com" >}}` など既存ショートコードを優先する。
- よく使うフロントマターキー: `title`, `draft`, `tags`, `description`。

# プレビューと編集

- `hugo server -D` で `http://localhost:1313` を開き、レンダリングを確認する。
- レイアウトやショートコードの挙動を検証する。

# ビルドと検証

- `hugo --minify` を実行し、生成物（`docs/` など）を目視で確認する。
- `build.pl` 等を使う場合は、人間がスクリプトの内容と引数を精査してから実行する。

# テスト手順

- 自動化されたユニットテストは本リポジトリに含まれていない。検証は主に目視とリンクチェッカーを利用する。
- 推奨ツール: `linkinator`, `broken-link-checker` 等。

# コードスタイル & コンテンツ規約

- Markdown は CommonMark 互換。
- フェンスコードブロックに適切な言語タグを付与する。
- 画像には意味のある `alt` を付ける。
- 既存ショートコードやパーシャルを優先する。生 HTML 埋め込みはなるべく避ける。

# ビルドとデプロイ

- ビルドコマンドは `hugo --minify`。
- 生成物の出力先（`docs/` 等）を CI 設定に合わせて確認する。
- `docs/` は通常読み取り専用とする。編集はソースに対して行う。

# プルリクエストとコントリビューション規約

- ブランチ命名例: `feature/write-hugo-article`, `fix/images-optimization`。
- PR タイトル: `[post] 短い説明` または `[site] 短い説明`。
- PR 提出前に行うこと:
  - `hugo server -D` で目視確認
  - `hugo --minify` でビルド確認
  - 下書きは `draft: true` のままにする

# セキュリティとシークレット管理

- リポジトリにシークレットを置かない。CI のシークレットは GitHub Secrets 等を利用する。
- フロントマターやコンテンツに資格情報を埋め込まない。

# トラブルシューティング

- `hugo server` が失敗する場合の確認:
  - Hugo のバージョン確認（`config/_default/config.toml` 等）
  - ショートコードやパーシャルのパラメータ不足の確認
- 画像が表示されない場合:
  - `assets/` や `static/images/` にファイルがあるか確認
  - フロントマターのパスが正しいか確認
- コンテンツが表示されない場合:
  - `draft` の値、または `hugo server -D` を使用しているか確認

# カスタムエージェントを使ったワークフロー

この節では、カスタムエージェント群を連携させて記事作成フロー（アイデア出し→下書き生成→編集→校正→公開準備）を行う手順を示します。最終判断やファイル操作、コマンド実行は常に人間が行ってください。

# ワークフロー概要（エージェント役割）

1. `creative-brainstorming` — アイデア生成（複数案）。
2. `investigative-research` / `websearch-nerd` — 情報収集・出典の取得。
3. `draft` — フロントマター付き Markdown 下書き生成。
4. `layout-and-content-harmonization` / `blog-editor` — レイアウト調整・編集。
5. `proofreader` / `reviewer` — 校正・公開準備チェック。
6. `search-engine-optimization` — メタ情報と公開準備（SEO）検討。

# 専門家エージェントへの構成（アウトライン）依頼ワークフロー

## 目的

トピックに最も適した専門家エージェントにアウトライン（構成）作成を委任し、品質の高い記事骨子を短時間で得るための標準手順を定義します。

## 基本方針

- 各トピックは対応する専門家エージェントに割り当てる（下のマッピング参照）。
- エージェントへの依頼は明確なプロンプトテンプレートに従う。
- 出力は H2/H3 見出し（日本語）で、各見出しに 1–2 行の説明を付ける。
- 出力は破壊的変更ではなく、下書きとして人間が `content/` に配置して最終調整する。

## 実行手順

1. 要件定義（人間）: タイトル候補、目的、想定読者、主要トピック、優先度をまとめる。
2. エージェント選定（人間）: エージェント・トピックマッピングを参照して選ぶ。
3. プロンプト準備（人間）: 提供する情報とテンプレートを用意する。
4. エージェント呼び出し: `run_subagent` 等で呼び出す（自動化する場合）。
5. 受領物の検査（人間）: H2/H3 構造、抜け、用語を確認し、必要なら再依頼。
6. 統合と修正（人間）: 複数エージェントからの出力を統合。
7. 下書き生成指示（人間→`draft`）: 最終アウトラインを `draft` に渡して下書きを作成。

## エージェント・トピックマッピング（代表例）

- Perl / CPAN / ワンライナー: `perl-monger`
- SQL / クエリ最適化 / DB 設計: `sql-otaku`
- JSON-RPC / API 設計: `json-rpc-otaku`
- WebSocket / リアルタイム通信: `websocket-otaku`
- Docker / コンテナ運用: `docker-otaku`
- Kubernetes / クラスタ運用: `kubernetes-otaku`
- Git / ブランチ運用: `git-otaku`
- GitHub / ワークフロー・PR ベストプラクティス: `github-otaku`, `github-copilot-otaku`
- 調査・情報収集: `investigative-research`, `websearch-nerd`
- 記事構成・編集: `blog-planner`, `blog-editor`, `layout-and-content-harmonization`
- 校正・最終チェック: `proofreader`, `reviewer`
- SEO と公開準備: `search-engine-optimization`
- 企画・アイデア: `creative-brainstorming`

## プロンプトテンプレート（アウトライン依頼）

### 短縮版（軽めの依頼）

次の情報に基づいて、技術記事のアウトライン案を3つ（案A/B/C）作ってください。

- タイトル候補: <TITLE>
- 目的: <WHAT_TO_TEACH>
- 想定読者: <AUDIENCE>
- 必要な技術要素（任意）: <TECH_TOPICS>

出力形式:
- 各案に対して: 要約(1行)、H2/H3 見出しの階層、各見出しに1-2行の説明、推奨タグ(3つ程度)、推定文字数レンジ。

### 詳細版（専門家向け）

あなたは <AGENT_NAME> の専門家です。次の要件に基づいて、記事の詳細アウトラインを作ってください。

- タイトル候補: <TITLE>
- 目的: <WHAT_TO_TEACH>
- 想定読者: <AUDIENCE>
- 想定環境/言語/バージョン: <ENV>（任意）
- 参考URL: <URLS>（任意）

出力は日本語で、H2（トップレベル）と H3 の階層で返してください。各見出しに 1–2 行の説明、必要なら想定コード言語を明記してください。

# 検証と品質ゲート（人間によるチェック）

- H2/H3 の見出しが適切に分割されていること。
- 各セクションの説明が具体的であること（曖昧な語句は再要求）。
- コード例の言語・バージョン・外部依存が明記されていること。
- 推奨タグがリポジトリのタグ規約に合致していること（英語小文字、ハイフン）。

# 実運用メモ

- 複数回リクエストしてバリエーションを集め、最良案を手作業で統合するのが実務的。
- アウトライン生成は非破壊的に行い、エージェントは `content/` に直接書き込ませない。

# テンプレート利用例（短い提示メッセージ）

- perl-monger に対して:
  - タイトル: "PerlでのシンプルなCSVパーサ実装"
  - 目的: 小さなデータを素早く扱う方法を示す
  - 想定読者: Perl 初心者〜中級者
  - 技術要素: Text::CSV, one-liners
  - 出力: まずアウトライン案を3つ

- sql-otaku に対して:
  - タイトル: "Postgresでのパフォーマンス改善入門"
  - 目的: 実行計画を読み解く基礎を教える
  - 想定読者: DB 管理者とアプリ開発者
  - 技術要素: EXPLAIN ANALYZE, indexes
  - 出力: まずアウトライン案を3つ

# 付記

- 変更や追補が必要な場合は `.github/agents/*.agent.md` を参照して各エージェントの特性に合わせて調整してください。

---

以上。エージェントに渡すプロンプトやワークフローを明確化し、人間による最終チェックを必須とする方針を明記しました。
