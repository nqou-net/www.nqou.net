# AGENTS.md — リポジトリ用エージェント向けガイダンス

このファイルは `README.md` の補助文書である。リポジトリ `www.nqou.net`（Hugoベースのウェブサイト）に関して、エージェントが効果的に作業するための具体的かつ実行可能な指示をまとめたものである。

---

**コミュニケーション**

- 原則として日本語で応答を返す。ただし重要な用語については除く。

**プロジェクト概要**

- **目的**: Hugoで構築された個人の技術ブログを管理するためのリポジトリである。コンテンツは `content/` に置き、ビルド成果物は `docs/` に配置する運用である。
- **主要技術**: Hugo（静的サイト生成器）、Markdown、及び必要に応じて `tools/` に格納された小規模な補助スクリプト（Perlなど）を用いる。
- **重要なディレクトリ**:
  - `content/` — ソースコンテンツを配置する。投稿は `content/post/` に配置する（ファイル名はタイムスタンプまたは `YYYY/MM/DD` 形式を採用する）。
  - `layouts/`, `partials/`, `shortcodes/` — テーマとレイアウトのコードを格納する。
  - `static/` — サイトルートにコピーされる静的アセットを格納する。
  - `resources/` — Hugo のリソースパイプラインの出力を配置する。
  - `docs/` — 生成済みサイトの出力を配置する。通常は読み取り専用として扱う。


**エージェント向けの簡潔な事実（クイックスタート）**

- ローカルプレビューは `hugo server -D` で行うこと。
- 本番ビルドは `hugo --minify` で行うこと。
- VS Code に `Serve Drafts`（`hugo server -D`）と `Build`（`hugo --minify`）のタスクが定義されていることを確認すること。
- コンテンツは `content/post/` に追加すること。既存の命名規則（エポック秒形式など）に従うこと。
- **重要制約**: エージェントは環境セットアップやシステムレベルのインストールコマンドを自動で実行してはならない。`docs/` は生成出力であるため直接編集してはならない。

---


## セットアップ（人間が実行するコマンド）

- 必要に応じて Hugo を人間がインストールすること（プラットフォーム固有の方法を用いる）。
- **警告** — エージェントはセットアップやシステムインストール操作を実行してはならない。これらは人間が手動で行う前提である。
- ローカルプレビュー（ドラフトを含めて表示）を開始するための例（人間が実行する）:

```zsh
brew install hugo   # macOS で Homebrew を使用する場合の例
hugo server -D
```

- 本番向けビルドを行う場合のコマンド（人間が実行する）:

```zsh
hugo --minify
```

- ヘルパースクリプト（例: `build.pl`）を使用する場合は、スクリプトの内容と引数を事前に精査すること。

---


## エージェントの作業フロー

以下の手順に従うこと。各項目は実行可能かつ検証可能な操作として定義してある。

- **コンテンツ作成**:
  - 新しい投稿は `content/post/` の直下に配置すること。
  - フロントマターは YAML（`---`）で記述すること。TOML（`+++`）は使用しないこと。
  - 投稿は下書き状態の間は `draft: true` にしておくこと（公開準備が整ったときに `draft: false` に変更する）。
  - タグは英語の小文字で統一すること。複合語はハイフンでつなげる（例: `object-oriented`）。
  - 見出しは ATX スタイルを採用すること。H1 はページタイトル（フロントマター由来）とし、トップレベルのセクションは `##` とすること。
  - シンプルな外部参照リンク（前後に空白以外がない場合）にはサイトの `linkcard` ショートコードを使用すること: `{{< linkcard "https://example.com" >}}`。
  - よく使うフロントマターキーは `title`, `draft`, `tags`, `description` とする。`date` や `iso8601` は含めないこと。

- **プレビューと編集**:
  - `hugo server -D` を起動して `http://localhost:1313` でレンダリングを確認すること。
  - レイアウトやショートコードの挙動（画像やショートコードの表示）を検証すること。

- **ビルドと検証**:
  - `hugo --minify` を実行し、生成物を検査すること（`public/` または `docs/` を確認する）。
  - `build.pl` を使用する場合は、事前にスクリプトの内容と引数を精査してから実行すること。

---


## テスト手順

- 本リポジトリには自動化されたユニットテストは含まれていない。検証手順は以下の通りである:
  - `hugo --minify` を実行し、生成された HTML を目視で検査すること。
  - リンクチェッカー（例: `linkinator` や `broken-link-checker`）を用い、サイト内のリンク整合性を検査すること。

- CI による検証は `.github/workflows` を参照し、同等のコマンドをローカルで実行して確認すること。

---


## コードスタイル & コンテンツ規約

- Markdown は CommonMark と互換性を保つこと。フェンスコードブロックと適切な言語タグを使用すること。
- フロントマターは YAML（`---`）で統一すること。既存のフロントマターを無断で上書きしてはならない。
- 画像には意味のある `alt` テキストを付与すること。必要に応じて短いキャプションを付けること。
- 画像処理が必要な場合は Hugo の `resources` パイプラインを利用すること。
- 既存のショートコード（`layouts/shortcodes/`）を優先して使用すること。正当な理由がない限り生の HTML を直接埋め込まないこと。

---


## ビルドとデプロイ

- ビルドコマンドは `hugo --minify` である。
- 生成物の出力先を確認し、CI の設定に合わせて検証すること（多くのワークフローでは `docs/` を公開用として使用する）。
- `docs/` は通常読み取り専用とし、エージェントは直接編集してはならない。編集は必ずソース（`content/`, `layouts/`, `static/` など）に対して行い、その後ビルドして反映させること。

---


## プルリクエストとコントリビューション規約

- ブランチ命名規則を遵守すること（例: `feature/write-hugo-article`, `fix/images-optimization`）。
- PR タイトルのフォーマットは `[post] 短い説明` または `[site] 短い説明` に統一すること。
- PR 提出前に以下を必ず実行して確認すること:
  - `hugo server -D` を起動して表示を目視確認すること。
  - `hugo --minify` を実行してビルドが成功することを確認すること。
  - 下書きは `draft: true` のままにすること。公開時にのみ `draft: false` に変更すること。

---


## セキュリティとシークレット管理

- リポジトリ内にシークレットを格納してはならない。CI やデプロイ用のシークレットは GitHub Secrets や外部のシークレットマネージャーを利用すること。
- フロントマターやコンテンツに資格情報を埋め込んではならない。

---


## トラブルシューティング（よくある問題と対応手順）

- `hugo server` が失敗する場合の確認事項:
  - 必要な Hugo のバージョンが適合しているかを `config/_default/config.toml` 等で確認すること。
  - ショートコードやパーシャルが原因でエラーが発生していないかを確認すること（パラメータ不足が原因となる場合が多い）。

- 画像が表示されない場合の確認事項:
  - `assets/` や `static/images/` に該当ファイルが存在するかを確認すること。
  - フロントマターの `featuredImage` パスが正しいかを確認すること。

- コンテンツが表示されない場合の確認事項:
  - `draft` が `false` になっているか、または `hugo server -D` を使用してドラフトを含めて表示しているかを確認すること。

---


## エージェント用テンプレートとプロンプト（コピペ可）

- ドラフト生成（英語/日本語）用テンプレート例:

```
You are a skilled technical writer. From the brief: {brief}
Target reader: {audience}
Tone: {tone}
Output: Hugo-compatible Markdown using YAML front matter (delimited with `---`), include `draft: true` and a short `description` (<=120 chars). Do not include a `date` field. Use ATX headings (H2 for top-level sections). Use `linkcard` shortcode for simple external links.
```

- SEO チェックリスト（自動化）: フロントマターに `title`, `description` (<= 120 文字), `slug`, `tags` が存在することを検査すること。

---

## カスタムエージェント（`.github/agents`）

- リポジトリ内に `.github/agents/` が存在する場合、そのファイルは人間が用意したエージェント定義である。


---


このファイルはエージェントがリポジトリ内で行動するための明確な手順とチェックリストを提供するものである。変更を加える場合はこの方針に従い、手順を逸脱しないこと。
